(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
// CodeMirror, copyright (c) by Marijn Haverbeke and others
// Distributed under an MIT license: http://codemirror.net/LICENSE

// Utility function that allows modes to be combined. The mode given
// as the base argument takes care of most of the normal mode
// functionality, but a second (typically simple) mode is used, which
// can override the style of text. Both modes get to parse all of the
// text, but when both assign a non-null style to a piece of code, the
// overlay wins, unless the combine argument was true and not overridden,
// or state.overlay.combineTokens was true, in which case the styles are
// combined.

(function(mod) {
  if (typeof exports == "object" && typeof module == "object") // CommonJS
    mod(require("../../lib/codemirror"));
  else if (typeof define == "function" && define.amd) // AMD
    define(["../../lib/codemirror"], mod);
  else // Plain browser env
    mod(CodeMirror);
})(function(CodeMirror) {
"use strict";

CodeMirror.overlayMode = function(base, overlay, combine) {
  return {
    startState: function() {
      return {
        base: CodeMirror.startState(base),
        overlay: CodeMirror.startState(overlay),
        basePos: 0, baseCur: null,
        overlayPos: 0, overlayCur: null,
        streamSeen: null
      };
    },
    copyState: function(state) {
      return {
        base: CodeMirror.copyState(base, state.base),
        overlay: CodeMirror.copyState(overlay, state.overlay),
        basePos: state.basePos, baseCur: null,
        overlayPos: state.overlayPos, overlayCur: null
      };
    },

    token: function(stream, state) {
      if (stream != state.streamSeen ||
          Math.min(state.basePos, state.overlayPos) < stream.start) {
        state.streamSeen = stream;
        state.basePos = state.overlayPos = stream.start;
      }

      if (stream.start == state.basePos) {
        state.baseCur = base.token(stream, state.base);
        state.basePos = stream.pos;
      }
      if (stream.start == state.overlayPos) {
        stream.pos = stream.start;
        state.overlayCur = overlay.token(stream, state.overlay);
        state.overlayPos = stream.pos;
      }
      stream.pos = Math.min(state.basePos, state.overlayPos);

      // state.overlay.combineTokens always takes precedence over combine,
      // unless set to null
      if (state.overlayCur == null) return state.baseCur;
      else if (state.baseCur != null &&
               state.overlay.combineTokens ||
               combine && state.overlay.combineTokens == null)
        return state.baseCur + " " + state.overlayCur;
      else return state.overlayCur;
    },

    indent: base.indent && function(state, textAfter) {
      return base.indent(state.base, textAfter);
    },
    electricChars: base.electricChars,

    innerMode: function(state) { return {state: state.base, mode: base}; },

    blankLine: function(state) {
      if (base.blankLine) base.blankLine(state.base);
      if (overlay.blankLine) overlay.blankLine(state.overlay);
    }
  };
};

});

},{"../../lib/codemirror":2}],2:[function(require,module,exports){
// CodeMirror, copyright (c) by Marijn Haverbeke and others
// Distributed under an MIT license: http://codemirror.net/LICENSE

// This is CodeMirror (http://codemirror.net), a code editor
// implemented in JavaScript on top of the browser's DOM.
//
// You can find some technical background for some of the code below
// at http://marijnhaverbeke.nl/blog/#cm-internals .

(function(mod) {
  if (typeof exports == "object" && typeof module == "object") // CommonJS
    module.exports = mod();
  else if (typeof define == "function" && define.amd) // AMD
    return define([], mod);
  else // Plain browser env
    (this || window).CodeMirror = mod();
})(function() {
  "use strict";

  // BROWSER SNIFFING

  // Kludges for bugs and behavior differences that can't be feature
  // detected are enabled based on userAgent etc sniffing.
  var userAgent = navigator.userAgent;
  var platform = navigator.platform;

  var gecko = /gecko\/\d/i.test(userAgent);
  var ie_upto10 = /MSIE \d/.test(userAgent);
  var ie_11up = /Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(userAgent);
  var ie = ie_upto10 || ie_11up;
  var ie_version = ie && (ie_upto10 ? document.documentMode || 6 : ie_11up[1]);
  var webkit = /WebKit\//.test(userAgent);
  var qtwebkit = webkit && /Qt\/\d+\.\d+/.test(userAgent);
  var chrome = /Chrome\//.test(userAgent);
  var presto = /Opera\//.test(userAgent);
  var safari = /Apple Computer/.test(navigator.vendor);
  var mac_geMountainLion = /Mac OS X 1\d\D([8-9]|\d\d)\D/.test(userAgent);
  var phantom = /PhantomJS/.test(userAgent);

  var ios = /AppleWebKit/.test(userAgent) && /Mobile\/\w+/.test(userAgent);
  // This is woefully incomplete. Suggestions for alternative methods welcome.
  var mobile = ios || /Android|webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(userAgent);
  var mac = ios || /Mac/.test(platform);
  var windows = /win/i.test(platform);

  var presto_version = presto && userAgent.match(/Version\/(\d*\.\d*)/);
  if (presto_version) presto_version = Number(presto_version[1]);
  if (presto_version && presto_version >= 15) { presto = false; webkit = true; }
  // Some browsers use the wrong event properties to signal cmd/ctrl on OS X
  var flipCtrlCmd = mac && (qtwebkit || presto && (presto_version == null || presto_version < 12.11));
  var captureRightClick = gecko || (ie && ie_version >= 9);

  // Optimize some code when these features are not used.
  var sawReadOnlySpans = false, sawCollapsedSpans = false;

  // EDITOR CONSTRUCTOR

  // A CodeMirror instance represents an editor. This is the object
  // that user code is usually dealing with.

  function CodeMirror(place, options) {
    if (!(this instanceof CodeMirror)) return new CodeMirror(place, options);

    this.options = options = options ? copyObj(options) : {};
    // Determine effective options based on given values and defaults.
    copyObj(defaults, options, false);
    setGuttersForLineNumbers(options);

    var doc = options.value;
    if (typeof doc == "string") doc = new Doc(doc, options.mode, null, options.lineSeparator);
    this.doc = doc;

    var input = new CodeMirror.inputStyles[options.inputStyle](this);
    var display = this.display = new Display(place, doc, input);
    display.wrapper.CodeMirror = this;
    updateGutters(this);
    themeChanged(this);
    if (options.lineWrapping)
      this.display.wrapper.className += " CodeMirror-wrap";
    if (options.autofocus && !mobile) display.input.focus();
    initScrollbars(this);

    this.state = {
      keyMaps: [],  // stores maps added by addKeyMap
      overlays: [], // highlighting overlays, as added by addOverlay
      modeGen: 0,   // bumped when mode/overlay changes, used to invalidate highlighting info
      overwrite: false,
      delayingBlurEvent: false,
      focused: false,
      suppressEdits: false, // used to disable editing during key handlers when in readOnly mode
      pasteIncoming: false, cutIncoming: false, // help recognize paste/cut edits in input.poll
      selectingText: false,
      draggingText: false,
      highlight: new Delayed(), // stores highlight worker timeout
      keySeq: null,  // Unfinished key sequence
      specialChars: null
    };

    var cm = this;

    // Override magic textarea content restore that IE sometimes does
    // on our hidden textarea on reload
    if (ie && ie_version < 11) setTimeout(function() { cm.display.input.reset(true); }, 20);

    registerEventHandlers(this);
    ensureGlobalHandlers();

    startOperation(this);
    this.curOp.forceUpdate = true;
    attachDoc(this, doc);

    if ((options.autofocus && !mobile) || cm.hasFocus())
      setTimeout(bind(onFocus, this), 20);
    else
      onBlur(this);

    for (var opt in optionHandlers) if (optionHandlers.hasOwnProperty(opt))
      optionHandlers[opt](this, options[opt], Init);
    maybeUpdateLineNumberWidth(this);
    if (options.finishInit) options.finishInit(this);
    for (var i = 0; i < initHooks.length; ++i) initHooks[i](this);
    endOperation(this);
    // Suppress optimizelegibility in Webkit, since it breaks text
    // measuring on line wrapping boundaries.
    if (webkit && options.lineWrapping &&
        getComputedStyle(display.lineDiv).textRendering == "optimizelegibility")
      display.lineDiv.style.textRendering = "auto";
  }

  // DISPLAY CONSTRUCTOR

  // The display handles the DOM integration, both for input reading
  // and content drawing. It holds references to DOM nodes and
  // display-related state.

  function Display(place, doc, input) {
    var d = this;
    this.input = input;

    // Covers bottom-right square when both scrollbars are present.
    d.scrollbarFiller = elt("div", null, "CodeMirror-scrollbar-filler");
    d.scrollbarFiller.setAttribute("cm-not-content", "true");
    // Covers bottom of gutter when coverGutterNextToScrollbar is on
    // and h scrollbar is present.
    d.gutterFiller = elt("div", null, "CodeMirror-gutter-filler");
    d.gutterFiller.setAttribute("cm-not-content", "true");
    // Will contain the actual code, positioned to cover the viewport.
    d.lineDiv = elt("div", null, "CodeMirror-code");
    // Elements are added to these to represent selection and cursors.
    d.selectionDiv = elt("div", null, null, "position: relative; z-index: 1");
    d.cursorDiv = elt("div", null, "CodeMirror-cursors");
    // A visibility: hidden element used to find the size of things.
    d.measure = elt("div", null, "CodeMirror-measure");
    // When lines outside of the viewport are measured, they are drawn in this.
    d.lineMeasure = elt("div", null, "CodeMirror-measure");
    // Wraps everything that needs to exist inside the vertically-padded coordinate system
    d.lineSpace = elt("div", [d.measure, d.lineMeasure, d.selectionDiv, d.cursorDiv, d.lineDiv],
                      null, "position: relative; outline: none");
    // Moved around its parent to cover visible view.
    d.mover = elt("div", [elt("div", [d.lineSpace], "CodeMirror-lines")], null, "position: relative");
    // Set to the height of the document, allowing scrolling.
    d.sizer = elt("div", [d.mover], "CodeMirror-sizer");
    d.sizerWidth = null;
    // Behavior of elts with overflow: auto and padding is
    // inconsistent across browsers. This is used to ensure the
    // scrollable area is big enough.
    d.heightForcer = elt("div", null, null, "position: absolute; height: " + scrollerGap + "px; width: 1px;");
    // Will contain the gutters, if any.
    d.gutters = elt("div", null, "CodeMirror-gutters");
    d.lineGutter = null;
    // Actual scrollable element.
    d.scroller = elt("div", [d.sizer, d.heightForcer, d.gutters], "CodeMirror-scroll");
    d.scroller.setAttribute("tabIndex", "-1");
    // The element in which the editor lives.
    d.wrapper = elt("div", [d.scrollbarFiller, d.gutterFiller, d.scroller], "CodeMirror");

    // Work around IE7 z-index bug (not perfect, hence IE7 not really being supported)
    if (ie && ie_version < 8) { d.gutters.style.zIndex = -1; d.scroller.style.paddingRight = 0; }
    if (!webkit && !(gecko && mobile)) d.scroller.draggable = true;

    if (place) {
      if (place.appendChild) place.appendChild(d.wrapper);
      else place(d.wrapper);
    }

    // Current rendered range (may be bigger than the view window).
    d.viewFrom = d.viewTo = doc.first;
    d.reportedViewFrom = d.reportedViewTo = doc.first;
    // Information about the rendered lines.
    d.view = [];
    d.renderedView = null;
    // Holds info about a single rendered line when it was rendered
    // for measurement, while not in view.
    d.externalMeasured = null;
    // Empty space (in pixels) above the view
    d.viewOffset = 0;
    d.lastWrapHeight = d.lastWrapWidth = 0;
    d.updateLineNumbers = null;

    d.nativeBarWidth = d.barHeight = d.barWidth = 0;
    d.scrollbarsClipped = false;

    // Used to only resize the line number gutter when necessary (when
    // the amount of lines crosses a boundary that makes its width change)
    d.lineNumWidth = d.lineNumInnerWidth = d.lineNumChars = null;
    // Set to true when a non-horizontal-scrolling line widget is
    // added. As an optimization, line widget aligning is skipped when
    // this is false.
    d.alignWidgets = false;

    d.cachedCharWidth = d.cachedTextHeight = d.cachedPaddingH = null;

    // Tracks the maximum line length so that the horizontal scrollbar
    // can be kept static when scrolling.
    d.maxLine = null;
    d.maxLineLength = 0;
    d.maxLineChanged = false;

    // Used for measuring wheel scrolling granularity
    d.wheelDX = d.wheelDY = d.wheelStartX = d.wheelStartY = null;

    // True when shift is held down.
    d.shift = false;

    // Used to track whether anything happened since the context menu
    // was opened.
    d.selForContextMenu = null;

    d.activeTouch = null;

    input.init(d);
  }

  // STATE UPDATES

  // Used to get the editor into a consistent state again when options change.

  function loadMode(cm) {
    cm.doc.mode = CodeMirror.getMode(cm.options, cm.doc.modeOption);
    resetModeState(cm);
  }

  function resetModeState(cm) {
    cm.doc.iter(function(line) {
      if (line.stateAfter) line.stateAfter = null;
      if (line.styles) line.styles = null;
    });
    cm.doc.frontier = cm.doc.first;
    startWorker(cm, 100);
    cm.state.modeGen++;
    if (cm.curOp) regChange(cm);
  }

  function wrappingChanged(cm) {
    if (cm.options.lineWrapping) {
      addClass(cm.display.wrapper, "CodeMirror-wrap");
      cm.display.sizer.style.minWidth = "";
      cm.display.sizerWidth = null;
    } else {
      rmClass(cm.display.wrapper, "CodeMirror-wrap");
      findMaxLine(cm);
    }
    estimateLineHeights(cm);
    regChange(cm);
    clearCaches(cm);
    setTimeout(function(){updateScrollbars(cm);}, 100);
  }

  // Returns a function that estimates the height of a line, to use as
  // first approximation until the line becomes visible (and is thus
  // properly measurable).
  function estimateHeight(cm) {
    var th = textHeight(cm.display), wrapping = cm.options.lineWrapping;
    var perLine = wrapping && Math.max(5, cm.display.scroller.clientWidth / charWidth(cm.display) - 3);
    return function(line) {
      if (lineIsHidden(cm.doc, line)) return 0;

      var widgetsHeight = 0;
      if (line.widgets) for (var i = 0; i < line.widgets.length; i++) {
        if (line.widgets[i].height) widgetsHeight += line.widgets[i].height;
      }

      if (wrapping)
        return widgetsHeight + (Math.ceil(line.text.length / perLine) || 1) * th;
      else
        return widgetsHeight + th;
    };
  }

  function estimateLineHeights(cm) {
    var doc = cm.doc, est = estimateHeight(cm);
    doc.iter(function(line) {
      var estHeight = est(line);
      if (estHeight != line.height) updateLineHeight(line, estHeight);
    });
  }

  function themeChanged(cm) {
    cm.display.wrapper.className = cm.display.wrapper.className.replace(/\s*cm-s-\S+/g, "") +
      cm.options.theme.replace(/(^|\s)\s*/g, " cm-s-");
    clearCaches(cm);
  }

  function guttersChanged(cm) {
    updateGutters(cm);
    regChange(cm);
    setTimeout(function(){alignHorizontally(cm);}, 20);
  }

  // Rebuild the gutter elements, ensure the margin to the left of the
  // code matches their width.
  function updateGutters(cm) {
    var gutters = cm.display.gutters, specs = cm.options.gutters;
    removeChildren(gutters);
    for (var i = 0; i < specs.length; ++i) {
      var gutterClass = specs[i];
      var gElt = gutters.appendChild(elt("div", null, "CodeMirror-gutter " + gutterClass));
      if (gutterClass == "CodeMirror-linenumbers") {
        cm.display.lineGutter = gElt;
        gElt.style.width = (cm.display.lineNumWidth || 1) + "px";
      }
    }
    gutters.style.display = i ? "" : "none";
    updateGutterSpace(cm);
  }

  function updateGutterSpace(cm) {
    var width = cm.display.gutters.offsetWidth;
    cm.display.sizer.style.marginLeft = width + "px";
  }

  // Compute the character length of a line, taking into account
  // collapsed ranges (see markText) that might hide parts, and join
  // other lines onto it.
  function lineLength(line) {
    if (line.height == 0) return 0;
    var len = line.text.length, merged, cur = line;
    while (merged = collapsedSpanAtStart(cur)) {
      var found = merged.find(0, true);
      cur = found.from.line;
      len += found.from.ch - found.to.ch;
    }
    cur = line;
    while (merged = collapsedSpanAtEnd(cur)) {
      var found = merged.find(0, true);
      len -= cur.text.length - found.from.ch;
      cur = found.to.line;
      len += cur.text.length - found.to.ch;
    }
    return len;
  }

  // Find the longest line in the document.
  function findMaxLine(cm) {
    var d = cm.display, doc = cm.doc;
    d.maxLine = getLine(doc, doc.first);
    d.maxLineLength = lineLength(d.maxLine);
    d.maxLineChanged = true;
    doc.iter(function(line) {
      var len = lineLength(line);
      if (len > d.maxLineLength) {
        d.maxLineLength = len;
        d.maxLine = line;
      }
    });
  }

  // Make sure the gutters options contains the element
  // "CodeMirror-linenumbers" when the lineNumbers option is true.
  function setGuttersForLineNumbers(options) {
    var found = indexOf(options.gutters, "CodeMirror-linenumbers");
    if (found == -1 && options.lineNumbers) {
      options.gutters = options.gutters.concat(["CodeMirror-linenumbers"]);
    } else if (found > -1 && !options.lineNumbers) {
      options.gutters = options.gutters.slice(0);
      options.gutters.splice(found, 1);
    }
  }

  // SCROLLBARS

  // Prepare DOM reads needed to update the scrollbars. Done in one
  // shot to minimize update/measure roundtrips.
  function measureForScrollbars(cm) {
    var d = cm.display, gutterW = d.gutters.offsetWidth;
    var docH = Math.round(cm.doc.height + paddingVert(cm.display));
    return {
      clientHeight: d.scroller.clientHeight,
      viewHeight: d.wrapper.clientHeight,
      scrollWidth: d.scroller.scrollWidth, clientWidth: d.scroller.clientWidth,
      viewWidth: d.wrapper.clientWidth,
      barLeft: cm.options.fixedGutter ? gutterW : 0,
      docHeight: docH,
      scrollHeight: docH + scrollGap(cm) + d.barHeight,
      nativeBarWidth: d.nativeBarWidth,
      gutterWidth: gutterW
    };
  }

  function NativeScrollbars(place, scroll, cm) {
    this.cm = cm;
    var vert = this.vert = elt("div", [elt("div", null, null, "min-width: 1px")], "CodeMirror-vscrollbar");
    var horiz = this.horiz = elt("div", [elt("div", null, null, "height: 100%; min-height: 1px")], "CodeMirror-hscrollbar");
    place(vert); place(horiz);

    on(vert, "scroll", function() {
      if (vert.clientHeight) scroll(vert.scrollTop, "vertical");
    });
    on(horiz, "scroll", function() {
      if (horiz.clientWidth) scroll(horiz.scrollLeft, "horizontal");
    });

    this.checkedZeroWidth = false;
    // Need to set a minimum width to see the scrollbar on IE7 (but must not set it on IE8).
    if (ie && ie_version < 8) this.horiz.style.minHeight = this.vert.style.minWidth = "18px";
  }

  NativeScrollbars.prototype = copyObj({
    update: function(measure) {
      var needsH = measure.scrollWidth > measure.clientWidth + 1;
      var needsV = measure.scrollHeight > measure.clientHeight + 1;
      var sWidth = measure.nativeBarWidth;

      if (needsV) {
        this.vert.style.display = "block";
        this.vert.style.bottom = needsH ? sWidth + "px" : "0";
        var totalHeight = measure.viewHeight - (needsH ? sWidth : 0);
        // A bug in IE8 can cause this value to be negative, so guard it.
        this.vert.firstChild.style.height =
          Math.max(0, measure.scrollHeight - measure.clientHeight + totalHeight) + "px";
      } else {
        this.vert.style.display = "";
        this.vert.firstChild.style.height = "0";
      }

      if (needsH) {
        this.horiz.style.display = "block";
        this.horiz.style.right = needsV ? sWidth + "px" : "0";
        this.horiz.style.left = measure.barLeft + "px";
        var totalWidth = measure.viewWidth - measure.barLeft - (needsV ? sWidth : 0);
        this.horiz.firstChild.style.width =
          (measure.scrollWidth - measure.clientWidth + totalWidth) + "px";
      } else {
        this.horiz.style.display = "";
        this.horiz.firstChild.style.width = "0";
      }

      if (!this.checkedZeroWidth && measure.clientHeight > 0) {
        if (sWidth == 0) this.zeroWidthHack();
        this.checkedZeroWidth = true;
      }

      return {right: needsV ? sWidth : 0, bottom: needsH ? sWidth : 0};
    },
    setScrollLeft: function(pos) {
      if (this.horiz.scrollLeft != pos) this.horiz.scrollLeft = pos;
      if (this.disableHoriz) this.enableZeroWidthBar(this.horiz, this.disableHoriz);
    },
    setScrollTop: function(pos) {
      if (this.vert.scrollTop != pos) this.vert.scrollTop = pos;
      if (this.disableVert) this.enableZeroWidthBar(this.vert, this.disableVert);
    },
    zeroWidthHack: function() {
      var w = mac && !mac_geMountainLion ? "12px" : "18px";
      this.horiz.style.height = this.vert.style.width = w;
      this.horiz.style.pointerEvents = this.vert.style.pointerEvents = "none";
      this.disableHoriz = new Delayed;
      this.disableVert = new Delayed;
    },
    enableZeroWidthBar: function(bar, delay) {
      bar.style.pointerEvents = "auto";
      function maybeDisable() {
        // To find out whether the scrollbar is still visible, we
        // check whether the element under the pixel in the bottom
        // left corner of the scrollbar box is the scrollbar box
        // itself (when the bar is still visible) or its filler child
        // (when the bar is hidden). If it is still visible, we keep
        // it enabled, if it's hidden, we disable pointer events.
        var box = bar.getBoundingClientRect();
        var elt = document.elementFromPoint(box.left + 1, box.bottom - 1);
        if (elt != bar) bar.style.pointerEvents = "none";
        else delay.set(1000, maybeDisable);
      }
      delay.set(1000, maybeDisable);
    },
    clear: function() {
      var parent = this.horiz.parentNode;
      parent.removeChild(this.horiz);
      parent.removeChild(this.vert);
    }
  }, NativeScrollbars.prototype);

  function NullScrollbars() {}

  NullScrollbars.prototype = copyObj({
    update: function() { return {bottom: 0, right: 0}; },
    setScrollLeft: function() {},
    setScrollTop: function() {},
    clear: function() {}
  }, NullScrollbars.prototype);

  CodeMirror.scrollbarModel = {"native": NativeScrollbars, "null": NullScrollbars};

  function initScrollbars(cm) {
    if (cm.display.scrollbars) {
      cm.display.scrollbars.clear();
      if (cm.display.scrollbars.addClass)
        rmClass(cm.display.wrapper, cm.display.scrollbars.addClass);
    }

    cm.display.scrollbars = new CodeMirror.scrollbarModel[cm.options.scrollbarStyle](function(node) {
      cm.display.wrapper.insertBefore(node, cm.display.scrollbarFiller);
      // Prevent clicks in the scrollbars from killing focus
      on(node, "mousedown", function() {
        if (cm.state.focused) setTimeout(function() { cm.display.input.focus(); }, 0);
      });
      node.setAttribute("cm-not-content", "true");
    }, function(pos, axis) {
      if (axis == "horizontal") setScrollLeft(cm, pos);
      else setScrollTop(cm, pos);
    }, cm);
    if (cm.display.scrollbars.addClass)
      addClass(cm.display.wrapper, cm.display.scrollbars.addClass);
  }

  function updateScrollbars(cm, measure) {
    if (!measure) measure = measureForScrollbars(cm);
    var startWidth = cm.display.barWidth, startHeight = cm.display.barHeight;
    updateScrollbarsInner(cm, measure);
    for (var i = 0; i < 4 && startWidth != cm.display.barWidth || startHeight != cm.display.barHeight; i++) {
      if (startWidth != cm.display.barWidth && cm.options.lineWrapping)
        updateHeightsInViewport(cm);
      updateScrollbarsInner(cm, measureForScrollbars(cm));
      startWidth = cm.display.barWidth; startHeight = cm.display.barHeight;
    }
  }

  // Re-synchronize the fake scrollbars with the actual size of the
  // content.
  function updateScrollbarsInner(cm, measure) {
    var d = cm.display;
    var sizes = d.scrollbars.update(measure);

    d.sizer.style.paddingRight = (d.barWidth = sizes.right) + "px";
    d.sizer.style.paddingBottom = (d.barHeight = sizes.bottom) + "px";

    if (sizes.right && sizes.bottom) {
      d.scrollbarFiller.style.display = "block";
      d.scrollbarFiller.style.height = sizes.bottom + "px";
      d.scrollbarFiller.style.width = sizes.right + "px";
    } else d.scrollbarFiller.style.display = "";
    if (sizes.bottom && cm.options.coverGutterNextToScrollbar && cm.options.fixedGutter) {
      d.gutterFiller.style.display = "block";
      d.gutterFiller.style.height = sizes.bottom + "px";
      d.gutterFiller.style.width = measure.gutterWidth + "px";
    } else d.gutterFiller.style.display = "";
  }

  // Compute the lines that are visible in a given viewport (defaults
  // the the current scroll position). viewport may contain top,
  // height, and ensure (see op.scrollToPos) properties.
  function visibleLines(display, doc, viewport) {
    var top = viewport && viewport.top != null ? Math.max(0, viewport.top) : display.scroller.scrollTop;
    top = Math.floor(top - paddingTop(display));
    var bottom = viewport && viewport.bottom != null ? viewport.bottom : top + display.wrapper.clientHeight;

    var from = lineAtHeight(doc, top), to = lineAtHeight(doc, bottom);
    // Ensure is a {from: {line, ch}, to: {line, ch}} object, and
    // forces those lines into the viewport (if possible).
    if (viewport && viewport.ensure) {
      var ensureFrom = viewport.ensure.from.line, ensureTo = viewport.ensure.to.line;
      if (ensureFrom < from) {
        from = ensureFrom;
        to = lineAtHeight(doc, heightAtLine(getLine(doc, ensureFrom)) + display.wrapper.clientHeight);
      } else if (Math.min(ensureTo, doc.lastLine()) >= to) {
        from = lineAtHeight(doc, heightAtLine(getLine(doc, ensureTo)) - display.wrapper.clientHeight);
        to = ensureTo;
      }
    }
    return {from: from, to: Math.max(to, from + 1)};
  }

  // LINE NUMBERS

  // Re-align line numbers and gutter marks to compensate for
  // horizontal scrolling.
  function alignHorizontally(cm) {
    var display = cm.display, view = display.view;
    if (!display.alignWidgets && (!display.gutters.firstChild || !cm.options.fixedGutter)) return;
    var comp = compensateForHScroll(display) - display.scroller.scrollLeft + cm.doc.scrollLeft;
    var gutterW = display.gutters.offsetWidth, left = comp + "px";
    for (var i = 0; i < view.length; i++) if (!view[i].hidden) {
      if (cm.options.fixedGutter && view[i].gutter)
        view[i].gutter.style.left = left;
      var align = view[i].alignable;
      if (align) for (var j = 0; j < align.length; j++)
        align[j].style.left = left;
    }
    if (cm.options.fixedGutter)
      display.gutters.style.left = (comp + gutterW) + "px";
  }

  // Used to ensure that the line number gutter is still the right
  // size for the current document size. Returns true when an update
  // is needed.
  function maybeUpdateLineNumberWidth(cm) {
    if (!cm.options.lineNumbers) return false;
    var doc = cm.doc, last = lineNumberFor(cm.options, doc.first + doc.size - 1), display = cm.display;
    if (last.length != display.lineNumChars) {
      var test = display.measure.appendChild(elt("div", [elt("div", last)],
                                                 "CodeMirror-linenumber CodeMirror-gutter-elt"));
      var innerW = test.firstChild.offsetWidth, padding = test.offsetWidth - innerW;
      display.lineGutter.style.width = "";
      display.lineNumInnerWidth = Math.max(innerW, display.lineGutter.offsetWidth - padding) + 1;
      display.lineNumWidth = display.lineNumInnerWidth + padding;
      display.lineNumChars = display.lineNumInnerWidth ? last.length : -1;
      display.lineGutter.style.width = display.lineNumWidth + "px";
      updateGutterSpace(cm);
      return true;
    }
    return false;
  }

  function lineNumberFor(options, i) {
    return String(options.lineNumberFormatter(i + options.firstLineNumber));
  }

  // Computes display.scroller.scrollLeft + display.gutters.offsetWidth,
  // but using getBoundingClientRect to get a sub-pixel-accurate
  // result.
  function compensateForHScroll(display) {
    return display.scroller.getBoundingClientRect().left - display.sizer.getBoundingClientRect().left;
  }

  // DISPLAY DRAWING

  function DisplayUpdate(cm, viewport, force) {
    var display = cm.display;

    this.viewport = viewport;
    // Store some values that we'll need later (but don't want to force a relayout for)
    this.visible = visibleLines(display, cm.doc, viewport);
    this.editorIsHidden = !display.wrapper.offsetWidth;
    this.wrapperHeight = display.wrapper.clientHeight;
    this.wrapperWidth = display.wrapper.clientWidth;
    this.oldDisplayWidth = displayWidth(cm);
    this.force = force;
    this.dims = getDimensions(cm);
    this.events = [];
  }

  DisplayUpdate.prototype.signal = function(emitter, type) {
    if (hasHandler(emitter, type))
      this.events.push(arguments);
  };
  DisplayUpdate.prototype.finish = function() {
    for (var i = 0; i < this.events.length; i++)
      signal.apply(null, this.events[i]);
  };

  function maybeClipScrollbars(cm) {
    var display = cm.display;
    if (!display.scrollbarsClipped && display.scroller.offsetWidth) {
      display.nativeBarWidth = display.scroller.offsetWidth - display.scroller.clientWidth;
      display.heightForcer.style.height = scrollGap(cm) + "px";
      display.sizer.style.marginBottom = -display.nativeBarWidth + "px";
      display.sizer.style.borderRightWidth = scrollGap(cm) + "px";
      display.scrollbarsClipped = true;
    }
  }

  // Does the actual updating of the line display. Bails out
  // (returning false) when there is nothing to be done and forced is
  // false.
  function updateDisplayIfNeeded(cm, update) {
    var display = cm.display, doc = cm.doc;

    if (update.editorIsHidden) {
      resetView(cm);
      return false;
    }

    // Bail out if the visible area is already rendered and nothing changed.
    if (!update.force &&
        update.visible.from >= display.viewFrom && update.visible.to <= display.viewTo &&
        (display.updateLineNumbers == null || display.updateLineNumbers >= display.viewTo) &&
        display.renderedView == display.view && countDirtyView(cm) == 0)
      return false;

    if (maybeUpdateLineNumberWidth(cm)) {
      resetView(cm);
      update.dims = getDimensions(cm);
    }

    // Compute a suitable new viewport (from & to)
    var end = doc.first + doc.size;
    var from = Math.max(update.visible.from - cm.options.viewportMargin, doc.first);
    var to = Math.min(end, update.visible.to + cm.options.viewportMargin);
    if (display.viewFrom < from && from - display.viewFrom < 20) from = Math.max(doc.first, display.viewFrom);
    if (display.viewTo > to && display.viewTo - to < 20) to = Math.min(end, display.viewTo);
    if (sawCollapsedSpans) {
      from = visualLineNo(cm.doc, from);
      to = visualLineEndNo(cm.doc, to);
    }

    var different = from != display.viewFrom || to != display.viewTo ||
      display.lastWrapHeight != update.wrapperHeight || display.lastWrapWidth != update.wrapperWidth;
    adjustView(cm, from, to);

    display.viewOffset = heightAtLine(getLine(cm.doc, display.viewFrom));
    // Position the mover div to align with the current scroll position
    cm.display.mover.style.top = display.viewOffset + "px";

    var toUpdate = countDirtyView(cm);
    if (!different && toUpdate == 0 && !update.force && display.renderedView == display.view &&
        (display.updateLineNumbers == null || display.updateLineNumbers >= display.viewTo))
      return false;

    // For big changes, we hide the enclosing element during the
    // update, since that speeds up the operations on most browsers.
    var focused = activeElt();
    if (toUpdate > 4) display.lineDiv.style.display = "none";
    patchDisplay(cm, display.updateLineNumbers, update.dims);
    if (toUpdate > 4) display.lineDiv.style.display = "";
    display.renderedView = display.view;
    // There might have been a widget with a focused element that got
    // hidden or updated, if so re-focus it.
    if (focused && activeElt() != focused && focused.offsetHeight) focused.focus();

    // Prevent selection and cursors from interfering with the scroll
    // width and height.
    removeChildren(display.cursorDiv);
    removeChildren(display.selectionDiv);
    display.gutters.style.height = display.sizer.style.minHeight = 0;

    if (different) {
      display.lastWrapHeight = update.wrapperHeight;
      display.lastWrapWidth = update.wrapperWidth;
      startWorker(cm, 400);
    }

    display.updateLineNumbers = null;

    return true;
  }

  function postUpdateDisplay(cm, update) {
    var viewport = update.viewport;
    for (var first = true;; first = false) {
      if (!first || !cm.options.lineWrapping || update.oldDisplayWidth == displayWidth(cm)) {
        // Clip forced viewport to actual scrollable area.
        if (viewport && viewport.top != null)
          viewport = {top: Math.min(cm.doc.height + paddingVert(cm.display) - displayHeight(cm), viewport.top)};
        // Updated line heights might result in the drawn area not
        // actually covering the viewport. Keep looping until it does.
        update.visible = visibleLines(cm.display, cm.doc, viewport);
        if (update.visible.from >= cm.display.viewFrom && update.visible.to <= cm.display.viewTo)
          break;
      }
      if (!updateDisplayIfNeeded(cm, update)) break;
      updateHeightsInViewport(cm);
      var barMeasure = measureForScrollbars(cm);
      updateSelection(cm);
      setDocumentHeight(cm, barMeasure);
      updateScrollbars(cm, barMeasure);
    }

    update.signal(cm, "update", cm);
    if (cm.display.viewFrom != cm.display.reportedViewFrom || cm.display.viewTo != cm.display.reportedViewTo) {
      update.signal(cm, "viewportChange", cm, cm.display.viewFrom, cm.display.viewTo);
      cm.display.reportedViewFrom = cm.display.viewFrom; cm.display.reportedViewTo = cm.display.viewTo;
    }
  }

  function updateDisplaySimple(cm, viewport) {
    var update = new DisplayUpdate(cm, viewport);
    if (updateDisplayIfNeeded(cm, update)) {
      updateHeightsInViewport(cm);
      postUpdateDisplay(cm, update);
      var barMeasure = measureForScrollbars(cm);
      updateSelection(cm);
      setDocumentHeight(cm, barMeasure);
      updateScrollbars(cm, barMeasure);
      update.finish();
    }
  }

  function setDocumentHeight(cm, measure) {
    cm.display.sizer.style.minHeight = measure.docHeight + "px";
    var total = measure.docHeight + cm.display.barHeight;
    cm.display.heightForcer.style.top = total + "px";
    cm.display.gutters.style.height = Math.max(total + scrollGap(cm), measure.clientHeight) + "px";
  }

  // Read the actual heights of the rendered lines, and update their
  // stored heights to match.
  function updateHeightsInViewport(cm) {
    var display = cm.display;
    var prevBottom = display.lineDiv.offsetTop;
    for (var i = 0; i < display.view.length; i++) {
      var cur = display.view[i], height;
      if (cur.hidden) continue;
      if (ie && ie_version < 8) {
        var bot = cur.node.offsetTop + cur.node.offsetHeight;
        height = bot - prevBottom;
        prevBottom = bot;
      } else {
        var box = cur.node.getBoundingClientRect();
        height = box.bottom - box.top;
      }
      var diff = cur.line.height - height;
      if (height < 2) height = textHeight(display);
      if (diff > .001 || diff < -.001) {
        updateLineHeight(cur.line, height);
        updateWidgetHeight(cur.line);
        if (cur.rest) for (var j = 0; j < cur.rest.length; j++)
          updateWidgetHeight(cur.rest[j]);
      }
    }
  }

  // Read and store the height of line widgets associated with the
  // given line.
  function updateWidgetHeight(line) {
    if (line.widgets) for (var i = 0; i < line.widgets.length; ++i)
      line.widgets[i].height = line.widgets[i].node.parentNode.offsetHeight;
  }

  // Do a bulk-read of the DOM positions and sizes needed to draw the
  // view, so that we don't interleave reading and writing to the DOM.
  function getDimensions(cm) {
    var d = cm.display, left = {}, width = {};
    var gutterLeft = d.gutters.clientLeft;
    for (var n = d.gutters.firstChild, i = 0; n; n = n.nextSibling, ++i) {
      left[cm.options.gutters[i]] = n.offsetLeft + n.clientLeft + gutterLeft;
      width[cm.options.gutters[i]] = n.clientWidth;
    }
    return {fixedPos: compensateForHScroll(d),
            gutterTotalWidth: d.gutters.offsetWidth,
            gutterLeft: left,
            gutterWidth: width,
            wrapperWidth: d.wrapper.clientWidth};
  }

  // Sync the actual display DOM structure with display.view, removing
  // nodes for lines that are no longer in view, and creating the ones
  // that are not there yet, and updating the ones that are out of
  // date.
  function patchDisplay(cm, updateNumbersFrom, dims) {
    var display = cm.display, lineNumbers = cm.options.lineNumbers;
    var container = display.lineDiv, cur = container.firstChild;

    function rm(node) {
      var next = node.nextSibling;
      // Works around a throw-scroll bug in OS X Webkit
      if (webkit && mac && cm.display.currentWheelTarget == node)
        node.style.display = "none";
      else
        node.parentNode.removeChild(node);
      return next;
    }

    var view = display.view, lineN = display.viewFrom;
    // Loop over the elements in the view, syncing cur (the DOM nodes
    // in display.lineDiv) with the view as we go.
    for (var i = 0; i < view.length; i++) {
      var lineView = view[i];
      if (lineView.hidden) {
      } else if (!lineView.node || lineView.node.parentNode != container) { // Not drawn yet
        var node = buildLineElement(cm, lineView, lineN, dims);
        container.insertBefore(node, cur);
      } else { // Already drawn
        while (cur != lineView.node) cur = rm(cur);
        var updateNumber = lineNumbers && updateNumbersFrom != null &&
          updateNumbersFrom <= lineN && lineView.lineNumber;
        if (lineView.changes) {
          if (indexOf(lineView.changes, "gutter") > -1) updateNumber = false;
          updateLineForChanges(cm, lineView, lineN, dims);
        }
        if (updateNumber) {
          removeChildren(lineView.lineNumber);
          lineView.lineNumber.appendChild(document.createTextNode(lineNumberFor(cm.options, lineN)));
        }
        cur = lineView.node.nextSibling;
      }
      lineN += lineView.size;
    }
    while (cur) cur = rm(cur);
  }

  // When an aspect of a line changes, a string is added to
  // lineView.changes. This updates the relevant part of the line's
  // DOM structure.
  function updateLineForChanges(cm, lineView, lineN, dims) {
    for (var j = 0; j < lineView.changes.length; j++) {
      var type = lineView.changes[j];
      if (type == "text") updateLineText(cm, lineView);
      else if (type == "gutter") updateLineGutter(cm, lineView, lineN, dims);
      else if (type == "class") updateLineClasses(lineView);
      else if (type == "widget") updateLineWidgets(cm, lineView, dims);
    }
    lineView.changes = null;
  }

  // Lines with gutter elements, widgets or a background class need to
  // be wrapped, and have the extra elements added to the wrapper div
  function ensureLineWrapped(lineView) {
    if (lineView.node == lineView.text) {
      lineView.node = elt("div", null, null, "position: relative");
      if (lineView.text.parentNode)
        lineView.text.parentNode.replaceChild(lineView.node, lineView.text);
      lineView.node.appendChild(lineView.text);
      if (ie && ie_version < 8) lineView.node.style.zIndex = 2;
    }
    return lineView.node;
  }

  function updateLineBackground(lineView) {
    var cls = lineView.bgClass ? lineView.bgClass + " " + (lineView.line.bgClass || "") : lineView.line.bgClass;
    if (cls) cls += " CodeMirror-linebackground";
    if (lineView.background) {
      if (cls) lineView.background.className = cls;
      else { lineView.background.parentNode.removeChild(lineView.background); lineView.background = null; }
    } else if (cls) {
      var wrap = ensureLineWrapped(lineView);
      lineView.background = wrap.insertBefore(elt("div", null, cls), wrap.firstChild);
    }
  }

  // Wrapper around buildLineContent which will reuse the structure
  // in display.externalMeasured when possible.
  function getLineContent(cm, lineView) {
    var ext = cm.display.externalMeasured;
    if (ext && ext.line == lineView.line) {
      cm.display.externalMeasured = null;
      lineView.measure = ext.measure;
      return ext.built;
    }
    return buildLineContent(cm, lineView);
  }

  // Redraw the line's text. Interacts with the background and text
  // classes because the mode may output tokens that influence these
  // classes.
  function updateLineText(cm, lineView) {
    var cls = lineView.text.className;
    var built = getLineContent(cm, lineView);
    if (lineView.text == lineView.node) lineView.node = built.pre;
    lineView.text.parentNode.replaceChild(built.pre, lineView.text);
    lineView.text = built.pre;
    if (built.bgClass != lineView.bgClass || built.textClass != lineView.textClass) {
      lineView.bgClass = built.bgClass;
      lineView.textClass = built.textClass;
      updateLineClasses(lineView);
    } else if (cls) {
      lineView.text.className = cls;
    }
  }

  function updateLineClasses(lineView) {
    updateLineBackground(lineView);
    if (lineView.line.wrapClass)
      ensureLineWrapped(lineView).className = lineView.line.wrapClass;
    else if (lineView.node != lineView.text)
      lineView.node.className = "";
    var textClass = lineView.textClass ? lineView.textClass + " " + (lineView.line.textClass || "") : lineView.line.textClass;
    lineView.text.className = textClass || "";
  }

  function updateLineGutter(cm, lineView, lineN, dims) {
    if (lineView.gutter) {
      lineView.node.removeChild(lineView.gutter);
      lineView.gutter = null;
    }
    if (lineView.gutterBackground) {
      lineView.node.removeChild(lineView.gutterBackground);
      lineView.gutterBackground = null;
    }
    if (lineView.line.gutterClass) {
      var wrap = ensureLineWrapped(lineView);
      lineView.gutterBackground = elt("div", null, "CodeMirror-gutter-background " + lineView.line.gutterClass,
                                      "left: " + (cm.options.fixedGutter ? dims.fixedPos : -dims.gutterTotalWidth) +
                                      "px; width: " + dims.gutterTotalWidth + "px");
      wrap.insertBefore(lineView.gutterBackground, lineView.text);
    }
    var markers = lineView.line.gutterMarkers;
    if (cm.options.lineNumbers || markers) {
      var wrap = ensureLineWrapped(lineView);
      var gutterWrap = lineView.gutter = elt("div", null, "CodeMirror-gutter-wrapper", "left: " +
                                             (cm.options.fixedGutter ? dims.fixedPos : -dims.gutterTotalWidth) + "px");
      cm.display.input.setUneditable(gutterWrap);
      wrap.insertBefore(gutterWrap, lineView.text);
      if (lineView.line.gutterClass)
        gutterWrap.className += " " + lineView.line.gutterClass;
      if (cm.options.lineNumbers && (!markers || !markers["CodeMirror-linenumbers"]))
        lineView.lineNumber = gutterWrap.appendChild(
          elt("div", lineNumberFor(cm.options, lineN),
              "CodeMirror-linenumber CodeMirror-gutter-elt",
              "left: " + dims.gutterLeft["CodeMirror-linenumbers"] + "px; width: "
              + cm.display.lineNumInnerWidth + "px"));
      if (markers) for (var k = 0; k < cm.options.gutters.length; ++k) {
        var id = cm.options.gutters[k], found = markers.hasOwnProperty(id) && markers[id];
        if (found)
          gutterWrap.appendChild(elt("div", [found], "CodeMirror-gutter-elt", "left: " +
                                     dims.gutterLeft[id] + "px; width: " + dims.gutterWidth[id] + "px"));
      }
    }
  }

  function updateLineWidgets(cm, lineView, dims) {
    if (lineView.alignable) lineView.alignable = null;
    for (var node = lineView.node.firstChild, next; node; node = next) {
      var next = node.nextSibling;
      if (node.className == "CodeMirror-linewidget")
        lineView.node.removeChild(node);
    }
    insertLineWidgets(cm, lineView, dims);
  }

  // Build a line's DOM representation from scratch
  function buildLineElement(cm, lineView, lineN, dims) {
    var built = getLineContent(cm, lineView);
    lineView.text = lineView.node = built.pre;
    if (built.bgClass) lineView.bgClass = built.bgClass;
    if (built.textClass) lineView.textClass = built.textClass;

    updateLineClasses(lineView);
    updateLineGutter(cm, lineView, lineN, dims);
    insertLineWidgets(cm, lineView, dims);
    return lineView.node;
  }

  // A lineView may contain multiple logical lines (when merged by
  // collapsed spans). The widgets for all of them need to be drawn.
  function insertLineWidgets(cm, lineView, dims) {
    insertLineWidgetsFor(cm, lineView.line, lineView, dims, true);
    if (lineView.rest) for (var i = 0; i < lineView.rest.length; i++)
      insertLineWidgetsFor(cm, lineView.rest[i], lineView, dims, false);
  }

  function insertLineWidgetsFor(cm, line, lineView, dims, allowAbove) {
    if (!line.widgets) return;
    var wrap = ensureLineWrapped(lineView);
    for (var i = 0, ws = line.widgets; i < ws.length; ++i) {
      var widget = ws[i], node = elt("div", [widget.node], "CodeMirror-linewidget");
      if (!widget.handleMouseEvents) node.setAttribute("cm-ignore-events", "true");
      positionLineWidget(widget, node, lineView, dims);
      cm.display.input.setUneditable(node);
      if (allowAbove && widget.above)
        wrap.insertBefore(node, lineView.gutter || lineView.text);
      else
        wrap.appendChild(node);
      signalLater(widget, "redraw");
    }
  }

  function positionLineWidget(widget, node, lineView, dims) {
    if (widget.noHScroll) {
      (lineView.alignable || (lineView.alignable = [])).push(node);
      var width = dims.wrapperWidth;
      node.style.left = dims.fixedPos + "px";
      if (!widget.coverGutter) {
        width -= dims.gutterTotalWidth;
        node.style.paddingLeft = dims.gutterTotalWidth + "px";
      }
      node.style.width = width + "px";
    }
    if (widget.coverGutter) {
      node.style.zIndex = 5;
      node.style.position = "relative";
      if (!widget.noHScroll) node.style.marginLeft = -dims.gutterTotalWidth + "px";
    }
  }

  // POSITION OBJECT

  // A Pos instance represents a position within the text.
  var Pos = CodeMirror.Pos = function(line, ch) {
    if (!(this instanceof Pos)) return new Pos(line, ch);
    this.line = line; this.ch = ch;
  };

  // Compare two positions, return 0 if they are the same, a negative
  // number when a is less, and a positive number otherwise.
  var cmp = CodeMirror.cmpPos = function(a, b) { return a.line - b.line || a.ch - b.ch; };

  function copyPos(x) {return Pos(x.line, x.ch);}
  function maxPos(a, b) { return cmp(a, b) < 0 ? b : a; }
  function minPos(a, b) { return cmp(a, b) < 0 ? a : b; }

  // INPUT HANDLING

  function ensureFocus(cm) {
    if (!cm.state.focused) { cm.display.input.focus(); onFocus(cm); }
  }

  // This will be set to an array of strings when copying, so that,
  // when pasting, we know what kind of selections the copied text
  // was made out of.
  var lastCopied = null;

  function applyTextInput(cm, inserted, deleted, sel, origin) {
    var doc = cm.doc;
    cm.display.shift = false;
    if (!sel) sel = doc.sel;

    var paste = cm.state.pasteIncoming || origin == "paste";
    var textLines = doc.splitLines(inserted), multiPaste = null;
    // When pasing N lines into N selections, insert one line per selection
    if (paste && sel.ranges.length > 1) {
      if (lastCopied && lastCopied.join("\n") == inserted) {
        if (sel.ranges.length % lastCopied.length == 0) {
          multiPaste = [];
          for (var i = 0; i < lastCopied.length; i++)
            multiPaste.push(doc.splitLines(lastCopied[i]));
        }
      } else if (textLines.length == sel.ranges.length) {
        multiPaste = map(textLines, function(l) { return [l]; });
      }
    }

    // Normal behavior is to insert the new text into every selection
    for (var i = sel.ranges.length - 1; i >= 0; i--) {
      var range = sel.ranges[i];
      var from = range.from(), to = range.to();
      if (range.empty()) {
        if (deleted && deleted > 0) // Handle deletion
          from = Pos(from.line, from.ch - deleted);
        else if (cm.state.overwrite && !paste) // Handle overwrite
          to = Pos(to.line, Math.min(getLine(doc, to.line).text.length, to.ch + lst(textLines).length));
      }
      var updateInput = cm.curOp.updateInput;
      var changeEvent = {from: from, to: to, text: multiPaste ? multiPaste[i % multiPaste.length] : textLines,
                         origin: origin || (paste ? "paste" : cm.state.cutIncoming ? "cut" : "+input")};
      makeChange(cm.doc, changeEvent);
      signalLater(cm, "inputRead", cm, changeEvent);
    }
    if (inserted && !paste)
      triggerElectric(cm, inserted);

    ensureCursorVisible(cm);
    cm.curOp.updateInput = updateInput;
    cm.curOp.typing = true;
    cm.state.pasteIncoming = cm.state.cutIncoming = false;
  }

  function handlePaste(e, cm) {
    var pasted = e.clipboardData && e.clipboardData.getData("text/plain");
    if (pasted) {
      e.preventDefault();
      if (!cm.isReadOnly() && !cm.options.disableInput)
        runInOp(cm, function() { applyTextInput(cm, pasted, 0, null, "paste"); });
      return true;
    }
  }

  function triggerElectric(cm, inserted) {
    // When an 'electric' character is inserted, immediately trigger a reindent
    if (!cm.options.electricChars || !cm.options.smartIndent) return;
    var sel = cm.doc.sel;

    for (var i = sel.ranges.length - 1; i >= 0; i--) {
      var range = sel.ranges[i];
      if (range.head.ch > 100 || (i && sel.ranges[i - 1].head.line == range.head.line)) continue;
      var mode = cm.getModeAt(range.head);
      var indented = false;
      if (mode.electricChars) {
        for (var j = 0; j < mode.electricChars.length; j++)
          if (inserted.indexOf(mode.electricChars.charAt(j)) > -1) {
            indented = indentLine(cm, range.head.line, "smart");
            break;
          }
      } else if (mode.electricInput) {
        if (mode.electricInput.test(getLine(cm.doc, range.head.line).text.slice(0, range.head.ch)))
          indented = indentLine(cm, range.head.line, "smart");
      }
      if (indented) signalLater(cm, "electricInput", cm, range.head.line);
    }
  }

  function copyableRanges(cm) {
    var text = [], ranges = [];
    for (var i = 0; i < cm.doc.sel.ranges.length; i++) {
      var line = cm.doc.sel.ranges[i].head.line;
      var lineRange = {anchor: Pos(line, 0), head: Pos(line + 1, 0)};
      ranges.push(lineRange);
      text.push(cm.getRange(lineRange.anchor, lineRange.head));
    }
    return {text: text, ranges: ranges};
  }

  function disableBrowserMagic(field) {
    field.setAttribute("autocorrect", "off");
    field.setAttribute("autocapitalize", "off");
    field.setAttribute("spellcheck", "false");
  }

  // TEXTAREA INPUT STYLE

  function TextareaInput(cm) {
    this.cm = cm;
    // See input.poll and input.reset
    this.prevInput = "";

    // Flag that indicates whether we expect input to appear real soon
    // now (after some event like 'keypress' or 'input') and are
    // polling intensively.
    this.pollingFast = false;
    // Self-resetting timeout for the poller
    this.polling = new Delayed();
    // Tracks when input.reset has punted to just putting a short
    // string into the textarea instead of the full selection.
    this.inaccurateSelection = false;
    // Used to work around IE issue with selection being forgotten when focus moves away from textarea
    this.hasSelection = false;
    this.composing = null;
  };

  function hiddenTextarea() {
    var te = elt("textarea", null, null, "position: absolute; padding: 0; width: 1px; height: 1em; outline: none");
    var div = elt("div", [te], null, "overflow: hidden; position: relative; width: 3px; height: 0px;");
    // The textarea is kept positioned near the cursor to prevent the
    // fact that it'll be scrolled into view on input from scrolling
    // our fake cursor out of view. On webkit, when wrap=off, paste is
    // very slow. So make the area wide instead.
    if (webkit) te.style.width = "1000px";
    else te.setAttribute("wrap", "off");
    // If border: 0; -- iOS fails to open keyboard (issue #1287)
    if (ios) te.style.border = "1px solid black";
    disableBrowserMagic(te);
    return div;
  }

  TextareaInput.prototype = copyObj({
    init: function(display) {
      var input = this, cm = this.cm;

      // Wraps and hides input textarea
      var div = this.wrapper = hiddenTextarea();
      // The semihidden textarea that is focused when the editor is
      // focused, and receives input.
      var te = this.textarea = div.firstChild;
      display.wrapper.insertBefore(div, display.wrapper.firstChild);

      // Needed to hide big blue blinking cursor on Mobile Safari (doesn't seem to work in iOS 8 anymore)
      if (ios) te.style.width = "0px";

      on(te, "input", function() {
        if (ie && ie_version >= 9 && input.hasSelection) input.hasSelection = null;
        input.poll();
      });

      on(te, "paste", function(e) {
        if (signalDOMEvent(cm, e) || handlePaste(e, cm)) return

        cm.state.pasteIncoming = true;
        input.fastPoll();
      });

      function prepareCopyCut(e) {
        if (signalDOMEvent(cm, e)) return
        if (cm.somethingSelected()) {
          lastCopied = cm.getSelections();
          if (input.inaccurateSelection) {
            input.prevInput = "";
            input.inaccurateSelection = false;
            te.value = lastCopied.join("\n");
            selectInput(te);
          }
        } else if (!cm.options.lineWiseCopyCut) {
          return;
        } else {
          var ranges = copyableRanges(cm);
          lastCopied = ranges.text;
          if (e.type == "cut") {
            cm.setSelections(ranges.ranges, null, sel_dontScroll);
          } else {
            input.prevInput = "";
            te.value = ranges.text.join("\n");
            selectInput(te);
          }
        }
        if (e.type == "cut") cm.state.cutIncoming = true;
      }
      on(te, "cut", prepareCopyCut);
      on(te, "copy", prepareCopyCut);

      on(display.scroller, "paste", function(e) {
        if (eventInWidget(display, e) || signalDOMEvent(cm, e)) return;
        cm.state.pasteIncoming = true;
        input.focus();
      });

      // Prevent normal selection in the editor (we handle our own)
      on(display.lineSpace, "selectstart", function(e) {
        if (!eventInWidget(display, e)) e_preventDefault(e);
      });

      on(te, "compositionstart", function() {
        var start = cm.getCursor("from");
        if (input.composing) input.composing.range.clear()
        input.composing = {
          start: start,
          range: cm.markText(start, cm.getCursor("to"), {className: "CodeMirror-composing"})
        };
      });
      on(te, "compositionend", function() {
        if (input.composing) {
          input.poll();
          input.composing.range.clear();
          input.composing = null;
        }
      });
    },

    prepareSelection: function() {
      // Redraw the selection and/or cursor
      var cm = this.cm, display = cm.display, doc = cm.doc;
      var result = prepareSelection(cm);

      // Move the hidden textarea near the cursor to prevent scrolling artifacts
      if (cm.options.moveInputWithCursor) {
        var headPos = cursorCoords(cm, doc.sel.primary().head, "div");
        var wrapOff = display.wrapper.getBoundingClientRect(), lineOff = display.lineDiv.getBoundingClientRect();
        result.teTop = Math.max(0, Math.min(display.wrapper.clientHeight - 10,
                                            headPos.top + lineOff.top - wrapOff.top));
        result.teLeft = Math.max(0, Math.min(display.wrapper.clientWidth - 10,
                                             headPos.left + lineOff.left - wrapOff.left));
      }

      return result;
    },

    showSelection: function(drawn) {
      var cm = this.cm, display = cm.display;
      removeChildrenAndAdd(display.cursorDiv, drawn.cursors);
      removeChildrenAndAdd(display.selectionDiv, drawn.selection);
      if (drawn.teTop != null) {
        this.wrapper.style.top = drawn.teTop + "px";
        this.wrapper.style.left = drawn.teLeft + "px";
      }
    },

    // Reset the input to correspond to the selection (or to be empty,
    // when not typing and nothing is selected)
    reset: function(typing) {
      if (this.contextMenuPending) return;
      var minimal, selected, cm = this.cm, doc = cm.doc;
      if (cm.somethingSelected()) {
        this.prevInput = "";
        var range = doc.sel.primary();
        minimal = hasCopyEvent &&
          (range.to().line - range.from().line > 100 || (selected = cm.getSelection()).length > 1000);
        var content = minimal ? "-" : selected || cm.getSelection();
        this.textarea.value = content;
        if (cm.state.focused) selectInput(this.textarea);
        if (ie && ie_version >= 9) this.hasSelection = content;
      } else if (!typing) {
        this.prevInput = this.textarea.value = "";
        if (ie && ie_version >= 9) this.hasSelection = null;
      }
      this.inaccurateSelection = minimal;
    },

    getField: function() { return this.textarea; },

    supportsTouch: function() { return false; },

    focus: function() {
      if (this.cm.options.readOnly != "nocursor" && (!mobile || activeElt() != this.textarea)) {
        try { this.textarea.focus(); }
        catch (e) {} // IE8 will throw if the textarea is display: none or not in DOM
      }
    },

    blur: function() { this.textarea.blur(); },

    resetPosition: function() {
      this.wrapper.style.top = this.wrapper.style.left = 0;
    },

    receivedFocus: function() { this.slowPoll(); },

    // Poll for input changes, using the normal rate of polling. This
    // runs as long as the editor is focused.
    slowPoll: function() {
      var input = this;
      if (input.pollingFast) return;
      input.polling.set(this.cm.options.pollInterval, function() {
        input.poll();
        if (input.cm.state.focused) input.slowPoll();
      });
    },

    // When an event has just come in that is likely to add or change
    // something in the input textarea, we poll faster, to ensure that
    // the change appears on the screen quickly.
    fastPoll: function() {
      var missed = false, input = this;
      input.pollingFast = true;
      function p() {
        var changed = input.poll();
        if (!changed && !missed) {missed = true; input.polling.set(60, p);}
        else {input.pollingFast = false; input.slowPoll();}
      }
      input.polling.set(20, p);
    },

    // Read input from the textarea, and update the document to match.
    // When something is selected, it is present in the textarea, and
    // selected (unless it is huge, in which case a placeholder is
    // used). When nothing is selected, the cursor sits after previously
    // seen text (can be empty), which is stored in prevInput (we must
    // not reset the textarea when typing, because that breaks IME).
    poll: function() {
      var cm = this.cm, input = this.textarea, prevInput = this.prevInput;
      // Since this is called a *lot*, try to bail out as cheaply as
      // possible when it is clear that nothing happened. hasSelection
      // will be the case when there is a lot of text in the textarea,
      // in which case reading its value would be expensive.
      if (this.contextMenuPending || !cm.state.focused ||
          (hasSelection(input) && !prevInput && !this.composing) ||
          cm.isReadOnly() || cm.options.disableInput || cm.state.keySeq)
        return false;

      var text = input.value;
      // If nothing changed, bail.
      if (text == prevInput && !cm.somethingSelected()) return false;
      // Work around nonsensical selection resetting in IE9/10, and
      // inexplicable appearance of private area unicode characters on
      // some key combos in Mac (#2689).
      if (ie && ie_version >= 9 && this.hasSelection === text ||
          mac && /[\uf700-\uf7ff]/.test(text)) {
        cm.display.input.reset();
        return false;
      }

      if (cm.doc.sel == cm.display.selForContextMenu) {
        var first = text.charCodeAt(0);
        if (first == 0x200b && !prevInput) prevInput = "\u200b";
        if (first == 0x21da) { this.reset(); return this.cm.execCommand("undo"); }
      }
      // Find the part of the input that is actually new
      var same = 0, l = Math.min(prevInput.length, text.length);
      while (same < l && prevInput.charCodeAt(same) == text.charCodeAt(same)) ++same;

      var self = this;
      runInOp(cm, function() {
        applyTextInput(cm, text.slice(same), prevInput.length - same,
                       null, self.composing ? "*compose" : null);

        // Don't leave long text in the textarea, since it makes further polling slow
        if (text.length > 1000 || text.indexOf("\n") > -1) input.value = self.prevInput = "";
        else self.prevInput = text;

        if (self.composing) {
          self.composing.range.clear();
          self.composing.range = cm.markText(self.composing.start, cm.getCursor("to"),
                                             {className: "CodeMirror-composing"});
        }
      });
      return true;
    },

    ensurePolled: function() {
      if (this.pollingFast && this.poll()) this.pollingFast = false;
    },

    onKeyPress: function() {
      if (ie && ie_version >= 9) this.hasSelection = null;
      this.fastPoll();
    },

    onContextMenu: function(e) {
      var input = this, cm = input.cm, display = cm.display, te = input.textarea;
      var pos = posFromMouse(cm, e), scrollPos = display.scroller.scrollTop;
      if (!pos || presto) return; // Opera is difficult.

      // Reset the current text selection only if the click is done outside of the selection
      // and 'resetSelectionOnContextMenu' option is true.
      var reset = cm.options.resetSelectionOnContextMenu;
      if (reset && cm.doc.sel.contains(pos) == -1)
        operation(cm, setSelection)(cm.doc, simpleSelection(pos), sel_dontScroll);

      var oldCSS = te.style.cssText;
      input.wrapper.style.position = "absolute";
      te.style.cssText = "position: fixed; width: 30px; height: 30px; top: " + (e.clientY - 5) +
        "px; left: " + (e.clientX - 5) + "px; z-index: 1000; background: " +
        (ie ? "rgba(255, 255, 255, .05)" : "transparent") +
        "; outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);";
      if (webkit) var oldScrollY = window.scrollY; // Work around Chrome issue (#2712)
      display.input.focus();
      if (webkit) window.scrollTo(null, oldScrollY);
      display.input.reset();
      // Adds "Select all" to context menu in FF
      if (!cm.somethingSelected()) te.value = input.prevInput = " ";
      input.contextMenuPending = true;
      display.selForContextMenu = cm.doc.sel;
      clearTimeout(display.detectingSelectAll);

      // Select-all will be greyed out if there's nothing to select, so
      // this adds a zero-width space so that we can later check whether
      // it got selected.
      function prepareSelectAllHack() {
        if (te.selectionStart != null) {
          var selected = cm.somethingSelected();
          var extval = "\u200b" + (selected ? te.value : "");
          te.value = "\u21da"; // Used to catch context-menu undo
          te.value = extval;
          input.prevInput = selected ? "" : "\u200b";
          te.selectionStart = 1; te.selectionEnd = extval.length;
          // Re-set this, in case some other handler touched the
          // selection in the meantime.
          display.selForContextMenu = cm.doc.sel;
        }
      }
      function rehide() {
        input.contextMenuPending = false;
        input.wrapper.style.position = "relative";
        te.style.cssText = oldCSS;
        if (ie && ie_version < 9) display.scrollbars.setScrollTop(display.scroller.scrollTop = scrollPos);

        // Try to detect the user choosing select-all
        if (te.selectionStart != null) {
          if (!ie || (ie && ie_version < 9)) prepareSelectAllHack();
          var i = 0, poll = function() {
            if (display.selForContextMenu == cm.doc.sel && te.selectionStart == 0 &&
                te.selectionEnd > 0 && input.prevInput == "\u200b")
              operation(cm, commands.selectAll)(cm);
            else if (i++ < 10) display.detectingSelectAll = setTimeout(poll, 500);
            else display.input.reset();
          };
          display.detectingSelectAll = setTimeout(poll, 200);
        }
      }

      if (ie && ie_version >= 9) prepareSelectAllHack();
      if (captureRightClick) {
        e_stop(e);
        var mouseup = function() {
          off(window, "mouseup", mouseup);
          setTimeout(rehide, 20);
        };
        on(window, "mouseup", mouseup);
      } else {
        setTimeout(rehide, 50);
      }
    },

    readOnlyChanged: function(val) {
      if (!val) this.reset();
    },

    setUneditable: nothing,

    needsContentAttribute: false
  }, TextareaInput.prototype);

  // CONTENTEDITABLE INPUT STYLE

  function ContentEditableInput(cm) {
    this.cm = cm;
    this.lastAnchorNode = this.lastAnchorOffset = this.lastFocusNode = this.lastFocusOffset = null;
    this.polling = new Delayed();
    this.gracePeriod = false;
  }

  ContentEditableInput.prototype = copyObj({
    init: function(display) {
      var input = this, cm = input.cm;
      var div = input.div = display.lineDiv;
      disableBrowserMagic(div);

      on(div, "paste", function(e) {
        if (!signalDOMEvent(cm, e)) handlePaste(e, cm);
      })

      on(div, "compositionstart", function(e) {
        var data = e.data;
        input.composing = {sel: cm.doc.sel, data: data, startData: data};
        if (!data) return;
        var prim = cm.doc.sel.primary();
        var line = cm.getLine(prim.head.line);
        var found = line.indexOf(data, Math.max(0, prim.head.ch - data.length));
        if (found > -1 && found <= prim.head.ch)
          input.composing.sel = simpleSelection(Pos(prim.head.line, found),
                                                Pos(prim.head.line, found + data.length));
      });
      on(div, "compositionupdate", function(e) {
        input.composing.data = e.data;
      });
      on(div, "compositionend", function(e) {
        var ours = input.composing;
        if (!ours) return;
        if (e.data != ours.startData && !/\u200b/.test(e.data))
          ours.data = e.data;
        // Need a small delay to prevent other code (input event,
        // selection polling) from doing damage when fired right after
        // compositionend.
        setTimeout(function() {
          if (!ours.handled)
            input.applyComposition(ours);
          if (input.composing == ours)
            input.composing = null;
        }, 50);
      });

      on(div, "touchstart", function() {
        input.forceCompositionEnd();
      });

      on(div, "input", function() {
        if (input.composing) return;
        if (cm.isReadOnly() || !input.pollContent())
          runInOp(input.cm, function() {regChange(cm);});
      });

      function onCopyCut(e) {
        if (signalDOMEvent(cm, e)) return
        if (cm.somethingSelected()) {
          lastCopied = cm.getSelections();
          if (e.type == "cut") cm.replaceSelection("", null, "cut");
        } else if (!cm.options.lineWiseCopyCut) {
          return;
        } else {
          var ranges = copyableRanges(cm);
          lastCopied = ranges.text;
          if (e.type == "cut") {
            cm.operation(function() {
              cm.setSelections(ranges.ranges, 0, sel_dontScroll);
              cm.replaceSelection("", null, "cut");
            });
          }
        }
        // iOS exposes the clipboard API, but seems to discard content inserted into it
        if (e.clipboardData && !ios) {
          e.preventDefault();
          e.clipboardData.clearData();
          e.clipboardData.setData("text/plain", lastCopied.join("\n"));
        } else {
          // Old-fashioned briefly-focus-a-textarea hack
          var kludge = hiddenTextarea(), te = kludge.firstChild;
          cm.display.lineSpace.insertBefore(kludge, cm.display.lineSpace.firstChild);
          te.value = lastCopied.join("\n");
          var hadFocus = document.activeElement;
          selectInput(te);
          setTimeout(function() {
            cm.display.lineSpace.removeChild(kludge);
            hadFocus.focus();
          }, 50);
        }
      }
      on(div, "copy", onCopyCut);
      on(div, "cut", onCopyCut);
    },

    prepareSelection: function() {
      var result = prepareSelection(this.cm, false);
      result.focus = this.cm.state.focused;
      return result;
    },

    showSelection: function(info) {
      if (!info || !this.cm.display.view.length) return;
      if (info.focus) this.showPrimarySelection();
      this.showMultipleSelections(info);
    },

    showPrimarySelection: function() {
      var sel = window.getSelection(), prim = this.cm.doc.sel.primary();
      var curAnchor = domToPos(this.cm, sel.anchorNode, sel.anchorOffset);
      var curFocus = domToPos(this.cm, sel.focusNode, sel.focusOffset);
      if (curAnchor && !curAnchor.bad && curFocus && !curFocus.bad &&
          cmp(minPos(curAnchor, curFocus), prim.from()) == 0 &&
          cmp(maxPos(curAnchor, curFocus), prim.to()) == 0)
        return;

      var start = posToDOM(this.cm, prim.from());
      var end = posToDOM(this.cm, prim.to());
      if (!start && !end) return;

      var view = this.cm.display.view;
      var old = sel.rangeCount && sel.getRangeAt(0);
      if (!start) {
        start = {node: view[0].measure.map[2], offset: 0};
      } else if (!end) { // FIXME dangerously hacky
        var measure = view[view.length - 1].measure;
        var map = measure.maps ? measure.maps[measure.maps.length - 1] : measure.map;
        end = {node: map[map.length - 1], offset: map[map.length - 2] - map[map.length - 3]};
      }

      try { var rng = range(start.node, start.offset, end.offset, end.node); }
      catch(e) {} // Our model of the DOM might be outdated, in which case the range we try to set can be impossible
      if (rng) {
        if (!gecko && this.cm.state.focused) {
          sel.collapse(start.node, start.offset);
          if (!rng.collapsed) sel.addRange(rng);
        } else {
          sel.removeAllRanges();
          sel.addRange(rng);
        }
        if (old && sel.anchorNode == null) sel.addRange(old);
        else if (gecko) this.startGracePeriod();
      }
      this.rememberSelection();
    },

    startGracePeriod: function() {
      var input = this;
      clearTimeout(this.gracePeriod);
      this.gracePeriod = setTimeout(function() {
        input.gracePeriod = false;
        if (input.selectionChanged())
          input.cm.operation(function() { input.cm.curOp.selectionChanged = true; });
      }, 20);
    },

    showMultipleSelections: function(info) {
      removeChildrenAndAdd(this.cm.display.cursorDiv, info.cursors);
      removeChildrenAndAdd(this.cm.display.selectionDiv, info.selection);
    },

    rememberSelection: function() {
      var sel = window.getSelection();
      this.lastAnchorNode = sel.anchorNode; this.lastAnchorOffset = sel.anchorOffset;
      this.lastFocusNode = sel.focusNode; this.lastFocusOffset = sel.focusOffset;
    },

    selectionInEditor: function() {
      var sel = window.getSelection();
      if (!sel.rangeCount) return false;
      var node = sel.getRangeAt(0).commonAncestorContainer;
      return contains(this.div, node);
    },

    focus: function() {
      if (this.cm.options.readOnly != "nocursor") this.div.focus();
    },
    blur: function() { this.div.blur(); },
    getField: function() { return this.div; },

    supportsTouch: function() { return true; },

    receivedFocus: function() {
      var input = this;
      if (this.selectionInEditor())
        this.pollSelection();
      else
        runInOp(this.cm, function() { input.cm.curOp.selectionChanged = true; });

      function poll() {
        if (input.cm.state.focused) {
          input.pollSelection();
          input.polling.set(input.cm.options.pollInterval, poll);
        }
      }
      this.polling.set(this.cm.options.pollInterval, poll);
    },

    selectionChanged: function() {
      var sel = window.getSelection();
      return sel.anchorNode != this.lastAnchorNode || sel.anchorOffset != this.lastAnchorOffset ||
        sel.focusNode != this.lastFocusNode || sel.focusOffset != this.lastFocusOffset;
    },

    pollSelection: function() {
      if (!this.composing && !this.gracePeriod && this.selectionChanged()) {
        var sel = window.getSelection(), cm = this.cm;
        this.rememberSelection();
        var anchor = domToPos(cm, sel.anchorNode, sel.anchorOffset);
        var head = domToPos(cm, sel.focusNode, sel.focusOffset);
        if (anchor && head) runInOp(cm, function() {
          setSelection(cm.doc, simpleSelection(anchor, head), sel_dontScroll);
          if (anchor.bad || head.bad) cm.curOp.selectionChanged = true;
        });
      }
    },

    pollContent: function() {
      var cm = this.cm, display = cm.display, sel = cm.doc.sel.primary();
      var from = sel.from(), to = sel.to();
      if (from.line < display.viewFrom || to.line > display.viewTo - 1) return false;

      var fromIndex;
      if (from.line == display.viewFrom || (fromIndex = findViewIndex(cm, from.line)) == 0) {
        var fromLine = lineNo(display.view[0].line);
        var fromNode = display.view[0].node;
      } else {
        var fromLine = lineNo(display.view[fromIndex].line);
        var fromNode = display.view[fromIndex - 1].node.nextSibling;
      }
      var toIndex = findViewIndex(cm, to.line);
      if (toIndex == display.view.length - 1) {
        var toLine = display.viewTo - 1;
        var toNode = display.lineDiv.lastChild;
      } else {
        var toLine = lineNo(display.view[toIndex + 1].line) - 1;
        var toNode = display.view[toIndex + 1].node.previousSibling;
      }

      var newText = cm.doc.splitLines(domTextBetween(cm, fromNode, toNode, fromLine, toLine));
      var oldText = getBetween(cm.doc, Pos(fromLine, 0), Pos(toLine, getLine(cm.doc, toLine).text.length));
      while (newText.length > 1 && oldText.length > 1) {
        if (lst(newText) == lst(oldText)) { newText.pop(); oldText.pop(); toLine--; }
        else if (newText[0] == oldText[0]) { newText.shift(); oldText.shift(); fromLine++; }
        else break;
      }

      var cutFront = 0, cutEnd = 0;
      var newTop = newText[0], oldTop = oldText[0], maxCutFront = Math.min(newTop.length, oldTop.length);
      while (cutFront < maxCutFront && newTop.charCodeAt(cutFront) == oldTop.charCodeAt(cutFront))
        ++cutFront;
      var newBot = lst(newText), oldBot = lst(oldText);
      var maxCutEnd = Math.min(newBot.length - (newText.length == 1 ? cutFront : 0),
                               oldBot.length - (oldText.length == 1 ? cutFront : 0));
      while (cutEnd < maxCutEnd &&
             newBot.charCodeAt(newBot.length - cutEnd - 1) == oldBot.charCodeAt(oldBot.length - cutEnd - 1))
        ++cutEnd;

      newText[newText.length - 1] = newBot.slice(0, newBot.length - cutEnd);
      newText[0] = newText[0].slice(cutFront);

      var chFrom = Pos(fromLine, cutFront);
      var chTo = Pos(toLine, oldText.length ? lst(oldText).length - cutEnd : 0);
      if (newText.length > 1 || newText[0] || cmp(chFrom, chTo)) {
        replaceRange(cm.doc, newText, chFrom, chTo, "+input");
        return true;
      }
    },

    ensurePolled: function() {
      this.forceCompositionEnd();
    },
    reset: function() {
      this.forceCompositionEnd();
    },
    forceCompositionEnd: function() {
      if (!this.composing || this.composing.handled) return;
      this.applyComposition(this.composing);
      this.composing.handled = true;
      this.div.blur();
      this.div.focus();
    },
    applyComposition: function(composing) {
      if (this.cm.isReadOnly())
        operation(this.cm, regChange)(this.cm)
      else if (composing.data && composing.data != composing.startData)
        operation(this.cm, applyTextInput)(this.cm, composing.data, 0, composing.sel);
    },

    setUneditable: function(node) {
      node.contentEditable = "false"
    },

    onKeyPress: function(e) {
      e.preventDefault();
      if (!this.cm.isReadOnly())
        operation(this.cm, applyTextInput)(this.cm, String.fromCharCode(e.charCode == null ? e.keyCode : e.charCode), 0);
    },

    readOnlyChanged: function(val) {
      this.div.contentEditable = String(val != "nocursor")
    },

    onContextMenu: nothing,
    resetPosition: nothing,

    needsContentAttribute: true
  }, ContentEditableInput.prototype);

  function posToDOM(cm, pos) {
    var view = findViewForLine(cm, pos.line);
    if (!view || view.hidden) return null;
    var line = getLine(cm.doc, pos.line);
    var info = mapFromLineView(view, line, pos.line);

    var order = getOrder(line), side = "left";
    if (order) {
      var partPos = getBidiPartAt(order, pos.ch);
      side = partPos % 2 ? "right" : "left";
    }
    var result = nodeAndOffsetInLineMap(info.map, pos.ch, side);
    result.offset = result.collapse == "right" ? result.end : result.start;
    return result;
  }

  function badPos(pos, bad) { if (bad) pos.bad = true; return pos; }

  function domToPos(cm, node, offset) {
    var lineNode;
    if (node == cm.display.lineDiv) {
      lineNode = cm.display.lineDiv.childNodes[offset];
      if (!lineNode) return badPos(cm.clipPos(Pos(cm.display.viewTo - 1)), true);
      node = null; offset = 0;
    } else {
      for (lineNode = node;; lineNode = lineNode.parentNode) {
        if (!lineNode || lineNode == cm.display.lineDiv) return null;
        if (lineNode.parentNode && lineNode.parentNode == cm.display.lineDiv) break;
      }
    }
    for (var i = 0; i < cm.display.view.length; i++) {
      var lineView = cm.display.view[i];
      if (lineView.node == lineNode)
        return locateNodeInLineView(lineView, node, offset);
    }
  }

  function locateNodeInLineView(lineView, node, offset) {
    var wrapper = lineView.text.firstChild, bad = false;
    if (!node || !contains(wrapper, node)) return badPos(Pos(lineNo(lineView.line), 0), true);
    if (node == wrapper) {
      bad = true;
      node = wrapper.childNodes[offset];
      offset = 0;
      if (!node) {
        var line = lineView.rest ? lst(lineView.rest) : lineView.line;
        return badPos(Pos(lineNo(line), line.text.length), bad);
      }
    }

    var textNode = node.nodeType == 3 ? node : null, topNode = node;
    if (!textNode && node.childNodes.length == 1 && node.firstChild.nodeType == 3) {
      textNode = node.firstChild;
      if (offset) offset = textNode.nodeValue.length;
    }
    while (topNode.parentNode != wrapper) topNode = topNode.parentNode;
    var measure = lineView.measure, maps = measure.maps;

    function find(textNode, topNode, offset) {
      for (var i = -1; i < (maps ? maps.length : 0); i++) {
        var map = i < 0 ? measure.map : maps[i];
        for (var j = 0; j < map.length; j += 3) {
          var curNode = map[j + 2];
          if (curNode == textNode || curNode == topNode) {
            var line = lineNo(i < 0 ? lineView.line : lineView.rest[i]);
            var ch = map[j] + offset;
            if (offset < 0 || curNode != textNode) ch = map[j + (offset ? 1 : 0)];
            return Pos(line, ch);
          }
        }
      }
    }
    var found = find(textNode, topNode, offset);
    if (found) return badPos(found, bad);

    // FIXME this is all really shaky. might handle the few cases it needs to handle, but likely to cause problems
    for (var after = topNode.nextSibling, dist = textNode ? textNode.nodeValue.length - offset : 0; after; after = after.nextSibling) {
      found = find(after, after.firstChild, 0);
      if (found)
        return badPos(Pos(found.line, found.ch - dist), bad);
      else
        dist += after.textContent.length;
    }
    for (var before = topNode.previousSibling, dist = offset; before; before = before.previousSibling) {
      found = find(before, before.firstChild, -1);
      if (found)
        return badPos(Pos(found.line, found.ch + dist), bad);
      else
        dist += after.textContent.length;
    }
  }

  function domTextBetween(cm, from, to, fromLine, toLine) {
    var text = "", closing = false, lineSep = cm.doc.lineSeparator();
    function recognizeMarker(id) { return function(marker) { return marker.id == id; }; }
    function walk(node) {
      if (node.nodeType == 1) {
        var cmText = node.getAttribute("cm-text");
        if (cmText != null) {
          if (cmText == "") cmText = node.textContent.replace(/\u200b/g, "");
          text += cmText;
          return;
        }
        var markerID = node.getAttribute("cm-marker"), range;
        if (markerID) {
          var found = cm.findMarks(Pos(fromLine, 0), Pos(toLine + 1, 0), recognizeMarker(+markerID));
          if (found.length && (range = found[0].find()))
            text += getBetween(cm.doc, range.from, range.to).join(lineSep);
          return;
        }
        if (node.getAttribute("contenteditable") == "false") return;
        for (var i = 0; i < node.childNodes.length; i++)
          walk(node.childNodes[i]);
        if (/^(pre|div|p)$/i.test(node.nodeName))
          closing = true;
      } else if (node.nodeType == 3) {
        var val = node.nodeValue;
        if (!val) return;
        if (closing) {
          text += lineSep;
          closing = false;
        }
        text += val;
      }
    }
    for (;;) {
      walk(from);
      if (from == to) break;
      from = from.nextSibling;
    }
    return text;
  }

  CodeMirror.inputStyles = {"textarea": TextareaInput, "contenteditable": ContentEditableInput};

  // SELECTION / CURSOR

  // Selection objects are immutable. A new one is created every time
  // the selection changes. A selection is one or more non-overlapping
  // (and non-touching) ranges, sorted, and an integer that indicates
  // which one is the primary selection (the one that's scrolled into
  // view, that getCursor returns, etc).
  function Selection(ranges, primIndex) {
    this.ranges = ranges;
    this.primIndex = primIndex;
  }

  Selection.prototype = {
    primary: function() { return this.ranges[this.primIndex]; },
    equals: function(other) {
      if (other == this) return true;
      if (other.primIndex != this.primIndex || other.ranges.length != this.ranges.length) return false;
      for (var i = 0; i < this.ranges.length; i++) {
        var here = this.ranges[i], there = other.ranges[i];
        if (cmp(here.anchor, there.anchor) != 0 || cmp(here.head, there.head) != 0) return false;
      }
      return true;
    },
    deepCopy: function() {
      for (var out = [], i = 0; i < this.ranges.length; i++)
        out[i] = new Range(copyPos(this.ranges[i].anchor), copyPos(this.ranges[i].head));
      return new Selection(out, this.primIndex);
    },
    somethingSelected: function() {
      for (var i = 0; i < this.ranges.length; i++)
        if (!this.ranges[i].empty()) return true;
      return false;
    },
    contains: function(pos, end) {
      if (!end) end = pos;
      for (var i = 0; i < this.ranges.length; i++) {
        var range = this.ranges[i];
        if (cmp(end, range.from()) >= 0 && cmp(pos, range.to()) <= 0)
          return i;
      }
      return -1;
    }
  };

  function Range(anchor, head) {
    this.anchor = anchor; this.head = head;
  }

  Range.prototype = {
    from: function() { return minPos(this.anchor, this.head); },
    to: function() { return maxPos(this.anchor, this.head); },
    empty: function() {
      return this.head.line == this.anchor.line && this.head.ch == this.anchor.ch;
    }
  };

  // Take an unsorted, potentially overlapping set of ranges, and
  // build a selection out of it. 'Consumes' ranges array (modifying
  // it).
  function normalizeSelection(ranges, primIndex) {
    var prim = ranges[primIndex];
    ranges.sort(function(a, b) { return cmp(a.from(), b.from()); });
    primIndex = indexOf(ranges, prim);
    for (var i = 1; i < ranges.length; i++) {
      var cur = ranges[i], prev = ranges[i - 1];
      if (cmp(prev.to(), cur.from()) >= 0) {
        var from = minPos(prev.from(), cur.from()), to = maxPos(prev.to(), cur.to());
        var inv = prev.empty() ? cur.from() == cur.head : prev.from() == prev.head;
        if (i <= primIndex) --primIndex;
        ranges.splice(--i, 2, new Range(inv ? to : from, inv ? from : to));
      }
    }
    return new Selection(ranges, primIndex);
  }

  function simpleSelection(anchor, head) {
    return new Selection([new Range(anchor, head || anchor)], 0);
  }

  // Most of the external API clips given positions to make sure they
  // actually exist within the document.
  function clipLine(doc, n) {return Math.max(doc.first, Math.min(n, doc.first + doc.size - 1));}
  function clipPos(doc, pos) {
    if (pos.line < doc.first) return Pos(doc.first, 0);
    var last = doc.first + doc.size - 1;
    if (pos.line > last) return Pos(last, getLine(doc, last).text.length);
    return clipToLen(pos, getLine(doc, pos.line).text.length);
  }
  function clipToLen(pos, linelen) {
    var ch = pos.ch;
    if (ch == null || ch > linelen) return Pos(pos.line, linelen);
    else if (ch < 0) return Pos(pos.line, 0);
    else return pos;
  }
  function isLine(doc, l) {return l >= doc.first && l < doc.first + doc.size;}
  function clipPosArray(doc, array) {
    for (var out = [], i = 0; i < array.length; i++) out[i] = clipPos(doc, array[i]);
    return out;
  }

  // SELECTION UPDATES

  // The 'scroll' parameter given to many of these indicated whether
  // the new cursor position should be scrolled into view after
  // modifying the selection.

  // If shift is held or the extend flag is set, extends a range to
  // include a given position (and optionally a second position).
  // Otherwise, simply returns the range between the given positions.
  // Used for cursor motion and such.
  function extendRange(doc, range, head, other) {
    if (doc.cm && doc.cm.display.shift || doc.extend) {
      var anchor = range.anchor;
      if (other) {
        var posBefore = cmp(head, anchor) < 0;
        if (posBefore != (cmp(other, anchor) < 0)) {
          anchor = head;
          head = other;
        } else if (posBefore != (cmp(head, other) < 0)) {
          head = other;
        }
      }
      return new Range(anchor, head);
    } else {
      return new Range(other || head, head);
    }
  }

  // Extend the primary selection range, discard the rest.
  function extendSelection(doc, head, other, options) {
    setSelection(doc, new Selection([extendRange(doc, doc.sel.primary(), head, other)], 0), options);
  }

  // Extend all selections (pos is an array of selections with length
  // equal the number of selections)
  function extendSelections(doc, heads, options) {
    for (var out = [], i = 0; i < doc.sel.ranges.length; i++)
      out[i] = extendRange(doc, doc.sel.ranges[i], heads[i], null);
    var newSel = normalizeSelection(out, doc.sel.primIndex);
    setSelection(doc, newSel, options);
  }

  // Updates a single range in the selection.
  function replaceOneSelection(doc, i, range, options) {
    var ranges = doc.sel.ranges.slice(0);
    ranges[i] = range;
    setSelection(doc, normalizeSelection(ranges, doc.sel.primIndex), options);
  }

  // Reset the selection to a single range.
  function setSimpleSelection(doc, anchor, head, options) {
    setSelection(doc, simpleSelection(anchor, head), options);
  }

  // Give beforeSelectionChange handlers a change to influence a
  // selection update.
  function filterSelectionChange(doc, sel, options) {
    var obj = {
      ranges: sel.ranges,
      update: function(ranges) {
        this.ranges = [];
        for (var i = 0; i < ranges.length; i++)
          this.ranges[i] = new Range(clipPos(doc, ranges[i].anchor),
                                     clipPos(doc, ranges[i].head));
      },
      origin: options && options.origin
    };
    signal(doc, "beforeSelectionChange", doc, obj);
    if (doc.cm) signal(doc.cm, "beforeSelectionChange", doc.cm, obj);
    if (obj.ranges != sel.ranges) return normalizeSelection(obj.ranges, obj.ranges.length - 1);
    else return sel;
  }

  function setSelectionReplaceHistory(doc, sel, options) {
    var done = doc.history.done, last = lst(done);
    if (last && last.ranges) {
      done[done.length - 1] = sel;
      setSelectionNoUndo(doc, sel, options);
    } else {
      setSelection(doc, sel, options);
    }
  }

  // Set a new selection.
  function setSelection(doc, sel, options) {
    setSelectionNoUndo(doc, sel, options);
    addSelectionToHistory(doc, doc.sel, doc.cm ? doc.cm.curOp.id : NaN, options);
  }

  function setSelectionNoUndo(doc, sel, options) {
    if (hasHandler(doc, "beforeSelectionChange") || doc.cm && hasHandler(doc.cm, "beforeSelectionChange"))
      sel = filterSelectionChange(doc, sel, options);

    var bias = options && options.bias ||
      (cmp(sel.primary().head, doc.sel.primary().head) < 0 ? -1 : 1);
    setSelectionInner(doc, skipAtomicInSelection(doc, sel, bias, true));

    if (!(options && options.scroll === false) && doc.cm)
      ensureCursorVisible(doc.cm);
  }

  function setSelectionInner(doc, sel) {
    if (sel.equals(doc.sel)) return;

    doc.sel = sel;

    if (doc.cm) {
      doc.cm.curOp.updateInput = doc.cm.curOp.selectionChanged = true;
      signalCursorActivity(doc.cm);
    }
    signalLater(doc, "cursorActivity", doc);
  }

  // Verify that the selection does not partially select any atomic
  // marked ranges.
  function reCheckSelection(doc) {
    setSelectionInner(doc, skipAtomicInSelection(doc, doc.sel, null, false), sel_dontScroll);
  }

  // Return a selection that does not partially select any atomic
  // ranges.
  function skipAtomicInSelection(doc, sel, bias, mayClear) {
    var out;
    for (var i = 0; i < sel.ranges.length; i++) {
      var range = sel.ranges[i];
      var old = sel.ranges.length == doc.sel.ranges.length && doc.sel.ranges[i];
      var newAnchor = skipAtomic(doc, range.anchor, old && old.anchor, bias, mayClear);
      var newHead = skipAtomic(doc, range.head, old && old.head, bias, mayClear);
      if (out || newAnchor != range.anchor || newHead != range.head) {
        if (!out) out = sel.ranges.slice(0, i);
        out[i] = new Range(newAnchor, newHead);
      }
    }
    return out ? normalizeSelection(out, sel.primIndex) : sel;
  }

  function skipAtomicInner(doc, pos, oldPos, dir, mayClear) {
    var line = getLine(doc, pos.line);
    if (line.markedSpans) for (var i = 0; i < line.markedSpans.length; ++i) {
      var sp = line.markedSpans[i], m = sp.marker;
      if ((sp.from == null || (m.inclusiveLeft ? sp.from <= pos.ch : sp.from < pos.ch)) &&
          (sp.to == null || (m.inclusiveRight ? sp.to >= pos.ch : sp.to > pos.ch))) {
        if (mayClear) {
          signal(m, "beforeCursorEnter");
          if (m.explicitlyCleared) {
            if (!line.markedSpans) break;
            else {--i; continue;}
          }
        }
        if (!m.atomic) continue;

        if (oldPos) {
          var near = m.find(dir < 0 ? 1 : -1), diff;
          if (dir < 0 ? m.inclusiveRight : m.inclusiveLeft) near = movePos(doc, near, -dir, line);
          if (near && near.line == pos.line && (diff = cmp(near, oldPos)) && (dir < 0 ? diff < 0 : diff > 0))
            return skipAtomicInner(doc, near, pos, dir, mayClear);
        }

        var far = m.find(dir < 0 ? -1 : 1);
        if (dir < 0 ? m.inclusiveLeft : m.inclusiveRight) far = movePos(doc, far, dir, line);
        return far ? skipAtomicInner(doc, far, pos, dir, mayClear) : null;
      }
    }
    return pos;
  }

  // Ensure a given position is not inside an atomic range.
  function skipAtomic(doc, pos, oldPos, bias, mayClear) {
    var dir = bias || 1;
    var found = skipAtomicInner(doc, pos, oldPos, dir, mayClear) ||
        (!mayClear && skipAtomicInner(doc, pos, oldPos, dir, true)) ||
        skipAtomicInner(doc, pos, oldPos, -dir, mayClear) ||
        (!mayClear && skipAtomicInner(doc, pos, oldPos, -dir, true));
    if (!found) {
      doc.cantEdit = true;
      return Pos(doc.first, 0);
    }
    return found;
  }

  function movePos(doc, pos, dir, line) {
    if (dir < 0 && pos.ch == 0) {
      if (pos.line > doc.first) return clipPos(doc, Pos(pos.line - 1));
      else return null;
    } else if (dir > 0 && pos.ch == (line || getLine(doc, pos.line)).text.length) {
      if (pos.line < doc.first + doc.size - 1) return Pos(pos.line + 1, 0);
      else return null;
    } else {
      return new Pos(pos.line, pos.ch + dir);
    }
  }

  // SELECTION DRAWING

  function updateSelection(cm) {
    cm.display.input.showSelection(cm.display.input.prepareSelection());
  }

  function prepareSelection(cm, primary) {
    var doc = cm.doc, result = {};
    var curFragment = result.cursors = document.createDocumentFragment();
    var selFragment = result.selection = document.createDocumentFragment();

    for (var i = 0; i < doc.sel.ranges.length; i++) {
      if (primary === false && i == doc.sel.primIndex) continue;
      var range = doc.sel.ranges[i];
      var collapsed = range.empty();
      if (collapsed || cm.options.showCursorWhenSelecting)
        drawSelectionCursor(cm, range.head, curFragment);
      if (!collapsed)
        drawSelectionRange(cm, range, selFragment);
    }
    return result;
  }

  // Draws a cursor for the given range
  function drawSelectionCursor(cm, head, output) {
    var pos = cursorCoords(cm, head, "div", null, null, !cm.options.singleCursorHeightPerLine);

    var cursor = output.appendChild(elt("div", "\u00a0", "CodeMirror-cursor"));
    cursor.style.left = pos.left + "px";
    cursor.style.top = pos.top + "px";
    cursor.style.height = Math.max(0, pos.bottom - pos.top) * cm.options.cursorHeight + "px";

    if (pos.other) {
      // Secondary cursor, shown when on a 'jump' in bi-directional text
      var otherCursor = output.appendChild(elt("div", "\u00a0", "CodeMirror-cursor CodeMirror-secondarycursor"));
      otherCursor.style.display = "";
      otherCursor.style.left = pos.other.left + "px";
      otherCursor.style.top = pos.other.top + "px";
      otherCursor.style.height = (pos.other.bottom - pos.other.top) * .85 + "px";
    }
  }

  // Draws the given range as a highlighted selection
  function drawSelectionRange(cm, range, output) {
    var display = cm.display, doc = cm.doc;
    var fragment = document.createDocumentFragment();
    var padding = paddingH(cm.display), leftSide = padding.left;
    var rightSide = Math.max(display.sizerWidth, displayWidth(cm) - display.sizer.offsetLeft) - padding.right;

    function add(left, top, width, bottom) {
      if (top < 0) top = 0;
      top = Math.round(top);
      bottom = Math.round(bottom);
      fragment.appendChild(elt("div", null, "CodeMirror-selected", "position: absolute; left: " + left +
                               "px; top: " + top + "px; width: " + (width == null ? rightSide - left : width) +
                               "px; height: " + (bottom - top) + "px"));
    }

    function drawForLine(line, fromArg, toArg) {
      var lineObj = getLine(doc, line);
      var lineLen = lineObj.text.length;
      var start, end;
      function coords(ch, bias) {
        return charCoords(cm, Pos(line, ch), "div", lineObj, bias);
      }

      iterateBidiSections(getOrder(lineObj), fromArg || 0, toArg == null ? lineLen : toArg, function(from, to, dir) {
        var leftPos = coords(from, "left"), rightPos, left, right;
        if (from == to) {
          rightPos = leftPos;
          left = right = leftPos.left;
        } else {
          rightPos = coords(to - 1, "right");
          if (dir == "rtl") { var tmp = leftPos; leftPos = rightPos; rightPos = tmp; }
          left = leftPos.left;
          right = rightPos.right;
        }
        if (fromArg == null && from == 0) left = leftSide;
        if (rightPos.top - leftPos.top > 3) { // Different lines, draw top part
          add(left, leftPos.top, null, leftPos.bottom);
          left = leftSide;
          if (leftPos.bottom < rightPos.top) add(left, leftPos.bottom, null, rightPos.top);
        }
        if (toArg == null && to == lineLen) right = rightSide;
        if (!start || leftPos.top < start.top || leftPos.top == start.top && leftPos.left < start.left)
          start = leftPos;
        if (!end || rightPos.bottom > end.bottom || rightPos.bottom == end.bottom && rightPos.right > end.right)
          end = rightPos;
        if (left < leftSide + 1) left = leftSide;
        add(left, rightPos.top, right - left, rightPos.bottom);
      });
      return {start: start, end: end};
    }

    var sFrom = range.from(), sTo = range.to();
    if (sFrom.line == sTo.line) {
      drawForLine(sFrom.line, sFrom.ch, sTo.ch);
    } else {
      var fromLine = getLine(doc, sFrom.line), toLine = getLine(doc, sTo.line);
      var singleVLine = visualLine(fromLine) == visualLine(toLine);
      var leftEnd = drawForLine(sFrom.line, sFrom.ch, singleVLine ? fromLine.text.length + 1 : null).end;
      var rightStart = drawForLine(sTo.line, singleVLine ? 0 : null, sTo.ch).start;
      if (singleVLine) {
        if (leftEnd.top < rightStart.top - 2) {
          add(leftEnd.right, leftEnd.top, null, leftEnd.bottom);
          add(leftSide, rightStart.top, rightStart.left, rightStart.bottom);
        } else {
          add(leftEnd.right, leftEnd.top, rightStart.left - leftEnd.right, leftEnd.bottom);
        }
      }
      if (leftEnd.bottom < rightStart.top)
        add(leftSide, leftEnd.bottom, null, rightStart.top);
    }

    output.appendChild(fragment);
  }

  // Cursor-blinking
  function restartBlink(cm) {
    if (!cm.state.focused) return;
    var display = cm.display;
    clearInterval(display.blinker);
    var on = true;
    display.cursorDiv.style.visibility = "";
    if (cm.options.cursorBlinkRate > 0)
      display.blinker = setInterval(function() {
        display.cursorDiv.style.visibility = (on = !on) ? "" : "hidden";
      }, cm.options.cursorBlinkRate);
    else if (cm.options.cursorBlinkRate < 0)
      display.cursorDiv.style.visibility = "hidden";
  }

  // HIGHLIGHT WORKER

  function startWorker(cm, time) {
    if (cm.doc.mode.startState && cm.doc.frontier < cm.display.viewTo)
      cm.state.highlight.set(time, bind(highlightWorker, cm));
  }

  function highlightWorker(cm) {
    var doc = cm.doc;
    if (doc.frontier < doc.first) doc.frontier = doc.first;
    if (doc.frontier >= cm.display.viewTo) return;
    var end = +new Date + cm.options.workTime;
    var state = copyState(doc.mode, getStateBefore(cm, doc.frontier));
    var changedLines = [];

    doc.iter(doc.frontier, Math.min(doc.first + doc.size, cm.display.viewTo + 500), function(line) {
      if (doc.frontier >= cm.display.viewFrom) { // Visible
        var oldStyles = line.styles, tooLong = line.text.length > cm.options.maxHighlightLength;
        var highlighted = highlightLine(cm, line, tooLong ? copyState(doc.mode, state) : state, true);
        line.styles = highlighted.styles;
        var oldCls = line.styleClasses, newCls = highlighted.classes;
        if (newCls) line.styleClasses = newCls;
        else if (oldCls) line.styleClasses = null;
        var ischange = !oldStyles || oldStyles.length != line.styles.length ||
          oldCls != newCls && (!oldCls || !newCls || oldCls.bgClass != newCls.bgClass || oldCls.textClass != newCls.textClass);
        for (var i = 0; !ischange && i < oldStyles.length; ++i) ischange = oldStyles[i] != line.styles[i];
        if (ischange) changedLines.push(doc.frontier);
        line.stateAfter = tooLong ? state : copyState(doc.mode, state);
      } else {
        if (line.text.length <= cm.options.maxHighlightLength)
          processLine(cm, line.text, state);
        line.stateAfter = doc.frontier % 5 == 0 ? copyState(doc.mode, state) : null;
      }
      ++doc.frontier;
      if (+new Date > end) {
        startWorker(cm, cm.options.workDelay);
        return true;
      }
    });
    if (changedLines.length) runInOp(cm, function() {
      for (var i = 0; i < changedLines.length; i++)
        regLineChange(cm, changedLines[i], "text");
    });
  }

  // Finds the line to start with when starting a parse. Tries to
  // find a line with a stateAfter, so that it can start with a
  // valid state. If that fails, it returns the line with the
  // smallest indentation, which tends to need the least context to
  // parse correctly.
  function findStartLine(cm, n, precise) {
    var minindent, minline, doc = cm.doc;
    var lim = precise ? -1 : n - (cm.doc.mode.innerMode ? 1000 : 100);
    for (var search = n; search > lim; --search) {
      if (search <= doc.first) return doc.first;
      var line = getLine(doc, search - 1);
      if (line.stateAfter && (!precise || search <= doc.frontier)) return search;
      var indented = countColumn(line.text, null, cm.options.tabSize);
      if (minline == null || minindent > indented) {
        minline = search - 1;
        minindent = indented;
      }
    }
    return minline;
  }

  function getStateBefore(cm, n, precise) {
    var doc = cm.doc, display = cm.display;
    if (!doc.mode.startState) return true;
    var pos = findStartLine(cm, n, precise), state = pos > doc.first && getLine(doc, pos-1).stateAfter;
    if (!state) state = startState(doc.mode);
    else state = copyState(doc.mode, state);
    doc.iter(pos, n, function(line) {
      processLine(cm, line.text, state);
      var save = pos == n - 1 || pos % 5 == 0 || pos >= display.viewFrom && pos < display.viewTo;
      line.stateAfter = save ? copyState(doc.mode, state) : null;
      ++pos;
    });
    if (precise) doc.frontier = pos;
    return state;
  }

  // POSITION MEASUREMENT

  function paddingTop(display) {return display.lineSpace.offsetTop;}
  function paddingVert(display) {return display.mover.offsetHeight - display.lineSpace.offsetHeight;}
  function paddingH(display) {
    if (display.cachedPaddingH) return display.cachedPaddingH;
    var e = removeChildrenAndAdd(display.measure, elt("pre", "x"));
    var style = window.getComputedStyle ? window.getComputedStyle(e) : e.currentStyle;
    var data = {left: parseInt(style.paddingLeft), right: parseInt(style.paddingRight)};
    if (!isNaN(data.left) && !isNaN(data.right)) display.cachedPaddingH = data;
    return data;
  }

  function scrollGap(cm) { return scrollerGap - cm.display.nativeBarWidth; }
  function displayWidth(cm) {
    return cm.display.scroller.clientWidth - scrollGap(cm) - cm.display.barWidth;
  }
  function displayHeight(cm) {
    return cm.display.scroller.clientHeight - scrollGap(cm) - cm.display.barHeight;
  }

  // Ensure the lineView.wrapping.heights array is populated. This is
  // an array of bottom offsets for the lines that make up a drawn
  // line. When lineWrapping is on, there might be more than one
  // height.
  function ensureLineHeights(cm, lineView, rect) {
    var wrapping = cm.options.lineWrapping;
    var curWidth = wrapping && displayWidth(cm);
    if (!lineView.measure.heights || wrapping && lineView.measure.width != curWidth) {
      var heights = lineView.measure.heights = [];
      if (wrapping) {
        lineView.measure.width = curWidth;
        var rects = lineView.text.firstChild.getClientRects();
        for (var i = 0; i < rects.length - 1; i++) {
          var cur = rects[i], next = rects[i + 1];
          if (Math.abs(cur.bottom - next.bottom) > 2)
            heights.push((cur.bottom + next.top) / 2 - rect.top);
        }
      }
      heights.push(rect.bottom - rect.top);
    }
  }

  // Find a line map (mapping character offsets to text nodes) and a
  // measurement cache for the given line number. (A line view might
  // contain multiple lines when collapsed ranges are present.)
  function mapFromLineView(lineView, line, lineN) {
    if (lineView.line == line)
      return {map: lineView.measure.map, cache: lineView.measure.cache};
    for (var i = 0; i < lineView.rest.length; i++)
      if (lineView.rest[i] == line)
        return {map: lineView.measure.maps[i], cache: lineView.measure.caches[i]};
    for (var i = 0; i < lineView.rest.length; i++)
      if (lineNo(lineView.rest[i]) > lineN)
        return {map: lineView.measure.maps[i], cache: lineView.measure.caches[i], before: true};
  }

  // Render a line into the hidden node display.externalMeasured. Used
  // when measurement is needed for a line that's not in the viewport.
  function updateExternalMeasurement(cm, line) {
    line = visualLine(line);
    var lineN = lineNo(line);
    var view = cm.display.externalMeasured = new LineView(cm.doc, line, lineN);
    view.lineN = lineN;
    var built = view.built = buildLineContent(cm, view);
    view.text = built.pre;
    removeChildrenAndAdd(cm.display.lineMeasure, built.pre);
    return view;
  }

  // Get a {top, bottom, left, right} box (in line-local coordinates)
  // for a given character.
  function measureChar(cm, line, ch, bias) {
    return measureCharPrepared(cm, prepareMeasureForLine(cm, line), ch, bias);
  }

  // Find a line view that corresponds to the given line number.
  function findViewForLine(cm, lineN) {
    if (lineN >= cm.display.viewFrom && lineN < cm.display.viewTo)
      return cm.display.view[findViewIndex(cm, lineN)];
    var ext = cm.display.externalMeasured;
    if (ext && lineN >= ext.lineN && lineN < ext.lineN + ext.size)
      return ext;
  }

  // Measurement can be split in two steps, the set-up work that
  // applies to the whole line, and the measurement of the actual
  // character. Functions like coordsChar, that need to do a lot of
  // measurements in a row, can thus ensure that the set-up work is
  // only done once.
  function prepareMeasureForLine(cm, line) {
    var lineN = lineNo(line);
    var view = findViewForLine(cm, lineN);
    if (view && !view.text) {
      view = null;
    } else if (view && view.changes) {
      updateLineForChanges(cm, view, lineN, getDimensions(cm));
      cm.curOp.forceUpdate = true;
    }
    if (!view)
      view = updateExternalMeasurement(cm, line);

    var info = mapFromLineView(view, line, lineN);
    return {
      line: line, view: view, rect: null,
      map: info.map, cache: info.cache, before: info.before,
      hasHeights: false
    };
  }

  // Given a prepared measurement object, measures the position of an
  // actual character (or fetches it from the cache).
  function measureCharPrepared(cm, prepared, ch, bias, varHeight) {
    if (prepared.before) ch = -1;
    var key = ch + (bias || ""), found;
    if (prepared.cache.hasOwnProperty(key)) {
      found = prepared.cache[key];
    } else {
      if (!prepared.rect)
        prepared.rect = prepared.view.text.getBoundingClientRect();
      if (!prepared.hasHeights) {
        ensureLineHeights(cm, prepared.view, prepared.rect);
        prepared.hasHeights = true;
      }
      found = measureCharInner(cm, prepared, ch, bias);
      if (!found.bogus) prepared.cache[key] = found;
    }
    return {left: found.left, right: found.right,
            top: varHeight ? found.rtop : found.top,
            bottom: varHeight ? found.rbottom : found.bottom};
  }

  var nullRect = {left: 0, right: 0, top: 0, bottom: 0};

  function nodeAndOffsetInLineMap(map, ch, bias) {
    var node, start, end, collapse;
    // First, search the line map for the text node corresponding to,
    // or closest to, the target character.
    for (var i = 0; i < map.length; i += 3) {
      var mStart = map[i], mEnd = map[i + 1];
      if (ch < mStart) {
        start = 0; end = 1;
        collapse = "left";
      } else if (ch < mEnd) {
        start = ch - mStart;
        end = start + 1;
      } else if (i == map.length - 3 || ch == mEnd && map[i + 3] > ch) {
        end = mEnd - mStart;
        start = end - 1;
        if (ch >= mEnd) collapse = "right";
      }
      if (start != null) {
        node = map[i + 2];
        if (mStart == mEnd && bias == (node.insertLeft ? "left" : "right"))
          collapse = bias;
        if (bias == "left" && start == 0)
          while (i && map[i - 2] == map[i - 3] && map[i - 1].insertLeft) {
            node = map[(i -= 3) + 2];
            collapse = "left";
          }
        if (bias == "right" && start == mEnd - mStart)
          while (i < map.length - 3 && map[i + 3] == map[i + 4] && !map[i + 5].insertLeft) {
            node = map[(i += 3) + 2];
            collapse = "right";
          }
        break;
      }
    }
    return {node: node, start: start, end: end, collapse: collapse, coverStart: mStart, coverEnd: mEnd};
  }

  function measureCharInner(cm, prepared, ch, bias) {
    var place = nodeAndOffsetInLineMap(prepared.map, ch, bias);
    var node = place.node, start = place.start, end = place.end, collapse = place.collapse;

    var rect;
    if (node.nodeType == 3) { // If it is a text node, use a range to retrieve the coordinates.
      for (var i = 0; i < 4; i++) { // Retry a maximum of 4 times when nonsense rectangles are returned
        while (start && isExtendingChar(prepared.line.text.charAt(place.coverStart + start))) --start;
        while (place.coverStart + end < place.coverEnd && isExtendingChar(prepared.line.text.charAt(place.coverStart + end))) ++end;
        if (ie && ie_version < 9 && start == 0 && end == place.coverEnd - place.coverStart) {
          rect = node.parentNode.getBoundingClientRect();
        } else if (ie && cm.options.lineWrapping) {
          var rects = range(node, start, end).getClientRects();
          if (rects.length)
            rect = rects[bias == "right" ? rects.length - 1 : 0];
          else
            rect = nullRect;
        } else {
          rect = range(node, start, end).getBoundingClientRect() || nullRect;
        }
        if (rect.left || rect.right || start == 0) break;
        end = start;
        start = start - 1;
        collapse = "right";
      }
      if (ie && ie_version < 11) rect = maybeUpdateRectForZooming(cm.display.measure, rect);
    } else { // If it is a widget, simply get the box for the whole widget.
      if (start > 0) collapse = bias = "right";
      var rects;
      if (cm.options.lineWrapping && (rects = node.getClientRects()).length > 1)
        rect = rects[bias == "right" ? rects.length - 1 : 0];
      else
        rect = node.getBoundingClientRect();
    }
    if (ie && ie_version < 9 && !start && (!rect || !rect.left && !rect.right)) {
      var rSpan = node.parentNode.getClientRects()[0];
      if (rSpan)
        rect = {left: rSpan.left, right: rSpan.left + charWidth(cm.display), top: rSpan.top, bottom: rSpan.bottom};
      else
        rect = nullRect;
    }

    var rtop = rect.top - prepared.rect.top, rbot = rect.bottom - prepared.rect.top;
    var mid = (rtop + rbot) / 2;
    var heights = prepared.view.measure.heights;
    for (var i = 0; i < heights.length - 1; i++)
      if (mid < heights[i]) break;
    var top = i ? heights[i - 1] : 0, bot = heights[i];
    var result = {left: (collapse == "right" ? rect.right : rect.left) - prepared.rect.left,
                  right: (collapse == "left" ? rect.left : rect.right) - prepared.rect.left,
                  top: top, bottom: bot};
    if (!rect.left && !rect.right) result.bogus = true;
    if (!cm.options.singleCursorHeightPerLine) { result.rtop = rtop; result.rbottom = rbot; }

    return result;
  }

  // Work around problem with bounding client rects on ranges being
  // returned incorrectly when zoomed on IE10 and below.
  function maybeUpdateRectForZooming(measure, rect) {
    if (!window.screen || screen.logicalXDPI == null ||
        screen.logicalXDPI == screen.deviceXDPI || !hasBadZoomedRects(measure))
      return rect;
    var scaleX = screen.logicalXDPI / screen.deviceXDPI;
    var scaleY = screen.logicalYDPI / screen.deviceYDPI;
    return {left: rect.left * scaleX, right: rect.right * scaleX,
            top: rect.top * scaleY, bottom: rect.bottom * scaleY};
  }

  function clearLineMeasurementCacheFor(lineView) {
    if (lineView.measure) {
      lineView.measure.cache = {};
      lineView.measure.heights = null;
      if (lineView.rest) for (var i = 0; i < lineView.rest.length; i++)
        lineView.measure.caches[i] = {};
    }
  }

  function clearLineMeasurementCache(cm) {
    cm.display.externalMeasure = null;
    removeChildren(cm.display.lineMeasure);
    for (var i = 0; i < cm.display.view.length; i++)
      clearLineMeasurementCacheFor(cm.display.view[i]);
  }

  function clearCaches(cm) {
    clearLineMeasurementCache(cm);
    cm.display.cachedCharWidth = cm.display.cachedTextHeight = cm.display.cachedPaddingH = null;
    if (!cm.options.lineWrapping) cm.display.maxLineChanged = true;
    cm.display.lineNumChars = null;
  }

  function pageScrollX() { return window.pageXOffset || (document.documentElement || document.body).scrollLeft; }
  function pageScrollY() { return window.pageYOffset || (document.documentElement || document.body).scrollTop; }

  // Converts a {top, bottom, left, right} box from line-local
  // coordinates into another coordinate system. Context may be one of
  // "line", "div" (display.lineDiv), "local"/null (editor), "window",
  // or "page".
  function intoCoordSystem(cm, lineObj, rect, context) {
    if (lineObj.widgets) for (var i = 0; i < lineObj.widgets.length; ++i) if (lineObj.widgets[i].above) {
      var size = widgetHeight(lineObj.widgets[i]);
      rect.top += size; rect.bottom += size;
    }
    if (context == "line") return rect;
    if (!context) context = "local";
    var yOff = heightAtLine(lineObj);
    if (context == "local") yOff += paddingTop(cm.display);
    else yOff -= cm.display.viewOffset;
    if (context == "page" || context == "window") {
      var lOff = cm.display.lineSpace.getBoundingClientRect();
      yOff += lOff.top + (context == "window" ? 0 : pageScrollY());
      var xOff = lOff.left + (context == "window" ? 0 : pageScrollX());
      rect.left += xOff; rect.right += xOff;
    }
    rect.top += yOff; rect.bottom += yOff;
    return rect;
  }

  // Coverts a box from "div" coords to another coordinate system.
  // Context may be "window", "page", "div", or "local"/null.
  function fromCoordSystem(cm, coords, context) {
    if (context == "div") return coords;
    var left = coords.left, top = coords.top;
    // First move into "page" coordinate system
    if (context == "page") {
      left -= pageScrollX();
      top -= pageScrollY();
    } else if (context == "local" || !context) {
      var localBox = cm.display.sizer.getBoundingClientRect();
      left += localBox.left;
      top += localBox.top;
    }

    var lineSpaceBox = cm.display.lineSpace.getBoundingClientRect();
    return {left: left - lineSpaceBox.left, top: top - lineSpaceBox.top};
  }

  function charCoords(cm, pos, context, lineObj, bias) {
    if (!lineObj) lineObj = getLine(cm.doc, pos.line);
    return intoCoordSystem(cm, lineObj, measureChar(cm, lineObj, pos.ch, bias), context);
  }

  // Returns a box for a given cursor position, which may have an
  // 'other' property containing the position of the secondary cursor
  // on a bidi boundary.
  function cursorCoords(cm, pos, context, lineObj, preparedMeasure, varHeight) {
    lineObj = lineObj || getLine(cm.doc, pos.line);
    if (!preparedMeasure) preparedMeasure = prepareMeasureForLine(cm, lineObj);
    function get(ch, right) {
      var m = measureCharPrepared(cm, preparedMeasure, ch, right ? "right" : "left", varHeight);
      if (right) m.left = m.right; else m.right = m.left;
      return intoCoordSystem(cm, lineObj, m, context);
    }
    function getBidi(ch, partPos) {
      var part = order[partPos], right = part.level % 2;
      if (ch == bidiLeft(part) && partPos && part.level < order[partPos - 1].level) {
        part = order[--partPos];
        ch = bidiRight(part) - (part.level % 2 ? 0 : 1);
        right = true;
      } else if (ch == bidiRight(part) && partPos < order.length - 1 && part.level < order[partPos + 1].level) {
        part = order[++partPos];
        ch = bidiLeft(part) - part.level % 2;
        right = false;
      }
      if (right && ch == part.to && ch > part.from) return get(ch - 1);
      return get(ch, right);
    }
    var order = getOrder(lineObj), ch = pos.ch;
    if (!order) return get(ch);
    var partPos = getBidiPartAt(order, ch);
    var val = getBidi(ch, partPos);
    if (bidiOther != null) val.other = getBidi(ch, bidiOther);
    return val;
  }

  // Used to cheaply estimate the coordinates for a position. Used for
  // intermediate scroll updates.
  function estimateCoords(cm, pos) {
    var left = 0, pos = clipPos(cm.doc, pos);
    if (!cm.options.lineWrapping) left = charWidth(cm.display) * pos.ch;
    var lineObj = getLine(cm.doc, pos.line);
    var top = heightAtLine(lineObj) + paddingTop(cm.display);
    return {left: left, right: left, top: top, bottom: top + lineObj.height};
  }

  // Positions returned by coordsChar contain some extra information.
  // xRel is the relative x position of the input coordinates compared
  // to the found position (so xRel > 0 means the coordinates are to
  // the right of the character position, for example). When outside
  // is true, that means the coordinates lie outside the line's
  // vertical range.
  function PosWithInfo(line, ch, outside, xRel) {
    var pos = Pos(line, ch);
    pos.xRel = xRel;
    if (outside) pos.outside = true;
    return pos;
  }

  // Compute the character position closest to the given coordinates.
  // Input must be lineSpace-local ("div" coordinate system).
  function coordsChar(cm, x, y) {
    var doc = cm.doc;
    y += cm.display.viewOffset;
    if (y < 0) return PosWithInfo(doc.first, 0, true, -1);
    var lineN = lineAtHeight(doc, y), last = doc.first + doc.size - 1;
    if (lineN > last)
      return PosWithInfo(doc.first + doc.size - 1, getLine(doc, last).text.length, true, 1);
    if (x < 0) x = 0;

    var lineObj = getLine(doc, lineN);
    for (;;) {
      var found = coordsCharInner(cm, lineObj, lineN, x, y);
      var merged = collapsedSpanAtEnd(lineObj);
      var mergedPos = merged && merged.find(0, true);
      if (merged && (found.ch > mergedPos.from.ch || found.ch == mergedPos.from.ch && found.xRel > 0))
        lineN = lineNo(lineObj = mergedPos.to.line);
      else
        return found;
    }
  }

  function coordsCharInner(cm, lineObj, lineNo, x, y) {
    var innerOff = y - heightAtLine(lineObj);
    var wrongLine = false, adjust = 2 * cm.display.wrapper.clientWidth;
    var preparedMeasure = prepareMeasureForLine(cm, lineObj);

    function getX(ch) {
      var sp = cursorCoords(cm, Pos(lineNo, ch), "line", lineObj, preparedMeasure);
      wrongLine = true;
      if (innerOff > sp.bottom) return sp.left - adjust;
      else if (innerOff < sp.top) return sp.left + adjust;
      else wrongLine = false;
      return sp.left;
    }

    var bidi = getOrder(lineObj), dist = lineObj.text.length;
    var from = lineLeft(lineObj), to = lineRight(lineObj);
    var fromX = getX(from), fromOutside = wrongLine, toX = getX(to), toOutside = wrongLine;

    if (x > toX) return PosWithInfo(lineNo, to, toOutside, 1);
    // Do a binary search between these bounds.
    for (;;) {
      if (bidi ? to == from || to == moveVisually(lineObj, from, 1) : to - from <= 1) {
        var ch = x < fromX || x - fromX <= toX - x ? from : to;
        var xDiff = x - (ch == from ? fromX : toX);
        while (isExtendingChar(lineObj.text.charAt(ch))) ++ch;
        var pos = PosWithInfo(lineNo, ch, ch == from ? fromOutside : toOutside,
                              xDiff < -1 ? -1 : xDiff > 1 ? 1 : 0);
        return pos;
      }
      var step = Math.ceil(dist / 2), middle = from + step;
      if (bidi) {
        middle = from;
        for (var i = 0; i < step; ++i) middle = moveVisually(lineObj, middle, 1);
      }
      var middleX = getX(middle);
      if (middleX > x) {to = middle; toX = middleX; if (toOutside = wrongLine) toX += 1000; dist = step;}
      else {from = middle; fromX = middleX; fromOutside = wrongLine; dist -= step;}
    }
  }

  var measureText;
  // Compute the default text height.
  function textHeight(display) {
    if (display.cachedTextHeight != null) return display.cachedTextHeight;
    if (measureText == null) {
      measureText = elt("pre");
      // Measure a bunch of lines, for browsers that compute
      // fractional heights.
      for (var i = 0; i < 49; ++i) {
        measureText.appendChild(document.createTextNode("x"));
        measureText.appendChild(elt("br"));
      }
      measureText.appendChild(document.createTextNode("x"));
    }
    removeChildrenAndAdd(display.measure, measureText);
    var height = measureText.offsetHeight / 50;
    if (height > 3) display.cachedTextHeight = height;
    removeChildren(display.measure);
    return height || 1;
  }

  // Compute the default character width.
  function charWidth(display) {
    if (display.cachedCharWidth != null) return display.cachedCharWidth;
    var anchor = elt("span", "xxxxxxxxxx");
    var pre = elt("pre", [anchor]);
    removeChildrenAndAdd(display.measure, pre);
    var rect = anchor.getBoundingClientRect(), width = (rect.right - rect.left) / 10;
    if (width > 2) display.cachedCharWidth = width;
    return width || 10;
  }

  // OPERATIONS

  // Operations are used to wrap a series of changes to the editor
  // state in such a way that each change won't have to update the
  // cursor and display (which would be awkward, slow, and
  // error-prone). Instead, display updates are batched and then all
  // combined and executed at once.

  var operationGroup = null;

  var nextOpId = 0;
  // Start a new operation.
  function startOperation(cm) {
    cm.curOp = {
      cm: cm,
      viewChanged: false,      // Flag that indicates that lines might need to be redrawn
      startHeight: cm.doc.height, // Used to detect need to update scrollbar
      forceUpdate: false,      // Used to force a redraw
      updateInput: null,       // Whether to reset the input textarea
      typing: false,           // Whether this reset should be careful to leave existing text (for compositing)
      changeObjs: null,        // Accumulated changes, for firing change events
      cursorActivityHandlers: null, // Set of handlers to fire cursorActivity on
      cursorActivityCalled: 0, // Tracks which cursorActivity handlers have been called already
      selectionChanged: false, // Whether the selection needs to be redrawn
      updateMaxLine: false,    // Set when the widest line needs to be determined anew
      scrollLeft: null, scrollTop: null, // Intermediate scroll position, not pushed to DOM yet
      scrollToPos: null,       // Used to scroll to a specific position
      focus: false,
      id: ++nextOpId           // Unique ID
    };
    if (operationGroup) {
      operationGroup.ops.push(cm.curOp);
    } else {
      cm.curOp.ownsGroup = operationGroup = {
        ops: [cm.curOp],
        delayedCallbacks: []
      };
    }
  }

  function fireCallbacksForOps(group) {
    // Calls delayed callbacks and cursorActivity handlers until no
    // new ones appear
    var callbacks = group.delayedCallbacks, i = 0;
    do {
      for (; i < callbacks.length; i++)
        callbacks[i].call(null);
      for (var j = 0; j < group.ops.length; j++) {
        var op = group.ops[j];
        if (op.cursorActivityHandlers)
          while (op.cursorActivityCalled < op.cursorActivityHandlers.length)
            op.cursorActivityHandlers[op.cursorActivityCalled++].call(null, op.cm);
      }
    } while (i < callbacks.length);
  }

  // Finish an operation, updating the display and signalling delayed events
  function endOperation(cm) {
    var op = cm.curOp, group = op.ownsGroup;
    if (!group) return;

    try { fireCallbacksForOps(group); }
    finally {
      operationGroup = null;
      for (var i = 0; i < group.ops.length; i++)
        group.ops[i].cm.curOp = null;
      endOperations(group);
    }
  }

  // The DOM updates done when an operation finishes are batched so
  // that the minimum number of relayouts are required.
  function endOperations(group) {
    var ops = group.ops;
    for (var i = 0; i < ops.length; i++) // Read DOM
      endOperation_R1(ops[i]);
    for (var i = 0; i < ops.length; i++) // Write DOM (maybe)
      endOperation_W1(ops[i]);
    for (var i = 0; i < ops.length; i++) // Read DOM
      endOperation_R2(ops[i]);
    for (var i = 0; i < ops.length; i++) // Write DOM (maybe)
      endOperation_W2(ops[i]);
    for (var i = 0; i < ops.length; i++) // Read DOM
      endOperation_finish(ops[i]);
  }

  function endOperation_R1(op) {
    var cm = op.cm, display = cm.display;
    maybeClipScrollbars(cm);
    if (op.updateMaxLine) findMaxLine(cm);

    op.mustUpdate = op.viewChanged || op.forceUpdate || op.scrollTop != null ||
      op.scrollToPos && (op.scrollToPos.from.line < display.viewFrom ||
                         op.scrollToPos.to.line >= display.viewTo) ||
      display.maxLineChanged && cm.options.lineWrapping;
    op.update = op.mustUpdate &&
      new DisplayUpdate(cm, op.mustUpdate && {top: op.scrollTop, ensure: op.scrollToPos}, op.forceUpdate);
  }

  function endOperation_W1(op) {
    op.updatedDisplay = op.mustUpdate && updateDisplayIfNeeded(op.cm, op.update);
  }

  function endOperation_R2(op) {
    var cm = op.cm, display = cm.display;
    if (op.updatedDisplay) updateHeightsInViewport(cm);

    op.barMeasure = measureForScrollbars(cm);

    // If the max line changed since it was last measured, measure it,
    // and ensure the document's width matches it.
    // updateDisplay_W2 will use these properties to do the actual resizing
    if (display.maxLineChanged && !cm.options.lineWrapping) {
      op.adjustWidthTo = measureChar(cm, display.maxLine, display.maxLine.text.length).left + 3;
      cm.display.sizerWidth = op.adjustWidthTo;
      op.barMeasure.scrollWidth =
        Math.max(display.scroller.clientWidth, display.sizer.offsetLeft + op.adjustWidthTo + scrollGap(cm) + cm.display.barWidth);
      op.maxScrollLeft = Math.max(0, display.sizer.offsetLeft + op.adjustWidthTo - displayWidth(cm));
    }

    if (op.updatedDisplay || op.selectionChanged)
      op.preparedSelection = display.input.prepareSelection();
  }

  function endOperation_W2(op) {
    var cm = op.cm;

    if (op.adjustWidthTo != null) {
      cm.display.sizer.style.minWidth = op.adjustWidthTo + "px";
      if (op.maxScrollLeft < cm.doc.scrollLeft)
        setScrollLeft(cm, Math.min(cm.display.scroller.scrollLeft, op.maxScrollLeft), true);
      cm.display.maxLineChanged = false;
    }

    if (op.preparedSelection)
      cm.display.input.showSelection(op.preparedSelection);
    if (op.updatedDisplay)
      setDocumentHeight(cm, op.barMeasure);
    if (op.updatedDisplay || op.startHeight != cm.doc.height)
      updateScrollbars(cm, op.barMeasure);

    if (op.selectionChanged) restartBlink(cm);

    if (cm.state.focused && op.updateInput)
      cm.display.input.reset(op.typing);
    if (op.focus && op.focus == activeElt() && (!document.hasFocus || document.hasFocus()))
      ensureFocus(op.cm);
  }

  function endOperation_finish(op) {
    var cm = op.cm, display = cm.display, doc = cm.doc;

    if (op.updatedDisplay) postUpdateDisplay(cm, op.update);

    // Abort mouse wheel delta measurement, when scrolling explicitly
    if (display.wheelStartX != null && (op.scrollTop != null || op.scrollLeft != null || op.scrollToPos))
      display.wheelStartX = display.wheelStartY = null;

    // Propagate the scroll position to the actual DOM scroller
    if (op.scrollTop != null && (display.scroller.scrollTop != op.scrollTop || op.forceScroll)) {
      doc.scrollTop = Math.max(0, Math.min(display.scroller.scrollHeight - display.scroller.clientHeight, op.scrollTop));
      display.scrollbars.setScrollTop(doc.scrollTop);
      display.scroller.scrollTop = doc.scrollTop;
    }
    if (op.scrollLeft != null && (display.scroller.scrollLeft != op.scrollLeft || op.forceScroll)) {
      doc.scrollLeft = Math.max(0, Math.min(display.scroller.scrollWidth - displayWidth(cm), op.scrollLeft));
      display.scrollbars.setScrollLeft(doc.scrollLeft);
      display.scroller.scrollLeft = doc.scrollLeft;
      alignHorizontally(cm);
    }
    // If we need to scroll a specific position into view, do so.
    if (op.scrollToPos) {
      var coords = scrollPosIntoView(cm, clipPos(doc, op.scrollToPos.from),
                                     clipPos(doc, op.scrollToPos.to), op.scrollToPos.margin);
      if (op.scrollToPos.isCursor && cm.state.focused) maybeScrollWindow(cm, coords);
    }

    // Fire events for markers that are hidden/unidden by editing or
    // undoing
    var hidden = op.maybeHiddenMarkers, unhidden = op.maybeUnhiddenMarkers;
    if (hidden) for (var i = 0; i < hidden.length; ++i)
      if (!hidden[i].lines.length) signal(hidden[i], "hide");
    if (unhidden) for (var i = 0; i < unhidden.length; ++i)
      if (unhidden[i].lines.length) signal(unhidden[i], "unhide");

    if (display.wrapper.offsetHeight)
      doc.scrollTop = cm.display.scroller.scrollTop;

    // Fire change events, and delayed event handlers
    if (op.changeObjs)
      signal(cm, "changes", cm, op.changeObjs);
    if (op.update)
      op.update.finish();
  }

  // Run the given function in an operation
  function runInOp(cm, f) {
    if (cm.curOp) return f();
    startOperation(cm);
    try { return f(); }
    finally { endOperation(cm); }
  }
  // Wraps a function in an operation. Returns the wrapped function.
  function operation(cm, f) {
    return function() {
      if (cm.curOp) return f.apply(cm, arguments);
      startOperation(cm);
      try { return f.apply(cm, arguments); }
      finally { endOperation(cm); }
    };
  }
  // Used to add methods to editor and doc instances, wrapping them in
  // operations.
  function methodOp(f) {
    return function() {
      if (this.curOp) return f.apply(this, arguments);
      startOperation(this);
      try { return f.apply(this, arguments); }
      finally { endOperation(this); }
    };
  }
  function docMethodOp(f) {
    return function() {
      var cm = this.cm;
      if (!cm || cm.curOp) return f.apply(this, arguments);
      startOperation(cm);
      try { return f.apply(this, arguments); }
      finally { endOperation(cm); }
    };
  }

  // VIEW TRACKING

  // These objects are used to represent the visible (currently drawn)
  // part of the document. A LineView may correspond to multiple
  // logical lines, if those are connected by collapsed ranges.
  function LineView(doc, line, lineN) {
    // The starting line
    this.line = line;
    // Continuing lines, if any
    this.rest = visualLineContinued(line);
    // Number of logical lines in this visual line
    this.size = this.rest ? lineNo(lst(this.rest)) - lineN + 1 : 1;
    this.node = this.text = null;
    this.hidden = lineIsHidden(doc, line);
  }

  // Create a range of LineView objects for the given lines.
  function buildViewArray(cm, from, to) {
    var array = [], nextPos;
    for (var pos = from; pos < to; pos = nextPos) {
      var view = new LineView(cm.doc, getLine(cm.doc, pos), pos);
      nextPos = pos + view.size;
      array.push(view);
    }
    return array;
  }

  // Updates the display.view data structure for a given change to the
  // document. From and to are in pre-change coordinates. Lendiff is
  // the amount of lines added or subtracted by the change. This is
  // used for changes that span multiple lines, or change the way
  // lines are divided into visual lines. regLineChange (below)
  // registers single-line changes.
  function regChange(cm, from, to, lendiff) {
    if (from == null) from = cm.doc.first;
    if (to == null) to = cm.doc.first + cm.doc.size;
    if (!lendiff) lendiff = 0;

    var display = cm.display;
    if (lendiff && to < display.viewTo &&
        (display.updateLineNumbers == null || display.updateLineNumbers > from))
      display.updateLineNumbers = from;

    cm.curOp.viewChanged = true;

    if (from >= display.viewTo) { // Change after
      if (sawCollapsedSpans && visualLineNo(cm.doc, from) < display.viewTo)
        resetView(cm);
    } else if (to <= display.viewFrom) { // Change before
      if (sawCollapsedSpans && visualLineEndNo(cm.doc, to + lendiff) > display.viewFrom) {
        resetView(cm);
      } else {
        display.viewFrom += lendiff;
        display.viewTo += lendiff;
      }
    } else if (from <= display.viewFrom && to >= display.viewTo) { // Full overlap
      resetView(cm);
    } else if (from <= display.viewFrom) { // Top overlap
      var cut = viewCuttingPoint(cm, to, to + lendiff, 1);
      if (cut) {
        display.view = display.view.slice(cut.index);
        display.viewFrom = cut.lineN;
        display.viewTo += lendiff;
      } else {
        resetView(cm);
      }
    } else if (to >= display.viewTo) { // Bottom overlap
      var cut = viewCuttingPoint(cm, from, from, -1);
      if (cut) {
        display.view = display.view.slice(0, cut.index);
        display.viewTo = cut.lineN;
      } else {
        resetView(cm);
      }
    } else { // Gap in the middle
      var cutTop = viewCuttingPoint(cm, from, from, -1);
      var cutBot = viewCuttingPoint(cm, to, to + lendiff, 1);
      if (cutTop && cutBot) {
        display.view = display.view.slice(0, cutTop.index)
          .concat(buildViewArray(cm, cutTop.lineN, cutBot.lineN))
          .concat(display.view.slice(cutBot.index));
        display.viewTo += lendiff;
      } else {
        resetView(cm);
      }
    }

    var ext = display.externalMeasured;
    if (ext) {
      if (to < ext.lineN)
        ext.lineN += lendiff;
      else if (from < ext.lineN + ext.size)
        display.externalMeasured = null;
    }
  }

  // Register a change to a single line. Type must be one of "text",
  // "gutter", "class", "widget"
  function regLineChange(cm, line, type) {
    cm.curOp.viewChanged = true;
    var display = cm.display, ext = cm.display.externalMeasured;
    if (ext && line >= ext.lineN && line < ext.lineN + ext.size)
      display.externalMeasured = null;

    if (line < display.viewFrom || line >= display.viewTo) return;
    var lineView = display.view[findViewIndex(cm, line)];
    if (lineView.node == null) return;
    var arr = lineView.changes || (lineView.changes = []);
    if (indexOf(arr, type) == -1) arr.push(type);
  }

  // Clear the view.
  function resetView(cm) {
    cm.display.viewFrom = cm.display.viewTo = cm.doc.first;
    cm.display.view = [];
    cm.display.viewOffset = 0;
  }

  // Find the view element corresponding to a given line. Return null
  // when the line isn't visible.
  function findViewIndex(cm, n) {
    if (n >= cm.display.viewTo) return null;
    n -= cm.display.viewFrom;
    if (n < 0) return null;
    var view = cm.display.view;
    for (var i = 0; i < view.length; i++) {
      n -= view[i].size;
      if (n < 0) return i;
    }
  }

  function viewCuttingPoint(cm, oldN, newN, dir) {
    var index = findViewIndex(cm, oldN), diff, view = cm.display.view;
    if (!sawCollapsedSpans || newN == cm.doc.first + cm.doc.size)
      return {index: index, lineN: newN};
    for (var i = 0, n = cm.display.viewFrom; i < index; i++)
      n += view[i].size;
    if (n != oldN) {
      if (dir > 0) {
        if (index == view.length - 1) return null;
        diff = (n + view[index].size) - oldN;
        index++;
      } else {
        diff = n - oldN;
      }
      oldN += diff; newN += diff;
    }
    while (visualLineNo(cm.doc, newN) != newN) {
      if (index == (dir < 0 ? 0 : view.length - 1)) return null;
      newN += dir * view[index - (dir < 0 ? 1 : 0)].size;
      index += dir;
    }
    return {index: index, lineN: newN};
  }

  // Force the view to cover a given range, adding empty view element
  // or clipping off existing ones as needed.
  function adjustView(cm, from, to) {
    var display = cm.display, view = display.view;
    if (view.length == 0 || from >= display.viewTo || to <= display.viewFrom) {
      display.view = buildViewArray(cm, from, to);
      display.viewFrom = from;
    } else {
      if (display.viewFrom > from)
        display.view = buildViewArray(cm, from, display.viewFrom).concat(display.view);
      else if (display.viewFrom < from)
        display.view = display.view.slice(findViewIndex(cm, from));
      display.viewFrom = from;
      if (display.viewTo < to)
        display.view = display.view.concat(buildViewArray(cm, display.viewTo, to));
      else if (display.viewTo > to)
        display.view = display.view.slice(0, findViewIndex(cm, to));
    }
    display.viewTo = to;
  }

  // Count the number of lines in the view whose DOM representation is
  // out of date (or nonexistent).
  function countDirtyView(cm) {
    var view = cm.display.view, dirty = 0;
    for (var i = 0; i < view.length; i++) {
      var lineView = view[i];
      if (!lineView.hidden && (!lineView.node || lineView.changes)) ++dirty;
    }
    return dirty;
  }

  // EVENT HANDLERS

  // Attach the necessary event handlers when initializing the editor
  function registerEventHandlers(cm) {
    var d = cm.display;
    on(d.scroller, "mousedown", operation(cm, onMouseDown));
    // Older IE's will not fire a second mousedown for a double click
    if (ie && ie_version < 11)
      on(d.scroller, "dblclick", operation(cm, function(e) {
        if (signalDOMEvent(cm, e)) return;
        var pos = posFromMouse(cm, e);
        if (!pos || clickInGutter(cm, e) || eventInWidget(cm.display, e)) return;
        e_preventDefault(e);
        var word = cm.findWordAt(pos);
        extendSelection(cm.doc, word.anchor, word.head);
      }));
    else
      on(d.scroller, "dblclick", function(e) { signalDOMEvent(cm, e) || e_preventDefault(e); });
    // Some browsers fire contextmenu *after* opening the menu, at
    // which point we can't mess with it anymore. Context menu is
    // handled in onMouseDown for these browsers.
    if (!captureRightClick) on(d.scroller, "contextmenu", function(e) {onContextMenu(cm, e);});

    // Used to suppress mouse event handling when a touch happens
    var touchFinished, prevTouch = {end: 0};
    function finishTouch() {
      if (d.activeTouch) {
        touchFinished = setTimeout(function() {d.activeTouch = null;}, 1000);
        prevTouch = d.activeTouch;
        prevTouch.end = +new Date;
      }
    };
    function isMouseLikeTouchEvent(e) {
      if (e.touches.length != 1) return false;
      var touch = e.touches[0];
      return touch.radiusX <= 1 && touch.radiusY <= 1;
    }
    function farAway(touch, other) {
      if (other.left == null) return true;
      var dx = other.left - touch.left, dy = other.top - touch.top;
      return dx * dx + dy * dy > 20 * 20;
    }
    on(d.scroller, "touchstart", function(e) {
      if (!signalDOMEvent(cm, e) && !isMouseLikeTouchEvent(e)) {
        clearTimeout(touchFinished);
        var now = +new Date;
        d.activeTouch = {start: now, moved: false,
                         prev: now - prevTouch.end <= 300 ? prevTouch : null};
        if (e.touches.length == 1) {
          d.activeTouch.left = e.touches[0].pageX;
          d.activeTouch.top = e.touches[0].pageY;
        }
      }
    });
    on(d.scroller, "touchmove", function() {
      if (d.activeTouch) d.activeTouch.moved = true;
    });
    on(d.scroller, "touchend", function(e) {
      var touch = d.activeTouch;
      if (touch && !eventInWidget(d, e) && touch.left != null &&
          !touch.moved && new Date - touch.start < 300) {
        var pos = cm.coordsChar(d.activeTouch, "page"), range;
        if (!touch.prev || farAway(touch, touch.prev)) // Single tap
          range = new Range(pos, pos);
        else if (!touch.prev.prev || farAway(touch, touch.prev.prev)) // Double tap
          range = cm.findWordAt(pos);
        else // Triple tap
          range = new Range(Pos(pos.line, 0), clipPos(cm.doc, Pos(pos.line + 1, 0)));
        cm.setSelection(range.anchor, range.head);
        cm.focus();
        e_preventDefault(e);
      }
      finishTouch();
    });
    on(d.scroller, "touchcancel", finishTouch);

    // Sync scrolling between fake scrollbars and real scrollable
    // area, ensure viewport is updated when scrolling.
    on(d.scroller, "scroll", function() {
      if (d.scroller.clientHeight) {
        setScrollTop(cm, d.scroller.scrollTop);
        setScrollLeft(cm, d.scroller.scrollLeft, true);
        signal(cm, "scroll", cm);
      }
    });

    // Listen to wheel events in order to try and update the viewport on time.
    on(d.scroller, "mousewheel", function(e){onScrollWheel(cm, e);});
    on(d.scroller, "DOMMouseScroll", function(e){onScrollWheel(cm, e);});

    // Prevent wrapper from ever scrolling
    on(d.wrapper, "scroll", function() { d.wrapper.scrollTop = d.wrapper.scrollLeft = 0; });

    d.dragFunctions = {
      enter: function(e) {if (!signalDOMEvent(cm, e)) e_stop(e);},
      over: function(e) {if (!signalDOMEvent(cm, e)) { onDragOver(cm, e); e_stop(e); }},
      start: function(e){onDragStart(cm, e);},
      drop: operation(cm, onDrop),
      leave: function() {clearDragCursor(cm);}
    };

    var inp = d.input.getField();
    on(inp, "keyup", function(e) { onKeyUp.call(cm, e); });
    on(inp, "keydown", operation(cm, onKeyDown));
    on(inp, "keypress", operation(cm, onKeyPress));
    on(inp, "focus", bind(onFocus, cm));
    on(inp, "blur", bind(onBlur, cm));
  }

  function dragDropChanged(cm, value, old) {
    var wasOn = old && old != CodeMirror.Init;
    if (!value != !wasOn) {
      var funcs = cm.display.dragFunctions;
      var toggle = value ? on : off;
      toggle(cm.display.scroller, "dragstart", funcs.start);
      toggle(cm.display.scroller, "dragenter", funcs.enter);
      toggle(cm.display.scroller, "dragover", funcs.over);
      toggle(cm.display.scroller, "dragleave", funcs.leave);
      toggle(cm.display.scroller, "drop", funcs.drop);
    }
  }

  // Called when the window resizes
  function onResize(cm) {
    var d = cm.display;
    if (d.lastWrapHeight == d.wrapper.clientHeight && d.lastWrapWidth == d.wrapper.clientWidth)
      return;
    // Might be a text scaling operation, clear size caches.
    d.cachedCharWidth = d.cachedTextHeight = d.cachedPaddingH = null;
    d.scrollbarsClipped = false;
    cm.setSize();
  }

  // MOUSE EVENTS

  // Return true when the given mouse event happened in a widget
  function eventInWidget(display, e) {
    for (var n = e_target(e); n != display.wrapper; n = n.parentNode) {
      if (!n || (n.nodeType == 1 && n.getAttribute("cm-ignore-events") == "true") ||
          (n.parentNode == display.sizer && n != display.mover))
        return true;
    }
  }

  // Given a mouse event, find the corresponding position. If liberal
  // is false, it checks whether a gutter or scrollbar was clicked,
  // and returns null if it was. forRect is used by rectangular
  // selections, and tries to estimate a character position even for
  // coordinates beyond the right of the text.
  function posFromMouse(cm, e, liberal, forRect) {
    var display = cm.display;
    if (!liberal && e_target(e).getAttribute("cm-not-content") == "true") return null;

    var x, y, space = display.lineSpace.getBoundingClientRect();
    // Fails unpredictably on IE[67] when mouse is dragged around quickly.
    try { x = e.clientX - space.left; y = e.clientY - space.top; }
    catch (e) { return null; }
    var coords = coordsChar(cm, x, y), line;
    if (forRect && coords.xRel == 1 && (line = getLine(cm.doc, coords.line).text).length == coords.ch) {
      var colDiff = countColumn(line, line.length, cm.options.tabSize) - line.length;
      coords = Pos(coords.line, Math.max(0, Math.round((x - paddingH(cm.display).left) / charWidth(cm.display)) - colDiff));
    }
    return coords;
  }

  // A mouse down can be a single click, double click, triple click,
  // start of selection drag, start of text drag, new cursor
  // (ctrl-click), rectangle drag (alt-drag), or xwin
  // middle-click-paste. Or it might be a click on something we should
  // not interfere with, such as a scrollbar or widget.
  function onMouseDown(e) {
    var cm = this, display = cm.display;
    if (signalDOMEvent(cm, e) || display.activeTouch && display.input.supportsTouch()) return;
    display.shift = e.shiftKey;

    if (eventInWidget(display, e)) {
      if (!webkit) {
        // Briefly turn off draggability, to allow widgets to do
        // normal dragging things.
        display.scroller.draggable = false;
        setTimeout(function(){display.scroller.draggable = true;}, 100);
      }
      return;
    }
    if (clickInGutter(cm, e)) return;
    var start = posFromMouse(cm, e);
    window.focus();

    switch (e_button(e)) {
    case 1:
      // #3261: make sure, that we're not starting a second selection
      if (cm.state.selectingText)
        cm.state.selectingText(e);
      else if (start)
        leftButtonDown(cm, e, start);
      else if (e_target(e) == display.scroller)
        e_preventDefault(e);
      break;
    case 2:
      if (webkit) cm.state.lastMiddleDown = +new Date;
      if (start) extendSelection(cm.doc, start);
      setTimeout(function() {display.input.focus();}, 20);
      e_preventDefault(e);
      break;
    case 3:
      if (captureRightClick) onContextMenu(cm, e);
      else delayBlurEvent(cm);
      break;
    }
  }

  var lastClick, lastDoubleClick;
  function leftButtonDown(cm, e, start) {
    if (ie) setTimeout(bind(ensureFocus, cm), 0);
    else cm.curOp.focus = activeElt();

    var now = +new Date, type;
    if (lastDoubleClick && lastDoubleClick.time > now - 400 && cmp(lastDoubleClick.pos, start) == 0) {
      type = "triple";
    } else if (lastClick && lastClick.time > now - 400 && cmp(lastClick.pos, start) == 0) {
      type = "double";
      lastDoubleClick = {time: now, pos: start};
    } else {
      type = "single";
      lastClick = {time: now, pos: start};
    }

    var sel = cm.doc.sel, modifier = mac ? e.metaKey : e.ctrlKey, contained;
    if (cm.options.dragDrop && dragAndDrop && !cm.isReadOnly() &&
        type == "single" && (contained = sel.contains(start)) > -1 &&
        (cmp((contained = sel.ranges[contained]).from(), start) < 0 || start.xRel > 0) &&
        (cmp(contained.to(), start) > 0 || start.xRel < 0))
      leftButtonStartDrag(cm, e, start, modifier);
    else
      leftButtonSelect(cm, e, start, type, modifier);
  }

  // Start a text drag. When it ends, see if any dragging actually
  // happen, and treat as a click if it didn't.
  function leftButtonStartDrag(cm, e, start, modifier) {
    var display = cm.display, startTime = +new Date;
    var dragEnd = operation(cm, function(e2) {
      if (webkit) display.scroller.draggable = false;
      cm.state.draggingText = false;
      off(document, "mouseup", dragEnd);
      off(display.scroller, "drop", dragEnd);
      if (Math.abs(e.clientX - e2.clientX) + Math.abs(e.clientY - e2.clientY) < 10) {
        e_preventDefault(e2);
        if (!modifier && +new Date - 200 < startTime)
          extendSelection(cm.doc, start);
        // Work around unexplainable focus problem in IE9 (#2127) and Chrome (#3081)
        if (webkit || ie && ie_version == 9)
          setTimeout(function() {document.body.focus(); display.input.focus();}, 20);
        else
          display.input.focus();
      }
    });
    // Let the drag handler handle this.
    if (webkit) display.scroller.draggable = true;
    cm.state.draggingText = dragEnd;
    // IE's approach to draggable
    if (display.scroller.dragDrop) display.scroller.dragDrop();
    on(document, "mouseup", dragEnd);
    on(display.scroller, "drop", dragEnd);
  }

  // Normal selection, as opposed to text dragging.
  function leftButtonSelect(cm, e, start, type, addNew) {
    var display = cm.display, doc = cm.doc;
    e_preventDefault(e);

    var ourRange, ourIndex, startSel = doc.sel, ranges = startSel.ranges;
    if (addNew && !e.shiftKey) {
      ourIndex = doc.sel.contains(start);
      if (ourIndex > -1)
        ourRange = ranges[ourIndex];
      else
        ourRange = new Range(start, start);
    } else {
      ourRange = doc.sel.primary();
      ourIndex = doc.sel.primIndex;
    }

    if (e.altKey) {
      type = "rect";
      if (!addNew) ourRange = new Range(start, start);
      start = posFromMouse(cm, e, true, true);
      ourIndex = -1;
    } else if (type == "double") {
      var word = cm.findWordAt(start);
      if (cm.display.shift || doc.extend)
        ourRange = extendRange(doc, ourRange, word.anchor, word.head);
      else
        ourRange = word;
    } else if (type == "triple") {
      var line = new Range(Pos(start.line, 0), clipPos(doc, Pos(start.line + 1, 0)));
      if (cm.display.shift || doc.extend)
        ourRange = extendRange(doc, ourRange, line.anchor, line.head);
      else
        ourRange = line;
    } else {
      ourRange = extendRange(doc, ourRange, start);
    }

    if (!addNew) {
      ourIndex = 0;
      setSelection(doc, new Selection([ourRange], 0), sel_mouse);
      startSel = doc.sel;
    } else if (ourIndex == -1) {
      ourIndex = ranges.length;
      setSelection(doc, normalizeSelection(ranges.concat([ourRange]), ourIndex),
                   {scroll: false, origin: "*mouse"});
    } else if (ranges.length > 1 && ranges[ourIndex].empty() && type == "single" && !e.shiftKey) {
      setSelection(doc, normalizeSelection(ranges.slice(0, ourIndex).concat(ranges.slice(ourIndex + 1)), 0),
                   {scroll: false, origin: "*mouse"});
      startSel = doc.sel;
    } else {
      replaceOneSelection(doc, ourIndex, ourRange, sel_mouse);
    }

    var lastPos = start;
    function extendTo(pos) {
      if (cmp(lastPos, pos) == 0) return;
      lastPos = pos;

      if (type == "rect") {
        var ranges = [], tabSize = cm.options.tabSize;
        var startCol = countColumn(getLine(doc, start.line).text, start.ch, tabSize);
        var posCol = countColumn(getLine(doc, pos.line).text, pos.ch, tabSize);
        var left = Math.min(startCol, posCol), right = Math.max(startCol, posCol);
        for (var line = Math.min(start.line, pos.line), end = Math.min(cm.lastLine(), Math.max(start.line, pos.line));
             line <= end; line++) {
          var text = getLine(doc, line).text, leftPos = findColumn(text, left, tabSize);
          if (left == right)
            ranges.push(new Range(Pos(line, leftPos), Pos(line, leftPos)));
          else if (text.length > leftPos)
            ranges.push(new Range(Pos(line, leftPos), Pos(line, findColumn(text, right, tabSize))));
        }
        if (!ranges.length) ranges.push(new Range(start, start));
        setSelection(doc, normalizeSelection(startSel.ranges.slice(0, ourIndex).concat(ranges), ourIndex),
                     {origin: "*mouse", scroll: false});
        cm.scrollIntoView(pos);
      } else {
        var oldRange = ourRange;
        var anchor = oldRange.anchor, head = pos;
        if (type != "single") {
          if (type == "double")
            var range = cm.findWordAt(pos);
          else
            var range = new Range(Pos(pos.line, 0), clipPos(doc, Pos(pos.line + 1, 0)));
          if (cmp(range.anchor, anchor) > 0) {
            head = range.head;
            anchor = minPos(oldRange.from(), range.anchor);
          } else {
            head = range.anchor;
            anchor = maxPos(oldRange.to(), range.head);
          }
        }
        var ranges = startSel.ranges.slice(0);
        ranges[ourIndex] = new Range(clipPos(doc, anchor), head);
        setSelection(doc, normalizeSelection(ranges, ourIndex), sel_mouse);
      }
    }

    var editorSize = display.wrapper.getBoundingClientRect();
    // Used to ensure timeout re-tries don't fire when another extend
    // happened in the meantime (clearTimeout isn't reliable -- at
    // least on Chrome, the timeouts still happen even when cleared,
    // if the clear happens after their scheduled firing time).
    var counter = 0;

    function extend(e) {
      var curCount = ++counter;
      var cur = posFromMouse(cm, e, true, type == "rect");
      if (!cur) return;
      if (cmp(cur, lastPos) != 0) {
        cm.curOp.focus = activeElt();
        extendTo(cur);
        var visible = visibleLines(display, doc);
        if (cur.line >= visible.to || cur.line < visible.from)
          setTimeout(operation(cm, function(){if (counter == curCount) extend(e);}), 150);
      } else {
        var outside = e.clientY < editorSize.top ? -20 : e.clientY > editorSize.bottom ? 20 : 0;
        if (outside) setTimeout(operation(cm, function() {
          if (counter != curCount) return;
          display.scroller.scrollTop += outside;
          extend(e);
        }), 50);
      }
    }

    function done(e) {
      cm.state.selectingText = false;
      counter = Infinity;
      e_preventDefault(e);
      display.input.focus();
      off(document, "mousemove", move);
      off(document, "mouseup", up);
      doc.history.lastSelOrigin = null;
    }

    var move = operation(cm, function(e) {
      if (!e_button(e)) done(e);
      else extend(e);
    });
    var up = operation(cm, done);
    cm.state.selectingText = up;
    on(document, "mousemove", move);
    on(document, "mouseup", up);
  }

  // Determines whether an event happened in the gutter, and fires the
  // handlers for the corresponding event.
  function gutterEvent(cm, e, type, prevent) {
    try { var mX = e.clientX, mY = e.clientY; }
    catch(e) { return false; }
    if (mX >= Math.floor(cm.display.gutters.getBoundingClientRect().right)) return false;
    if (prevent) e_preventDefault(e);

    var display = cm.display;
    var lineBox = display.lineDiv.getBoundingClientRect();

    if (mY > lineBox.bottom || !hasHandler(cm, type)) return e_defaultPrevented(e);
    mY -= lineBox.top - display.viewOffset;

    for (var i = 0; i < cm.options.gutters.length; ++i) {
      var g = display.gutters.childNodes[i];
      if (g && g.getBoundingClientRect().right >= mX) {
        var line = lineAtHeight(cm.doc, mY);
        var gutter = cm.options.gutters[i];
        signal(cm, type, cm, line, gutter, e);
        return e_defaultPrevented(e);
      }
    }
  }

  function clickInGutter(cm, e) {
    return gutterEvent(cm, e, "gutterClick", true);
  }

  // Kludge to work around strange IE behavior where it'll sometimes
  // re-fire a series of drag-related events right after the drop (#1551)
  var lastDrop = 0;

  function onDrop(e) {
    var cm = this;
    clearDragCursor(cm);
    if (signalDOMEvent(cm, e) || eventInWidget(cm.display, e))
      return;
    e_preventDefault(e);
    if (ie) lastDrop = +new Date;
    var pos = posFromMouse(cm, e, true), files = e.dataTransfer.files;
    if (!pos || cm.isReadOnly()) return;
    // Might be a file drop, in which case we simply extract the text
    // and insert it.
    if (files && files.length && window.FileReader && window.File) {
      var n = files.length, text = Array(n), read = 0;
      var loadFile = function(file, i) {
        if (cm.options.allowDropFileTypes &&
            indexOf(cm.options.allowDropFileTypes, file.type) == -1)
          return;

        var reader = new FileReader;
        reader.onload = operation(cm, function() {
          var content = reader.result;
          if (/[\x00-\x08\x0e-\x1f]{2}/.test(content)) content = "";
          text[i] = content;
          if (++read == n) {
            pos = clipPos(cm.doc, pos);
            var change = {from: pos, to: pos,
                          text: cm.doc.splitLines(text.join(cm.doc.lineSeparator())),
                          origin: "paste"};
            makeChange(cm.doc, change);
            setSelectionReplaceHistory(cm.doc, simpleSelection(pos, changeEnd(change)));
          }
        });
        reader.readAsText(file);
      };
      for (var i = 0; i < n; ++i) loadFile(files[i], i);
    } else { // Normal drop
      // Don't do a replace if the drop happened inside of the selected text.
      if (cm.state.draggingText && cm.doc.sel.contains(pos) > -1) {
        cm.state.draggingText(e);
        // Ensure the editor is re-focused
        setTimeout(function() {cm.display.input.focus();}, 20);
        return;
      }
      try {
        var text = e.dataTransfer.getData("Text");
        if (text) {
          if (cm.state.draggingText && !(mac ? e.altKey : e.ctrlKey))
            var selected = cm.listSelections();
          setSelectionNoUndo(cm.doc, simpleSelection(pos, pos));
          if (selected) for (var i = 0; i < selected.length; ++i)
            replaceRange(cm.doc, "", selected[i].anchor, selected[i].head, "drag");
          cm.replaceSelection(text, "around", "paste");
          cm.display.input.focus();
        }
      }
      catch(e){}
    }
  }

  function onDragStart(cm, e) {
    if (ie && (!cm.state.draggingText || +new Date - lastDrop < 100)) { e_stop(e); return; }
    if (signalDOMEvent(cm, e) || eventInWidget(cm.display, e)) return;

    e.dataTransfer.setData("Text", cm.getSelection());

    // Use dummy image instead of default browsers image.
    // Recent Safari (~6.0.2) have a tendency to segfault when this happens, so we don't do it there.
    if (e.dataTransfer.setDragImage && !safari) {
      var img = elt("img", null, null, "position: fixed; left: 0; top: 0;");
      img.src = "data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==";
      if (presto) {
        img.width = img.height = 1;
        cm.display.wrapper.appendChild(img);
        // Force a relayout, or Opera won't use our image for some obscure reason
        img._top = img.offsetTop;
      }
      e.dataTransfer.setDragImage(img, 0, 0);
      if (presto) img.parentNode.removeChild(img);
    }
  }

  function onDragOver(cm, e) {
    var pos = posFromMouse(cm, e);
    if (!pos) return;
    var frag = document.createDocumentFragment();
    drawSelectionCursor(cm, pos, frag);
    if (!cm.display.dragCursor) {
      cm.display.dragCursor = elt("div", null, "CodeMirror-cursors CodeMirror-dragcursors");
      cm.display.lineSpace.insertBefore(cm.display.dragCursor, cm.display.cursorDiv);
    }
    removeChildrenAndAdd(cm.display.dragCursor, frag);
  }

  function clearDragCursor(cm) {
    if (cm.display.dragCursor) {
      cm.display.lineSpace.removeChild(cm.display.dragCursor);
      cm.display.dragCursor = null;
    }
  }

  // SCROLL EVENTS

  // Sync the scrollable area and scrollbars, ensure the viewport
  // covers the visible area.
  function setScrollTop(cm, val) {
    if (Math.abs(cm.doc.scrollTop - val) < 2) return;
    cm.doc.scrollTop = val;
    if (!gecko) updateDisplaySimple(cm, {top: val});
    if (cm.display.scroller.scrollTop != val) cm.display.scroller.scrollTop = val;
    cm.display.scrollbars.setScrollTop(val);
    if (gecko) updateDisplaySimple(cm);
    startWorker(cm, 100);
  }
  // Sync scroller and scrollbar, ensure the gutter elements are
  // aligned.
  function setScrollLeft(cm, val, isScroller) {
    if (isScroller ? val == cm.doc.scrollLeft : Math.abs(cm.doc.scrollLeft - val) < 2) return;
    val = Math.min(val, cm.display.scroller.scrollWidth - cm.display.scroller.clientWidth);
    cm.doc.scrollLeft = val;
    alignHorizontally(cm);
    if (cm.display.scroller.scrollLeft != val) cm.display.scroller.scrollLeft = val;
    cm.display.scrollbars.setScrollLeft(val);
  }

  // Since the delta values reported on mouse wheel events are
  // unstandardized between browsers and even browser versions, and
  // generally horribly unpredictable, this code starts by measuring
  // the scroll effect that the first few mouse wheel events have,
  // and, from that, detects the way it can convert deltas to pixel
  // offsets afterwards.
  //
  // The reason we want to know the amount a wheel event will scroll
  // is that it gives us a chance to update the display before the
  // actual scrolling happens, reducing flickering.

  var wheelSamples = 0, wheelPixelsPerUnit = null;
  // Fill in a browser-detected starting value on browsers where we
  // know one. These don't have to be accurate -- the result of them
  // being wrong would just be a slight flicker on the first wheel
  // scroll (if it is large enough).
  if (ie) wheelPixelsPerUnit = -.53;
  else if (gecko) wheelPixelsPerUnit = 15;
  else if (chrome) wheelPixelsPerUnit = -.7;
  else if (safari) wheelPixelsPerUnit = -1/3;

  var wheelEventDelta = function(e) {
    var dx = e.wheelDeltaX, dy = e.wheelDeltaY;
    if (dx == null && e.detail && e.axis == e.HORIZONTAL_AXIS) dx = e.detail;
    if (dy == null && e.detail && e.axis == e.VERTICAL_AXIS) dy = e.detail;
    else if (dy == null) dy = e.wheelDelta;
    return {x: dx, y: dy};
  };
  CodeMirror.wheelEventPixels = function(e) {
    var delta = wheelEventDelta(e);
    delta.x *= wheelPixelsPerUnit;
    delta.y *= wheelPixelsPerUnit;
    return delta;
  };

  function onScrollWheel(cm, e) {
    var delta = wheelEventDelta(e), dx = delta.x, dy = delta.y;

    var display = cm.display, scroll = display.scroller;
    // Quit if there's nothing to scroll here
    var canScrollX = scroll.scrollWidth > scroll.clientWidth;
    var canScrollY = scroll.scrollHeight > scroll.clientHeight;
    if (!(dx && canScrollX || dy && canScrollY)) return;

    // Webkit browsers on OS X abort momentum scrolls when the target
    // of the scroll event is removed from the scrollable element.
    // This hack (see related code in patchDisplay) makes sure the
    // element is kept around.
    if (dy && mac && webkit) {
      outer: for (var cur = e.target, view = display.view; cur != scroll; cur = cur.parentNode) {
        for (var i = 0; i < view.length; i++) {
          if (view[i].node == cur) {
            cm.display.currentWheelTarget = cur;
            break outer;
          }
        }
      }
    }

    // On some browsers, horizontal scrolling will cause redraws to
    // happen before the gutter has been realigned, causing it to
    // wriggle around in a most unseemly way. When we have an
    // estimated pixels/delta value, we just handle horizontal
    // scrolling entirely here. It'll be slightly off from native, but
    // better than glitching out.
    if (dx && !gecko && !presto && wheelPixelsPerUnit != null) {
      if (dy && canScrollY)
        setScrollTop(cm, Math.max(0, Math.min(scroll.scrollTop + dy * wheelPixelsPerUnit, scroll.scrollHeight - scroll.clientHeight)));
      setScrollLeft(cm, Math.max(0, Math.min(scroll.scrollLeft + dx * wheelPixelsPerUnit, scroll.scrollWidth - scroll.clientWidth)));
      // Only prevent default scrolling if vertical scrolling is
      // actually possible. Otherwise, it causes vertical scroll
      // jitter on OSX trackpads when deltaX is small and deltaY
      // is large (issue #3579)
      if (!dy || (dy && canScrollY))
        e_preventDefault(e);
      display.wheelStartX = null; // Abort measurement, if in progress
      return;
    }

    // 'Project' the visible viewport to cover the area that is being
    // scrolled into view (if we know enough to estimate it).
    if (dy && wheelPixelsPerUnit != null) {
      var pixels = dy * wheelPixelsPerUnit;
      var top = cm.doc.scrollTop, bot = top + display.wrapper.clientHeight;
      if (pixels < 0) top = Math.max(0, top + pixels - 50);
      else bot = Math.min(cm.doc.height, bot + pixels + 50);
      updateDisplaySimple(cm, {top: top, bottom: bot});
    }

    if (wheelSamples < 20) {
      if (display.wheelStartX == null) {
        display.wheelStartX = scroll.scrollLeft; display.wheelStartY = scroll.scrollTop;
        display.wheelDX = dx; display.wheelDY = dy;
        setTimeout(function() {
          if (display.wheelStartX == null) return;
          var movedX = scroll.scrollLeft - display.wheelStartX;
          var movedY = scroll.scrollTop - display.wheelStartY;
          var sample = (movedY && display.wheelDY && movedY / display.wheelDY) ||
            (movedX && display.wheelDX && movedX / display.wheelDX);
          display.wheelStartX = display.wheelStartY = null;
          if (!sample) return;
          wheelPixelsPerUnit = (wheelPixelsPerUnit * wheelSamples + sample) / (wheelSamples + 1);
          ++wheelSamples;
        }, 200);
      } else {
        display.wheelDX += dx; display.wheelDY += dy;
      }
    }
  }

  // KEY EVENTS

  // Run a handler that was bound to a key.
  function doHandleBinding(cm, bound, dropShift) {
    if (typeof bound == "string") {
      bound = commands[bound];
      if (!bound) return false;
    }
    // Ensure previous input has been read, so that the handler sees a
    // consistent view of the document
    cm.display.input.ensurePolled();
    var prevShift = cm.display.shift, done = false;
    try {
      if (cm.isReadOnly()) cm.state.suppressEdits = true;
      if (dropShift) cm.display.shift = false;
      done = bound(cm) != Pass;
    } finally {
      cm.display.shift = prevShift;
      cm.state.suppressEdits = false;
    }
    return done;
  }

  function lookupKeyForEditor(cm, name, handle) {
    for (var i = 0; i < cm.state.keyMaps.length; i++) {
      var result = lookupKey(name, cm.state.keyMaps[i], handle, cm);
      if (result) return result;
    }
    return (cm.options.extraKeys && lookupKey(name, cm.options.extraKeys, handle, cm))
      || lookupKey(name, cm.options.keyMap, handle, cm);
  }

  var stopSeq = new Delayed;
  function dispatchKey(cm, name, e, handle) {
    var seq = cm.state.keySeq;
    if (seq) {
      if (isModifierKey(name)) return "handled";
      stopSeq.set(50, function() {
        if (cm.state.keySeq == seq) {
          cm.state.keySeq = null;
          cm.display.input.reset();
        }
      });
      name = seq + " " + name;
    }
    var result = lookupKeyForEditor(cm, name, handle);

    if (result == "multi")
      cm.state.keySeq = name;
    if (result == "handled")
      signalLater(cm, "keyHandled", cm, name, e);

    if (result == "handled" || result == "multi") {
      e_preventDefault(e);
      restartBlink(cm);
    }

    if (seq && !result && /\'$/.test(name)) {
      e_preventDefault(e);
      return true;
    }
    return !!result;
  }

  // Handle a key from the keydown event.
  function handleKeyBinding(cm, e) {
    var name = keyName(e, true);
    if (!name) return false;

    if (e.shiftKey && !cm.state.keySeq) {
      // First try to resolve full name (including 'Shift-'). Failing
      // that, see if there is a cursor-motion command (starting with
      // 'go') bound to the keyname without 'Shift-'.
      return dispatchKey(cm, "Shift-" + name, e, function(b) {return doHandleBinding(cm, b, true);})
          || dispatchKey(cm, name, e, function(b) {
               if (typeof b == "string" ? /^go[A-Z]/.test(b) : b.motion)
                 return doHandleBinding(cm, b);
             });
    } else {
      return dispatchKey(cm, name, e, function(b) { return doHandleBinding(cm, b); });
    }
  }

  // Handle a key from the keypress event
  function handleCharBinding(cm, e, ch) {
    return dispatchKey(cm, "'" + ch + "'", e,
                       function(b) { return doHandleBinding(cm, b, true); });
  }

  var lastStoppedKey = null;
  function onKeyDown(e) {
    var cm = this;
    cm.curOp.focus = activeElt();
    if (signalDOMEvent(cm, e)) return;
    // IE does strange things with escape.
    if (ie && ie_version < 11 && e.keyCode == 27) e.returnValue = false;
    var code = e.keyCode;
    cm.display.shift = code == 16 || e.shiftKey;
    var handled = handleKeyBinding(cm, e);
    if (presto) {
      lastStoppedKey = handled ? code : null;
      // Opera has no cut event... we try to at least catch the key combo
      if (!handled && code == 88 && !hasCopyEvent && (mac ? e.metaKey : e.ctrlKey))
        cm.replaceSelection("", null, "cut");
    }

    // Turn mouse into crosshair when Alt is held on Mac.
    if (code == 18 && !/\bCodeMirror-crosshair\b/.test(cm.display.lineDiv.className))
      showCrossHair(cm);
  }

  function showCrossHair(cm) {
    var lineDiv = cm.display.lineDiv;
    addClass(lineDiv, "CodeMirror-crosshair");

    function up(e) {
      if (e.keyCode == 18 || !e.altKey) {
        rmClass(lineDiv, "CodeMirror-crosshair");
        off(document, "keyup", up);
        off(document, "mouseover", up);
      }
    }
    on(document, "keyup", up);
    on(document, "mouseover", up);
  }

  function onKeyUp(e) {
    if (e.keyCode == 16) this.doc.sel.shift = false;
    signalDOMEvent(this, e);
  }

  function onKeyPress(e) {
    var cm = this;
    if (eventInWidget(cm.display, e) || signalDOMEvent(cm, e) || e.ctrlKey && !e.altKey || mac && e.metaKey) return;
    var keyCode = e.keyCode, charCode = e.charCode;
    if (presto && keyCode == lastStoppedKey) {lastStoppedKey = null; e_preventDefault(e); return;}
    if ((presto && (!e.which || e.which < 10)) && handleKeyBinding(cm, e)) return;
    var ch = String.fromCharCode(charCode == null ? keyCode : charCode);
    if (handleCharBinding(cm, e, ch)) return;
    cm.display.input.onKeyPress(e);
  }

  // FOCUS/BLUR EVENTS

  function delayBlurEvent(cm) {
    cm.state.delayingBlurEvent = true;
    setTimeout(function() {
      if (cm.state.delayingBlurEvent) {
        cm.state.delayingBlurEvent = false;
        onBlur(cm);
      }
    }, 100);
  }

  function onFocus(cm) {
    if (cm.state.delayingBlurEvent) cm.state.delayingBlurEvent = false;

    if (cm.options.readOnly == "nocursor") return;
    if (!cm.state.focused) {
      signal(cm, "focus", cm);
      cm.state.focused = true;
      addClass(cm.display.wrapper, "CodeMirror-focused");
      // This test prevents this from firing when a context
      // menu is closed (since the input reset would kill the
      // select-all detection hack)
      if (!cm.curOp && cm.display.selForContextMenu != cm.doc.sel) {
        cm.display.input.reset();
        if (webkit) setTimeout(function() { cm.display.input.reset(true); }, 20); // Issue #1730
      }
      cm.display.input.receivedFocus();
    }
    restartBlink(cm);
  }
  function onBlur(cm) {
    if (cm.state.delayingBlurEvent) return;

    if (cm.state.focused) {
      signal(cm, "blur", cm);
      cm.state.focused = false;
      rmClass(cm.display.wrapper, "CodeMirror-focused");
    }
    clearInterval(cm.display.blinker);
    setTimeout(function() {if (!cm.state.focused) cm.display.shift = false;}, 150);
  }

  // CONTEXT MENU HANDLING

  // To make the context menu work, we need to briefly unhide the
  // textarea (making it as unobtrusive as possible) to let the
  // right-click take effect on it.
  function onContextMenu(cm, e) {
    if (eventInWidget(cm.display, e) || contextMenuInGutter(cm, e)) return;
    if (signalDOMEvent(cm, e, "contextmenu")) return;
    cm.display.input.onContextMenu(e);
  }

  function contextMenuInGutter(cm, e) {
    if (!hasHandler(cm, "gutterContextMenu")) return false;
    return gutterEvent(cm, e, "gutterContextMenu", false);
  }

  // UPDATING

  // Compute the position of the end of a change (its 'to' property
  // refers to the pre-change end).
  var changeEnd = CodeMirror.changeEnd = function(change) {
    if (!change.text) return change.to;
    return Pos(change.from.line + change.text.length - 1,
               lst(change.text).length + (change.text.length == 1 ? change.from.ch : 0));
  };

  // Adjust a position to refer to the post-change position of the
  // same text, or the end of the change if the change covers it.
  function adjustForChange(pos, change) {
    if (cmp(pos, change.from) < 0) return pos;
    if (cmp(pos, change.to) <= 0) return changeEnd(change);

    var line = pos.line + change.text.length - (change.to.line - change.from.line) - 1, ch = pos.ch;
    if (pos.line == change.to.line) ch += changeEnd(change).ch - change.to.ch;
    return Pos(line, ch);
  }

  function computeSelAfterChange(doc, change) {
    var out = [];
    for (var i = 0; i < doc.sel.ranges.length; i++) {
      var range = doc.sel.ranges[i];
      out.push(new Range(adjustForChange(range.anchor, change),
                         adjustForChange(range.head, change)));
    }
    return normalizeSelection(out, doc.sel.primIndex);
  }

  function offsetPos(pos, old, nw) {
    if (pos.line == old.line)
      return Pos(nw.line, pos.ch - old.ch + nw.ch);
    else
      return Pos(nw.line + (pos.line - old.line), pos.ch);
  }

  // Used by replaceSelections to allow moving the selection to the
  // start or around the replaced test. Hint may be "start" or "around".
  function computeReplacedSel(doc, changes, hint) {
    var out = [];
    var oldPrev = Pos(doc.first, 0), newPrev = oldPrev;
    for (var i = 0; i < changes.length; i++) {
      var change = changes[i];
      var from = offsetPos(change.from, oldPrev, newPrev);
      var to = offsetPos(changeEnd(change), oldPrev, newPrev);
      oldPrev = change.to;
      newPrev = to;
      if (hint == "around") {
        var range = doc.sel.ranges[i], inv = cmp(range.head, range.anchor) < 0;
        out[i] = new Range(inv ? to : from, inv ? from : to);
      } else {
        out[i] = new Range(from, from);
      }
    }
    return new Selection(out, doc.sel.primIndex);
  }

  // Allow "beforeChange" event handlers to influence a change
  function filterChange(doc, change, update) {
    var obj = {
      canceled: false,
      from: change.from,
      to: change.to,
      text: change.text,
      origin: change.origin,
      cancel: function() { this.canceled = true; }
    };
    if (update) obj.update = function(from, to, text, origin) {
      if (from) this.from = clipPos(doc, from);
      if (to) this.to = clipPos(doc, to);
      if (text) this.text = text;
      if (origin !== undefined) this.origin = origin;
    };
    signal(doc, "beforeChange", doc, obj);
    if (doc.cm) signal(doc.cm, "beforeChange", doc.cm, obj);

    if (obj.canceled) return null;
    return {from: obj.from, to: obj.to, text: obj.text, origin: obj.origin};
  }

  // Apply a change to a document, and add it to the document's
  // history, and propagating it to all linked documents.
  function makeChange(doc, change, ignoreReadOnly) {
    if (doc.cm) {
      if (!doc.cm.curOp) return operation(doc.cm, makeChange)(doc, change, ignoreReadOnly);
      if (doc.cm.state.suppressEdits) return;
    }

    if (hasHandler(doc, "beforeChange") || doc.cm && hasHandler(doc.cm, "beforeChange")) {
      change = filterChange(doc, change, true);
      if (!change) return;
    }

    // Possibly split or suppress the update based on the presence
    // of read-only spans in its range.
    var split = sawReadOnlySpans && !ignoreReadOnly && removeReadOnlyRanges(doc, change.from, change.to);
    if (split) {
      for (var i = split.length - 1; i >= 0; --i)
        makeChangeInner(doc, {from: split[i].from, to: split[i].to, text: i ? [""] : change.text});
    } else {
      makeChangeInner(doc, change);
    }
  }

  function makeChangeInner(doc, change) {
    if (change.text.length == 1 && change.text[0] == "" && cmp(change.from, change.to) == 0) return;
    var selAfter = computeSelAfterChange(doc, change);
    addChangeToHistory(doc, change, selAfter, doc.cm ? doc.cm.curOp.id : NaN);

    makeChangeSingleDoc(doc, change, selAfter, stretchSpansOverChange(doc, change));
    var rebased = [];

    linkedDocs(doc, function(doc, sharedHist) {
      if (!sharedHist && indexOf(rebased, doc.history) == -1) {
        rebaseHist(doc.history, change);
        rebased.push(doc.history);
      }
      makeChangeSingleDoc(doc, change, null, stretchSpansOverChange(doc, change));
    });
  }

  // Revert a change stored in a document's history.
  function makeChangeFromHistory(doc, type, allowSelectionOnly) {
    if (doc.cm && doc.cm.state.suppressEdits) return;

    var hist = doc.history, event, selAfter = doc.sel;
    var source = type == "undo" ? hist.done : hist.undone, dest = type == "undo" ? hist.undone : hist.done;

    // Verify that there is a useable event (so that ctrl-z won't
    // needlessly clear selection events)
    for (var i = 0; i < source.length; i++) {
      event = source[i];
      if (allowSelectionOnly ? event.ranges && !event.equals(doc.sel) : !event.ranges)
        break;
    }
    if (i == source.length) return;
    hist.lastOrigin = hist.lastSelOrigin = null;

    for (;;) {
      event = source.pop();
      if (event.ranges) {
        pushSelectionToHistory(event, dest);
        if (allowSelectionOnly && !event.equals(doc.sel)) {
          setSelection(doc, event, {clearRedo: false});
          return;
        }
        selAfter = event;
      }
      else break;
    }

    // Build up a reverse change object to add to the opposite history
    // stack (redo when undoing, and vice versa).
    var antiChanges = [];
    pushSelectionToHistory(selAfter, dest);
    dest.push({changes: antiChanges, generation: hist.generation});
    hist.generation = event.generation || ++hist.maxGeneration;

    var filter = hasHandler(doc, "beforeChange") || doc.cm && hasHandler(doc.cm, "beforeChange");

    for (var i = event.changes.length - 1; i >= 0; --i) {
      var change = event.changes[i];
      change.origin = type;
      if (filter && !filterChange(doc, change, false)) {
        source.length = 0;
        return;
      }

      antiChanges.push(historyChangeFromChange(doc, change));

      var after = i ? computeSelAfterChange(doc, change) : lst(source);
      makeChangeSingleDoc(doc, change, after, mergeOldSpans(doc, change));
      if (!i && doc.cm) doc.cm.scrollIntoView({from: change.from, to: changeEnd(change)});
      var rebased = [];

      // Propagate to the linked documents
      linkedDocs(doc, function(doc, sharedHist) {
        if (!sharedHist && indexOf(rebased, doc.history) == -1) {
          rebaseHist(doc.history, change);
          rebased.push(doc.history);
        }
        makeChangeSingleDoc(doc, change, null, mergeOldSpans(doc, change));
      });
    }
  }

  // Sub-views need their line numbers shifted when text is added
  // above or below them in the parent document.
  function shiftDoc(doc, distance) {
    if (distance == 0) return;
    doc.first += distance;
    doc.sel = new Selection(map(doc.sel.ranges, function(range) {
      return new Range(Pos(range.anchor.line + distance, range.anchor.ch),
                       Pos(range.head.line + distance, range.head.ch));
    }), doc.sel.primIndex);
    if (doc.cm) {
      regChange(doc.cm, doc.first, doc.first - distance, distance);
      for (var d = doc.cm.display, l = d.viewFrom; l < d.viewTo; l++)
        regLineChange(doc.cm, l, "gutter");
    }
  }

  // More lower-level change function, handling only a single document
  // (not linked ones).
  function makeChangeSingleDoc(doc, change, selAfter, spans) {
    if (doc.cm && !doc.cm.curOp)
      return operation(doc.cm, makeChangeSingleDoc)(doc, change, selAfter, spans);

    if (change.to.line < doc.first) {
      shiftDoc(doc, change.text.length - 1 - (change.to.line - change.from.line));
      return;
    }
    if (change.from.line > doc.lastLine()) return;

    // Clip the change to the size of this doc
    if (change.from.line < doc.first) {
      var shift = change.text.length - 1 - (doc.first - change.from.line);
      shiftDoc(doc, shift);
      change = {from: Pos(doc.first, 0), to: Pos(change.to.line + shift, change.to.ch),
                text: [lst(change.text)], origin: change.origin};
    }
    var last = doc.lastLine();
    if (change.to.line > last) {
      change = {from: change.from, to: Pos(last, getLine(doc, last).text.length),
                text: [change.text[0]], origin: change.origin};
    }

    change.removed = getBetween(doc, change.from, change.to);

    if (!selAfter) selAfter = computeSelAfterChange(doc, change);
    if (doc.cm) makeChangeSingleDocInEditor(doc.cm, change, spans);
    else updateDoc(doc, change, spans);
    setSelectionNoUndo(doc, selAfter, sel_dontScroll);
  }

  // Handle the interaction of a change to a document with the editor
  // that this document is part of.
  function makeChangeSingleDocInEditor(cm, change, spans) {
    var doc = cm.doc, display = cm.display, from = change.from, to = change.to;

    var recomputeMaxLength = false, checkWidthStart = from.line;
    if (!cm.options.lineWrapping) {
      checkWidthStart = lineNo(visualLine(getLine(doc, from.line)));
      doc.iter(checkWidthStart, to.line + 1, function(line) {
        if (line == display.maxLine) {
          recomputeMaxLength = true;
          return true;
        }
      });
    }

    if (doc.sel.contains(change.from, change.to) > -1)
      signalCursorActivity(cm);

    updateDoc(doc, change, spans, estimateHeight(cm));

    if (!cm.options.lineWrapping) {
      doc.iter(checkWidthStart, from.line + change.text.length, function(line) {
        var len = lineLength(line);
        if (len > display.maxLineLength) {
          display.maxLine = line;
          display.maxLineLength = len;
          display.maxLineChanged = true;
          recomputeMaxLength = false;
        }
      });
      if (recomputeMaxLength) cm.curOp.updateMaxLine = true;
    }

    // Adjust frontier, schedule worker
    doc.frontier = Math.min(doc.frontier, from.line);
    startWorker(cm, 400);

    var lendiff = change.text.length - (to.line - from.line) - 1;
    // Remember that these lines changed, for updating the display
    if (change.full)
      regChange(cm);
    else if (from.line == to.line && change.text.length == 1 && !isWholeLineUpdate(cm.doc, change))
      regLineChange(cm, from.line, "text");
    else
      regChange(cm, from.line, to.line + 1, lendiff);

    var changesHandler = hasHandler(cm, "changes"), changeHandler = hasHandler(cm, "change");
    if (changeHandler || changesHandler) {
      var obj = {
        from: from, to: to,
        text: change.text,
        removed: change.removed,
        origin: change.origin
      };
      if (changeHandler) signalLater(cm, "change", cm, obj);
      if (changesHandler) (cm.curOp.changeObjs || (cm.curOp.changeObjs = [])).push(obj);
    }
    cm.display.selForContextMenu = null;
  }

  function replaceRange(doc, code, from, to, origin) {
    if (!to) to = from;
    if (cmp(to, from) < 0) { var tmp = to; to = from; from = tmp; }
    if (typeof code == "string") code = doc.splitLines(code);
    makeChange(doc, {from: from, to: to, text: code, origin: origin});
  }

  // SCROLLING THINGS INTO VIEW

  // If an editor sits on the top or bottom of the window, partially
  // scrolled out of view, this ensures that the cursor is visible.
  function maybeScrollWindow(cm, coords) {
    if (signalDOMEvent(cm, "scrollCursorIntoView")) return;

    var display = cm.display, box = display.sizer.getBoundingClientRect(), doScroll = null;
    if (coords.top + box.top < 0) doScroll = true;
    else if (coords.bottom + box.top > (window.innerHeight || document.documentElement.clientHeight)) doScroll = false;
    if (doScroll != null && !phantom) {
      var scrollNode = elt("div", "\u200b", null, "position: absolute; top: " +
                           (coords.top - display.viewOffset - paddingTop(cm.display)) + "px; height: " +
                           (coords.bottom - coords.top + scrollGap(cm) + display.barHeight) + "px; left: " +
                           coords.left + "px; width: 2px;");
      cm.display.lineSpace.appendChild(scrollNode);
      scrollNode.scrollIntoView(doScroll);
      cm.display.lineSpace.removeChild(scrollNode);
    }
  }

  // Scroll a given position into view (immediately), verifying that
  // it actually became visible (as line heights are accurately
  // measured, the position of something may 'drift' during drawing).
  function scrollPosIntoView(cm, pos, end, margin) {
    if (margin == null) margin = 0;
    for (var limit = 0; limit < 5; limit++) {
      var changed = false, coords = cursorCoords(cm, pos);
      var endCoords = !end || end == pos ? coords : cursorCoords(cm, end);
      var scrollPos = calculateScrollPos(cm, Math.min(coords.left, endCoords.left),
                                         Math.min(coords.top, endCoords.top) - margin,
                                         Math.max(coords.left, endCoords.left),
                                         Math.max(coords.bottom, endCoords.bottom) + margin);
      var startTop = cm.doc.scrollTop, startLeft = cm.doc.scrollLeft;
      if (scrollPos.scrollTop != null) {
        setScrollTop(cm, scrollPos.scrollTop);
        if (Math.abs(cm.doc.scrollTop - startTop) > 1) changed = true;
      }
      if (scrollPos.scrollLeft != null) {
        setScrollLeft(cm, scrollPos.scrollLeft);
        if (Math.abs(cm.doc.scrollLeft - startLeft) > 1) changed = true;
      }
      if (!changed) break;
    }
    return coords;
  }

  // Scroll a given set of coordinates into view (immediately).
  function scrollIntoView(cm, x1, y1, x2, y2) {
    var scrollPos = calculateScrollPos(cm, x1, y1, x2, y2);
    if (scrollPos.scrollTop != null) setScrollTop(cm, scrollPos.scrollTop);
    if (scrollPos.scrollLeft != null) setScrollLeft(cm, scrollPos.scrollLeft);
  }

  // Calculate a new scroll position needed to scroll the given
  // rectangle into view. Returns an object with scrollTop and
  // scrollLeft properties. When these are undefined, the
  // vertical/horizontal position does not need to be adjusted.
  function calculateScrollPos(cm, x1, y1, x2, y2) {
    var display = cm.display, snapMargin = textHeight(cm.display);
    if (y1 < 0) y1 = 0;
    var screentop = cm.curOp && cm.curOp.scrollTop != null ? cm.curOp.scrollTop : display.scroller.scrollTop;
    var screen = displayHeight(cm), result = {};
    if (y2 - y1 > screen) y2 = y1 + screen;
    var docBottom = cm.doc.height + paddingVert(display);
    var atTop = y1 < snapMargin, atBottom = y2 > docBottom - snapMargin;
    if (y1 < screentop) {
      result.scrollTop = atTop ? 0 : y1;
    } else if (y2 > screentop + screen) {
      var newTop = Math.min(y1, (atBottom ? docBottom : y2) - screen);
      if (newTop != screentop) result.scrollTop = newTop;
    }

    var screenleft = cm.curOp && cm.curOp.scrollLeft != null ? cm.curOp.scrollLeft : display.scroller.scrollLeft;
    var screenw = displayWidth(cm) - (cm.options.fixedGutter ? display.gutters.offsetWidth : 0);
    var tooWide = x2 - x1 > screenw;
    if (tooWide) x2 = x1 + screenw;
    if (x1 < 10)
      result.scrollLeft = 0;
    else if (x1 < screenleft)
      result.scrollLeft = Math.max(0, x1 - (tooWide ? 0 : 10));
    else if (x2 > screenw + screenleft - 3)
      result.scrollLeft = x2 + (tooWide ? 0 : 10) - screenw;
    return result;
  }

  // Store a relative adjustment to the scroll position in the current
  // operation (to be applied when the operation finishes).
  function addToScrollPos(cm, left, top) {
    if (left != null || top != null) resolveScrollToPos(cm);
    if (left != null)
      cm.curOp.scrollLeft = (cm.curOp.scrollLeft == null ? cm.doc.scrollLeft : cm.curOp.scrollLeft) + left;
    if (top != null)
      cm.curOp.scrollTop = (cm.curOp.scrollTop == null ? cm.doc.scrollTop : cm.curOp.scrollTop) + top;
  }

  // Make sure that at the end of the operation the current cursor is
  // shown.
  function ensureCursorVisible(cm) {
    resolveScrollToPos(cm);
    var cur = cm.getCursor(), from = cur, to = cur;
    if (!cm.options.lineWrapping) {
      from = cur.ch ? Pos(cur.line, cur.ch - 1) : cur;
      to = Pos(cur.line, cur.ch + 1);
    }
    cm.curOp.scrollToPos = {from: from, to: to, margin: cm.options.cursorScrollMargin, isCursor: true};
  }

  // When an operation has its scrollToPos property set, and another
  // scroll action is applied before the end of the operation, this
  // 'simulates' scrolling that position into view in a cheap way, so
  // that the effect of intermediate scroll commands is not ignored.
  function resolveScrollToPos(cm) {
    var range = cm.curOp.scrollToPos;
    if (range) {
      cm.curOp.scrollToPos = null;
      var from = estimateCoords(cm, range.from), to = estimateCoords(cm, range.to);
      var sPos = calculateScrollPos(cm, Math.min(from.left, to.left),
                                    Math.min(from.top, to.top) - range.margin,
                                    Math.max(from.right, to.right),
                                    Math.max(from.bottom, to.bottom) + range.margin);
      cm.scrollTo(sPos.scrollLeft, sPos.scrollTop);
    }
  }

  // API UTILITIES

  // Indent the given line. The how parameter can be "smart",
  // "add"/null, "subtract", or "prev". When aggressive is false
  // (typically set to true for forced single-line indents), empty
  // lines are not indented, and places where the mode returns Pass
  // are left alone.
  function indentLine(cm, n, how, aggressive) {
    var doc = cm.doc, state;
    if (how == null) how = "add";
    if (how == "smart") {
      // Fall back to "prev" when the mode doesn't have an indentation
      // method.
      if (!doc.mode.indent) how = "prev";
      else state = getStateBefore(cm, n);
    }

    var tabSize = cm.options.tabSize;
    var line = getLine(doc, n), curSpace = countColumn(line.text, null, tabSize);
    if (line.stateAfter) line.stateAfter = null;
    var curSpaceString = line.text.match(/^\s*/)[0], indentation;
    if (!aggressive && !/\S/.test(line.text)) {
      indentation = 0;
      how = "not";
    } else if (how == "smart") {
      indentation = doc.mode.indent(state, line.text.slice(curSpaceString.length), line.text);
      if (indentation == Pass || indentation > 150) {
        if (!aggressive) return;
        how = "prev";
      }
    }
    if (how == "prev") {
      if (n > doc.first) indentation = countColumn(getLine(doc, n-1).text, null, tabSize);
      else indentation = 0;
    } else if (how == "add") {
      indentation = curSpace + cm.options.indentUnit;
    } else if (how == "subtract") {
      indentation = curSpace - cm.options.indentUnit;
    } else if (typeof how == "number") {
      indentation = curSpace + how;
    }
    indentation = Math.max(0, indentation);

    var indentString = "", pos = 0;
    if (cm.options.indentWithTabs)
      for (var i = Math.floor(indentation / tabSize); i; --i) {pos += tabSize; indentString += "\t";}
    if (pos < indentation) indentString += spaceStr(indentation - pos);

    if (indentString != curSpaceString) {
      replaceRange(doc, indentString, Pos(n, 0), Pos(n, curSpaceString.length), "+input");
      line.stateAfter = null;
      return true;
    } else {
      // Ensure that, if the cursor was in the whitespace at the start
      // of the line, it is moved to the end of that space.
      for (var i = 0; i < doc.sel.ranges.length; i++) {
        var range = doc.sel.ranges[i];
        if (range.head.line == n && range.head.ch < curSpaceString.length) {
          var pos = Pos(n, curSpaceString.length);
          replaceOneSelection(doc, i, new Range(pos, pos));
          break;
        }
      }
    }
  }

  // Utility for applying a change to a line by handle or number,
  // returning the number and optionally registering the line as
  // changed.
  function changeLine(doc, handle, changeType, op) {
    var no = handle, line = handle;
    if (typeof handle == "number") line = getLine(doc, clipLine(doc, handle));
    else no = lineNo(handle);
    if (no == null) return null;
    if (op(line, no) && doc.cm) regLineChange(doc.cm, no, changeType);
    return line;
  }

  // Helper for deleting text near the selection(s), used to implement
  // backspace, delete, and similar functionality.
  function deleteNearSelection(cm, compute) {
    var ranges = cm.doc.sel.ranges, kill = [];
    // Build up a set of ranges to kill first, merging overlapping
    // ranges.
    for (var i = 0; i < ranges.length; i++) {
      var toKill = compute(ranges[i]);
      while (kill.length && cmp(toKill.from, lst(kill).to) <= 0) {
        var replaced = kill.pop();
        if (cmp(replaced.from, toKill.from) < 0) {
          toKill.from = replaced.from;
          break;
        }
      }
      kill.push(toKill);
    }
    // Next, remove those actual ranges.
    runInOp(cm, function() {
      for (var i = kill.length - 1; i >= 0; i--)
        replaceRange(cm.doc, "", kill[i].from, kill[i].to, "+delete");
      ensureCursorVisible(cm);
    });
  }

  // Used for horizontal relative motion. Dir is -1 or 1 (left or
  // right), unit can be "char", "column" (like char, but doesn't
  // cross line boundaries), "word" (across next word), or "group" (to
  // the start of next group of word or non-word-non-whitespace
  // chars). The visually param controls whether, in right-to-left
  // text, direction 1 means to move towards the next index in the
  // string, or towards the character to the right of the current
  // position. The resulting position will have a hitSide=true
  // property if it reached the end of the document.
  function findPosH(doc, pos, dir, unit, visually) {
    var line = pos.line, ch = pos.ch, origDir = dir;
    var lineObj = getLine(doc, line);
    function findNextLine() {
      var l = line + dir;
      if (l < doc.first || l >= doc.first + doc.size) return false
      line = l;
      return lineObj = getLine(doc, l);
    }
    function moveOnce(boundToLine) {
      var next = (visually ? moveVisually : moveLogically)(lineObj, ch, dir, true);
      if (next == null) {
        if (!boundToLine && findNextLine()) {
          if (visually) ch = (dir < 0 ? lineRight : lineLeft)(lineObj);
          else ch = dir < 0 ? lineObj.text.length : 0;
        } else return false
      } else ch = next;
      return true;
    }

    if (unit == "char") {
      moveOnce()
    } else if (unit == "column") {
      moveOnce(true)
    } else if (unit == "word" || unit == "group") {
      var sawType = null, group = unit == "group";
      var helper = doc.cm && doc.cm.getHelper(pos, "wordChars");
      for (var first = true;; first = false) {
        if (dir < 0 && !moveOnce(!first)) break;
        var cur = lineObj.text.charAt(ch) || "\n";
        var type = isWordChar(cur, helper) ? "w"
          : group && cur == "\n" ? "n"
          : !group || /\s/.test(cur) ? null
          : "p";
        if (group && !first && !type) type = "s";
        if (sawType && sawType != type) {
          if (dir < 0) {dir = 1; moveOnce();}
          break;
        }

        if (type) sawType = type;
        if (dir > 0 && !moveOnce(!first)) break;
      }
    }
    var result = skipAtomic(doc, Pos(line, ch), pos, origDir, true);
    if (!cmp(pos, result)) result.hitSide = true;
    return result;
  }

  // For relative vertical movement. Dir may be -1 or 1. Unit can be
  // "page" or "line". The resulting position will have a hitSide=true
  // property if it reached the end of the document.
  function findPosV(cm, pos, dir, unit) {
    var doc = cm.doc, x = pos.left, y;
    if (unit == "page") {
      var pageSize = Math.min(cm.display.wrapper.clientHeight, window.innerHeight || document.documentElement.clientHeight);
      y = pos.top + dir * (pageSize - (dir < 0 ? 1.5 : .5) * textHeight(cm.display));
    } else if (unit == "line") {
      y = dir > 0 ? pos.bottom + 3 : pos.top - 3;
    }
    for (;;) {
      var target = coordsChar(cm, x, y);
      if (!target.outside) break;
      if (dir < 0 ? y <= 0 : y >= doc.height) { target.hitSide = true; break; }
      y += dir * 5;
    }
    return target;
  }

  // EDITOR METHODS

  // The publicly visible API. Note that methodOp(f) means
  // 'wrap f in an operation, performed on its `this` parameter'.

  // This is not the complete set of editor methods. Most of the
  // methods defined on the Doc type are also injected into
  // CodeMirror.prototype, for backwards compatibility and
  // convenience.

  CodeMirror.prototype = {
    constructor: CodeMirror,
    focus: function(){window.focus(); this.display.input.focus();},

    setOption: function(option, value) {
      var options = this.options, old = options[option];
      if (options[option] == value && option != "mode") return;
      options[option] = value;
      if (optionHandlers.hasOwnProperty(option))
        operation(this, optionHandlers[option])(this, value, old);
    },

    getOption: function(option) {return this.options[option];},
    getDoc: function() {return this.doc;},

    addKeyMap: function(map, bottom) {
      this.state.keyMaps[bottom ? "push" : "unshift"](getKeyMap(map));
    },
    removeKeyMap: function(map) {
      var maps = this.state.keyMaps;
      for (var i = 0; i < maps.length; ++i)
        if (maps[i] == map || maps[i].name == map) {
          maps.splice(i, 1);
          return true;
        }
    },

    addOverlay: methodOp(function(spec, options) {
      var mode = spec.token ? spec : CodeMirror.getMode(this.options, spec);
      if (mode.startState) throw new Error("Overlays may not be stateful.");
      this.state.overlays.push({mode: mode, modeSpec: spec, opaque: options && options.opaque});
      this.state.modeGen++;
      regChange(this);
    }),
    removeOverlay: methodOp(function(spec) {
      var overlays = this.state.overlays;
      for (var i = 0; i < overlays.length; ++i) {
        var cur = overlays[i].modeSpec;
        if (cur == spec || typeof spec == "string" && cur.name == spec) {
          overlays.splice(i, 1);
          this.state.modeGen++;
          regChange(this);
          return;
        }
      }
    }),

    indentLine: methodOp(function(n, dir, aggressive) {
      if (typeof dir != "string" && typeof dir != "number") {
        if (dir == null) dir = this.options.smartIndent ? "smart" : "prev";
        else dir = dir ? "add" : "subtract";
      }
      if (isLine(this.doc, n)) indentLine(this, n, dir, aggressive);
    }),
    indentSelection: methodOp(function(how) {
      var ranges = this.doc.sel.ranges, end = -1;
      for (var i = 0; i < ranges.length; i++) {
        var range = ranges[i];
        if (!range.empty()) {
          var from = range.from(), to = range.to();
          var start = Math.max(end, from.line);
          end = Math.min(this.lastLine(), to.line - (to.ch ? 0 : 1)) + 1;
          for (var j = start; j < end; ++j)
            indentLine(this, j, how);
          var newRanges = this.doc.sel.ranges;
          if (from.ch == 0 && ranges.length == newRanges.length && newRanges[i].from().ch > 0)
            replaceOneSelection(this.doc, i, new Range(from, newRanges[i].to()), sel_dontScroll);
        } else if (range.head.line > end) {
          indentLine(this, range.head.line, how, true);
          end = range.head.line;
          if (i == this.doc.sel.primIndex) ensureCursorVisible(this);
        }
      }
    }),

    // Fetch the parser token for a given character. Useful for hacks
    // that want to inspect the mode state (say, for completion).
    getTokenAt: function(pos, precise) {
      return takeToken(this, pos, precise);
    },

    getLineTokens: function(line, precise) {
      return takeToken(this, Pos(line), precise, true);
    },

    getTokenTypeAt: function(pos) {
      pos = clipPos(this.doc, pos);
      var styles = getLineStyles(this, getLine(this.doc, pos.line));
      var before = 0, after = (styles.length - 1) / 2, ch = pos.ch;
      var type;
      if (ch == 0) type = styles[2];
      else for (;;) {
        var mid = (before + after) >> 1;
        if ((mid ? styles[mid * 2 - 1] : 0) >= ch) after = mid;
        else if (styles[mid * 2 + 1] < ch) before = mid + 1;
        else { type = styles[mid * 2 + 2]; break; }
      }
      var cut = type ? type.indexOf("cm-overlay ") : -1;
      return cut < 0 ? type : cut == 0 ? null : type.slice(0, cut - 1);
    },

    getModeAt: function(pos) {
      var mode = this.doc.mode;
      if (!mode.innerMode) return mode;
      return CodeMirror.innerMode(mode, this.getTokenAt(pos).state).mode;
    },

    getHelper: function(pos, type) {
      return this.getHelpers(pos, type)[0];
    },

    getHelpers: function(pos, type) {
      var found = [];
      if (!helpers.hasOwnProperty(type)) return found;
      var help = helpers[type], mode = this.getModeAt(pos);
      if (typeof mode[type] == "string") {
        if (help[mode[type]]) found.push(help[mode[type]]);
      } else if (mode[type]) {
        for (var i = 0; i < mode[type].length; i++) {
          var val = help[mode[type][i]];
          if (val) found.push(val);
        }
      } else if (mode.helperType && help[mode.helperType]) {
        found.push(help[mode.helperType]);
      } else if (help[mode.name]) {
        found.push(help[mode.name]);
      }
      for (var i = 0; i < help._global.length; i++) {
        var cur = help._global[i];
        if (cur.pred(mode, this) && indexOf(found, cur.val) == -1)
          found.push(cur.val);
      }
      return found;
    },

    getStateAfter: function(line, precise) {
      var doc = this.doc;
      line = clipLine(doc, line == null ? doc.first + doc.size - 1: line);
      return getStateBefore(this, line + 1, precise);
    },

    cursorCoords: function(start, mode) {
      var pos, range = this.doc.sel.primary();
      if (start == null) pos = range.head;
      else if (typeof start == "object") pos = clipPos(this.doc, start);
      else pos = start ? range.from() : range.to();
      return cursorCoords(this, pos, mode || "page");
    },

    charCoords: function(pos, mode) {
      return charCoords(this, clipPos(this.doc, pos), mode || "page");
    },

    coordsChar: function(coords, mode) {
      coords = fromCoordSystem(this, coords, mode || "page");
      return coordsChar(this, coords.left, coords.top);
    },

    lineAtHeight: function(height, mode) {
      height = fromCoordSystem(this, {top: height, left: 0}, mode || "page").top;
      return lineAtHeight(this.doc, height + this.display.viewOffset);
    },
    heightAtLine: function(line, mode) {
      var end = false, lineObj;
      if (typeof line == "number") {
        var last = this.doc.first + this.doc.size - 1;
        if (line < this.doc.first) line = this.doc.first;
        else if (line > last) { line = last; end = true; }
        lineObj = getLine(this.doc, line);
      } else {
        lineObj = line;
      }
      return intoCoordSystem(this, lineObj, {top: 0, left: 0}, mode || "page").top +
        (end ? this.doc.height - heightAtLine(lineObj) : 0);
    },

    defaultTextHeight: function() { return textHeight(this.display); },
    defaultCharWidth: function() { return charWidth(this.display); },

    setGutterMarker: methodOp(function(line, gutterID, value) {
      return changeLine(this.doc, line, "gutter", function(line) {
        var markers = line.gutterMarkers || (line.gutterMarkers = {});
        markers[gutterID] = value;
        if (!value && isEmpty(markers)) line.gutterMarkers = null;
        return true;
      });
    }),

    clearGutter: methodOp(function(gutterID) {
      var cm = this, doc = cm.doc, i = doc.first;
      doc.iter(function(line) {
        if (line.gutterMarkers && line.gutterMarkers[gutterID]) {
          line.gutterMarkers[gutterID] = null;
          regLineChange(cm, i, "gutter");
          if (isEmpty(line.gutterMarkers)) line.gutterMarkers = null;
        }
        ++i;
      });
    }),

    lineInfo: function(line) {
      if (typeof line == "number") {
        if (!isLine(this.doc, line)) return null;
        var n = line;
        line = getLine(this.doc, line);
        if (!line) return null;
      } else {
        var n = lineNo(line);
        if (n == null) return null;
      }
      return {line: n, handle: line, text: line.text, gutterMarkers: line.gutterMarkers,
              textClass: line.textClass, bgClass: line.bgClass, wrapClass: line.wrapClass,
              widgets: line.widgets};
    },

    getViewport: function() { return {from: this.display.viewFrom, to: this.display.viewTo};},

    addWidget: function(pos, node, scroll, vert, horiz) {
      var display = this.display;
      pos = cursorCoords(this, clipPos(this.doc, pos));
      var top = pos.bottom, left = pos.left;
      node.style.position = "absolute";
      node.setAttribute("cm-ignore-events", "true");
      this.display.input.setUneditable(node);
      display.sizer.appendChild(node);
      if (vert == "over") {
        top = pos.top;
      } else if (vert == "above" || vert == "near") {
        var vspace = Math.max(display.wrapper.clientHeight, this.doc.height),
        hspace = Math.max(display.sizer.clientWidth, display.lineSpace.clientWidth);
        // Default to positioning above (if specified and possible); otherwise default to positioning below
        if ((vert == 'above' || pos.bottom + node.offsetHeight > vspace) && pos.top > node.offsetHeight)
          top = pos.top - node.offsetHeight;
        else if (pos.bottom + node.offsetHeight <= vspace)
          top = pos.bottom;
        if (left + node.offsetWidth > hspace)
          left = hspace - node.offsetWidth;
      }
      node.style.top = top + "px";
      node.style.left = node.style.right = "";
      if (horiz == "right") {
        left = display.sizer.clientWidth - node.offsetWidth;
        node.style.right = "0px";
      } else {
        if (horiz == "left") left = 0;
        else if (horiz == "middle") left = (display.sizer.clientWidth - node.offsetWidth) / 2;
        node.style.left = left + "px";
      }
      if (scroll)
        scrollIntoView(this, left, top, left + node.offsetWidth, top + node.offsetHeight);
    },

    triggerOnKeyDown: methodOp(onKeyDown),
    triggerOnKeyPress: methodOp(onKeyPress),
    triggerOnKeyUp: onKeyUp,

    execCommand: function(cmd) {
      if (commands.hasOwnProperty(cmd))
        return commands[cmd].call(null, this);
    },

    triggerElectric: methodOp(function(text) { triggerElectric(this, text); }),

    findPosH: function(from, amount, unit, visually) {
      var dir = 1;
      if (amount < 0) { dir = -1; amount = -amount; }
      for (var i = 0, cur = clipPos(this.doc, from); i < amount; ++i) {
        cur = findPosH(this.doc, cur, dir, unit, visually);
        if (cur.hitSide) break;
      }
      return cur;
    },

    moveH: methodOp(function(dir, unit) {
      var cm = this;
      cm.extendSelectionsBy(function(range) {
        if (cm.display.shift || cm.doc.extend || range.empty())
          return findPosH(cm.doc, range.head, dir, unit, cm.options.rtlMoveVisually);
        else
          return dir < 0 ? range.from() : range.to();
      }, sel_move);
    }),

    deleteH: methodOp(function(dir, unit) {
      var sel = this.doc.sel, doc = this.doc;
      if (sel.somethingSelected())
        doc.replaceSelection("", null, "+delete");
      else
        deleteNearSelection(this, function(range) {
          var other = findPosH(doc, range.head, dir, unit, false);
          return dir < 0 ? {from: other, to: range.head} : {from: range.head, to: other};
        });
    }),

    findPosV: function(from, amount, unit, goalColumn) {
      var dir = 1, x = goalColumn;
      if (amount < 0) { dir = -1; amount = -amount; }
      for (var i = 0, cur = clipPos(this.doc, from); i < amount; ++i) {
        var coords = cursorCoords(this, cur, "div");
        if (x == null) x = coords.left;
        else coords.left = x;
        cur = findPosV(this, coords, dir, unit);
        if (cur.hitSide) break;
      }
      return cur;
    },

    moveV: methodOp(function(dir, unit) {
      var cm = this, doc = this.doc, goals = [];
      var collapse = !cm.display.shift && !doc.extend && doc.sel.somethingSelected();
      doc.extendSelectionsBy(function(range) {
        if (collapse)
          return dir < 0 ? range.from() : range.to();
        var headPos = cursorCoords(cm, range.head, "div");
        if (range.goalColumn != null) headPos.left = range.goalColumn;
        goals.push(headPos.left);
        var pos = findPosV(cm, headPos, dir, unit);
        if (unit == "page" && range == doc.sel.primary())
          addToScrollPos(cm, null, charCoords(cm, pos, "div").top - headPos.top);
        return pos;
      }, sel_move);
      if (goals.length) for (var i = 0; i < doc.sel.ranges.length; i++)
        doc.sel.ranges[i].goalColumn = goals[i];
    }),

    // Find the word at the given position (as returned by coordsChar).
    findWordAt: function(pos) {
      var doc = this.doc, line = getLine(doc, pos.line).text;
      var start = pos.ch, end = pos.ch;
      if (line) {
        var helper = this.getHelper(pos, "wordChars");
        if ((pos.xRel < 0 || end == line.length) && start) --start; else ++end;
        var startChar = line.charAt(start);
        var check = isWordChar(startChar, helper)
          ? function(ch) { return isWordChar(ch, helper); }
          : /\s/.test(startChar) ? function(ch) {return /\s/.test(ch);}
          : function(ch) {return !/\s/.test(ch) && !isWordChar(ch);};
        while (start > 0 && check(line.charAt(start - 1))) --start;
        while (end < line.length && check(line.charAt(end))) ++end;
      }
      return new Range(Pos(pos.line, start), Pos(pos.line, end));
    },

    toggleOverwrite: function(value) {
      if (value != null && value == this.state.overwrite) return;
      if (this.state.overwrite = !this.state.overwrite)
        addClass(this.display.cursorDiv, "CodeMirror-overwrite");
      else
        rmClass(this.display.cursorDiv, "CodeMirror-overwrite");

      signal(this, "overwriteToggle", this, this.state.overwrite);
    },
    hasFocus: function() { return this.display.input.getField() == activeElt(); },
    isReadOnly: function() { return !!(this.options.readOnly || this.doc.cantEdit); },

    scrollTo: methodOp(function(x, y) {
      if (x != null || y != null) resolveScrollToPos(this);
      if (x != null) this.curOp.scrollLeft = x;
      if (y != null) this.curOp.scrollTop = y;
    }),
    getScrollInfo: function() {
      var scroller = this.display.scroller;
      return {left: scroller.scrollLeft, top: scroller.scrollTop,
              height: scroller.scrollHeight - scrollGap(this) - this.display.barHeight,
              width: scroller.scrollWidth - scrollGap(this) - this.display.barWidth,
              clientHeight: displayHeight(this), clientWidth: displayWidth(this)};
    },

    scrollIntoView: methodOp(function(range, margin) {
      if (range == null) {
        range = {from: this.doc.sel.primary().head, to: null};
        if (margin == null) margin = this.options.cursorScrollMargin;
      } else if (typeof range == "number") {
        range = {from: Pos(range, 0), to: null};
      } else if (range.from == null) {
        range = {from: range, to: null};
      }
      if (!range.to) range.to = range.from;
      range.margin = margin || 0;

      if (range.from.line != null) {
        resolveScrollToPos(this);
        this.curOp.scrollToPos = range;
      } else {
        var sPos = calculateScrollPos(this, Math.min(range.from.left, range.to.left),
                                      Math.min(range.from.top, range.to.top) - range.margin,
                                      Math.max(range.from.right, range.to.right),
                                      Math.max(range.from.bottom, range.to.bottom) + range.margin);
        this.scrollTo(sPos.scrollLeft, sPos.scrollTop);
      }
    }),

    setSize: methodOp(function(width, height) {
      var cm = this;
      function interpret(val) {
        return typeof val == "number" || /^\d+$/.test(String(val)) ? val + "px" : val;
      }
      if (width != null) cm.display.wrapper.style.width = interpret(width);
      if (height != null) cm.display.wrapper.style.height = interpret(height);
      if (cm.options.lineWrapping) clearLineMeasurementCache(this);
      var lineNo = cm.display.viewFrom;
      cm.doc.iter(lineNo, cm.display.viewTo, function(line) {
        if (line.widgets) for (var i = 0; i < line.widgets.length; i++)
          if (line.widgets[i].noHScroll) { regLineChange(cm, lineNo, "widget"); break; }
        ++lineNo;
      });
      cm.curOp.forceUpdate = true;
      signal(cm, "refresh", this);
    }),

    operation: function(f){return runInOp(this, f);},

    refresh: methodOp(function() {
      var oldHeight = this.display.cachedTextHeight;
      regChange(this);
      this.curOp.forceUpdate = true;
      clearCaches(this);
      this.scrollTo(this.doc.scrollLeft, this.doc.scrollTop);
      updateGutterSpace(this);
      if (oldHeight == null || Math.abs(oldHeight - textHeight(this.display)) > .5)
        estimateLineHeights(this);
      signal(this, "refresh", this);
    }),

    swapDoc: methodOp(function(doc) {
      var old = this.doc;
      old.cm = null;
      attachDoc(this, doc);
      clearCaches(this);
      this.display.input.reset();
      this.scrollTo(doc.scrollLeft, doc.scrollTop);
      this.curOp.forceScroll = true;
      signalLater(this, "swapDoc", this, old);
      return old;
    }),

    getInputField: function(){return this.display.input.getField();},
    getWrapperElement: function(){return this.display.wrapper;},
    getScrollerElement: function(){return this.display.scroller;},
    getGutterElement: function(){return this.display.gutters;}
  };
  eventMixin(CodeMirror);

  // OPTION DEFAULTS

  // The default configuration options.
  var defaults = CodeMirror.defaults = {};
  // Functions to run when options are changed.
  var optionHandlers = CodeMirror.optionHandlers = {};

  function option(name, deflt, handle, notOnInit) {
    CodeMirror.defaults[name] = deflt;
    if (handle) optionHandlers[name] =
      notOnInit ? function(cm, val, old) {if (old != Init) handle(cm, val, old);} : handle;
  }

  // Passed to option handlers when there is no old value.
  var Init = CodeMirror.Init = {toString: function(){return "CodeMirror.Init";}};

  // These two are, on init, called from the constructor because they
  // have to be initialized before the editor can start at all.
  option("value", "", function(cm, val) {
    cm.setValue(val);
  }, true);
  option("mode", null, function(cm, val) {
    cm.doc.modeOption = val;
    loadMode(cm);
  }, true);

  option("indentUnit", 2, loadMode, true);
  option("indentWithTabs", false);
  option("smartIndent", true);
  option("tabSize", 4, function(cm) {
    resetModeState(cm);
    clearCaches(cm);
    regChange(cm);
  }, true);
  option("lineSeparator", null, function(cm, val) {
    cm.doc.lineSep = val;
    if (!val) return;
    var newBreaks = [], lineNo = cm.doc.first;
    cm.doc.iter(function(line) {
      for (var pos = 0;;) {
        var found = line.text.indexOf(val, pos);
        if (found == -1) break;
        pos = found + val.length;
        newBreaks.push(Pos(lineNo, found));
      }
      lineNo++;
    });
    for (var i = newBreaks.length - 1; i >= 0; i--)
      replaceRange(cm.doc, val, newBreaks[i], Pos(newBreaks[i].line, newBreaks[i].ch + val.length))
  });
  option("specialChars", /[\t\u0000-\u0019\u00ad\u200b-\u200f\u2028\u2029\ufeff]/g, function(cm, val, old) {
    cm.state.specialChars = new RegExp(val.source + (val.test("\t") ? "" : "|\t"), "g");
    if (old != CodeMirror.Init) cm.refresh();
  });
  option("specialCharPlaceholder", defaultSpecialCharPlaceholder, function(cm) {cm.refresh();}, true);
  option("electricChars", true);
  option("inputStyle", mobile ? "contenteditable" : "textarea", function() {
    throw new Error("inputStyle can not (yet) be changed in a running editor"); // FIXME
  }, true);
  option("rtlMoveVisually", !windows);
  option("wholeLineUpdateBefore", true);

  option("theme", "default", function(cm) {
    themeChanged(cm);
    guttersChanged(cm);
  }, true);
  option("keyMap", "default", function(cm, val, old) {
    var next = getKeyMap(val);
    var prev = old != CodeMirror.Init && getKeyMap(old);
    if (prev && prev.detach) prev.detach(cm, next);
    if (next.attach) next.attach(cm, prev || null);
  });
  option("extraKeys", null);

  option("lineWrapping", false, wrappingChanged, true);
  option("gutters", [], function(cm) {
    setGuttersForLineNumbers(cm.options);
    guttersChanged(cm);
  }, true);
  option("fixedGutter", true, function(cm, val) {
    cm.display.gutters.style.left = val ? compensateForHScroll(cm.display) + "px" : "0";
    cm.refresh();
  }, true);
  option("coverGutterNextToScrollbar", false, function(cm) {updateScrollbars(cm);}, true);
  option("scrollbarStyle", "native", function(cm) {
    initScrollbars(cm);
    updateScrollbars(cm);
    cm.display.scrollbars.setScrollTop(cm.doc.scrollTop);
    cm.display.scrollbars.setScrollLeft(cm.doc.scrollLeft);
  }, true);
  option("lineNumbers", false, function(cm) {
    setGuttersForLineNumbers(cm.options);
    guttersChanged(cm);
  }, true);
  option("firstLineNumber", 1, guttersChanged, true);
  option("lineNumberFormatter", function(integer) {return integer;}, guttersChanged, true);
  option("showCursorWhenSelecting", false, updateSelection, true);

  option("resetSelectionOnContextMenu", true);
  option("lineWiseCopyCut", true);

  option("readOnly", false, function(cm, val) {
    if (val == "nocursor") {
      onBlur(cm);
      cm.display.input.blur();
      cm.display.disabled = true;
    } else {
      cm.display.disabled = false;
    }
    cm.display.input.readOnlyChanged(val)
  });
  option("disableInput", false, function(cm, val) {if (!val) cm.display.input.reset();}, true);
  option("dragDrop", true, dragDropChanged);
  option("allowDropFileTypes", null);

  option("cursorBlinkRate", 530);
  option("cursorScrollMargin", 0);
  option("cursorHeight", 1, updateSelection, true);
  option("singleCursorHeightPerLine", true, updateSelection, true);
  option("workTime", 100);
  option("workDelay", 100);
  option("flattenSpans", true, resetModeState, true);
  option("addModeClass", false, resetModeState, true);
  option("pollInterval", 100);
  option("undoDepth", 200, function(cm, val){cm.doc.history.undoDepth = val;});
  option("historyEventDelay", 1250);
  option("viewportMargin", 10, function(cm){cm.refresh();}, true);
  option("maxHighlightLength", 10000, resetModeState, true);
  option("moveInputWithCursor", true, function(cm, val) {
    if (!val) cm.display.input.resetPosition();
  });

  option("tabindex", null, function(cm, val) {
    cm.display.input.getField().tabIndex = val || "";
  });
  option("autofocus", null);

  // MODE DEFINITION AND QUERYING

  // Known modes, by name and by MIME
  var modes = CodeMirror.modes = {}, mimeModes = CodeMirror.mimeModes = {};

  // Extra arguments are stored as the mode's dependencies, which is
  // used by (legacy) mechanisms like loadmode.js to automatically
  // load a mode. (Preferred mechanism is the require/define calls.)
  CodeMirror.defineMode = function(name, mode) {
    if (!CodeMirror.defaults.mode && name != "null") CodeMirror.defaults.mode = name;
    if (arguments.length > 2)
      mode.dependencies = Array.prototype.slice.call(arguments, 2);
    modes[name] = mode;
  };

  CodeMirror.defineMIME = function(mime, spec) {
    mimeModes[mime] = spec;
  };

  // Given a MIME type, a {name, ...options} config object, or a name
  // string, return a mode config object.
  CodeMirror.resolveMode = function(spec) {
    if (typeof spec == "string" && mimeModes.hasOwnProperty(spec)) {
      spec = mimeModes[spec];
    } else if (spec && typeof spec.name == "string" && mimeModes.hasOwnProperty(spec.name)) {
      var found = mimeModes[spec.name];
      if (typeof found == "string") found = {name: found};
      spec = createObj(found, spec);
      spec.name = found.name;
    } else if (typeof spec == "string" && /^[\w\-]+\/[\w\-]+\+xml$/.test(spec)) {
      return CodeMirror.resolveMode("application/xml");
    }
    if (typeof spec == "string") return {name: spec};
    else return spec || {name: "null"};
  };

  // Given a mode spec (anything that resolveMode accepts), find and
  // initialize an actual mode object.
  CodeMirror.getMode = function(options, spec) {
    var spec = CodeMirror.resolveMode(spec);
    var mfactory = modes[spec.name];
    if (!mfactory) return CodeMirror.getMode(options, "text/plain");
    var modeObj = mfactory(options, spec);
    if (modeExtensions.hasOwnProperty(spec.name)) {
      var exts = modeExtensions[spec.name];
      for (var prop in exts) {
        if (!exts.hasOwnProperty(prop)) continue;
        if (modeObj.hasOwnProperty(prop)) modeObj["_" + prop] = modeObj[prop];
        modeObj[prop] = exts[prop];
      }
    }
    modeObj.name = spec.name;
    if (spec.helperType) modeObj.helperType = spec.helperType;
    if (spec.modeProps) for (var prop in spec.modeProps)
      modeObj[prop] = spec.modeProps[prop];

    return modeObj;
  };

  // Minimal default mode.
  CodeMirror.defineMode("null", function() {
    return {token: function(stream) {stream.skipToEnd();}};
  });
  CodeMirror.defineMIME("text/plain", "null");

  // This can be used to attach properties to mode objects from
  // outside the actual mode definition.
  var modeExtensions = CodeMirror.modeExtensions = {};
  CodeMirror.extendMode = function(mode, properties) {
    var exts = modeExtensions.hasOwnProperty(mode) ? modeExtensions[mode] : (modeExtensions[mode] = {});
    copyObj(properties, exts);
  };

  // EXTENSIONS

  CodeMirror.defineExtension = function(name, func) {
    CodeMirror.prototype[name] = func;
  };
  CodeMirror.defineDocExtension = function(name, func) {
    Doc.prototype[name] = func;
  };
  CodeMirror.defineOption = option;

  var initHooks = [];
  CodeMirror.defineInitHook = function(f) {initHooks.push(f);};

  var helpers = CodeMirror.helpers = {};
  CodeMirror.registerHelper = function(type, name, value) {
    if (!helpers.hasOwnProperty(type)) helpers[type] = CodeMirror[type] = {_global: []};
    helpers[type][name] = value;
  };
  CodeMirror.registerGlobalHelper = function(type, name, predicate, value) {
    CodeMirror.registerHelper(type, name, value);
    helpers[type]._global.push({pred: predicate, val: value});
  };

  // MODE STATE HANDLING

  // Utility functions for working with state. Exported because nested
  // modes need to do this for their inner modes.

  var copyState = CodeMirror.copyState = function(mode, state) {
    if (state === true) return state;
    if (mode.copyState) return mode.copyState(state);
    var nstate = {};
    for (var n in state) {
      var val = state[n];
      if (val instanceof Array) val = val.concat([]);
      nstate[n] = val;
    }
    return nstate;
  };

  var startState = CodeMirror.startState = function(mode, a1, a2) {
    return mode.startState ? mode.startState(a1, a2) : true;
  };

  // Given a mode and a state (for that mode), find the inner mode and
  // state at the position that the state refers to.
  CodeMirror.innerMode = function(mode, state) {
    while (mode.innerMode) {
      var info = mode.innerMode(state);
      if (!info || info.mode == mode) break;
      state = info.state;
      mode = info.mode;
    }
    return info || {mode: mode, state: state};
  };

  // STANDARD COMMANDS

  // Commands are parameter-less actions that can be performed on an
  // editor, mostly used for keybindings.
  var commands = CodeMirror.commands = {
    selectAll: function(cm) {cm.setSelection(Pos(cm.firstLine(), 0), Pos(cm.lastLine()), sel_dontScroll);},
    singleSelection: function(cm) {
      cm.setSelection(cm.getCursor("anchor"), cm.getCursor("head"), sel_dontScroll);
    },
    killLine: function(cm) {
      deleteNearSelection(cm, function(range) {
        if (range.empty()) {
          var len = getLine(cm.doc, range.head.line).text.length;
          if (range.head.ch == len && range.head.line < cm.lastLine())
            return {from: range.head, to: Pos(range.head.line + 1, 0)};
          else
            return {from: range.head, to: Pos(range.head.line, len)};
        } else {
          return {from: range.from(), to: range.to()};
        }
      });
    },
    deleteLine: function(cm) {
      deleteNearSelection(cm, function(range) {
        return {from: Pos(range.from().line, 0),
                to: clipPos(cm.doc, Pos(range.to().line + 1, 0))};
      });
    },
    delLineLeft: function(cm) {
      deleteNearSelection(cm, function(range) {
        return {from: Pos(range.from().line, 0), to: range.from()};
      });
    },
    delWrappedLineLeft: function(cm) {
      deleteNearSelection(cm, function(range) {
        var top = cm.charCoords(range.head, "div").top + 5;
        var leftPos = cm.coordsChar({left: 0, top: top}, "div");
        return {from: leftPos, to: range.from()};
      });
    },
    delWrappedLineRight: function(cm) {
      deleteNearSelection(cm, function(range) {
        var top = cm.charCoords(range.head, "div").top + 5;
        var rightPos = cm.coordsChar({left: cm.display.lineDiv.offsetWidth + 100, top: top}, "div");
        return {from: range.from(), to: rightPos };
      });
    },
    undo: function(cm) {cm.undo();},
    redo: function(cm) {cm.redo();},
    undoSelection: function(cm) {cm.undoSelection();},
    redoSelection: function(cm) {cm.redoSelection();},
    goDocStart: function(cm) {cm.extendSelection(Pos(cm.firstLine(), 0));},
    goDocEnd: function(cm) {cm.extendSelection(Pos(cm.lastLine()));},
    goLineStart: function(cm) {
      cm.extendSelectionsBy(function(range) { return lineStart(cm, range.head.line); },
                            {origin: "+move", bias: 1});
    },
    goLineStartSmart: function(cm) {
      cm.extendSelectionsBy(function(range) {
        return lineStartSmart(cm, range.head);
      }, {origin: "+move", bias: 1});
    },
    goLineEnd: function(cm) {
      cm.extendSelectionsBy(function(range) { return lineEnd(cm, range.head.line); },
                            {origin: "+move", bias: -1});
    },
    goLineRight: function(cm) {
      cm.extendSelectionsBy(function(range) {
        var top = cm.charCoords(range.head, "div").top + 5;
        return cm.coordsChar({left: cm.display.lineDiv.offsetWidth + 100, top: top}, "div");
      }, sel_move);
    },
    goLineLeft: function(cm) {
      cm.extendSelectionsBy(function(range) {
        var top = cm.charCoords(range.head, "div").top + 5;
        return cm.coordsChar({left: 0, top: top}, "div");
      }, sel_move);
    },
    goLineLeftSmart: function(cm) {
      cm.extendSelectionsBy(function(range) {
        var top = cm.charCoords(range.head, "div").top + 5;
        var pos = cm.coordsChar({left: 0, top: top}, "div");
        if (pos.ch < cm.getLine(pos.line).search(/\S/)) return lineStartSmart(cm, range.head);
        return pos;
      }, sel_move);
    },
    goLineUp: function(cm) {cm.moveV(-1, "line");},
    goLineDown: function(cm) {cm.moveV(1, "line");},
    goPageUp: function(cm) {cm.moveV(-1, "page");},
    goPageDown: function(cm) {cm.moveV(1, "page");},
    goCharLeft: function(cm) {cm.moveH(-1, "char");},
    goCharRight: function(cm) {cm.moveH(1, "char");},
    goColumnLeft: function(cm) {cm.moveH(-1, "column");},
    goColumnRight: function(cm) {cm.moveH(1, "column");},
    goWordLeft: function(cm) {cm.moveH(-1, "word");},
    goGroupRight: function(cm) {cm.moveH(1, "group");},
    goGroupLeft: function(cm) {cm.moveH(-1, "group");},
    goWordRight: function(cm) {cm.moveH(1, "word");},
    delCharBefore: function(cm) {cm.deleteH(-1, "char");},
    delCharAfter: function(cm) {cm.deleteH(1, "char");},
    delWordBefore: function(cm) {cm.deleteH(-1, "word");},
    delWordAfter: function(cm) {cm.deleteH(1, "word");},
    delGroupBefore: function(cm) {cm.deleteH(-1, "group");},
    delGroupAfter: function(cm) {cm.deleteH(1, "group");},
    indentAuto: function(cm) {cm.indentSelection("smart");},
    indentMore: function(cm) {cm.indentSelection("add");},
    indentLess: function(cm) {cm.indentSelection("subtract");},
    insertTab: function(cm) {cm.replaceSelection("\t");},
    insertSoftTab: function(cm) {
      var spaces = [], ranges = cm.listSelections(), tabSize = cm.options.tabSize;
      for (var i = 0; i < ranges.length; i++) {
        var pos = ranges[i].from();
        var col = countColumn(cm.getLine(pos.line), pos.ch, tabSize);
        spaces.push(new Array(tabSize - col % tabSize + 1).join(" "));
      }
      cm.replaceSelections(spaces);
    },
    defaultTab: function(cm) {
      if (cm.somethingSelected()) cm.indentSelection("add");
      else cm.execCommand("insertTab");
    },
    transposeChars: function(cm) {
      runInOp(cm, function() {
        var ranges = cm.listSelections(), newSel = [];
        for (var i = 0; i < ranges.length; i++) {
          var cur = ranges[i].head, line = getLine(cm.doc, cur.line).text;
          if (line) {
            if (cur.ch == line.length) cur = new Pos(cur.line, cur.ch - 1);
            if (cur.ch > 0) {
              cur = new Pos(cur.line, cur.ch + 1);
              cm.replaceRange(line.charAt(cur.ch - 1) + line.charAt(cur.ch - 2),
                              Pos(cur.line, cur.ch - 2), cur, "+transpose");
            } else if (cur.line > cm.doc.first) {
              var prev = getLine(cm.doc, cur.line - 1).text;
              if (prev)
                cm.replaceRange(line.charAt(0) + cm.doc.lineSeparator() +
                                prev.charAt(prev.length - 1),
                                Pos(cur.line - 1, prev.length - 1), Pos(cur.line, 1), "+transpose");
            }
          }
          newSel.push(new Range(cur, cur));
        }
        cm.setSelections(newSel);
      });
    },
    newlineAndIndent: function(cm) {
      runInOp(cm, function() {
        var len = cm.listSelections().length;
        for (var i = 0; i < len; i++) {
          var range = cm.listSelections()[i];
          cm.replaceRange(cm.doc.lineSeparator(), range.anchor, range.head, "+input");
          cm.indentLine(range.from().line + 1, null, true);
        }
        ensureCursorVisible(cm);
      });
    },
    toggleOverwrite: function(cm) {cm.toggleOverwrite();}
  };


  // STANDARD KEYMAPS

  var keyMap = CodeMirror.keyMap = {};

  keyMap.basic = {
    "Left": "goCharLeft", "Right": "goCharRight", "Up": "goLineUp", "Down": "goLineDown",
    "End": "goLineEnd", "Home": "goLineStartSmart", "PageUp": "goPageUp", "PageDown": "goPageDown",
    "Delete": "delCharAfter", "Backspace": "delCharBefore", "Shift-Backspace": "delCharBefore",
    "Tab": "defaultTab", "Shift-Tab": "indentAuto",
    "Enter": "newlineAndIndent", "Insert": "toggleOverwrite",
    "Esc": "singleSelection"
  };
  // Note that the save and find-related commands aren't defined by
  // default. User code or addons can define them. Unknown commands
  // are simply ignored.
  keyMap.pcDefault = {
    "Ctrl-A": "selectAll", "Ctrl-D": "deleteLine", "Ctrl-Z": "undo", "Shift-Ctrl-Z": "redo", "Ctrl-Y": "redo",
    "Ctrl-Home": "goDocStart", "Ctrl-End": "goDocEnd", "Ctrl-Up": "goLineUp", "Ctrl-Down": "goLineDown",
    "Ctrl-Left": "goGroupLeft", "Ctrl-Right": "goGroupRight", "Alt-Left": "goLineStart", "Alt-Right": "goLineEnd",
    "Ctrl-Backspace": "delGroupBefore", "Ctrl-Delete": "delGroupAfter", "Ctrl-S": "save", "Ctrl-F": "find",
    "Ctrl-G": "findNext", "Shift-Ctrl-G": "findPrev", "Shift-Ctrl-F": "replace", "Shift-Ctrl-R": "replaceAll",
    "Ctrl-[": "indentLess", "Ctrl-]": "indentMore",
    "Ctrl-U": "undoSelection", "Shift-Ctrl-U": "redoSelection", "Alt-U": "redoSelection",
    fallthrough: "basic"
  };
  // Very basic readline/emacs-style bindings, which are standard on Mac.
  keyMap.emacsy = {
    "Ctrl-F": "goCharRight", "Ctrl-B": "goCharLeft", "Ctrl-P": "goLineUp", "Ctrl-N": "goLineDown",
    "Alt-F": "goWordRight", "Alt-B": "goWordLeft", "Ctrl-A": "goLineStart", "Ctrl-E": "goLineEnd",
    "Ctrl-V": "goPageDown", "Shift-Ctrl-V": "goPageUp", "Ctrl-D": "delCharAfter", "Ctrl-H": "delCharBefore",
    "Alt-D": "delWordAfter", "Alt-Backspace": "delWordBefore", "Ctrl-K": "killLine", "Ctrl-T": "transposeChars"
  };
  keyMap.macDefault = {
    "Cmd-A": "selectAll", "Cmd-D": "deleteLine", "Cmd-Z": "undo", "Shift-Cmd-Z": "redo", "Cmd-Y": "redo",
    "Cmd-Home": "goDocStart", "Cmd-Up": "goDocStart", "Cmd-End": "goDocEnd", "Cmd-Down": "goDocEnd", "Alt-Left": "goGroupLeft",
    "Alt-Right": "goGroupRight", "Cmd-Left": "goLineLeft", "Cmd-Right": "goLineRight", "Alt-Backspace": "delGroupBefore",
    "Ctrl-Alt-Backspace": "delGroupAfter", "Alt-Delete": "delGroupAfter", "Cmd-S": "save", "Cmd-F": "find",
    "Cmd-G": "findNext", "Shift-Cmd-G": "findPrev", "Cmd-Alt-F": "replace", "Shift-Cmd-Alt-F": "replaceAll",
    "Cmd-[": "indentLess", "Cmd-]": "indentMore", "Cmd-Backspace": "delWrappedLineLeft", "Cmd-Delete": "delWrappedLineRight",
    "Cmd-U": "undoSelection", "Shift-Cmd-U": "redoSelection", "Ctrl-Up": "goDocStart", "Ctrl-Down": "goDocEnd",
    fallthrough: ["basic", "emacsy"]
  };
  keyMap["default"] = mac ? keyMap.macDefault : keyMap.pcDefault;

  // KEYMAP DISPATCH

  function normalizeKeyName(name) {
    var parts = name.split(/-(?!$)/), name = parts[parts.length - 1];
    var alt, ctrl, shift, cmd;
    for (var i = 0; i < parts.length - 1; i++) {
      var mod = parts[i];
      if (/^(cmd|meta|m)$/i.test(mod)) cmd = true;
      else if (/^a(lt)?$/i.test(mod)) alt = true;
      else if (/^(c|ctrl|control)$/i.test(mod)) ctrl = true;
      else if (/^s(hift)$/i.test(mod)) shift = true;
      else throw new Error("Unrecognized modifier name: " + mod);
    }
    if (alt) name = "Alt-" + name;
    if (ctrl) name = "Ctrl-" + name;
    if (cmd) name = "Cmd-" + name;
    if (shift) name = "Shift-" + name;
    return name;
  }

  // This is a kludge to keep keymaps mostly working as raw objects
  // (backwards compatibility) while at the same time support features
  // like normalization and multi-stroke key bindings. It compiles a
  // new normalized keymap, and then updates the old object to reflect
  // this.
  CodeMirror.normalizeKeyMap = function(keymap) {
    var copy = {};
    for (var keyname in keymap) if (keymap.hasOwnProperty(keyname)) {
      var value = keymap[keyname];
      if (/^(name|fallthrough|(de|at)tach)$/.test(keyname)) continue;
      if (value == "...") { delete keymap[keyname]; continue; }

      var keys = map(keyname.split(" "), normalizeKeyName);
      for (var i = 0; i < keys.length; i++) {
        var val, name;
        if (i == keys.length - 1) {
          name = keys.join(" ");
          val = value;
        } else {
          name = keys.slice(0, i + 1).join(" ");
          val = "...";
        }
        var prev = copy[name];
        if (!prev) copy[name] = val;
        else if (prev != val) throw new Error("Inconsistent bindings for " + name);
      }
      delete keymap[keyname];
    }
    for (var prop in copy) keymap[prop] = copy[prop];
    return keymap;
  };

  var lookupKey = CodeMirror.lookupKey = function(key, map, handle, context) {
    map = getKeyMap(map);
    var found = map.call ? map.call(key, context) : map[key];
    if (found === false) return "nothing";
    if (found === "...") return "multi";
    if (found != null && handle(found)) return "handled";

    if (map.fallthrough) {
      if (Object.prototype.toString.call(map.fallthrough) != "[object Array]")
        return lookupKey(key, map.fallthrough, handle, context);
      for (var i = 0; i < map.fallthrough.length; i++) {
        var result = lookupKey(key, map.fallthrough[i], handle, context);
        if (result) return result;
      }
    }
  };

  // Modifier key presses don't count as 'real' key presses for the
  // purpose of keymap fallthrough.
  var isModifierKey = CodeMirror.isModifierKey = function(value) {
    var name = typeof value == "string" ? value : keyNames[value.keyCode];
    return name == "Ctrl" || name == "Alt" || name == "Shift" || name == "Mod";
  };

  // Look up the name of a key as indicated by an event object.
  var keyName = CodeMirror.keyName = function(event, noShift) {
    if (presto && event.keyCode == 34 && event["char"]) return false;
    var base = keyNames[event.keyCode], name = base;
    if (name == null || event.altGraphKey) return false;
    if (event.altKey && base != "Alt") name = "Alt-" + name;
    if ((flipCtrlCmd ? event.metaKey : event.ctrlKey) && base != "Ctrl") name = "Ctrl-" + name;
    if ((flipCtrlCmd ? event.ctrlKey : event.metaKey) && base != "Cmd") name = "Cmd-" + name;
    if (!noShift && event.shiftKey && base != "Shift") name = "Shift-" + name;
    return name;
  };

  function getKeyMap(val) {
    return typeof val == "string" ? keyMap[val] : val;
  }

  // FROMTEXTAREA

  CodeMirror.fromTextArea = function(textarea, options) {
    options = options ? copyObj(options) : {};
    options.value = textarea.value;
    if (!options.tabindex && textarea.tabIndex)
      options.tabindex = textarea.tabIndex;
    if (!options.placeholder && textarea.placeholder)
      options.placeholder = textarea.placeholder;
    // Set autofocus to true if this textarea is focused, or if it has
    // autofocus and no other element is focused.
    if (options.autofocus == null) {
      var hasFocus = activeElt();
      options.autofocus = hasFocus == textarea ||
        textarea.getAttribute("autofocus") != null && hasFocus == document.body;
    }

    function save() {textarea.value = cm.getValue();}
    if (textarea.form) {
      on(textarea.form, "submit", save);
      // Deplorable hack to make the submit method do the right thing.
      if (!options.leaveSubmitMethodAlone) {
        var form = textarea.form, realSubmit = form.submit;
        try {
          var wrappedSubmit = form.submit = function() {
            save();
            form.submit = realSubmit;
            form.submit();
            form.submit = wrappedSubmit;
          };
        } catch(e) {}
      }
    }

    options.finishInit = function(cm) {
      cm.save = save;
      cm.getTextArea = function() { return textarea; };
      cm.toTextArea = function() {
        cm.toTextArea = isNaN; // Prevent this from being ran twice
        save();
        textarea.parentNode.removeChild(cm.getWrapperElement());
        textarea.style.display = "";
        if (textarea.form) {
          off(textarea.form, "submit", save);
          if (typeof textarea.form.submit == "function")
            textarea.form.submit = realSubmit;
        }
      };
    };

    textarea.style.display = "none";
    var cm = CodeMirror(function(node) {
      textarea.parentNode.insertBefore(node, textarea.nextSibling);
    }, options);
    return cm;
  };

  // STRING STREAM

  // Fed to the mode parsers, provides helper functions to make
  // parsers more succinct.

  var StringStream = CodeMirror.StringStream = function(string, tabSize) {
    this.pos = this.start = 0;
    this.string = string;
    this.tabSize = tabSize || 8;
    this.lastColumnPos = this.lastColumnValue = 0;
    this.lineStart = 0;
  };

  StringStream.prototype = {
    eol: function() {return this.pos >= this.string.length;},
    sol: function() {return this.pos == this.lineStart;},
    peek: function() {return this.string.charAt(this.pos) || undefined;},
    next: function() {
      if (this.pos < this.string.length)
        return this.string.charAt(this.pos++);
    },
    eat: function(match) {
      var ch = this.string.charAt(this.pos);
      if (typeof match == "string") var ok = ch == match;
      else var ok = ch && (match.test ? match.test(ch) : match(ch));
      if (ok) {++this.pos; return ch;}
    },
    eatWhile: function(match) {
      var start = this.pos;
      while (this.eat(match)){}
      return this.pos > start;
    },
    eatSpace: function() {
      var start = this.pos;
      while (/[\s\u00a0]/.test(this.string.charAt(this.pos))) ++this.pos;
      return this.pos > start;
    },
    skipToEnd: function() {this.pos = this.string.length;},
    skipTo: function(ch) {
      var found = this.string.indexOf(ch, this.pos);
      if (found > -1) {this.pos = found; return true;}
    },
    backUp: function(n) {this.pos -= n;},
    column: function() {
      if (this.lastColumnPos < this.start) {
        this.lastColumnValue = countColumn(this.string, this.start, this.tabSize, this.lastColumnPos, this.lastColumnValue);
        this.lastColumnPos = this.start;
      }
      return this.lastColumnValue - (this.lineStart ? countColumn(this.string, this.lineStart, this.tabSize) : 0);
    },
    indentation: function() {
      return countColumn(this.string, null, this.tabSize) -
        (this.lineStart ? countColumn(this.string, this.lineStart, this.tabSize) : 0);
    },
    match: function(pattern, consume, caseInsensitive) {
      if (typeof pattern == "string") {
        var cased = function(str) {return caseInsensitive ? str.toLowerCase() : str;};
        var substr = this.string.substr(this.pos, pattern.length);
        if (cased(substr) == cased(pattern)) {
          if (consume !== false) this.pos += pattern.length;
          return true;
        }
      } else {
        var match = this.string.slice(this.pos).match(pattern);
        if (match && match.index > 0) return null;
        if (match && consume !== false) this.pos += match[0].length;
        return match;
      }
    },
    current: function(){return this.string.slice(this.start, this.pos);},
    hideFirstChars: function(n, inner) {
      this.lineStart += n;
      try { return inner(); }
      finally { this.lineStart -= n; }
    }
  };

  // TEXTMARKERS

  // Created with markText and setBookmark methods. A TextMarker is a
  // handle that can be used to clear or find a marked position in the
  // document. Line objects hold arrays (markedSpans) containing
  // {from, to, marker} object pointing to such marker objects, and
  // indicating that such a marker is present on that line. Multiple
  // lines may point to the same marker when it spans across lines.
  // The spans will have null for their from/to properties when the
  // marker continues beyond the start/end of the line. Markers have
  // links back to the lines they currently touch.

  var nextMarkerId = 0;

  var TextMarker = CodeMirror.TextMarker = function(doc, type) {
    this.lines = [];
    this.type = type;
    this.doc = doc;
    this.id = ++nextMarkerId;
  };
  eventMixin(TextMarker);

  // Clear the marker.
  TextMarker.prototype.clear = function() {
    if (this.explicitlyCleared) return;
    var cm = this.doc.cm, withOp = cm && !cm.curOp;
    if (withOp) startOperation(cm);
    if (hasHandler(this, "clear")) {
      var found = this.find();
      if (found) signalLater(this, "clear", found.from, found.to);
    }
    var min = null, max = null;
    for (var i = 0; i < this.lines.length; ++i) {
      var line = this.lines[i];
      var span = getMarkedSpanFor(line.markedSpans, this);
      if (cm && !this.collapsed) regLineChange(cm, lineNo(line), "text");
      else if (cm) {
        if (span.to != null) max = lineNo(line);
        if (span.from != null) min = lineNo(line);
      }
      line.markedSpans = removeMarkedSpan(line.markedSpans, span);
      if (span.from == null && this.collapsed && !lineIsHidden(this.doc, line) && cm)
        updateLineHeight(line, textHeight(cm.display));
    }
    if (cm && this.collapsed && !cm.options.lineWrapping) for (var i = 0; i < this.lines.length; ++i) {
      var visual = visualLine(this.lines[i]), len = lineLength(visual);
      if (len > cm.display.maxLineLength) {
        cm.display.maxLine = visual;
        cm.display.maxLineLength = len;
        cm.display.maxLineChanged = true;
      }
    }

    if (min != null && cm && this.collapsed) regChange(cm, min, max + 1);
    this.lines.length = 0;
    this.explicitlyCleared = true;
    if (this.atomic && this.doc.cantEdit) {
      this.doc.cantEdit = false;
      if (cm) reCheckSelection(cm.doc);
    }
    if (cm) signalLater(cm, "markerCleared", cm, this);
    if (withOp) endOperation(cm);
    if (this.parent) this.parent.clear();
  };

  // Find the position of the marker in the document. Returns a {from,
  // to} object by default. Side can be passed to get a specific side
  // -- 0 (both), -1 (left), or 1 (right). When lineObj is true, the
  // Pos objects returned contain a line object, rather than a line
  // number (used to prevent looking up the same line twice).
  TextMarker.prototype.find = function(side, lineObj) {
    if (side == null && this.type == "bookmark") side = 1;
    var from, to;
    for (var i = 0; i < this.lines.length; ++i) {
      var line = this.lines[i];
      var span = getMarkedSpanFor(line.markedSpans, this);
      if (span.from != null) {
        from = Pos(lineObj ? line : lineNo(line), span.from);
        if (side == -1) return from;
      }
      if (span.to != null) {
        to = Pos(lineObj ? line : lineNo(line), span.to);
        if (side == 1) return to;
      }
    }
    return from && {from: from, to: to};
  };

  // Signals that the marker's widget changed, and surrounding layout
  // should be recomputed.
  TextMarker.prototype.changed = function() {
    var pos = this.find(-1, true), widget = this, cm = this.doc.cm;
    if (!pos || !cm) return;
    runInOp(cm, function() {
      var line = pos.line, lineN = lineNo(pos.line);
      var view = findViewForLine(cm, lineN);
      if (view) {
        clearLineMeasurementCacheFor(view);
        cm.curOp.selectionChanged = cm.curOp.forceUpdate = true;
      }
      cm.curOp.updateMaxLine = true;
      if (!lineIsHidden(widget.doc, line) && widget.height != null) {
        var oldHeight = widget.height;
        widget.height = null;
        var dHeight = widgetHeight(widget) - oldHeight;
        if (dHeight)
          updateLineHeight(line, line.height + dHeight);
      }
    });
  };

  TextMarker.prototype.attachLine = function(line) {
    if (!this.lines.length && this.doc.cm) {
      var op = this.doc.cm.curOp;
      if (!op.maybeHiddenMarkers || indexOf(op.maybeHiddenMarkers, this) == -1)
        (op.maybeUnhiddenMarkers || (op.maybeUnhiddenMarkers = [])).push(this);
    }
    this.lines.push(line);
  };
  TextMarker.prototype.detachLine = function(line) {
    this.lines.splice(indexOf(this.lines, line), 1);
    if (!this.lines.length && this.doc.cm) {
      var op = this.doc.cm.curOp;
      (op.maybeHiddenMarkers || (op.maybeHiddenMarkers = [])).push(this);
    }
  };

  // Collapsed markers have unique ids, in order to be able to order
  // them, which is needed for uniquely determining an outer marker
  // when they overlap (they may nest, but not partially overlap).
  var nextMarkerId = 0;

  // Create a marker, wire it up to the right lines, and
  function markText(doc, from, to, options, type) {
    // Shared markers (across linked documents) are handled separately
    // (markTextShared will call out to this again, once per
    // document).
    if (options && options.shared) return markTextShared(doc, from, to, options, type);
    // Ensure we are in an operation.
    if (doc.cm && !doc.cm.curOp) return operation(doc.cm, markText)(doc, from, to, options, type);

    var marker = new TextMarker(doc, type), diff = cmp(from, to);
    if (options) copyObj(options, marker, false);
    // Don't connect empty markers unless clearWhenEmpty is false
    if (diff > 0 || diff == 0 && marker.clearWhenEmpty !== false)
      return marker;
    if (marker.replacedWith) {
      // Showing up as a widget implies collapsed (widget replaces text)
      marker.collapsed = true;
      marker.widgetNode = elt("span", [marker.replacedWith], "CodeMirror-widget");
      if (!options.handleMouseEvents) marker.widgetNode.setAttribute("cm-ignore-events", "true");
      if (options.insertLeft) marker.widgetNode.insertLeft = true;
    }
    if (marker.collapsed) {
      if (conflictingCollapsedRange(doc, from.line, from, to, marker) ||
          from.line != to.line && conflictingCollapsedRange(doc, to.line, from, to, marker))
        throw new Error("Inserting collapsed marker partially overlapping an existing one");
      sawCollapsedSpans = true;
    }

    if (marker.addToHistory)
      addChangeToHistory(doc, {from: from, to: to, origin: "markText"}, doc.sel, NaN);

    var curLine = from.line, cm = doc.cm, updateMaxLine;
    doc.iter(curLine, to.line + 1, function(line) {
      if (cm && marker.collapsed && !cm.options.lineWrapping && visualLine(line) == cm.display.maxLine)
        updateMaxLine = true;
      if (marker.collapsed && curLine != from.line) updateLineHeight(line, 0);
      addMarkedSpan(line, new MarkedSpan(marker,
                                         curLine == from.line ? from.ch : null,
                                         curLine == to.line ? to.ch : null));
      ++curLine;
    });
    // lineIsHidden depends on the presence of the spans, so needs a second pass
    if (marker.collapsed) doc.iter(from.line, to.line + 1, function(line) {
      if (lineIsHidden(doc, line)) updateLineHeight(line, 0);
    });

    if (marker.clearOnEnter) on(marker, "beforeCursorEnter", function() { marker.clear(); });

    if (marker.readOnly) {
      sawReadOnlySpans = true;
      if (doc.history.done.length || doc.history.undone.length)
        doc.clearHistory();
    }
    if (marker.collapsed) {
      marker.id = ++nextMarkerId;
      marker.atomic = true;
    }
    if (cm) {
      // Sync editor state
      if (updateMaxLine) cm.curOp.updateMaxLine = true;
      if (marker.collapsed)
        regChange(cm, from.line, to.line + 1);
      else if (marker.className || marker.title || marker.startStyle || marker.endStyle || marker.css)
        for (var i = from.line; i <= to.line; i++) regLineChange(cm, i, "text");
      if (marker.atomic) reCheckSelection(cm.doc);
      signalLater(cm, "markerAdded", cm, marker);
    }
    return marker;
  }

  // SHARED TEXTMARKERS

  // A shared marker spans multiple linked documents. It is
  // implemented as a meta-marker-object controlling multiple normal
  // markers.
  var SharedTextMarker = CodeMirror.SharedTextMarker = function(markers, primary) {
    this.markers = markers;
    this.primary = primary;
    for (var i = 0; i < markers.length; ++i)
      markers[i].parent = this;
  };
  eventMixin(SharedTextMarker);

  SharedTextMarker.prototype.clear = function() {
    if (this.explicitlyCleared) return;
    this.explicitlyCleared = true;
    for (var i = 0; i < this.markers.length; ++i)
      this.markers[i].clear();
    signalLater(this, "clear");
  };
  SharedTextMarker.prototype.find = function(side, lineObj) {
    return this.primary.find(side, lineObj);
  };

  function markTextShared(doc, from, to, options, type) {
    options = copyObj(options);
    options.shared = false;
    var markers = [markText(doc, from, to, options, type)], primary = markers[0];
    var widget = options.widgetNode;
    linkedDocs(doc, function(doc) {
      if (widget) options.widgetNode = widget.cloneNode(true);
      markers.push(markText(doc, clipPos(doc, from), clipPos(doc, to), options, type));
      for (var i = 0; i < doc.linked.length; ++i)
        if (doc.linked[i].isParent) return;
      primary = lst(markers);
    });
    return new SharedTextMarker(markers, primary);
  }

  function findSharedMarkers(doc) {
    return doc.findMarks(Pos(doc.first, 0), doc.clipPos(Pos(doc.lastLine())),
                         function(m) { return m.parent; });
  }

  function copySharedMarkers(doc, markers) {
    for (var i = 0; i < markers.length; i++) {
      var marker = markers[i], pos = marker.find();
      var mFrom = doc.clipPos(pos.from), mTo = doc.clipPos(pos.to);
      if (cmp(mFrom, mTo)) {
        var subMark = markText(doc, mFrom, mTo, marker.primary, marker.primary.type);
        marker.markers.push(subMark);
        subMark.parent = marker;
      }
    }
  }

  function detachSharedMarkers(markers) {
    for (var i = 0; i < markers.length; i++) {
      var marker = markers[i], linked = [marker.primary.doc];;
      linkedDocs(marker.primary.doc, function(d) { linked.push(d); });
      for (var j = 0; j < marker.markers.length; j++) {
        var subMarker = marker.markers[j];
        if (indexOf(linked, subMarker.doc) == -1) {
          subMarker.parent = null;
          marker.markers.splice(j--, 1);
        }
      }
    }
  }

  // TEXTMARKER SPANS

  function MarkedSpan(marker, from, to) {
    this.marker = marker;
    this.from = from; this.to = to;
  }

  // Search an array of spans for a span matching the given marker.
  function getMarkedSpanFor(spans, marker) {
    if (spans) for (var i = 0; i < spans.length; ++i) {
      var span = spans[i];
      if (span.marker == marker) return span;
    }
  }
  // Remove a span from an array, returning undefined if no spans are
  // left (we don't store arrays for lines without spans).
  function removeMarkedSpan(spans, span) {
    for (var r, i = 0; i < spans.length; ++i)
      if (spans[i] != span) (r || (r = [])).push(spans[i]);
    return r;
  }
  // Add a span to a line.
  function addMarkedSpan(line, span) {
    line.markedSpans = line.markedSpans ? line.markedSpans.concat([span]) : [span];
    span.marker.attachLine(line);
  }

  // Used for the algorithm that adjusts markers for a change in the
  // document. These functions cut an array of spans at a given
  // character position, returning an array of remaining chunks (or
  // undefined if nothing remains).
  function markedSpansBefore(old, startCh, isInsert) {
    if (old) for (var i = 0, nw; i < old.length; ++i) {
      var span = old[i], marker = span.marker;
      var startsBefore = span.from == null || (marker.inclusiveLeft ? span.from <= startCh : span.from < startCh);
      if (startsBefore || span.from == startCh && marker.type == "bookmark" && (!isInsert || !span.marker.insertLeft)) {
        var endsAfter = span.to == null || (marker.inclusiveRight ? span.to >= startCh : span.to > startCh);
        (nw || (nw = [])).push(new MarkedSpan(marker, span.from, endsAfter ? null : span.to));
      }
    }
    return nw;
  }
  function markedSpansAfter(old, endCh, isInsert) {
    if (old) for (var i = 0, nw; i < old.length; ++i) {
      var span = old[i], marker = span.marker;
      var endsAfter = span.to == null || (marker.inclusiveRight ? span.to >= endCh : span.to > endCh);
      if (endsAfter || span.from == endCh && marker.type == "bookmark" && (!isInsert || span.marker.insertLeft)) {
        var startsBefore = span.from == null || (marker.inclusiveLeft ? span.from <= endCh : span.from < endCh);
        (nw || (nw = [])).push(new MarkedSpan(marker, startsBefore ? null : span.from - endCh,
                                              span.to == null ? null : span.to - endCh));
      }
    }
    return nw;
  }

  // Given a change object, compute the new set of marker spans that
  // cover the line in which the change took place. Removes spans
  // entirely within the change, reconnects spans belonging to the
  // same marker that appear on both sides of the change, and cuts off
  // spans partially within the change. Returns an array of span
  // arrays with one element for each line in (after) the change.
  function stretchSpansOverChange(doc, change) {
    if (change.full) return null;
    var oldFirst = isLine(doc, change.from.line) && getLine(doc, change.from.line).markedSpans;
    var oldLast = isLine(doc, change.to.line) && getLine(doc, change.to.line).markedSpans;
    if (!oldFirst && !oldLast) return null;

    var startCh = change.from.ch, endCh = change.to.ch, isInsert = cmp(change.from, change.to) == 0;
    // Get the spans that 'stick out' on both sides
    var first = markedSpansBefore(oldFirst, startCh, isInsert);
    var last = markedSpansAfter(oldLast, endCh, isInsert);

    // Next, merge those two ends
    var sameLine = change.text.length == 1, offset = lst(change.text).length + (sameLine ? startCh : 0);
    if (first) {
      // Fix up .to properties of first
      for (var i = 0; i < first.length; ++i) {
        var span = first[i];
        if (span.to == null) {
          var found = getMarkedSpanFor(last, span.marker);
          if (!found) span.to = startCh;
          else if (sameLine) span.to = found.to == null ? null : found.to + offset;
        }
      }
    }
    if (last) {
      // Fix up .from in last (or move them into first in case of sameLine)
      for (var i = 0; i < last.length; ++i) {
        var span = last[i];
        if (span.to != null) span.to += offset;
        if (span.from == null) {
          var found = getMarkedSpanFor(first, span.marker);
          if (!found) {
            span.from = offset;
            if (sameLine) (first || (first = [])).push(span);
          }
        } else {
          span.from += offset;
          if (sameLine) (first || (first = [])).push(span);
        }
      }
    }
    // Make sure we didn't create any zero-length spans
    if (first) first = clearEmptySpans(first);
    if (last && last != first) last = clearEmptySpans(last);

    var newMarkers = [first];
    if (!sameLine) {
      // Fill gap with whole-line-spans
      var gap = change.text.length - 2, gapMarkers;
      if (gap > 0 && first)
        for (var i = 0; i < first.length; ++i)
          if (first[i].to == null)
            (gapMarkers || (gapMarkers = [])).push(new MarkedSpan(first[i].marker, null, null));
      for (var i = 0; i < gap; ++i)
        newMarkers.push(gapMarkers);
      newMarkers.push(last);
    }
    return newMarkers;
  }

  // Remove spans that are empty and don't have a clearWhenEmpty
  // option of false.
  function clearEmptySpans(spans) {
    for (var i = 0; i < spans.length; ++i) {
      var span = spans[i];
      if (span.from != null && span.from == span.to && span.marker.clearWhenEmpty !== false)
        spans.splice(i--, 1);
    }
    if (!spans.length) return null;
    return spans;
  }

  // Used for un/re-doing changes from the history. Combines the
  // result of computing the existing spans with the set of spans that
  // existed in the history (so that deleting around a span and then
  // undoing brings back the span).
  function mergeOldSpans(doc, change) {
    var old = getOldSpans(doc, change);
    var stretched = stretchSpansOverChange(doc, change);
    if (!old) return stretched;
    if (!stretched) return old;

    for (var i = 0; i < old.length; ++i) {
      var oldCur = old[i], stretchCur = stretched[i];
      if (oldCur && stretchCur) {
        spans: for (var j = 0; j < stretchCur.length; ++j) {
          var span = stretchCur[j];
          for (var k = 0; k < oldCur.length; ++k)
            if (oldCur[k].marker == span.marker) continue spans;
          oldCur.push(span);
        }
      } else if (stretchCur) {
        old[i] = stretchCur;
      }
    }
    return old;
  }

  // Used to 'clip' out readOnly ranges when making a change.
  function removeReadOnlyRanges(doc, from, to) {
    var markers = null;
    doc.iter(from.line, to.line + 1, function(line) {
      if (line.markedSpans) for (var i = 0; i < line.markedSpans.length; ++i) {
        var mark = line.markedSpans[i].marker;
        if (mark.readOnly && (!markers || indexOf(markers, mark) == -1))
          (markers || (markers = [])).push(mark);
      }
    });
    if (!markers) return null;
    var parts = [{from: from, to: to}];
    for (var i = 0; i < markers.length; ++i) {
      var mk = markers[i], m = mk.find(0);
      for (var j = 0; j < parts.length; ++j) {
        var p = parts[j];
        if (cmp(p.to, m.from) < 0 || cmp(p.from, m.to) > 0) continue;
        var newParts = [j, 1], dfrom = cmp(p.from, m.from), dto = cmp(p.to, m.to);
        if (dfrom < 0 || !mk.inclusiveLeft && !dfrom)
          newParts.push({from: p.from, to: m.from});
        if (dto > 0 || !mk.inclusiveRight && !dto)
          newParts.push({from: m.to, to: p.to});
        parts.splice.apply(parts, newParts);
        j += newParts.length - 1;
      }
    }
    return parts;
  }

  // Connect or disconnect spans from a line.
  function detachMarkedSpans(line) {
    var spans = line.markedSpans;
    if (!spans) return;
    for (var i = 0; i < spans.length; ++i)
      spans[i].marker.detachLine(line);
    line.markedSpans = null;
  }
  function attachMarkedSpans(line, spans) {
    if (!spans) return;
    for (var i = 0; i < spans.length; ++i)
      spans[i].marker.attachLine(line);
    line.markedSpans = spans;
  }

  // Helpers used when computing which overlapping collapsed span
  // counts as the larger one.
  function extraLeft(marker) { return marker.inclusiveLeft ? -1 : 0; }
  function extraRight(marker) { return marker.inclusiveRight ? 1 : 0; }

  // Returns a number indicating which of two overlapping collapsed
  // spans is larger (and thus includes the other). Falls back to
  // comparing ids when the spans cover exactly the same range.
  function compareCollapsedMarkers(a, b) {
    var lenDiff = a.lines.length - b.lines.length;
    if (lenDiff != 0) return lenDiff;
    var aPos = a.find(), bPos = b.find();
    var fromCmp = cmp(aPos.from, bPos.from) || extraLeft(a) - extraLeft(b);
    if (fromCmp) return -fromCmp;
    var toCmp = cmp(aPos.to, bPos.to) || extraRight(a) - extraRight(b);
    if (toCmp) return toCmp;
    return b.id - a.id;
  }

  // Find out whether a line ends or starts in a collapsed span. If
  // so, return the marker for that span.
  function collapsedSpanAtSide(line, start) {
    var sps = sawCollapsedSpans && line.markedSpans, found;
    if (sps) for (var sp, i = 0; i < sps.length; ++i) {
      sp = sps[i];
      if (sp.marker.collapsed && (start ? sp.from : sp.to) == null &&
          (!found || compareCollapsedMarkers(found, sp.marker) < 0))
        found = sp.marker;
    }
    return found;
  }
  function collapsedSpanAtStart(line) { return collapsedSpanAtSide(line, true); }
  function collapsedSpanAtEnd(line) { return collapsedSpanAtSide(line, false); }

  // Test whether there exists a collapsed span that partially
  // overlaps (covers the start or end, but not both) of a new span.
  // Such overlap is not allowed.
  function conflictingCollapsedRange(doc, lineNo, from, to, marker) {
    var line = getLine(doc, lineNo);
    var sps = sawCollapsedSpans && line.markedSpans;
    if (sps) for (var i = 0; i < sps.length; ++i) {
      var sp = sps[i];
      if (!sp.marker.collapsed) continue;
      var found = sp.marker.find(0);
      var fromCmp = cmp(found.from, from) || extraLeft(sp.marker) - extraLeft(marker);
      var toCmp = cmp(found.to, to) || extraRight(sp.marker) - extraRight(marker);
      if (fromCmp >= 0 && toCmp <= 0 || fromCmp <= 0 && toCmp >= 0) continue;
      if (fromCmp <= 0 && (cmp(found.to, from) > 0 || (sp.marker.inclusiveRight && marker.inclusiveLeft)) ||
          fromCmp >= 0 && (cmp(found.from, to) < 0 || (sp.marker.inclusiveLeft && marker.inclusiveRight)))
        return true;
    }
  }

  // A visual line is a line as drawn on the screen. Folding, for
  // example, can cause multiple logical lines to appear on the same
  // visual line. This finds the start of the visual line that the
  // given line is part of (usually that is the line itself).
  function visualLine(line) {
    var merged;
    while (merged = collapsedSpanAtStart(line))
      line = merged.find(-1, true).line;
    return line;
  }

  // Returns an array of logical lines that continue the visual line
  // started by the argument, or undefined if there are no such lines.
  function visualLineContinued(line) {
    var merged, lines;
    while (merged = collapsedSpanAtEnd(line)) {
      line = merged.find(1, true).line;
      (lines || (lines = [])).push(line);
    }
    return lines;
  }

  // Get the line number of the start of the visual line that the
  // given line number is part of.
  function visualLineNo(doc, lineN) {
    var line = getLine(doc, lineN), vis = visualLine(line);
    if (line == vis) return lineN;
    return lineNo(vis);
  }
  // Get the line number of the start of the next visual line after
  // the given line.
  function visualLineEndNo(doc, lineN) {
    if (lineN > doc.lastLine()) return lineN;
    var line = getLine(doc, lineN), merged;
    if (!lineIsHidden(doc, line)) return lineN;
    while (merged = collapsedSpanAtEnd(line))
      line = merged.find(1, true).line;
    return lineNo(line) + 1;
  }

  // Compute whether a line is hidden. Lines count as hidden when they
  // are part of a visual line that starts with another line, or when
  // they are entirely covered by collapsed, non-widget span.
  function lineIsHidden(doc, line) {
    var sps = sawCollapsedSpans && line.markedSpans;
    if (sps) for (var sp, i = 0; i < sps.length; ++i) {
      sp = sps[i];
      if (!sp.marker.collapsed) continue;
      if (sp.from == null) return true;
      if (sp.marker.widgetNode) continue;
      if (sp.from == 0 && sp.marker.inclusiveLeft && lineIsHiddenInner(doc, line, sp))
        return true;
    }
  }
  function lineIsHiddenInner(doc, line, span) {
    if (span.to == null) {
      var end = span.marker.find(1, true);
      return lineIsHiddenInner(doc, end.line, getMarkedSpanFor(end.line.markedSpans, span.marker));
    }
    if (span.marker.inclusiveRight && span.to == line.text.length)
      return true;
    for (var sp, i = 0; i < line.markedSpans.length; ++i) {
      sp = line.markedSpans[i];
      if (sp.marker.collapsed && !sp.marker.widgetNode && sp.from == span.to &&
          (sp.to == null || sp.to != span.from) &&
          (sp.marker.inclusiveLeft || span.marker.inclusiveRight) &&
          lineIsHiddenInner(doc, line, sp)) return true;
    }
  }

  // LINE WIDGETS

  // Line widgets are block elements displayed above or below a line.

  var LineWidget = CodeMirror.LineWidget = function(doc, node, options) {
    if (options) for (var opt in options) if (options.hasOwnProperty(opt))
      this[opt] = options[opt];
    this.doc = doc;
    this.node = node;
  };
  eventMixin(LineWidget);

  function adjustScrollWhenAboveVisible(cm, line, diff) {
    if (heightAtLine(line) < ((cm.curOp && cm.curOp.scrollTop) || cm.doc.scrollTop))
      addToScrollPos(cm, null, diff);
  }

  LineWidget.prototype.clear = function() {
    var cm = this.doc.cm, ws = this.line.widgets, line = this.line, no = lineNo(line);
    if (no == null || !ws) return;
    for (var i = 0; i < ws.length; ++i) if (ws[i] == this) ws.splice(i--, 1);
    if (!ws.length) line.widgets = null;
    var height = widgetHeight(this);
    updateLineHeight(line, Math.max(0, line.height - height));
    if (cm) runInOp(cm, function() {
      adjustScrollWhenAboveVisible(cm, line, -height);
      regLineChange(cm, no, "widget");
    });
  };
  LineWidget.prototype.changed = function() {
    var oldH = this.height, cm = this.doc.cm, line = this.line;
    this.height = null;
    var diff = widgetHeight(this) - oldH;
    if (!diff) return;
    updateLineHeight(line, line.height + diff);
    if (cm) runInOp(cm, function() {
      cm.curOp.forceUpdate = true;
      adjustScrollWhenAboveVisible(cm, line, diff);
    });
  };

  function widgetHeight(widget) {
    if (widget.height != null) return widget.height;
    var cm = widget.doc.cm;
    if (!cm) return 0;
    if (!contains(document.body, widget.node)) {
      var parentStyle = "position: relative;";
      if (widget.coverGutter)
        parentStyle += "margin-left: -" + cm.display.gutters.offsetWidth + "px;";
      if (widget.noHScroll)
        parentStyle += "width: " + cm.display.wrapper.clientWidth + "px;";
      removeChildrenAndAdd(cm.display.measure, elt("div", [widget.node], null, parentStyle));
    }
    return widget.height = widget.node.parentNode.offsetHeight;
  }

  function addLineWidget(doc, handle, node, options) {
    var widget = new LineWidget(doc, node, options);
    var cm = doc.cm;
    if (cm && widget.noHScroll) cm.display.alignWidgets = true;
    changeLine(doc, handle, "widget", function(line) {
      var widgets = line.widgets || (line.widgets = []);
      if (widget.insertAt == null) widgets.push(widget);
      else widgets.splice(Math.min(widgets.length - 1, Math.max(0, widget.insertAt)), 0, widget);
      widget.line = line;
      if (cm && !lineIsHidden(doc, line)) {
        var aboveVisible = heightAtLine(line) < doc.scrollTop;
        updateLineHeight(line, line.height + widgetHeight(widget));
        if (aboveVisible) addToScrollPos(cm, null, widget.height);
        cm.curOp.forceUpdate = true;
      }
      return true;
    });
    return widget;
  }

  // LINE DATA STRUCTURE

  // Line objects. These hold state related to a line, including
  // highlighting info (the styles array).
  var Line = CodeMirror.Line = function(text, markedSpans, estimateHeight) {
    this.text = text;
    attachMarkedSpans(this, markedSpans);
    this.height = estimateHeight ? estimateHeight(this) : 1;
  };
  eventMixin(Line);
  Line.prototype.lineNo = function() { return lineNo(this); };

  // Change the content (text, markers) of a line. Automatically
  // invalidates cached information and tries to re-estimate the
  // line's height.
  function updateLine(line, text, markedSpans, estimateHeight) {
    line.text = text;
    if (line.stateAfter) line.stateAfter = null;
    if (line.styles) line.styles = null;
    if (line.order != null) line.order = null;
    detachMarkedSpans(line);
    attachMarkedSpans(line, markedSpans);
    var estHeight = estimateHeight ? estimateHeight(line) : 1;
    if (estHeight != line.height) updateLineHeight(line, estHeight);
  }

  // Detach a line from the document tree and its markers.
  function cleanUpLine(line) {
    line.parent = null;
    detachMarkedSpans(line);
  }

  function extractLineClasses(type, output) {
    if (type) for (;;) {
      var lineClass = type.match(/(?:^|\s+)line-(background-)?(\S+)/);
      if (!lineClass) break;
      type = type.slice(0, lineClass.index) + type.slice(lineClass.index + lineClass[0].length);
      var prop = lineClass[1] ? "bgClass" : "textClass";
      if (output[prop] == null)
        output[prop] = lineClass[2];
      else if (!(new RegExp("(?:^|\s)" + lineClass[2] + "(?:$|\s)")).test(output[prop]))
        output[prop] += " " + lineClass[2];
    }
    return type;
  }

  function callBlankLine(mode, state) {
    if (mode.blankLine) return mode.blankLine(state);
    if (!mode.innerMode) return;
    var inner = CodeMirror.innerMode(mode, state);
    if (inner.mode.blankLine) return inner.mode.blankLine(inner.state);
  }

  function readToken(mode, stream, state, inner) {
    for (var i = 0; i < 10; i++) {
      if (inner) inner[0] = CodeMirror.innerMode(mode, state).mode;
      var style = mode.token(stream, state);
      if (stream.pos > stream.start) return style;
    }
    throw new Error("Mode " + mode.name + " failed to advance stream.");
  }

  // Utility for getTokenAt and getLineTokens
  function takeToken(cm, pos, precise, asArray) {
    function getObj(copy) {
      return {start: stream.start, end: stream.pos,
              string: stream.current(),
              type: style || null,
              state: copy ? copyState(doc.mode, state) : state};
    }

    var doc = cm.doc, mode = doc.mode, style;
    pos = clipPos(doc, pos);
    var line = getLine(doc, pos.line), state = getStateBefore(cm, pos.line, precise);
    var stream = new StringStream(line.text, cm.options.tabSize), tokens;
    if (asArray) tokens = [];
    while ((asArray || stream.pos < pos.ch) && !stream.eol()) {
      stream.start = stream.pos;
      style = readToken(mode, stream, state);
      if (asArray) tokens.push(getObj(true));
    }
    return asArray ? tokens : getObj();
  }

  // Run the given mode's parser over a line, calling f for each token.
  function runMode(cm, text, mode, state, f, lineClasses, forceToEnd) {
    var flattenSpans = mode.flattenSpans;
    if (flattenSpans == null) flattenSpans = cm.options.flattenSpans;
    var curStart = 0, curStyle = null;
    var stream = new StringStream(text, cm.options.tabSize), style;
    var inner = cm.options.addModeClass && [null];
    if (text == "") extractLineClasses(callBlankLine(mode, state), lineClasses);
    while (!stream.eol()) {
      if (stream.pos > cm.options.maxHighlightLength) {
        flattenSpans = false;
        if (forceToEnd) processLine(cm, text, state, stream.pos);
        stream.pos = text.length;
        style = null;
      } else {
        style = extractLineClasses(readToken(mode, stream, state, inner), lineClasses);
      }
      if (inner) {
        var mName = inner[0].name;
        if (mName) style = "m-" + (style ? mName + " " + style : mName);
      }
      if (!flattenSpans || curStyle != style) {
        while (curStart < stream.start) {
          curStart = Math.min(stream.start, curStart + 50000);
          f(curStart, curStyle);
        }
        curStyle = style;
      }
      stream.start = stream.pos;
    }
    while (curStart < stream.pos) {
      // Webkit seems to refuse to render text nodes longer than 57444 characters
      var pos = Math.min(stream.pos, curStart + 50000);
      f(pos, curStyle);
      curStart = pos;
    }
  }

  // Compute a style array (an array starting with a mode generation
  // -- for invalidation -- followed by pairs of end positions and
  // style strings), which is used to highlight the tokens on the
  // line.
  function highlightLine(cm, line, state, forceToEnd) {
    // A styles array always starts with a number identifying the
    // mode/overlays that it is based on (for easy invalidation).
    var st = [cm.state.modeGen], lineClasses = {};
    // Compute the base array of styles
    runMode(cm, line.text, cm.doc.mode, state, function(end, style) {
      st.push(end, style);
    }, lineClasses, forceToEnd);

    // Run overlays, adjust style array.
    for (var o = 0; o < cm.state.overlays.length; ++o) {
      var overlay = cm.state.overlays[o], i = 1, at = 0;
      runMode(cm, line.text, overlay.mode, true, function(end, style) {
        var start = i;
        // Ensure there's a token end at the current position, and that i points at it
        while (at < end) {
          var i_end = st[i];
          if (i_end > end)
            st.splice(i, 1, end, st[i+1], i_end);
          i += 2;
          at = Math.min(end, i_end);
        }
        if (!style) return;
        if (overlay.opaque) {
          st.splice(start, i - start, end, "cm-overlay " + style);
          i = start + 2;
        } else {
          for (; start < i; start += 2) {
            var cur = st[start+1];
            st[start+1] = (cur ? cur + " " : "") + "cm-overlay " + style;
          }
        }
      }, lineClasses);
    }

    return {styles: st, classes: lineClasses.bgClass || lineClasses.textClass ? lineClasses : null};
  }

  function getLineStyles(cm, line, updateFrontier) {
    if (!line.styles || line.styles[0] != cm.state.modeGen) {
      var state = getStateBefore(cm, lineNo(line));
      var result = highlightLine(cm, line, line.text.length > cm.options.maxHighlightLength ? copyState(cm.doc.mode, state) : state);
      line.stateAfter = state;
      line.styles = result.styles;
      if (result.classes) line.styleClasses = result.classes;
      else if (line.styleClasses) line.styleClasses = null;
      if (updateFrontier === cm.doc.frontier) cm.doc.frontier++;
    }
    return line.styles;
  }

  // Lightweight form of highlight -- proceed over this line and
  // update state, but don't save a style array. Used for lines that
  // aren't currently visible.
  function processLine(cm, text, state, startAt) {
    var mode = cm.doc.mode;
    var stream = new StringStream(text, cm.options.tabSize);
    stream.start = stream.pos = startAt || 0;
    if (text == "") callBlankLine(mode, state);
    while (!stream.eol()) {
      readToken(mode, stream, state);
      stream.start = stream.pos;
    }
  }

  // Convert a style as returned by a mode (either null, or a string
  // containing one or more styles) to a CSS style. This is cached,
  // and also looks for line-wide styles.
  var styleToClassCache = {}, styleToClassCacheWithMode = {};
  function interpretTokenStyle(style, options) {
    if (!style || /^\s*$/.test(style)) return null;
    var cache = options.addModeClass ? styleToClassCacheWithMode : styleToClassCache;
    return cache[style] ||
      (cache[style] = style.replace(/\S+/g, "cm-$&"));
  }

  // Render the DOM representation of the text of a line. Also builds
  // up a 'line map', which points at the DOM nodes that represent
  // specific stretches of text, and is used by the measuring code.
  // The returned object contains the DOM node, this map, and
  // information about line-wide styles that were set by the mode.
  function buildLineContent(cm, lineView) {
    // The padding-right forces the element to have a 'border', which
    // is needed on Webkit to be able to get line-level bounding
    // rectangles for it (in measureChar).
    var content = elt("span", null, null, webkit ? "padding-right: .1px" : null);
    var builder = {pre: elt("pre", [content], "CodeMirror-line"), content: content,
                   col: 0, pos: 0, cm: cm,
                   splitSpaces: (ie || webkit) && cm.getOption("lineWrapping")};
    lineView.measure = {};

    // Iterate over the logical lines that make up this visual line.
    for (var i = 0; i <= (lineView.rest ? lineView.rest.length : 0); i++) {
      var line = i ? lineView.rest[i - 1] : lineView.line, order;
      builder.pos = 0;
      builder.addToken = buildToken;
      // Optionally wire in some hacks into the token-rendering
      // algorithm, to deal with browser quirks.
      if (hasBadBidiRects(cm.display.measure) && (order = getOrder(line)))
        builder.addToken = buildTokenBadBidi(builder.addToken, order);
      builder.map = [];
      var allowFrontierUpdate = lineView != cm.display.externalMeasured && lineNo(line);
      insertLineContent(line, builder, getLineStyles(cm, line, allowFrontierUpdate));
      if (line.styleClasses) {
        if (line.styleClasses.bgClass)
          builder.bgClass = joinClasses(line.styleClasses.bgClass, builder.bgClass || "");
        if (line.styleClasses.textClass)
          builder.textClass = joinClasses(line.styleClasses.textClass, builder.textClass || "");
      }

      // Ensure at least a single node is present, for measuring.
      if (builder.map.length == 0)
        builder.map.push(0, 0, builder.content.appendChild(zeroWidthElement(cm.display.measure)));

      // Store the map and a cache object for the current logical line
      if (i == 0) {
        lineView.measure.map = builder.map;
        lineView.measure.cache = {};
      } else {
        (lineView.measure.maps || (lineView.measure.maps = [])).push(builder.map);
        (lineView.measure.caches || (lineView.measure.caches = [])).push({});
      }
    }

    // See issue #2901
    if (webkit && /\bcm-tab\b/.test(builder.content.lastChild.className))
      builder.content.className = "cm-tab-wrap-hack";

    signal(cm, "renderLine", cm, lineView.line, builder.pre);
    if (builder.pre.className)
      builder.textClass = joinClasses(builder.pre.className, builder.textClass || "");

    return builder;
  }

  function defaultSpecialCharPlaceholder(ch) {
    var token = elt("span", "\u2022", "cm-invalidchar");
    token.title = "\\u" + ch.charCodeAt(0).toString(16);
    token.setAttribute("aria-label", token.title);
    return token;
  }

  // Build up the DOM representation for a single token, and add it to
  // the line map. Takes care to render special characters separately.
  function buildToken(builder, text, style, startStyle, endStyle, title, css) {
    if (!text) return;
    var displayText = builder.splitSpaces ? text.replace(/ {3,}/g, splitSpaces) : text;
    var special = builder.cm.state.specialChars, mustWrap = false;
    if (!special.test(text)) {
      builder.col += text.length;
      var content = document.createTextNode(displayText);
      builder.map.push(builder.pos, builder.pos + text.length, content);
      if (ie && ie_version < 9) mustWrap = true;
      builder.pos += text.length;
    } else {
      var content = document.createDocumentFragment(), pos = 0;
      while (true) {
        special.lastIndex = pos;
        var m = special.exec(text);
        var skipped = m ? m.index - pos : text.length - pos;
        if (skipped) {
          var txt = document.createTextNode(displayText.slice(pos, pos + skipped));
          if (ie && ie_version < 9) content.appendChild(elt("span", [txt]));
          else content.appendChild(txt);
          builder.map.push(builder.pos, builder.pos + skipped, txt);
          builder.col += skipped;
          builder.pos += skipped;
        }
        if (!m) break;
        pos += skipped + 1;
        if (m[0] == "\t") {
          var tabSize = builder.cm.options.tabSize, tabWidth = tabSize - builder.col % tabSize;
          var txt = content.appendChild(elt("span", spaceStr(tabWidth), "cm-tab"));
          txt.setAttribute("role", "presentation");
          txt.setAttribute("cm-text", "\t");
          builder.col += tabWidth;
        } else if (m[0] == "\r" || m[0] == "\n") {
          var txt = content.appendChild(elt("span", m[0] == "\r" ? "\u240d" : "\u2424", "cm-invalidchar"));
          txt.setAttribute("cm-text", m[0]);
          builder.col += 1;
        } else {
          var txt = builder.cm.options.specialCharPlaceholder(m[0]);
          txt.setAttribute("cm-text", m[0]);
          if (ie && ie_version < 9) content.appendChild(elt("span", [txt]));
          else content.appendChild(txt);
          builder.col += 1;
        }
        builder.map.push(builder.pos, builder.pos + 1, txt);
        builder.pos++;
      }
    }
    if (style || startStyle || endStyle || mustWrap || css) {
      var fullStyle = style || "";
      if (startStyle) fullStyle += startStyle;
      if (endStyle) fullStyle += endStyle;
      var token = elt("span", [content], fullStyle, css);
      if (title) token.title = title;
      return builder.content.appendChild(token);
    }
    builder.content.appendChild(content);
  }

  function splitSpaces(old) {
    var out = " ";
    for (var i = 0; i < old.length - 2; ++i) out += i % 2 ? " " : "\u00a0";
    out += " ";
    return out;
  }

  // Work around nonsense dimensions being reported for stretches of
  // right-to-left text.
  function buildTokenBadBidi(inner, order) {
    return function(builder, text, style, startStyle, endStyle, title, css) {
      style = style ? style + " cm-force-border" : "cm-force-border";
      var start = builder.pos, end = start + text.length;
      for (;;) {
        // Find the part that overlaps with the start of this text
        for (var i = 0; i < order.length; i++) {
          var part = order[i];
          if (part.to > start && part.from <= start) break;
        }
        if (part.to >= end) return inner(builder, text, style, startStyle, endStyle, title, css);
        inner(builder, text.slice(0, part.to - start), style, startStyle, null, title, css);
        startStyle = null;
        text = text.slice(part.to - start);
        start = part.to;
      }
    };
  }

  function buildCollapsedSpan(builder, size, marker, ignoreWidget) {
    var widget = !ignoreWidget && marker.widgetNode;
    if (widget) builder.map.push(builder.pos, builder.pos + size, widget);
    if (!ignoreWidget && builder.cm.display.input.needsContentAttribute) {
      if (!widget)
        widget = builder.content.appendChild(document.createElement("span"));
      widget.setAttribute("cm-marker", marker.id);
    }
    if (widget) {
      builder.cm.display.input.setUneditable(widget);
      builder.content.appendChild(widget);
    }
    builder.pos += size;
  }

  // Outputs a number of spans to make up a line, taking highlighting
  // and marked text into account.
  function insertLineContent(line, builder, styles) {
    var spans = line.markedSpans, allText = line.text, at = 0;
    if (!spans) {
      for (var i = 1; i < styles.length; i+=2)
        builder.addToken(builder, allText.slice(at, at = styles[i]), interpretTokenStyle(styles[i+1], builder.cm.options));
      return;
    }

    var len = allText.length, pos = 0, i = 1, text = "", style, css;
    var nextChange = 0, spanStyle, spanEndStyle, spanStartStyle, title, collapsed;
    for (;;) {
      if (nextChange == pos) { // Update current marker set
        spanStyle = spanEndStyle = spanStartStyle = title = css = "";
        collapsed = null; nextChange = Infinity;
        var foundBookmarks = [], endStyles
        for (var j = 0; j < spans.length; ++j) {
          var sp = spans[j], m = sp.marker;
          if (m.type == "bookmark" && sp.from == pos && m.widgetNode) {
            foundBookmarks.push(m);
          } else if (sp.from <= pos && (sp.to == null || sp.to > pos || m.collapsed && sp.to == pos && sp.from == pos)) {
            if (sp.to != null && sp.to != pos && nextChange > sp.to) {
              nextChange = sp.to;
              spanEndStyle = "";
            }
            if (m.className) spanStyle += " " + m.className;
            if (m.css) css = (css ? css + ";" : "") + m.css;
            if (m.startStyle && sp.from == pos) spanStartStyle += " " + m.startStyle;
            if (m.endStyle && sp.to == nextChange) (endStyles || (endStyles = [])).push(m.endStyle, sp.to)
            if (m.title && !title) title = m.title;
            if (m.collapsed && (!collapsed || compareCollapsedMarkers(collapsed.marker, m) < 0))
              collapsed = sp;
          } else if (sp.from > pos && nextChange > sp.from) {
            nextChange = sp.from;
          }
        }
        if (endStyles) for (var j = 0; j < endStyles.length; j += 2)
          if (endStyles[j + 1] == nextChange) spanEndStyle += " " + endStyles[j]

        if (!collapsed || collapsed.from == pos) for (var j = 0; j < foundBookmarks.length; ++j)
          buildCollapsedSpan(builder, 0, foundBookmarks[j]);
        if (collapsed && (collapsed.from || 0) == pos) {
          buildCollapsedSpan(builder, (collapsed.to == null ? len + 1 : collapsed.to) - pos,
                             collapsed.marker, collapsed.from == null);
          if (collapsed.to == null) return;
          if (collapsed.to == pos) collapsed = false;
        }
      }
      if (pos >= len) break;

      var upto = Math.min(len, nextChange);
      while (true) {
        if (text) {
          var end = pos + text.length;
          if (!collapsed) {
            var tokenText = end > upto ? text.slice(0, upto - pos) : text;
            builder.addToken(builder, tokenText, style ? style + spanStyle : spanStyle,
                             spanStartStyle, pos + tokenText.length == nextChange ? spanEndStyle : "", title, css);
          }
          if (end >= upto) {text = text.slice(upto - pos); pos = upto; break;}
          pos = end;
          spanStartStyle = "";
        }
        text = allText.slice(at, at = styles[i++]);
        style = interpretTokenStyle(styles[i++], builder.cm.options);
      }
    }
  }

  // DOCUMENT DATA STRUCTURE

  // By default, updates that start and end at the beginning of a line
  // are treated specially, in order to make the association of line
  // widgets and marker elements with the text behave more intuitive.
  function isWholeLineUpdate(doc, change) {
    return change.from.ch == 0 && change.to.ch == 0 && lst(change.text) == "" &&
      (!doc.cm || doc.cm.options.wholeLineUpdateBefore);
  }

  // Perform a change on the document data structure.
  function updateDoc(doc, change, markedSpans, estimateHeight) {
    function spansFor(n) {return markedSpans ? markedSpans[n] : null;}
    function update(line, text, spans) {
      updateLine(line, text, spans, estimateHeight);
      signalLater(line, "change", line, change);
    }
    function linesFor(start, end) {
      for (var i = start, result = []; i < end; ++i)
        result.push(new Line(text[i], spansFor(i), estimateHeight));
      return result;
    }

    var from = change.from, to = change.to, text = change.text;
    var firstLine = getLine(doc, from.line), lastLine = getLine(doc, to.line);
    var lastText = lst(text), lastSpans = spansFor(text.length - 1), nlines = to.line - from.line;

    // Adjust the line structure
    if (change.full) {
      doc.insert(0, linesFor(0, text.length));
      doc.remove(text.length, doc.size - text.length);
    } else if (isWholeLineUpdate(doc, change)) {
      // This is a whole-line replace. Treated specially to make
      // sure line objects move the way they are supposed to.
      var added = linesFor(0, text.length - 1);
      update(lastLine, lastLine.text, lastSpans);
      if (nlines) doc.remove(from.line, nlines);
      if (added.length) doc.insert(from.line, added);
    } else if (firstLine == lastLine) {
      if (text.length == 1) {
        update(firstLine, firstLine.text.slice(0, from.ch) + lastText + firstLine.text.slice(to.ch), lastSpans);
      } else {
        var added = linesFor(1, text.length - 1);
        added.push(new Line(lastText + firstLine.text.slice(to.ch), lastSpans, estimateHeight));
        update(firstLine, firstLine.text.slice(0, from.ch) + text[0], spansFor(0));
        doc.insert(from.line + 1, added);
      }
    } else if (text.length == 1) {
      update(firstLine, firstLine.text.slice(0, from.ch) + text[0] + lastLine.text.slice(to.ch), spansFor(0));
      doc.remove(from.line + 1, nlines);
    } else {
      update(firstLine, firstLine.text.slice(0, from.ch) + text[0], spansFor(0));
      update(lastLine, lastText + lastLine.text.slice(to.ch), lastSpans);
      var added = linesFor(1, text.length - 1);
      if (nlines > 1) doc.remove(from.line + 1, nlines - 1);
      doc.insert(from.line + 1, added);
    }

    signalLater(doc, "change", doc, change);
  }

  // The document is represented as a BTree consisting of leaves, with
  // chunk of lines in them, and branches, with up to ten leaves or
  // other branch nodes below them. The top node is always a branch
  // node, and is the document object itself (meaning it has
  // additional methods and properties).
  //
  // All nodes have parent links. The tree is used both to go from
  // line numbers to line objects, and to go from objects to numbers.
  // It also indexes by height, and is used to convert between height
  // and line object, and to find the total height of the document.
  //
  // See also http://marijnhaverbeke.nl/blog/codemirror-line-tree.html

  function LeafChunk(lines) {
    this.lines = lines;
    this.parent = null;
    for (var i = 0, height = 0; i < lines.length; ++i) {
      lines[i].parent = this;
      height += lines[i].height;
    }
    this.height = height;
  }

  LeafChunk.prototype = {
    chunkSize: function() { return this.lines.length; },
    // Remove the n lines at offset 'at'.
    removeInner: function(at, n) {
      for (var i = at, e = at + n; i < e; ++i) {
        var line = this.lines[i];
        this.height -= line.height;
        cleanUpLine(line);
        signalLater(line, "delete");
      }
      this.lines.splice(at, n);
    },
    // Helper used to collapse a small branch into a single leaf.
    collapse: function(lines) {
      lines.push.apply(lines, this.lines);
    },
    // Insert the given array of lines at offset 'at', count them as
    // having the given height.
    insertInner: function(at, lines, height) {
      this.height += height;
      this.lines = this.lines.slice(0, at).concat(lines).concat(this.lines.slice(at));
      for (var i = 0; i < lines.length; ++i) lines[i].parent = this;
    },
    // Used to iterate over a part of the tree.
    iterN: function(at, n, op) {
      for (var e = at + n; at < e; ++at)
        if (op(this.lines[at])) return true;
    }
  };

  function BranchChunk(children) {
    this.children = children;
    var size = 0, height = 0;
    for (var i = 0; i < children.length; ++i) {
      var ch = children[i];
      size += ch.chunkSize(); height += ch.height;
      ch.parent = this;
    }
    this.size = size;
    this.height = height;
    this.parent = null;
  }

  BranchChunk.prototype = {
    chunkSize: function() { return this.size; },
    removeInner: function(at, n) {
      this.size -= n;
      for (var i = 0; i < this.children.length; ++i) {
        var child = this.children[i], sz = child.chunkSize();
        if (at < sz) {
          var rm = Math.min(n, sz - at), oldHeight = child.height;
          child.removeInner(at, rm);
          this.height -= oldHeight - child.height;
          if (sz == rm) { this.children.splice(i--, 1); child.parent = null; }
          if ((n -= rm) == 0) break;
          at = 0;
        } else at -= sz;
      }
      // If the result is smaller than 25 lines, ensure that it is a
      // single leaf node.
      if (this.size - n < 25 &&
          (this.children.length > 1 || !(this.children[0] instanceof LeafChunk))) {
        var lines = [];
        this.collapse(lines);
        this.children = [new LeafChunk(lines)];
        this.children[0].parent = this;
      }
    },
    collapse: function(lines) {
      for (var i = 0; i < this.children.length; ++i) this.children[i].collapse(lines);
    },
    insertInner: function(at, lines, height) {
      this.size += lines.length;
      this.height += height;
      for (var i = 0; i < this.children.length; ++i) {
        var child = this.children[i], sz = child.chunkSize();
        if (at <= sz) {
          child.insertInner(at, lines, height);
          if (child.lines && child.lines.length > 50) {
            while (child.lines.length > 50) {
              var spilled = child.lines.splice(child.lines.length - 25, 25);
              var newleaf = new LeafChunk(spilled);
              child.height -= newleaf.height;
              this.children.splice(i + 1, 0, newleaf);
              newleaf.parent = this;
            }
            this.maybeSpill();
          }
          break;
        }
        at -= sz;
      }
    },
    // When a node has grown, check whether it should be split.
    maybeSpill: function() {
      if (this.children.length <= 10) return;
      var me = this;
      do {
        var spilled = me.children.splice(me.children.length - 5, 5);
        var sibling = new BranchChunk(spilled);
        if (!me.parent) { // Become the parent node
          var copy = new BranchChunk(me.children);
          copy.parent = me;
          me.children = [copy, sibling];
          me = copy;
        } else {
          me.size -= sibling.size;
          me.height -= sibling.height;
          var myIndex = indexOf(me.parent.children, me);
          me.parent.children.splice(myIndex + 1, 0, sibling);
        }
        sibling.parent = me.parent;
      } while (me.children.length > 10);
      me.parent.maybeSpill();
    },
    iterN: function(at, n, op) {
      for (var i = 0; i < this.children.length; ++i) {
        var child = this.children[i], sz = child.chunkSize();
        if (at < sz) {
          var used = Math.min(n, sz - at);
          if (child.iterN(at, used, op)) return true;
          if ((n -= used) == 0) break;
          at = 0;
        } else at -= sz;
      }
    }
  };

  var nextDocId = 0;
  var Doc = CodeMirror.Doc = function(text, mode, firstLine, lineSep) {
    if (!(this instanceof Doc)) return new Doc(text, mode, firstLine, lineSep);
    if (firstLine == null) firstLine = 0;

    BranchChunk.call(this, [new LeafChunk([new Line("", null)])]);
    this.first = firstLine;
    this.scrollTop = this.scrollLeft = 0;
    this.cantEdit = false;
    this.cleanGeneration = 1;
    this.frontier = firstLine;
    var start = Pos(firstLine, 0);
    this.sel = simpleSelection(start);
    this.history = new History(null);
    this.id = ++nextDocId;
    this.modeOption = mode;
    this.lineSep = lineSep;
    this.extend = false;

    if (typeof text == "string") text = this.splitLines(text);
    updateDoc(this, {from: start, to: start, text: text});
    setSelection(this, simpleSelection(start), sel_dontScroll);
  };

  Doc.prototype = createObj(BranchChunk.prototype, {
    constructor: Doc,
    // Iterate over the document. Supports two forms -- with only one
    // argument, it calls that for each line in the document. With
    // three, it iterates over the range given by the first two (with
    // the second being non-inclusive).
    iter: function(from, to, op) {
      if (op) this.iterN(from - this.first, to - from, op);
      else this.iterN(this.first, this.first + this.size, from);
    },

    // Non-public interface for adding and removing lines.
    insert: function(at, lines) {
      var height = 0;
      for (var i = 0; i < lines.length; ++i) height += lines[i].height;
      this.insertInner(at - this.first, lines, height);
    },
    remove: function(at, n) { this.removeInner(at - this.first, n); },

    // From here, the methods are part of the public interface. Most
    // are also available from CodeMirror (editor) instances.

    getValue: function(lineSep) {
      var lines = getLines(this, this.first, this.first + this.size);
      if (lineSep === false) return lines;
      return lines.join(lineSep || this.lineSeparator());
    },
    setValue: docMethodOp(function(code) {
      var top = Pos(this.first, 0), last = this.first + this.size - 1;
      makeChange(this, {from: top, to: Pos(last, getLine(this, last).text.length),
                        text: this.splitLines(code), origin: "setValue", full: true}, true);
      setSelection(this, simpleSelection(top));
    }),
    replaceRange: function(code, from, to, origin) {
      from = clipPos(this, from);
      to = to ? clipPos(this, to) : from;
      replaceRange(this, code, from, to, origin);
    },
    getRange: function(from, to, lineSep) {
      var lines = getBetween(this, clipPos(this, from), clipPos(this, to));
      if (lineSep === false) return lines;
      return lines.join(lineSep || this.lineSeparator());
    },

    getLine: function(line) {var l = this.getLineHandle(line); return l && l.text;},

    getLineHandle: function(line) {if (isLine(this, line)) return getLine(this, line);},
    getLineNumber: function(line) {return lineNo(line);},

    getLineHandleVisualStart: function(line) {
      if (typeof line == "number") line = getLine(this, line);
      return visualLine(line);
    },

    lineCount: function() {return this.size;},
    firstLine: function() {return this.first;},
    lastLine: function() {return this.first + this.size - 1;},

    clipPos: function(pos) {return clipPos(this, pos);},

    getCursor: function(start) {
      var range = this.sel.primary(), pos;
      if (start == null || start == "head") pos = range.head;
      else if (start == "anchor") pos = range.anchor;
      else if (start == "end" || start == "to" || start === false) pos = range.to();
      else pos = range.from();
      return pos;
    },
    listSelections: function() { return this.sel.ranges; },
    somethingSelected: function() {return this.sel.somethingSelected();},

    setCursor: docMethodOp(function(line, ch, options) {
      setSimpleSelection(this, clipPos(this, typeof line == "number" ? Pos(line, ch || 0) : line), null, options);
    }),
    setSelection: docMethodOp(function(anchor, head, options) {
      setSimpleSelection(this, clipPos(this, anchor), clipPos(this, head || anchor), options);
    }),
    extendSelection: docMethodOp(function(head, other, options) {
      extendSelection(this, clipPos(this, head), other && clipPos(this, other), options);
    }),
    extendSelections: docMethodOp(function(heads, options) {
      extendSelections(this, clipPosArray(this, heads), options);
    }),
    extendSelectionsBy: docMethodOp(function(f, options) {
      var heads = map(this.sel.ranges, f);
      extendSelections(this, clipPosArray(this, heads), options);
    }),
    setSelections: docMethodOp(function(ranges, primary, options) {
      if (!ranges.length) return;
      for (var i = 0, out = []; i < ranges.length; i++)
        out[i] = new Range(clipPos(this, ranges[i].anchor),
                           clipPos(this, ranges[i].head));
      if (primary == null) primary = Math.min(ranges.length - 1, this.sel.primIndex);
      setSelection(this, normalizeSelection(out, primary), options);
    }),
    addSelection: docMethodOp(function(anchor, head, options) {
      var ranges = this.sel.ranges.slice(0);
      ranges.push(new Range(clipPos(this, anchor), clipPos(this, head || anchor)));
      setSelection(this, normalizeSelection(ranges, ranges.length - 1), options);
    }),

    getSelection: function(lineSep) {
      var ranges = this.sel.ranges, lines;
      for (var i = 0; i < ranges.length; i++) {
        var sel = getBetween(this, ranges[i].from(), ranges[i].to());
        lines = lines ? lines.concat(sel) : sel;
      }
      if (lineSep === false) return lines;
      else return lines.join(lineSep || this.lineSeparator());
    },
    getSelections: function(lineSep) {
      var parts = [], ranges = this.sel.ranges;
      for (var i = 0; i < ranges.length; i++) {
        var sel = getBetween(this, ranges[i].from(), ranges[i].to());
        if (lineSep !== false) sel = sel.join(lineSep || this.lineSeparator());
        parts[i] = sel;
      }
      return parts;
    },
    replaceSelection: function(code, collapse, origin) {
      var dup = [];
      for (var i = 0; i < this.sel.ranges.length; i++)
        dup[i] = code;
      this.replaceSelections(dup, collapse, origin || "+input");
    },
    replaceSelections: docMethodOp(function(code, collapse, origin) {
      var changes = [], sel = this.sel;
      for (var i = 0; i < sel.ranges.length; i++) {
        var range = sel.ranges[i];
        changes[i] = {from: range.from(), to: range.to(), text: this.splitLines(code[i]), origin: origin};
      }
      var newSel = collapse && collapse != "end" && computeReplacedSel(this, changes, collapse);
      for (var i = changes.length - 1; i >= 0; i--)
        makeChange(this, changes[i]);
      if (newSel) setSelectionReplaceHistory(this, newSel);
      else if (this.cm) ensureCursorVisible(this.cm);
    }),
    undo: docMethodOp(function() {makeChangeFromHistory(this, "undo");}),
    redo: docMethodOp(function() {makeChangeFromHistory(this, "redo");}),
    undoSelection: docMethodOp(function() {makeChangeFromHistory(this, "undo", true);}),
    redoSelection: docMethodOp(function() {makeChangeFromHistory(this, "redo", true);}),

    setExtending: function(val) {this.extend = val;},
    getExtending: function() {return this.extend;},

    historySize: function() {
      var hist = this.history, done = 0, undone = 0;
      for (var i = 0; i < hist.done.length; i++) if (!hist.done[i].ranges) ++done;
      for (var i = 0; i < hist.undone.length; i++) if (!hist.undone[i].ranges) ++undone;
      return {undo: done, redo: undone};
    },
    clearHistory: function() {this.history = new History(this.history.maxGeneration);},

    markClean: function() {
      this.cleanGeneration = this.changeGeneration(true);
    },
    changeGeneration: function(forceSplit) {
      if (forceSplit)
        this.history.lastOp = this.history.lastSelOp = this.history.lastOrigin = null;
      return this.history.generation;
    },
    isClean: function (gen) {
      return this.history.generation == (gen || this.cleanGeneration);
    },

    getHistory: function() {
      return {done: copyHistoryArray(this.history.done),
              undone: copyHistoryArray(this.history.undone)};
    },
    setHistory: function(histData) {
      var hist = this.history = new History(this.history.maxGeneration);
      hist.done = copyHistoryArray(histData.done.slice(0), null, true);
      hist.undone = copyHistoryArray(histData.undone.slice(0), null, true);
    },

    addLineClass: docMethodOp(function(handle, where, cls) {
      return changeLine(this, handle, where == "gutter" ? "gutter" : "class", function(line) {
        var prop = where == "text" ? "textClass"
                 : where == "background" ? "bgClass"
                 : where == "gutter" ? "gutterClass" : "wrapClass";
        if (!line[prop]) line[prop] = cls;
        else if (classTest(cls).test(line[prop])) return false;
        else line[prop] += " " + cls;
        return true;
      });
    }),
    removeLineClass: docMethodOp(function(handle, where, cls) {
      return changeLine(this, handle, where == "gutter" ? "gutter" : "class", function(line) {
        var prop = where == "text" ? "textClass"
                 : where == "background" ? "bgClass"
                 : where == "gutter" ? "gutterClass" : "wrapClass";
        var cur = line[prop];
        if (!cur) return false;
        else if (cls == null) line[prop] = null;
        else {
          var found = cur.match(classTest(cls));
          if (!found) return false;
          var end = found.index + found[0].length;
          line[prop] = cur.slice(0, found.index) + (!found.index || end == cur.length ? "" : " ") + cur.slice(end) || null;
        }
        return true;
      });
    }),

    addLineWidget: docMethodOp(function(handle, node, options) {
      return addLineWidget(this, handle, node, options);
    }),
    removeLineWidget: function(widget) { widget.clear(); },

    markText: function(from, to, options) {
      return markText(this, clipPos(this, from), clipPos(this, to), options, options && options.type || "range");
    },
    setBookmark: function(pos, options) {
      var realOpts = {replacedWith: options && (options.nodeType == null ? options.widget : options),
                      insertLeft: options && options.insertLeft,
                      clearWhenEmpty: false, shared: options && options.shared,
                      handleMouseEvents: options && options.handleMouseEvents};
      pos = clipPos(this, pos);
      return markText(this, pos, pos, realOpts, "bookmark");
    },
    findMarksAt: function(pos) {
      pos = clipPos(this, pos);
      var markers = [], spans = getLine(this, pos.line).markedSpans;
      if (spans) for (var i = 0; i < spans.length; ++i) {
        var span = spans[i];
        if ((span.from == null || span.from <= pos.ch) &&
            (span.to == null || span.to >= pos.ch))
          markers.push(span.marker.parent || span.marker);
      }
      return markers;
    },
    findMarks: function(from, to, filter) {
      from = clipPos(this, from); to = clipPos(this, to);
      var found = [], lineNo = from.line;
      this.iter(from.line, to.line + 1, function(line) {
        var spans = line.markedSpans;
        if (spans) for (var i = 0; i < spans.length; i++) {
          var span = spans[i];
          if (!(lineNo == from.line && from.ch > span.to ||
                span.from == null && lineNo != from.line||
                lineNo == to.line && span.from > to.ch) &&
              (!filter || filter(span.marker)))
            found.push(span.marker.parent || span.marker);
        }
        ++lineNo;
      });
      return found;
    },
    getAllMarks: function() {
      var markers = [];
      this.iter(function(line) {
        var sps = line.markedSpans;
        if (sps) for (var i = 0; i < sps.length; ++i)
          if (sps[i].from != null) markers.push(sps[i].marker);
      });
      return markers;
    },

    posFromIndex: function(off) {
      var ch, lineNo = this.first;
      this.iter(function(line) {
        var sz = line.text.length + 1;
        if (sz > off) { ch = off; return true; }
        off -= sz;
        ++lineNo;
      });
      return clipPos(this, Pos(lineNo, ch));
    },
    indexFromPos: function (coords) {
      coords = clipPos(this, coords);
      var index = coords.ch;
      if (coords.line < this.first || coords.ch < 0) return 0;
      this.iter(this.first, coords.line, function (line) {
        index += line.text.length + 1;
      });
      return index;
    },

    copy: function(copyHistory) {
      var doc = new Doc(getLines(this, this.first, this.first + this.size),
                        this.modeOption, this.first, this.lineSep);
      doc.scrollTop = this.scrollTop; doc.scrollLeft = this.scrollLeft;
      doc.sel = this.sel;
      doc.extend = false;
      if (copyHistory) {
        doc.history.undoDepth = this.history.undoDepth;
        doc.setHistory(this.getHistory());
      }
      return doc;
    },

    linkedDoc: function(options) {
      if (!options) options = {};
      var from = this.first, to = this.first + this.size;
      if (options.from != null && options.from > from) from = options.from;
      if (options.to != null && options.to < to) to = options.to;
      var copy = new Doc(getLines(this, from, to), options.mode || this.modeOption, from, this.lineSep);
      if (options.sharedHist) copy.history = this.history;
      (this.linked || (this.linked = [])).push({doc: copy, sharedHist: options.sharedHist});
      copy.linked = [{doc: this, isParent: true, sharedHist: options.sharedHist}];
      copySharedMarkers(copy, findSharedMarkers(this));
      return copy;
    },
    unlinkDoc: function(other) {
      if (other instanceof CodeMirror) other = other.doc;
      if (this.linked) for (var i = 0; i < this.linked.length; ++i) {
        var link = this.linked[i];
        if (link.doc != other) continue;
        this.linked.splice(i, 1);
        other.unlinkDoc(this);
        detachSharedMarkers(findSharedMarkers(this));
        break;
      }
      // If the histories were shared, split them again
      if (other.history == this.history) {
        var splitIds = [other.id];
        linkedDocs(other, function(doc) {splitIds.push(doc.id);}, true);
        other.history = new History(null);
        other.history.done = copyHistoryArray(this.history.done, splitIds);
        other.history.undone = copyHistoryArray(this.history.undone, splitIds);
      }
    },
    iterLinkedDocs: function(f) {linkedDocs(this, f);},

    getMode: function() {return this.mode;},
    getEditor: function() {return this.cm;},

    splitLines: function(str) {
      if (this.lineSep) return str.split(this.lineSep);
      return splitLinesAuto(str);
    },
    lineSeparator: function() { return this.lineSep || "\n"; }
  });

  // Public alias.
  Doc.prototype.eachLine = Doc.prototype.iter;

  // Set up methods on CodeMirror's prototype to redirect to the editor's document.
  var dontDelegate = "iter insert remove copy getEditor constructor".split(" ");
  for (var prop in Doc.prototype) if (Doc.prototype.hasOwnProperty(prop) && indexOf(dontDelegate, prop) < 0)
    CodeMirror.prototype[prop] = (function(method) {
      return function() {return method.apply(this.doc, arguments);};
    })(Doc.prototype[prop]);

  eventMixin(Doc);

  // Call f for all linked documents.
  function linkedDocs(doc, f, sharedHistOnly) {
    function propagate(doc, skip, sharedHist) {
      if (doc.linked) for (var i = 0; i < doc.linked.length; ++i) {
        var rel = doc.linked[i];
        if (rel.doc == skip) continue;
        var shared = sharedHist && rel.sharedHist;
        if (sharedHistOnly && !shared) continue;
        f(rel.doc, shared);
        propagate(rel.doc, doc, shared);
      }
    }
    propagate(doc, null, true);
  }

  // Attach a document to an editor.
  function attachDoc(cm, doc) {
    if (doc.cm) throw new Error("This document is already in use.");
    cm.doc = doc;
    doc.cm = cm;
    estimateLineHeights(cm);
    loadMode(cm);
    if (!cm.options.lineWrapping) findMaxLine(cm);
    cm.options.mode = doc.modeOption;
    regChange(cm);
  }

  // LINE UTILITIES

  // Find the line object corresponding to the given line number.
  function getLine(doc, n) {
    n -= doc.first;
    if (n < 0 || n >= doc.size) throw new Error("There is no line " + (n + doc.first) + " in the document.");
    for (var chunk = doc; !chunk.lines;) {
      for (var i = 0;; ++i) {
        var child = chunk.children[i], sz = child.chunkSize();
        if (n < sz) { chunk = child; break; }
        n -= sz;
      }
    }
    return chunk.lines[n];
  }

  // Get the part of a document between two positions, as an array of
  // strings.
  function getBetween(doc, start, end) {
    var out = [], n = start.line;
    doc.iter(start.line, end.line + 1, function(line) {
      var text = line.text;
      if (n == end.line) text = text.slice(0, end.ch);
      if (n == start.line) text = text.slice(start.ch);
      out.push(text);
      ++n;
    });
    return out;
  }
  // Get the lines between from and to, as array of strings.
  function getLines(doc, from, to) {
    var out = [];
    doc.iter(from, to, function(line) { out.push(line.text); });
    return out;
  }

  // Update the height of a line, propagating the height change
  // upwards to parent nodes.
  function updateLineHeight(line, height) {
    var diff = height - line.height;
    if (diff) for (var n = line; n; n = n.parent) n.height += diff;
  }

  // Given a line object, find its line number by walking up through
  // its parent links.
  function lineNo(line) {
    if (line.parent == null) return null;
    var cur = line.parent, no = indexOf(cur.lines, line);
    for (var chunk = cur.parent; chunk; cur = chunk, chunk = chunk.parent) {
      for (var i = 0;; ++i) {
        if (chunk.children[i] == cur) break;
        no += chunk.children[i].chunkSize();
      }
    }
    return no + cur.first;
  }

  // Find the line at the given vertical position, using the height
  // information in the document tree.
  function lineAtHeight(chunk, h) {
    var n = chunk.first;
    outer: do {
      for (var i = 0; i < chunk.children.length; ++i) {
        var child = chunk.children[i], ch = child.height;
        if (h < ch) { chunk = child; continue outer; }
        h -= ch;
        n += child.chunkSize();
      }
      return n;
    } while (!chunk.lines);
    for (var i = 0; i < chunk.lines.length; ++i) {
      var line = chunk.lines[i], lh = line.height;
      if (h < lh) break;
      h -= lh;
    }
    return n + i;
  }


  // Find the height above the given line.
  function heightAtLine(lineObj) {
    lineObj = visualLine(lineObj);

    var h = 0, chunk = lineObj.parent;
    for (var i = 0; i < chunk.lines.length; ++i) {
      var line = chunk.lines[i];
      if (line == lineObj) break;
      else h += line.height;
    }
    for (var p = chunk.parent; p; chunk = p, p = chunk.parent) {
      for (var i = 0; i < p.children.length; ++i) {
        var cur = p.children[i];
        if (cur == chunk) break;
        else h += cur.height;
      }
    }
    return h;
  }

  // Get the bidi ordering for the given line (and cache it). Returns
  // false for lines that are fully left-to-right, and an array of
  // BidiSpan objects otherwise.
  function getOrder(line) {
    var order = line.order;
    if (order == null) order = line.order = bidiOrdering(line.text);
    return order;
  }

  // HISTORY

  function History(startGen) {
    // Arrays of change events and selections. Doing something adds an
    // event to done and clears undo. Undoing moves events from done
    // to undone, redoing moves them in the other direction.
    this.done = []; this.undone = [];
    this.undoDepth = Infinity;
    // Used to track when changes can be merged into a single undo
    // event
    this.lastModTime = this.lastSelTime = 0;
    this.lastOp = this.lastSelOp = null;
    this.lastOrigin = this.lastSelOrigin = null;
    // Used by the isClean() method
    this.generation = this.maxGeneration = startGen || 1;
  }

  // Create a history change event from an updateDoc-style change
  // object.
  function historyChangeFromChange(doc, change) {
    var histChange = {from: copyPos(change.from), to: changeEnd(change), text: getBetween(doc, change.from, change.to)};
    attachLocalSpans(doc, histChange, change.from.line, change.to.line + 1);
    linkedDocs(doc, function(doc) {attachLocalSpans(doc, histChange, change.from.line, change.to.line + 1);}, true);
    return histChange;
  }

  // Pop all selection events off the end of a history array. Stop at
  // a change event.
  function clearSelectionEvents(array) {
    while (array.length) {
      var last = lst(array);
      if (last.ranges) array.pop();
      else break;
    }
  }

  // Find the top change event in the history. Pop off selection
  // events that are in the way.
  function lastChangeEvent(hist, force) {
    if (force) {
      clearSelectionEvents(hist.done);
      return lst(hist.done);
    } else if (hist.done.length && !lst(hist.done).ranges) {
      return lst(hist.done);
    } else if (hist.done.length > 1 && !hist.done[hist.done.length - 2].ranges) {
      hist.done.pop();
      return lst(hist.done);
    }
  }

  // Register a change in the history. Merges changes that are within
  // a single operation, ore are close together with an origin that
  // allows merging (starting with "+") into a single event.
  function addChangeToHistory(doc, change, selAfter, opId) {
    var hist = doc.history;
    hist.undone.length = 0;
    var time = +new Date, cur;

    if ((hist.lastOp == opId ||
         hist.lastOrigin == change.origin && change.origin &&
         ((change.origin.charAt(0) == "+" && doc.cm && hist.lastModTime > time - doc.cm.options.historyEventDelay) ||
          change.origin.charAt(0) == "*")) &&
        (cur = lastChangeEvent(hist, hist.lastOp == opId))) {
      // Merge this change into the last event
      var last = lst(cur.changes);
      if (cmp(change.from, change.to) == 0 && cmp(change.from, last.to) == 0) {
        // Optimized case for simple insertion -- don't want to add
        // new changesets for every character typed
        last.to = changeEnd(change);
      } else {
        // Add new sub-event
        cur.changes.push(historyChangeFromChange(doc, change));
      }
    } else {
      // Can not be merged, start a new event.
      var before = lst(hist.done);
      if (!before || !before.ranges)
        pushSelectionToHistory(doc.sel, hist.done);
      cur = {changes: [historyChangeFromChange(doc, change)],
             generation: hist.generation};
      hist.done.push(cur);
      while (hist.done.length > hist.undoDepth) {
        hist.done.shift();
        if (!hist.done[0].ranges) hist.done.shift();
      }
    }
    hist.done.push(selAfter);
    hist.generation = ++hist.maxGeneration;
    hist.lastModTime = hist.lastSelTime = time;
    hist.lastOp = hist.lastSelOp = opId;
    hist.lastOrigin = hist.lastSelOrigin = change.origin;

    if (!last) signal(doc, "historyAdded");
  }

  function selectionEventCanBeMerged(doc, origin, prev, sel) {
    var ch = origin.charAt(0);
    return ch == "*" ||
      ch == "+" &&
      prev.ranges.length == sel.ranges.length &&
      prev.somethingSelected() == sel.somethingSelected() &&
      new Date - doc.history.lastSelTime <= (doc.cm ? doc.cm.options.historyEventDelay : 500);
  }

  // Called whenever the selection changes, sets the new selection as
  // the pending selection in the history, and pushes the old pending
  // selection into the 'done' array when it was significantly
  // different (in number of selected ranges, emptiness, or time).
  function addSelectionToHistory(doc, sel, opId, options) {
    var hist = doc.history, origin = options && options.origin;

    // A new event is started when the previous origin does not match
    // the current, or the origins don't allow matching. Origins
    // starting with * are always merged, those starting with + are
    // merged when similar and close together in time.
    if (opId == hist.lastSelOp ||
        (origin && hist.lastSelOrigin == origin &&
         (hist.lastModTime == hist.lastSelTime && hist.lastOrigin == origin ||
          selectionEventCanBeMerged(doc, origin, lst(hist.done), sel))))
      hist.done[hist.done.length - 1] = sel;
    else
      pushSelectionToHistory(sel, hist.done);

    hist.lastSelTime = +new Date;
    hist.lastSelOrigin = origin;
    hist.lastSelOp = opId;
    if (options && options.clearRedo !== false)
      clearSelectionEvents(hist.undone);
  }

  function pushSelectionToHistory(sel, dest) {
    var top = lst(dest);
    if (!(top && top.ranges && top.equals(sel)))
      dest.push(sel);
  }

  // Used to store marked span information in the history.
  function attachLocalSpans(doc, change, from, to) {
    var existing = change["spans_" + doc.id], n = 0;
    doc.iter(Math.max(doc.first, from), Math.min(doc.first + doc.size, to), function(line) {
      if (line.markedSpans)
        (existing || (existing = change["spans_" + doc.id] = {}))[n] = line.markedSpans;
      ++n;
    });
  }

  // When un/re-doing restores text containing marked spans, those
  // that have been explicitly cleared should not be restored.
  function removeClearedSpans(spans) {
    if (!spans) return null;
    for (var i = 0, out; i < spans.length; ++i) {
      if (spans[i].marker.explicitlyCleared) { if (!out) out = spans.slice(0, i); }
      else if (out) out.push(spans[i]);
    }
    return !out ? spans : out.length ? out : null;
  }

  // Retrieve and filter the old marked spans stored in a change event.
  function getOldSpans(doc, change) {
    var found = change["spans_" + doc.id];
    if (!found) return null;
    for (var i = 0, nw = []; i < change.text.length; ++i)
      nw.push(removeClearedSpans(found[i]));
    return nw;
  }

  // Used both to provide a JSON-safe object in .getHistory, and, when
  // detaching a document, to split the history in two
  function copyHistoryArray(events, newGroup, instantiateSel) {
    for (var i = 0, copy = []; i < events.length; ++i) {
      var event = events[i];
      if (event.ranges) {
        copy.push(instantiateSel ? Selection.prototype.deepCopy.call(event) : event);
        continue;
      }
      var changes = event.changes, newChanges = [];
      copy.push({changes: newChanges});
      for (var j = 0; j < changes.length; ++j) {
        var change = changes[j], m;
        newChanges.push({from: change.from, to: change.to, text: change.text});
        if (newGroup) for (var prop in change) if (m = prop.match(/^spans_(\d+)$/)) {
          if (indexOf(newGroup, Number(m[1])) > -1) {
            lst(newChanges)[prop] = change[prop];
            delete change[prop];
          }
        }
      }
    }
    return copy;
  }

  // Rebasing/resetting history to deal with externally-sourced changes

  function rebaseHistSelSingle(pos, from, to, diff) {
    if (to < pos.line) {
      pos.line += diff;
    } else if (from < pos.line) {
      pos.line = from;
      pos.ch = 0;
    }
  }

  // Tries to rebase an array of history events given a change in the
  // document. If the change touches the same lines as the event, the
  // event, and everything 'behind' it, is discarded. If the change is
  // before the event, the event's positions are updated. Uses a
  // copy-on-write scheme for the positions, to avoid having to
  // reallocate them all on every rebase, but also avoid problems with
  // shared position objects being unsafely updated.
  function rebaseHistArray(array, from, to, diff) {
    for (var i = 0; i < array.length; ++i) {
      var sub = array[i], ok = true;
      if (sub.ranges) {
        if (!sub.copied) { sub = array[i] = sub.deepCopy(); sub.copied = true; }
        for (var j = 0; j < sub.ranges.length; j++) {
          rebaseHistSelSingle(sub.ranges[j].anchor, from, to, diff);
          rebaseHistSelSingle(sub.ranges[j].head, from, to, diff);
        }
        continue;
      }
      for (var j = 0; j < sub.changes.length; ++j) {
        var cur = sub.changes[j];
        if (to < cur.from.line) {
          cur.from = Pos(cur.from.line + diff, cur.from.ch);
          cur.to = Pos(cur.to.line + diff, cur.to.ch);
        } else if (from <= cur.to.line) {
          ok = false;
          break;
        }
      }
      if (!ok) {
        array.splice(0, i + 1);
        i = 0;
      }
    }
  }

  function rebaseHist(hist, change) {
    var from = change.from.line, to = change.to.line, diff = change.text.length - (to - from) - 1;
    rebaseHistArray(hist.done, from, to, diff);
    rebaseHistArray(hist.undone, from, to, diff);
  }

  // EVENT UTILITIES

  // Due to the fact that we still support jurassic IE versions, some
  // compatibility wrappers are needed.

  var e_preventDefault = CodeMirror.e_preventDefault = function(e) {
    if (e.preventDefault) e.preventDefault();
    else e.returnValue = false;
  };
  var e_stopPropagation = CodeMirror.e_stopPropagation = function(e) {
    if (e.stopPropagation) e.stopPropagation();
    else e.cancelBubble = true;
  };
  function e_defaultPrevented(e) {
    return e.defaultPrevented != null ? e.defaultPrevented : e.returnValue == false;
  }
  var e_stop = CodeMirror.e_stop = function(e) {e_preventDefault(e); e_stopPropagation(e);};

  function e_target(e) {return e.target || e.srcElement;}
  function e_button(e) {
    var b = e.which;
    if (b == null) {
      if (e.button & 1) b = 1;
      else if (e.button & 2) b = 3;
      else if (e.button & 4) b = 2;
    }
    if (mac && e.ctrlKey && b == 1) b = 3;
    return b;
  }

  // EVENT HANDLING

  // Lightweight event framework. on/off also work on DOM nodes,
  // registering native DOM handlers.

  var on = CodeMirror.on = function(emitter, type, f) {
    if (emitter.addEventListener)
      emitter.addEventListener(type, f, false);
    else if (emitter.attachEvent)
      emitter.attachEvent("on" + type, f);
    else {
      var map = emitter._handlers || (emitter._handlers = {});
      var arr = map[type] || (map[type] = []);
      arr.push(f);
    }
  };

  var noHandlers = []
  function getHandlers(emitter, type, copy) {
    var arr = emitter._handlers && emitter._handlers[type]
    if (copy) return arr && arr.length > 0 ? arr.slice() : noHandlers
    else return arr || noHandlers
  }

  var off = CodeMirror.off = function(emitter, type, f) {
    if (emitter.removeEventListener)
      emitter.removeEventListener(type, f, false);
    else if (emitter.detachEvent)
      emitter.detachEvent("on" + type, f);
    else {
      var handlers = getHandlers(emitter, type, false)
      for (var i = 0; i < handlers.length; ++i)
        if (handlers[i] == f) { handlers.splice(i, 1); break; }
    }
  };

  var signal = CodeMirror.signal = function(emitter, type /*, values...*/) {
    var handlers = getHandlers(emitter, type, true)
    if (!handlers.length) return;
    var args = Array.prototype.slice.call(arguments, 2);
    for (var i = 0; i < handlers.length; ++i) handlers[i].apply(null, args);
  };

  var orphanDelayedCallbacks = null;

  // Often, we want to signal events at a point where we are in the
  // middle of some work, but don't want the handler to start calling
  // other methods on the editor, which might be in an inconsistent
  // state or simply not expect any other events to happen.
  // signalLater looks whether there are any handlers, and schedules
  // them to be executed when the last operation ends, or, if no
  // operation is active, when a timeout fires.
  function signalLater(emitter, type /*, values...*/) {
    var arr = getHandlers(emitter, type, false)
    if (!arr.length) return;
    var args = Array.prototype.slice.call(arguments, 2), list;
    if (operationGroup) {
      list = operationGroup.delayedCallbacks;
    } else if (orphanDelayedCallbacks) {
      list = orphanDelayedCallbacks;
    } else {
      list = orphanDelayedCallbacks = [];
      setTimeout(fireOrphanDelayed, 0);
    }
    function bnd(f) {return function(){f.apply(null, args);};};
    for (var i = 0; i < arr.length; ++i)
      list.push(bnd(arr[i]));
  }

  function fireOrphanDelayed() {
    var delayed = orphanDelayedCallbacks;
    orphanDelayedCallbacks = null;
    for (var i = 0; i < delayed.length; ++i) delayed[i]();
  }

  // The DOM events that CodeMirror handles can be overridden by
  // registering a (non-DOM) handler on the editor for the event name,
  // and preventDefault-ing the event in that handler.
  function signalDOMEvent(cm, e, override) {
    if (typeof e == "string")
      e = {type: e, preventDefault: function() { this.defaultPrevented = true; }};
    signal(cm, override || e.type, cm, e);
    return e_defaultPrevented(e) || e.codemirrorIgnore;
  }

  function signalCursorActivity(cm) {
    var arr = cm._handlers && cm._handlers.cursorActivity;
    if (!arr) return;
    var set = cm.curOp.cursorActivityHandlers || (cm.curOp.cursorActivityHandlers = []);
    for (var i = 0; i < arr.length; ++i) if (indexOf(set, arr[i]) == -1)
      set.push(arr[i]);
  }

  function hasHandler(emitter, type) {
    return getHandlers(emitter, type).length > 0
  }

  // Add on and off methods to a constructor's prototype, to make
  // registering events on such objects more convenient.
  function eventMixin(ctor) {
    ctor.prototype.on = function(type, f) {on(this, type, f);};
    ctor.prototype.off = function(type, f) {off(this, type, f);};
  }

  // MISC UTILITIES

  // Number of pixels added to scroller and sizer to hide scrollbar
  var scrollerGap = 30;

  // Returned or thrown by various protocols to signal 'I'm not
  // handling this'.
  var Pass = CodeMirror.Pass = {toString: function(){return "CodeMirror.Pass";}};

  // Reused option objects for setSelection & friends
  var sel_dontScroll = {scroll: false}, sel_mouse = {origin: "*mouse"}, sel_move = {origin: "+move"};

  function Delayed() {this.id = null;}
  Delayed.prototype.set = function(ms, f) {
    clearTimeout(this.id);
    this.id = setTimeout(f, ms);
  };

  // Counts the column offset in a string, taking tabs into account.
  // Used mostly to find indentation.
  var countColumn = CodeMirror.countColumn = function(string, end, tabSize, startIndex, startValue) {
    if (end == null) {
      end = string.search(/[^\s\u00a0]/);
      if (end == -1) end = string.length;
    }
    for (var i = startIndex || 0, n = startValue || 0;;) {
      var nextTab = string.indexOf("\t", i);
      if (nextTab < 0 || nextTab >= end)
        return n + (end - i);
      n += nextTab - i;
      n += tabSize - (n % tabSize);
      i = nextTab + 1;
    }
  };

  // The inverse of countColumn -- find the offset that corresponds to
  // a particular column.
  var findColumn = CodeMirror.findColumn = function(string, goal, tabSize) {
    for (var pos = 0, col = 0;;) {
      var nextTab = string.indexOf("\t", pos);
      if (nextTab == -1) nextTab = string.length;
      var skipped = nextTab - pos;
      if (nextTab == string.length || col + skipped >= goal)
        return pos + Math.min(skipped, goal - col);
      col += nextTab - pos;
      col += tabSize - (col % tabSize);
      pos = nextTab + 1;
      if (col >= goal) return pos;
    }
  }

  var spaceStrs = [""];
  function spaceStr(n) {
    while (spaceStrs.length <= n)
      spaceStrs.push(lst(spaceStrs) + " ");
    return spaceStrs[n];
  }

  function lst(arr) { return arr[arr.length-1]; }

  var selectInput = function(node) { node.select(); };
  if (ios) // Mobile Safari apparently has a bug where select() is broken.
    selectInput = function(node) { node.selectionStart = 0; node.selectionEnd = node.value.length; };
  else if (ie) // Suppress mysterious IE10 errors
    selectInput = function(node) { try { node.select(); } catch(_e) {} };

  function indexOf(array, elt) {
    for (var i = 0; i < array.length; ++i)
      if (array[i] == elt) return i;
    return -1;
  }
  function map(array, f) {
    var out = [];
    for (var i = 0; i < array.length; i++) out[i] = f(array[i], i);
    return out;
  }

  function nothing() {}

  function createObj(base, props) {
    var inst;
    if (Object.create) {
      inst = Object.create(base);
    } else {
      nothing.prototype = base;
      inst = new nothing();
    }
    if (props) copyObj(props, inst);
    return inst;
  };

  function copyObj(obj, target, overwrite) {
    if (!target) target = {};
    for (var prop in obj)
      if (obj.hasOwnProperty(prop) && (overwrite !== false || !target.hasOwnProperty(prop)))
        target[prop] = obj[prop];
    return target;
  }

  function bind(f) {
    var args = Array.prototype.slice.call(arguments, 1);
    return function(){return f.apply(null, args);};
  }

  var nonASCIISingleCaseWordChar = /[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;
  var isWordCharBasic = CodeMirror.isWordChar = function(ch) {
    return /\w/.test(ch) || ch > "\x80" &&
      (ch.toUpperCase() != ch.toLowerCase() || nonASCIISingleCaseWordChar.test(ch));
  };
  function isWordChar(ch, helper) {
    if (!helper) return isWordCharBasic(ch);
    if (helper.source.indexOf("\\w") > -1 && isWordCharBasic(ch)) return true;
    return helper.test(ch);
  }

  function isEmpty(obj) {
    for (var n in obj) if (obj.hasOwnProperty(n) && obj[n]) return false;
    return true;
  }

  // Extending unicode characters. A series of a non-extending char +
  // any number of extending chars is treated as a single unit as far
  // as editing and measuring is concerned. This is not fully correct,
  // since some scripts/fonts/browsers also treat other configurations
  // of code points as a group.
  var extendingChars = /[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/;
  function isExtendingChar(ch) { return ch.charCodeAt(0) >= 768 && extendingChars.test(ch); }

  // DOM UTILITIES

  function elt(tag, content, className, style) {
    var e = document.createElement(tag);
    if (className) e.className = className;
    if (style) e.style.cssText = style;
    if (typeof content == "string") e.appendChild(document.createTextNode(content));
    else if (content) for (var i = 0; i < content.length; ++i) e.appendChild(content[i]);
    return e;
  }

  var range;
  if (document.createRange) range = function(node, start, end, endNode) {
    var r = document.createRange();
    r.setEnd(endNode || node, end);
    r.setStart(node, start);
    return r;
  };
  else range = function(node, start, end) {
    var r = document.body.createTextRange();
    try { r.moveToElementText(node.parentNode); }
    catch(e) { return r; }
    r.collapse(true);
    r.moveEnd("character", end);
    r.moveStart("character", start);
    return r;
  };

  function removeChildren(e) {
    for (var count = e.childNodes.length; count > 0; --count)
      e.removeChild(e.firstChild);
    return e;
  }

  function removeChildrenAndAdd(parent, e) {
    return removeChildren(parent).appendChild(e);
  }

  var contains = CodeMirror.contains = function(parent, child) {
    if (child.nodeType == 3) // Android browser always returns false when child is a textnode
      child = child.parentNode;
    if (parent.contains)
      return parent.contains(child);
    do {
      if (child.nodeType == 11) child = child.host;
      if (child == parent) return true;
    } while (child = child.parentNode);
  };

  function activeElt() {
    var activeElement = document.activeElement;
    while (activeElement && activeElement.root && activeElement.root.activeElement)
      activeElement = activeElement.root.activeElement;
    return activeElement;
  }
  // Older versions of IE throws unspecified error when touching
  // document.activeElement in some cases (during loading, in iframe)
  if (ie && ie_version < 11) activeElt = function() {
    try { return document.activeElement; }
    catch(e) { return document.body; }
  };

  function classTest(cls) { return new RegExp("(^|\\s)" + cls + "(?:$|\\s)\\s*"); }
  var rmClass = CodeMirror.rmClass = function(node, cls) {
    var current = node.className;
    var match = classTest(cls).exec(current);
    if (match) {
      var after = current.slice(match.index + match[0].length);
      node.className = current.slice(0, match.index) + (after ? match[1] + after : "");
    }
  };
  var addClass = CodeMirror.addClass = function(node, cls) {
    var current = node.className;
    if (!classTest(cls).test(current)) node.className += (current ? " " : "") + cls;
  };
  function joinClasses(a, b) {
    var as = a.split(" ");
    for (var i = 0; i < as.length; i++)
      if (as[i] && !classTest(as[i]).test(b)) b += " " + as[i];
    return b;
  }

  // WINDOW-WIDE EVENTS

  // These must be handled carefully, because naively registering a
  // handler for each editor will cause the editors to never be
  // garbage collected.

  function forEachCodeMirror(f) {
    if (!document.body.getElementsByClassName) return;
    var byClass = document.body.getElementsByClassName("CodeMirror");
    for (var i = 0; i < byClass.length; i++) {
      var cm = byClass[i].CodeMirror;
      if (cm) f(cm);
    }
  }

  var globalsRegistered = false;
  function ensureGlobalHandlers() {
    if (globalsRegistered) return;
    registerGlobalHandlers();
    globalsRegistered = true;
  }
  function registerGlobalHandlers() {
    // When the window resizes, we need to refresh active editors.
    var resizeTimer;
    on(window, "resize", function() {
      if (resizeTimer == null) resizeTimer = setTimeout(function() {
        resizeTimer = null;
        forEachCodeMirror(onResize);
      }, 100);
    });
    // When the window loses focus, we want to show the editor as blurred
    on(window, "blur", function() {
      forEachCodeMirror(onBlur);
    });
  }

  // FEATURE DETECTION

  // Detect drag-and-drop
  var dragAndDrop = function() {
    // There is *some* kind of drag-and-drop support in IE6-8, but I
    // couldn't get it to work yet.
    if (ie && ie_version < 9) return false;
    var div = elt('div');
    return "draggable" in div || "dragDrop" in div;
  }();

  var zwspSupported;
  function zeroWidthElement(measure) {
    if (zwspSupported == null) {
      var test = elt("span", "\u200b");
      removeChildrenAndAdd(measure, elt("span", [test, document.createTextNode("x")]));
      if (measure.firstChild.offsetHeight != 0)
        zwspSupported = test.offsetWidth <= 1 && test.offsetHeight > 2 && !(ie && ie_version < 8);
    }
    var node = zwspSupported ? elt("span", "\u200b") :
      elt("span", "\u00a0", null, "display: inline-block; width: 1px; margin-right: -1px");
    node.setAttribute("cm-text", "");
    return node;
  }

  // Feature-detect IE's crummy client rect reporting for bidi text
  var badBidiRects;
  function hasBadBidiRects(measure) {
    if (badBidiRects != null) return badBidiRects;
    var txt = removeChildrenAndAdd(measure, document.createTextNode("A\u062eA"));
    var r0 = range(txt, 0, 1).getBoundingClientRect();
    if (!r0 || r0.left == r0.right) return false; // Safari returns null in some cases (#2780)
    var r1 = range(txt, 1, 2).getBoundingClientRect();
    return badBidiRects = (r1.right - r0.right < 3);
  }

  // See if "".split is the broken IE version, if so, provide an
  // alternative way to split lines.
  var splitLinesAuto = CodeMirror.splitLines = "\n\nb".split(/\n/).length != 3 ? function(string) {
    var pos = 0, result = [], l = string.length;
    while (pos <= l) {
      var nl = string.indexOf("\n", pos);
      if (nl == -1) nl = string.length;
      var line = string.slice(pos, string.charAt(nl - 1) == "\r" ? nl - 1 : nl);
      var rt = line.indexOf("\r");
      if (rt != -1) {
        result.push(line.slice(0, rt));
        pos += rt + 1;
      } else {
        result.push(line);
        pos = nl + 1;
      }
    }
    return result;
  } : function(string){return string.split(/\r\n?|\n/);};

  var hasSelection = window.getSelection ? function(te) {
    try { return te.selectionStart != te.selectionEnd; }
    catch(e) { return false; }
  } : function(te) {
    try {var range = te.ownerDocument.selection.createRange();}
    catch(e) {}
    if (!range || range.parentElement() != te) return false;
    return range.compareEndPoints("StartToEnd", range) != 0;
  };

  var hasCopyEvent = (function() {
    var e = elt("div");
    if ("oncopy" in e) return true;
    e.setAttribute("oncopy", "return;");
    return typeof e.oncopy == "function";
  })();

  var badZoomedRects = null;
  function hasBadZoomedRects(measure) {
    if (badZoomedRects != null) return badZoomedRects;
    var node = removeChildrenAndAdd(measure, elt("span", "x"));
    var normal = node.getBoundingClientRect();
    var fromRange = range(node, 0, 1).getBoundingClientRect();
    return badZoomedRects = Math.abs(normal.left - fromRange.left) > 1;
  }

  // KEY NAMES

  var keyNames = CodeMirror.keyNames = {
    3: "Enter", 8: "Backspace", 9: "Tab", 13: "Enter", 16: "Shift", 17: "Ctrl", 18: "Alt",
    19: "Pause", 20: "CapsLock", 27: "Esc", 32: "Space", 33: "PageUp", 34: "PageDown", 35: "End",
    36: "Home", 37: "Left", 38: "Up", 39: "Right", 40: "Down", 44: "PrintScrn", 45: "Insert",
    46: "Delete", 59: ";", 61: "=", 91: "Mod", 92: "Mod", 93: "Mod",
    106: "*", 107: "=", 109: "-", 110: ".", 111: "/", 127: "Delete",
    173: "-", 186: ";", 187: "=", 188: ",", 189: "-", 190: ".", 191: "/", 192: "`", 219: "[", 220: "\\",
    221: "]", 222: "'", 63232: "Up", 63233: "Down", 63234: "Left", 63235: "Right", 63272: "Delete",
    63273: "Home", 63275: "End", 63276: "PageUp", 63277: "PageDown", 63302: "Insert"
  };
  (function() {
    // Number keys
    for (var i = 0; i < 10; i++) keyNames[i + 48] = keyNames[i + 96] = String(i);
    // Alphabetic keys
    for (var i = 65; i <= 90; i++) keyNames[i] = String.fromCharCode(i);
    // Function keys
    for (var i = 1; i <= 12; i++) keyNames[i + 111] = keyNames[i + 63235] = "F" + i;
  })();

  // BIDI HELPERS

  function iterateBidiSections(order, from, to, f) {
    if (!order) return f(from, to, "ltr");
    var found = false;
    for (var i = 0; i < order.length; ++i) {
      var part = order[i];
      if (part.from < to && part.to > from || from == to && part.to == from) {
        f(Math.max(part.from, from), Math.min(part.to, to), part.level == 1 ? "rtl" : "ltr");
        found = true;
      }
    }
    if (!found) f(from, to, "ltr");
  }

  function bidiLeft(part) { return part.level % 2 ? part.to : part.from; }
  function bidiRight(part) { return part.level % 2 ? part.from : part.to; }

  function lineLeft(line) { var order = getOrder(line); return order ? bidiLeft(order[0]) : 0; }
  function lineRight(line) {
    var order = getOrder(line);
    if (!order) return line.text.length;
    return bidiRight(lst(order));
  }

  function lineStart(cm, lineN) {
    var line = getLine(cm.doc, lineN);
    var visual = visualLine(line);
    if (visual != line) lineN = lineNo(visual);
    var order = getOrder(visual);
    var ch = !order ? 0 : order[0].level % 2 ? lineRight(visual) : lineLeft(visual);
    return Pos(lineN, ch);
  }
  function lineEnd(cm, lineN) {
    var merged, line = getLine(cm.doc, lineN);
    while (merged = collapsedSpanAtEnd(line)) {
      line = merged.find(1, true).line;
      lineN = null;
    }
    var order = getOrder(line);
    var ch = !order ? line.text.length : order[0].level % 2 ? lineLeft(line) : lineRight(line);
    return Pos(lineN == null ? lineNo(line) : lineN, ch);
  }
  function lineStartSmart(cm, pos) {
    var start = lineStart(cm, pos.line);
    var line = getLine(cm.doc, start.line);
    var order = getOrder(line);
    if (!order || order[0].level == 0) {
      var firstNonWS = Math.max(0, line.text.search(/\S/));
      var inWS = pos.line == start.line && pos.ch <= firstNonWS && pos.ch;
      return Pos(start.line, inWS ? 0 : firstNonWS);
    }
    return start;
  }

  function compareBidiLevel(order, a, b) {
    var linedir = order[0].level;
    if (a == linedir) return true;
    if (b == linedir) return false;
    return a < b;
  }
  var bidiOther;
  function getBidiPartAt(order, pos) {
    bidiOther = null;
    for (var i = 0, found; i < order.length; ++i) {
      var cur = order[i];
      if (cur.from < pos && cur.to > pos) return i;
      if ((cur.from == pos || cur.to == pos)) {
        if (found == null) {
          found = i;
        } else if (compareBidiLevel(order, cur.level, order[found].level)) {
          if (cur.from != cur.to) bidiOther = found;
          return i;
        } else {
          if (cur.from != cur.to) bidiOther = i;
          return found;
        }
      }
    }
    return found;
  }

  function moveInLine(line, pos, dir, byUnit) {
    if (!byUnit) return pos + dir;
    do pos += dir;
    while (pos > 0 && isExtendingChar(line.text.charAt(pos)));
    return pos;
  }

  // This is needed in order to move 'visually' through bi-directional
  // text -- i.e., pressing left should make the cursor go left, even
  // when in RTL text. The tricky part is the 'jumps', where RTL and
  // LTR text touch each other. This often requires the cursor offset
  // to move more than one unit, in order to visually move one unit.
  function moveVisually(line, start, dir, byUnit) {
    var bidi = getOrder(line);
    if (!bidi) return moveLogically(line, start, dir, byUnit);
    var pos = getBidiPartAt(bidi, start), part = bidi[pos];
    var target = moveInLine(line, start, part.level % 2 ? -dir : dir, byUnit);

    for (;;) {
      if (target > part.from && target < part.to) return target;
      if (target == part.from || target == part.to) {
        if (getBidiPartAt(bidi, target) == pos) return target;
        part = bidi[pos += dir];
        return (dir > 0) == part.level % 2 ? part.to : part.from;
      } else {
        part = bidi[pos += dir];
        if (!part) return null;
        if ((dir > 0) == part.level % 2)
          target = moveInLine(line, part.to, -1, byUnit);
        else
          target = moveInLine(line, part.from, 1, byUnit);
      }
    }
  }

  function moveLogically(line, start, dir, byUnit) {
    var target = start + dir;
    if (byUnit) while (target > 0 && isExtendingChar(line.text.charAt(target))) target += dir;
    return target < 0 || target > line.text.length ? null : target;
  }

  // Bidirectional ordering algorithm
  // See http://unicode.org/reports/tr9/tr9-13.html for the algorithm
  // that this (partially) implements.

  // One-char codes used for character types:
  // L (L):   Left-to-Right
  // R (R):   Right-to-Left
  // r (AL):  Right-to-Left Arabic
  // 1 (EN):  European Number
  // + (ES):  European Number Separator
  // % (ET):  European Number Terminator
  // n (AN):  Arabic Number
  // , (CS):  Common Number Separator
  // m (NSM): Non-Spacing Mark
  // b (BN):  Boundary Neutral
  // s (B):   Paragraph Separator
  // t (S):   Segment Separator
  // w (WS):  Whitespace
  // N (ON):  Other Neutrals

  // Returns null if characters are ordered as they appear
  // (left-to-right), or an array of sections ({from, to, level}
  // objects) in the order in which they occur visually.
  var bidiOrdering = (function() {
    // Character types for codepoints 0 to 0xff
    var lowTypes = "bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN";
    // Character types for codepoints 0x600 to 0x6ff
    var arabicTypes = "rrrrrrrrrrrr,rNNmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmrrrrrrrnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmNmmmm";
    function charType(code) {
      if (code <= 0xf7) return lowTypes.charAt(code);
      else if (0x590 <= code && code <= 0x5f4) return "R";
      else if (0x600 <= code && code <= 0x6ed) return arabicTypes.charAt(code - 0x600);
      else if (0x6ee <= code && code <= 0x8ac) return "r";
      else if (0x2000 <= code && code <= 0x200b) return "w";
      else if (code == 0x200c) return "b";
      else return "L";
    }

    var bidiRE = /[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;
    var isNeutral = /[stwN]/, isStrong = /[LRr]/, countsAsLeft = /[Lb1n]/, countsAsNum = /[1n]/;
    // Browsers seem to always treat the boundaries of block elements as being L.
    var outerType = "L";

    function BidiSpan(level, from, to) {
      this.level = level;
      this.from = from; this.to = to;
    }

    return function(str) {
      if (!bidiRE.test(str)) return false;
      var len = str.length, types = [];
      for (var i = 0, type; i < len; ++i)
        types.push(type = charType(str.charCodeAt(i)));

      // W1. Examine each non-spacing mark (NSM) in the level run, and
      // change the type of the NSM to the type of the previous
      // character. If the NSM is at the start of the level run, it will
      // get the type of sor.
      for (var i = 0, prev = outerType; i < len; ++i) {
        var type = types[i];
        if (type == "m") types[i] = prev;
        else prev = type;
      }

      // W2. Search backwards from each instance of a European number
      // until the first strong type (R, L, AL, or sor) is found. If an
      // AL is found, change the type of the European number to Arabic
      // number.
      // W3. Change all ALs to R.
      for (var i = 0, cur = outerType; i < len; ++i) {
        var type = types[i];
        if (type == "1" && cur == "r") types[i] = "n";
        else if (isStrong.test(type)) { cur = type; if (type == "r") types[i] = "R"; }
      }

      // W4. A single European separator between two European numbers
      // changes to a European number. A single common separator between
      // two numbers of the same type changes to that type.
      for (var i = 1, prev = types[0]; i < len - 1; ++i) {
        var type = types[i];
        if (type == "+" && prev == "1" && types[i+1] == "1") types[i] = "1";
        else if (type == "," && prev == types[i+1] &&
                 (prev == "1" || prev == "n")) types[i] = prev;
        prev = type;
      }

      // W5. A sequence of European terminators adjacent to European
      // numbers changes to all European numbers.
      // W6. Otherwise, separators and terminators change to Other
      // Neutral.
      for (var i = 0; i < len; ++i) {
        var type = types[i];
        if (type == ",") types[i] = "N";
        else if (type == "%") {
          for (var end = i + 1; end < len && types[end] == "%"; ++end) {}
          var replace = (i && types[i-1] == "!") || (end < len && types[end] == "1") ? "1" : "N";
          for (var j = i; j < end; ++j) types[j] = replace;
          i = end - 1;
        }
      }

      // W7. Search backwards from each instance of a European number
      // until the first strong type (R, L, or sor) is found. If an L is
      // found, then change the type of the European number to L.
      for (var i = 0, cur = outerType; i < len; ++i) {
        var type = types[i];
        if (cur == "L" && type == "1") types[i] = "L";
        else if (isStrong.test(type)) cur = type;
      }

      // N1. A sequence of neutrals takes the direction of the
      // surrounding strong text if the text on both sides has the same
      // direction. European and Arabic numbers act as if they were R in
      // terms of their influence on neutrals. Start-of-level-run (sor)
      // and end-of-level-run (eor) are used at level run boundaries.
      // N2. Any remaining neutrals take the embedding direction.
      for (var i = 0; i < len; ++i) {
        if (isNeutral.test(types[i])) {
          for (var end = i + 1; end < len && isNeutral.test(types[end]); ++end) {}
          var before = (i ? types[i-1] : outerType) == "L";
          var after = (end < len ? types[end] : outerType) == "L";
          var replace = before || after ? "L" : "R";
          for (var j = i; j < end; ++j) types[j] = replace;
          i = end - 1;
        }
      }

      // Here we depart from the documented algorithm, in order to avoid
      // building up an actual levels array. Since there are only three
      // levels (0, 1, 2) in an implementation that doesn't take
      // explicit embedding into account, we can build up the order on
      // the fly, without following the level-based algorithm.
      var order = [], m;
      for (var i = 0; i < len;) {
        if (countsAsLeft.test(types[i])) {
          var start = i;
          for (++i; i < len && countsAsLeft.test(types[i]); ++i) {}
          order.push(new BidiSpan(0, start, i));
        } else {
          var pos = i, at = order.length;
          for (++i; i < len && types[i] != "L"; ++i) {}
          for (var j = pos; j < i;) {
            if (countsAsNum.test(types[j])) {
              if (pos < j) order.splice(at, 0, new BidiSpan(1, pos, j));
              var nstart = j;
              for (++j; j < i && countsAsNum.test(types[j]); ++j) {}
              order.splice(at, 0, new BidiSpan(2, nstart, j));
              pos = j;
            } else ++j;
          }
          if (pos < i) order.splice(at, 0, new BidiSpan(1, pos, i));
        }
      }
      if (order[0].level == 1 && (m = str.match(/^\s+/))) {
        order[0].from = m[0].length;
        order.unshift(new BidiSpan(0, 0, m[0].length));
      }
      if (lst(order).level == 1 && (m = str.match(/\s+$/))) {
        lst(order).to -= m[0].length;
        order.push(new BidiSpan(0, len - m[0].length, len));
      }
      if (order[0].level == 2)
        order.unshift(new BidiSpan(1, order[0].to, order[0].to));
      if (order[0].level != lst(order).level)
        order.push(new BidiSpan(order[0].level, len, len));

      return order;
    };
  })();

  // THE END

  CodeMirror.version = "5.11.0";

  return CodeMirror;
});

},{}],3:[function(require,module,exports){
// CodeMirror, copyright (c) by Marijn Haverbeke and others
// Distributed under an MIT license: http://codemirror.net/LICENSE

/**
 * Author: Hans Engel
 * Branched from CodeMirror's Scheme mode (by Koh Zi Han, based on implementation by Koh Zi Chun)
 */

(function(mod) {
  if (typeof exports == "object" && typeof module == "object") // CommonJS
    mod(require("../../lib/codemirror"));
  else if (typeof define == "function" && define.amd) // AMD
    define(["../../lib/codemirror"], mod);
  else // Plain browser env
    mod(CodeMirror);
})(function(CodeMirror) {
"use strict";

CodeMirror.defineMode("clojure", function (options) {
    var BUILTIN = "builtin", COMMENT = "comment", STRING = "string", CHARACTER = "string-2",
        ATOM = "atom", NUMBER = "number", BRACKET = "bracket", KEYWORD = "keyword", VAR = "variable";
    var INDENT_WORD_SKIP = options.indentUnit || 2;
    var NORMAL_INDENT_UNIT = options.indentUnit || 2;

    function makeKeywords(str) {
        var obj = {}, words = str.split(" ");
        for (var i = 0; i < words.length; ++i) obj[words[i]] = true;
        return obj;
    }

    var atoms = makeKeywords("true false nil");

    var keywords = makeKeywords(
      "defn defn- def def- defonce defmulti defmethod defmacro defstruct deftype defprotocol defrecord defproject deftest slice defalias defhinted defmacro- defn-memo defnk defnk defonce- defunbound defunbound- defvar defvar- let letfn do case cond condp for loop recur when when-not when-let when-first if if-let if-not . .. -> ->> doto and or dosync doseq dotimes dorun doall load import unimport ns in-ns refer try catch finally throw with-open with-local-vars binding gen-class gen-and-load-class gen-and-save-class handler-case handle");

    var builtins = makeKeywords(
        "* *' *1 *2 *3 *agent* *allow-unresolved-vars* *assert* *clojure-version* *command-line-args* *compile-files* *compile-path* *compiler-options* *data-readers* *e *err* *file* *flush-on-newline* *fn-loader* *in* *math-context* *ns* *out* *print-dup* *print-length* *print-level* *print-meta* *print-readably* *read-eval* *source-path* *unchecked-math* *use-context-classloader* *verbose-defrecords* *warn-on-reflection* + +' - -' -> ->> ->ArrayChunk ->Vec ->VecNode ->VecSeq -cache-protocol-fn -reset-methods .. / < <= = == > >= EMPTY-NODE accessor aclone add-classpath add-watch agent agent-error agent-errors aget alength alias all-ns alter alter-meta! alter-var-root amap ancestors and apply areduce array-map aset aset-boolean aset-byte aset-char aset-double aset-float aset-int aset-long aset-short assert assoc assoc! assoc-in associative? atom await await-for await1 bases bean bigdec bigint biginteger binding bit-and bit-and-not bit-clear bit-flip bit-not bit-or bit-set bit-shift-left bit-shift-right bit-test bit-xor boolean boolean-array booleans bound-fn bound-fn* bound? butlast byte byte-array bytes case cast char char-array char-escape-string char-name-string char? chars chunk chunk-append chunk-buffer chunk-cons chunk-first chunk-next chunk-rest chunked-seq? class class? clear-agent-errors clojure-version coll? comment commute comp comparator compare compare-and-set! compile complement concat cond condp conj conj! cons constantly construct-proxy contains? count counted? create-ns create-struct cycle dec dec' decimal? declare default-data-readers definline definterface defmacro defmethod defmulti defn defn- defonce defprotocol defrecord defstruct deftype delay delay? deliver denominator deref derive descendants destructure disj disj! dissoc dissoc! distinct distinct? doall dorun doseq dosync dotimes doto double double-array doubles drop drop-last drop-while empty empty? ensure enumeration-seq error-handler error-mode eval even? every-pred every? ex-data ex-info extend extend-protocol extend-type extenders extends? false? ffirst file-seq filter filterv find find-keyword find-ns find-protocol-impl find-protocol-method find-var first flatten float float-array float? floats flush fn fn? fnext fnil for force format frequencies future future-call future-cancel future-cancelled? future-done? future? gen-class gen-interface gensym get get-in get-method get-proxy-class get-thread-bindings get-validator group-by hash hash-combine hash-map hash-set identical? identity if-let if-not ifn? import in-ns inc inc' init-proxy instance? int int-array integer? interleave intern interpose into into-array ints io! isa? iterate iterator-seq juxt keep keep-indexed key keys keyword keyword? last lazy-cat lazy-seq let letfn line-seq list list* list? load load-file load-reader load-string loaded-libs locking long long-array longs loop macroexpand macroexpand-1 make-array make-hierarchy map map-indexed map? mapcat mapv max max-key memfn memoize merge merge-with meta method-sig methods min min-key mod munge name namespace namespace-munge neg? newline next nfirst nil? nnext not not-any? not-empty not-every? not= ns ns-aliases ns-imports ns-interns ns-map ns-name ns-publics ns-refers ns-resolve ns-unalias ns-unmap nth nthnext nthrest num number? numerator object-array odd? or parents partial partition partition-all partition-by pcalls peek persistent! pmap pop pop! pop-thread-bindings pos? pr pr-str prefer-method prefers primitives-classnames print print-ctor print-dup print-method print-simple print-str printf println println-str prn prn-str promise proxy proxy-call-with-super proxy-mappings proxy-name proxy-super push-thread-bindings pvalues quot rand rand-int rand-nth range ratio? rational? rationalize re-find re-groups re-matcher re-matches re-pattern re-seq read read-line read-string realized? reduce reduce-kv reductions ref ref-history-count ref-max-history ref-min-history ref-set refer refer-clojure reify release-pending-sends rem remove remove-all-methods remove-method remove-ns remove-watch repeat repeatedly replace replicate require reset! reset-meta! resolve rest restart-agent resultset-seq reverse reversible? rseq rsubseq satisfies? second select-keys send send-off seq seq? seque sequence sequential? set set-error-handler! set-error-mode! set-validator! set? short short-array shorts shuffle shutdown-agents slurp some some-fn sort sort-by sorted-map sorted-map-by sorted-set sorted-set-by sorted? special-symbol? spit split-at split-with str string? struct struct-map subs subseq subvec supers swap! symbol symbol? sync take take-last take-nth take-while test the-ns thread-bound? time to-array to-array-2d trampoline transient tree-seq true? type unchecked-add unchecked-add-int unchecked-byte unchecked-char unchecked-dec unchecked-dec-int unchecked-divide-int unchecked-double unchecked-float unchecked-inc unchecked-inc-int unchecked-int unchecked-long unchecked-multiply unchecked-multiply-int unchecked-negate unchecked-negate-int unchecked-remainder-int unchecked-short unchecked-subtract unchecked-subtract-int underive unquote unquote-splicing update-in update-proxy use val vals var-get var-set var? vary-meta vec vector vector-of vector? when when-first when-let when-not while with-bindings with-bindings* with-in-str with-loading-context with-local-vars with-meta with-open with-out-str with-precision with-redefs with-redefs-fn xml-seq zero? zipmap *default-data-reader-fn* as-> cond-> cond->> reduced reduced? send-via set-agent-send-executor! set-agent-send-off-executor! some-> some->>");

    var indentKeys = makeKeywords(
        // Built-ins
        "ns fn def defn defmethod bound-fn if if-not case condp when while when-not when-first do future comment doto locking proxy with-open with-precision reify deftype defrecord defprotocol extend extend-protocol extend-type try catch " +

        // Binding forms
        "let letfn binding loop for doseq dotimes when-let if-let " +

        // Data structures
        "defstruct struct-map assoc " +

        // clojure.test
        "testing deftest " +

        // contrib
        "handler-case handle dotrace deftrace");

    var tests = {
        digit: /\d/,
        digit_or_colon: /[\d:]/,
        hex: /[0-9a-f]/i,
        sign: /[+-]/,
        exponent: /e/i,
        keyword_char: /[^\s\(\[\;\)\]]/,
        symbol: /[\w*+!\-\._?:<>\/\xa1-\uffff]/,
        block_indent: /^(?:def|with)[^\/]+$|\/(?:def|with)/
    };

    function stateStack(indent, type, prev) { // represents a state stack object
        this.indent = indent;
        this.type = type;
        this.prev = prev;
    }

    function pushStack(state, indent, type) {
        state.indentStack = new stateStack(indent, type, state.indentStack);
    }

    function popStack(state) {
        state.indentStack = state.indentStack.prev;
    }

    function isNumber(ch, stream){
        // hex
        if ( ch === '0' && stream.eat(/x/i) ) {
            stream.eatWhile(tests.hex);
            return true;
        }

        // leading sign
        if ( ( ch == '+' || ch == '-' ) && ( tests.digit.test(stream.peek()) ) ) {
          stream.eat(tests.sign);
          ch = stream.next();
        }

        if ( tests.digit.test(ch) ) {
            stream.eat(ch);
            stream.eatWhile(tests.digit);

            if ( '.' == stream.peek() ) {
                stream.eat('.');
                stream.eatWhile(tests.digit);
            } else if ('/' == stream.peek() ) {
                stream.eat('/');
                stream.eatWhile(tests.digit);
            }

            if ( stream.eat(tests.exponent) ) {
                stream.eat(tests.sign);
                stream.eatWhile(tests.digit);
            }

            return true;
        }

        return false;
    }

    // Eat character that starts after backslash \
    function eatCharacter(stream) {
        var first = stream.next();
        // Read special literals: backspace, newline, space, return.
        // Just read all lowercase letters.
        if (first && first.match(/[a-z]/) && stream.match(/[a-z]+/, true)) {
            return;
        }
        // Read unicode character: \u1000 \uA0a1
        if (first === "u") {
            stream.match(/[0-9a-z]{4}/i, true);
        }
    }

    return {
        startState: function () {
            return {
                indentStack: null,
                indentation: 0,
                mode: false
            };
        },

        token: function (stream, state) {
            if (state.indentStack == null && stream.sol()) {
                // update indentation, but only if indentStack is empty
                state.indentation = stream.indentation();
            }

            // skip spaces
            if (state.mode != "string" && stream.eatSpace()) {
                return null;
            }
            var returnType = null;

            switch(state.mode){
                case "string": // multi-line string parsing mode
                    var next, escaped = false;
                    while ((next = stream.next()) != null) {
                        if (next == "\"" && !escaped) {

                            state.mode = false;
                            break;
                        }
                        escaped = !escaped && next == "\\";
                    }
                    returnType = STRING; // continue on in string mode
                    break;
                default: // default parsing mode
                    var ch = stream.next();

                    if (ch == "\"") {
                        state.mode = "string";
                        returnType = STRING;
                    } else if (ch == "\\") {
                        eatCharacter(stream);
                        returnType = CHARACTER;
                    } else if (ch == "'" && !( tests.digit_or_colon.test(stream.peek()) )) {
                        returnType = ATOM;
                    } else if (ch == ";") { // comment
                        stream.skipToEnd(); // rest of the line is a comment
                        returnType = COMMENT;
                    } else if (isNumber(ch,stream)){
                        returnType = NUMBER;
                    } else if (ch == "(" || ch == "[" || ch == "{" ) {
                        var keyWord = '', indentTemp = stream.column(), letter;
                        /**
                        Either
                        (indent-word ..
                        (non-indent-word ..
                        (;something else, bracket, etc.
                        */

                        if (ch == "(") while ((letter = stream.eat(tests.keyword_char)) != null) {
                            keyWord += letter;
                        }

                        if (keyWord.length > 0 && (indentKeys.propertyIsEnumerable(keyWord) ||
                                                   tests.block_indent.test(keyWord))) { // indent-word
                            pushStack(state, indentTemp + INDENT_WORD_SKIP, ch);
                        } else { // non-indent word
                            // we continue eating the spaces
                            stream.eatSpace();
                            if (stream.eol() || stream.peek() == ";") {
                                // nothing significant after
                                // we restart indentation the user defined spaces after
                                pushStack(state, indentTemp + NORMAL_INDENT_UNIT, ch);
                            } else {
                                pushStack(state, indentTemp + stream.current().length, ch); // else we match
                            }
                        }
                        stream.backUp(stream.current().length - 1); // undo all the eating

                        returnType = BRACKET;
                    } else if (ch == ")" || ch == "]" || ch == "}") {
                        returnType = BRACKET;
                        if (state.indentStack != null && state.indentStack.type == (ch == ")" ? "(" : (ch == "]" ? "[" :"{"))) {
                            popStack(state);
                        }
                    } else if ( ch == ":" ) {
                        stream.eatWhile(tests.symbol);
                        return ATOM;
                    } else {
                        stream.eatWhile(tests.symbol);

                        if (keywords && keywords.propertyIsEnumerable(stream.current())) {
                            returnType = KEYWORD;
                        } else if (builtins && builtins.propertyIsEnumerable(stream.current())) {
                            returnType = BUILTIN;
                        } else if (atoms && atoms.propertyIsEnumerable(stream.current())) {
                            returnType = ATOM;
                        } else {
                          returnType = VAR;
                        }
                    }
            }

            return returnType;
        },

        indent: function (state) {
            if (state.indentStack == null) return state.indentation;
            return state.indentStack.indent;
        },

        closeBrackets: {pairs: "()[]{}\"\""},
        lineComment: ";;"
    };
});

CodeMirror.defineMIME("text/x-clojure", "clojure");
CodeMirror.defineMIME("text/x-clojurescript", "clojure");

});

},{"../../lib/codemirror":2}],4:[function(require,module,exports){
// CodeMirror, copyright (c) by Marijn Haverbeke and others
// Distributed under an MIT license: http://codemirror.net/LICENSE

(function(mod) {
  if (typeof exports == "object" && typeof module == "object") // CommonJS
    mod(require("../../lib/codemirror"), require("../markdown/markdown"), require("../../addon/mode/overlay"));
  else if (typeof define == "function" && define.amd) // AMD
    define(["../../lib/codemirror", "../markdown/markdown", "../../addon/mode/overlay"], mod);
  else // Plain browser env
    mod(CodeMirror);
})(function(CodeMirror) {
"use strict";

var urlRE = /^((?:(?:aaas?|about|acap|adiumxtra|af[ps]|aim|apt|attachment|aw|beshare|bitcoin|bolo|callto|cap|chrome(?:-extension)?|cid|coap|com-eventbrite-attendee|content|crid|cvs|data|dav|dict|dlna-(?:playcontainer|playsingle)|dns|doi|dtn|dvb|ed2k|facetime|feed|file|finger|fish|ftp|geo|gg|git|gizmoproject|go|gopher|gtalk|h323|hcp|https?|iax|icap|icon|im|imap|info|ipn|ipp|irc[6s]?|iris(?:\.beep|\.lwz|\.xpc|\.xpcs)?|itms|jar|javascript|jms|keyparc|lastfm|ldaps?|magnet|mailto|maps|market|message|mid|mms|ms-help|msnim|msrps?|mtqp|mumble|mupdate|mvn|news|nfs|nih?|nntp|notes|oid|opaquelocktoken|palm|paparazzi|platform|pop|pres|proxy|psyc|query|res(?:ource)?|rmi|rsync|rtmp|rtsp|secondlife|service|session|sftp|sgn|shttp|sieve|sips?|skype|sm[bs]|snmp|soap\.beeps?|soldat|spotify|ssh|steam|svn|tag|teamspeak|tel(?:net)?|tftp|things|thismessage|tip|tn3270|tv|udp|unreal|urn|ut2004|vemmi|ventrilo|view-source|webcal|wss?|wtai|wyciwyg|xcon(?:-userid)?|xfire|xmlrpc\.beeps?|xmpp|xri|ymsgr|z39\.50[rs]?):(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]|\([^\s()<>]*\))+(?:\([^\s()<>]*\)|[^\s`*!()\[\]{};:'".,<>?«»“”‘’]))/i

CodeMirror.defineMode("gfm", function(config, modeConfig) {
  var codeDepth = 0;
  function blankLine(state) {
    state.code = false;
    return null;
  }
  var gfmOverlay = {
    startState: function() {
      return {
        code: false,
        codeBlock: false,
        ateSpace: false
      };
    },
    copyState: function(s) {
      return {
        code: s.code,
        codeBlock: s.codeBlock,
        ateSpace: s.ateSpace
      };
    },
    token: function(stream, state) {
      state.combineTokens = null;

      // Hack to prevent formatting override inside code blocks (block and inline)
      if (state.codeBlock) {
        if (stream.match(/^```+/)) {
          state.codeBlock = false;
          return null;
        }
        stream.skipToEnd();
        return null;
      }
      if (stream.sol()) {
        state.code = false;
      }
      if (stream.sol() && stream.match(/^```+/)) {
        stream.skipToEnd();
        state.codeBlock = true;
        return null;
      }
      // If this block is changed, it may need to be updated in Markdown mode
      if (stream.peek() === '`') {
        stream.next();
        var before = stream.pos;
        stream.eatWhile('`');
        var difference = 1 + stream.pos - before;
        if (!state.code) {
          codeDepth = difference;
          state.code = true;
        } else {
          if (difference === codeDepth) { // Must be exact
            state.code = false;
          }
        }
        return null;
      } else if (state.code) {
        stream.next();
        return null;
      }
      // Check if space. If so, links can be formatted later on
      if (stream.eatSpace()) {
        state.ateSpace = true;
        return null;
      }
      if (stream.sol() || state.ateSpace) {
        state.ateSpace = false;
        if (modeConfig.gitHubSpice !== false) {
          if(stream.match(/^(?:[a-zA-Z0-9\-_]+\/)?(?:[a-zA-Z0-9\-_]+@)?(?:[a-f0-9]{7,40}\b)/)) {
            // User/Project@SHA
            // User@SHA
            // SHA
            state.combineTokens = true;
            return "link";
          } else if (stream.match(/^(?:[a-zA-Z0-9\-_]+\/)?(?:[a-zA-Z0-9\-_]+)?#[0-9]+\b/)) {
            // User/Project#Num
            // User#Num
            // #Num
            state.combineTokens = true;
            return "link";
          }
        }
      }
      if (stream.match(urlRE) &&
          stream.string.slice(stream.start - 2, stream.start) != "](" &&
          (stream.start == 0 || /\W/.test(stream.string.charAt(stream.start - 1)))) {
        // URLs
        // Taken from http://daringfireball.net/2010/07/improved_regex_for_matching_urls
        // And then (issue #1160) simplified to make it not crash the Chrome Regexp engine
        // And then limited url schemes to the CommonMark list, so foo:bar isn't matched as a URL
        state.combineTokens = true;
        return "link";
      }
      stream.next();
      return null;
    },
    blankLine: blankLine
  };

  var markdownConfig = {
    underscoresBreakWords: false,
    taskLists: true,
    fencedCodeBlocks: '```',
    strikethrough: true
  };
  for (var attr in modeConfig) {
    markdownConfig[attr] = modeConfig[attr];
  }
  markdownConfig.name = "markdown";
  return CodeMirror.overlayMode(CodeMirror.getMode(config, markdownConfig), gfmOverlay);

}, "markdown");

  CodeMirror.defineMIME("text/x-gfm", "gfm");
});

},{"../../addon/mode/overlay":1,"../../lib/codemirror":2,"../markdown/markdown":5}],5:[function(require,module,exports){
// CodeMirror, copyright (c) by Marijn Haverbeke and others
// Distributed under an MIT license: http://codemirror.net/LICENSE

(function(mod) {
  if (typeof exports == "object" && typeof module == "object") // CommonJS
    mod(require("../../lib/codemirror"), require("../xml/xml"), require("../meta"));
  else if (typeof define == "function" && define.amd) // AMD
    define(["../../lib/codemirror", "../xml/xml", "../meta"], mod);
  else // Plain browser env
    mod(CodeMirror);
})(function(CodeMirror) {
"use strict";

CodeMirror.defineMode("markdown", function(cmCfg, modeCfg) {

  var htmlFound = CodeMirror.modes.hasOwnProperty("xml");
  var htmlMode = CodeMirror.getMode(cmCfg, htmlFound ? {name: "xml", htmlMode: true} : "text/plain");

  function getMode(name) {
    if (CodeMirror.findModeByName) {
      var found = CodeMirror.findModeByName(name);
      if (found) name = found.mime || found.mimes[0];
    }
    var mode = CodeMirror.getMode(cmCfg, name);
    return mode.name == "null" ? null : mode;
  }

  // Should characters that affect highlighting be highlighted separate?
  // Does not include characters that will be output (such as `1.` and `-` for lists)
  if (modeCfg.highlightFormatting === undefined)
    modeCfg.highlightFormatting = false;

  // Maximum number of nested blockquotes. Set to 0 for infinite nesting.
  // Excess `>` will emit `error` token.
  if (modeCfg.maxBlockquoteDepth === undefined)
    modeCfg.maxBlockquoteDepth = 0;

  // Should underscores in words open/close em/strong?
  if (modeCfg.underscoresBreakWords === undefined)
    modeCfg.underscoresBreakWords = true;

  // Use `fencedCodeBlocks` to configure fenced code blocks. false to
  // disable, string to specify a precise regexp that the fence should
  // match, and true to allow three or more backticks or tildes (as
  // per CommonMark).

  // Turn on task lists? ("- [ ] " and "- [x] ")
  if (modeCfg.taskLists === undefined) modeCfg.taskLists = false;

  // Turn on strikethrough syntax
  if (modeCfg.strikethrough === undefined)
    modeCfg.strikethrough = false;

  // Allow token types to be overridden by user-provided token types.
  if (modeCfg.tokenTypeOverrides === undefined)
    modeCfg.tokenTypeOverrides = {};

  var codeDepth = 0;

  var tokenTypes = {
    header: "header",
    code: "comment",
    quote: "quote",
    list1: "variable-2",
    list2: "variable-3",
    list3: "keyword",
    hr: "hr",
    image: "tag",
    formatting: "formatting",
    linkInline: "link",
    linkEmail: "link",
    linkText: "link",
    linkHref: "string",
    em: "em",
    strong: "strong",
    strikethrough: "strikethrough"
  };

  for (var tokenType in tokenTypes) {
    if (tokenTypes.hasOwnProperty(tokenType) && modeCfg.tokenTypeOverrides[tokenType]) {
      tokenTypes[tokenType] = modeCfg.tokenTypeOverrides[tokenType];
    }
  }

  var hrRE = /^([*\-_])(?:\s*\1){2,}\s*$/
  ,   ulRE = /^[*\-+]\s+/
  ,   olRE = /^[0-9]+([.)])\s+/
  ,   taskListRE = /^\[(x| )\](?=\s)/ // Must follow ulRE or olRE
  ,   atxHeaderRE = modeCfg.allowAtxHeaderWithoutSpace ? /^(#+)/ : /^(#+)(?: |$)/
  ,   setextHeaderRE = /^ *(?:\={1,}|-{1,})\s*$/
  ,   textRE = /^[^#!\[\]*_\\<>` "'(~]+/
  ,   fencedCodeRE = new RegExp("^(" + (modeCfg.fencedCodeBlocks === true ? "~~~+|```+" : modeCfg.fencedCodeBlocks) +
                                ")[ \\t]*([\\w+#]*)");

  function switchInline(stream, state, f) {
    state.f = state.inline = f;
    return f(stream, state);
  }

  function switchBlock(stream, state, f) {
    state.f = state.block = f;
    return f(stream, state);
  }

  function lineIsEmpty(line) {
    return !line || !/\S/.test(line.string)
  }

  // Blocks

  function blankLine(state) {
    // Reset linkTitle state
    state.linkTitle = false;
    // Reset EM state
    state.em = false;
    // Reset STRONG state
    state.strong = false;
    // Reset strikethrough state
    state.strikethrough = false;
    // Reset state.quote
    state.quote = 0;
    // Reset state.indentedCode
    state.indentedCode = false;
    if (!htmlFound && state.f == htmlBlock) {
      state.f = inlineNormal;
      state.block = blockNormal;
    }
    // Reset state.trailingSpace
    state.trailingSpace = 0;
    state.trailingSpaceNewLine = false;
    // Mark this line as blank
    state.prevLine = state.thisLine
    state.thisLine = null
    return null;
  }

  function blockNormal(stream, state) {

    var sol = stream.sol();

    var prevLineIsList = state.list !== false,
        prevLineIsIndentedCode = state.indentedCode;

    state.indentedCode = false;

    if (prevLineIsList) {
      if (state.indentationDiff >= 0) { // Continued list
        if (state.indentationDiff < 4) { // Only adjust indentation if *not* a code block
          state.indentation -= state.indentationDiff;
        }
        state.list = null;
      } else if (state.indentation > 0) {
        state.list = null;
        state.listDepth = Math.floor(state.indentation / 4);
      } else { // No longer a list
        state.list = false;
        state.listDepth = 0;
      }
    }

    var match = null;
    if (state.indentationDiff >= 4) {
      stream.skipToEnd();
      if (prevLineIsIndentedCode || lineIsEmpty(state.prevLine)) {
        state.indentation -= 4;
        state.indentedCode = true;
        return tokenTypes.code;
      } else {
        return null;
      }
    } else if (stream.eatSpace()) {
      return null;
    } else if ((match = stream.match(atxHeaderRE)) && match[1].length <= 6) {
      state.header = match[1].length;
      if (modeCfg.highlightFormatting) state.formatting = "header";
      state.f = state.inline;
      return getType(state);
    } else if (!lineIsEmpty(state.prevLine) && !state.quote && !prevLineIsList &&
               !prevLineIsIndentedCode && (match = stream.match(setextHeaderRE))) {
      state.header = match[0].charAt(0) == '=' ? 1 : 2;
      if (modeCfg.highlightFormatting) state.formatting = "header";
      state.f = state.inline;
      return getType(state);
    } else if (stream.eat('>')) {
      state.quote = sol ? 1 : state.quote + 1;
      if (modeCfg.highlightFormatting) state.formatting = "quote";
      stream.eatSpace();
      return getType(state);
    } else if (stream.peek() === '[') {
      return switchInline(stream, state, footnoteLink);
    } else if (stream.match(hrRE, true)) {
      state.hr = true;
      return tokenTypes.hr;
    } else if ((lineIsEmpty(state.prevLine) || prevLineIsList) && (stream.match(ulRE, false) || stream.match(olRE, false))) {
      var listType = null;
      if (stream.match(ulRE, true)) {
        listType = 'ul';
      } else {
        stream.match(olRE, true);
        listType = 'ol';
      }
      state.indentation = stream.column() + stream.current().length;
      state.list = true;
      state.listDepth++;
      if (modeCfg.taskLists && stream.match(taskListRE, false)) {
        state.taskList = true;
      }
      state.f = state.inline;
      if (modeCfg.highlightFormatting) state.formatting = ["list", "list-" + listType];
      return getType(state);
    } else if (modeCfg.fencedCodeBlocks && (match = stream.match(fencedCodeRE, true))) {
      state.fencedChars = match[1]
      // try switching mode
      state.localMode = getMode(match[2]);
      if (state.localMode) state.localState = state.localMode.startState();
      state.f = state.block = local;
      if (modeCfg.highlightFormatting) state.formatting = "code-block";
      state.code = true;
      return getType(state);
    }

    return switchInline(stream, state, state.inline);
  }

  function htmlBlock(stream, state) {
    var style = htmlMode.token(stream, state.htmlState);
    if ((htmlFound && state.htmlState.tagStart === null &&
         (!state.htmlState.context && state.htmlState.tokenize.isInText)) ||
        (state.md_inside && stream.current().indexOf(">") > -1)) {
      state.f = inlineNormal;
      state.block = blockNormal;
      state.htmlState = null;
    }
    return style;
  }

  function local(stream, state) {
    if (state.fencedChars && stream.match(state.fencedChars, false)) {
      state.localMode = state.localState = null;
      state.f = state.block = leavingLocal;
      return null;
    } else if (state.localMode) {
      return state.localMode.token(stream, state.localState);
    } else {
      stream.skipToEnd();
      return tokenTypes.code;
    }
  }

  function leavingLocal(stream, state) {
    stream.match(state.fencedChars);
    state.block = blockNormal;
    state.f = inlineNormal;
    state.fencedChars = null;
    if (modeCfg.highlightFormatting) state.formatting = "code-block";
    state.code = true;
    var returnType = getType(state);
    state.code = false;
    return returnType;
  }

  // Inline
  function getType(state) {
    var styles = [];

    if (state.formatting) {
      styles.push(tokenTypes.formatting);

      if (typeof state.formatting === "string") state.formatting = [state.formatting];

      for (var i = 0; i < state.formatting.length; i++) {
        styles.push(tokenTypes.formatting + "-" + state.formatting[i]);

        if (state.formatting[i] === "header") {
          styles.push(tokenTypes.formatting + "-" + state.formatting[i] + "-" + state.header);
        }

        // Add `formatting-quote` and `formatting-quote-#` for blockquotes
        // Add `error` instead if the maximum blockquote nesting depth is passed
        if (state.formatting[i] === "quote") {
          if (!modeCfg.maxBlockquoteDepth || modeCfg.maxBlockquoteDepth >= state.quote) {
            styles.push(tokenTypes.formatting + "-" + state.formatting[i] + "-" + state.quote);
          } else {
            styles.push("error");
          }
        }
      }
    }

    if (state.taskOpen) {
      styles.push("meta");
      return styles.length ? styles.join(' ') : null;
    }
    if (state.taskClosed) {
      styles.push("property");
      return styles.length ? styles.join(' ') : null;
    }

    if (state.linkHref) {
      styles.push(tokenTypes.linkHref, "url");
    } else { // Only apply inline styles to non-url text
      if (state.strong) { styles.push(tokenTypes.strong); }
      if (state.em) { styles.push(tokenTypes.em); }
      if (state.strikethrough) { styles.push(tokenTypes.strikethrough); }
      if (state.linkText) { styles.push(tokenTypes.linkText); }
      if (state.code) { styles.push(tokenTypes.code); }
    }

    if (state.header) { styles.push(tokenTypes.header, tokenTypes.header + "-" + state.header); }

    if (state.quote) {
      styles.push(tokenTypes.quote);

      // Add `quote-#` where the maximum for `#` is modeCfg.maxBlockquoteDepth
      if (!modeCfg.maxBlockquoteDepth || modeCfg.maxBlockquoteDepth >= state.quote) {
        styles.push(tokenTypes.quote + "-" + state.quote);
      } else {
        styles.push(tokenTypes.quote + "-" + modeCfg.maxBlockquoteDepth);
      }
    }

    if (state.list !== false) {
      var listMod = (state.listDepth - 1) % 3;
      if (!listMod) {
        styles.push(tokenTypes.list1);
      } else if (listMod === 1) {
        styles.push(tokenTypes.list2);
      } else {
        styles.push(tokenTypes.list3);
      }
    }

    if (state.trailingSpaceNewLine) {
      styles.push("trailing-space-new-line");
    } else if (state.trailingSpace) {
      styles.push("trailing-space-" + (state.trailingSpace % 2 ? "a" : "b"));
    }

    return styles.length ? styles.join(' ') : null;
  }

  function handleText(stream, state) {
    if (stream.match(textRE, true)) {
      return getType(state);
    }
    return undefined;
  }

  function inlineNormal(stream, state) {
    var style = state.text(stream, state);
    if (typeof style !== 'undefined')
      return style;

    if (state.list) { // List marker (*, +, -, 1., etc)
      state.list = null;
      return getType(state);
    }

    if (state.taskList) {
      var taskOpen = stream.match(taskListRE, true)[1] !== "x";
      if (taskOpen) state.taskOpen = true;
      else state.taskClosed = true;
      if (modeCfg.highlightFormatting) state.formatting = "task";
      state.taskList = false;
      return getType(state);
    }

    state.taskOpen = false;
    state.taskClosed = false;

    if (state.header && stream.match(/^#+$/, true)) {
      if (modeCfg.highlightFormatting) state.formatting = "header";
      return getType(state);
    }

    // Get sol() value now, before character is consumed
    var sol = stream.sol();

    var ch = stream.next();

    if (ch === '\\') {
      stream.next();
      if (modeCfg.highlightFormatting) {
        var type = getType(state);
        var formattingEscape = tokenTypes.formatting + "-escape";
        return type ? type + " " + formattingEscape : formattingEscape;
      }
    }

    // Matches link titles present on next line
    if (state.linkTitle) {
      state.linkTitle = false;
      var matchCh = ch;
      if (ch === '(') {
        matchCh = ')';
      }
      matchCh = (matchCh+'').replace(/([.?*+^$[\]\\(){}|-])/g, "\\$1");
      var regex = '^\\s*(?:[^' + matchCh + '\\\\]+|\\\\\\\\|\\\\.)' + matchCh;
      if (stream.match(new RegExp(regex), true)) {
        return tokenTypes.linkHref;
      }
    }

    // If this block is changed, it may need to be updated in GFM mode
    if (ch === '`') {
      var previousFormatting = state.formatting;
      if (modeCfg.highlightFormatting) state.formatting = "code";
      var t = getType(state);
      var before = stream.pos;
      stream.eatWhile('`');
      var difference = 1 + stream.pos - before;
      if (!state.code) {
        codeDepth = difference;
        state.code = true;
        return getType(state);
      } else {
        if (difference === codeDepth) { // Must be exact
          state.code = false;
          return t;
        }
        state.formatting = previousFormatting;
        return getType(state);
      }
    } else if (state.code) {
      return getType(state);
    }

    if (ch === '!' && stream.match(/\[[^\]]*\] ?(?:\(|\[)/, false)) {
      stream.match(/\[[^\]]*\]/);
      state.inline = state.f = linkHref;
      return tokenTypes.image;
    }

    if (ch === '[' && stream.match(/.*\](\(.*\)| ?\[.*\])/, false)) {
      state.linkText = true;
      if (modeCfg.highlightFormatting) state.formatting = "link";
      return getType(state);
    }

    if (ch === ']' && state.linkText && stream.match(/\(.*\)| ?\[.*\]/, false)) {
      if (modeCfg.highlightFormatting) state.formatting = "link";
      var type = getType(state);
      state.linkText = false;
      state.inline = state.f = linkHref;
      return type;
    }

    if (ch === '<' && stream.match(/^(https?|ftps?):\/\/(?:[^\\>]|\\.)+>/, false)) {
      state.f = state.inline = linkInline;
      if (modeCfg.highlightFormatting) state.formatting = "link";
      var type = getType(state);
      if (type){
        type += " ";
      } else {
        type = "";
      }
      return type + tokenTypes.linkInline;
    }

    if (ch === '<' && stream.match(/^[^> \\]+@(?:[^\\>]|\\.)+>/, false)) {
      state.f = state.inline = linkInline;
      if (modeCfg.highlightFormatting) state.formatting = "link";
      var type = getType(state);
      if (type){
        type += " ";
      } else {
        type = "";
      }
      return type + tokenTypes.linkEmail;
    }

    if (ch === '<' && stream.match(/^(!--|\w)/, false)) {
      var end = stream.string.indexOf(">", stream.pos);
      if (end != -1) {
        var atts = stream.string.substring(stream.start, end);
        if (/markdown\s*=\s*('|"){0,1}1('|"){0,1}/.test(atts)) state.md_inside = true;
      }
      stream.backUp(1);
      state.htmlState = CodeMirror.startState(htmlMode);
      return switchBlock(stream, state, htmlBlock);
    }

    if (ch === '<' && stream.match(/^\/\w*?>/)) {
      state.md_inside = false;
      return "tag";
    }

    var ignoreUnderscore = false;
    if (!modeCfg.underscoresBreakWords) {
      if (ch === '_' && stream.peek() !== '_' && stream.match(/(\w)/, false)) {
        var prevPos = stream.pos - 2;
        if (prevPos >= 0) {
          var prevCh = stream.string.charAt(prevPos);
          if (prevCh !== '_' && prevCh.match(/(\w)/, false)) {
            ignoreUnderscore = true;
          }
        }
      }
    }
    if (ch === '*' || (ch === '_' && !ignoreUnderscore)) {
      if (sol && stream.peek() === ' ') {
        // Do nothing, surrounded by newline and space
      } else if (state.strong === ch && stream.eat(ch)) { // Remove STRONG
        if (modeCfg.highlightFormatting) state.formatting = "strong";
        var t = getType(state);
        state.strong = false;
        return t;
      } else if (!state.strong && stream.eat(ch)) { // Add STRONG
        state.strong = ch;
        if (modeCfg.highlightFormatting) state.formatting = "strong";
        return getType(state);
      } else if (state.em === ch) { // Remove EM
        if (modeCfg.highlightFormatting) state.formatting = "em";
        var t = getType(state);
        state.em = false;
        return t;
      } else if (!state.em) { // Add EM
        state.em = ch;
        if (modeCfg.highlightFormatting) state.formatting = "em";
        return getType(state);
      }
    } else if (ch === ' ') {
      if (stream.eat('*') || stream.eat('_')) { // Probably surrounded by spaces
        if (stream.peek() === ' ') { // Surrounded by spaces, ignore
          return getType(state);
        } else { // Not surrounded by spaces, back up pointer
          stream.backUp(1);
        }
      }
    }

    if (modeCfg.strikethrough) {
      if (ch === '~' && stream.eatWhile(ch)) {
        if (state.strikethrough) {// Remove strikethrough
          if (modeCfg.highlightFormatting) state.formatting = "strikethrough";
          var t = getType(state);
          state.strikethrough = false;
          return t;
        } else if (stream.match(/^[^\s]/, false)) {// Add strikethrough
          state.strikethrough = true;
          if (modeCfg.highlightFormatting) state.formatting = "strikethrough";
          return getType(state);
        }
      } else if (ch === ' ') {
        if (stream.match(/^~~/, true)) { // Probably surrounded by space
          if (stream.peek() === ' ') { // Surrounded by spaces, ignore
            return getType(state);
          } else { // Not surrounded by spaces, back up pointer
            stream.backUp(2);
          }
        }
      }
    }

    if (ch === ' ') {
      if (stream.match(/ +$/, false)) {
        state.trailingSpace++;
      } else if (state.trailingSpace) {
        state.trailingSpaceNewLine = true;
      }
    }

    return getType(state);
  }

  function linkInline(stream, state) {
    var ch = stream.next();

    if (ch === ">") {
      state.f = state.inline = inlineNormal;
      if (modeCfg.highlightFormatting) state.formatting = "link";
      var type = getType(state);
      if (type){
        type += " ";
      } else {
        type = "";
      }
      return type + tokenTypes.linkInline;
    }

    stream.match(/^[^>]+/, true);

    return tokenTypes.linkInline;
  }

  function linkHref(stream, state) {
    // Check if space, and return NULL if so (to avoid marking the space)
    if(stream.eatSpace()){
      return null;
    }
    var ch = stream.next();
    if (ch === '(' || ch === '[') {
      state.f = state.inline = getLinkHrefInside(ch === "(" ? ")" : "]");
      if (modeCfg.highlightFormatting) state.formatting = "link-string";
      state.linkHref = true;
      return getType(state);
    }
    return 'error';
  }

  function getLinkHrefInside(endChar) {
    return function(stream, state) {
      var ch = stream.next();

      if (ch === endChar) {
        state.f = state.inline = inlineNormal;
        if (modeCfg.highlightFormatting) state.formatting = "link-string";
        var returnState = getType(state);
        state.linkHref = false;
        return returnState;
      }

      if (stream.match(inlineRE(endChar), true)) {
        stream.backUp(1);
      }

      state.linkHref = true;
      return getType(state);
    };
  }

  function footnoteLink(stream, state) {
    if (stream.match(/^([^\]\\]|\\.)*\]:/, false)) {
      state.f = footnoteLinkInside;
      stream.next(); // Consume [
      if (modeCfg.highlightFormatting) state.formatting = "link";
      state.linkText = true;
      return getType(state);
    }
    return switchInline(stream, state, inlineNormal);
  }

  function footnoteLinkInside(stream, state) {
    if (stream.match(/^\]:/, true)) {
      state.f = state.inline = footnoteUrl;
      if (modeCfg.highlightFormatting) state.formatting = "link";
      var returnType = getType(state);
      state.linkText = false;
      return returnType;
    }

    stream.match(/^([^\]\\]|\\.)+/, true);

    return tokenTypes.linkText;
  }

  function footnoteUrl(stream, state) {
    // Check if space, and return NULL if so (to avoid marking the space)
    if(stream.eatSpace()){
      return null;
    }
    // Match URL
    stream.match(/^[^\s]+/, true);
    // Check for link title
    if (stream.peek() === undefined) { // End of line, set flag to check next line
      state.linkTitle = true;
    } else { // More content on line, check if link title
      stream.match(/^(?:\s+(?:"(?:[^"\\]|\\\\|\\.)+"|'(?:[^'\\]|\\\\|\\.)+'|\((?:[^)\\]|\\\\|\\.)+\)))?/, true);
    }
    state.f = state.inline = inlineNormal;
    return tokenTypes.linkHref + " url";
  }

  var savedInlineRE = [];
  function inlineRE(endChar) {
    if (!savedInlineRE[endChar]) {
      // Escape endChar for RegExp (taken from http://stackoverflow.com/a/494122/526741)
      endChar = (endChar+'').replace(/([.?*+^$[\]\\(){}|-])/g, "\\$1");
      // Match any non-endChar, escaped character, as well as the closing
      // endChar.
      savedInlineRE[endChar] = new RegExp('^(?:[^\\\\]|\\\\.)*?(' + endChar + ')');
    }
    return savedInlineRE[endChar];
  }

  var mode = {
    startState: function() {
      return {
        f: blockNormal,

        prevLine: null,
        thisLine: null,

        block: blockNormal,
        htmlState: null,
        indentation: 0,

        inline: inlineNormal,
        text: handleText,

        formatting: false,
        linkText: false,
        linkHref: false,
        linkTitle: false,
        em: false,
        strong: false,
        header: 0,
        hr: false,
        taskList: false,
        list: false,
        listDepth: 0,
        quote: 0,
        trailingSpace: 0,
        trailingSpaceNewLine: false,
        strikethrough: false,
        fencedChars: null
      };
    },

    copyState: function(s) {
      return {
        f: s.f,

        prevLine: s.prevLine,
        thisLine: s.thisLine,

        block: s.block,
        htmlState: s.htmlState && CodeMirror.copyState(htmlMode, s.htmlState),
        indentation: s.indentation,

        localMode: s.localMode,
        localState: s.localMode ? CodeMirror.copyState(s.localMode, s.localState) : null,

        inline: s.inline,
        text: s.text,
        formatting: false,
        linkTitle: s.linkTitle,
        code: s.code,
        em: s.em,
        strong: s.strong,
        strikethrough: s.strikethrough,
        header: s.header,
        hr: s.hr,
        taskList: s.taskList,
        list: s.list,
        listDepth: s.listDepth,
        quote: s.quote,
        indentedCode: s.indentedCode,
        trailingSpace: s.trailingSpace,
        trailingSpaceNewLine: s.trailingSpaceNewLine,
        md_inside: s.md_inside,
        fencedChars: s.fencedChars
      };
    },

    token: function(stream, state) {

      // Reset state.formatting
      state.formatting = false;

      if (stream != state.thisLine) {
        var forceBlankLine = state.header || state.hr;

        // Reset state.header and state.hr
        state.header = 0;
        state.hr = false;

        if (stream.match(/^\s*$/, true) || forceBlankLine) {
          blankLine(state);
          if (!forceBlankLine) return null
          state.prevLine = null
        }

        state.prevLine = state.thisLine
        state.thisLine = stream

        // Reset state.taskList
        state.taskList = false;

        // Reset state.trailingSpace
        state.trailingSpace = 0;
        state.trailingSpaceNewLine = false;

        state.f = state.block;
        var indentation = stream.match(/^\s*/, true)[0].replace(/\t/g, '    ').length;
        var difference = Math.floor((indentation - state.indentation) / 4) * 4;
        if (difference > 4) difference = 4;
        var adjustedIndentation = state.indentation + difference;
        state.indentationDiff = adjustedIndentation - state.indentation;
        state.indentation = adjustedIndentation;
        if (indentation > 0) return null;
      }
      return state.f(stream, state);
    },

    innerMode: function(state) {
      if (state.block == htmlBlock) return {state: state.htmlState, mode: htmlMode};
      if (state.localState) return {state: state.localState, mode: state.localMode};
      return {state: state, mode: mode};
    },

    blankLine: blankLine,

    getType: getType,

    fold: "markdown"
  };
  return mode;
}, "xml");

CodeMirror.defineMIME("text/x-markdown", "markdown");

});

},{"../../lib/codemirror":2,"../meta":6,"../xml/xml":7}],6:[function(require,module,exports){
// CodeMirror, copyright (c) by Marijn Haverbeke and others
// Distributed under an MIT license: http://codemirror.net/LICENSE

(function(mod) {
  if (typeof exports == "object" && typeof module == "object") // CommonJS
    mod(require("../lib/codemirror"));
  else if (typeof define == "function" && define.amd) // AMD
    define(["../lib/codemirror"], mod);
  else // Plain browser env
    mod(CodeMirror);
})(function(CodeMirror) {
  "use strict";

  CodeMirror.modeInfo = [
    {name: "APL", mime: "text/apl", mode: "apl", ext: ["dyalog", "apl"]},
    {name: "PGP", mimes: ["application/pgp", "application/pgp-keys", "application/pgp-signature"], mode: "asciiarmor", ext: ["pgp"]},
    {name: "ASN.1", mime: "text/x-ttcn-asn", mode: "asn.1", ext: ["asn", "asn1"]},
    {name: "Asterisk", mime: "text/x-asterisk", mode: "asterisk", file: /^extensions\.conf$/i},
    {name: "Brainfuck", mime: "text/x-brainfuck", mode: "brainfuck", ext: ["b", "bf"]},
    {name: "C", mime: "text/x-csrc", mode: "clike", ext: ["c", "h"]},
    {name: "C++", mime: "text/x-c++src", mode: "clike", ext: ["cpp", "c++", "cc", "cxx", "hpp", "h++", "hh", "hxx"], alias: ["cpp"]},
    {name: "Cobol", mime: "text/x-cobol", mode: "cobol", ext: ["cob", "cpy"]},
    {name: "C#", mime: "text/x-csharp", mode: "clike", ext: ["cs"], alias: ["csharp"]},
    {name: "Clojure", mime: "text/x-clojure", mode: "clojure", ext: ["clj"]},
    {name: "ClojureScript", mime: "text/x-clojurescript", mode: "clojure", ext: ["cljs"]},
    {name: "Closure Stylesheets (GSS)", mime: "text/x-gss", mode: "css", ext: ["gss"]},
    {name: "CMake", mime: "text/x-cmake", mode: "cmake", ext: ["cmake", "cmake.in"], file: /^CMakeLists.txt$/},
    {name: "CoffeeScript", mime: "text/x-coffeescript", mode: "coffeescript", ext: ["coffee"], alias: ["coffee", "coffee-script"]},
    {name: "Common Lisp", mime: "text/x-common-lisp", mode: "commonlisp", ext: ["cl", "lisp", "el"], alias: ["lisp"]},
    {name: "Cypher", mime: "application/x-cypher-query", mode: "cypher", ext: ["cyp", "cypher"]},
    {name: "Cython", mime: "text/x-cython", mode: "python", ext: ["pyx", "pxd", "pxi"]},
    {name: "Crystal", mime: "text/x-crystal", mode: "crystal", ext: ["cr"]},
    {name: "CSS", mime: "text/css", mode: "css", ext: ["css"]},
    {name: "CQL", mime: "text/x-cassandra", mode: "sql", ext: ["cql"]},
    {name: "D", mime: "text/x-d", mode: "d", ext: ["d"]},
    {name: "Dart", mimes: ["application/dart", "text/x-dart"], mode: "dart", ext: ["dart"]},
    {name: "diff", mime: "text/x-diff", mode: "diff", ext: ["diff", "patch"]},
    {name: "Django", mime: "text/x-django", mode: "django"},
    {name: "Dockerfile", mime: "text/x-dockerfile", mode: "dockerfile", file: /^Dockerfile$/},
    {name: "DTD", mime: "application/xml-dtd", mode: "dtd", ext: ["dtd"]},
    {name: "Dylan", mime: "text/x-dylan", mode: "dylan", ext: ["dylan", "dyl", "intr"]},
    {name: "EBNF", mime: "text/x-ebnf", mode: "ebnf"},
    {name: "ECL", mime: "text/x-ecl", mode: "ecl", ext: ["ecl"]},
    {name: "Eiffel", mime: "text/x-eiffel", mode: "eiffel", ext: ["e"]},
    {name: "Elm", mime: "text/x-elm", mode: "elm", ext: ["elm"]},
    {name: "Embedded Javascript", mime: "application/x-ejs", mode: "htmlembedded", ext: ["ejs"]},
    {name: "Embedded Ruby", mime: "application/x-erb", mode: "htmlembedded", ext: ["erb"]},
    {name: "Erlang", mime: "text/x-erlang", mode: "erlang", ext: ["erl"]},
    {name: "Factor", mime: "text/x-factor", mode: "factor", ext: ["factor"]},
    {name: "Forth", mime: "text/x-forth", mode: "forth", ext: ["forth", "fth", "4th"]},
    {name: "Fortran", mime: "text/x-fortran", mode: "fortran", ext: ["f", "for", "f77", "f90"]},
    {name: "F#", mime: "text/x-fsharp", mode: "mllike", ext: ["fs"], alias: ["fsharp"]},
    {name: "Gas", mime: "text/x-gas", mode: "gas", ext: ["s"]},
    {name: "Gherkin", mime: "text/x-feature", mode: "gherkin", ext: ["feature"]},
    {name: "GitHub Flavored Markdown", mime: "text/x-gfm", mode: "gfm", file: /^(readme|contributing|history).md$/i},
    {name: "Go", mime: "text/x-go", mode: "go", ext: ["go"]},
    {name: "Groovy", mime: "text/x-groovy", mode: "groovy", ext: ["groovy"]},
    {name: "HAML", mime: "text/x-haml", mode: "haml", ext: ["haml"]},
    {name: "Haskell", mime: "text/x-haskell", mode: "haskell", ext: ["hs"]},
    {name: "Haskell (Literate)", mime: "text/x-literate-haskell", mode: "haskell-literate", ext: ["lhs"]},
    {name: "Haxe", mime: "text/x-haxe", mode: "haxe", ext: ["hx"]},
    {name: "HXML", mime: "text/x-hxml", mode: "haxe", ext: ["hxml"]},
    {name: "ASP.NET", mime: "application/x-aspx", mode: "htmlembedded", ext: ["aspx"], alias: ["asp", "aspx"]},
    {name: "HTML", mime: "text/html", mode: "htmlmixed", ext: ["html", "htm"], alias: ["xhtml"]},
    {name: "HTTP", mime: "message/http", mode: "http"},
    {name: "IDL", mime: "text/x-idl", mode: "idl", ext: ["pro"]},
    {name: "Jade", mime: "text/x-jade", mode: "jade", ext: ["jade"]},
    {name: "Java", mime: "text/x-java", mode: "clike", ext: ["java"]},
    {name: "Java Server Pages", mime: "application/x-jsp", mode: "htmlembedded", ext: ["jsp"], alias: ["jsp"]},
    {name: "JavaScript", mimes: ["text/javascript", "text/ecmascript", "application/javascript", "application/x-javascript", "application/ecmascript"],
     mode: "javascript", ext: ["js"], alias: ["ecmascript", "js", "node"]},
    {name: "JSON", mimes: ["application/json", "application/x-json"], mode: "javascript", ext: ["json", "map"], alias: ["json5"]},
    {name: "JSON-LD", mime: "application/ld+json", mode: "javascript", ext: ["jsonld"], alias: ["jsonld"]},
    {name: "JSX", mime: "text/jsx", mode: "jsx", ext: ["jsx"]},
    {name: "Jinja2", mime: "null", mode: "jinja2"},
    {name: "Julia", mime: "text/x-julia", mode: "julia", ext: ["jl"]},
    {name: "Kotlin", mime: "text/x-kotlin", mode: "clike", ext: ["kt"]},
    {name: "LESS", mime: "text/x-less", mode: "css", ext: ["less"]},
    {name: "LiveScript", mime: "text/x-livescript", mode: "livescript", ext: ["ls"], alias: ["ls"]},
    {name: "Lua", mime: "text/x-lua", mode: "lua", ext: ["lua"]},
    {name: "Markdown", mime: "text/x-markdown", mode: "markdown", ext: ["markdown", "md", "mkd"]},
    {name: "mIRC", mime: "text/mirc", mode: "mirc"},
    {name: "MariaDB SQL", mime: "text/x-mariadb", mode: "sql"},
    {name: "Mathematica", mime: "text/x-mathematica", mode: "mathematica", ext: ["m", "nb"]},
    {name: "Modelica", mime: "text/x-modelica", mode: "modelica", ext: ["mo"]},
    {name: "MUMPS", mime: "text/x-mumps", mode: "mumps"},
    {name: "MS SQL", mime: "text/x-mssql", mode: "sql"},
    {name: "MySQL", mime: "text/x-mysql", mode: "sql"},
    {name: "Nginx", mime: "text/x-nginx-conf", mode: "nginx", file: /nginx.*\.conf$/i},
    {name: "NSIS", mime: "text/x-nsis", mode: "nsis", ext: ["nsh", "nsi"]},
    {name: "NTriples", mime: "text/n-triples", mode: "ntriples", ext: ["nt"]},
    {name: "Objective C", mime: "text/x-objectivec", mode: "clike", ext: ["m", "mm"]},
    {name: "OCaml", mime: "text/x-ocaml", mode: "mllike", ext: ["ml", "mli", "mll", "mly"]},
    {name: "Octave", mime: "text/x-octave", mode: "octave", ext: ["m"]},
    {name: "Oz", mime: "text/x-oz", mode: "oz", ext: ["oz"]},
    {name: "Pascal", mime: "text/x-pascal", mode: "pascal", ext: ["p", "pas"]},
    {name: "PEG.js", mime: "null", mode: "pegjs", ext: ["jsonld"]},
    {name: "Perl", mime: "text/x-perl", mode: "perl", ext: ["pl", "pm"]},
    {name: "PHP", mime: "application/x-httpd-php", mode: "php", ext: ["php", "php3", "php4", "php5", "phtml"]},
    {name: "Pig", mime: "text/x-pig", mode: "pig", ext: ["pig"]},
    {name: "Plain Text", mime: "text/plain", mode: "null", ext: ["txt", "text", "conf", "def", "list", "log"]},
    {name: "PLSQL", mime: "text/x-plsql", mode: "sql", ext: ["pls"]},
    {name: "Properties files", mime: "text/x-properties", mode: "properties", ext: ["properties", "ini", "in"], alias: ["ini", "properties"]},
    {name: "Python", mime: "text/x-python", mode: "python", ext: ["py", "pyw"]},
    {name: "Puppet", mime: "text/x-puppet", mode: "puppet", ext: ["pp"]},
    {name: "Q", mime: "text/x-q", mode: "q", ext: ["q"]},
    {name: "R", mime: "text/x-rsrc", mode: "r", ext: ["r"], alias: ["rscript"]},
    {name: "reStructuredText", mime: "text/x-rst", mode: "rst", ext: ["rst"], alias: ["rst"]},
    {name: "RPM Changes", mime: "text/x-rpm-changes", mode: "rpm"},
    {name: "RPM Spec", mime: "text/x-rpm-spec", mode: "rpm", ext: ["spec"]},
    {name: "Ruby", mime: "text/x-ruby", mode: "ruby", ext: ["rb"], alias: ["jruby", "macruby", "rake", "rb", "rbx"]},
    {name: "Rust", mime: "text/x-rustsrc", mode: "rust", ext: ["rs"]},
    {name: "Sass", mime: "text/x-sass", mode: "sass", ext: ["sass"]},
    {name: "Scala", mime: "text/x-scala", mode: "clike", ext: ["scala"]},
    {name: "Scheme", mime: "text/x-scheme", mode: "scheme", ext: ["scm", "ss"]},
    {name: "SCSS", mime: "text/x-scss", mode: "css", ext: ["scss"]},
    {name: "Shell", mime: "text/x-sh", mode: "shell", ext: ["sh", "ksh", "bash"], alias: ["bash", "sh", "zsh"], file: /^PKGBUILD$/},
    {name: "Sieve", mime: "application/sieve", mode: "sieve", ext: ["siv", "sieve"]},
    {name: "Slim", mimes: ["text/x-slim", "application/x-slim"], mode: "slim", ext: ["slim"]},
    {name: "Smalltalk", mime: "text/x-stsrc", mode: "smalltalk", ext: ["st"]},
    {name: "Smarty", mime: "text/x-smarty", mode: "smarty", ext: ["tpl"]},
    {name: "Solr", mime: "text/x-solr", mode: "solr"},
    {name: "Soy", mime: "text/x-soy", mode: "soy", ext: ["soy"], alias: ["closure template"]},
    {name: "SPARQL", mime: "application/sparql-query", mode: "sparql", ext: ["rq", "sparql"], alias: ["sparul"]},
    {name: "Spreadsheet", mime: "text/x-spreadsheet", mode: "spreadsheet", alias: ["excel", "formula"]},
    {name: "SQL", mime: "text/x-sql", mode: "sql", ext: ["sql"]},
    {name: "Squirrel", mime: "text/x-squirrel", mode: "clike", ext: ["nut"]},
    {name: "Swift", mime: "text/x-swift", mode: "swift", ext: ["swift"]},
    {name: "MariaDB", mime: "text/x-mariadb", mode: "sql"},
    {name: "sTeX", mime: "text/x-stex", mode: "stex"},
    {name: "LaTeX", mime: "text/x-latex", mode: "stex", ext: ["text", "ltx"], alias: ["tex"]},
    {name: "SystemVerilog", mime: "text/x-systemverilog", mode: "verilog", ext: ["v"]},
    {name: "Tcl", mime: "text/x-tcl", mode: "tcl", ext: ["tcl"]},
    {name: "Textile", mime: "text/x-textile", mode: "textile", ext: ["textile"]},
    {name: "TiddlyWiki ", mime: "text/x-tiddlywiki", mode: "tiddlywiki"},
    {name: "Tiki wiki", mime: "text/tiki", mode: "tiki"},
    {name: "TOML", mime: "text/x-toml", mode: "toml", ext: ["toml"]},
    {name: "Tornado", mime: "text/x-tornado", mode: "tornado"},
    {name: "troff", mime: "troff", mode: "troff", ext: ["1", "2", "3", "4", "5", "6", "7", "8", "9"]},
    {name: "TTCN", mime: "text/x-ttcn", mode: "ttcn", ext: ["ttcn", "ttcn3", "ttcnpp"]},
    {name: "TTCN_CFG", mime: "text/x-ttcn-cfg", mode: "ttcn-cfg", ext: ["cfg"]},
    {name: "Turtle", mime: "text/turtle", mode: "turtle", ext: ["ttl"]},
    {name: "TypeScript", mime: "application/typescript", mode: "javascript", ext: ["ts"], alias: ["ts"]},
    {name: "Twig", mime: "text/x-twig", mode: "twig"},
    {name: "VB.NET", mime: "text/x-vb", mode: "vb", ext: ["vb"]},
    {name: "VBScript", mime: "text/vbscript", mode: "vbscript", ext: ["vbs"]},
    {name: "Velocity", mime: "text/velocity", mode: "velocity", ext: ["vtl"]},
    {name: "Verilog", mime: "text/x-verilog", mode: "verilog", ext: ["v"]},
    {name: "VHDL", mime: "text/x-vhdl", mode: "vhdl", ext: ["vhd", "vhdl"]},
    {name: "XML", mimes: ["application/xml", "text/xml"], mode: "xml", ext: ["xml", "xsl", "xsd"], alias: ["rss", "wsdl", "xsd"]},
    {name: "XQuery", mime: "application/xquery", mode: "xquery", ext: ["xy", "xquery"]},
    {name: "YAML", mime: "text/x-yaml", mode: "yaml", ext: ["yaml", "yml"], alias: ["yml"]},
    {name: "Z80", mime: "text/x-z80", mode: "z80", ext: ["z80"]},
    {name: "mscgen", mime: "text/x-mscgen", mode: "mscgen", ext: ["mscgen", "mscin", "msc"]},
    {name: "xu", mime: "text/x-xu", mode: "mscgen", ext: ["xu"]},
    {name: "msgenny", mime: "text/x-msgenny", mode: "mscgen", ext: ["msgenny"]}
  ];
  // Ensure all modes have a mime property for backwards compatibility
  for (var i = 0; i < CodeMirror.modeInfo.length; i++) {
    var info = CodeMirror.modeInfo[i];
    if (info.mimes) info.mime = info.mimes[0];
  }

  CodeMirror.findModeByMIME = function(mime) {
    mime = mime.toLowerCase();
    for (var i = 0; i < CodeMirror.modeInfo.length; i++) {
      var info = CodeMirror.modeInfo[i];
      if (info.mime == mime) return info;
      if (info.mimes) for (var j = 0; j < info.mimes.length; j++)
        if (info.mimes[j] == mime) return info;
    }
  };

  CodeMirror.findModeByExtension = function(ext) {
    for (var i = 0; i < CodeMirror.modeInfo.length; i++) {
      var info = CodeMirror.modeInfo[i];
      if (info.ext) for (var j = 0; j < info.ext.length; j++)
        if (info.ext[j] == ext) return info;
    }
  };

  CodeMirror.findModeByFileName = function(filename) {
    for (var i = 0; i < CodeMirror.modeInfo.length; i++) {
      var info = CodeMirror.modeInfo[i];
      if (info.file && info.file.test(filename)) return info;
    }
    var dot = filename.lastIndexOf(".");
    var ext = dot > -1 && filename.substring(dot + 1, filename.length);
    if (ext) return CodeMirror.findModeByExtension(ext);
  };

  CodeMirror.findModeByName = function(name) {
    name = name.toLowerCase();
    for (var i = 0; i < CodeMirror.modeInfo.length; i++) {
      var info = CodeMirror.modeInfo[i];
      if (info.name.toLowerCase() == name) return info;
      if (info.alias) for (var j = 0; j < info.alias.length; j++)
        if (info.alias[j].toLowerCase() == name) return info;
    }
  };
});

},{"../lib/codemirror":2}],7:[function(require,module,exports){
// CodeMirror, copyright (c) by Marijn Haverbeke and others
// Distributed under an MIT license: http://codemirror.net/LICENSE

(function(mod) {
  if (typeof exports == "object" && typeof module == "object") // CommonJS
    mod(require("../../lib/codemirror"));
  else if (typeof define == "function" && define.amd) // AMD
    define(["../../lib/codemirror"], mod);
  else // Plain browser env
    mod(CodeMirror);
})(function(CodeMirror) {
"use strict";

var htmlConfig = {
  autoSelfClosers: {'area': true, 'base': true, 'br': true, 'col': true, 'command': true,
                    'embed': true, 'frame': true, 'hr': true, 'img': true, 'input': true,
                    'keygen': true, 'link': true, 'meta': true, 'param': true, 'source': true,
                    'track': true, 'wbr': true, 'menuitem': true},
  implicitlyClosed: {'dd': true, 'li': true, 'optgroup': true, 'option': true, 'p': true,
                     'rp': true, 'rt': true, 'tbody': true, 'td': true, 'tfoot': true,
                     'th': true, 'tr': true},
  contextGrabbers: {
    'dd': {'dd': true, 'dt': true},
    'dt': {'dd': true, 'dt': true},
    'li': {'li': true},
    'option': {'option': true, 'optgroup': true},
    'optgroup': {'optgroup': true},
    'p': {'address': true, 'article': true, 'aside': true, 'blockquote': true, 'dir': true,
          'div': true, 'dl': true, 'fieldset': true, 'footer': true, 'form': true,
          'h1': true, 'h2': true, 'h3': true, 'h4': true, 'h5': true, 'h6': true,
          'header': true, 'hgroup': true, 'hr': true, 'menu': true, 'nav': true, 'ol': true,
          'p': true, 'pre': true, 'section': true, 'table': true, 'ul': true},
    'rp': {'rp': true, 'rt': true},
    'rt': {'rp': true, 'rt': true},
    'tbody': {'tbody': true, 'tfoot': true},
    'td': {'td': true, 'th': true},
    'tfoot': {'tbody': true},
    'th': {'td': true, 'th': true},
    'thead': {'tbody': true, 'tfoot': true},
    'tr': {'tr': true}
  },
  doNotIndent: {"pre": true},
  allowUnquoted: true,
  allowMissing: true,
  caseFold: true
}

var xmlConfig = {
  autoSelfClosers: {},
  implicitlyClosed: {},
  contextGrabbers: {},
  doNotIndent: {},
  allowUnquoted: false,
  allowMissing: false,
  caseFold: false
}

CodeMirror.defineMode("xml", function(editorConf, config_) {
  var indentUnit = editorConf.indentUnit
  var config = {}
  var defaults = config_.htmlMode ? htmlConfig : xmlConfig
  for (var prop in defaults) config[prop] = defaults[prop]
  for (var prop in config_) config[prop] = config_[prop]

  // Return variables for tokenizers
  var type, setStyle;

  function inText(stream, state) {
    function chain(parser) {
      state.tokenize = parser;
      return parser(stream, state);
    }

    var ch = stream.next();
    if (ch == "<") {
      if (stream.eat("!")) {
        if (stream.eat("[")) {
          if (stream.match("CDATA[")) return chain(inBlock("atom", "]]>"));
          else return null;
        } else if (stream.match("--")) {
          return chain(inBlock("comment", "-->"));
        } else if (stream.match("DOCTYPE", true, true)) {
          stream.eatWhile(/[\w\._\-]/);
          return chain(doctype(1));
        } else {
          return null;
        }
      } else if (stream.eat("?")) {
        stream.eatWhile(/[\w\._\-]/);
        state.tokenize = inBlock("meta", "?>");
        return "meta";
      } else {
        type = stream.eat("/") ? "closeTag" : "openTag";
        state.tokenize = inTag;
        return "tag bracket";
      }
    } else if (ch == "&") {
      var ok;
      if (stream.eat("#")) {
        if (stream.eat("x")) {
          ok = stream.eatWhile(/[a-fA-F\d]/) && stream.eat(";");
        } else {
          ok = stream.eatWhile(/[\d]/) && stream.eat(";");
        }
      } else {
        ok = stream.eatWhile(/[\w\.\-:]/) && stream.eat(";");
      }
      return ok ? "atom" : "error";
    } else {
      stream.eatWhile(/[^&<]/);
      return null;
    }
  }
  inText.isInText = true;

  function inTag(stream, state) {
    var ch = stream.next();
    if (ch == ">" || (ch == "/" && stream.eat(">"))) {
      state.tokenize = inText;
      type = ch == ">" ? "endTag" : "selfcloseTag";
      return "tag bracket";
    } else if (ch == "=") {
      type = "equals";
      return null;
    } else if (ch == "<") {
      state.tokenize = inText;
      state.state = baseState;
      state.tagName = state.tagStart = null;
      var next = state.tokenize(stream, state);
      return next ? next + " tag error" : "tag error";
    } else if (/[\'\"]/.test(ch)) {
      state.tokenize = inAttribute(ch);
      state.stringStartCol = stream.column();
      return state.tokenize(stream, state);
    } else {
      stream.match(/^[^\s\u00a0=<>\"\']*[^\s\u00a0=<>\"\'\/]/);
      return "word";
    }
  }

  function inAttribute(quote) {
    var closure = function(stream, state) {
      while (!stream.eol()) {
        if (stream.next() == quote) {
          state.tokenize = inTag;
          break;
        }
      }
      return "string";
    };
    closure.isInAttribute = true;
    return closure;
  }

  function inBlock(style, terminator) {
    return function(stream, state) {
      while (!stream.eol()) {
        if (stream.match(terminator)) {
          state.tokenize = inText;
          break;
        }
        stream.next();
      }
      return style;
    };
  }
  function doctype(depth) {
    return function(stream, state) {
      var ch;
      while ((ch = stream.next()) != null) {
        if (ch == "<") {
          state.tokenize = doctype(depth + 1);
          return state.tokenize(stream, state);
        } else if (ch == ">") {
          if (depth == 1) {
            state.tokenize = inText;
            break;
          } else {
            state.tokenize = doctype(depth - 1);
            return state.tokenize(stream, state);
          }
        }
      }
      return "meta";
    };
  }

  function Context(state, tagName, startOfLine) {
    this.prev = state.context;
    this.tagName = tagName;
    this.indent = state.indented;
    this.startOfLine = startOfLine;
    if (config.doNotIndent.hasOwnProperty(tagName) || (state.context && state.context.noIndent))
      this.noIndent = true;
  }
  function popContext(state) {
    if (state.context) state.context = state.context.prev;
  }
  function maybePopContext(state, nextTagName) {
    var parentTagName;
    while (true) {
      if (!state.context) {
        return;
      }
      parentTagName = state.context.tagName;
      if (!config.contextGrabbers.hasOwnProperty(parentTagName) ||
          !config.contextGrabbers[parentTagName].hasOwnProperty(nextTagName)) {
        return;
      }
      popContext(state);
    }
  }

  function baseState(type, stream, state) {
    if (type == "openTag") {
      state.tagStart = stream.column();
      return tagNameState;
    } else if (type == "closeTag") {
      return closeTagNameState;
    } else {
      return baseState;
    }
  }
  function tagNameState(type, stream, state) {
    if (type == "word") {
      state.tagName = stream.current();
      setStyle = "tag";
      return attrState;
    } else {
      setStyle = "error";
      return tagNameState;
    }
  }
  function closeTagNameState(type, stream, state) {
    if (type == "word") {
      var tagName = stream.current();
      if (state.context && state.context.tagName != tagName &&
          config.implicitlyClosed.hasOwnProperty(state.context.tagName))
        popContext(state);
      if (state.context && state.context.tagName == tagName) {
        setStyle = "tag";
        return closeState;
      } else {
        setStyle = "tag error";
        return closeStateErr;
      }
    } else {
      setStyle = "error";
      return closeStateErr;
    }
  }

  function closeState(type, _stream, state) {
    if (type != "endTag") {
      setStyle = "error";
      return closeState;
    }
    popContext(state);
    return baseState;
  }
  function closeStateErr(type, stream, state) {
    setStyle = "error";
    return closeState(type, stream, state);
  }

  function attrState(type, _stream, state) {
    if (type == "word") {
      setStyle = "attribute";
      return attrEqState;
    } else if (type == "endTag" || type == "selfcloseTag") {
      var tagName = state.tagName, tagStart = state.tagStart;
      state.tagName = state.tagStart = null;
      if (type == "selfcloseTag" ||
          config.autoSelfClosers.hasOwnProperty(tagName)) {
        maybePopContext(state, tagName);
      } else {
        maybePopContext(state, tagName);
        state.context = new Context(state, tagName, tagStart == state.indented);
      }
      return baseState;
    }
    setStyle = "error";
    return attrState;
  }
  function attrEqState(type, stream, state) {
    if (type == "equals") return attrValueState;
    if (!config.allowMissing) setStyle = "error";
    return attrState(type, stream, state);
  }
  function attrValueState(type, stream, state) {
    if (type == "string") return attrContinuedState;
    if (type == "word" && config.allowUnquoted) {setStyle = "string"; return attrState;}
    setStyle = "error";
    return attrState(type, stream, state);
  }
  function attrContinuedState(type, stream, state) {
    if (type == "string") return attrContinuedState;
    return attrState(type, stream, state);
  }

  return {
    startState: function(baseIndent) {
      var state = {tokenize: inText,
                   state: baseState,
                   indented: baseIndent || 0,
                   tagName: null, tagStart: null,
                   context: null}
      if (baseIndent != null) state.baseIndent = baseIndent
      return state
    },

    token: function(stream, state) {
      if (!state.tagName && stream.sol())
        state.indented = stream.indentation();

      if (stream.eatSpace()) return null;
      type = null;
      var style = state.tokenize(stream, state);
      if ((style || type) && style != "comment") {
        setStyle = null;
        state.state = state.state(type || style, stream, state);
        if (setStyle)
          style = setStyle == "error" ? style + " error" : setStyle;
      }
      return style;
    },

    indent: function(state, textAfter, fullLine) {
      var context = state.context;
      // Indent multi-line strings (e.g. css).
      if (state.tokenize.isInAttribute) {
        if (state.tagStart == state.indented)
          return state.stringStartCol + 1;
        else
          return state.indented + indentUnit;
      }
      if (context && context.noIndent) return CodeMirror.Pass;
      if (state.tokenize != inTag && state.tokenize != inText)
        return fullLine ? fullLine.match(/^(\s*)/)[0].length : 0;
      // Indent the starts of attribute names.
      if (state.tagName) {
        if (config.multilineTagIndentPastTag !== false)
          return state.tagStart + state.tagName.length + 2;
        else
          return state.tagStart + indentUnit * (config.multilineTagIndentFactor || 1);
      }
      if (config.alignCDATA && /<!\[CDATA\[/.test(textAfter)) return 0;
      var tagAfter = textAfter && /^<(\/)?([\w_:\.-]*)/.exec(textAfter);
      if (tagAfter && tagAfter[1]) { // Closing tag spotted
        while (context) {
          if (context.tagName == tagAfter[2]) {
            context = context.prev;
            break;
          } else if (config.implicitlyClosed.hasOwnProperty(context.tagName)) {
            context = context.prev;
          } else {
            break;
          }
        }
      } else if (tagAfter) { // Opening tag spotted
        while (context) {
          var grabbers = config.contextGrabbers[context.tagName];
          if (grabbers && grabbers.hasOwnProperty(tagAfter[2]))
            context = context.prev;
          else
            break;
        }
      }
      while (context && context.prev && !context.startOfLine)
        context = context.prev;
      if (context) return context.indent + indentUnit;
      else return state.baseIndent || 0;
    },

    electricInput: /<\/[\s\w:]+>$/,
    blockCommentStart: "<!--",
    blockCommentEnd: "-->",

    configuration: config.htmlMode ? "html" : "xml",
    helperType: config.htmlMode ? "html" : "xml",

    skipAttribute: function(state) {
      if (state.state == attrValueState)
        state.state = attrState
    }
  };
});

CodeMirror.defineMIME("text/xml", "xml");
CodeMirror.defineMIME("application/xml", "xml");
if (!CodeMirror.mimeModes.hasOwnProperty("text/html"))
  CodeMirror.defineMIME("text/html", {name: "xml", htmlMode: true});

});

},{"../../lib/codemirror":2}],8:[function(require,module,exports){
var app_1 = require("./app");
(function (NodeTypes) {
    NodeTypes[NodeTypes["ENTITY"] = 0] = "ENTITY";
    NodeTypes[NodeTypes["COLLECTION"] = 1] = "COLLECTION";
    NodeTypes[NodeTypes["ATTRIBUTE"] = 2] = "ATTRIBUTE";
    NodeTypes[NodeTypes["NUMBER"] = 3] = "NUMBER";
    NodeTypes[NodeTypes["STRING"] = 4] = "STRING";
    NodeTypes[NodeTypes["FUNCTION"] = 5] = "FUNCTION";
})(exports.NodeTypes || (exports.NodeTypes = {}));
var NodeTypes = exports.NodeTypes;
(function (Intents) {
    Intents[Intents["QUERY"] = 0] = "QUERY";
    Intents[Intents["INSERT"] = 1] = "INSERT";
    Intents[Intents["MOREINFO"] = 2] = "MOREINFO";
    Intents[Intents["NORESULT"] = 3] = "NORESULT";
})(exports.Intents || (exports.Intents = {}));
var Intents = exports.Intents;
// Entry point for NLQP
function parse(queryString, lastParse) {
    var tree;
    var context;
    var tokens;
    // If this is the first run, then create a root node.
    if (lastParse === undefined) {
        var rootToken = newToken("root");
        rootToken.properties.push(Properties.ROOT);
        tree = newNode(rootToken);
        tree.found = true;
        context = newContext();
        tokens = [rootToken];
    }
    else {
        tree = lastParse.tree;
        context = lastParse.context;
        tokens = lastParse.tokens;
    }
    // Now do something with the query string
    var words = normalizeQueryString(queryString);
    for (var _i = 0; _i < words.length; _i++) {
        var word = words[_i];
        // From a token
        var token = formToken(word);
        // Link new token with the rest
        var lastToken = tokens[tokens.length - 1];
        lastToken.next = token;
        token.prev = lastToken;
        tokens.push(token);
        // Add the token to the tree
        var node = newNode(token);
        var treeResult = formTree(node, tree, context);
        tree = treeResult.tree;
        context = treeResult.context;
    }
    // Manage context
    context.entities = context.found.filter(function (n) { return n.hasProperty(Properties.ENTITY) && !n.hasProperty(Properties.SUBSUMED) && !n.hasProperty(Properties.IMPLICIT); });
    context.collections = context.found.filter(function (n) { return n.hasProperty(Properties.COLLECTION) && !n.hasProperty(Properties.SUBSUMED) && !n.hasProperty(Properties.IMPLICIT); });
    context.attributes = context.found.filter(function (n) { return n.hasProperty(Properties.ATTRIBUTE) && !n.hasProperty(Properties.SUBSUMED) && !n.hasProperty(Properties.IMPLICIT); });
    context.maybeAttributes = context.maybeAttributes.filter(function (n) { return !n.hasProperty(Properties.SUBSUMED) && !n.found; });
    context.maybeCollections = context.maybeCollections.filter(function (n) { return !n.hasProperty(Properties.SUBSUMED) && !n.found; });
    context.maybeEntities = context.maybeEntities.filter(function (n) { return !n.hasProperty(Properties.SUBSUMED) && !n.found; });
    // Manage results
    var intent = Intents.NORESULT;
    var query = newQuery();
    var insertResults = [];
    if (allFound(tree)) {
        var inserts = context.internalFxns.filter(function (f) { return f.fxn.type === FunctionTypes.INSERT; });
        if (inserts.length > 0) {
            intent = Intents.INSERT;
            // Format each insert
            for (var _a = 0; _a < inserts.length; _a++) {
                var insert = inserts[_a];
                if (insert.children.every(function (c) { return c.found; })) {
                    // Collapse the result root if every node doesn't have a child
                    if (insert.children[2].children.length > 1 && insert.children[2].children.every(function (c) { return c.children.length === 0; })) {
                        var nName = insert.children[2].children.map(function (c) { return c.name; }).join(" ");
                        var nToken = newToken(nName);
                        var nNode = newNode(nToken);
                        nNode.found = true;
                        nNode.type = NodeTypes.STRING;
                        insert.children[2].children.map(removeNode);
                        insert.children[2].addChild(nNode);
                    }
                    var insertResult = {
                        entity: insert.children[0].children[0],
                        attribute: insert.children[1].children[0],
                        value: insert.children[2].children[0],
                    };
                    insertResults.push(insertResult);
                }
            }
        }
        else if (context.maybeAttributes.length > 0) {
            intent = Intents.MOREINFO;
        }
        else if (context.found.length > 1 &&
            ((context.attributes.filter(function (a) { return a.attribute.refs === undefined && !a.parent.hasProperty(Properties.ARGUMENT); }).length > 0) ||
                (context.collections.filter(function (c) { return c.relationships.length === 0; }).length > 0))) {
            intent = Intents.NORESULT;
        }
        else {
            intent = Intents.QUERY;
        }
    }
    if (intent === Intents.QUERY) {
        // Create the query from the new tree
        intent = Intents.QUERY;
        log("Building query...");
        query = formQuery(tree);
        if (query.projects.length === 0) {
            intent = Intents.NORESULT;
            query = newQuery();
        }
    }
    return [{ intent: intent, context: context, tokens: tokens, tree: tree, query: query, inserts: insertResults }];
}
exports.parse = parse;
// Returns false if any nodes are not marked found
// Returns true if all nodes are marked found
function treeComplete(node) {
    if (node.found === false) {
        return false;
    }
    else {
        var childrenStatus = node.children.map(treeComplete);
        return childrenStatus.every(function (child) { return child === true; });
    }
}
// Performs some transformations to the query string before tokenizing
function normalizeQueryString(queryString) {
    // Add whitespace before and after separator and operators
    var normalizedQueryString = queryString.replace(/,/g, ' , ');
    normalizedQueryString = normalizedQueryString.replace(/;/g, ' ; ');
    normalizedQueryString = normalizedQueryString.replace(/\+/g, ' + ');
    normalizedQueryString = normalizedQueryString.replace(/\^/g, ' ^ ');
    normalizedQueryString = normalizedQueryString.replace(/-/g, ' - ');
    normalizedQueryString = normalizedQueryString.replace(/\*/g, ' * ');
    normalizedQueryString = normalizedQueryString.replace(/\//g, ' / ');
    normalizedQueryString = normalizedQueryString.replace(/"/g, ' " ');
    // Split possessive endings
    normalizedQueryString = normalizedQueryString.replace(/\'s/g, ' \'s ');
    normalizedQueryString = normalizedQueryString.replace(/s'/g, 's \' ');
    // Clean various symbols we don't want to deal with
    normalizedQueryString = normalizedQueryString.replace(/`|\?|\:|\[|\]|\{|\}|\(|\)|\~|\`|~|@|#|\$|%|&|_|\|/g, ' ');
    // Collapse whitespace   
    normalizedQueryString = normalizedQueryString.replace(/\s+/g, ' ');
    // Split words at whitespace
    var splitStrings = normalizedQueryString.split(" ");
    var words = splitStrings.map(function (text, i) { return { ix: i + 1, text: text }; });
    words = words.filter(function (word) { return word.text !== ""; });
    return words;
}
exports.normalizeQueryString = normalizeQueryString;
function normalizeString(queryString) {
    // Add whitespace before and after separator and operators
    var normalized = queryString.replace(/,/g, ' , ');
    normalized = normalized.replace(/;/g, ' ; ');
    normalized = normalized.replace(/\+/g, ' + ');
    normalized = normalized.replace(/\^/g, ' ^ ');
    normalized = normalized.replace(/-/g, ' - ');
    normalized = normalized.replace(/\*/g, ' * ');
    normalized = normalized.replace(/\//g, ' / ');
    normalized = normalized.replace(/"/g, ' " ');
    // Split possessive endings
    normalized = normalized.replace(/\'s/g, ' \'s ');
    normalized = normalized.replace(/s'/g, 's \' ');
    // Clean various symbols we don't want to deal with
    normalized = normalized.replace(/`|\?|\:|\[|\]|\{|\}|\(|\)|\~|\`|~|@|#|\$|%|&|_|\|/g, ' ');
    // Collapse whitespace   
    normalized = normalized.replace(/\s+/g, ' ');
    normalized = normalized.toLowerCase();
    normalized = singularize(normalized);
    return normalized;
}
exports.normalizeString = normalizeString;
// ----------------------------------------------------------------------------
// Token functions
// ----------------------------------------------------------------------------
var MajorPartsOfSpeech;
(function (MajorPartsOfSpeech) {
    MajorPartsOfSpeech[MajorPartsOfSpeech["ROOT"] = 0] = "ROOT";
    MajorPartsOfSpeech[MajorPartsOfSpeech["VERB"] = 1] = "VERB";
    MajorPartsOfSpeech[MajorPartsOfSpeech["ADJECTIVE"] = 2] = "ADJECTIVE";
    MajorPartsOfSpeech[MajorPartsOfSpeech["ADVERB"] = 3] = "ADVERB";
    MajorPartsOfSpeech[MajorPartsOfSpeech["NOUN"] = 4] = "NOUN";
    MajorPartsOfSpeech[MajorPartsOfSpeech["VALUE"] = 5] = "VALUE";
    MajorPartsOfSpeech[MajorPartsOfSpeech["GLUE"] = 6] = "GLUE";
    MajorPartsOfSpeech[MajorPartsOfSpeech["WHWORD"] = 7] = "WHWORD";
    MajorPartsOfSpeech[MajorPartsOfSpeech["SYMBOL"] = 8] = "SYMBOL";
})(MajorPartsOfSpeech || (MajorPartsOfSpeech = {}));
var MinorPartsOfSpeech;
(function (MinorPartsOfSpeech) {
    MinorPartsOfSpeech[MinorPartsOfSpeech["ROOT"] = 0] = "ROOT";
    // Verb
    MinorPartsOfSpeech[MinorPartsOfSpeech["VB"] = 1] = "VB";
    MinorPartsOfSpeech[MinorPartsOfSpeech["VBD"] = 2] = "VBD";
    MinorPartsOfSpeech[MinorPartsOfSpeech["VBN"] = 3] = "VBN";
    MinorPartsOfSpeech[MinorPartsOfSpeech["VBP"] = 4] = "VBP";
    MinorPartsOfSpeech[MinorPartsOfSpeech["VBZ"] = 5] = "VBZ";
    MinorPartsOfSpeech[MinorPartsOfSpeech["VBF"] = 6] = "VBF";
    MinorPartsOfSpeech[MinorPartsOfSpeech["CP"] = 7] = "CP";
    MinorPartsOfSpeech[MinorPartsOfSpeech["VBG"] = 8] = "VBG";
    // Adjective
    MinorPartsOfSpeech[MinorPartsOfSpeech["JJ"] = 9] = "JJ";
    MinorPartsOfSpeech[MinorPartsOfSpeech["JJR"] = 10] = "JJR";
    MinorPartsOfSpeech[MinorPartsOfSpeech["JJS"] = 11] = "JJS";
    // Adverb
    MinorPartsOfSpeech[MinorPartsOfSpeech["RB"] = 12] = "RB";
    MinorPartsOfSpeech[MinorPartsOfSpeech["RBR"] = 13] = "RBR";
    MinorPartsOfSpeech[MinorPartsOfSpeech["RBS"] = 14] = "RBS";
    // Noun
    MinorPartsOfSpeech[MinorPartsOfSpeech["NN"] = 15] = "NN";
    MinorPartsOfSpeech[MinorPartsOfSpeech["NNPA"] = 16] = "NNPA";
    MinorPartsOfSpeech[MinorPartsOfSpeech["NNAB"] = 17] = "NNAB";
    MinorPartsOfSpeech[MinorPartsOfSpeech["NG"] = 18] = "NG";
    MinorPartsOfSpeech[MinorPartsOfSpeech["PRP"] = 19] = "PRP";
    MinorPartsOfSpeech[MinorPartsOfSpeech["PP"] = 20] = "PP";
    // Legacy Noun
    MinorPartsOfSpeech[MinorPartsOfSpeech["NNP"] = 21] = "NNP";
    MinorPartsOfSpeech[MinorPartsOfSpeech["NNPS"] = 22] = "NNPS";
    MinorPartsOfSpeech[MinorPartsOfSpeech["NNO"] = 23] = "NNO";
    MinorPartsOfSpeech[MinorPartsOfSpeech["NNS"] = 24] = "NNS";
    MinorPartsOfSpeech[MinorPartsOfSpeech["NNA"] = 25] = "NNA";
    MinorPartsOfSpeech[MinorPartsOfSpeech["NNQ"] = 26] = "NNQ";
    // Glue
    MinorPartsOfSpeech[MinorPartsOfSpeech["FW"] = 27] = "FW";
    MinorPartsOfSpeech[MinorPartsOfSpeech["IN"] = 28] = "IN";
    MinorPartsOfSpeech[MinorPartsOfSpeech["MD"] = 29] = "MD";
    MinorPartsOfSpeech[MinorPartsOfSpeech["CC"] = 30] = "CC";
    MinorPartsOfSpeech[MinorPartsOfSpeech["PDT"] = 31] = "PDT";
    MinorPartsOfSpeech[MinorPartsOfSpeech["DT"] = 32] = "DT";
    MinorPartsOfSpeech[MinorPartsOfSpeech["UH"] = 33] = "UH";
    MinorPartsOfSpeech[MinorPartsOfSpeech["EX"] = 34] = "EX";
    // Value
    MinorPartsOfSpeech[MinorPartsOfSpeech["CD"] = 35] = "CD";
    MinorPartsOfSpeech[MinorPartsOfSpeech["DA"] = 36] = "DA";
    MinorPartsOfSpeech[MinorPartsOfSpeech["NU"] = 37] = "NU";
    // Symbol
    MinorPartsOfSpeech[MinorPartsOfSpeech["LT"] = 38] = "LT";
    MinorPartsOfSpeech[MinorPartsOfSpeech["GT"] = 39] = "GT";
    MinorPartsOfSpeech[MinorPartsOfSpeech["GTE"] = 40] = "GTE";
    MinorPartsOfSpeech[MinorPartsOfSpeech["LTE"] = 41] = "LTE";
    MinorPartsOfSpeech[MinorPartsOfSpeech["EQ"] = 42] = "EQ";
    MinorPartsOfSpeech[MinorPartsOfSpeech["NEQ"] = 43] = "NEQ";
    MinorPartsOfSpeech[MinorPartsOfSpeech["PLUS"] = 44] = "PLUS";
    MinorPartsOfSpeech[MinorPartsOfSpeech["MINUS"] = 45] = "MINUS";
    MinorPartsOfSpeech[MinorPartsOfSpeech["DIV"] = 46] = "DIV";
    MinorPartsOfSpeech[MinorPartsOfSpeech["MUL"] = 47] = "MUL";
    MinorPartsOfSpeech[MinorPartsOfSpeech["POW"] = 48] = "POW";
    MinorPartsOfSpeech[MinorPartsOfSpeech["SEP"] = 49] = "SEP";
    MinorPartsOfSpeech[MinorPartsOfSpeech["POS"] = 50] = "POS";
    // Wh- word
    MinorPartsOfSpeech[MinorPartsOfSpeech["WDT"] = 51] = "WDT";
    MinorPartsOfSpeech[MinorPartsOfSpeech["WP"] = 52] = "WP";
    MinorPartsOfSpeech[MinorPartsOfSpeech["WPO"] = 53] = "WPO";
    MinorPartsOfSpeech[MinorPartsOfSpeech["WRB"] = 54] = "WRB"; // Wh-adverb (however whenever where why)
})(MinorPartsOfSpeech || (MinorPartsOfSpeech = {}));
function newToken(text) {
    var token = formToken({ ix: 0, text: text });
    token.properties.push(Properties.IMPLICIT);
    return token;
}
function cloneToken(token) {
    var clone = {
        ix: token.ix,
        originalWord: token.originalWord,
        normalizedWord: token.normalizedWord,
        POS: token.POS,
        properties: [],
    };
    token.properties.map(function (property) { return clone.properties.push(property); });
    return clone;
}
var Properties;
(function (Properties) {
    // Node properties
    Properties[Properties["ROOT"] = 0] = "ROOT";
    // EVE types
    Properties[Properties["COLLECTION"] = 1] = "COLLECTION";
    Properties[Properties["ENTITY"] = 2] = "ENTITY";
    Properties[Properties["ATTRIBUTE"] = 3] = "ATTRIBUTE";
    Properties[Properties["FUNCTION"] = 4] = "FUNCTION";
    Properties[Properties["QUANTITY"] = 5] = "QUANTITY";
    Properties[Properties["STRING"] = 6] = "STRING";
    // Function properties  
    Properties[Properties["OUTPUT"] = 7] = "OUTPUT";
    Properties[Properties["INPUT"] = 8] = "INPUT";
    Properties[Properties["ARGUMENT"] = 9] = "ARGUMENT";
    Properties[Properties["AGGREGATE"] = 10] = "AGGREGATE";
    Properties[Properties["CALCULATE"] = 11] = "CALCULATE";
    Properties[Properties["OPERATOR"] = 12] = "OPERATOR";
    // Token properties
    Properties[Properties["PROPER"] = 13] = "PROPER";
    Properties[Properties["PLURAL"] = 14] = "PLURAL";
    Properties[Properties["POSSESSIVE"] = 15] = "POSSESSIVE";
    Properties[Properties["BACKRELATIONSHIP"] = 16] = "BACKRELATIONSHIP";
    Properties[Properties["COMPARATIVE"] = 17] = "COMPARATIVE";
    Properties[Properties["SUPERLATIVE"] = 18] = "SUPERLATIVE";
    Properties[Properties["PRONOUN"] = 19] = "PRONOUN";
    Properties[Properties["SEPARATOR"] = 20] = "SEPARATOR";
    Properties[Properties["CONJUNCTION"] = 21] = "CONJUNCTION";
    Properties[Properties["QUOTED"] = 22] = "QUOTED";
    Properties[Properties["SETTER"] = 23] = "SETTER";
    Properties[Properties["SUBSUMED"] = 24] = "SUBSUMED";
    Properties[Properties["COMPOUND"] = 25] = "COMPOUND";
    // Modifiers
    Properties[Properties["NEGATES"] = 26] = "NEGATES";
    Properties[Properties["GROUPING"] = 27] = "GROUPING";
    Properties[Properties["IMPLICIT"] = 28] = "IMPLICIT";
    Properties[Properties["STOPPARSE"] = 29] = "STOPPARSE";
})(Properties || (Properties = {}));
// take an input string, extract tokens
function formToken(word) {
    // Every word is tagged a noun unless some rule says otherwise
    var POS = MinorPartsOfSpeech.NN;
    var properties = [];
    var originalWord = word.text;
    var normalizedWord = originalWord;
    var found = false;
    var upperCaseLetters = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z'];
    var lowerCaseLetters = ['a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n', 'o', 'p', 'q', 'r', 's', 't', 'u', 'v', 'w', 'x', 'y', 'z'];
    var digits = ['1', '2', '3', '4', '5', '6', '7', '8', '9', '0'];
    var separators = [',', ':', ';', '"'];
    var operators = ['+', '-', '*', '/', '^'];
    var comparators = ['>', '>=', '<', '<=', '=', '!='];
    // Most of the following vectors were taken from NLP Compromise
    // https://github.com/nlp-compromise/nlp_compromise
    // Copyright (c) 2016 Spencer Kelly: 
    // Licensed under the MIT License: https://github.com/nlp-compromise/nlp_compromise/blob/master/LICENSE.txt
    var preDeterminers = ['all'];
    var determiners = ['this', 'any', 'enough', 'each', 'every', 'these', 'another', 'plenty', 'whichever', 'neither', 'an', 'a', 'least', 'own', 'few', 'both', 'those', 'the', 'that', 'various', 'what', 'either', 'much', 'some', 'else', 'no'];
    var copulae = ['am', 'is', 'are', 'was', 'were', 'as', 'am', 'be', 'has', 'become', 'became', 'seemed', 'seems', 'seeming'];
    var conjunctions = ['yet', 'therefore', 'or', 'while', 'nor', 'whether', 'though', 'because', 'but', 'for', 'and', 'if', 'before', 'although', 'plus', 'versus', 'not'];
    var prepositions = ['with', 'until', 'onto', 'of', 'into', 'out', 'except', 'across', 'by', 'between', 'at', 'down', 'as', 'from', 'around', 'among', 'upon', 'amid', 'to', 'along', 'since', 'about', 'off', 'on', 'within', 'in', 'during', 'per', 'without', 'throughout', 'through', 'than', 'via', 'up', 'unlike', 'despite', 'below', 'unless', 'towards', 'besides', 'after', 'whereas', 'amongst', 'atop', 'barring', 'circa', 'mid', 'midst', 'notwithstanding', 'sans', 'thru', 'till', 'versus'];
    var possessivePronouns = ['mine', 'something', 'none', 'anything', 'anyone', 'theirs', 'himself', 'ours', 'his', 'my', 'their', 'yours', 'your', 'our', 'its', 'nothing', 'herself', 'hers', 'themselves', 'everything', 'myself', 'itself', 'her'];
    var personalPronouns = ['it', 'they', 'i', 'them', 'you', 'she', 'me', 'he', 'him', 'ourselves', 'us', 'we', 'yourself'];
    var modals = ['can', 'may', 'could', 'might', 'will', 'would', 'must', 'shall', 'should', 'ought'];
    var whPronouns = ['who', 'what', 'whom'];
    var whDeterminers = ['whatever', 'which'];
    var whPossessivePronoun = ['whose'];
    var whAdverbs = ['how', 'when', 'however', 'whenever', 'where', 'why'];
    var verbs = ['have', 'do'];
    var adverbs = ['there'];
    // We have three cases: the word is a symbol (of which there are various kinds), a number, or a string
    // ----------------------
    // Case 1: handle symbols
    // ----------------------
    if (!found) {
        if (operators.indexOf(originalWord) >= 0) {
            found = true;
            properties.push(Properties.OPERATOR);
            switch (originalWord) {
                case "+":
                    POS = MinorPartsOfSpeech.PLUS;
                    break;
                case "-":
                    POS = MinorPartsOfSpeech.MINUS;
                    break;
                case "*":
                    POS = MinorPartsOfSpeech.MUL;
                    break;
                case "/":
                    POS = MinorPartsOfSpeech.DIV;
                    break;
                case "^":
                    POS = MinorPartsOfSpeech.POW;
                    break;
            }
        }
        else if (comparators.indexOf(originalWord) >= 0) {
            found = true;
            properties.push(Properties.COMPARATIVE);
            switch (originalWord) {
                case ">":
                    POS = MinorPartsOfSpeech.GT;
                    break;
                case ">=":
                    POS = MinorPartsOfSpeech.GTE;
                    break;
                case "<":
                    POS = MinorPartsOfSpeech.LT;
                    break;
                case "<=":
                    POS = MinorPartsOfSpeech.LTE;
                    break;
                case "=":
                    POS = MinorPartsOfSpeech.EQ;
                    break;
                case "!=":
                    POS = MinorPartsOfSpeech.NEQ;
                    break;
            }
        }
        else if (separators.indexOf(originalWord) >= 0) {
            found = true;
            properties.push(Properties.SEPARATOR);
            POS = MinorPartsOfSpeech.SEP;
            if (originalWord === "\"") {
                properties.push(Properties.QUOTED);
            }
        }
        else if (originalWord === "'s" || originalWord === "'") {
            properties.push(Properties.POSSESSIVE);
            POS = MinorPartsOfSpeech.POS;
        }
    }
    // ----------------------
    // Case 2: handle numbers
    // ----------------------
    if (!found) {
        if (digits.indexOf(originalWord[0]) >= 0 && isNumeric(originalWord)) {
            found = true;
            properties.push(Properties.QUANTITY);
            POS = MinorPartsOfSpeech.NU;
        }
    }
    // ----------------------
    // Case 3: handle strings
    // ----------------------
    if (!found) {
        // Normalize the word
        normalizedWord = normalizedWord.toLowerCase();
        var before = normalizedWord;
        normalizedWord = singularize(normalizedWord);
        if (before !== normalizedWord) {
            properties.push(Properties.PLURAL);
        }
        // Find the POS in the dictionary, apply some properties based on the word
        // Determiners
        if (determiners.indexOf(normalizedWord) >= 0) {
            POS = MinorPartsOfSpeech.DT;
        }
        else if (modals.indexOf(normalizedWord) >= 0) {
            POS = MinorPartsOfSpeech.MD;
        }
        else if (preDeterminers.indexOf(normalizedWord) >= 0) {
            POS = MinorPartsOfSpeech.PDT;
        }
        else if (copulae.indexOf(normalizedWord) >= 0) {
            POS = MinorPartsOfSpeech.CP;
        }
        else if (prepositions.indexOf(normalizedWord) >= 0) {
            POS = MinorPartsOfSpeech.IN;
        }
        else if (personalPronouns.indexOf(normalizedWord) >= 0) {
            POS = MinorPartsOfSpeech.PRP;
            properties.push(Properties.PRONOUN);
        }
        else if (possessivePronouns.indexOf(normalizedWord) >= 0) {
            POS = MinorPartsOfSpeech.PRP;
            properties.push(Properties.PRONOUN);
            properties.push(Properties.POSSESSIVE);
        }
        else if (conjunctions.indexOf(normalizedWord) >= 0) {
            POS = MinorPartsOfSpeech.CC;
            properties.push(Properties.CONJUNCTION);
        }
        else if (whPronouns.indexOf(normalizedWord) >= 0) {
            POS = MinorPartsOfSpeech.WP;
        }
        else if (whDeterminers.indexOf(normalizedWord) >= 0) {
            POS = MinorPartsOfSpeech.WDT;
        }
        else if (whAdverbs.indexOf(normalizedWord) >= 0) {
            POS = MinorPartsOfSpeech.WRB;
        }
        else if (whPossessivePronoun.indexOf(normalizedWord) >= 0) {
            POS = MinorPartsOfSpeech.WPO;
            properties.push(Properties.POSSESSIVE);
        }
        else if (verbs.indexOf(normalizedWord) >= 0) {
            POS = MinorPartsOfSpeech.VB;
        }
        else if (adverbs.indexOf(normalizedWord) >= 0) {
            POS = MinorPartsOfSpeech.RB;
        }
        // Set grouping property
        var groupingWords = ['per', 'by'];
        var negatingWords = ['except', 'without', 'sans', 'not', 'nor', 'neither', 'no'];
        var pluralWords = ['their'];
        if (groupingWords.indexOf(normalizedWord) >= 0) {
            properties.push(Properties.GROUPING);
        }
        else if (negatingWords.indexOf(normalizedWord) >= 0) {
            properties.push(Properties.NEGATES);
        }
        else if (pluralWords.indexOf(normalizedWord) >= 0) {
            properties.push(Properties.PLURAL);
        }
        // If the word is still a noun, if it is upper case than it is a proper noun 
        if (getMajorPOS(POS) === MajorPartsOfSpeech.NOUN) {
            if (upperCaseLetters.indexOf(originalWord[0]) >= 0) {
                properties.push(Properties.PROPER);
            }
        }
    }
    // Build the token
    var token = {
        ix: word.ix,
        originalWord: word.text,
        normalizedWord: normalizedWord,
        POS: POS,
        properties: properties,
    };
    return token;
}
function getMajorPOS(minorPartOfSpeech) {
    // ROOT
    if (minorPartOfSpeech === MinorPartsOfSpeech.ROOT) {
        return MajorPartsOfSpeech.ROOT;
    }
    // Verb
    var verbs = ['VB', 'VBD', 'VBN', 'VBP', 'VBZ', 'VBF', 'VBG'];
    if (verbs.indexOf(MinorPartsOfSpeech[minorPartOfSpeech]) >= 0) {
        return MajorPartsOfSpeech.VERB;
    }
    // Adjective
    var adjectives = ['JJ', 'JJR', 'JJS'];
    if (adjectives.indexOf(MinorPartsOfSpeech[minorPartOfSpeech]) >= 0) {
        return MajorPartsOfSpeech.ADJECTIVE;
    }
    // Adverb
    var adverbs = ['RB', 'RBR', 'RBS'];
    if (adverbs.indexOf(MinorPartsOfSpeech[minorPartOfSpeech]) >= 0) {
        return MajorPartsOfSpeech.ADVERB;
    }
    // Noun
    var nouns = ['NN', 'NNA', 'NNPA', 'NNAB', 'NNP', 'NNPS', 'NNS', 'NNQ', 'NNO', 'NG', 'PRP', 'PP'];
    if (nouns.indexOf(MinorPartsOfSpeech[minorPartOfSpeech]) >= 0) {
        return MajorPartsOfSpeech.NOUN;
    }
    // Value
    var values = ['CD', 'DA', 'NU'];
    if (values.indexOf(MinorPartsOfSpeech[minorPartOfSpeech]) >= 0) {
        return MajorPartsOfSpeech.VALUE;
    }
    // Glue
    var glues = ['FW', 'IN', 'CP', 'MD', 'CC', 'PDT', 'DT', 'UH', 'EX'];
    if (glues.indexOf(MinorPartsOfSpeech[minorPartOfSpeech]) >= 0) {
        return MajorPartsOfSpeech.GLUE;
    }
    // Symbol
    var symbols = ['LT', 'GT', 'LTE', 'GTE', 'EQ', 'NEQ',
        'PLUS', 'MINUS', 'DIV', 'MUL', 'POW',
        'SEP', 'POS'];
    if (symbols.indexOf(MinorPartsOfSpeech[minorPartOfSpeech]) >= 0) {
        return MajorPartsOfSpeech.SYMBOL;
    }
    // Wh-Word
    var whWords = ['WDT', 'WP', 'WPO', 'WRB'];
    if (whWords.indexOf(MinorPartsOfSpeech[minorPartOfSpeech]) >= 0) {
        return MajorPartsOfSpeech.WHWORD;
    }
}
// Wrap pluralize to special case certain words it gets wrong
// @HACK data singularizes to datum, which is correct, but we
// have a collection called test data, which NLQP turns into test datum
function singularize(word) {
    // split word at spaces
    var words = word.split(" ");
    if (words.length === 1) {
        var specialCases = ["his", "times", "has", "downstairs", "its", "'s", "data", "are", "was"];
        for (var _i = 0; _i < specialCases.length; _i++) {
            var specialCase = specialCases[_i];
            if (specialCase === word) {
                return word;
            }
        }
        return pluralize(word, 1);
    }
    return words.map(singularize).join(" ");
}
exports.singularize = singularize;
function cloneNode(node) {
    var token = cloneToken(node.token);
    var cloneNode = newNode(token);
    cloneNode.entity = node.entity;
    cloneNode.collection = node.collection;
    cloneNode.attribute = node.attribute;
    cloneNode.fxn = node.fxn;
    cloneNode.found = node.found;
    node.properties.map(function (property) { return cloneNode.properties.push(property); });
    return cloneNode;
}
function newNode(token) {
    var node = {
        ix: token.ix,
        name: token.normalizedWord,
        parent: undefined,
        children: [],
        token: token,
        properties: token.properties,
        relationships: [],
        representations: {
            entity: undefined,
            collection: undefined,
            attribute: undefined,
            fxn: undefined,
        },
        found: false,
        foundReps: false,
        hasProperty: hasProperty,
        toString: nodeToString,
        next: nextNode,
        prev: previousNode,
        addChild: addChild,
    };
    token.node = node;
    function hasProperty(property) {
        var found = node.properties.indexOf(property);
        if (found !== -1) {
            return true;
        }
        else {
            return false;
        }
    }
    function nextNode() {
        var token = node.token;
        var nextToken = token.next;
        if (nextToken !== undefined) {
            return nextToken.node;
        }
        return undefined;
    }
    function previousNode() {
        var token = node.token;
        var prevToken = token.prev;
        if (prevToken !== undefined) {
            return prevToken.node;
        }
        return undefined;
    }
    function addChild(newChild) {
        node.children.push(newChild);
        newChild.parent = node;
    }
    function nodeToString(depth) {
        if (depth === undefined) {
            depth = 0;
        }
        var childrenStrings = node.children.map(function (childNode) { return childNode.toString(depth + 1); }).join("\n");
        var children = childrenStrings.length > 0 ? "\n" + childrenStrings : "";
        var indent = Array(depth + 1).join(" ");
        var index = node.ix === undefined ? "+ " : node.ix + ": ";
        var properties = node.properties.length === 0 ? "" : "(" + node.properties.map(function (property) { return Properties[property]; }).join("|") + ")";
        var attribute = node.attribute === undefined ? "" : "[" + node.attribute.variable + "]";
        var entity = node.entity === undefined ? "" : "[" + node.entity.displayName + "]";
        var collection = node.collection === undefined ? "" : "[" + node.collection.displayName + "]";
        var fxn = node.fxn === undefined ? "" : "[" + node.fxn.name + "]";
        var found = node.found ? "*" : " ";
        properties = properties.length === 2 ? "" : properties;
        var nodeString = "|" + found + indent + index + node.name + " " + fxn + entity + collection + attribute + " " + properties + children;
        return nodeString;
    }
    return node;
}
//------------------------------------
// Various node manipulation functions
//------------------------------------
// Removes the node and its children from the tree, 
// and makes it a child of the target node
function reroot(node, target) {
    node.parent.children.splice(node.parent.children.indexOf(node), 1);
    target.addChild(node);
}
// Removes a node from the tree
// The node's children get added to its parent
// returns the node or undefined if the operation failed
function removeNode(node) {
    if (node.hasProperty(Properties.ROOT)) {
        return undefined;
    }
    if (node.parent === undefined && node.children.length === 0) {
        return undefined;
    }
    var children = node.children;
    var parent = node.parent;
    // Rewire
    if (parent !== undefined) {
        parent.children = parent.children.concat(children);
        parent.children.sort(function (a, b) { return a.ix - b.ix; });
        parent.children.splice(parent.children.indexOf(node), 1);
        children.map(function (child) { return child.parent = parent; });
        if (parent.hasProperty(Properties.ARGUMENT)) {
            if (parent.children.length === 0) {
                parent.found = false;
            }
        }
    }
    // Get rid of references on current node
    node.parent = undefined;
    node.children = [];
    return node;
}
function removeBranch(node) {
    var parent = node.parent;
    if (parent !== undefined) {
        parent.children.splice(parent.children.indexOf(node), 1);
        node.parent = undefined;
        return node;
    }
    return undefined;
}
// Returns the first ancestor node that has been found
function previouslyMatched(node, ignoreFunctions) {
    if (ignoreFunctions === undefined) {
        ignoreFunctions = false;
    }
    if (node.parent === undefined) {
        return undefined;
    }
    else if (!ignoreFunctions &&
        (node.parent.hasProperty(Properties.SETTER) ||
            (node.parent.hasProperty(Properties.FUNCTION) && !node.parent.hasProperty(Properties.CONJUNCTION)))) {
        return undefined;
    }
    else if (node.parent.hasProperty(Properties.ENTITY) ||
        node.parent.hasProperty(Properties.ATTRIBUTE) ||
        node.parent.hasProperty(Properties.COLLECTION)) {
        return node.parent;
    }
    else {
        return previouslyMatched(node.parent, ignoreFunctions);
    }
}
// Returns the first ancestor node that has been found
function previouslyMatchedEntityOrCollection(node, ignoreFunctions) {
    if (ignoreFunctions === undefined) {
        ignoreFunctions = false;
    }
    if (node.parent === undefined) {
        return undefined;
    }
    else if (!ignoreFunctions &&
        (node.parent.hasProperty(Properties.SETTER) ||
            (node.parent.hasProperty(Properties.FUNCTION) && !node.parent.hasProperty(Properties.CONJUNCTION)))) {
        return undefined;
    }
    else if (node.parent.hasProperty(Properties.ENTITY) ||
        node.parent.hasProperty(Properties.COLLECTION)) {
        return node.parent;
    }
    else {
        return previouslyMatchedEntityOrCollection(node.parent, ignoreFunctions);
    }
}
// Returns the first ancestor node that has been found
function previouslyMatchedAttribute(node, ignoreFunctions) {
    if (ignoreFunctions === undefined) {
        ignoreFunctions = false;
    }
    if (node.parent === undefined) {
        return undefined;
    }
    else if (!ignoreFunctions &&
        (node.parent.hasProperty(Properties.SETTER) ||
            (node.parent.hasProperty(Properties.FUNCTION) && !node.parent.hasProperty(Properties.CONJUNCTION)))) {
        return undefined;
    }
    else if (node.parent.hasProperty(Properties.ATTRIBUTE)) {
        return node.parent;
    }
    else {
        return previouslyMatchedAttribute(node.parent, ignoreFunctions);
    }
}
// Inserts a node after the target, moving all of the
// target's children to the node
// Before: [Target] -> [Children]
// After:  [Target] -> [Node] -> [Children]
function insertAfterNode(node, target) {
    node.parent = target;
    node.children = target.children;
    target.children.map(function (n) { return n.parent = node; });
    target.children = [node];
}
function insertBeforeNode(node, target) {
    var parent = target.parent;
    if (parent !== undefined) {
        parent.addChild(node);
        parent.children.splice(parent.children.indexOf(target), 1);
        node.addChild(target);
    }
}
// Find all leaf nodes stemming from a given node
function findLeafNodes(node) {
    if (node.children.length === 0) {
        return [node];
    }
    else {
        var foundLeafs = node.children.map(findLeafNodes);
        var flatLeafs = flattenNestedArray(foundLeafs);
        return flatLeafs;
    }
}
/*function moveNode(node: Node, target: Node): void {
  if (node.hasProperty(Properties.ROOT)) {
    return;
  }
  let parent = node.parent;
  parent.children.splice(parent.children.indexOf(node),1);
  parent.children = parent.children.concat(node.children);
  node.children.map((child) => child.parent = parent);
  node.children = [];
  node.parent = target;
  target.children.push(node);
}*/
// Finds a parent node with the specified property, 
// returns undefined if no node was found
function findParentWithProperty(node, property) {
    if (node.parent === undefined) {
        return undefined;
    }
    else if (node.parent.hasProperty(property)) {
        return node.parent;
    }
    else {
        return findParentWithProperty(node.parent, property);
    }
}
// Finds a parent node with the specified property, 
// returns undefined if no node was found
function findChildWithProperty(node, property) {
    if (node.children.length === 0) {
        return undefined;
    }
    if (node.hasProperty(property)) {
        return node;
    }
    else {
        var childrenWithProperty = node.children.filter(function (child) { return child.hasProperty(property); });
        if (childrenWithProperty !== undefined) {
            return childrenWithProperty[0];
        }
        else {
            var results = node.children.map(function (child) { return findChildWithProperty(child, property); }).filter(function (result) { return result !== undefined; });
            if (results.length > 0) {
                return results[0];
            }
        }
    }
}
// Finds a parent node with the specified POS, 
// returns undefined if no node was found
function findParentWithPOS(node, majorPOS) {
    if (getMajorPOS(node.token.POS) === MajorPartsOfSpeech.ROOT) {
        return undefined;
    }
    if (getMajorPOS(node.parent.token.POS) === majorPOS) {
        return node.parent;
    }
    else {
        return findParentWithPOS(node.parent, majorPOS);
    }
}
/*
// Sets node to be a sibling of its parent
// Before: [Grandparent] -> [Parent] -> [Node]
// After:  [Grandparent] -> [Parent]
//                       -> [Node]
function promoteNode(node: Node): void {
  if (node.parent.hasProperty(Properties.ROOT)) {
    return;
  }
  let newSibling = node.parent;
  let newParent = newSibling.parent;
  // Set parent
  node.parent = newParent;
  // Remove node from parent's children
  newSibling.children.splice(newSibling.children.indexOf(node),1);
  // Add node to new parent's children
  newParent.children.push(node);
}*/
// Makes the node's parent a child of the node.
// The node's grandparent is then the node's parent
// Before: [Grandparent] -> [Parent] -> [Node]
// After: [Grandparen] -> [Node] -> [Parent]
function makeParentChild(node) {
    var parent = node.parent;
    // Do not swap with root
    if (parent.hasProperty(Properties.ROOT)) {
        return;
    }
    // Set parents
    node.parent = parent.parent;
    parent.parent = node;
    // Remove node as a child from parent
    parent.children.splice(parent.children.indexOf(node), 1);
    // Set children
    node.children = node.children.concat(parent);
    node.parent.children.push(node);
    node.parent.children.splice(node.parent.children.indexOf(parent), 1);
}
// Swaps a node with its parent. The node's parent
// is then the parent's parent, and its child is the parent.
// The parent gets the node's children
function swapWithParent(node) {
    var parent = node.parent;
    var pparent = parent.parent;
    if (parent.hasProperty(Properties.ROOT)) {
        return;
    }
    parent.parent = node;
    parent.children = node.children;
    pparent.children.splice(pparent.children.indexOf(parent), 1);
    node.parent = pparent;
    node.children = [parent];
    pparent.children.push(node);
}
function newContext() {
    return {
        entities: [],
        collections: [],
        attributes: [],
        fxns: [],
        groupings: [],
        relationships: [],
        found: [],
        arguments: [],
        maybeEntities: [],
        maybeAttributes: [],
        maybeCollections: [],
        maybeFunctions: [],
        maybeArguments: [],
        internalFxns: [],
        nodes: [],
        stateFlags: { list: false, insert: false },
    };
}
(function (FunctionTypes) {
    FunctionTypes[FunctionTypes["FILTER"] = 0] = "FILTER";
    FunctionTypes[FunctionTypes["AGGREGATE"] = 1] = "AGGREGATE";
    FunctionTypes[FunctionTypes["BOOLEAN"] = 2] = "BOOLEAN";
    FunctionTypes[FunctionTypes["CALCULATE"] = 3] = "CALCULATE";
    FunctionTypes[FunctionTypes["INSERT"] = 4] = "INSERT";
    FunctionTypes[FunctionTypes["SELECT"] = 5] = "SELECT";
    FunctionTypes[FunctionTypes["GROUP"] = 6] = "GROUP";
    FunctionTypes[FunctionTypes["NEGATE"] = 7] = "NEGATE";
})(exports.FunctionTypes || (exports.FunctionTypes = {}));
var FunctionTypes = exports.FunctionTypes;
function stringToFunction(word) {
    var all = [Properties.ENTITY, Properties.ATTRIBUTE, Properties.COLLECTION, Properties.FUNCTION, Properties.ROOT];
    var CFA = [Properties.COLLECTION, Properties.FUNCTION, Properties.ATTRIBUTE];
    var filterFields = [{ name: "a", types: [Properties.ATTRIBUTE, Properties.QUANTITY] },
        { name: "b", types: [Properties.ATTRIBUTE, Properties.QUANTITY] }
    ];
    var calculateFields = [{ name: "result", types: [Properties.OUTPUT] },
        { name: "a", types: [Properties.ATTRIBUTE, Properties.QUANTITY] },
        { name: "b", types: [Properties.ATTRIBUTE, Properties.QUANTITY] }
    ];
    switch (word) {
        case "after":
        case ">":
            return { name: ">", type: FunctionTypes.FILTER, fields: filterFields, project: false };
        case "before":
        case "<":
            return { name: "<", type: FunctionTypes.FILTER, fields: filterFields, project: false };
        case ">=":
            return { name: ">=", type: FunctionTypes.FILTER, fields: filterFields, project: false };
        case "<=":
            return { name: "<=", type: FunctionTypes.FILTER, fields: filterFields, project: false };
        case "=":
            return { name: "=", type: FunctionTypes.FILTER, fields: filterFields, project: false };
        case "!=":
            return { name: "!=", type: FunctionTypes.FILTER, fields: filterFields, project: false };
        case "taller":
            return { name: ">", type: FunctionTypes.FILTER, attribute: "height", fields: filterFields, project: false };
        case "shorter":
            return { name: "<", type: FunctionTypes.FILTER, attribute: "length", fields: filterFields, project: false };
        case "longer":
            return { name: ">", type: FunctionTypes.FILTER, attribute: "length", fields: filterFields, project: false };
        case "younger":
            return { name: "<", type: FunctionTypes.FILTER, attribute: "age", fields: filterFields, project: false };
        case "&":
        case "and":
            return { name: "and", type: FunctionTypes.BOOLEAN, fields: [], project: false };
        case "or":
            return { name: "or", type: FunctionTypes.BOOLEAN, fields: [], project: false };
        case "total":
        case "sum":
            return { name: "sum", type: FunctionTypes.AGGREGATE, fields: [{ name: "sum", types: [Properties.OUTPUT] },
                    { name: "value", types: [Properties.ATTRIBUTE] }], project: true, projectedAs: "sum" };
        case "count":
        case "number of":
        case "count the number of":
        case "count number of":
        case "how many":
            return { name: "count", type: FunctionTypes.AGGREGATE, fields: [{ name: "count", types: [Properties.OUTPUT] },
                    { name: "root", types: all }], project: true, projectedAs: "count" };
        case "average":
        case "avg":
        case "mean":
            return { name: "average", type: FunctionTypes.AGGREGATE, fields: [{ name: "average", types: [Properties.OUTPUT] },
                    { name: "value", types: [Properties.ATTRIBUTE] }], project: true, projectedAs: "average" };
        case "plus":
        case "add":
        case "+":
            return { name: "+", type: FunctionTypes.CALCULATE, fields: calculateFields, project: true, projectedAs: "+" };
        case "subtract":
        case "minus":
        case "-":
            return { name: "-", type: FunctionTypes.CALCULATE, fields: calculateFields, project: true, projectedAs: "-" };
        case "times":
        case "multiply":
        case "multiplied":
        case "multiplied by":
        case "*":
            return { name: "*", type: FunctionTypes.CALCULATE, fields: calculateFields, project: true, projectedAs: "*" };
        case "divide":
        case "divided":
        case "divided by":
        case "/":
            return { name: "/", type: FunctionTypes.CALCULATE, fields: calculateFields, project: true, projectedAs: "/" };
        case "^":
            return { name: "^", type: FunctionTypes.CALCULATE, fields: calculateFields, project: true, projectedAs: "^" };
        case "is":
        case "is a":
        case "is an":
            return { name: "insert", type: FunctionTypes.INSERT, fields: [{ name: "entity", types: [Properties.ENTITY] },
                    { name: "attribute", types: [Properties.ATTRIBUTE] },
                    { name: "root", types: all }], project: false };
        /*case "are":
          return {name: "insert", type: FunctionTypes.INSERT, fields: [{name: "collection", types: [Properties.COLLECTION]},
                                                                       {name: "collection", types: [Properties.COLLECTION]}], project: false};*/
        case "his":
        case "hers":
        case "their":
        case "its":
        case "'s":
        case "'":
            return { name: "select", type: FunctionTypes.SELECT, fields: [{ name: "subject", types: [Properties.ENTITY, Properties.COLLECTION, Properties.ATTRIBUTE] }], project: false };
        case "by":
        case "grouped by":
        case "per":
            return { name: "group", type: FunctionTypes.GROUP, fields: [{ name: "root", types: all },
                    { name: "collection", types: [Properties.COLLECTION, Properties.ATTRIBUTE] }], project: false };
        case "except":
        case "without":
        case "not":
        case "aren't":
            return { name: "negate", type: FunctionTypes.NEGATE, fields: [{ name: "negated", types: CFA }], project: false };
        default:
            return undefined;
    }
}
function findFunction(node, context) {
    log("Searching for function: " + node.name);
    var fxn = stringToFunction(node.name);
    if (fxn === undefined) {
        log(" Not Found: " + node.name);
        return false;
    }
    // Insert function needs to follow a possessive function
    if (fxn.type === FunctionTypes.INSERT && !context.found.some(function (n) { return n.hasProperty(Properties.POSSESSIVE); })) {
        return false;
    }
    log(" Found: " + fxn.name);
    node.fxn = fxn;
    fxn.node = node;
    // Add arguments to the node
    var args = fxn.fields.map(function (field, i) {
        var argToken = newToken(field.name);
        var argNode = newNode(argToken);
        argNode.properties.push(Properties.ARGUMENT);
        if (fxn.project && i === 0) {
            argNode.properties.push(Properties.OUTPUT);
            argNode.found = true;
            var outputToken = newToken("output" + context.fxns.length);
            var outputNode = newNode(outputToken);
            var outputAttribute = {
                id: outputNode.name,
                displayName: outputNode.name,
                variable: outputNode.name,
                node: outputNode,
                project: false,
            };
            outputNode.attribute = outputAttribute;
            outputNode.properties.push(Properties.OUTPUT);
            outputNode.found = true;
            argNode.addChild(outputNode);
        }
        else {
            argNode.properties.push(Properties.INPUT);
        }
        argNode.properties = argNode.properties.concat(field.types);
        context.arguments.push(argNode);
        return argNode;
    });
    node.properties.push(Properties.FUNCTION);
    for (var _i = 0; _i < args.length; _i++) {
        var arg = args[_i];
        node.addChild(arg);
    }
    node.found = true;
    node.type = NodeTypes.FUNCTION;
    if (node.fxn.type === FunctionTypes.AGGREGATE ||
        node.fxn.type === FunctionTypes.CALCULATE ||
        node.fxn.type === FunctionTypes.FILTER) {
        context.fxns.push(node);
    }
    context.internalFxns.push(node);
    return true;
}
function formTree(node, tree, context) {
    log("--------------------------------");
    log(node.toString());
    log(context);
    if (context.nodes.indexOf(node) === -1) {
        context.nodes.push(node);
    }
    // Don't do anything with subsumed nodes
    if (node.hasProperty(Properties.SUBSUMED)) {
        log("Skipping...");
        return { tree: tree, context: context };
    }
    // -------------------------------------
    // Step 1: Build n-grams
    // -------------------------------------
    log("ngrams:");
    // Flatten the tree
    var nextNode = tree;
    var nodes = [];
    while (nextNode !== undefined) {
        nodes.push(nextNode);
        nextNode = nextNode.next();
    }
    // Build ngrams
    // Initialize the ngrams with 1-grams
    var ngrams = nodes.map(function (node) { return [node]; });
    // Shift off the root node
    ngrams.shift();
    var n = 4;
    var m = ngrams.length;
    var offset = 0;
    for (var i = 0; i < n - 1; i++) {
        var newNgrams = [];
        for (var j = offset; j < ngrams.length; j++) {
            var thisNgram = ngrams[j];
            var nextNgram = ngrams[j + 1];
            // Break at the end of the ngrams
            if (nextNgram === undefined) {
                break;
            }
            // From the new ngram
            var newNgram = thisNgram.concat([nextNgram[nextNgram.length - 1]]);
            newNgrams.push(newNgram);
        }
        offset = ngrams.length;
        ngrams = ngrams.concat(newNgrams);
    }
    // Check each ngram for a display name
    var matchedNgrams = [];
    for (var i = ngrams.length - 1; i >= 0; i--) {
        var ngram = ngrams[i];
        var allFound_1 = ngram.every(function (node) { return node.found; });
        if (allFound_1 !== true) {
            var displayName = ngram.map(function (node) { return node.name; }).join(" ").replace(/ '/g, '\'');
            log(displayName);
            var foundName = app_1.eve.findOne("index name", { name: displayName });
            // If the display name is in the system, mark all the nodes as found 
            if (foundName !== undefined) {
                ngram.map(function (node) { return node.found = true; });
                matchedNgrams.push(ngram);
            }
            else {
                var foundAttribute = app_1.eve.findOne("entity eavs", { attribute: displayName });
                if (foundAttribute !== undefined) {
                    ngram.map(function (node) { return node.found = true; });
                    matchedNgrams.push(ngram);
                }
                else {
                    var fxn = stringToFunction(displayName);
                    if (fxn !== undefined) {
                        ngram.map(function (node) { return node.found = true; });
                        // "engineers are employees" asserts that every engineer is also an employee
                        // "engineers that are employees" is asking for the intersection of engineers and employees
                        // "that" is a determiner, which cnages the meaning of the sentence, so we prevent 
                        // an insert using this heuristic 
                        if (fxn.type === FunctionTypes.INSERT &&
                            (ngram[0].prev().token.POS === MinorPartsOfSpeech.DT ||
                                getMajorPOS(ngram[0].prev().token.POS) === MajorPartsOfSpeech.WHWORD)) {
                            return { tree: tree, context: context };
                        }
                        else {
                            matchedNgrams.push(ngram);
                        }
                    }
                }
            }
        }
    }
    // Turn matched ngrams into compound nodes  
    for (var _i = 0; _i < matchedNgrams.length; _i++) {
        var ngram = matchedNgrams[_i];
        // Don't do anything for 1-grams
        if (ngram.length === 1) {
            ngram[0].found = false;
            continue;
        }
        var displayName = ngram.map(function (node) { return node.name; }).join(" ").replace(/ '/g, '\'');
        log("Creating compound node: " + displayName);
        var lastGram = ngram[ngram.length - 1];
        var compoundToken = newToken(displayName);
        compoundToken.prev = ngram[0].token.prev;
        var compoundNode = newNode(compoundToken);
        compoundNode.constituents = ngram;
        compoundNode.constituents.map(function (node) { return node.properties.push(Properties.SUBSUMED); });
        compoundNode.ix = lastGram.ix;
        // Inherit properties from the nodes
        compoundNode.properties = lastGram.properties;
        compoundNode.properties.push(Properties.COMPOUND);
        compoundNode.properties.splice(compoundNode.properties.indexOf(Properties.SUBSUMED), 1); // Don't inherit subsumed property
        // The compound node results from the new node,
        // so the compound node replaces it
        node = compoundNode;
    }
    log('-------');
    // -------------------------------------
    // Step 2: Identify the node
    // -------------------------------------
    // If the node is a quantity, just build an attribute
    if (node.hasProperty(Properties.QUANTITY)) {
        var quantityAttribute = {
            id: node.name,
            displayName: node.name,
            variable: node.name,
            node: node,
            project: false,
            handled: true,
        };
        node.quantity = parseFloat(node.name);
        node.properties.push(Properties.ATTRIBUTE);
        node.type = NodeTypes.NUMBER;
        node.attribute = quantityAttribute;
        node.found = true;
    }
    // Find a collection, entity, attribute, or function
    if (!node.found) {
        findCollection(node, context);
        if (!node.found) {
            findAttribute(node, context);
            if (!node.found) {
                findEntity(node, context);
                if (!node.found) {
                    findFunction(node, context);
                    if (!node.found) {
                        log(node.name + " was not found anywhere!");
                    }
                }
            }
        }
    }
    // If the node wasn't found at all, don't try to place it anywhere
    if (!node.found && context.stateFlags.insert === false) {
        if (getMajorPOS(node.token.POS) === MajorPartsOfSpeech.NOUN) {
            if (node.hasProperty(Properties.PROPER)) {
                context.maybeEntities.push(node);
            }
            else if (node.hasProperty(Properties.PLURAL)) {
                context.maybeCollections.push(node);
            }
            else {
                context.maybeAttributes.push(node);
            }
        }
        return { tree: tree, context: context };
    }
    else if (!node.found && context.stateFlags.insert === true) {
        var root = context.arguments.filter(function (a) { return a.hasProperty(Properties.ROOT); }).pop();
        if (root !== undefined) {
            node.found = true;
            addNodeToFunction(node, root.parent, context);
        }
        context.maybeAttributes.push(node);
        return { tree: tree, context: context };
    }
    else if (node.found && !node.foundReps) {
        findAlternativeRepresentations(node);
    }
    // -------------------------------------
    // Step 3: Insert the node into the tree
    // -------------------------------------
    log("Matching: " + node.name);
    // If the node is compound, replace the last subsumed node with it
    if (node.hasProperty(Properties.COMPOUND)) {
        var subsumedNode = node.constituents[node.constituents.length - 2];
        if (subsumedNode.parent !== undefined) {
            log("Replacing \"" + subsumedNode.name + "\" with \"" + node.name + "\"");
            insertBeforeNode(node, subsumedNode);
            removeBranch(subsumedNode);
            var children = subsumedNode.children;
            // Relinquish children
            for (var _a = 0; _a < children.length; _a++) {
                var child = children[_a];
                if (child.hasProperty(Properties.ARGUMENT)) {
                    for (var _b = 0, _c = child.children; _b < _c.length; _b++) {
                        var grandChild = _c[_b];
                        removeBranch(grandChild);
                        formTree(grandChild, tree, context);
                    }
                }
                else {
                    removeBranch(child);
                    formTree(child, tree, context);
                }
            }
            // filter context
            context.internalFxns = context.internalFxns.filter(function (f) { return !f.hasProperty(Properties.SUBSUMED); });
            context.arguments = context.arguments.filter(function (a) { return !a.parent.hasProperty(Properties.SUBSUMED); });
            return { tree: tree, context: context };
        }
    }
    // Handle functions
    if (node.hasProperty(Properties.FUNCTION)) {
        // Find an argument to attach the node to
        var functionArg = context.arguments.filter(function (n) { return n.hasProperty(Properties.FUNCTION) && n.parent !== node && !n.found; });
        if (functionArg.length > 0) {
            var arg = functionArg.pop();
            addNodeToFunction(node, arg.parent, context);
        }
        else {
            tree.addChild(node);
        }
        // If the node is a grouping node, attach the old root to the new one
        if (node.fxn.type === FunctionTypes.GROUP) {
            var newRoot = node.children[0];
            for (var _d = 0, _e = tree.children; _d < _e.length; _d++) {
                var child = _e[_d];
                if (child === node) {
                    continue;
                }
                else {
                    reroot(child, newRoot);
                }
                newRoot.found = true;
            }
        }
        else if (node.fxn.type === FunctionTypes.INSERT) {
            // Find an entity
            var entity = context.found.filter(function (n) { return n.hasProperty(Properties.ENTITY) && n.ix < node.ix; }).pop();
            if (entity !== undefined) {
                removeNode(entity);
                addNodeToFunction(entity, node, context);
                // Find an attribute
                var attribute = context.found.filter(function (n) { return n.hasProperty(Properties.ATTRIBUTE) && n.ix > entity.ix; }).pop();
                if (attribute !== undefined) {
                    removeNode(attribute);
                    addNodeToFunction(attribute, node, context);
                }
                else {
                    var attributeNodes = context.nodes.filter(function (ma) { return ma.ix > entity.ix + 1; });
                    attributeNodes.pop();
                    if (attributeNodes.length > 0) {
                        attributeNodes.map(removeNode);
                        var nName = attributeNodes.map(function (ma) { return ma.name; }).join(" ");
                        var nToken = newToken(nName);
                        nToken.ix = attributeNodes[0].ix;
                        var nNode = newNode(nToken);
                        nNode.type = NodeTypes.STRING;
                        nNode.found = true;
                        nNode.properties.push(Properties.ATTRIBUTE);
                        addNodeToFunction(nNode, node, context);
                    }
                }
            }
        }
        else if (node.fxn.type === FunctionTypes.FILTER) {
            // If an attribute is specified, create an attribute node for each one
            if (node.fxn.attribute !== undefined) {
                // LHS
                var nToken = newToken(node.fxn.attribute);
                var nNode = newNode(nToken);
                formTree(nNode, tree, context);
                // RHS
                nToken = newToken(node.fxn.attribute);
                nNode = newNode(nToken);
                findAttribute(nNode, context);
                addNodeToFunction(nNode, node, context);
            }
            else {
                var orphans = context.found.filter(function (n) { return n.hasProperty(Properties.ATTRIBUTE); });
                for (var _f = 0; _f < orphans.length; _f++) {
                    var orphan = orphans[_f];
                    removeNode(orphan);
                    formTree(orphan, tree, context);
                    // Break when all args are filled
                    if (node.children.every(function (n) { return n.found; })) {
                        break;
                    }
                }
            }
        }
        else if (node.fxn.type === FunctionTypes.NEGATE) {
        }
        else if (node.fxn.type === FunctionTypes.CALCULATE) {
            var AQFs = context.nodes.filter(function (n) { return n.hasProperty(Properties.ATTRIBUTE) ||
                n.hasProperty(Properties.QUANTITY) ||
                n.hasProperty(Properties.FUNCTION); });
            for (var _g = 0; _g < AQFs.length; _g++) {
                var aqf = AQFs[_g];
                if (aqf.parent !== undefined && aqf.parent.hasProperty(Properties.ARGUMENT)) {
                    continue;
                }
                if (aqf.hasProperty(Properties.FUNCTION)) {
                    if (aqf.fxn.type === FunctionTypes.AGGREGATE) {
                        removeBranch(aqf);
                    }
                    else {
                        continue;
                    }
                }
                else {
                    removeNode(aqf);
                }
                formTree(aqf, tree, context);
                if (node.children.every(function (n) { return n.found; })) {
                    break;
                }
            }
        }
        else {
            if (node.fxn.fields.length > 0) {
                for (var i = context.found.length - 1; i >= 0; i--) {
                    var foundNode = context.found[i];
                    removeNode(foundNode);
                    formTree(foundNode, tree, context);
                    // Break when all args are filled
                    if (node.children.every(function (n) { return n.found; })) {
                        break;
                    }
                }
            }
        }
    }
    else {
        // Find a relationship if we have to
        var relationship = { type: RelationshipTypes.NONE };
        if (node.relationships.length === 0) {
            //let orphans = tree.children.filter((child) => child.relationships.length === 0 && child.children.length === 0);  
            for (var i = context.found.length - 1; i >= 0; i--) {
                var foundNode = context.found[i];
                if (foundNode === node) {
                    continue;
                }
                if (node.relationships.length === 0) {
                    removeNode(node);
                }
                relationship = findRelationship(node, foundNode, context);
                if (relationship.type !== RelationshipTypes.NONE) {
                    break;
                }
                else if (relationship.type === RelationshipTypes.NONE) {
                    if (foundNode.hasProperty(Properties.POSSESSIVE) && !node.found && !node.hasProperty(Properties.QUANTITY)) {
                        context.maybeAttributes.push(node);
                    }
                }
            }
        }
        // Place the node onto a function if one is open
        var openFunctions = context.internalFxns.filter(function (fxn) { return !fxn.children.every(function (c) { return c.found; }); });
        for (var _h = 0; _h < openFunctions.length; _h++) {
            var fxnNode = openFunctions[_h];
            var added = addNodeToFunction(node, fxnNode, context);
            if (added) {
                relationship.type = RelationshipTypes.DIRECT;
                break;
            }
        }
        // If no relationships were found, stick the node onto the root
        if (node.parent === undefined && node.relationships.length === 0) {
            tree.addChild(node);
        }
        else if (node.parent === undefined) {
            var relatedNodes = node.relationships.map(function (r) { return r.nodes; });
            var flatRelatedNodes = flattenNestedArray(relatedNodes);
            var relatedAttribute = flatRelatedNodes.filter(function (n) { return n.hasProperty(Properties.ATTRIBUTE); }).shift();
            if (relatedAttribute !== undefined) {
                var root = findParentWithProperty(relatedAttribute, Properties.ROOT);
                if (root !== undefined) {
                    root.addChild(node);
                }
                else {
                    tree.addChild(node);
                }
            }
            else {
                tree.addChild(node);
            }
        }
        // Finally add any nodes implicit in the relationship    
        if (relationship.implicitNodes !== undefined && relationship.implicitNodes.length > 0) {
            for (var _j = 0, _k = relationship.implicitNodes; _j < _k.length; _j++) {
                var implNode = _k[_j];
                formTree(implNode, tree, context);
            }
        }
    }
    // Switch state
    if (node.fxn && node.fxn.type === FunctionTypes.INSERT) {
        context.stateFlags.insert = true;
    }
    log("Tree:");
    log(tree.toString());
    return { tree: tree, context: context };
}
// Find all the representations of a thing
function findAlternativeRepresentations(node) {
    var attr = findEveAttribute(node.name);
    var coll = findEveCollection(node.name);
    var ent = findEveEntity(node.name);
    var fxn = stringToFunction(node.name);
    node.representations = {
        collection: coll,
        entity: ent,
        attribute: attr,
        fxn: fxn,
    };
    node.foundReps = true;
}
// Swap the representation of the node with another one
// Clears all attributes related to the old rep, and adds a new one
function changeRepresentation(node, rep, context) {
    // Clear the node
    node.found = false;
    if (node.collection !== undefined) {
        node.collection = undefined;
        node.properties.splice(node.properties.indexOf(Properties.COLLECTION), 1);
    }
    else if (node.entity !== undefined) {
        node.entity = undefined;
        node.properties.splice(node.properties.indexOf(Properties.ENTITY), 1);
    }
    else if (node.attribute !== undefined) {
        node.attribute = undefined;
        node.properties.splice(node.properties.indexOf(Properties.ATTRIBUTE), 1);
    }
    else if (node.fxn !== undefined) {
        node.fxn = undefined;
        node.properties.splice(node.properties.indexOf(Properties.FUNCTION), 1);
    }
    // Switch the representation
    if (rep === Properties.COLLECTION) {
        if (node.representations.collection) {
            findCollection(node, context);
            return true;
        }
    }
    else if (rep === Properties.ENTITY) {
        if (node.representations.entity) {
            findEntity(node, context);
            return true;
        }
    }
    else if (rep === Properties.ATTRIBUTE) {
        if (node.representations.attribute) {
            findAttribute(node, context);
            return true;
        }
    }
    else if (rep === Properties.FUNCTION) {
        if (node.representations.fxn) {
            findFunction(node, context);
            return true;
        }
    }
    return false;
}
// Adds a node to an argument. If adding the node completes a select,
// a new node will be returned
function addNodeToFunction(node, fxnNode, context) {
    log("Matching \"" + node.name + "\" with function \"" + fxnNode.name + "\"");
    // Find the correct arg
    var arg;
    if (node.hasProperty(Properties.ENTITY)) {
        arg = fxnNode.children.filter(function (c) { return c.hasProperty(Properties.ENTITY) && !c.found; }).shift();
    }
    else if (node.hasProperty(Properties.COLLECTION)) {
        arg = fxnNode.children.filter(function (c) { return c.hasProperty(Properties.COLLECTION) && !c.found; }).shift();
    }
    else if (node.hasProperty(Properties.ATTRIBUTE)) {
        arg = fxnNode.children.filter(function (c) { return c.hasProperty(Properties.ATTRIBUTE) && !c.found; }).shift();
    }
    else if (node.hasProperty(Properties.FUNCTION)) {
        arg = fxnNode.children.filter(function (c) { return c.hasProperty(Properties.FUNCTION) && !c.found; }).shift();
    }
    else {
        arg = fxnNode.children.filter(function (c) { return c.hasProperty(Properties.ROOT); }).shift();
    }
    // Add the node to the arg
    if (arg !== undefined) {
        if (fxnNode.fxn.type === FunctionTypes.GROUP && arg.name === "collection") {
            context.groupings.push(node);
            arg.addChild(node);
        }
        else if (fxnNode.fxn.type === FunctionTypes.SELECT) {
            var root = findParentWithProperty(fxnNode, Properties.ROOT);
            removeBranch(fxnNode);
            context.arguments.splice(context.arguments.indexOf(node.children[0]), 1);
            context.internalFxns.splice(context.internalFxns.indexOf(fxnNode), 1);
            node.properties.push(Properties.POSSESSIVE);
            root.addChild(node);
            return true;
        }
        else {
            arg.addChild(node);
        }
        arg.found = true;
        return true;
    }
    else {
        return false;
    }
}
function cloneCollection(collection) {
    var clone = {
        id: collection.id,
        displayName: collection.displayName,
        node: collection.node,
        variable: collection.variable,
        project: collection.project,
    };
    return clone;
}
// Returns the entity with the given display name.
// If the entity is not found, returns undefined
// Two error modes here: 
// 1) the name is not found in "display name"
// 2) the name is found in "display name" but not found in "entity"
// can 2) ever happen?
// Returns the collection with the given display name.
function findEveEntity(search) {
    log("Searching for entity: " + search);
    var foundEntity;
    var name;
    // Try to find by display name first
    var display = app_1.eve.findOne("index name", { name: search });
    if (display !== undefined) {
        foundEntity = app_1.eve.findOne("entity", { entity: display.id });
        name = search;
    }
    else {
        foundEntity = app_1.eve.findOne("entity", { entity: search });
    }
    // Build the entity
    if (foundEntity !== undefined) {
        if (name === undefined) {
            display = app_1.eve.findOne("display name", { id: search });
            name = display.name;
        }
        var entity = {
            id: foundEntity.entity,
            displayName: name,
            variable: name.replace(/ /g, ''),
            project: true,
            entityAttr: false,
            entityVar: false,
            valueVar: false,
        };
        log(" Found: " + entity.id);
        return entity;
    }
    else {
        log(" Not found: " + search);
        return undefined;
    }
}
// Returns the collection with the given display name.
function findEveCollection(search) {
    log("Searching for collection: " + search);
    var foundCollection;
    var name;
    // Try to find by display name first
    var display = app_1.eve.findOne("index name", { name: search });
    if (display !== undefined) {
        foundCollection = app_1.eve.findOne("collection", { collection: display.id });
        name = search;
    }
    else {
        foundCollection = app_1.eve.findOne("collection", { collection: search });
    }
    // Build the collection
    if (foundCollection !== undefined) {
        if (name === undefined) {
            display = app_1.eve.findOne("display name", { id: search });
            name = display.name;
        }
        var collection = {
            id: foundCollection.collection,
            displayName: name,
            variable: name.replace(/ /g, ''),
            project: true,
        };
        log(" Found: " + collection.id);
        return collection;
    }
    else {
        log(" Not found: " + search);
        return undefined;
    }
}
// Returns the attribute with the given display name attached to the given entity
// If the entity does not have that attribute, or the entity does not exist, returns undefined
function findEveAttribute(name) {
    log("Searching for attribute: " + name);
    var foundAttribute = app_1.eve.findOne("entity eavs", { attribute: name });
    if (foundAttribute !== undefined) {
        var attribute = {
            id: foundAttribute.attribute,
            displayName: name,
            variable: name.replace(/ /g, ''),
            project: true,
        };
        log(" Found: " + name);
        log(attribute);
        return attribute;
    }
    log(" Not found: " + name);
    return undefined;
}
var RelationshipTypes;
(function (RelationshipTypes) {
    RelationshipTypes[RelationshipTypes["NONE"] = 0] = "NONE";
    RelationshipTypes[RelationshipTypes["DIRECT"] = 1] = "DIRECT";
    RelationshipTypes[RelationshipTypes["ONEHOP"] = 2] = "ONEHOP";
    RelationshipTypes[RelationshipTypes["TWOHOP"] = 3] = "TWOHOP";
    RelationshipTypes[RelationshipTypes["INTERSECTION"] = 4] = "INTERSECTION";
})(RelationshipTypes || (RelationshipTypes = {}));
function findRelationship(nodeA, nodeB, context) {
    var relationship = { type: RelationshipTypes.NONE };
    if ((nodeA === nodeB) ||
        (context.stateFlags.insert) ||
        (nodeA.hasProperty(Properties.QUANTITY) && nodeB.hasProperty(Properties.QUANTITY))) {
        return relationship;
    }
    log("Finding relationship between \"" + nodeA.name + "\" and \"" + nodeB.name + "\"");
    // Sort the nodes in order
    // 1) Collection 
    // 2) Entity 
    // 3) Attribute
    // 4) Function
    // 5) Quantity
    // 6) String
    nodeA.properties.sort(function (a, b) { return a - b; });
    nodeB.properties.sort(function (a, b) { return a - b; });
    var nodes = [nodeA, nodeB].sort(function (a, b) { return a.properties[0] - b.properties[0]; });
    nodeA = nodes[0];
    nodeB = nodes[1];
    // Find the proper relationship
    if (nodeA.hasProperty(Properties.ENTITY) && nodeB.hasProperty(Properties.ATTRIBUTE)) {
        relationship = findEntToAttrRelationship(nodeA, nodeB, context);
    }
    else if (nodeA.hasProperty(Properties.COLLECTION) && nodeB.hasProperty(Properties.ATTRIBUTE)) {
        relationship = findCollToAttrRelationship(nodeA, nodeB, context);
    }
    else if (nodeA.hasProperty(Properties.COLLECTION) && nodeB.hasProperty(Properties.COLLECTION)) {
        relationship = findCollToCollRelationship(nodeA, nodeB, context);
    }
    else if (nodeA.hasProperty(Properties.ATTRIBUTE) && nodeB.hasProperty(Properties.ATTRIBUTE)) {
        relationship = findAttrToAttrRelationship(nodeA, nodeB, context);
    }
    else if (nodeA.hasProperty(Properties.COLLECTION) && nodeB.hasProperty(Properties.ENTITY)) {
        relationship = findCollToEntRelationship(nodeA, nodeB, context);
    }
    // Add relationships to the nodes and context
    if (relationship.type !== RelationshipTypes.NONE) {
        nodeA.relationships.push(relationship);
        nodeB.relationships.push(relationship);
        context.relationships.push(relationship);
    }
    else {
        nodes = [nodeA, nodeB].sort(function (a, b) { return a.ix - b.ix; });
        nodeA = nodes[0];
        nodeB = nodes[1];
        var repChanged = false;
        // If one node is possessive, it suggests the other should be represented as an attribute of the first
        if (nodeA.hasProperty(Properties.POSSESSIVE) && !nodeB.hasProperty(Properties.ATTRIBUTE) && nodeB.representations.attribute !== undefined) {
            repChanged = changeRepresentation(nodeB, Properties.ATTRIBUTE, context);
        }
        else if (nodeA.hasProperty(Properties.COLLECTION) && nodeB.hasProperty(Properties.COLLECTION) && nodeB.representations.attribute !== undefined) {
            repChanged = changeRepresentation(nodeB, Properties.ATTRIBUTE, context);
        }
        if (repChanged) {
            relationship = findRelationship(nodeA, nodeB, context);
        }
    }
    return relationship;
}
// e.g. Corey's wife's age
function findAttrToAttrRelationship(attrA, attrB, context) {
    log("Finding Attr -> Attr relationship between \"" + attrA.name + "\" and \"" + attrB.name + "\"...");
    console.log(attrA);
    console.log(attrB);
    if (attrA.hasProperty(Properties.QUANTITY)) {
        var temp = attrA;
        attrA = attrB;
        attrB = temp;
    }
    // e.g. employees whose salary is 10
    if (attrA.relationships.length > 0 && attrB.hasProperty(Properties.QUANTITY) && !attrA.parent.hasProperty(Properties.ARGUMENT)) {
        attrA.attribute.variable = "" + attrB.quantity;
        attrA.attribute.attributeVar = false;
        attrA.attribute.project = false;
        return { type: RelationshipTypes.DIRECT, nodes: [attrA, attrB] };
    }
    else {
        return { type: RelationshipTypes.NONE };
    }
    // Check whether one of the attributes is an entity attribute
    var direct = false;
    if (attrA.hasProperty(Properties.POSSESSIVE)) {
        direct = true;
    }
    else if (attrB.hasProperty(Properties.POSSESSIVE)) {
        var tNode = attrA;
        attrA = attrB;
        attrB = tNode;
        direct = true;
    }
    if (direct) {
        log("  Found a direct relationship");
        // Create an entity attribute
        var entityAttr = attrA.attribute;
        var ent = {
            id: entityAttr.variable,
            displayName: entityAttr.variable,
            variable: entityAttr.variable,
            project: false,
            entityAttr: true,
            entityVar: false,
            valueVar: false,
        };
        var nToken = newToken(entityAttr.variable);
        var nNode = newNode(nToken);
        nNode.entity = ent;
        ent.node = nNode;
        attrB.attribute.variable = attrA.attribute.variable + "|" + attrB.attribute.id;
        attrB.attribute.refs = [nNode];
        return { type: RelationshipTypes.DIRECT, nodes: [attrA, attrB] };
    }
    return { type: RelationshipTypes.NONE };
}
// e.g. "meetings john was in"
function findCollToEntRelationship(coll, ent, context) {
    log("Finding Coll -> Ent relationship between \"" + coll.name + "\" and \"" + ent.name + "\"...");
    /*if (coll === "collections") {
      if (eve.findOne("collection entities", { entity: nodeB.entity.id })) {
        return { type: RelationshipTypes.DIRECT };
      }
    }
    if (eve.findOne("collection entities", { collection: coll.collection.id, entity: ent.entity.id })) {
      log("  Found Direct relationship")
      return { type: RelationshipTypes.DIRECT };
    }*/
    var eveRelationship = app_1.eve.query("")
        .select("collection entities", { collection: coll.collection.id }, "collection")
        .select("directionless links", { entity: ["collection", "entity"], link: ent.entity.id }, "links")
        .exec();
    if (eveRelationship.unprojected.length) {
        var entities = extractFromUnprojected(eveRelationship.unprojected, 1, 2, "link");
        var collections = findCommonCollections(entities);
        var collLinkID;
        if (collections.length > 0) {
            log("  Found Direct Relationship");
            var entity = ent.entity;
            entity.entityVar = true;
            entity.project = false;
            entity.variable = coll.collection.variable;
            var relationship = { type: RelationshipTypes.DIRECT, nodes: [coll, ent] };
            return relationship;
        }
    }
    /*
    // e.g. events with chris granger (events -> meetings -> chris granger)
    let relationships2 = eve.query(``)
      .select("collection entities", { collection: coll }, "collection")
      .select("directionless links", { entity: ["collection", "entity"] }, "links")
      .select("directionless links", { entity: ["links", "link"], link: ent }, "links2")
      .exec();
    if (relationships2.unprojected.length) {
      let entities = extractFromUnprojected(relationships2.unprojected, 1, 3);
      return { type: RelationshipTypes.TWOHOP };
    }*/
    log("  No relationship found");
    return { type: RelationshipTypes.NONE };
}
function findEntToAttrRelationship(ent, attr, context) {
    log("Finding Ent -> Attr relationship between \"" + ent.name + "\" and \"" + attr.name + "\"...");
    // If the node already has a relationship, then treat the entity as filtering the node
    if (attr.relationships.length > 0 && !attr.parent.hasProperty(Properties.ARGUMENT)) {
        attr.attribute.variable = ent.entity.id;
        attr.attribute.attributeVar = false;
        attr.attribute.project = false;
        ent.entity.project = false;
        ent.entity.handled = true;
        return { type: RelationshipTypes.DIRECT, nodes: [ent, attr] };
    }
    else if (attr.relationships.length > 0) {
        return { type: RelationshipTypes.NONE };
    }
    // Check for a direct relationship
    // e.g. "Josh's age"
    var eveRelationship = app_1.eve.findOne("entity eavs", { entity: ent.entity.id, attribute: attr.attribute.id });
    if (eveRelationship) {
        log("  Found a direct relationship.");
        var attribute = attr.attribute;
        var varName = (ent.name + "|" + attr.name).replace(/ /g, '');
        attribute.variable = varName;
        attribute.refs = [ent];
        attribute.project = true;
        ent.entity.handled = true;
        return { type: RelationshipTypes.DIRECT, nodes: [ent, attr], implicitNodes: [] };
    }
    // Check for a one-hop relationship
    // e.g. "Salaries in engineering"
    eveRelationship = app_1.eve.query("")
        .select("directionless links", { entity: ent.entity.id }, "links")
        .select("entity eavs", { entity: ["links", "link"], attribute: attr.attribute.id }, "eav")
        .exec();
    if (eveRelationship.unprojected.length) {
        log(eveRelationship);
        // Fill in the attribute
        var entities = extractFromUnprojected(eveRelationship.unprojected, 0, 2, "link");
        var collections = findCommonCollections(entities);
        var collLinkID;
        if (collections.length > 0) {
            log("  Found One-Hop Relationship");
            // @HACK Choose the correct collection in a smart way. 
            // Largest collection other than entity or testdata?
            collLinkID = collections[0];
            var foundCollection = findEveCollection(collLinkID);
            var linkToken = newToken(foundCollection.displayName);
            var linkCollection = newNode(linkToken);
            findCollection(linkCollection, context);
            var attribute = attr.attribute;
            var varName = (linkCollection.name + "|" + attr.name).replace(/ /g, '');
            attribute.variable = varName;
            attribute.refs = [linkCollection];
            // Find the one-hop link
            var getAttr = app_1.eve.query("")
                .select("directionless links", { entity: ent.entity.id }, "links")
                .select("entity eavs", { entity: ["links", "link"], value: ent.entity.id }, "eav")
                .exec();
            var attributes = extractFromUnprojected(getAttr.unprojected, 1, 2, "attribute");
            attributes = attributes.filter(onlyUnique);
            var attrLinkID;
            var nNode;
            var implicitNodes = [];
            if (attributes.length > 0) {
                attrLinkID = attributes[0];
                // Build a link attribute node
                var newName = attrLinkID;
                var nToken = newToken(newName);
                nNode = newNode(nToken);
                var nAttribute = {
                    id: attrLinkID,
                    refs: [linkCollection],
                    node: nNode,
                    displayName: attrLinkID,
                    variable: "\"" + ent.entity.id + "\"",
                    project: false,
                };
                nNode.attribute = nAttribute;
                nNode.properties.push(Properties.ATTRIBUTE);
                nNode.found = true;
                implicitNodes.push(nNode);
            }
            // Project what we need to
            attribute.project = true;
            ent.entity.project = false;
            ent.entity.handled = true;
            var relationship = { type: RelationshipTypes.ONEHOP, nodes: [ent, attr], implicitNodes: implicitNodes };
            if (nNode !== undefined) {
                nNode.relationships.push(relationship);
            }
            return relationship;
        }
    }
    /*
    let relationships2 = eve.query(``)
      .select("directionless links", { entity: entity.id }, "links")
      .select("directionless links", { entity: ["links", "link"] }, "links2")
      .select("entity eavs", { entity: ["links2", "link"], attribute: attr }, "eav")
      .exec();
    if (relationships2.unprojected.length) {
      let entities = extractFromUnprojected(relationships2.unprojected, 0, 3);
      let entities2 = extractFromUnprojected(relationships2.unprojected, 1, 3);
      //return { distance: 2, type: RelationshipTypes.ENTITY_ATTRIBUTE, nodes: [findCommonCollections(entities), findCommonCollections(entities2)] };
    }*/
    log("  No relationship found.");
    return { type: RelationshipTypes.NONE };
}
function findCollToCollRelationship(collA, collB, context) {
    log("Finding Coll -> Coll relationship between \"" + collA.collection.displayName + "\" and \"" + collB.collection.displayName + "\"...");
    // are there things in both sets?
    var intersection = app_1.eve.query(collA.collection.displayName + "->" + collB.collection.displayName)
        .select("collection entities", { collection: collA.collection.id }, "collA")
        .select("collection entities", { collection: collB.collection.id, entity: ["collA", "entity"] }, "collB")
        .exec();
    // is there a relationship between things in both sets
    var eveRelationship = app_1.eve.query("relationships between " + collA.collection.displayName + " and " + collB.collection.displayName)
        .select("collection entities", { collection: collA.collection.id }, "collA")
        .select("directionless links", { entity: ["collA", "entity"] }, "links")
        .select("collection entities", { collection: collB.collection.id, entity: ["links", "link"] }, "collB")
        .group([["links", "link"]])
        .aggregate("count", {}, "count")
        .project({ type: ["links", "link"], count: ["count", "count"] })
        .exec();
    var maxRel = { type: "", count: 0 };
    for (var _i = 0, _a = eveRelationship.results; _i < _a.length; _i++) {
        var result = _a[_i];
        if (result.count > maxRel.count)
            maxRel = result;
    }
    // we divide by two because unprojected results pack rows next to eachother
    // and we have two selects.
    var intersectionSize = intersection.unprojected.length / 2;
    if (maxRel.count > intersectionSize) {
        /*
        console.log(eveRelationship)
        let entities = extractFromUnprojected(eveRelationship.unprojected,1,2,"link").filter((e) => e !== undefined);
        let collections = findCommonCollections(entities);
        console.log(entities);
        console.log(collections)
        console.log(findEveCollection(collections[0]));*/
        log(" Direct relationship found");
        var nName = collA.name + "|" + collB.name;
        var nToken = newToken(nName);
        var nNode = newNode(nToken);
        // Create a link eav
        var entity = {
            id: nName,
            displayName: nName,
            variable: collB.collection.variable,
            value: collA.collection.variable,
            project: false,
            entityAttr: false,
            entityVar: true,
            valueVar: true,
            node: nNode,
            handled: false,
        };
        nNode.properties.push(Properties.ENTITY);
        nNode.entity = entity;
        nNode.found = true;
        collB.addChild(nNode);
        var relationship = { type: RelationshipTypes.DIRECT, nodes: [collA, collB] };
        nNode.relationships.push(relationship);
        return relationship;
    }
    else if (intersectionSize > 0) {
        log(" Found Intersection relationship.");
        collA.collection.variable = collB.collection.variable;
        collB.collection.project = true;
        collA.collection.project = false;
        return { type: RelationshipTypes.INTERSECTION, nodes: [collA, collB] };
    }
    else if (maxRel.count === 0 && intersectionSize === 0) {
        log("  No relationship found2");
        return { type: RelationshipTypes.NONE };
    }
    else {
        // @TODO
        log("  No relationship found3");
        return { type: RelationshipTypes.NONE };
    }
}
exports.findCollToCollRelationship = findCollToCollRelationship;
function findCollToAttrRelationship(coll, attr, context) {
    // Finds a direct relationship between collection and attribute
    // e.g. "pets' lengths"" => pet -> length
    log("Finding Coll -> Attr relationship between \"" + coll.name + "\" and \"" + attr.name + "\"...");
    var eveRelationship = app_1.eve.query("")
        .select("collection entities", { collection: coll.collection.id }, "collection")
        .select("entity eavs", { entity: ["collection", "entity"], attribute: attr.attribute.id }, "eav")
        .exec();
    if (eveRelationship.unprojected.length > 0) {
        log("  Found Direct Relationship");
        // Build an attribute node
        var attribute = attr.attribute;
        var varName = (coll.name + "|" + attr.name).replace(/ /g, '');
        attribute.variable = varName;
        attribute.refs = [coll];
        attribute.project = true;
        return { type: RelationshipTypes.DIRECT, nodes: [coll, attr], implicitNodes: [] };
    }
    // Finds a one hop relationship
    // e.g. "department salaries" => department -> employee -> salary
    eveRelationship = app_1.eve.query("")
        .select("collection entities", { collection: coll.collection.id }, "collection")
        .select("directionless links", { entity: ["collection", "entity"] }, "links")
        .select("entity eavs", { entity: ["links", "link"], attribute: attr.attribute.id }, "eav")
        .exec();
    if (eveRelationship.unprojected.length > 0) {
        log("  Found One-Hop Relationship");
        log(eveRelationship);
        // Find the one-hop link
        var entities = extractFromUnprojected(eveRelationship.unprojected, 1, 3, "link");
        var collections = findCommonCollections(entities);
        var linkID;
        if (collections.length > 0) {
            // @HACK Choose the correct collection in a smart way. 
            // Largest collection other than entity or testdata?
            linkID = collections[0];
        }
        // Fill in the attribute
        var foundCollection = findEveCollection(linkID);
        var linkToken = newToken(foundCollection.displayName);
        var linkCollection = newNode(linkToken);
        findCollection(linkCollection, context);
        var attribute = attr.attribute;
        var varName = (linkCollection.name + "|" + attr.name).replace(/ /g, '');
        attribute.variable = varName;
        attribute.refs = [linkCollection];
        attribute.project = true;
        // Build a link attribute node
        var newName = coll.collection.variable;
        var nToken = newToken(newName);
        var nNode = newNode(nToken);
        var nAttribute = {
            id: coll.collection.displayName,
            refs: [linkCollection],
            node: nNode,
            displayName: newName,
            variable: newName,
            project: false,
        };
        nNode.attribute = nAttribute;
        nNode.properties.push(Properties.ATTRIBUTE);
        nNode.found = true;
        // Project what we need to
        linkCollection.collection.project = true;
        coll.collection.project = true;
        var relationship = { type: RelationshipTypes.ONEHOP, nodes: [coll, attr], implicitNodes: [nNode] };
        nNode.relationships.push(relationship);
        linkCollection.relationships.push(relationship);
        return relationship;
    }
    /*
    // Not sure if this one works... using the entity table, a 2 hop link can
    // be found almost anywhere, yielding results like
    // e.g. "Pets heights" => pets -> snake -> entity -> corey -> height
     relationship = eve.query(``)
      .select("collection entities", { collection: coll.id }, "collection")
      .select("directionless links", { entity: ["collection", "entity"] }, "links")
      .select("directionless links", { entity: ["links", "link"] }, "links2")
     .select("entity eavs", { entity: ["links2", "link"], attribute: attr }, "eav")
      .exec();
    if (relationship.unprojected.length > 0) {
      return true;
    }*/
    log("  No relationship found");
    return { type: RelationshipTypes.NONE };
}
// Extracts entities from unprojected results
function extractFromUnprojected(coll, ix, size, field) {
    var results = [];
    for (var i = 0, len = coll.length; i < len; i += size) {
        results.push(coll[i + ix][field]);
    }
    return results;
}
// Find collections that entities have in common
function findCommonCollections(entities) {
    var intersection = entityTocollectionsArray(entities[0]);
    intersection.sort();
    for (var _i = 0, _a = entities.slice(1); _i < _a.length; _i++) {
        var entId = _a[_i];
        var cur = entityTocollectionsArray(entId);
        cur.sort();
        arrayIntersect(intersection, cur);
    }
    intersection.sort(function (a, b) {
        return app_1.eve.findOne("collection", { collection: a })["count"] - app_1.eve.findOne("collection", { collection: b })["count"];
    });
    return intersection;
}
function entityTocollectionsArray(entity) {
    var entities = app_1.eve.find("collection entities", { entity: entity });
    return entities.map(function (a) { return a["collection"]; });
}
function findCollection(node, context) {
    var collection;
    collection = findEveCollection(node.name);
    if (collection !== undefined) {
        context.found.push(node);
        collection.node = node;
        node.collection = collection;
        node.representations.collection = collection;
        node.type = NodeTypes.COLLECTION;
        node.found = true;
        node.properties.push(Properties.COLLECTION);
        return true;
    }
    return false;
}
function findEntity(node, context) {
    var entity;
    entity = findEveEntity(node.name);
    if (entity !== undefined) {
        context.found.push(node);
        entity.node = node;
        node.entity = entity;
        node.representations.entity = entity;
        node.type = NodeTypes.ENTITY;
        node.found = true;
        node.properties.push(Properties.ENTITY);
        return true;
    }
    return false;
}
function findAttribute(node, context) {
    if (node.name === "is a") {
        return false;
    }
    var attribute;
    attribute = findEveAttribute(node.name);
    if (attribute !== undefined) {
        context.found.push(node);
        attribute.node = node;
        node.attribute = attribute;
        node.representations.attribute = attribute;
        node.type = NodeTypes.ATTRIBUTE;
        node.found = true;
        node.properties.push(Properties.ATTRIBUTE);
        return true;
    }
    return false;
}
function addFieldsToProject(projectFields, fields) {
    var field;
    for (var _i = 0; _i < fields.length; _i++) {
        field = fields[_i];
        var matchingFields = projectFields.filter(function (f) { return f.name === field.name; });
        if (matchingFields.length === 0) {
            projectFields.push(field);
        }
    }
}
function negateTerm(term) {
    if (term.table === "entity eavs" && term.fields[2] !== undefined && term.fields[2].name === "value") {
        term.fields.splice(2, 1);
    }
    var negate = newQuery([term]);
    negate.type = "negate";
    return negate;
}
function newQuery(terms, subqueries, projects) {
    if (terms === undefined) {
        terms = [];
    }
    if (subqueries === undefined) {
        subqueries = [];
    }
    if (projects === undefined) {
        projects = [];
    }
    // Dedupe terms
    var termStrings = terms.map(termToString);
    var uniqueTerms = termStrings.map(function (value, index, self) {
        return self.indexOf(value) === index;
    });
    terms = terms.filter(function (term, index) { return uniqueTerms[index]; });
    var query = {
        type: "query",
        terms: terms,
        subqueries: subqueries,
        projects: projects,
        toString: queryToString,
    };
    function queryToString(depth) {
        if (query.terms.length === 0 && query.projects.length === 0) {
            return "";
        }
        if (depth === undefined) {
            depth = 0;
        }
        var indent = Array(depth + 1).join("\t");
        var queryString = indent + "(";
        // Map each term/subquery/project to a string
        var typeString = query.type;
        var termString = query.terms.map(function (term) { return termToString(term, depth + 1); }).join("\n");
        var subqueriesString = query.subqueries.map(function (query) { return query.toString(depth + 1); }).join("\n");
        var projectsString = query.projects.map(function (term) { return termToString(term, depth + 1); }).join("\n");
        // Now compose the query string
        queryString += typeString;
        queryString += termString === "" ? "" : "\n" + termString;
        queryString += subqueriesString === "" ? "" : "\n" + subqueriesString;
        queryString += projectsString === "" ? "" : "\n" + projectsString;
        // Close out the query
        queryString += "\n" + indent + ")";
        return queryString;
    }
    function termToString(term, depth) {
        if (depth === undefined) {
            depth = 0;
        }
        var indent = Array(depth + 1).join("\t");
        var termString = indent + "(";
        termString += term.type + " ";
        termString += "" + (term.table === undefined ? "" : "\"" + term.table + "\" ");
        termString += term.fields.map(function (field) { return (":" + field.name + " " + (field.variable ? field.value : "\"" + field.value + "\"")); }).join(" ");
        termString += ")";
        return termString;
    }
    return query;
}
exports.newQuery = newQuery;
function formQuery(node) {
    var query = newQuery();
    var projectFields = [];
    //--------------------------
    // Handle the children nodes
    //--------------------------
    var childQueries = node.children.map(formQuery);
    // Subsume child queries
    var combinedProjectFields = [];
    for (var _i = 0; _i < childQueries.length; _i++) {
        var cQuery = childQueries[_i];
        query.terms = query.terms.concat(cQuery.terms);
        query.subqueries = query.subqueries.concat(cQuery.subqueries);
        // Combine unnamed projects
        for (var _a = 0, _b = cQuery.projects; _a < _b.length; _a++) {
            var project = _b[_a];
            if (project.table === undefined) {
                addFieldsToProject(combinedProjectFields, project.fields);
            }
        }
    }
    if (combinedProjectFields.length > 0) {
        projectFields = combinedProjectFields;
    }
    // Sort terms
    query.terms = query.terms.sort(function (a, b) {
        var aRank = setRank(a.table);
        var bRank = setRank(b.table);
        function setRank(table) {
            if (table === "entity eavs") {
                return 1;
            }
            else if (table === "directionless links") {
                return 2;
            }
            else if (table === "is a attributes") {
                return 3;
            }
            else {
                return 4;
            }
        }
        return aRank - bRank;
    });
    //-------------------------
    // Handle the current node
    //-------------------------
    // Just return at the root
    if (node.hasProperty(Properties.ROOT) || node.hasProperty(Properties.ARGUMENT)) {
        if (projectFields.length > 0) {
            var project = {
                type: "project!",
                fields: projectFields,
            };
            query.projects.push(project);
        }
        return query;
    }
    // Handle functions -------------------------------
    if (node.hasProperty(Properties.FUNCTION) &&
        node.fxn.type === FunctionTypes.NEGATE) {
        log("Building negate term for: " + node.name);
        var negatedTerm = query.terms.pop();
        var negatedQuery = negateTerm(negatedTerm);
        query.subqueries.push(negatedQuery);
        projectFields = [];
    }
    if (node.hasProperty(Properties.FUNCTION) && (node.fxn.type === FunctionTypes.AGGREGATE ||
        node.fxn.type === FunctionTypes.CALCULATE ||
        node.fxn.type === FunctionTypes.FILTER)) {
        // Collection all input and output nodes which were found
        var allArgsFound = node.children.every(function (child) { return child.found; });
        // If we have the right number of arguments, proceed
        var output;
        if (allArgsFound) {
            log("Building function term for: " + node.name);
            var args = node.children.filter(function (child) { return child.hasProperty(Properties.ARGUMENT); }).map(function (arg) { return arg.children[0]; });
            var fields = args.map(function (arg, i) {
                if (arg.parent.hasProperty(Properties.ROOT)) {
                    return undefined;
                }
                return { name: node.fxn.fields[i].name,
                    value: arg.attribute.variable,
                    variable: arg.attribute.attributeVar !== undefined ? arg.attribute.attributeVar : true
                };
            }).filter(function (f) { return f !== undefined; });
            var term = {
                type: "select",
                table: node.fxn.name,
                fields: fields,
                node: node,
            };
            query.terms.push(term);
            // project output if necessary
            if (node.fxn.project === true) {
                projectFields = args.filter(function (arg) { return arg.parent.hasProperty(Properties.OUTPUT); })
                    .map(function (arg) {
                    return { name: node.fxn.name,
                        value: arg.attribute.variable,
                        variable: true };
                });
                args.map(function (a) {
                    if (a.hasProperty(Properties.ATTRIBUTE)) {
                        a.attribute.project = false;
                        a.attribute.projectedAs = undefined;
                    }
                    else if (a.hasProperty(Properties.COLLECTION)) {
                        a.collection.project = false;
                        a.collection.projectedAs = undefined;
                    }
                });
                query.projects = []; // Clears all previous projects
            }
        }
    }
    if (node.hasProperty(Properties.FUNCTION) && (node.fxn.type === FunctionTypes.GROUP)) {
        var allArgsFound = node.children.every(function (child) { return child.found; });
        if (allArgsFound) {
            log("Building function term for: " + node.name);
            var groupNode = node.children[1].children[0];
            if (groupNode.hasProperty(Properties.COLLECTION)) {
                groupNode.collection.handled = false;
            }
            else if (groupNode.hasProperty(Properties.ATTRIBUTE)) {
                groupNode.attribute.handled = false;
            }
            var subquery = query;
            var query2 = formQuery(groupNode);
            query = newQuery();
            query.subqueries.push(subquery);
            query.terms = query.terms.concat(query2.terms);
        }
    }
    // Handle attributes -------------------------------
    if (node.hasProperty(Properties.ATTRIBUTE) && !node.attribute.handled) {
        log("Building attribute term for: " + node.name);
        var fields = [];
        var attr = node.attribute;
        if (attr.refs !== undefined) {
            for (var _c = 0, _d = attr.refs; _c < _d.length; _c++) {
                var ref = _d[_c];
                var entityVar = ref.entity !== undefined ? ref.entity.id : ref.collection.variable;
                var fieldVar = ref.entity !== undefined && ref.entity.entityAttr === false ? false : true;
                if (fields.length === 0) {
                    var entityField = {
                        name: "entity",
                        value: entityVar,
                        variable: fieldVar,
                    };
                    fields.push(entityField);
                }
                // Build a query for each ref and merge it with the current query
                var refQuery = formQuery(ref);
                query.terms = query.terms.concat(refQuery.terms);
                if (refQuery.projects.length > 0) {
                    addFieldsToProject(projectFields, refQuery.projects[0].fields);
                }
            }
        }
        var attrField = {
            name: "attribute",
            value: attr.id,
            variable: false
        };
        fields.push(attrField);
        var valueField = {
            name: "value",
            value: attr.variable,
            variable: attr.attributeVar !== undefined ? attr.attributeVar : true,
        };
        fields.push(valueField);
        var term = {
            type: "select",
            table: "entity eavs",
            fields: fields,
            node: node,
        };
        query.terms.push(term);
        // project if necessary
        if (node.attribute.project) {
            var projectAttribute = {
                name: attr.displayName.replace(/ /g, ''),
                value: attr.variable,
                variable: true
            };
            attr.projectedAs = projectAttribute.name;
            addFieldsToProject(projectFields, [projectAttribute]);
        }
        node.attribute.handled = true;
    }
    // Handle collections -------------------------------
    if (node.hasProperty(Properties.COLLECTION) && !node.collection.handled) {
        log("Building collection term for: " + node.name);
        var collection = node.collection;
        var entityField = {
            name: "entity",
            value: collection.variable,
            variable: true
        };
        var collectionField = {
            name: "collection",
            value: collection.id,
            variable: false
        };
        var term = {
            type: "select",
            table: "is a attributes",
            fields: [entityField, collectionField],
            node: node,
        };
        query.terms.push(term);
        // project if necessary
        if (node.collection.project) {
            var projectCollection = {
                name: collection.variable.replace(/ /g, ''),
                value: collection.variable,
                variable: true
            };
            collection.projectedAs = projectCollection.name;
            addFieldsToProject(projectFields, [projectCollection]);
        }
        node.collection.handled = true;
    }
    // Handle entities -------------------------------
    if (node.hasProperty(Properties.ENTITY) && !node.entity.handled) {
        log("Building entity term for: " + node.name);
        var entity = node.entity;
        var fields = [];
        var entityField = {
            name: "entity",
            value: entity.entityVar ? entity.variable : entity.id,
            variable: entity.entityVar,
        };
        fields.push(entityField);
        if (entity.entityVar) {
            var valueField = {
                name: entity.entityVar ? "link" : "value",
                value: entity.valueVar ? entity.value : entity.id,
                variable: entity.valueVar,
            };
            fields.push(valueField);
        }
        var term = {
            type: "select",
            table: entity.entityVar ? "directionless links" : "entity eavs",
            fields: fields,
            node: node,
        };
        query.terms.push(term);
        // project if necessary
        if (entity.project === true) {
            var projectEntity = {
                name: entity.displayName.replace(/ /g, ''),
                value: entity.id,
                variable: false
            };
            entity.projectedAs = projectEntity.name;
            addFieldsToProject(projectFields, [projectEntity]);
        }
        node.entity.handled = true;
    }
    // Project something if necessary       
    if (projectFields.length > 0) {
        var project = {
            type: "project!",
            fields: projectFields,
        };
        query.projects.push(project);
    }
    return query;
}
// ----------------------------------------------------------------------------
// Debug utility functions
// ---------------------------------------------------------------------------- 
var divider = "--------------------------------------------------------------------------------";
exports.debug = false;
function log(x) {
    if (exports.debug) {
        console.log(x);
    }
}
function tokenToString(token, s1, s2, s3, s4, s5) {
    var properties = "(" + token.properties.map(function (property) { return Properties[property]; }).join("|") + ")";
    properties = properties.length === 2 ? "" : properties;
    var tokenSpan = token.start === undefined ? " " : " [" + token.start + "-" + token.end + "] ";
    var spacer1 = Array(s1 - ("" + token.ix).length + 1).join(" ");
    var spacer2 = Array(s2 - ("" + token.originalWord).length + 1).join(" ");
    var spacer3 = Array(s3 - ("" + token.normalizedWord).length + 1).join(" ");
    var spacer4 = Array(s4 - ("" + MajorPartsOfSpeech[getMajorPOS(token.POS)]).length + 1).join(" ");
    var spacer5 = Array(s5 - ("" + MinorPartsOfSpeech[token.POS]).length + 1).join(" ");
    var tokenString = token.ix + ":" + spacer1 + " " + token.originalWord + spacer2 + " | " + token.normalizedWord + spacer3 + " | " + MajorPartsOfSpeech[getMajorPOS(token.POS)] + spacer4 + " | " + MinorPartsOfSpeech[token.POS] + spacer5 + " | " + properties;
    return tokenString;
}
function tokenArrayToString(tokens) {
    var s1 = ("" + tokens[tokens.length - 1].ix).length;
    var s2 = tokens.map(function (token) { return token.originalWord.length; }).reduce(function (a, b) {
        if (b > a) {
            return b;
        }
        else {
            return a;
        }
    });
    var s3 = tokens.map(function (token) { return token.normalizedWord.length; }).reduce(function (a, b) {
        if (b > a) {
            return b;
        }
        else {
            return a;
        }
    });
    var s4 = tokens.map(function (token) { return ("" + MajorPartsOfSpeech[getMajorPOS(token.POS)]).length; }).reduce(function (a, b) {
        if (b > a) {
            return b;
        }
        else {
            return a;
        }
    });
    var s5 = tokens.map(function (token) { return ("" + MinorPartsOfSpeech[token.POS]).length; }).reduce(function (a, b) {
        if (b > a) {
            return b;
        }
        else {
            return a;
        }
    });
    var tokenArrayString = tokens.map(function (token) { return tokenToString(token, s1, s2, s3, s4, s5); }).join("\n");
    return divider + "\n" + tokenArrayString + "\n" + divider;
}
exports.tokenArrayToString = tokenArrayToString;
// ----------------------------------------------------------------------------
// Utility functions
// ----------------------------------------------------------------------------
function flattenNestedArray(nestedArray) {
    var flattened = [].concat.apply([], nestedArray);
    return flattened;
}
function onlyUnique(value, index, self) {
    return self.indexOf(value) === index;
}
function arrayIntersect(a, b) {
    var ai = 0;
    var bi = 0;
    var result = [];
    while (ai < a.length && bi < b.length) {
        if (a[ai] < b[bi])
            ai++;
        else if (a[ai] > b[bi])
            bi++;
        else {
            result.push(a[ai]);
            ai++;
            bi++;
        }
    }
    return result;
}
function isNumeric(n) {
    return !isNaN(parseFloat(n)) && isFinite(n);
}
function allFound(node) {
    var cFound = node.children.map(allFound).every(function (c) { return c; });
    if (cFound && node.found) {
        return true;
    }
    else {
        return false;
    }
}
window["NLQP"] = exports;

},{"./app":9}],9:[function(require,module,exports){
/// <reference path="microReact.ts" />
/// <reference path="../vendor/marked.d.ts" />
var microReact = require("./microReact");
var runtime = require("./runtime");
var uiRenderer_1 = require("./uiRenderer");
var utils_1 = require("./utils");
exports.syncedTables = ["sourced eav", "view", "action", "action source", "action mapping", "action mapping constant", "action mapping sorted", "action mapping limit"];
exports.eveLocalStorageKey = "eve";
//---------------------------------------------------------
// Renderer
//---------------------------------------------------------
var perfStats;
var perfStatsUi;
var updateStat = 0;
function initRenderer() {
    exports.renderer = new microReact.Renderer();
    exports.uiRenderer = new uiRenderer_1.UIRenderer(exports.eve);
    document.body.appendChild(exports.renderer.content);
    window.addEventListener("resize", render);
    perfStatsUi = document.createElement("div");
    perfStatsUi.id = "perfStats";
    document.body.appendChild(perfStatsUi);
}
if (utils_1.ENV === "browser")
    var performance = window["performance"] || { now: function () { return (new Date()).getTime(); } };
exports.renderRoots = {};
function render() {
    if (!exports.renderer || exports.renderer.queued)
        return;
    exports.renderer.queued = true;
    requestAnimationFrame(function () {
        var stats = {};
        var start = performance.now();
        var trees = [];
        for (var root in exports.renderRoots) {
            trees.push(exports.renderRoots[root]());
        }
        stats.root = (performance.now() - start).toFixed(2);
        if (+stats.root > 10)
            console.info("Slow root: " + stats.root);
        start = performance.now();
        var dynamicUI = exports.eve.find("system ui").map(function (ui) { return ui["template"]; });
        if (utils_1.DEBUG && utils_1.DEBUG.UI_COMPILE) {
            console.info("compiling", dynamicUI);
            console.info("*", exports.uiRenderer.compile(dynamicUI));
        }
        trees.push.apply(trees, exports.uiRenderer.compile(dynamicUI));
        stats.uiCompile = (performance.now() - start).toFixed(2);
        if (+stats.uiCompile > 10)
            console.info("Slow ui compile: " + stats.uiCompile);
        start = performance.now();
        exports.renderer.render(trees);
        stats.render = (performance.now() - start).toFixed(2);
        stats.update = updateStat.toFixed(2);
        var html = "";
        html += "<span>root: " + stats.root + "</span>";
        // html += `<span>ui compile: ${stats.uiCompile}</span>`;
        html += "<span>render: " + stats.render + "</span>";
        html += "<span>update: " + stats.update + "</span>";
        perfStatsUi.innerHTML = html;
        perfStats = stats;
        exports.renderer.queued = false;
    });
}
exports.render = render;
var storeQueued = false;
function storeLocally() {
    if (storeQueued)
        return;
    storeQueued = true;
    setTimeout(function () {
        var serialized = exports.eve.serialize(true);
        if (exports.eveLocalStorageKey === "eve") {
            for (var _i = 0; _i < exports.syncedTables.length; _i++) {
                var synced = exports.syncedTables[_i];
                delete serialized[synced];
            }
        }
        delete serialized["provenance"];
        localStorage[exports.eveLocalStorageKey] = JSON.stringify(serialized);
        storeQueued = false;
    }, 1000);
}
//---------------------------------------------------------
// Dispatch
//---------------------------------------------------------
var dispatches = {};
function handle(event, func) {
    if (dispatches[event]) {
        console.error("Overwriting handler for '" + event + "'");
    }
    dispatches[event] = func;
}
exports.handle = handle;
function dispatch(event, info, dispatchInfo) {
    var result = dispatchInfo;
    if (!result) {
        result = exports.eve.diff();
        result.meta.render = true;
        result.meta.store = true;
    }
    result.dispatch = function (event, info) {
        return dispatch(event, info, result);
    };
    result.commit = function () {
        var start = performance.now();
        // result.remove("builtin entity", {entity: "render performance statistics"});
        // result.add("builtin entity", {entity: "render performance statistics", content: `
        // # Render performance statistics ({is a: system})
        // root: {root: ${perfStats.root}}
        // ui compile: {ui compile: ${perfStats.uiCompile}}
        // render: {render: ${perfStats.render}}
        // update: {update: ${perfStats.update}}
        // Horrible hack, disregard this: {perf stats: render performance statistics}
        // `});
        if (!runtime.INCREMENTAL) {
            exports.eve.applyDiff(result);
        }
        else {
            exports.eve.applyDiffIncremental(result);
        }
        if (result.meta.render) {
            render();
        }
        if (result.meta.store) {
            storeLocally();
            if (exports.eveLocalStorageKey === "eve") {
                sendChangeSet(result);
            }
        }
        updateStat = performance.now() - start;
    };
    if (!event)
        return result;
    var func = dispatches[event];
    if (!func) {
        console.error("No dispatches for '" + event + "' with " + JSON.stringify(info));
    }
    else {
        func(result, info);
    }
    return result;
}
exports.dispatch = dispatch;
// No-op dispatch to trigger a rerender or start a chain.
handle("rerender", function (changes) {
});
//---------------------------------------------------------
// State
//---------------------------------------------------------
exports.eve = runtime.indexer();
exports.initializers = {};
exports.activeSearches = {};
function init(name, func) {
    exports.initializers[name] = func;
}
exports.init = init;
function executeInitializers() {
    for (var initName in exports.initializers) {
        exports.initializers[initName]();
    }
}
//---------------------------------------------------------
// Websocket
//---------------------------------------------------------
var me = utils_1.uuid();
if (this.localStorage) {
    if (localStorage["me"])
        me = localStorage["me"];
    else
        localStorage["me"] = me;
}
function connectToServer() {
    exports.socket = new WebSocket("ws://" + (window.location.hostname || "localhost") + ":8080");
    exports.socket.onerror = function () {
        console.error("Failed to connect to server, falling back to local storage");
        exports.eveLocalStorageKey = "local-eve";
        executeInitializers();
        render();
    };
    exports.socket.onopen = function () {
        sendServer("connect", me);
    };
    exports.socket.onmessage = function (data) {
        var parsed = JSON.parse(data.data);
        console.log("WS MESSAGE:", parsed);
        if (parsed.kind === "load") {
            // eve.load(parsed.data);
            executeInitializers();
            render();
        }
        else if (parsed.kind === "changeset") {
            var diff = exports.eve.diff();
            diff.tables = parsed.data;
            exports.eve.applyDiff(diff);
            render();
        }
    };
}
function sendServer(messageKind, data) {
    if (!exports.socket)
        return;
    exports.socket.send(JSON.stringify({ kind: messageKind, me: me, time: (new Date).getTime(), data: data }));
}
function sendChangeSet(changeset) {
    if (!exports.socket)
        return;
    var changes = {};
    var send = false;
    for (var _i = 0; _i < exports.syncedTables.length; _i++) {
        var table = exports.syncedTables[_i];
        if (changeset.tables[table]) {
            send = true;
            changes[table] = changeset.tables[table];
        }
    }
    if (send)
        sendServer("changeset", changes);
}
//---------------------------------------------------------
// Go
//---------------------------------------------------------
if (utils_1.ENV === "browser") {
    document.addEventListener("DOMContentLoaded", function (event) {
        initRenderer();
        // connectToServer();
        exports.eveLocalStorageKey = "local-eve";
        executeInitializers();
        render();
    });
}
init("load data", function () {
    var stored = localStorage[exports.eveLocalStorageKey];
    if (stored) {
        exports.eve.load(stored);
    }
});
if (utils_1.ENV === "browser")
    window["app"] = exports;

},{"./microReact":12,"./runtime":15,"./uiRenderer":17,"./utils":19}],10:[function(require,module,exports){
var utils_1 = require("./utils");
var runtime = require("./runtime");
var app = require("./app");
var app_1 = require("./app");
var parser_1 = require("./parser");
var NLQueryParser_1 = require("./NLQueryParser");
var uiRenderer_1 = require("./uiRenderer");
exports.ixer = app_1.eve;
//-----------------------------------------------------------------------------
// Utilities
//-----------------------------------------------------------------------------
runtime.define("normalize string", { result: "result" }, function (text) {
    if (typeof text === "string") {
        return { result: NLQueryParser_1.normalizeString(text) };
    }
    return { result: text };
});
// export function UIFromDSL(str:string):UI {
//   function processElem(data:UIElem):UI {
//     let elem = new UI(data.id || uuid());
//     if(data.binding) elem.bind(data.bindingKind === "query" ? parseDSL(data.binding);
//     if(data.embedded) elem.embed(data.embedded);
//     if(data.attributes) elem.attributes(data.attributes);
//     if(data.events) elem.events(data.events);
//     if(data.children) {
//       for(let child of data.children) elem.child(processElem(child));
//     }
//     return elem;
//   }
//   return processElem(parseUI(str));
// }
var BSPhase = (function () {
    function BSPhase(ixer, changeset) {
        if (changeset === void 0) { changeset = ixer.diff(); }
        this.ixer = ixer;
        this.changeset = changeset;
        this._views = {};
        this._viewFields = {};
        this._entities = [];
        this._uis = {};
        this._queries = {};
        this._names = {};
    }
    BSPhase.prototype.viewKind = function (view) {
        return this._views[view];
    };
    BSPhase.prototype.viewFields = function (view) {
        return this._viewFields[view];
    };
    BSPhase.prototype.apply = function (nukeExisting) {
        for (var view in this._views) {
            if (this._views[view] === "table")
                exports.ixer.addTable(view, this._viewFields[view]);
        }
        if (nukeExisting) {
            for (var view in this._views) {
                if (this._views[view] !== "table")
                    this.changeset.merge(runtime.Query.remove(view, this.ixer));
            }
            for (var _i = 0, _a = this._entities; _i < _a.length; _i++) {
                var entity = _a[_i];
                this.changeset.remove("builtin entity", { entity: entity });
            }
            for (var ui in this._uis)
                this.changeset.merge(uiRenderer_1.UI.remove(ui, this.ixer));
        }
        exports.ixer.applyDiff(this.changeset);
    };
    //-----------------------------------------------------------------------------
    // Macros
    //-----------------------------------------------------------------------------
    BSPhase.prototype.addFact = function (table, fact) {
        this.changeset.add(table, fact);
        return this;
    };
    BSPhase.prototype.addEntity = function (entity, name, kinds, attributes, extraContent) {
        entity = utils_1.builtinId(entity);
        this._names[name] = entity;
        this._entities.push(entity);
        this.addFact("display name", { id: entity, name: name });
        var isAs = [];
        for (var _i = 0; _i < kinds.length; _i++) {
            var kind = kinds[_i];
            var sourceId = entity + ",is a," + kind;
            isAs.push("{" + kind + "|rep=link; eav source = " + sourceId + "}");
            var collEntity = utils_1.builtinId(kind);
            this.addFact("display name", { id: collEntity, name: kind });
            this.addFact("sourced eav", { entity: entity, attribute: "is a", value: collEntity, source: sourceId });
        }
        var collectionsText = "";
        if (isAs.length)
            collectionsText = utils_1.titlecase(name) + " is a " + isAs.slice(0, -1).join(", ") + " " + (isAs.length > 1 ? "and" : "") + " " + isAs[isAs.length - 1] + ".";
        var content = (_a = ["\n      ", "\n    "], _a.raw = ["\n      ", "\n    "], utils_1.unpad(6)(_a, collectionsText));
        if (attributes) {
            for (var attr in attributes) {
                var sourceId = entity + "," + attr + "," + attributes[attr];
                var value = this._names[attributes[attr]] || attributes[attr];
                this.addFact("sourced eav", { entity: entity, attribute: attr, value: value, source: sourceId });
            }
        }
        if (extraContent)
            content += "\n" + extraContent;
        var page = entity + "|root";
        this.addFact("page content", { page: page, content: content });
        this.addFact("entity page", { entity: entity, page: page });
        return this;
        var _a;
    };
    BSPhase.prototype.addView = function (view, kind, fields) {
        this._views[view] = kind;
        this._viewFields[view] = fields;
        this.addFact("view", { view: view, kind: kind });
        for (var _i = 0; _i < fields.length; _i++) {
            var field = fields[_i];
            this.addFact("field", { view: view, field: field });
        }
        var entity = view + " view";
        this.addEntity(entity, entity, ["system", kind], undefined, (_a = ["\n      ## Fields\n      ", "\n    "], _a.raw = ["\n      ## Fields\n      ", "\n    "], utils_1.unpad(6)(_a, fields.map(function (field) { return ("* " + field); }).join("\n      "))));
        return this;
        var _a;
    };
    BSPhase.prototype.addTable = function (view, fields) {
        this.addView(view, "table", fields);
        return this;
    };
    BSPhase.prototype.addUnion = function (view, fields, builtin) {
        if (builtin === void 0) { builtin = true; }
        this.addView(view, "union", fields);
        if (builtin) {
            var table = "builtin " + view;
            this.addTable(table, fields);
            this.addUnionMember(view, table);
        }
        return this;
    };
    BSPhase.prototype.addUnionMember = function (union, member, mapping) {
        // apply the natural mapping.
        if (!mapping) {
            if (this.viewKind(union) !== "union")
                throw new Error("Union '" + union + "' must be added before adding members");
            mapping = {};
            for (var _i = 0, _a = this.viewFields(union); _i < _a.length; _i++) {
                var field = _a[_i];
                mapping[field] = field;
            }
        }
        var action = union + " <-- " + member + " <-- " + JSON.stringify(mapping);
        this.addFact("action", { view: union, action: action, kind: "union", ix: 0 })
            .addFact("action source", { action: action, "source view": member });
        for (var field in mapping) {
            var mapped = mapping[field];
            if (mapped.constructor === Array) {
                this.addFact("action mapping constant", { action: action, from: field, "value": mapped[0] });
            }
            else {
                this.addFact("action mapping", { action: action, from: field, "to source": member, "to field": mapped });
            }
        }
        return this;
    };
    BSPhase.prototype.addQuery = function (view, query) {
        query.name = view;
        this._queries[view] = query;
        this.addView(view, "query", Object.keys(query.projectionMap || {}));
        this.changeset.merge(query.changeset(this.ixer));
        return this;
    };
    BSPhase.prototype.addArtifacts = function (artifacts) {
        var views = artifacts.views;
        for (var view in artifacts.views) {
            this._views[view] = "query";
        }
        for (var id in views)
            this.changeset.merge(views[id].changeset(app_1.eve));
        return this;
    };
    BSPhase.prototype.addUI = function (id, ui) {
        ui.id = id;
        this._uis[id] = ui;
        this.addEntity(id, id, ["system", "ui"]);
        this.changeset.merge(ui.changeset(this.ixer));
        return this;
    };
    return BSPhase;
})();
//-----------------------------------------------------------------------------
// Runtime Setup
//-----------------------------------------------------------------------------
app.init("bootstrap", function bootstrap() {
    //-----------------------------------------------------------------------------
    // Entity System
    //-----------------------------------------------------------------------------
    var phase = new BSPhase(app_1.eve);
    phase.changeset.addMany("display name", [{ id: "is a", name: "is a" }, { id: "content", name: "content" }, { id: "artifact", name: "artifact" }]);
    phase.addTable("manual entity", ["entity", "content"]);
    phase.addTable("sourced eav", ["entity", "attribute", "value", "source"]);
    phase.addTable("page content", ["page", "content"]);
    phase.addTable("entity page", ["entity", "page"]);
    phase.addTable("action entity", ["entity", "content", "source"]);
    phase
        .addEntity("entity", "entity", ["system"])
        .addEntity("collection", "collection", ["system"])
        .addEntity("system", "system", ["system", "collection"])
        .addEntity("union", "union", ["system", "collection"])
        .addEntity("query", "query", ["system", "collection"])
        .addEntity("table", "table", ["system", "collection"])
        .addEntity("ui", "ui", ["system", "collection"])
        .addEntity("home", "home", ["system"], undefined, (_a = ["\n      {entity|rep = directory}\n    "], _a.raw = ["\n      {entity|rep = directory}\n    "], utils_1.unpad(6)(_a)));
    phase.addUnion("entity eavs", ["entity", "attribute", "value"], true)
        .addUnionMember("entity eavs", "generated eav", { entity: "entity", attribute: "attribute", value: "value" })
        .addUnionMember("entity eavs", "sourced eav", { entity: "entity", attribute: "attribute", value: "value" })
        .addUnionMember("entity eavs", "added eavs");
    phase.addUnion("entity links", ["entity", "link", "type"])
        .addUnionMember("entity links", "eav entity links")
        .addUnionMember("entity links", "is a attributes", { entity: "entity", link: "collection", type: ["is a"] });
    phase.addUnion("directionless links", ["entity", "link"])
        .addUnionMember("directionless links", "entity links")
        .addUnionMember("directionless links", "entity links", { entity: "link", link: "entity" });
    phase.addUnion("collection entities", ["entity", "collection"])
        .addUnionMember("collection entities", "is a attributes");
    phase.addArtifacts(parser_1.parseDSL("\n    (query :$$view \"bs: index name\"\n      (display-name :id id :name raw)\n      (normalize-string :text raw :result name)\n      (project! \"index name\" :id id :name name))\n  "));
    phase.addArtifacts(parser_1.parseDSL("\n    (query :$$view \"bs: entity\"\n      (entity-page :entity entity :page page)\n      (page-content :page page :content content)\n      (project! \"entity\" :entity entity :content content))\n  "));
    phase.addArtifacts(parser_1.parseDSL("\n    (query :$$view \"bs: unmodified added bits\"\n      (added-bits :entity entity :content content)\n      (negate (manual-entity :entity entity))\n      (project! \"unmodified added bits\" :entity entity :content content))\n  "));
    phase.addArtifacts(parser_1.parseDSL("\n    (query :$$view \"bs: is a attributes\"\n      (entity-eavs :attribute \"is a\" :entity entity :value value)\n      (project! \"is a attributes\" :collection value :entity entity))\n  "));
    // @HACK: this view is required because you can't currently join a select on the result of a function.
    // so we create a version of the eavs table that already has everything lowercased.
    phase.addArtifacts(parser_1.parseDSL("\n    (query :$$view \"bs: lowercase eavs\"\n      (entity-eavs :entity entity :attribute attribute :value value)\n      (lowercase :text value :result lowercased)\n      (project! \"lowercase eavs\" :entity entity :attribute attribute :value lowercased))\n  "));
    phase.addArtifacts(parser_1.parseDSL("\n    (query :$$view \"bs: eav entity links\"\n      (entity-eavs :entity entity :attribute attribute :value value)\n      (entity :entity value)\n      (project! \"eav entity links\" :entity entity :type attribute :link value))\n  "));
    phase.addArtifacts(parser_1.parseDSL("\n    (query :$$view \"bs: collection\"\n      (is-a-attributes :collection entity)\n      (query :$$view \"bs: collection count\"\n        (is-a-attributes :collection entity :entity child)\n        (count :count childCount))\n      (project! \"collection\" :collection entity :count childCount))\n  "));
    phase.addEntity("entity", "entity", ["system"]);
    phase.addEntity("collection", "collection", ["system"]);
    phase.addArtifacts(parser_1.parseDSL((_b = ["\n    (query :$$view \"bs: entity eavs from entities\"\n      (entity :entity entity)\n      (project! \"entity eavs\" :entity entity :attribute \"is a\" :value \"", "\"))\n  "], _b.raw = ["\n    (query :$$view \"bs: entity eavs from entities\"\n      (entity :entity entity)\n      (project! \"entity eavs\" :entity entity :attribute \"is a\" :value \"", "\"))\n  "], utils_1.unpad(4)(_b, utils_1.builtinId("entity")))));
    phase.addArtifacts(parser_1.parseDSL((_c = ["\n    (query :$$view \"bs: entity eavs from collections\"\n      (is-a-attributes :collection coll)\n      (project! \"entity eavs\" :entity coll :attribute \"is a\" :value \"", "\"))\n  "], _c.raw = ["\n    (query :$$view \"bs: entity eavs from collections\"\n      (is-a-attributes :collection coll)\n      (project! \"entity eavs\" :entity coll :attribute \"is a\" :value \"", "\"))\n  "], utils_1.unpad(4)(_c, utils_1.builtinId("collection")))));
    /*  phase.addArtifacts(parseDSL(unpad(4) `
        (query
          (entity :entity entity)
          (negate (query
            (directionless-links :entity entity :link link)
            (!= link "AUTOGENERATED entity THIS SHOULDN'T SHOW UP ANYWHERE")
            (!= link "AUTOGENERATED orphaned THIS SHOULDN'T SHOW UP ANYWHERE")
            ))
          (project! "entity eavs" :entity coll :attribute "is a" :value "AUTOGENERATED collection THIS SHOULDN'T SHOW UP ANYWHERE"))
    `));*/
    phase.addTable("ui pane", ["pane", "kind", "rep", "contains", "params"]);
    if (app_1.eve.find("ui pane").length === 0)
        phase.addFact("ui pane", { pane: "p1", kind: 0, rep: "entity", contains: "", params: "" });
    phase.apply(true);
    //-----------------------------------------------------------------------------
    // UI
    //-----------------------------------------------------------------------------
    phase = new BSPhase(app_1.eve);
    // @FIXME: These should probably be unionized.
    function resolve(table, fields) {
        return fields.map(function (field) { return (table + ": " + field); });
    }
    phase.addTable("ui template", resolve("ui template", ["template", "parent", "ix"]));
    phase.addTable("ui template binding", resolve("ui template binding", ["template", "query"]));
    phase.addTable("ui embed", resolve("ui embed", ["embed", "template", "parent", "ix"]));
    phase.addTable("ui embed scope", resolve("ui embed scope", ["embed", "key", "value"]));
    phase.addTable("ui embed scope binding", resolve("ui embed scope binding", ["embed", "key", "source", "alias"]));
    phase.addTable("ui attribute", resolve("ui attribute", ["template", "property", "value"]));
    phase.addTable("ui attribute binding", resolve("ui attribute binding", ["template", "property", "source", "alias"]));
    phase.addTable("ui event", resolve("ui event", ["template", "event"]));
    phase.addTable("ui event state", resolve("ui event state", ["template", "event", "key", "value"]));
    phase.addTable("ui event state binding", resolve("ui event state binding", ["template", "event", "key", "source", "alias"]));
    phase.addTable("system ui", ["template"]);
    phase.apply(true);
    //-----------------------------------------------------------------------------
    // Testing
    //-----------------------------------------------------------------------------
    phase = new BSPhase(app_1.eve);
    var testData = {
        "test data": [],
        pet: [],
        exotic: [],
        dangerous: [],
        cat: ["pet"],
        dog: ["pet"],
        fish: ["pet"],
        snake: ["pet", "exotic"],
        koala: ["pet", "exotic"],
        sloth: ["pet", "exotic"],
        kangaroo: ["exotic"],
        giraffe: ["exotic"],
        gorilla: ["exotic", "dangerous"],
        company: [],
        kodowa: ["company"],
        department: [],
        engineering: ["department"],
        operations: ["department"],
        magic: ["department"],
        employee: [],
        josh: ["employee"],
        corey: ["employee"],
        chris: ["employee"],
        rob: ["employee"],
        eric: ["employee"],
    };
    var testAttrs = {
        cat: { length: 4 },
        dog: { length: 3 },
        fish: { length: 1 },
        snake: { length: 4 },
        koala: { length: 3 },
        sloth: { length: 3 },
        engineering: { company: "kodowa" },
        operations: { company: "kodowa" },
        magic: { company: "kodowa" },
        josh: { department: "engineering", salary: 7 },
        corey: { department: "engineering", salary: 10 },
        chris: { department: "engineering", salary: 10 },
        eric: { department: "engineering", salary: 7 },
        rob: { department: "operations", salary: 10 },
    };
    for (var entity in testData)
        phase.addEntity(entity, entity, ["test data"].concat(testData[entity]), testAttrs[entity], "");
    // phase.addTable("department", ["department"])
    //   .addFact("department", {department: "engineering"})
    //   .addFact("department", {department: "operations"})
    //   .addFact("department", {department: "magic"});
    // phase.addTable("employee", ["department", "employee", "salary"])
    //   .addFact("employee", {department: "engineering", employee: "josh", salary: 10})
    //   .addFact("employee", {department: "engineering", employee: "corey", salary: 11})
    //   .addFact("employee", {department: "engineering", employee: "chris", salary: 7})
    //   .addFact("employee", {department: "operations", employee: "rob", salary: 7});
    // phase.apply(true);
    window["p"] = phase;
    var _a, _b, _c;
});
window["bootstrap"] = exports;

},{"./NLQueryParser":8,"./app":9,"./parser":13,"./runtime":15,"./uiRenderer":17,"./utils":19}],11:[function(require,module,exports){
var utils_1 = require("./utils");
function sum(list) {
    var total = 0;
    for (var _i = 0; _i < list.length; _i++) {
        var num = list[_i];
        total += num;
    }
    return total;
}
function vecmul(a, b) {
    if (!a || !b || a.length !== b.length)
        throw new Error("Lists must be same length");
    var result = [];
    for (var i = 0, len = a.length; i < len; i++)
        result[i] = a[i] * b[i];
    return result;
}
var _layouts = [
    { size: 4, c: "big" },
    { size: 2, c: "detailed" },
    { size: 1, c: "normal", grouped: 2 },
];
function masonry(elem) {
    var _a = elem.seed, seed = _a === void 0 ? 0 : _a, _b = elem.rowSize, rowSize = _b === void 0 ? 8 : _b, _c = elem.layouts, layouts = _c === void 0 ? _layouts : _c, _d = elem.styles, styles = _d === void 0 ? undefined : _d, children = elem.children;
    var rand = utils_1.srand(seed);
    layouts.sort(utils_1.sortByField("size"));
    // Assign notional tiles an initial size based on the visual frequency of each layout
    var ix = 0;
    var tilesPerLayout = [];
    var totalLayoutFreq = 0;
    var sizes = [];
    for (var _i = 0; _i < layouts.length; _i++) {
        var layout = layouts[_i];
        layout.freq = layout.freq || 1 / layout.size;
        totalLayoutFreq += layout.freq;
    }
    for (var _e = 0; _e < layouts.length; _e++) {
        var layout = layouts[_e];
        sizes[ix] = layout.size;
        tilesPerLayout[ix++] = Math.round(layout.freq / totalLayoutFreq * children.length);
    }
    // Ensure every notional tile has an assigned size (to fix rounding errors)
    var total;
    var tryIx = 0;
    while ((total = sum(tilesPerLayout)) !== children.length) {
        if (sum(tilesPerLayout) > children.length)
            tilesPerLayout[tilesPerLayout.length - 1] -= 1;
        else if (sum(tilesPerLayout) < children.length)
            tilesPerLayout[tilesPerLayout.length - 1] += 1;
    }
    // Optimize distribution of notional tiles to maximally fill rows
    tryIx = 0, ix = 0;
    var minSize = layouts[layouts.length - 1].size;
    while (true) {
        var filledSize_1 = sum(vecmul(tilesPerLayout, sizes));
        var rowCount_1 = Math.ceil(filledSize_1 / rowSize);
        var delta = rowSize * rowCount_1 - filledSize_1;
        if (delta <= 0 || tryIx++ > 1000)
            break;
        // Since we'll be shifting one of the smallest layout tiles to a bigger size, we offset by that size
        if (ix === layouts.length - 1)
            ix = 0;
        if (delta >= layouts[ix].size - minSize) {
            tilesPerLayout[layouts.length - 1]--;
            tilesPerLayout[ix]++;
        }
        else if (ix === layouts.length - 2) {
            // The second smallest size was still too large, we're done.
            break;
        }
        ix++;
    }
    // Assign discrete tiles to sizes based on their relative size ordering
    children.sort(utils_1.sortByField("size"));
    var tiles = [], layoutIx = 0, tileIx = 0;
    for (var _f = 0; _f < tilesPerLayout.length; _f++) {
        var count = tilesPerLayout[_f];
        var layout = layouts[layoutIx++];
        if (!layout.grouped) {
            for (var ix_1 = tileIx; ix_1 < tileIx + count; ix_1++) {
                var tile = children[ix_1];
                tile.c = "directory-tile " + (tile.c || "") + " " + (layout.c || "");
                if (styles)
                    tile.c += " " + styles[tileIx % styles.length];
                if (layout.format)
                    tile = layout.format(tile);
                tiles.push({ c: "group " + (layout.c || ""), layout: layout, size: layout.size, children: [tile] });
            }
        }
        else {
            // Grouped layouts are grouped at this stage to keep the layout process 1-dimensional
            var added = 0;
            ;
            for (var ix_2 = tileIx; ix_2 < tileIx + count; ix_2 += layout.grouped) {
                var group = { c: "group " + (layout.c || ""), layout: layout, size: layout.size * layout.grouped, children: [] };
                for (var partIx = 0; partIx < layout.grouped && added < count; partIx++) {
                    var tile = children[ix_2 + partIx];
                    tile.c = "directory-tile " + (tile.c || "") + " " + (layout.c || "");
                    if (styles)
                        tile.c += " " + styles[(tileIx + partIx) % styles.length];
                    if (layout.format)
                        tile = layout.format(tile);
                    group.children.push(tile);
                    added++;
                }
                tiles.push(group);
            }
        }
        tileIx += count;
    }
    // @TODO: Pull tiles from bag, distributing them evenly into rows
    var filledSize = sum(vecmul(tilesPerLayout, sizes));
    var rowCount = Math.ceil(filledSize / rowSize);
    var rows = [];
    for (var ix_3 = 0; ix_3 < rowCount; ix_3++)
        rows.push({ c: "masonry-row", children: [], size: 0 });
    tryIx = 0;
    var rowIx = 0;
    for (var _g = 0; _g < tiles.length; _g++) {
        var tile = tiles[_g];
        var size = tile.layout.size * (tile.layout.grouped || 1);
        var placed = false;
        var attempts = 0;
        while (!placed) {
            var row = rows[rowIx];
            if (row.size + size <= rowSize) {
                row.size += size;
                row.children.push(tile);
                placed = true;
            }
            rowIx++;
            if (rowIx >= rowCount)
                rowIx = 0;
            attempts++;
            if (attempts === rowCount)
                break;
        }
        if (!placed)
            console.error("Could not place tile", tile);
    }
    ix = 0;
    // Shuffle the row contents and the set of rows for pleasing irregularity
    for (var _h = 0; _h < rows.length; _h++) {
        var row = rows[_h];
        utils_1.shuffle(row.children, rand);
    }
    utils_1.shuffle(rows, rand);
    elem.c = "masonry " + (elem.c || "");
    elem.children = rows;
    return elem;
}
exports.masonry = masonry;

},{"./utils":19}],12:[function(require,module,exports){
function now() {
    if (window.performance) {
        return window.performance.now();
    }
    return (new Date()).getTime();
}
function shallowEquals(a, b) {
    if (a === b)
        return true;
    if (!a || !b)
        return false;
    for (var k in a) {
        if (a[k] !== b[k])
            return false;
    }
    for (var k in b) {
        if (b[k] !== a[k])
            return false;
    }
    return true;
}
function postAnimationRemove(elements) {
    for (var _i = 0; _i < elements.length; _i++) {
        var elem = elements[_i];
        if (elem.parentNode)
            elem.parentNode.removeChild(elem);
    }
}
var Renderer = (function () {
    function Renderer() {
        this.content = document.createElement("div");
        this.content.className = "__root";
        this.elementCache = { "__root": this.content };
        this.prevTree = {};
        this.tree = {};
        this.postRenders = [];
        this.lastDiff = { adds: [], updates: {} };
        var self = this;
        this.handleEvent = function handleEvent(e) {
            var id = (e.currentTarget || e.target)["_id"];
            var elem = self.tree[id];
            if (!elem)
                return;
            var handler = elem[e.type];
            if (handler) {
                handler(e, elem);
            }
        };
    }
    Renderer.compile = function (elem) {
        if (!elem.id)
            throw new Error("Cannot compile element with id " + elem.id);
        var renderer = Renderer._compileRenderer[elem.id];
        if (!renderer)
            renderer = Renderer._compileRenderer[elem.id] = new Renderer();
        renderer.render([elem]);
        return renderer.elementCache[elem.id];
    };
    Renderer.prototype.reset = function () {
        this.prevTree = this.tree;
        this.tree = {};
        this.postRenders = [];
    };
    Renderer.prototype.domify = function () {
        var fakePrev = {}; //create an empty object once instead of every instance of the loop
        var elements = this.tree;
        var prevElements = this.prevTree;
        var diff = this.lastDiff;
        var adds = diff.adds;
        var updates = diff.updates;
        var elemKeys = Object.keys(updates);
        var elementCache = this.elementCache;
        var tempTween = {};
        //Create all the new elements to ensure that they're there when they need to be
        //parented
        for (var i = 0, len = adds.length; i < len; i++) {
            var id = adds[i];
            var cur = elements[id];
            var div;
            if (cur.svg) {
                div = document.createElementNS("http://www.w3.org/2000/svg", cur.t || "rect");
            }
            else {
                div = document.createElement(cur.t || "div");
            }
            div._id = id;
            elementCache[id] = div;
            if (cur.enter) {
                if (cur.enter.delay) {
                    cur.enter.display = "auto";
                    div.style.display = "none";
                }
                Velocity(div, cur.enter, cur.enter);
            }
        }
        for (var i = 0, len = elemKeys.length; i < len; i++) {
            var id = elemKeys[i];
            var cur = elements[id];
            var prev = prevElements[id] || fakePrev;
            var type = updates[id];
            var div;
            if (type === "replaced") {
                var me = elementCache[id];
                if (me.parentNode)
                    me.parentNode.removeChild(me);
                if (cur.svg) {
                    div = document.createElementNS("http://www.w3.org/2000/svg", cur.t || "rect");
                }
                else {
                    div = document.createElement(cur.t || "div");
                }
                prev = fakePrev;
                div._id = id;
                elementCache[id] = div;
            }
            else if (type === "removed") {
                //NOTE: Batching the removes such that you only remove the parent
                //didn't actually make this faster surprisingly. Given that this
                //strategy is much simpler and there's no noticable perf difference
                //we'll just do the dumb thing and remove all the children one by one.
                var me = elementCache[id];
                if (prev.leave) {
                    prev.leave.complete = postAnimationRemove;
                    if (prev.leave.absolute) {
                        me.style.position = "absolute";
                    }
                    Velocity(me, prev.leave, prev.leave);
                }
                else if (me.parentNode)
                    me.parentNode.removeChild(me);
                elementCache[id] = null;
                continue;
            }
            else {
                div = elementCache[id];
            }
            var style = div.style;
            if (cur.c !== prev.c)
                div.className = cur.c;
            if (cur.draggable !== prev.draggable)
                div.draggable = cur.draggable === undefined ? null : "true";
            if (cur.contentEditable !== prev.contentEditable)
                div.contentEditable = cur.contentEditable !== undefined ? JSON.stringify(cur.contentEditable) : "inherit";
            if (cur.colspan !== prev.colspan)
                div.colSpan = cur.colspan;
            if (cur.placeholder !== prev.placeholder)
                div.setAttribute("placeholder", cur.placeholder);
            if (cur.selected !== prev.selected)
                div.selected = cur.selected;
            if ((cur.value !== prev.value || cur.strictText) && div.value !== cur.value)
                div.value = cur.value;
            if (cur.t === "input" && cur.type !== prev.type)
                div.type = cur.type;
            if (cur.t === "input" && cur.checked !== prev.checked)
                div.checked = cur.checked;
            if ((cur.text !== prev.text || cur.strictText) && div.textContent !== cur.text)
                div.textContent = cur.text === undefined ? "" : cur.text;
            if (cur.tabindex !== prev.tabindex)
                div.setAttribute("tabindex", cur.tabindex);
            if (cur.href !== prev.href)
                div.setAttribute("href", cur.href);
            if (cur.src !== prev.src)
                div.setAttribute("src", cur.src);
            if (cur.target !== prev.target)
                div.setAttribute("target", cur.target);
            if (cur.data !== prev.data)
                div.setAttribute("data", cur.data);
            if (cur.download !== prev.download)
                div.setAttribute("download", cur.download);
            if (cur.allowfullscreen !== prev.allowfullscreen)
                div.setAttribute("allowfullscreen", cur.allowfullscreen);
            // animateable properties
            var tween = cur.tween || tempTween;
            if (cur.flex !== prev.flex) {
                if (tween.flex)
                    tempTween.flex = cur.flex;
                else
                    style.flex = cur.flex === undefined ? "" : cur.flex;
            }
            if (cur.left !== prev.left) {
                if (tween.left)
                    tempTween.left = cur.left;
                else
                    style.left = cur.left === undefined ? "" : cur.left;
            }
            if (cur.top !== prev.top) {
                if (tween.top)
                    tempTween.top = cur.top;
                else
                    style.top = cur.top === undefined ? "" : cur.top;
            }
            if (cur.height !== prev.height) {
                if (tween.height)
                    tempTween.height = cur.height;
                else
                    style.height = cur.height === undefined ? "auto" : cur.height;
            }
            if (cur.width !== prev.width) {
                if (tween.width)
                    tempTween.width = cur.width;
                else
                    style.width = cur.width === undefined ? "auto" : cur.width;
            }
            if (cur.zIndex !== prev.zIndex) {
                if (tween.zIndex)
                    tempTween.zIndex = cur.zIndex;
                else
                    style.zIndex = cur.zIndex;
            }
            if (cur.backgroundColor !== prev.backgroundColor) {
                if (tween.backgroundColor)
                    tempTween.backgroundColor = cur.backgroundColor;
                else
                    style.backgroundColor = cur.backgroundColor || "transparent";
            }
            if (cur.borderColor !== prev.borderColor) {
                if (tween.borderColor)
                    tempTween.borderColor = cur.borderColor;
                else
                    style.borderColor = cur.borderColor || "none";
            }
            if (cur.borderWidth !== prev.borderWidth) {
                if (tween.borderWidth)
                    tempTween.borderWidth = cur.borderWidth;
                else
                    style.borderWidth = cur.borderWidth || 0;
            }
            if (cur.borderRadius !== prev.borderRadius) {
                if (tween.borderRadius)
                    tempTween.borderRadius = cur.borderRadius;
                else
                    style.borderRadius = (cur.borderRadius || 0) + "px";
            }
            if (cur.opacity !== prev.opacity) {
                if (tween.opacity)
                    tempTween.opacity = cur.opacity;
                else
                    style.opacity = cur.opacity === undefined ? 1 : cur.opacity;
            }
            if (cur.fontSize !== prev.fontSize) {
                if (tween.fontSize)
                    tempTween.fontSize = cur.fontSize;
                else
                    style.fontSize = cur.fontSize;
            }
            if (cur.color !== prev.color) {
                if (tween.color)
                    tempTween.color = cur.color;
                else
                    style.color = cur.color || "inherit";
            }
            var animKeys = Object.keys(tempTween);
            if (animKeys.length) {
                Velocity(div, tempTween, tween);
                tempTween = {};
            }
            // non-animation style properties
            if (cur.backgroundImage !== prev.backgroundImage)
                style.backgroundImage = "url('" + cur.backgroundImage + "')";
            if (cur.border !== prev.border)
                style.border = cur.border || "none";
            if (cur.textAlign !== prev.textAlign) {
                style.alignItems = cur.textAlign;
                if (cur.textAlign === "center") {
                    style.textAlign = "center";
                }
                else if (cur.textAlign === "flex-end") {
                    style.textAlign = "right";
                }
                else {
                    style.textAlign = "left";
                }
            }
            if (cur.verticalAlign !== prev.verticalAlign)
                style.justifyContent = cur.verticalAlign;
            if (cur.fontFamily !== prev.fontFamily)
                style.fontFamily = cur.fontFamily || "inherit";
            if (cur.transform !== prev.transform)
                style.transform = cur.transform || "none";
            if (cur.style !== prev.style)
                div.setAttribute("style", cur.style);
            if (cur.dangerouslySetInnerHTML !== prev.dangerouslySetInnerHTML)
                div.innerHTML = cur.dangerouslySetInnerHTML;
            // debug/programmatic properties
            if (cur.semantic !== prev.semantic)
                div.setAttribute("data-semantic", cur.semantic);
            if (cur.debug !== prev.debug)
                div.setAttribute("data-debug", cur.debug);
            // SVG properties
            if (cur.svg) {
                if (cur.fill !== prev.fill)
                    div.setAttributeNS(null, "fill", cur.fill);
                if (cur.stroke !== prev.stroke)
                    div.setAttributeNS(null, "stroke", cur.stroke);
                if (cur.strokeWidth !== prev.strokeWidth)
                    div.setAttributeNS(null, "stroke-width", cur.strokeWidth);
                if (cur.d !== prev.d)
                    div.setAttributeNS(null, "d", cur.d);
                if (cur.c !== prev.c)
                    div.setAttributeNS(null, "class", cur.c);
                if (cur.x !== prev.x)
                    div.setAttributeNS(null, "x", cur.x);
                if (cur.y !== prev.y)
                    div.setAttributeNS(null, "y", cur.y);
                if (cur.dx !== prev.dx)
                    div.setAttributeNS(null, "dx", cur.dx);
                if (cur.dy !== prev.dy)
                    div.setAttributeNS(null, "dy", cur.dy);
                if (cur.cx !== prev.cx)
                    div.setAttributeNS(null, "cx", cur.cx);
                if (cur.cy !== prev.cy)
                    div.setAttributeNS(null, "cy", cur.cy);
                if (cur.r !== prev.r)
                    div.setAttributeNS(null, "r", cur.r);
                if (cur.height !== prev.height)
                    div.setAttributeNS(null, "height", cur.height);
                if (cur.width !== prev.width)
                    div.setAttributeNS(null, "width", cur.width);
                if (cur.xlinkhref !== prev.xlinkhref)
                    div.setAttributeNS('http://www.w3.org/1999/xlink', "href", cur.xlinkhref);
                if (cur.startOffset !== prev.startOffset)
                    div.setAttributeNS(null, "startOffset", cur.startOffset);
                if (cur.id !== prev.id)
                    div.setAttributeNS(null, "id", cur.id);
                if (cur.viewBox !== prev.viewBox)
                    div.setAttributeNS(null, "viewBox", cur.viewBox);
                if (cur.transform !== prev.transform)
                    div.setAttributeNS(null, "transform", cur.transform);
                if (cur.draggable !== prev.draggable)
                    div.setAttributeNS(null, "draggable", cur.draggable);
                if (cur.textAnchor !== prev.textAnchor)
                    div.setAttributeNS(null, "text-anchor", cur.textAnchor);
            }
            //events
            if (cur.dblclick !== prev.dblclick)
                div.ondblclick = cur.dblclick !== undefined ? this.handleEvent : undefined;
            if (cur.click !== prev.click)
                div.onclick = cur.click !== undefined ? this.handleEvent : undefined;
            if (cur.contextmenu !== prev.contextmenu)
                div.oncontextmenu = cur.contextmenu !== undefined ? this.handleEvent : undefined;
            if (cur.mousedown !== prev.mousedown)
                div.onmousedown = cur.mousedown !== undefined ? this.handleEvent : undefined;
            if (cur.mousemove !== prev.mousemove)
                div.onmousemove = cur.mousemove !== undefined ? this.handleEvent : undefined;
            if (cur.mouseup !== prev.mouseup)
                div.onmouseup = cur.mouseup !== undefined ? this.handleEvent : undefined;
            if (cur.mouseover !== prev.mouseover)
                div.onmouseover = cur.mouseover !== undefined ? this.handleEvent : undefined;
            if (cur.mouseout !== prev.mouseout)
                div.onmouseout = cur.mouseout !== undefined ? this.handleEvent : undefined;
            if (cur.mouseleave !== prev.mouseleave)
                div.onmouseleave = cur.mouseleave !== undefined ? this.handleEvent : undefined;
            if (cur.mousewheel !== prev.mousewheel)
                div.onmouseheel = cur.mousewheel !== undefined ? this.handleEvent : undefined;
            if (cur.dragover !== prev.dragover)
                div.ondragover = cur.dragover !== undefined ? this.handleEvent : undefined;
            if (cur.dragstart !== prev.dragstart)
                div.ondragstart = cur.dragstart !== undefined ? this.handleEvent : undefined;
            if (cur.dragend !== prev.dragend)
                div.ondragend = cur.dragend !== undefined ? this.handleEvent : undefined;
            if (cur.drag !== prev.drag)
                div.ondrag = cur.drag !== undefined ? this.handleEvent : undefined;
            if (cur.drop !== prev.drop)
                div.ondrop = cur.drop !== undefined ? this.handleEvent : undefined;
            if (cur.scroll !== prev.scroll)
                div.onscroll = cur.scroll !== undefined ? this.handleEvent : undefined;
            if (cur.focus !== prev.focus)
                div.onfocus = cur.focus !== undefined ? this.handleEvent : undefined;
            if (cur.blur !== prev.blur)
                div.onblur = cur.blur !== undefined ? this.handleEvent : undefined;
            if (cur.input !== prev.input)
                div.oninput = cur.input !== undefined ? this.handleEvent : undefined;
            if (cur.change !== prev.change)
                div.onchange = cur.change !== undefined ? this.handleEvent : undefined;
            if (cur.keyup !== prev.keyup)
                div.onkeyup = cur.keyup !== undefined ? this.handleEvent : undefined;
            if (cur.keydown !== prev.keydown)
                div.onkeydown = cur.keydown !== undefined ? this.handleEvent : undefined;
            if (type === "added" || type === "replaced" || type === "moved") {
                var parentEl = elementCache[cur.parent];
                if (parentEl) {
                    if (cur.ix >= parentEl.children.length) {
                        parentEl.appendChild(div);
                    }
                    else {
                        parentEl.insertBefore(div, parentEl.children[cur.ix]);
                    }
                }
            }
        }
    };
    Renderer.prototype.diff = function () {
        var a = this.prevTree;
        var b = this.tree;
        var as = Object.keys(a);
        var bs = Object.keys(b);
        var updated = {};
        var adds = [];
        for (var i = 0, len = as.length; i < len; i++) {
            var id = as[i];
            var curA = a[id];
            var curB = b[id];
            if (curB === undefined) {
                updated[id] = "removed";
                continue;
            }
            if (curA.t !== curB.t) {
                updated[id] = "replaced";
                continue;
            }
            if (curA.ix !== curB.ix || curA.parent !== curB.parent) {
                updated[id] = "moved";
                continue;
            }
            if (!curB.dirty
                && curA.c === curB.c
                && curA.key === curB.key
                && curA.dangerouslySetInnerHTML === curB.dangerouslySetInnerHTML
                && curA.tabindex === curB.tabindex
                && curA.href === curB.href
                && curA.src === curB.src
                && curA.data === curB.data
                && curA.download === curB.download
                && curA.allowfullscreen === curB.allowfullscreen
                && curA.placeholder === curB.placeholder
                && curA.selected === curB.selected
                && curA.draggable === curB.draggable
                && curA.contentEditable === curB.contentEditable
                && curA.value === curB.value
                && curA.target === curB.target
                && curA.type === curB.type
                && curA.checked === curB.checked
                && curA.text === curB.text
                && curA.top === curB.top
                && curA.flex === curB.flex
                && curA.left === curB.left
                && curA.width === curB.width
                && curA.height === curB.height
                && curA.zIndex === curB.zIndex
                && curA.backgroundColor === curB.backgroundColor
                && curA.backgroundImage === curB.backgroundImage
                && curA.color === curB.color
                && curA.colspan === curB.colspan
                && curA.border === curB.border
                && curA.borderColor === curB.borderColor
                && curA.borderWidth === curB.borderWidth
                && curA.borderRadius === curB.borderRadius
                && curA.opacity === curB.opacity
                && curA.fontFamily === curB.fontFamily
                && curA.fontSize === curB.fontSize
                && curA.textAlign === curB.textAlign
                && curA.transform === curB.transform
                && curA.verticalAlign === curB.verticalAlign
                && curA.semantic === curB.semantic
                && curA.debug === curB.debug
                && curA.style === curB.style
                && (curB.svg === undefined || (curA.x === curB.x
                    && curA.y === curB.y
                    && curA.dx === curB.dx
                    && curA.dy === curB.dy
                    && curA.cx === curB.cx
                    && curA.cy === curB.cy
                    && curA.r === curB.r
                    && curA.d === curB.d
                    && curA.fill === curB.fill
                    && curA.stroke === curB.stroke
                    && curA.strokeWidth === curB.strokeWidth
                    && curA.startOffset === curB.startOffset
                    && curA.textAnchor === curB.textAnchor
                    && curA.viewBox === curB.viewBox
                    && curA.xlinkhref === curB.xlinkhref))) {
                continue;
            }
            updated[id] = "updated";
        }
        for (var i = 0, len = bs.length; i < len; i++) {
            var id = bs[i];
            var curA = a[id];
            if (curA === undefined) {
                adds.push(id);
                updated[id] = "added";
                continue;
            }
        }
        this.lastDiff = { adds: adds, updates: updated };
        return this.lastDiff;
    };
    Renderer.prototype.prepare = function (root) {
        var elemLen = 1;
        var tree = this.tree;
        var elements = [root];
        var elem;
        for (var elemIx = 0; elemIx < elemLen; elemIx++) {
            elem = elements[elemIx];
            if (elem.parent === undefined)
                elem.parent = "__root";
            if (elem.id === undefined)
                elem.id = "__root__" + elemIx;
            tree[elem.id] = elem;
            if (elem.postRender !== undefined) {
                this.postRenders.push(elem);
            }
            var children = elem.children;
            if (children !== undefined) {
                for (var childIx = 0, len = children.length; childIx < len; childIx++) {
                    var child = children[childIx];
                    if (child === undefined)
                        continue;
                    if (child.id === undefined) {
                        child.id = elem.id + "__" + childIx;
                    }
                    if (child.ix === undefined) {
                        child.ix = childIx;
                    }
                    if (child.parent === undefined) {
                        child.parent = elem.id;
                    }
                    elements.push(child);
                    elemLen++;
                }
            }
        }
        return tree;
    };
    Renderer.prototype.postDomify = function () {
        var postRenders = this.postRenders;
        var diff = this.lastDiff.updates;
        var elementCache = this.elementCache;
        for (var i = 0, len = postRenders.length; i < len; i++) {
            var elem = postRenders[i];
            var id = elem.id;
            if (diff[id] === "updated" || diff[id] === "added" || diff[id] === "replaced" || elem.dirty || diff[id] === "moved") {
                elem.postRender(elementCache[elem.id], elem);
            }
        }
    };
    Renderer.prototype.render = function (elems) {
        this.reset();
        // We sort elements by depth to allow them to be self referential.
        elems.sort(function (a, b) { return (a.parent ? a.parent.split("__").length : 0) - (b.parent ? b.parent.split("__").length : 0); });
        var start = now();
        for (var _i = 0; _i < elems.length; _i++) {
            var elem = elems[_i];
            var post = this.prepare(elem);
        }
        var prepare = now();
        var d = this.diff();
        var diff = now();
        this.domify();
        var domify = now();
        this.postDomify();
        var postDomify = now();
        var time = now() - start;
        if (time > 5) {
            console.log("slow render (> 5ms): ", time, {
                prepare: prepare - start,
                diff: diff - prepare,
                domify: domify - diff,
                postDomify: postDomify - domify
            });
        }
    };
    // @TODO: A more performant implementation would have a way of rendering subtrees and just have a lambda Renderer to compile into
    Renderer._compileRenderer = {};
    return Renderer;
})();
exports.Renderer = Renderer;

},{}],13:[function(require,module,exports){
var __extends = (this && this.__extends) || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
};
var utils_1 = require("./utils");
var runtime = require("./runtime");
var app_1 = require("./app");
var ParseError = (function (_super) {
    __extends(ParseError, _super);
    function ParseError(message, line, lineIx, charIx, length) {
        if (charIx === void 0) { charIx = 0; }
        if (length === void 0) { length = line && (line.length - charIx); }
        _super.call(this, message);
        this.message = message;
        this.line = line;
        this.lineIx = lineIx;
        this.charIx = charIx;
        this.length = length;
        this.name = "Parse Error";
    }
    ParseError.prototype.toString = function () {
        return (_a = ["\n      ", ": ", "\n      ", "\n      ", "\n      ", "\n    "], _a.raw = ["\n      ", ": ", "\n      ", "\n      ", "\n      ", "\n    "], utils_1.unpad(6)(_a, this.name, this.message, this.lineIx !== undefined ? "On line " + (this.lineIx + 1) + ":" + this.charIx : "", this.line, utils_1.underline(this.charIx, this.length)));
        var _a;
    };
    return ParseError;
})(Error);
function readWhile(str, pattern, startIx) {
    var endIx = startIx;
    while (str[endIx] !== undefined && str[endIx].match(pattern))
        endIx++;
    return str.slice(startIx, endIx);
}
function readUntil(str, sentinel, startIx, unsatisfiedErr) {
    var endIx = str.indexOf(sentinel, startIx);
    if (endIx === -1) {
        if (unsatisfiedErr)
            return unsatisfiedErr;
        return str.slice(startIx);
    }
    return str.slice(startIx, endIx);
}
function readUntilAny(str, sentinels, startIx, unsatisfiedErr) {
    var endIx = -1;
    for (var _i = 0; _i < sentinels.length; _i++) {
        var sentinel = sentinels[_i];
        var ix = str.indexOf(sentinel, startIx);
        if (ix === -1 || endIx !== -1 && ix > endIx)
            continue;
        endIx = ix;
    }
    if (endIx === -1) {
        if (unsatisfiedErr)
            return unsatisfiedErr;
        return str.slice(startIx);
    }
    return str.slice(startIx, endIx);
}
// export function parseUI(str:string):UIElem {
//   let root:UIElem = {};
//   let errors = [];
//   let lineIx = 0;
//   let lines = str.split("\n");
//   let stack:{indent: number, elem: UIElem}[] = [{indent: -2, elem: root}];
//   // @FIXME: Chunk into element chunks instead of lines to enable in-argument continuation.
//   for(let line of lines) {
//     let charIx = 0;
//     while(line[charIx] === " ") charIx++;
//     let indent = charIx;
//     if(line[charIx] === undefined)  continue;
//     let parent:UIElem;
//     for(let stackIx = stack.length - 1; stackIx >= 0; stackIx--) {
//       if(indent > stack[stackIx].indent) {
//         parent = stack[stackIx].elem;
//         break;
//       } else stack.pop();
//     }
//     let keyword = readUntil(line, " ", charIx);
//     charIx += keyword.length;
//     if(keyword[0] === "~" || keyword[0] === "%") { // Handle binding
//       charIx -= keyword.length - 1;
//       let kind = keyword[0] === "~" ? "plan" : "query";
//       if(!parent.binding) {
//         parent.binding = line.slice(charIx);
//         parent.bindingKind = kind;
//       } else if(kind === parent.bindingKind) parent.binding += "\n" + line.slice(charIx);
//       else {
//         errors.push(new ParseError(`UI must be bound to a single type of query.`, line, lineIx));
//         continue;
//       }
//       charIx = line.length;
//     } else if(keyword[0] === "@") { // Handle event
//       charIx -= keyword.length - 1;
//       let err;
//       while(line[charIx] === " ") charIx++;
//       let lastIx = charIx;
//       let eventRaw = readUntil(line, "{", charIx);
//       charIx += eventRaw.length;
//       let event = eventRaw.trim();
//       if(!event) err = new ParseError(`UI event must specify a valid event name`, line, lineIx, lastIx, eventRaw.length);
//       let state;
//       [state, charIx] = getMapArgs(line, lineIx, charIx);
//       if(state instanceof Error && !err) err = state;
//       if(err) {
//         errors.push(err);
//         lineIx++;
//         continue;
//       }
//       if(!parent.events) parent.events = {};
//       parent.events[event] = state;
//     } else if(keyword[0] === ">") { // Handle embed
//       charIx -= keyword.length - 1;
//       let err;
//       while(line[charIx] === " ") charIx++;
//       let lastIx = charIx;
//       let embedIdRaw = readUntil(line, "{", charIx);
//       charIx += embedIdRaw.length;
//       let embedId = embedIdRaw.trim();
//       if(!embedId) err = new ParseError(`UI embed must specify a valid element id`, line, lineIx, lastIx, embedIdRaw.length);
//       let scope;
//       [scope = {}, charIx] = getMapArgs(line, lineIx, charIx);
//       if(scope instanceof Error && !err) err = scope;
//       if(err) {
//         errors.push(err);
//         lineIx++;
//         continue;
//       }
//       let elem = {embedded: scope, id: embedId};
//       if(!parent.children) parent.children = [];
//       parent.children.push(elem);
//       stack.push({indent, elem});
//     } else { // Handle element
//       let err;
//       if(!keyword) err = new ParseError(`UI element must specify a valid tag name`, line, lineIx, charIx, 0);
//       while(line[charIx] === " ") charIx++;
//       let classesRaw = readUntil(line, "{", charIx);
//       charIx += classesRaw.length;
//       let classes = classesRaw.trim();
//       let attributes;
//       [attributes = {}, charIx] = getMapArgs(line, lineIx, charIx);
//       if(attributes instanceof Error && !err) err = attributes;
//       if(err) {
//         errors.push(err);
//         lineIx++;
//         continue;
//       }
//       attributes["t"] = keyword;
//       if(classes) attributes["c"] = classes;
//       let elem:UIElem = {id: attributes["id"], attributes};
//       if(!parent.children) parent.children = [];
//       parent.children.push(elem);
//       stack.push({indent, elem});
//     }
//     lineIx++;
//   }
//   if(errors.length) {
//     for(let err of errors) {
//       console.error(err);
//     }
//   }
//   return root;
// }
//-----------------------------------------------------------------------------
// Eve DSL Parser
//-----------------------------------------------------------------------------
var TOKEN_TYPE;
(function (TOKEN_TYPE) {
    TOKEN_TYPE[TOKEN_TYPE["EXPR"] = 0] = "EXPR";
    TOKEN_TYPE[TOKEN_TYPE["IDENTIFIER"] = 1] = "IDENTIFIER";
    TOKEN_TYPE[TOKEN_TYPE["KEYWORD"] = 2] = "KEYWORD";
    TOKEN_TYPE[TOKEN_TYPE["STRING"] = 3] = "STRING";
    TOKEN_TYPE[TOKEN_TYPE["LITERAL"] = 4] = "LITERAL";
})(TOKEN_TYPE || (TOKEN_TYPE = {}));
;
var Token = (function () {
    function Token(type, value, lineIx, charIx) {
        this.type = type;
        this.value = value;
        this.lineIx = lineIx;
        this.charIx = charIx;
    }
    Token.identifier = function (value, lineIx, charIx) {
        return new Token(Token.TYPE.IDENTIFIER, value, lineIx, charIx);
    };
    Token.keyword = function (value, lineIx, charIx) {
        return new Token(Token.TYPE.KEYWORD, value, lineIx, charIx);
    };
    Token.string = function (value, lineIx, charIx) {
        return new Token(Token.TYPE.STRING, value, lineIx, charIx);
    };
    Token.literal = function (value, lineIx, charIx) {
        return new Token(Token.TYPE.LITERAL, value, lineIx, charIx);
    };
    Token.prototype.toString = function () {
        if (this.type === Token.TYPE.KEYWORD)
            return ":" + this.value;
        else if (this.type === Token.TYPE.STRING)
            return "\"" + this.value + "\"";
        else
            return this.value.toString();
    };
    Token.TYPE = TOKEN_TYPE;
    return Token;
})();
exports.Token = Token;
var Sexpr = (function () {
    function Sexpr(val, lineIx, charIx, syntax) {
        if (syntax === void 0) { syntax = "expr"; }
        this.lineIx = lineIx;
        this.charIx = charIx;
        this.syntax = syntax;
        this.type = Token.TYPE.EXPR;
        if (val)
            this.value = val.slice();
    }
    Sexpr.list = function (value, lineIx, charIx, syntax) {
        if (value === void 0) { value = []; }
        value = value.slice();
        value.unshift(Token.identifier("list", lineIx, charIx ? charIx + 1 : undefined));
        return new Sexpr(value, lineIx, charIx, syntax ? "list" : undefined);
    };
    Sexpr.hash = function (value, lineIx, charIx, syntax) {
        if (value === void 0) { value = []; }
        value = value.slice();
        value.unshift(Token.identifier("hash", lineIx, charIx ? charIx + 1 : undefined));
        return new Sexpr(value, lineIx, charIx, syntax ? "hash" : undefined);
    };
    Sexpr.asSexprs = function (values) {
        for (var _i = 0; _i < values.length; _i++) {
            var raw = values[_i];
            if (!(raw instanceof Sexpr))
                throw new ParseError("All top level entries must be expressions (got " + raw + ")", undefined, raw.lineIx, raw.charIx);
            else {
                var op = raw.operator;
                if (op.type !== Token.TYPE.IDENTIFIER)
                    throw new ParseError("All expressions must begin with an identifier", undefined, raw.lineIx, raw.charIx);
            }
        }
        return values;
    };
    Sexpr.prototype.toString = function () {
        var content = this.value && this.value.map(function (token) { return token.toString(); }).join(" ");
        var argsContent = this.value && this.arguments.map(function (token) { return token.toString(); }).join(" ");
        if (this.syntax === "hash")
            return "{" + argsContent + "}";
        else if (this.syntax === "list")
            return "[" + argsContent + "]";
        else
            return "(" + content + ")";
    };
    Sexpr.prototype.push = function (val) {
        this.value = this.value || [];
        return this.value.push(val);
    };
    Sexpr.prototype.nth = function (n, val) {
        if (val) {
            this.value = this.value || [];
            return this.value[n] = val;
        }
        return this.value && this.value[n];
    };
    Object.defineProperty(Sexpr.prototype, "operator", {
        get: function () {
            return this.value && this.value[0];
        },
        set: function (op) {
            this.value = this.value || [];
            this.value[0] = op;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Sexpr.prototype, "arguments", {
        get: function () {
            return this.value && this.value.slice(1);
        },
        set: function (args) {
            this.value = this.value || [];
            this.value.length = 1;
            this.value.push.apply(this.value, args);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Sexpr.prototype, "length", {
        get: function () {
            return this.value && this.value.length;
        },
        enumerable: true,
        configurable: true
    });
    return Sexpr;
})();
exports.Sexpr = Sexpr;
var TOKEN_TO_TYPE = {
    "(": "expr",
    ")": "expr",
    "[": "list",
    "]": "list",
    "{": "hash",
    "}": "hash"
};
var hygienicSymbolCounter = 0;
function readSexprs(text) {
    var root = Sexpr.list();
    var token;
    var sexpr = root;
    var sexprs = [root];
    var lines = text.split("\n");
    var lineIx = 0;
    var mode;
    for (var _i = 0; _i < lines.length; _i++) {
        var line = lines[_i];
        var line_1 = lines[lineIx];
        var charIx = 0;
        if (mode === "string")
            token.value += "\n";
        while (charIx < line_1.length) {
            if (mode === "string") {
                if (line_1[charIx] === "\"" && line_1[charIx - 1] !== "\\") {
                    sexpr.push(token);
                    token = mode = undefined;
                    charIx++;
                }
                else
                    token.value += line_1[charIx++];
                continue;
            }
            var padding = readWhile(line_1, /\s/, charIx);
            charIx += padding.length;
            if (padding.length) {
                if (token)
                    sexpr.push(token);
                token = undefined;
            }
            if (charIx >= line_1.length)
                continue;
            if (line_1[charIx] === ";") {
                charIx = line_1.length;
            }
            else if (line_1[charIx] === "\"") {
                if (!sexpr.length)
                    throw new ParseError("Literal must be an argument in a sexpr.", line_1, lineIx, charIx);
                mode = "string";
                token = Token.string("", lineIx, charIx);
                charIx++;
            }
            else if (line_1[charIx] === ":") {
                if (!sexpr.length)
                    throw new ParseError("Literal must be an argument in a sexpr.", line_1, lineIx, charIx);
                var keyword = readUntilAny(line_1, [" ", ")", "]", "}"], ++charIx);
                sexpr.push(Token.keyword(keyword, lineIx, charIx - 1));
                charIx += keyword.length;
            }
            else if (line_1[charIx] === "(" || line_1[charIx] === "[" || line_1[charIx] === "{") {
                if (token)
                    throw new ParseError("Sexpr arguments must be space separated.", line_1, lineIx, charIx);
                var type = TOKEN_TO_TYPE[line_1[charIx]];
                if (type === "hash")
                    sexpr = Sexpr.hash(undefined, lineIx, charIx);
                else if (type === "list")
                    sexpr = Sexpr.list(undefined, lineIx, charIx);
                else
                    sexpr = new Sexpr(undefined, lineIx, charIx);
                sexpr.syntax = type;
                sexprs.push(sexpr);
                charIx++;
            }
            else if (line_1[charIx] === ")" || line_1[charIx] === "]" || line_1[charIx] === "}") {
                var child = sexprs.pop();
                var type = TOKEN_TO_TYPE[line_1[charIx]];
                if (child.syntax !== type)
                    throw new ParseError("Must terminate " + child.syntax + " before terminating " + type, line_1, lineIx, charIx);
                sexpr = sexprs[sexprs.length - 1];
                if (!sexpr)
                    throw new ParseError("Too many closing parens", line_1, lineIx, charIx);
                sexpr.push(child);
                charIx++;
            }
            else {
                var literal = readUntilAny(line_1, [" ", ")", "]", "}"], charIx);
                var length_1 = literal.length;
                literal = utils_1.coerceInput(literal);
                var type = typeof literal === "string" ? "identifier" : "literal";
                if (!sexpr.length && type !== "identifier")
                    throw new ParseError("Expr must begin with identifier.", line_1, lineIx, charIx);
                if (type === "identifier") {
                    var dotIx = literal.indexOf(".");
                    if (dotIx !== -1) {
                        var child = new Sexpr([
                            Token.identifier("get", lineIx, charIx + 1),
                            Token.identifier(literal.slice(0, dotIx), lineIx, charIx + 3),
                            Token.string(literal.slice(dotIx + 1), lineIx, charIx + 5 + dotIx)
                        ], lineIx, charIx);
                        sexpr.push(child);
                    }
                    else
                        sexpr.push(Token.identifier(literal, lineIx, charIx));
                }
                else
                    sexpr.push(Token.literal(literal, lineIx, charIx));
                charIx += length_1;
            }
        }
        lineIx++;
    }
    if (token)
        throw new ParseError("Unterminated " + TOKEN_TYPE[token.type] + " token", lines[lineIx - 1], lineIx - 1);
    var lastIx = lines.length - 1;
    if (sexprs.length > 1)
        throw new ParseError("Too few closing parens", lines[lastIx], lastIx, lines[lastIx].length);
    return root;
}
exports.readSexprs = readSexprs;
function macroexpandDSL(sexpr) {
    // @TODO: Implement me.
    var op = sexpr.operator;
    if (op.value === "eav") {
        throw new Error("@TODO: Implement me!");
    }
    else if (op.value === "one-of") {
        // (one-of (query ...body) (query ...body) ...) =>
        // (union
        //   (def q1 (query ...body1))
        //   (def q2 (query (negate q1) ...body2)))
        throw new Error("@TODO: Implement me!");
    }
    else if (op.value === "negate") {
        if (sexpr.length > 2)
            throw new ParseError("Negate only takes a single body", undefined, sexpr.lineIx, sexpr.charIx);
        var select = macroexpandDSL(Sexpr.asSexprs(sexpr.arguments)[0]);
        select.push(Token.keyword("$$negated"));
        select.push(Token.literal(true));
        return select;
    }
    else if (["hash", "list", "get", "def", "query", "union", "select", "member", "project!", "insert!", "remove!", "load!"].indexOf(op.value) === -1) {
        // (foo-bar :a 5) => (select "foo bar" :a 5)
        var source = op;
        source.type = Token.TYPE.STRING;
        source.value = source.value.replace(/(.?)-(.)/g, "$1 $2");
        var args = sexpr.arguments;
        args.unshift(source);
        sexpr.arguments = args;
        sexpr.operator = Token.identifier("select");
    }
    return sexpr;
}
exports.macroexpandDSL = macroexpandDSL;
var VALUE;
(function (VALUE) {
    VALUE[VALUE["NULL"] = 0] = "NULL";
    VALUE[VALUE["SCALAR"] = 1] = "SCALAR";
    VALUE[VALUE["SET"] = 2] = "SET";
    VALUE[VALUE["VIEW"] = 3] = "VIEW";
})(VALUE || (VALUE = {}));
;
function parseDSL(text) {
    var artifacts = { views: {} };
    var lines = text.split("\n");
    var root = readSexprs(text);
    for (var _i = 0, _a = Sexpr.asSexprs(root.arguments); _i < _a.length; _i++) {
        var raw = _a[_i];
        parseDSLSexpr(raw, artifacts);
    }
    return artifacts;
}
exports.parseDSL = parseDSL;
function parseDSLSexpr(raw, artifacts, context, parent, resultVariable) {
    if (parent instanceof runtime.Query)
        var query = parent;
    else
        var union = parent;
    var sexpr = macroexpandDSL(raw);
    var op = sexpr.operator;
    if (op.type !== Token.TYPE.IDENTIFIER)
        throw new ParseError("Evaluated sexpr must begin with an identifier ('" + op + "' is a " + Token.TYPE[op.type] + ")", "", raw.lineIx, raw.charIx);
    if (op.value === "list") {
        var $$body = parseArguments(sexpr, undefined, "$$body").$$body;
        return { type: VALUE.SCALAR, value: $$body.map(function (token, ix) { return resolveTokenValue("list item " + ix, token, context); }) };
    }
    if (op.value === "hash") {
        var args = parseArguments(sexpr);
        for (var arg in args)
            args[arg] = resolveTokenValue("hash item " + arg, args[arg], context);
        return { type: VALUE.SET, value: args };
    }
    if (op.value === "insert!") {
        var changeset = artifacts.changeset || app_1.eve.diff();
        for (var _i = 0, _a = sexpr.arguments; _i < _a.length; _i++) {
            var arg = _a[_i];
            var table = arg.value[0];
            var fact = {};
            for (var ix = 1; ix < arg.value.length; ix += 2) {
                var key = arg.value[ix];
                var value = arg.value[ix + 1];
                fact[key.value] = value.value;
            }
            changeset.add(table.value, fact);
        }
        artifacts.changeset = changeset;
        return;
    }
    if (op.value === "remove!") {
        var changeset = artifacts.changeset || app_1.eve.diff();
        for (var _b = 0, _c = sexpr.arguments; _b < _c.length; _b++) {
            var arg = _c[_b];
            var table = arg.value[0];
            var fact = {};
            for (var ix = 1; ix < arg.value.length; ix += 2) {
                var key = arg.value[ix];
                var value = arg.value[ix + 1];
                fact[key.value] = value.value;
            }
            changeset.remove(table.value, fact);
        }
        artifacts.changeset = changeset;
        return;
    }
    if (op.value === "load!") {
        throw new Error("(load! ..) has not been implemented yet");
    }
    if (op.value === "query") {
        var neueContext = [];
        var _d = parseArguments(sexpr, undefined, "$$body"), $$view = _d.$$view, $$negated = _d.$$negated, $$body = _d.$$body;
        var queryId = $$view ? resolveTokenValue("view", $$view, context, VALUE.SCALAR) : utils_1.uuid();
        var neue = new runtime.Query(app_1.eve, queryId);
        neue["displayName"] = sexpr.toString();
        if (utils_1.DEBUG.instrumentQuery)
            instrumentQuery(neue, utils_1.DEBUG.instrumentQuery);
        artifacts.views[queryId] = neue;
        var aggregated = false;
        for (var _e = 0, _f = Sexpr.asSexprs($$body); _e < _f.length; _e++) {
            var raw_1 = _f[_e];
            var state = parseDSLSexpr(raw_1, artifacts, neueContext, neue);
            if (state && state.aggregated)
                aggregated = true;
        }
        var projectionMap = neue.projectionMap;
        var projected = true;
        if (!projectionMap) {
            projectionMap = {};
            projected = false;
            for (var _g = 0; _g < neueContext.length; _g++) {
                var variable = neueContext[_g];
                projectionMap[variable.name] = variable.value;
            }
        }
        if (Object.keys(projectionMap).length)
            neue.project(projectionMap);
        // Join subquery to parent.
        if (parent) {
            var select = new Sexpr([Token.identifier(query ? "select" : "member"), Token.string(queryId)], raw.lineIx, raw.charIx);
            var groups = [];
            for (var _h = 0; _h < neueContext.length; _h++) {
                var variable = neueContext[_h];
                if (projected && !variable.projection)
                    continue;
                var field = variable.projection || variable.name;
                select.push(Token.keyword(field));
                if (query)
                    select.push(Token.identifier(variable.name));
                else
                    select.push(Sexpr.list([Token.string(field)]));
                if (context) {
                    for (var _j = 0; _j < context.length; _j++) {
                        var parentVar = context[_j];
                        if (parentVar.name === variable.name)
                            groups.push(variable.value);
                    }
                }
            }
            if ($$negated) {
                select.push(Token.keyword("$$negated"));
                select.push($$negated);
            }
            if (groups.length && aggregated)
                neue.group(groups);
            parseDSLSexpr(select, artifacts, context, parent);
        }
        return { value: queryId, type: VALUE.VIEW, projected: projected, context: neueContext };
    }
    if (op.value === "union") {
        var _k = parseArguments(sexpr, undefined, "$$body"), $$view = _k.$$view, $$body = _k.$$body, $$negated = _k.$$negated;
        var unionId = $$view ? resolveTokenValue("view", $$view, context, VALUE.SCALAR) : utils_1.uuid();
        var neue = new runtime.Union(app_1.eve, unionId);
        if (utils_1.DEBUG.instrumentQuery)
            instrumentQuery(neue, utils_1.DEBUG.instrumentQuery);
        artifacts.views[unionId] = neue;
        var mappings = {};
        for (var _l = 0, _m = Sexpr.asSexprs($$body); _l < _m.length; _l++) {
            var raw_2 = _m[_l];
            var child = macroexpandDSL(raw_2);
            if (child.operator.value !== "query" && child.operator.value !== "union")
                throw new ParseError("Unions may only contain queries", "", raw_2.lineIx, raw_2.charIx);
            var res = parseDSLSexpr(child, artifacts, context, neue);
            for (var _o = 0, _p = res.context; _o < _p.length; _o++) {
                var variable = _p[_o];
                if (res.projected && !variable.projection)
                    continue;
                var field = variable.projection || variable.name;
                if (!mappings[field])
                    mappings[field] = {};
                mappings[field][variable.name] = true;
            }
        }
        // Join subunion to parent
        if (parent) {
            var select = new Sexpr([Token.identifier(query ? "select" : "member"), Token.string(unionId)], raw.lineIx, raw.charIx);
            for (var field in mappings) {
                var mappingVariables = Object.keys(mappings[field]);
                if (mappingVariables.length > 1)
                    throw new ParseError("All variables projected to a single union field must have the same name. Field '" + field + "' has " + mappingVariables.length + " fields (" + mappingVariables.join(", ") + ")", "", raw.lineIx, raw.charIx);
                select.push(Token.keyword(field));
                select.push(Token.identifier(mappingVariables[0]));
            }
            console.log("union select", select.toString());
            parseDSLSexpr(select, artifacts, context, parent);
        }
        return { type: VALUE.VIEW, value: unionId, mappings: mappings };
    }
    if (op.value === "member") {
        if (!union)
            throw new ParseError("Cannot add member to non-union parent", "", raw.lineIx, raw.charIx);
        var args = parseArguments(sexpr, ["$$view"]);
        var $$view = args.$$view, $$negated = args.$$negated;
        var view = resolveTokenValue("view", $$view, context, VALUE.SCALAR);
        if (view === undefined)
            throw new ParseError("Must specify a view to be unioned", "", raw.lineIx, raw.charIx);
        var join = {};
        for (var arg in args) {
            if (arg === "$$view" || arg === "$$negated")
                continue;
            join[arg] = resolveTokenValue("member field", args[arg], context);
        }
        if (runtime.QueryFunctions[view])
            throw new ParseError("Cannot union primitive view '" + view + "'", "", raw.lineIx, raw.charIx);
        union.union(view, join);
        return;
    }
    if (!parent)
        throw new ParseError("Non-query or union sexprs must be contained within a query or union", "", raw.lineIx, raw.charIx);
    if (op.value === "select") {
        if (!query)
            throw new ParseError("Cannot add select to non-query parent", "", raw.lineIx, raw.charIx);
        var selectId = utils_1.uuid();
        var $$view = getArgument(sexpr, "$$view", ["$$view"]);
        var view = resolveTokenValue("view", $$view, context, VALUE.SCALAR);
        if (view === undefined)
            throw new ParseError("Must specify a view to be selected", "", raw.lineIx, raw.charIx);
        var primitive = runtime.QueryFunctions[view];
        //@TODO: Move this to an eve table to allow user defined defaults
        var args = parseArguments(sexpr, ["$$view"].concat(getDefaults(view)));
        var $$negated = args.$$negated;
        var join = {};
        for (var arg in args) {
            var value = args[arg];
            var variable = void 0;
            if (arg === "$$view" || arg === "$$negated")
                continue;
            if (value instanceof Token && value.type !== Token.TYPE.IDENTIFIER) {
                join[arg] = args[arg].value;
                continue;
            }
            if (value instanceof Sexpr) {
                var result = parseDSLSexpr(value, artifacts, context, parent, "$$temp-" + hygienicSymbolCounter++ + "-" + arg);
                if (!result || result.type === VALUE.NULL)
                    throw new Error("Cannot set parameter '" + arg + "' to null value '" + value.toString() + "'");
                if (result.type === VALUE.VIEW) {
                    var view_1 = result.value;
                    var resultField_1 = getResult(view_1);
                    if (!resultField_1)
                        throw new Error("Cannot set parameter '" + arg + "' to select without default result field");
                    for (var _q = 0; _q < context.length; _q++) {
                        var curVar = context[_q];
                        for (var _r = 0, _s = curVar.constraints; _r < _s.length; _r++) {
                            var constraint = _s[_r];
                            if (constraint[0] === view_1 && constraint[1] === resultField_1) {
                                variable = curVar;
                                break;
                            }
                        }
                    }
                }
            }
            else
                variable = getDSLVariable(value.value, context);
            if (variable) {
                join[arg] = variable.value;
                variable.constraints.push([view, arg]);
            }
            else if ($$negated && $$negated.value)
                throw new ParseError("Cannot bind field in negated select to undefined variable '" + value.value + "'", "", raw.lineIx, raw.charIx);
            else
                context.push({ name: value.value, type: VALUE.SCALAR, value: [selectId, arg], constraints: [[view, arg]] }); // @TODO: does this not need to add to the join map?
        }
        var resultField = getResult(view);
        if (resultVariable && resultField && !join[resultField]) {
            join[resultField] = [selectId, resultField];
            context.push({ name: resultVariable, type: VALUE.SCALAR, value: [selectId, resultField], constraints: [[view, resultField]] });
        }
        if (primitive) {
            if ($$negated) {
                if (primitive.inverse)
                    view = primitive.inverse;
                else
                    throw new ParseError("Cannot invert primitive calculation '" + view + "'", "", raw.lineIx, raw.charIx);
            }
            if (primitive.aggregate)
                query.aggregate(view, join, selectId);
            else
                query.calculate(view, join, selectId);
        }
        else if ($$negated)
            query.deselect(view, join);
        else
            query.select(view, join, selectId);
        return {
            type: VALUE.VIEW,
            value: view,
            aggregated: primitive && primitive.aggregate
        };
    }
    if (op.value === "project!") {
        var args = parseArguments(sexpr, ["$$view"]);
        var $$view = args.$$view, $$negated = args.$$negated;
        var projectionMap = {};
        for (var arg in args) {
            var value = args[arg];
            if (arg === "$$view" || arg === "$$negated")
                continue;
            if (value.type !== Token.TYPE.IDENTIFIER) {
                projectionMap[arg] = args[arg].value;
                continue;
            }
            var variable = getDSLVariable(value.value, context);
            if (variable) {
                if (variable.static)
                    projectionMap[arg] = variable.value;
                else if (!$$view) {
                    variable.projection = arg;
                    projectionMap[arg] = variable.value;
                }
                else
                    projectionMap[arg] = [variable.name];
            }
            else
                throw new ParseError("Cannot bind projected field to undefined variable '" + value.value + "'", "", raw.lineIx, raw.charIx);
        }
        var view = resolveTokenValue("view", $$view, context, VALUE.SCALAR);
        if (view === undefined) {
            if (query.projectionMap)
                throw new ParseError("Query can only self-project once", "", raw.lineIx, raw.charIx);
            if ($$negated && $$negated.value)
                throw new ParseError("Cannot negate self-projection", "", raw.lineIx, raw.charIx);
            // Project self
            query.project(projectionMap);
        }
        else {
            var union_1 = artifacts.views[view] || new runtime.Union(app_1.eve, view);
            if (utils_1.DEBUG.instrumentQuery && !artifacts.views[view])
                instrumentQuery(union_1, utils_1.DEBUG.instrumentQuery);
            artifacts.views[view] = union_1;
            // if($$negated && $$negated.value) union.ununion(queryId, projectionMap);
            if ($$negated && $$negated.value)
                throw new ParseError("Union projections may not be negated in the current runtime", "", raw.lineIx, raw.charIx);
            else
                union_1.union(query.name, projectionMap);
        }
        return;
    }
    throw new ParseError("Unknown DSL operator '" + op.value + "'", "", raw.lineIx, raw.charIx);
}
function resolveTokenValue(name, token, context, type) {
    if (!token)
        return;
    if (token instanceof Sexpr)
        return parseDSLSexpr(token, undefined, context);
    if (token instanceof Token && token.type === Token.TYPE.IDENTIFIER) {
        var variable = getDSLVariable(token.value, context, VALUE.SCALAR);
        if (!variable)
            throw new Error("Cannot bind " + name + " to undefined variable '" + token.value + "'");
        if (!variable.static)
            throw new Error("Cannot bind " + name + " to dynamic variable '" + token.value + "'");
        return variable.value;
    }
    return token.value;
}
function getDSLVariable(name, context, type) {
    if (!context)
        return;
    for (var _i = 0; _i < context.length; _i++) {
        var variable = context[_i];
        if (variable.name === name) {
            if (variable.static === false)
                throw new Error("Cannot statically look up dynamic variable '" + name + "'");
            if (type !== undefined && variable.type !== type)
                throw new Error("Expected variable '" + name + "' to have type '" + type + "', but instead has type '" + variable.type + "'");
            return variable;
        }
    }
}
function getDefaults(view) {
    return (runtime.QueryFunctions[view] && runtime.QueryFunctions[view].params) || [];
}
function getResult(view) {
    return runtime.QueryFunctions[view] && runtime.QueryFunctions[view].result;
}
function getArgument(root, param, defaults) {
    var ix = 1;
    var defaultIx = 0;
    for (var ix_1 = 1, cur = root.nth(ix_1); ix_1 < root.length; ix_1++) {
        if (cur.type === Token.TYPE.KEYWORD) {
            if (cur.value === param)
                return root.nth(ix_1 + 1);
            else
                ix_1 + 1;
        }
        else {
            if (defaults && defaultIx < defaults.length) {
                var keyword = defaults[defaultIx++];
                if (keyword === param)
                    return cur;
                else
                    ix_1 + 1;
            }
            throw new Error("Param '" + param + "' not in sexpr " + root.toString());
        }
    }
    throw new Error("Param '" + param + "' not in sexpr " + root.toString());
}
exports.getArgument = getArgument;
function parseArguments(root, defaults, rest) {
    var args = {};
    var defaultIx = 0;
    var keyword;
    var kwarg = false;
    for (var _i = 0, _a = root.arguments; _i < _a.length; _i++) {
        var raw = _a[_i];
        if (raw.type === Token.TYPE.KEYWORD) {
            if (keyword)
                throw new Error("Keywords may not be values '" + raw + "'");
            else
                keyword = raw.value;
        }
        else if (keyword) {
            if (args[keyword] === undefined) {
                args[keyword] = raw;
            }
            else {
                if (!(args[keyword] instanceof Array))
                    args[keyword] = [args[keyword]];
                args[keyword].push(raw);
            }
            keyword = undefined;
            defaultIx = defaults ? defaults.length : 0;
            kwarg = true;
        }
        else if (defaults && defaultIx < defaults.length) {
            args[defaults[defaultIx++]] = raw;
        }
        else if (rest) {
            args[rest] = args[rest] || [];
            args[rest].push(raw);
        }
        else {
            if (kwarg)
                throw new Error("Cannot specify an arg after a kwarg");
            else if (defaultIx)
                throw new Error("Too many args, expected: " + defaults.length + ", got: " + (defaultIx + 1));
            else
                throw new Error("Cannot specify an arg without default keys specified");
        }
    }
    return args;
}
exports.parseArguments = parseArguments;
if (utils_1.ENV === "browser")
    window["parser"] = exports;
function instrumentQuery(q, instrument) {
    var instrumentation = instrument;
    if (!instrument || instrument === true)
        instrumentation = function (fn, args) { return console.log("*", fn, ":", args); };
    var keys = [];
    for (var key in q)
        keys.push(key);
    keys.forEach(function (fn) {
        if (!q.constructor.prototype.hasOwnProperty(fn) || typeof q[fn] !== "function")
            return;
        var old = q[fn];
        q[fn] = function () {
            instrumentation(fn, arguments);
            return old.apply(this, arguments);
        };
    });
    return q;
}
exports.instrumentQuery = instrumentQuery;
function asDiff(ixer, artifacts) {
    var views = artifacts.views;
    var diff = ixer.diff();
    for (var id in views)
        diff.merge(views[id].changeset(app_1.eve));
    return diff;
}
exports.asDiff = asDiff;
function applyAsDiffs(artifacts) {
    var views = artifacts.views;
    for (var id in views)
        app_1.eve.applyDiff(views[id].changeset(app_1.eve));
    console.log("Applied diffs for:");
    for (var id in views)
        console.log("  * ", views[id] instanceof runtime.Query ? "Query" : "Union", views[id].name);
    return artifacts;
}
exports.applyAsDiffs = applyAsDiffs;
function logArtifacts(artifacts) {
    for (var view in artifacts.views)
        console.log(view, "\n", app_1.eve.find(view));
}
exports.logArtifacts = logArtifacts;

},{"./app":9,"./runtime":15,"./utils":19}],14:[function(require,module,exports){
var microReact_1 = require("./microReact");
var utils_1 = require("./utils");
var CodeMirror = require("codemirror");
require("codemirror/mode/gfm/gfm");
require("codemirror/mode/clojure/clojure");
function replaceAll(str, find, replace) {
    var regex = new RegExp(find.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&'), 'g');
    return str.replace(regex, replace);
}
function wrapWithMarkdown(cm, wrapping) {
    cm.operation(function () {
        var from = cm.getCursor("from");
        // if there's something selected wrap it
        if (cm.somethingSelected()) {
            var selected = cm.getSelection();
            var cleaned = replaceAll(selected, wrapping, "");
            if (selected.substring(0, wrapping.length) === wrapping
                && selected.substring(selected.length - wrapping.length) === wrapping) {
                cm.replaceRange(cleaned, from, cm.getCursor("to"));
                cm.setSelection(from, cm.getCursor("from"));
            }
            else {
                var str = "" + wrapping + cleaned + wrapping;
                cm.replaceRange(str, from, cm.getCursor("to"));
                cm.setSelection(from, cm.getCursor("from"));
            }
        }
        else {
            cm.replaceRange("" + wrapping + wrapping, from);
            var newLocation = { line: from.line, ch: from.ch + wrapping.length };
            cm.setCursor(newLocation);
        }
    });
}
function prefixWithMarkdown(cm, prefix) {
    cm.operation(function () {
        var from = cm.getCursor("from");
        var to = cm.getCursor("to");
        var toPrefix = [];
        for (var lineIx = from.line; lineIx <= to.line; lineIx++) {
            var currentPrefix = cm.getRange({ line: lineIx, ch: 0 }, { line: lineIx, ch: prefix.length });
            if (currentPrefix !== prefix && currentPrefix !== "") {
                toPrefix.push(lineIx);
            }
        }
        // if everything in the selection has been prefixed, then we need to unprefix
        if (toPrefix.length === 0) {
            for (var lineIx = from.line; lineIx <= to.line; lineIx++) {
                cm.replaceRange("", { line: lineIx, ch: 0 }, { line: lineIx, ch: prefix.length });
            }
        }
        else {
            for (var _i = 0; _i < toPrefix.length; _i++) {
                var lineIx = toPrefix[_i];
                cm.replaceRange(prefix, { line: lineIx, ch: 0 });
            }
        }
    });
}
var defaultKeys = {
    "Cmd-B": function (cm) {
        wrapWithMarkdown(cm, "**");
    },
    "Cmd-I": function (cm) {
        wrapWithMarkdown(cm, "_");
    },
};
var RichTextEditor = (function () {
    function RichTextEditor(node, options) {
        //format bar
        this.formatBarDelay = 100;
        this.showingFormatBar = false;
        this.formatBarElement = null;
        this.marks = {};
        this.meta = {};
        var extraKeys = utils_1.mergeObject(utils_1.copy(defaultKeys), options.keys || {});
        this.cmInstance = CodeMirror(node, {
            mode: "eve",
            lineWrapping: true,
            autoCloseBrackets: true,
            viewportMargin: Infinity,
            extraKeys: extraKeys
        });
        var cm = this.cmInstance;
        var self = this;
        cm.on("changes", function (cm, changes) {
            self.onChanges(cm, changes);
            if (self.onUpdate) {
                self.onUpdate(self.meta, cm.getValue());
            }
        });
        cm.on("cursorActivity", function (cm) { self.onCursorActivity(cm); });
        cm.on("mousedown", function (cm, e) { self.onMouseDown(cm, e); });
        cm.getWrapperElement().addEventListener("mouseup", function (e) {
            self.onMouseUp(cm, e);
        });
    }
    RichTextEditor.prototype.showFormatBar = function () {
        //@ TODO: re-enable the format bar
        return;
        this.showingFormatBar = true;
        var renderer = new microReact_1.Renderer();
        var cm = this.cmInstance;
        var head = cm.getCursor("head");
        var from = cm.getCursor("from");
        var to = cm.getCursor("to");
        var start = cm.cursorCoords(head, "local");
        var top = start.bottom + 5;
        if ((head.line === from.line && head.ch === from.ch)
            || (cm.cursorCoords(from, "local").top === cm.cursorCoords(to, "local").top)) {
            top = start.top - 40;
        }
        var barSize = 300 / 2;
        var item = { c: "formatBar", style: "position:absolute; left: " + (start.left - barSize) + "px; top:" + top + "px;", children: [
                { c: "button ", text: "H1", click: function () { prefixWithMarkdown(cm, "# "); } },
                { c: "button ", text: "H2", click: function () { prefixWithMarkdown(cm, "## "); } },
                { c: "sep" },
                { c: "button bold", text: "B", click: function () { wrapWithMarkdown(cm, "**"); } },
                { c: "button italic", text: "I", click: function () { wrapWithMarkdown(cm, "_"); } },
                { c: "sep" },
                { c: "button ", text: "-", click: function () { prefixWithMarkdown(cm, "- "); } },
                { c: "button ", text: "1.", click: function () { prefixWithMarkdown(cm, "1. "); } },
                { c: "button ", text: "[ ]", click: function () { prefixWithMarkdown(cm, "[ ] "); } },
                { c: "sep" },
                { c: "button ", text: "link" },
            ] };
        renderer.render([item]);
        var elem = renderer.content.firstChild;
        this.formatBarElement = elem;
        cm.getWrapperElement().appendChild(elem);
        // this.cmInstance.addWidget(pos, elem);
    };
    RichTextEditor.prototype.hideFormatBar = function () {
        this.showingFormatBar = false;
        this.formatBarElement.parentNode.removeChild(this.formatBarElement);
        this.formatBarElement = null;
    };
    RichTextEditor.prototype.onChanges = function (cm, changes) {
        var self = this;
    };
    RichTextEditor.prototype.onCursorActivity = function (cm) {
        if (this.showingFormatBar && !cm.somethingSelected()) {
            this.hideFormatBar();
        }
    };
    RichTextEditor.prototype.onMouseUp = function (cm, e) {
        if (!this.showingFormatBar) {
            var self = this;
            clearTimeout(this.timeout);
            this.timeout = setTimeout(function () {
                if (cm.somethingSelected()) {
                    self.showFormatBar();
                }
            }, this.formatBarDelay);
        }
    };
    RichTextEditor.prototype.onMouseDown = function (cm, e) {
        var cursor = cm.coordsChar({ left: e.clientX, top: e.clientY });
        var pos = cm.indexFromPos(cursor);
        var marks = cm.findMarksAt(cursor);
    };
    RichTextEditor.prototype.addMark = function (paneId, cell, from, to, mark) {
        var cm = this.cmInstance;
        var cellId = cell.id;
        var dom;
        if (!mark) {
            dom = document.createElement("div");
            dom.id = paneId + "|" + cellId + "|container";
        }
        else {
            dom = mark.replacedWith;
            mark.clear();
        }
        var newMark = cm.markText(cm.posFromIndex(from), cm.posFromIndex(to), { replacedWith: dom });
        newMark.cell = cell;
        dom["mark"] = newMark;
        this.marks[cellId] = newMark;
    };
    return RichTextEditor;
})();
exports.RichTextEditor = RichTextEditor;
function createEditor(node, elem) {
    var options = elem.options || {};
    var editor = node.editor;
    var cm;
    if (!editor) {
        editor = node.editor = new RichTextEditor(node, options);
        cm = node.editor.cmInstance;
        if (!options.noFocus) {
            cm.focus();
        }
        cm.refresh(); // @FIXME: This also needs to be called any time it is hidden and added again.
    }
    else {
        cm = node.editor.cmInstance;
    }
    editor.onUpdate = elem.onUpdate;
    editor.meta = elem.meta || editor.meta;
    var doc = cm.getDoc();
    if (doc.getValue() !== elem.value) {
        doc.setValue(elem.value || "");
        doc.clearHistory();
    }
    if (elem.cells) {
        cm.operation(function () {
            var cellIds = {};
            for (var _i = 0, _a = elem.cells; _i < _a.length; _i++) {
                var cell = _a[_i];
                cellIds[cell.id] = true;
                var mark = editor.marks[cell.id];
                var add = false;
                if (!mark) {
                    add = true;
                }
                else {
                    var found = mark.find();
                    if (!found) {
                        add = true;
                    }
                    else {
                        // if the mark doesn't contain the correct text, we need to nuke it.
                        var from = found.from, to = found.to;
                        if (cm.getRange(from, to) !== cell.value || cell.start !== cm.indexFromPos(from)) {
                            add = true;
                        }
                    }
                }
                if (add) {
                    editor.addMark(elem["meta"].paneId, cell, cell.start, cell.start + cell.length, mark);
                }
            }
            for (var markId in editor.marks) {
                if (!cellIds[markId]) {
                    editor.marks[markId].clear();
                    delete editor.marks[markId];
                }
            }
        });
    }
}
exports.createEditor = createEditor;
CodeMirror.defineMode("eve", function () {
    return {
        startState: function () {
            return {};
        },
        token: function (stream, state) {
            if (stream.sol() && stream.peek() === "#") {
                state.header = true;
                stream.eatWhile("#");
                state.headerNum = stream.current().length;
                return "header-indicator header-indicator-" + state.headerNum;
            }
            else if (state.header) {
                stream.skipToEnd();
                state.header = false;
                return "header header-" + state.headerNum;
            }
            else {
                state.header = false;
                stream.skipToEnd();
            }
        }
    };
});
CodeMirror.defineMIME("text/x-eve", "eve");

},{"./microReact":12,"./utils":19,"codemirror":2,"codemirror/mode/clojure/clojure":3,"codemirror/mode/gfm/gfm":4}],15:[function(require,module,exports){
var utils_1 = require("./utils");
var runtime = exports;
exports.MAX_NUMBER = 9007199254740991;
exports.INCREMENTAL = false;
function objectsIdentical(a, b) {
    var aKeys = Object.keys(a);
    for (var _i = 0; _i < aKeys.length; _i++) {
        var key = aKeys[_i];
        //TODO: handle non-scalar values
        if (a[key] !== b[key])
            return false;
    }
    return true;
}
function indexOfFact(haystack, needle) {
    var ix = 0;
    for (var _i = 0; _i < haystack.length; _i++) {
        var fact = haystack[_i];
        if (fact.__id === needle.__id) {
            return ix;
        }
        ix++;
    }
    return -1;
}
function removeFact(haystack, needle) {
    var ix = indexOfFact(haystack, needle);
    if (ix > -1)
        haystack.splice(ix, 1);
    return haystack;
}
exports.removeFact = removeFact;
function diffAddsAndRemoves(adds, removes) {
    var localHash = {};
    var hashToFact = {};
    var hashes = [];
    for (var _i = 0; _i < adds.length; _i++) {
        var add = adds[_i];
        var hash = add.__id;
        if (localHash[hash] === undefined) {
            localHash[hash] = 1;
            hashToFact[hash] = add;
            hashes.push(hash);
        }
        else {
            localHash[hash]++;
        }
        add.__id = hash;
    }
    for (var _a = 0; _a < removes.length; _a++) {
        var remove = removes[_a];
        var hash = remove.__id;
        if (localHash[hash] === undefined) {
            localHash[hash] = -1;
            hashToFact[hash] = remove;
            hashes.push(hash);
        }
        else {
            localHash[hash]--;
        }
        remove.__id = hash;
    }
    var realAdds = [];
    var realRemoves = [];
    for (var _b = 0; _b < hashes.length; _b++) {
        var hash = hashes[_b];
        var count = localHash[hash];
        if (count > 0) {
            var fact = hashToFact[hash];
            realAdds.push(fact);
        }
        else if (count < 0) {
            var fact = hashToFact[hash];
            realRemoves.push(fact);
        }
    }
    return { adds: realAdds, removes: realRemoves };
}
function generateEqualityFn(keys) {
    return new Function("a", "b", "return " + keys.map(function (key, ix) {
        if (key.constructor === Array) {
            return "a['" + key[0] + "']['" + key[1] + "'] === b['" + key[0] + "']['" + key[1] + "']";
        }
        else {
            return "a[\"" + key + "\"] === b[\"" + key + "\"]";
        }
    }).join(" && ") + ";");
}
function generateStringFn(keys) {
    var keyStrings = [];
    for (var _i = 0; _i < keys.length; _i++) {
        var key = keys[_i];
        if (key.constructor === Array) {
            keyStrings.push("a['" + key[0] + "']['" + key[1] + "']");
        }
        else {
            keyStrings.push("a['" + key + "']");
        }
    }
    var final = keyStrings.join(' + "|" + ');
    return new Function("a", "return " + final + ";");
}
function generateUnprojectedSorterCode(unprojectedSize, sorts) {
    var conditions = [];
    var path = [];
    var distance = unprojectedSize;
    for (var _i = 0; _i < sorts.length; _i++) {
        var sort = sorts[_i];
        var condition = "";
        for (var _a = 0; _a < path.length; _a++) {
            var prev = path[_a];
            var table_1 = prev[0], key_1 = prev[1];
            condition += "unprojected[j-" + (distance - table_1) + "]['" + key_1 + "'] === item" + table_1 + "['" + key_1 + "'] && ";
        }
        var table = sort[0], key = sort[1], dir = sort[2];
        var op = ">";
        if (dir === "descending") {
            op = "<";
        }
        condition += "unprojected[j-" + (distance - table) + "]['" + key + "'] " + op + " item" + table + "['" + key + "']";
        conditions.push(condition);
        path.push(sort);
    }
    var items = [];
    var repositioned = [];
    var itemAssignments = [];
    for (var ix = 0; ix < distance; ix++) {
        items.push("item" + ix + " = unprojected[j+" + ix + "]");
        repositioned.push("unprojected[j+" + ix + "] = unprojected[j - " + (distance - ix) + "]");
        itemAssignments.push(("unprojected[j+" + ix + "] = item" + ix));
    }
    return "for (var i = 0, len = unprojected.length; i < len; i += " + distance + ") {\n      var j = i, " + items.join(", ") + ";\n      for(; j > " + (distance - 1) + " && (" + conditions.join(" || ") + "); j -= " + distance + ") {\n        " + repositioned.join(";\n") + "\n      }\n      " + itemAssignments.join(";\n") + "\n  }";
}
function generateCollector(keys) {
    var code = "var runtime = this;\n";
    var ix = 0;
    var checks = "";
    var removes = "var cur = index";
    for (var _i = 0; _i < keys.length; _i++) {
        var key = keys[_i];
        if (key.constructor === Array) {
            removes += "[remove['" + key[0] + "']['" + key[1] + "']]";
        }
        else {
            removes += "[remove['" + key + "']]";
        }
    }
    removes += ";\nruntime.removeFact(cur, remove);";
    for (var _a = 0; _a < keys.length; _a++) {
        var key = keys[_a];
        ix++;
        if (key.constructor === Array) {
            checks += "value = add['" + key[0] + "']['" + key[1] + "']\n";
        }
        else {
            checks += "value = add['" + key + "']\n";
        }
        var path = "cursor[value]";
        checks += "if(!" + path + ") " + path + " = ";
        if (ix === keys.length) {
            checks += "[]\n";
        }
        else {
            checks += "{}\n";
        }
        checks += "cursor = " + path + "\n";
    }
    code += "\nfor(var ix = 0, len = removes.length; ix < len; ix++) {\nvar remove = removes[ix];\n" + removes + "\n}\nfor(var ix = 0, len = adds.length; ix < len; ix++) {\nvar add = adds[ix];\nvar cursor = index;\nvar value;\n" + checks + "  cursor.push(add);\n}\nreturn index;";
    return (new Function("index", "adds", "removes", code)).bind(runtime);
}
function generateCollector2(keys) {
    var hashParts = [];
    for (var _i = 0; _i < keys.length; _i++) {
        var key = keys[_i];
        if (key.constructor === Array) {
            hashParts.push("add['" + key[0] + "']['" + key[1] + "']");
        }
        else {
            hashParts.push("add['" + key + "']");
        }
    }
    var code = "\n    var ixCache = cache.ix;\n    var idCache = cache.id;\n    for(var ix = 0, len = removes.length; ix < len; ix++) {\n      var remove = removes[ix];\n      var id = remove.__id;\n      var key = idCache[id];\n      var factIx = ixCache[id];\n      var facts = index[key];\n      //swap the last fact with this one to prevent holes\n      var lastFact = facts.pop();\n      if(lastFact && lastFact.__id !== remove.__id) {\n        facts[factIx] = lastFact;\n        ixCache[lastFact.__id] = factIx;\n      } else if(facts.length === 0) {\n        delete index[key];\n      }\n      delete idCache[id];\n      delete ixCache[id];\n    }\n    for(var ix = 0, len = adds.length; ix < len; ix++) {\n      var add = adds[ix];\n      var id = add.__id;\n      var key = idCache[id] = " + hashParts.join(" + '|' + ") + ";\n      if(index[key] === undefined) index[key] = [];\n      var arr = index[key];\n      ixCache[id] = arr.length;\n      arr.push(add);\n    }\n    return index;";
    return new Function("index", "adds", "removes", "cache", code);
}
function mergeArrays(as, bs) {
    var ix = as.length;
    var start = ix;
    for (var _i = 0; _i < bs.length; _i++) {
        var b = bs[_i];
        as[ix] = bs[ix - start];
        ix++;
    }
    return as;
}
var Diff = (function () {
    function Diff(ixer) {
        this.ixer = ixer;
        this.tables = {};
        this.length = 0;
        this.meta = {};
    }
    Diff.prototype.ensureTable = function (table) {
        var tableDiff = this.tables[table];
        if (!tableDiff) {
            tableDiff = this.tables[table] = { adds: [], removes: [] };
        }
        return tableDiff;
    };
    Diff.prototype.add = function (table, obj) {
        var tableDiff = this.ensureTable(table);
        this.length++;
        tableDiff.adds.push(obj);
        return this;
    };
    Diff.prototype.addMany = function (table, objs) {
        var tableDiff = this.ensureTable(table);
        this.length += objs.length;
        mergeArrays(tableDiff.adds, objs);
        return this;
    };
    Diff.prototype.removeFacts = function (table, objs) {
        var tableDiff = this.ensureTable(table);
        this.length += objs.length;
        mergeArrays(tableDiff.removes, objs);
        return this;
    };
    Diff.prototype.remove = function (table, query) {
        var tableDiff = this.ensureTable(table);
        var found = this.ixer.find(table, query);
        this.length += found.length;
        mergeArrays(tableDiff.removes, found);
        return this;
    };
    Diff.prototype.merge = function (diff) {
        for (var table in diff.tables) {
            var tableDiff = diff.tables[table];
            this.addMany(table, tableDiff.adds);
            this.removeFacts(table, tableDiff.removes);
        }
        return this;
    };
    Diff.prototype.reverse = function () {
        var reversed = new Diff(this.ixer);
        for (var table in this.tables) {
            var diff = this.tables[table];
            reversed.addMany(table, diff.removes);
            reversed.removeFacts(table, diff.adds);
        }
        return reversed;
    };
    return Diff;
})();
exports.Diff = Diff;
var Indexer = (function () {
    function Indexer() {
        this.tables = {};
        this.globalCount = 0;
        this.edbTables = {};
    }
    Indexer.prototype.addTable = function (name, keys) {
        if (keys === void 0) { keys = []; }
        var table = this.tables[name];
        keys = keys.filter(function (key) { return key !== "__id"; });
        if (table && keys.length) {
            table.fields = keys;
            table.stringify = generateStringFn(keys);
        }
        else {
            table = this.tables[name] = { table: [], hashToIx: {}, factHash: {}, indexes: {}, triggers: {}, fields: keys, stringify: generateStringFn(keys), keyLookup: {} };
            this.edbTables[name] = true;
        }
        for (var _i = 0; _i < keys.length; _i++) {
            var key = keys[_i];
            if (key.constructor === Array) {
                table.keyLookup[key[0]] = key;
            }
            else {
                table.keyLookup[key] = key;
            }
        }
        return table;
    };
    Indexer.prototype.clearTable = function (name) {
        var table = this.tables[name];
        if (!table)
            return;
        table.table = [];
        table.factHash = {};
        for (var indexName in table.indexes) {
            table.indexes[indexName].index = {};
            table.indexes[indexName].cache = { id: {}, ix: {} };
        }
    };
    Indexer.prototype.updateTable = function (tableId, adds, removes) {
        var table = this.tables[tableId];
        if (!table || !table.fields.length) {
            var example = adds[0] || removes[0];
            table = this.addTable(tableId, Object.keys(example));
        }
        var stringify = table.stringify;
        var facts = table.table;
        var factHash = table.factHash;
        var hashToIx = table.hashToIx;
        var localHash = {};
        var hashToFact = {};
        var hashes = [];
        for (var _i = 0; _i < adds.length; _i++) {
            var add = adds[_i];
            var hash = add.__id || stringify(add);
            if (localHash[hash] === undefined) {
                localHash[hash] = 1;
                hashToFact[hash] = add;
                hashes.push(hash);
            }
            else {
                localHash[hash]++;
            }
            add.__id = hash;
        }
        for (var _a = 0; _a < removes.length; _a++) {
            var remove = removes[_a];
            var hash = remove.__id || stringify(remove);
            if (localHash[hash] === undefined) {
                localHash[hash] = -1;
                hashToFact[hash] = remove;
                hashes.push(hash);
            }
            else {
                localHash[hash]--;
            }
            remove.__id = hash;
        }
        var realAdds = [];
        var realRemoves = [];
        for (var _b = 0; _b < hashes.length; _b++) {
            var hash = hashes[_b];
            var count = localHash[hash];
            if (count > 0 && !factHash[hash]) {
                var fact = hashToFact[hash];
                realAdds.push(fact);
                facts.push(fact);
                factHash[hash] = fact;
                hashToIx[hash] = facts.length - 1;
            }
            else if (count < 0 && factHash[hash]) {
                var fact = hashToFact[hash];
                var ix = hashToIx[hash];
                //swap the last fact with this one to prevent holes
                var lastFact = facts.pop();
                if (lastFact && lastFact.__id !== fact.__id) {
                    facts[ix] = lastFact;
                    hashToIx[lastFact.__id] = ix;
                }
                realRemoves.push(fact);
                delete factHash[hash];
                delete hashToIx[hash];
            }
        }
        return { adds: realAdds, removes: realRemoves };
    };
    Indexer.prototype.collector = function (keys) {
        return {
            index: {},
            cache: { id: {}, ix: {} },
            hasher: generateStringFn(keys),
            collect: generateCollector2(keys),
        };
    };
    Indexer.prototype.factToIndex = function (table, fact) {
        var keys = Object.keys(fact);
        if (!keys.length)
            return table.table.slice();
        var index = this.index(table, keys);
        var result = index.index[index.hasher(fact)];
        if (result) {
            return result.slice();
        }
        return [];
    };
    Indexer.prototype.execDiff = function (diff) {
        var triggers = {};
        var realDiffs = {};
        var tableIds = Object.keys(diff.tables);
        for (var _i = 0; _i < tableIds.length; _i++) {
            var tableId = tableIds[_i];
            var tableDiff = diff.tables[tableId];
            if (tableDiff.adds.length === 0 && tableDiff.removes.length === 0)
                continue;
            var realDiff = this.updateTable(tableId, tableDiff.adds, tableDiff.removes);
            // go through all the indexes and update them.
            var table = this.tables[tableId];
            var indexes = Object.keys(table.indexes);
            for (var _a = 0; _a < indexes.length; _a++) {
                var indexName = indexes[_a];
                var index = table.indexes[indexName];
                index.collect(index.index, realDiff.adds, realDiff.removes, index.cache);
            }
            var curTriggers = Object.keys(table.triggers);
            for (var _b = 0; _b < curTriggers.length; _b++) {
                var triggerName = curTriggers[_b];
                var trigger = table.triggers[triggerName];
                triggers[triggerName] = trigger;
            }
            realDiffs[tableId] = realDiff;
        }
        return { triggers: triggers, realDiffs: realDiffs };
    };
    Indexer.prototype.execTrigger = function (trigger) {
        var table = this.table(trigger.name);
        // since views might be changed during the triggering process, we want to favor
        // just using the view itself as the trigger if it is one. Otherwise, we use the
        // trigger's exec function. This ensures that if a view is recompiled and added
        // that any already queued triggers will use the updated version of the view instead
        // of the old queued one.
        var _a = (table.view ? table.view.exec() : trigger.exec(this)) || {}, _b = _a.results, results = _b === void 0 ? undefined : _b, _c = _a.unprojected, unprojected = _c === void 0 ? undefined : _c;
        if (!results)
            return;
        var prevResults = table.factHash;
        var prevHashes = Object.keys(prevResults);
        table.unprojected = unprojected;
        if (results) {
            var diff = new Diff(this);
            this.clearTable(trigger.name);
            diff.addMany(trigger.name, results);
            var triggers = this.execDiff(diff).triggers;
            var newHashes = table.factHash;
            if (prevHashes.length === Object.keys(newHashes).length) {
                var same = true;
                for (var _i = 0; _i < prevHashes.length; _i++) {
                    var hash = prevHashes[_i];
                    if (!newHashes[hash]) {
                        same = false;
                        break;
                    }
                }
                return same ? undefined : triggers;
            }
            else {
                return triggers;
            }
        }
        return;
    };
    Indexer.prototype.transitivelyClearTriggers = function (startingTriggers) {
        var cleared = {};
        var remaining = Object.keys(startingTriggers);
        for (var ix = 0; ix < remaining.length; ix++) {
            var trigger = remaining[ix];
            if (cleared[trigger])
                continue;
            this.clearTable(trigger);
            cleared[trigger] = true;
            remaining.push.apply(remaining, Object.keys(this.table(trigger).triggers));
        }
        return cleared;
    };
    Indexer.prototype.execTriggers = function (triggers) {
        var newTriggers = {};
        var retrigger = false;
        for (var triggerName in triggers) {
            // console.log("Calling:", triggerName);
            var trigger = triggers[triggerName];
            var nextRound = this.execTrigger(trigger);
            if (nextRound) {
                retrigger = true;
                for (var trigger_1 in nextRound) {
                    // console.log("Queuing:", trigger);
                    newTriggers[trigger_1] = nextRound[trigger_1];
                }
            }
        }
        if (retrigger) {
            return newTriggers;
        }
    };
    //---------------------------------------------------------
    // Indexer Public API
    //---------------------------------------------------------
    Indexer.prototype.deleteDB = function () {
        for (var table in this.tables) {
            this.removeView(table);
            this.clearTable(table);
        }
    };
    Indexer.prototype.serialize = function (asObject) {
        var dump = {};
        for (var tableName in this.tables) {
            var table = this.tables[tableName];
            if (!table.isView) {
                dump[tableName] = table.table;
            }
        }
        if (asObject) {
            return dump;
        }
        return JSON.stringify(dump);
    };
    Indexer.prototype.load = function (serialized) {
        var dump = JSON.parse(serialized);
        var diff = this.diff();
        for (var tableName in dump) {
            diff.addMany(tableName, dump[tableName]);
        }
        if (exports.INCREMENTAL) {
            this.applyDiffIncremental(diff);
        }
        else {
            this.applyDiff(diff);
        }
    };
    Indexer.prototype.diff = function () {
        return new Diff(this);
    };
    Indexer.prototype.applyDiff = function (diff) {
        if (exports.INCREMENTAL) {
            return this.applyDiffIncremental(diff);
        }
        var _a = this.execDiff(diff), triggers = _a.triggers, realDiffs = _a.realDiffs;
        var cleared;
        var round = 0;
        if (triggers)
            cleared = this.transitivelyClearTriggers(triggers);
        while (triggers) {
            for (var trigger in triggers) {
                cleared[trigger] = false;
            }
            // console.group(`ROUND ${round}`);
            triggers = this.execTriggers(triggers);
            round++;
        }
        for (var _i = 0, _b = Object.keys(cleared); _i < _b.length; _i++) {
            var trigger = _b[_i];
            if (!cleared[trigger])
                continue;
            var view = this.table(trigger).view;
            if (view) {
                this.execTrigger(view);
            }
        }
    };
    Indexer.prototype.table = function (tableId) {
        var table = this.tables[tableId];
        if (table)
            return table;
        return this.addTable(tableId);
    };
    Indexer.prototype.index = function (tableOrId, keys) {
        var table;
        if (typeof tableOrId === "string")
            table = this.table(tableOrId);
        else
            table = tableOrId;
        keys.sort();
        var indexName = keys.filter(function (key) { return key !== "__id"; }).join("|");
        var index = table.indexes[indexName];
        if (!index) {
            var tableKeys = [];
            for (var _i = 0; _i < keys.length; _i++) {
                var key = keys[_i];
                tableKeys.push(table.keyLookup[key] || key);
            }
            index = table.indexes[indexName] = this.collector(tableKeys);
            index.collect(index.index, table.table, [], index.cache);
        }
        return index;
    };
    Indexer.prototype.find = function (tableId, query) {
        var table = this.tables[tableId];
        if (!table) {
            return [];
        }
        else if (!query) {
            return table.table.slice();
        }
        else {
            return this.factToIndex(table, query);
        }
    };
    Indexer.prototype.findOne = function (tableId, query) {
        return this.find(tableId, query)[0];
    };
    Indexer.prototype.query = function (name) {
        if (name === void 0) { name = "unknown"; }
        return new Query(this, name);
    };
    Indexer.prototype.union = function (name) {
        return new Union(this, name);
    };
    Indexer.prototype.trigger = function (name, table, exec, execIncremental) {
        var tables = (typeof table === "string") ? [table] : table;
        var trigger = { name: name, tables: tables, exec: exec, execIncremental: execIncremental };
        for (var _i = 0; _i < tables.length; _i++) {
            var tableId = tables[_i];
            var table_2 = this.table(tableId);
            table_2.triggers[name] = trigger;
        }
        if (!exports.INCREMENTAL) {
            var nextRound = this.execTrigger(trigger);
            while (nextRound) {
                nextRound = this.execTriggers(nextRound);
            }
            ;
        }
        else {
            if (!tables.length) {
                return exec(this);
            }
            var initial = (_a = {}, _a[tables[0]] = { adds: this.tables[tables[0]].table, removes: [] }, _a);
            var _b = this.execTriggerIncremental(trigger, initial), triggers = _b.triggers, changes = _b.changes;
            while (triggers) {
                var results = this.execTriggersIncremental(triggers, changes);
                if (!results)
                    break;
                triggers = results.triggers;
                changes = results.changes;
            }
        }
        var _a;
    };
    Indexer.prototype.asView = function (query) {
        var name = query.name;
        if (this.tables[name]) {
            this.removeView(name);
        }
        var view = this.table(name);
        this.edbTables[name] = false;
        view.view = query;
        view.isView = true;
        this.trigger(name, query.tables, query.exec.bind(query), query.execIncremental.bind(query));
    };
    Indexer.prototype.removeView = function (id) {
        for (var _i = 0, _a = this.tables; _i < _a.length; _i++) {
            var table = _a[_i];
            delete table.triggers[id];
        }
    };
    Indexer.prototype.totalFacts = function () {
        var total = 0;
        for (var tableName in this.tables) {
            total += this.tables[tableName].table.length;
        }
        return total;
    };
    Indexer.prototype.factsPerTable = function () {
        var info = {};
        for (var tableName in this.tables) {
            info[tableName] = this.tables[tableName].table.length;
        }
        return info;
    };
    Indexer.prototype.applyDiffIncremental = function (diff) {
        if (diff.length === 0)
            return;
        // console.log("DIFF SIZE: ", diff.length, diff);
        var _a = this.execDiff(diff), triggers = _a.triggers, realDiffs = _a.realDiffs;
        var round = 0;
        var changes = realDiffs;
        while (triggers) {
            // console.group(`ROUND ${round}`);
            // console.log("CHANGES: ", changes);
            var results = this.execTriggersIncremental(triggers, changes);
            // console.groupEnd();
            if (!results)
                break;
            triggers = results.triggers;
            changes = results.changes;
            round++;
        }
    };
    Indexer.prototype.execTriggerIncremental = function (trigger, changes) {
        var table = this.table(trigger.name);
        var adds, provenance, removes, info;
        if (trigger.execIncremental) {
            info = trigger.execIncremental(changes, table) || {};
            adds = info.adds;
            removes = info.removes;
        }
        else {
            trigger.exec();
            return;
        }
        var diff = new runtime.Diff(this);
        if (adds.length) {
            diff.addMany(trigger.name, adds);
        }
        if (removes.length) {
            diff.removeFacts(trigger.name, removes);
        }
        var updated = this.execDiff(diff);
        var realDiffs = updated.realDiffs;
        if (realDiffs[trigger.name] && (realDiffs[trigger.name].adds.length || realDiffs[trigger.name].removes)) {
            return { changes: realDiffs[trigger.name], triggers: updated.triggers };
        }
        else {
            return {};
        }
    };
    Indexer.prototype.execTriggersIncremental = function (triggers, changes) {
        var newTriggers = {};
        var nextChanges = {};
        var retrigger = false;
        var triggerKeys = Object.keys(triggers);
        for (var _i = 0; _i < triggerKeys.length; _i++) {
            var triggerName = triggerKeys[_i];
            // console.log("Calling:", triggerName);
            var trigger = triggers[triggerName];
            var nextRound = this.execTriggerIncremental(trigger, changes);
            if (nextRound && nextRound.changes) {
                nextChanges[triggerName] = nextRound.changes;
                if (nextRound.triggers) {
                    var nextRoundKeys = Object.keys(nextRound.triggers);
                    for (var _a = 0; _a < nextRoundKeys.length; _a++) {
                        var trigger_2 = nextRoundKeys[_a];
                        if (trigger_2 && nextRound.triggers[trigger_2]) {
                            retrigger = true;
                            // console.log("Queuing:", trigger);
                            newTriggers[trigger_2] = nextRound.triggers[trigger_2];
                        }
                    }
                }
            }
        }
        if (retrigger) {
            return { changes: nextChanges, triggers: newTriggers };
        }
    };
    return Indexer;
})();
exports.Indexer = Indexer;
function addProvenanceTable(ixer) {
    var table = ixer.addTable("provenance", ["table", ["row", "__id"], "row instance", "source", ["source row", "__id"]]);
    // generate some indexes that we know we're going to need upfront
    ixer.index("provenance", ["table", "row"]);
    ixer.index("provenance", ["table", "row instance"]);
    ixer.index("provenance", ["table", "source", "source row"]);
    ixer.index("provenance", ["table"]);
    return ixer;
}
exports.addProvenanceTable = addProvenanceTable;
function mappingToDiff(diff, action, mapping, aliases, reverseLookup) {
    for (var from in mapping) {
        var to = mapping[from];
        if (to.constructor === Array) {
            var source = to[0];
            if (typeof source === "number") {
                source = aliases[reverseLookup[source]];
            }
            else {
                source = aliases[source];
            }
            diff.add("action mapping", { action: action, from: from, "to source": source, "to field": to[1] });
        }
        else {
            diff.add("action mapping constant", { action: action, from: from, value: to });
        }
    }
    return diff;
}
exports.QueryFunctions = {};
var STRIP_COMMENTS = /((\/\/.*$)|(\/\*[\s\S]*?\*\/))/mg;
var ARGUMENT_NAMES = /([^\s,]+)/g;
function getParamNames(func) {
    var fnStr = func.toString().replace(STRIP_COMMENTS, '');
    var result = fnStr.slice(fnStr.indexOf('(') + 1, fnStr.indexOf(')')).match(ARGUMENT_NAMES);
    if (result === null)
        result = [];
    return result;
}
function define(name, opts, func) {
    var params = getParamNames(func);
    opts.name = name;
    opts.params = params;
    opts.func = func;
    exports.QueryFunctions[name] = opts;
}
exports.define = define;
var Query = (function () {
    function Query(ixer, name) {
        if (name === void 0) { name = "unknown"; }
        this.name = name;
        this.ixer = ixer;
        this.dirty = true;
        this.tables = [];
        this.joins = [];
        this.aliases = {};
        this.funcs = [];
        this.aggregates = [];
        this.unprojectedSize = 0;
        this.hasOrdinal = false;
    }
    Query.remove = function (view, ixer) {
        var diff = ixer.diff();
        diff.remove("view", { view: view });
        for (var _i = 0, _a = ixer.find("action", { view: view }); _i < _a.length; _i++) {
            var actionItem = _a[_i];
            var action = actionItem.action;
            diff.remove("action", { action: action });
            diff.remove("action source", { action: action });
            diff.remove("action mapping", { action: action });
            diff.remove("action mapping constant", { action: action });
            diff.remove("action mapping sorted", { action: action });
            diff.remove("action mapping limit", { action: action });
        }
        return diff;
    };
    Query.prototype.changeset = function (ixer) {
        var diff = ixer.diff();
        var aliases = {};
        var reverseLookup = {};
        for (var alias in this.aliases) {
            reverseLookup[this.aliases[alias]] = alias;
        }
        var view = this.name;
        diff.add("view", { view: view, kind: "query" });
        //joins
        for (var _i = 0, _a = this.joins; _i < _a.length; _i++) {
            var join = _a[_i];
            var action = utils_1.uuid();
            aliases[join.as] = action;
            if (!join.negated) {
                diff.add("action", { view: view, action: action, kind: "select", ix: join.ix });
            }
            else {
                diff.add("action", { view: view, action: action, kind: "deselect", ix: join.ix });
            }
            diff.add("action source", { action: action, "source view": join.table });
            mappingToDiff(diff, action, join.join, aliases, reverseLookup);
        }
        //functions
        for (var _b = 0, _c = this.funcs; _b < _c.length; _b++) {
            var func = _c[_b];
            var action = utils_1.uuid();
            aliases[func.as] = action;
            diff.add("action", { view: view, action: action, kind: "calculate", ix: func.ix });
            diff.add("action source", { action: action, "source view": func.name });
            mappingToDiff(diff, action, func.args, aliases, reverseLookup);
        }
        //aggregates
        for (var _d = 0, _e = this.aggregates; _d < _e.length; _d++) {
            var agg = _e[_d];
            var action = utils_1.uuid();
            aliases[agg.as] = action;
            diff.add("action", { view: view, action: action, kind: "aggregate", ix: agg.ix });
            diff.add("action source", { action: action, "source view": agg.name });
            mappingToDiff(diff, action, agg.args, aliases, reverseLookup);
        }
        //sort
        if (this.sorts) {
            var action = utils_1.uuid();
            diff.add("action", { view: view, action: action, kind: "sort", ix: exports.MAX_NUMBER });
            var ix = 0;
            for (var _f = 0, _g = this.sorts; _f < _g.length; _f++) {
                var sort = _g[_f];
                var source = sort[0], field = sort[1], direction = sort[2];
                if (typeof source === "number") {
                    source = aliases[reverseLookup[source]];
                }
                else {
                    source = aliases[source];
                }
                diff.add("action mapping sorted", { action: action, ix: ix, source: source, field: field, direction: direction });
                ix++;
            }
        }
        //group
        if (this.groups) {
            var action = utils_1.uuid();
            diff.add("action", { view: view, action: action, kind: "group", ix: exports.MAX_NUMBER });
            var ix = 0;
            for (var _h = 0, _j = this.groups; _h < _j.length; _h++) {
                var group = _j[_h];
                var source = group[0], field = group[1];
                if (typeof source === "number") {
                    source = aliases[reverseLookup[source]];
                }
                else {
                    source = aliases[source];
                }
                diff.add("action mapping sorted", { action: action, ix: ix, source: source, field: field, direction: "ascending" });
                ix++;
            }
        }
        //limit
        if (this.limitInfo) {
            var action = utils_1.uuid();
            diff.add("action", { view: view, action: action, kind: "limit", ix: exports.MAX_NUMBER });
            for (var limitType in this.limitInfo) {
                diff.add("action mapping limit", { action: action, "limit type": limitType, value: this.limitInfo[limitType] });
            }
        }
        //projection
        if (this.projectionMap) {
            var action = utils_1.uuid();
            diff.add("action", { view: view, action: action, kind: "project", ix: exports.MAX_NUMBER });
            mappingToDiff(diff, action, this.projectionMap, aliases, reverseLookup);
        }
        return diff;
    };
    Query.prototype.validateFields = function (tableName, joinObject) {
        var table = this.ixer.table(tableName);
        for (var field in joinObject) {
            if (table.fields.length && !table.keyLookup[field]) {
                throw new Error("Table '" + tableName + "' doesn't have a field '" + field + "'.\n\nAvailable fields: " + table.fields.join(", "));
            }
            var joinInfo = joinObject[field];
            if (joinInfo.constructor === Array) {
                var joinNumber = joinInfo[0], referencedField = joinInfo[1];
                if (typeof joinNumber !== "number") {
                    joinNumber = this.aliases[joinNumber];
                }
                var join = this.joins[joinNumber];
                if (join && join.ix === joinNumber) {
                    var referencedTable = this.ixer.table(join.table);
                    if (!referencedTable.fields.length)
                        continue;
                    if (!referencedTable.keyLookup[referencedField]) {
                        throw new Error("Table '" + join.table + "' doesn't have a field '" + referencedField + "'.\n\nAvailable fields: " + referencedTable.fields.join(", "));
                    }
                }
            }
        }
    };
    Query.prototype.select = function (table, join, as) {
        this.dirty = true;
        if (as) {
            this.aliases[as] = Object.keys(this.aliases).length;
        }
        this.unprojectedSize++;
        this.tables.push(table);
        this.validateFields(table, join);
        this.joins.push({ negated: false, table: table, join: join, as: as, ix: this.aliases[as] });
        return this;
    };
    Query.prototype.deselect = function (table, join) {
        this.dirty = true;
        this.tables.push(table);
        this.validateFields(table, join);
        this.joins.push({ negated: true, table: table, join: join, ix: this.joins.length * 1000 });
        return this;
    };
    Query.prototype.calculate = function (funcName, args, as) {
        this.dirty = true;
        if (as) {
            this.aliases[as] = Object.keys(this.aliases).length;
        }
        if (!exports.QueryFunctions[funcName].filter) {
            this.unprojectedSize++;
        }
        this.funcs.push({ name: funcName, args: args, as: as, ix: this.aliases[as] });
        return this;
    };
    Query.prototype.project = function (projectionMap) {
        this.projectionMap = projectionMap;
        this.validateFields(undefined, projectionMap);
        return this;
    };
    Query.prototype.group = function (groups) {
        this.dirty = true;
        if (groups[0] && groups[0].constructor === Array) {
            this.groups = groups;
        }
        else {
            if (!this.groups)
                this.groups = [];
            this.groups.push(groups);
        }
        return this;
    };
    Query.prototype.sort = function (sorts) {
        this.dirty = true;
        if (sorts[0] && sorts[0].constructor === Array) {
            this.sorts = sorts;
        }
        else {
            if (!this.sorts)
                this.sorts = [];
            this.sorts.push(sorts);
        }
        return this;
    };
    Query.prototype.limit = function (limitInfo) {
        this.dirty = true;
        if (!this.limitInfo) {
            this.limitInfo = {};
        }
        for (var key in limitInfo) {
            this.limitInfo[key] = limitInfo[key];
        }
        return this;
    };
    Query.prototype.aggregate = function (funcName, args, as) {
        this.dirty = true;
        if (as) {
            this.aliases[as] = Object.keys(this.aliases).length;
        }
        this.unprojectedSize++;
        this.aggregates.push({ name: funcName, args: args, as: as, ix: this.aliases[as] });
        return this;
    };
    Query.prototype.ordinal = function () {
        this.dirty = true;
        this.hasOrdinal = true;
        this.unprojectedSize++;
        return this;
    };
    Query.prototype.applyAliases = function (joinMap) {
        for (var field in joinMap) {
            var joinInfo = joinMap[field];
            if (joinInfo.constructor !== Array || typeof joinInfo[0] === "number")
                continue;
            var joinTable = joinInfo[0];
            if (joinTable === "ordinal") {
                joinInfo[0] = this.unprojectedSize - 1;
            }
            else if (this.aliases[joinTable] !== undefined) {
                joinInfo[0] = this.aliases[joinTable];
            }
            else {
                throw new Error("Invalid alias used: " + joinTable);
            }
        }
    };
    Query.prototype.toAST = function () {
        var cursor = { type: "query",
            children: [] };
        var root = cursor;
        var results = [];
        // by default the only thing we return are the unprojected results
        var returns = ["unprojected", "provenance"];
        // we need an array to store our unprojected results
        root.children.push({ type: "declaration", var: "unprojected", value: "[]" });
        root.children.push({ type: "declaration", var: "provenance", value: "[]" });
        root.children.push({ type: "declaration", var: "projected", value: "{}" });
        // run through each table nested in the order they were given doing pairwise
        // joins along the way.
        for (var _i = 0, _a = this.joins; _i < _a.length; _i++) {
            var join = _a[_i];
            var table = join.table, ix = join.ix, negated = join.negated;
            var cur = {
                type: "select",
                table: table,
                passed: ix === 0,
                ix: ix,
                negated: negated,
                children: [],
                join: false,
            };
            // we only want to eat the cost of dealing with indexes
            // if we are actually joining on something
            var joinMap = join.join;
            this.applyAliases(joinMap);
            if (joinMap && Object.keys(joinMap).length !== 0) {
                root.children.unshift({ type: "declaration", var: "query" + ix, value: "{}" });
                cur.join = joinMap;
            }
            cursor.children.push(cur);
            if (!negated) {
                results.push({ type: "select", ix: ix });
            }
            cursor = cur;
        }
        // at the bottom of the joins, we calculate all the functions based on the values
        // collected
        for (var _b = 0, _c = this.funcs; _b < _c.length; _b++) {
            var func = _c[_b];
            var args = func.args, name_1 = func.name, ix = func.ix;
            var funcInfo = exports.QueryFunctions[name_1];
            this.applyAliases(args);
            root.children.unshift({ type: "functionDeclaration", ix: ix, info: funcInfo });
            if (funcInfo.multi || funcInfo.filter) {
                var node = { type: "functionCallMultiReturn", ix: ix, args: args, info: funcInfo, children: [] };
                cursor.children.push(node);
                cursor = node;
            }
            else {
                cursor.children.push({ type: "functionCall", ix: ix, args: args, info: funcInfo, children: [] });
            }
            if (!funcInfo.noReturn && !funcInfo.filter) {
                results.push({ type: "function", ix: ix });
            }
        }
        // now that we're at the bottom of the join, store the unprojected result
        cursor.children.push({ type: "result", results: results });
        //Aggregation
        //sort the unprojected results based on groupings and the given sorts
        var sorts = [];
        var alreadySorted = {};
        if (this.groups) {
            this.applyAliases(this.groups);
            for (var _d = 0, _e = this.groups; _d < _e.length; _d++) {
                var group = _e[_d];
                var table = group[0], field = group[1];
                sorts.push(group);
                alreadySorted[(table + "|" + field)] = true;
            }
        }
        if (this.sorts) {
            this.applyAliases(this.sorts);
            for (var _f = 0, _g = this.sorts; _f < _g.length; _f++) {
                var sort = _g[_f];
                var table = sort[0], field = sort[1];
                if (!alreadySorted[(table + "|" + field)]) {
                    sorts.push(sort);
                }
            }
        }
        var size = this.unprojectedSize;
        if (sorts.length) {
            root.children.push({ type: "sort", sorts: sorts, size: size, children: [] });
        }
        //then we need to run through the sorted items and do the aggregate as a fold.
        if (this.aggregates.length || sorts.length || this.limitInfo || this.hasOrdinal) {
            // we need to store group info for post processing of the unprojected results
            // this will indicate what group number, if any, that each unprojected result belongs to
            root.children.unshift({ type: "declaration", var: "groupInfo", value: "[]" });
            returns.push("groupInfo");
            var aggregateChildren = [];
            for (var _h = 0, _j = this.aggregates; _h < _j.length; _h++) {
                var func = _j[_h];
                var args = func.args, name_2 = func.name, ix = func.ix;
                var funcInfo = exports.QueryFunctions[name_2];
                this.applyAliases(args);
                root.children.unshift({ type: "functionDeclaration", ix: ix, info: funcInfo });
                aggregateChildren.push({ type: "functionCall", ix: ix, resultsIx: results.length, args: args, info: funcInfo, unprojected: true, children: [] });
                results.push({ type: "placeholder" });
            }
            if (this.hasOrdinal === true) {
                aggregateChildren.push({ type: "ordinal" });
                results.push({ type: "placeholder" });
            }
            var aggregate = { type: "aggregate loop", groups: this.groups, limit: this.limitInfo, size: size, children: aggregateChildren };
            root.children.push(aggregate);
            cursor = aggregate;
        }
        if (this.projectionMap) {
            this.applyAliases(this.projectionMap);
            root.children.unshift({ type: "declaration", var: "results", value: "[]" });
            if (exports.INCREMENTAL) {
                cursor.children.push({ type: "provenance" });
            }
            cursor.children.push({ type: "projection", projectionMap: this.projectionMap, unprojected: this.aggregates.length });
            returns.push("results");
        }
        root.children.push({ type: "return", vars: returns });
        return root;
    };
    Query.prototype.compileParamString = function (funcInfo, args, unprojected) {
        if (unprojected === void 0) { unprojected = false; }
        var code = "";
        var params = funcInfo.params;
        if (unprojected)
            params = params.slice(1);
        for (var _i = 0; _i < params.length; _i++) {
            var param = params[_i];
            var arg = args[param];
            var argCode = void 0;
            if (arg.constructor === Array) {
                var property = "";
                if (arg[1]) {
                    property = "['" + arg[1] + "']";
                }
                if (!unprojected) {
                    argCode = "row" + arg[0] + property;
                }
                else {
                    argCode = "unprojected[ix + " + arg[0] + "]" + property;
                }
            }
            else {
                argCode = JSON.stringify(arg);
            }
            code += argCode + ", ";
        }
        return code.substring(0, code.length - 2);
    };
    Query.prototype.compileAST = function (root) {
        var code = "";
        var type = root.type;
        switch (type) {
            case "query":
                for (var _i = 0, _a = root.children; _i < _a.length; _i++) {
                    var child = _a[_i];
                    code += this.compileAST(child);
                }
                break;
            case "declaration":
                code += "var " + root.var + " = " + root.value + ";\n";
                break;
            case "functionDeclaration":
                code += "var func" + root.ix + " = QueryFunctions['" + root.info.name + "'].func;\n";
                break;
            case "functionCall":
                var ix = root.ix;
                var prev = "";
                if (root.unprojected) {
                    prev = "row" + ix;
                    if (root.info.params.length > 1)
                        prev += ",";
                }
                code += "var row" + ix + " = func" + ix + "(" + prev + this.compileParamString(root.info, root.args, root.unprojected) + ");\n";
                break;
            case "functionCallMultiReturn":
                var ix = root.ix;
                code += "var rows" + ix + " = func" + ix + "(" + this.compileParamString(root.info, root.args) + ");\n";
                code += "for(var funcResultIx" + ix + " = 0, funcLen" + ix + " = rows" + ix + ".length; funcResultIx" + ix + " < funcLen" + ix + "; funcResultIx" + ix + "++) {\n";
                code += "var row" + ix + " = rows" + ix + "[funcResultIx" + ix + "];\n";
                for (var _b = 0, _c = root.children; _b < _c.length; _b++) {
                    var child = _c[_b];
                    code += this.compileAST(child);
                }
                code += "}\n";
                break;
            case "select":
                var ix = root.ix;
                if (root.passed) {
                    code += "var rows" + ix + " = rootRows;\n";
                }
                else if (root.join) {
                    for (var key in root.join) {
                        var mapping = root.join[key];
                        if (mapping.constructor === Array) {
                            var tableIx = mapping[0], value = mapping[1];
                            code += "query" + ix + "['" + key + "'] = row" + tableIx + "['" + value + "'];\n";
                        }
                        else {
                            code += "query" + ix + "['" + key + "'] = " + JSON.stringify(mapping) + ";\n";
                        }
                    }
                    code += "var rows" + ix + " = ixer.factToIndex(ixer.table('" + root.table + "'), query" + ix + ");\n";
                }
                else {
                    code += "var rows" + ix + " = ixer.table('" + root.table + "').table;\n";
                }
                if (!root.negated) {
                    code += "for(var rowIx" + ix + " = 0, rowsLen" + ix + " = rows" + ix + ".length; rowIx" + ix + " < rowsLen" + ix + "; rowIx" + ix + "++) {\n";
                    code += "var row" + ix + " = rows" + ix + "[rowIx" + ix + "];\n";
                }
                else {
                    code += "if(!rows" + ix + ".length) {\n";
                }
                for (var _d = 0, _e = root.children; _d < _e.length; _d++) {
                    var child = _e[_d];
                    code += this.compileAST(child);
                }
                code += "}\n";
                break;
            case "result":
                var results = [];
                for (var _f = 0, _g = root.results; _f < _g.length; _f++) {
                    var result = _g[_f];
                    if (result.type === "placeholder") {
                        results.push("undefined");
                    }
                    else {
                        var ix_1 = result.ix;
                        results.push("row" + ix_1);
                    }
                }
                code += "unprojected.push(" + results.join(", ") + ");\n";
                break;
            case "sort":
                code += generateUnprojectedSorterCode(root.size, root.sorts) + "\n";
                break;
            case "aggregate loop":
                var projection = "";
                var aggregateCalls = [];
                var aggregateStates = [];
                var aggregateResets = [];
                var unprojected = {};
                var ordinal = false;
                var provenanceCode;
                for (var _h = 0, _j = root.children; _h < _j.length; _h++) {
                    var agg = _j[_h];
                    if (agg.type === "functionCall") {
                        unprojected[agg.ix] = true;
                        var compiled = this.compileAST(agg);
                        compiled += "\nunprojected[ix + " + agg.resultsIx + "] = row" + agg.ix + ";\n";
                        aggregateCalls.push(compiled);
                        aggregateStates.push("var row" + agg.ix + " = {};");
                        aggregateResets.push("row" + agg.ix + " = {};");
                    }
                    else if (agg.type === "projection") {
                        agg.unprojected = unprojected;
                        projection = this.compileAST(agg);
                    }
                    else if (agg.type === "ordinal") {
                        ordinal = "unprojected[ix+" + (this.unprojectedSize - 1) + "] = resultCount;\n";
                    }
                    else if (agg.type === "provenance") {
                        provenanceCode = this.compileAST(agg);
                    }
                }
                var aggregateCallsCode = aggregateCalls.join("");
                var differentGroupChecks = [];
                var groupCheck = "false";
                if (root.groups) {
                    for (var _k = 0, _l = root.groups; _k < _l.length; _k++) {
                        var group = _l[_k];
                        var table = group[0], field = group[1];
                        differentGroupChecks.push("unprojected[nextIx + " + table + "]['" + field + "'] !== unprojected[ix + " + table + "]['" + field + "']");
                    }
                    groupCheck = "(" + differentGroupChecks.join(" || ") + ")";
                }
                var resultsCheck = "";
                if (root.limit && root.limit.results) {
                    var limitValue = root.limit.results;
                    var offset = root.limit.offset;
                    if (offset) {
                        limitValue += offset;
                        projection = "if(resultCount >= " + offset + ") {\n              " + projection + "\n            }";
                    }
                    resultsCheck = "if(resultCount === " + limitValue + ") break;";
                }
                var groupLimitCheck = "";
                if (root.limit && root.limit.perGroup && root.groups) {
                    var limitValue = root.limit.perGroup;
                    var offset = root.limit.offset;
                    if (offset) {
                        limitValue += offset;
                        aggregateCallsCode = "if(perGroupCount >= " + offset + ") {\n              " + aggregateCallsCode + "\n            }";
                    }
                    groupLimitCheck = "if(perGroupCount === " + limitValue + ") {\n            while(!differentGroup) {\n              nextIx += " + root.size + ";\n              if(nextIx >= len) break;\n              groupInfo[nextIx] = undefined;\n              differentGroup = " + groupCheck + ";\n            }\n          }";
                }
                var groupDifference = "";
                var groupInfo = "";
                if (this.groups) {
                    groupInfo = "groupInfo[ix] = resultCount;";
                    var groupProjection = projection + "resultCount++;";
                    if (root.limit && root.limit.offset) {
                        groupProjection = "if(perGroupCount > " + root.limit.offset + ") {\n              " + groupProjection + "\n            }";
                        groupInfo = "if(perGroupCount >= " + root.limit.offset + ") {\n              " + groupInfo + "\n            }";
                    }
                    groupDifference = "\n          perGroupCount++\n          var differentGroup = " + groupCheck + ";\n          " + groupLimitCheck + "\n          if(differentGroup) {\n            " + groupProjection + "\n            " + aggregateResets.join("\n") + "\n            perGroupCount = 0;\n          }\n";
                }
                else {
                    groupDifference = "resultCount++;\n";
                    groupInfo = "groupInfo[ix] = 0;";
                }
                // if there are neither aggregates to calculate nor groups to build,
                // then we just need to worry about limiting
                if (!this.groups && aggregateCalls.length === 0) {
                    code = "var ix = 0;\n                  var resultCount = 0;\n                  var len = unprojected.length;\n                  while(ix < len) {\n                    " + resultsCheck + "\n                    " + (ordinal || "") + "\n                    " + provenanceCode + "\n                    " + projection + "\n                    groupInfo[ix] = resultCount;\n                    resultCount++;\n                    ix += " + root.size + ";\n                  }\n";
                    break;
                }
                code = "var resultCount = 0;\n                var perGroupCount = 0;\n                var ix = 0;\n                var nextIx = 0;\n                var len = unprojected.length;\n                " + aggregateStates.join("\n") + "\n                while(ix < len) {\n                  " + aggregateCallsCode + "\n                  " + groupInfo + "\n                  " + (ordinal || "") + "\n                  " + provenanceCode + "\n                  if(ix + " + root.size + " === len) {\n                    " + projection + "\n                    break;\n                  }\n                  nextIx += " + root.size + ";\n                  " + groupDifference + "\n                  " + resultsCheck + "\n                  ix = nextIx;\n                }\n";
                break;
            case "projection":
                var projectedVars = [];
                var idStringParts = [];
                for (var newField in root.projectionMap) {
                    var mapping = root.projectionMap[newField];
                    var value = "";
                    if (mapping.constructor === Array) {
                        if (mapping[1] === undefined) {
                            value = "unprojected[ix + " + mapping[0] + "]";
                        }
                        else if (!root.unprojected || root.unprojected[mapping[0]]) {
                            value = "row" + mapping[0] + "['" + mapping[1] + "']";
                        }
                        else {
                            value = "unprojected[ix + " + mapping[0] + "]['" + mapping[1] + "']";
                        }
                    }
                    else {
                        value = JSON.stringify(mapping);
                    }
                    projectedVars.push("projected['" + newField.replace(/'/g, "\\'") + "'] = " + value);
                    idStringParts.push(value);
                }
                code += projectedVars.join(";\n") + "\n";
                code += "projected.__id = " + idStringParts.join(" + \"|\" + ") + ";\n";
                code += "results.push(projected);\n";
                code += "projected = {};\n";
                break;
            case "provenance":
                var provenance = "var provenance__id = '';\n";
                var ids = [];
                for (var _m = 0, _o = this.joins; _m < _o.length; _m++) {
                    var join = _o[_m];
                    if (join.negated)
                        continue;
                    provenance += "provenance__id = tableId + '|' + projected.__id + '|' + rowInstance + '|" + join.table + "|' + row" + join.ix + ".__id; \n";
                    provenance += "provenance.push({table: tableId, row: projected, \"row instance\": rowInstance, source: \"" + join.table + "\", \"source row\": row" + join.ix + "});\n";
                    ids.push("row" + join.ix + ".__id");
                }
                code = "var rowInstance = " + ids.join(" + '|' + ") + ";\n        " + provenance;
                break;
            case "return":
                var returns = [];
                for (var _p = 0, _q = root.vars; _p < _q.length; _p++) {
                    var curVar = _q[_p];
                    returns.push(curVar + ": " + curVar);
                }
                code += "return {" + returns.join(", ") + "};";
                break;
        }
        return code;
    };
    // given a set of changes and a join order, determine the root facts that need
    // to be joined again to cover all the adds
    Query.prototype.reverseJoin = function (joins) {
        var changed = joins[0];
        var reverseJoinMap = {};
        // collect all the constraints and reverse them
        for (var _i = 0; _i < joins.length; _i++) {
            var join = joins[_i];
            for (var key in join.join) {
                var _a = join.join[key], source = _a[0], field = _a[1];
                if (source <= changed.ix) {
                    if (!reverseJoinMap[source]) {
                        reverseJoinMap[source] = {};
                    }
                    if (!reverseJoinMap[source][field])
                        reverseJoinMap[source][field] = [join.ix, key];
                }
            }
        }
        var recurse = function (joins, joinIx) {
            var code = "";
            if (joinIx >= joins.length) {
                return "others.push(row0)";
            }
            var _a = joins[joinIx], table = _a.table, ix = _a.ix, negated = _a.negated;
            var joinMap = joins[joinIx].join;
            // we only care about this guy if he's joined with at least one thing
            if (!reverseJoinMap[ix] && joinIx < joins.length - 1)
                return recurse(joins, joinIx + 1);
            else if (!reverseJoinMap)
                return "";
            var mappings = [];
            for (var key in reverseJoinMap[ix]) {
                var _b = reverseJoinMap[ix][key], sourceIx = _b[0], field = _b[1];
                if (sourceIx === changed.ix || reverseJoinMap[sourceIx] !== undefined) {
                    mappings.push("'" + key + "': row" + sourceIx + "['" + field + "']");
                }
            }
            for (var key in joinMap) {
                var value = joinMap[key];
                if (value.constructor !== Array) {
                    mappings.push("'" + key + "': " + JSON.stringify(value));
                }
            }
            if (negated) {
            }
            code += "\n            var rows" + ix + " = eve.find('" + table + "', {" + mappings.join(", ") + "});\n            for(var rowsIx" + ix + " = 0, rowsLen" + ix + " = rows" + ix + ".length; rowsIx" + ix + " < rowsLen" + ix + "; rowsIx" + ix + "++) {\n                var row" + ix + " = rows" + ix + "[rowsIx" + ix + "];\n                " + recurse(joins, joinIx + 1) + "\n            }\n            ";
            return code;
        };
        return recurse(joins, 1);
    };
    Query.prototype.compileIncrementalRowFinderCode = function () {
        var code = "var others = [];\n";
        var reversed = this.joins.slice().reverse();
        var checks = [];
        var ix = 0;
        for (var _i = 0; _i < reversed.length; _i++) {
            var join = reversed[_i];
            // we don't want to do this for the root
            if (ix === reversed.length - 1)
                break;
            checks.push("\n\t\t\tif(changes[\"" + join.table + "\"] && changes[\"" + join.table + "\"].adds) {\n                var curChanges" + join.ix + " = changes[\"" + join.table + "\"].adds;\n                for(var changeIx" + join.ix + " = 0, changeLen" + join.ix + " = curChanges" + join.ix + ".length; changeIx" + join.ix + " < changeLen" + join.ix + "; changeIx" + join.ix + "++) {\n                    var row" + join.ix + " = curChanges" + join.ix + "[changeIx" + join.ix + "];\n\t\t\t\t\t" + this.reverseJoin(reversed.slice(ix)) + "\n\t\t\t\t}\n\t\t\t}");
            ix++;
        }
        code += checks.join(" else");
        var last = reversed[ix];
        code += "\n\t\t\tif(changes[\"" + last.table + "\"] && changes[\"" + last.table + "\"].adds) {\n                var curChanges = changes[\"" + last.table + "\"].adds;\n\t\t\t\tfor(var changeIx = 0, changeLen = curChanges.length; changeIx < changeLen; changeIx++) {\n\t\t\t\t\tothers.push(curChanges[changeIx]);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn others;";
        return code;
    };
    Query.prototype.incrementalRemove = function (changes) {
        var ixer = this.ixer;
        var rowsToPostCheck = [];
        var provenanceDiff = this.ixer.diff();
        var removes = [];
        var indexes = ixer.table("provenance").indexes;
        var sourceRowLookup = indexes["source|source row|table"].index;
        var rowInstanceLookup = indexes["row instance|table"].index;
        var tableRowLookup = indexes["row|table"].index;
        var provenanceRemoves = [];
        var visited = {};
        for (var _i = 0, _a = this.joins; _i < _a.length; _i++) {
            var join = _a[_i];
            var change = changes[join.table];
            if (!visited[join.table] && change && change.removes.length) {
                visited[join.table] = true;
                for (var _b = 0, _c = change.removes; _b < _c.length; _b++) {
                    var remove = _c[_b];
                    var provenances = sourceRowLookup[join.table + '|' + remove.__id + '|' + this.name];
                    if (provenances) {
                        for (var _d = 0; _d < provenances.length; _d++) {
                            var provenance = provenances[_d];
                            if (!visited[provenance["row instance"]]) {
                                visited[provenance["row instance"]] = true;
                                var relatedProvenance = rowInstanceLookup[provenance["row instance"] + '|' + provenance.table];
                                for (var _e = 0; _e < relatedProvenance.length; _e++) {
                                    var related = relatedProvenance[_e];
                                    provenanceRemoves.push(related);
                                }
                            }
                            rowsToPostCheck.push(provenance);
                        }
                    }
                }
            }
        }
        provenanceDiff.removeFacts("provenance", provenanceRemoves);
        ixer.applyDiffIncremental(provenanceDiff);
        var isEdb = ixer.edbTables;
        for (var _f = 0; _f < rowsToPostCheck.length; _f++) {
            var row = rowsToPostCheck[_f];
            var supports = tableRowLookup[row.row.__id + '|' + row.table];
            if (!supports || supports.length === 0) {
                removes.push(row.row);
            }
        }
        return removes;
    };
    Query.prototype.canBeIncremental = function () {
        if (this.aggregates.length)
            return false;
        if (this.sorts)
            return false;
        if (this.groups)
            return false;
        if (this.limitInfo)
            return false;
        for (var _i = 0, _a = this.joins; _i < _a.length; _i++) {
            var join = _a[_i];
            if (join.negated)
                return false;
        }
        if (!this.joins.length)
            return false;
        return true;
    };
    Query.prototype.compile = function () {
        var ast = this.toAST();
        var code = this.compileAST(ast);
        this.compiled = new Function("ixer", "QueryFunctions", "tableId", "rootRows", code);
        if (this.canBeIncremental()) {
            this.incrementalRowFinder = new Function("changes", this.compileIncrementalRowFinderCode());
        }
        else {
            this.incrementalRowFinder = undefined;
        }
        this.dirty = false;
        return this;
    };
    Query.prototype.exec = function () {
        if (this.dirty) {
            this.compile();
        }
        var root = this.joins[0];
        var rows;
        if (root) {
            rows = this.ixer.find(root.table, root.join);
        }
        else {
            rows = [];
        }
        return this.compiled(this.ixer, exports.QueryFunctions, this.name, rows);
    };
    Query.prototype.execIncremental = function (changes, table) {
        if (this.dirty) {
            this.compile();
        }
        if (this.incrementalRowFinder) {
            var potentialRows = this.incrementalRowFinder(changes);
            // if the root select has some constant filters, then
            // the above rows need to be filtered down to only those that
            // match.
            var rows = [];
            var root = this.joins[0];
            var rootKeys = Object.keys(root.join);
            if (rootKeys.length > 0) {
                rowLoop: for (var _i = 0; _i < potentialRows.length; _i++) {
                    var row = potentialRows[_i];
                    for (var _a = 0; _a < rootKeys.length; _a++) {
                        var key = rootKeys[_a];
                        if (row[key] !== root.join[key])
                            continue rowLoop;
                    }
                    rows.push(row);
                }
            }
            else {
                rows = potentialRows;
            }
            var results = this.compiled(this.ixer, exports.QueryFunctions, this.name, rows);
            var adds = [];
            var prevHashes = table.factHash;
            var prevKeys = Object.keys(prevHashes);
            var suggestedRemoves = this.incrementalRemove(changes);
            var realDiff = diffAddsAndRemoves(results.results, suggestedRemoves);
            for (var _b = 0, _c = realDiff.adds; _b < _c.length; _b++) {
                var result = _c[_b];
                var id = result.__id;
                if (prevHashes[id] === undefined) {
                    adds.push(result);
                }
            }
            var diff = this.ixer.diff();
            diff.addMany("provenance", results.provenance);
            this.ixer.applyDiffIncremental(diff);
            // console.log("INC PROV DIFF", this.name, diff.length);
            return { provenance: results.provenance, adds: adds, removes: realDiff.removes };
        }
        else {
            var results = this.exec();
            var adds = [];
            var removes = [];
            var prevHashes = table.factHash;
            var prevKeys = Object.keys(prevHashes);
            var newHashes = {};
            for (var _d = 0, _e = results.results; _d < _e.length; _d++) {
                var result = _e[_d];
                var id = result.__id;
                newHashes[id] = result;
                if (prevHashes[id] === undefined) {
                    adds.push(result);
                }
            }
            for (var _f = 0; _f < prevKeys.length; _f++) {
                var hash = prevKeys[_f];
                var value = newHashes[hash];
                if (value === undefined) {
                    removes.push(prevHashes[hash]);
                }
            }
            var realDiff = diffAddsAndRemoves(adds, removes);
            var diff = this.ixer.diff();
            diff.remove("provenance", { table: this.name });
            diff.addMany("provenance", results.provenance);
            this.ixer.applyDiffIncremental(diff);
            // console.log("FULL PROV SIZE", this.name, diff.length);
            return { provenance: results.provenance, adds: realDiff.adds, removes: realDiff.removes };
        }
    };
    Query.prototype.debug = function () {
        console.log(this.compileAST(this.toAST()));
        console.time("exec");
        var results = this.exec();
        console.timeEnd("exec");
        console.log(results);
        return results;
    };
    return Query;
})();
exports.Query = Query;
var Union = (function () {
    function Union(ixer, name) {
        if (name === void 0) { name = "unknown"; }
        this.name = name;
        this.ixer = ixer;
        this.tables = [];
        this.sources = [];
        this.isStateful = false;
        this.prev = { results: [], hashes: {} };
        this.dirty = true;
    }
    Union.prototype.changeset = function (ixer) {
        var diff = ixer.diff();
        diff.add("view", { view: this.name, kind: "union" });
        for (var _i = 0, _a = this.sources; _i < _a.length; _i++) {
            var source = _a[_i];
            if (source.type === "+") {
                var action = utils_1.uuid();
                diff.add("action", { view: this.name, action: action, kind: "union", ix: 0 });
                diff.add("action source", { action: action, "source view": source.table });
                for (var field in source.mapping) {
                    var mapped = source.mapping[field];
                    if (mapped.constructor === Array)
                        diff.add("action mapping", { action: action, from: field, "to source": source.table, "to field": mapped[0] });
                    else
                        diff.add("action mapping constant", { action: action, from: field, value: mapped });
                }
            }
            else
                throw new Error("Unknown source type: '" + source.type + "'");
        }
        return diff;
    };
    Union.prototype.ensureHasher = function (mapping) {
        if (!this.hasher) {
            this.hasher = generateStringFn(Object.keys(mapping));
        }
    };
    Union.prototype.union = function (tableName, mapping) {
        this.dirty = true;
        this.ensureHasher(mapping);
        this.tables.push(tableName);
        this.sources.push({ type: "+", table: tableName, mapping: mapping });
        return this;
    };
    Union.prototype.toAST = function () {
        var root = { type: "union", children: [] };
        root.children.push({ type: "declaration", var: "results", value: "[]" });
        root.children.push({ type: "declaration", var: "provenance", value: "[]" });
        var hashesValue = "{}";
        if (this.isStateful) {
            hashesValue = "prevHashes";
        }
        root.children.push({ type: "declaration", var: "hashes", value: hashesValue });
        var ix = 0;
        for (var _i = 0, _a = this.sources; _i < _a.length; _i++) {
            var source = _a[_i];
            var action = void 0;
            if (source.type === "+") {
                action = { type: "result", ix: ix, children: [{ type: "provenance", source: source, ix: ix }] };
            }
            root.children.push({
                type: "source",
                ix: ix,
                table: source.table,
                mapping: source.mapping,
                children: [action],
            });
            ix++;
        }
        root.children.push({ type: "hashesToResults" });
        root.children.push({ type: "return", vars: ["results", "hashes", "provenance"] });
        return root;
    };
    Union.prototype.compileAST = function (root) {
        var code = "";
        var type = root.type;
        switch (type) {
            case "union":
                for (var _i = 0, _a = root.children; _i < _a.length; _i++) {
                    var child = _a[_i];
                    code += this.compileAST(child);
                }
                break;
            case "declaration":
                code += "var " + root.var + " = " + root.value + ";\n";
                break;
            case "source":
                var ix = root.ix;
                var mappingItems = [];
                for (var key in root.mapping) {
                    var mapping = root.mapping[key];
                    var value = void 0;
                    if (mapping.constructor === Array && mapping.length === 1) {
                        var field = mapping[0];
                        value = "sourceRow" + ix + "['" + field + "']";
                    }
                    else if (mapping.constructor === Array && mapping.length === 2) {
                        var _ = mapping[0], field = mapping[1];
                        value = "sourceRow" + ix + "['" + field + "']";
                    }
                    else {
                        value = JSON.stringify(mapping);
                    }
                    mappingItems.push("'" + key + "': " + value);
                }
                code += "var sourceRows" + ix + " = changes['" + root.table.replace(/'/g, "\\'") + "'];\n";
                code += "for(var rowIx" + ix + " = 0, rowsLen" + ix + " = sourceRows" + ix + ".length; rowIx" + ix + " < rowsLen" + ix + "; rowIx" + ix + "++) {\n";
                code += "var sourceRow" + ix + " = sourceRows" + ix + "[rowIx" + ix + "];\n";
                code += "var mappedRow" + ix + " = {" + mappingItems.join(", ") + "};\n";
                for (var _b = 0, _c = root.children; _b < _c.length; _b++) {
                    var child = _c[_b];
                    code += this.compileAST(child);
                }
                code += "}\n";
                break;
            case "result":
                var ix = root.ix;
                code += "var hash" + ix + " = hasher(mappedRow" + ix + ");\n";
                code += "mappedRow" + ix + ".__id = hash" + ix + ";\n";
                code += "hashes[hash" + ix + "] = mappedRow" + ix + ";\n";
                for (var _d = 0, _e = root.children; _d < _e.length; _d++) {
                    var child = _e[_d];
                    code += this.compileAST(child);
                }
                break;
            case "removeResult":
                var ix = root.ix;
                code += "hashes[hasher(mappedRow" + ix + ")] = false;\n";
                break;
            case "hashesToResults":
                code += "var hashKeys = Object.keys(hashes);\n";
                code += "for(var hashKeyIx = 0, hashKeyLen = hashKeys.length; hashKeyIx < hashKeyLen; hashKeyIx++) {\n";
                code += "var curHashKey = hashKeys[hashKeyIx];";
                code += "var value = hashes[curHashKey];\n";
                code += "if(value !== false) {\n";
                code += "value.__id = curHashKey;\n";
                code += "results.push(value);\n";
                code += "}\n";
                code += "}\n";
                break;
            case "provenance":
                var source = root.source.table;
                var ix = root.ix;
                var provenance = "var provenance__id = '';\n";
                provenance += "provenance__id = '" + this.name.replace(/'/g, "\\'") + "|' + mappedRow" + ix + ".__id + '|' + rowInstance + '|" + source.replace(/'/g, "\\'") + "|' + sourceRow" + ix + ".__id; \n";
                provenance += "provenance.push({table: '" + this.name.replace(/'/g, "\\'") + "', row: mappedRow" + ix + ", \"row instance\": rowInstance, source: \"" + source.replace(/'/g, "\\'") + "\", \"source row\": sourceRow" + ix + "});\n";
                code = "var rowInstance = \"" + source.replace(/'/g, "\\'") + "|\" + mappedRow" + ix + ".__id;\n        " + provenance;
                break;
            case "return":
                code += "return {" + root.vars.map(function (name) { return (name + ": " + name); }).join(", ") + "};";
                break;
        }
        return code;
    };
    Union.prototype.compile = function () {
        var ast = this.toAST();
        var code = this.compileAST(ast);
        this.compiled = new Function("ixer", "hasher", "changes", code);
        this.dirty = false;
        return this;
    };
    Union.prototype.debug = function () {
        var code = this.compileAST(this.toAST());
        console.log(code);
        return code;
    };
    Union.prototype.exec = function () {
        if (this.dirty) {
            this.compile();
        }
        var changes = {};
        for (var _i = 0, _a = this.sources; _i < _a.length; _i++) {
            var source = _a[_i];
            changes[source.table] = this.ixer.table(source.table).table;
        }
        var results = this.compiled(this.ixer, this.hasher, changes);
        return results;
    };
    Union.prototype.incrementalRemove = function (changes) {
        var ixer = this.ixer;
        var rowsToPostCheck = [];
        var provenanceDiff = this.ixer.diff();
        var removes = [];
        var indexes = ixer.table("provenance").indexes;
        var sourceRowLookup = indexes["source|source row|table"].index;
        var rowInstanceLookup = indexes["row instance|table"].index;
        var tableRowLookup = indexes["row|table"].index;
        var provenanceRemoves = [];
        var visited = {};
        for (var _i = 0, _a = this.sources; _i < _a.length; _i++) {
            var source = _a[_i];
            var change = changes[source.table];
            if (!visited[source.table] && change && change.removes.length) {
                visited[source.table] = true;
                for (var _b = 0, _c = change.removes; _b < _c.length; _b++) {
                    var remove = _c[_b];
                    var provenances = sourceRowLookup[source.table + '|' + remove.__id + '|' + this.name];
                    if (provenances) {
                        for (var _d = 0; _d < provenances.length; _d++) {
                            var provenance = provenances[_d];
                            if (!visited[provenance["row instance"]]) {
                                visited[provenance["row instance"]] = true;
                                var relatedProvenance = rowInstanceLookup[provenance["row instance"] + '|' + provenance.table];
                                for (var _e = 0; _e < relatedProvenance.length; _e++) {
                                    var related = relatedProvenance[_e];
                                    provenanceRemoves.push(related);
                                }
                            }
                            rowsToPostCheck.push(provenance);
                        }
                    }
                }
            }
        }
        provenanceDiff.removeFacts("provenance", provenanceRemoves);
        ixer.applyDiffIncremental(provenanceDiff);
        var isEdb = ixer.edbTables;
        for (var _f = 0; _f < rowsToPostCheck.length; _f++) {
            var row = rowsToPostCheck[_f];
            var supports = tableRowLookup[row.row.__id + '|' + row.table];
            if (!supports || supports.length === 0) {
                removes.push(row.row);
            }
            else if (this.sources.length > 2) {
                var supportsToRemove = [];
                // otherwise if there are supports, then we need to walk the support
                // graph backwards and make sure every supporting row terminates at an
                // edb value. If not, then that support also needs to be removed
                for (var _g = 0; _g < supports.length; _g++) {
                    var support = supports[_g];
                    // if the support is already an edb, we're good to go.
                    if (isEdb[support.source])
                        continue;
                    if (!tableRowLookup[support["source row"].__id + '|' + support.source]) {
                        supportsToRemove.push(support);
                        continue;
                    }
                    // get all the supports for this support
                    var nodes = tableRowLookup[support["source row"].__id + '|' + support.source].slice();
                    var nodeIx = 0;
                    // iterate through all the nodes, if they have further supports then
                    // assume this node is ok and add those supports to the list of nodes to
                    // check. If we run into a node with no supports it must either be an edb
                    // or it's unsupported and this row instance needs to be removed.
                    while (nodeIx < nodes.length) {
                        var node = nodes[nodeIx];
                        if (isEdb[node.source]) {
                            nodeIx++;
                            continue;
                        }
                        var nodeSupports = tableRowLookup[node["source row"].__id + '|' + node.source];
                        if (!nodeSupports || nodeSupports.length === 0) {
                            supportsToRemove.push(support);
                            break;
                        }
                        else {
                            for (var _h = 0; _h < nodeSupports.length; _h++) {
                                var nodeSupport = nodeSupports[_h];
                                nodes.push(nodeSupport);
                            }
                            nodeIx++;
                        }
                    }
                }
                if (supportsToRemove.length) {
                    // we need to remove all the supports
                    var provenanceRemoves_1 = [];
                    for (var _j = 0; _j < supportsToRemove.length; _j++) {
                        var support = supportsToRemove[_j];
                        var relatedProvenance = rowInstanceLookup[support["row instance"] + '|' + support.table];
                        for (var _k = 0; _k < relatedProvenance.length; _k++) {
                            var related = relatedProvenance[_k];
                            provenanceRemoves_1.push(related);
                        }
                    }
                    var diff = ixer.diff();
                    diff.removeFacts("provenance", provenanceRemoves_1);
                    ixer.applyDiffIncremental(diff);
                    // now that all the unsupported provenances have been removed, check if there's anything
                    // left.
                    if (!tableRowLookup[row.row.__id + '|' + row.table] || tableRowLookup[row.row.__id + '|' + row.table].length === 0) {
                        removes.push(row.row);
                    }
                }
            }
        }
        return removes;
    };
    Union.prototype.execIncremental = function (changes, table) {
        if (this.dirty) {
            this.compile();
        }
        var sourceChanges = {};
        for (var _i = 0, _a = this.sources; _i < _a.length; _i++) {
            var source = _a[_i];
            var value = void 0;
            if (!changes[source.table]) {
                value = [];
            }
            else {
                value = changes[source.table].adds;
            }
            sourceChanges[source.table] = value;
        }
        var results = this.compiled(this.ixer, this.hasher, sourceChanges);
        var adds = [];
        var prevHashes = table.factHash;
        var prevKeys = Object.keys(prevHashes);
        var suggestedRemoves = this.incrementalRemove(changes);
        var realDiff = diffAddsAndRemoves(results.results, suggestedRemoves);
        for (var _b = 0, _c = realDiff.adds; _b < _c.length; _b++) {
            var result = _c[_b];
            var id = result.__id;
            if (prevHashes[id] === undefined) {
                adds.push(result);
            }
        }
        var diff = this.ixer.diff();
        diff.addMany("provenance", results.provenance);
        this.ixer.applyDiffIncremental(diff);
        return { provenance: results.provenance, adds: adds, removes: realDiff.removes };
    };
    return Union;
})();
exports.Union = Union;
//---------------------------------------------------------
// Builtin Primitives
//---------------------------------------------------------
runtime.define("count", { aggregate: true, result: "count" }, function (prev) {
    if (!prev.count) {
        prev.count = 0;
    }
    prev.count++;
    return prev;
});
runtime.define("sum", { aggregate: true, result: "sum" }, function (prev, value) {
    if (!prev.sum) {
        prev.sum = 0;
    }
    prev.sum += value;
    return prev;
});
runtime.define("average", { aggregate: true, result: "average" }, function (prev, value) {
    if (!prev.sum) {
        prev.sum = 0;
        prev.count = 0;
    }
    prev.count++;
    prev.sum += value;
    prev.average = prev.sum / prev.count;
    return prev;
});
runtime.define("lowercase", { result: "result" }, function (text) {
    if (typeof text === "string") {
        return { result: text.toLowerCase() };
    }
    return { result: text };
});
runtime.define("=", { filter: true, inverse: "!=" }, function (a, b) {
    return a === b ? runtime.SUCCEED : runtime.FAIL;
});
runtime.define("!=", { filter: true, inverse: "=" }, function (a, b) {
    return a !== b ? runtime.SUCCEED : runtime.FAIL;
});
runtime.define(">", { filter: true, inverse: "<=" }, function (a, b) {
    return a > b ? runtime.SUCCEED : runtime.FAIL;
});
runtime.define("<", { filter: true, inverse: ">=" }, function (a, b) {
    return a < b ? runtime.SUCCEED : runtime.FAIL;
});
runtime.define(">=", { filter: true, inverse: "<" }, function (a, b) {
    return a >= b ? runtime.SUCCEED : runtime.FAIL;
});
runtime.define("<=", { filter: true, inverse: ">" }, function (a, b) {
    return a <= b ? runtime.SUCCEED : runtime.FAIL;
});
runtime.define("+", { result: "result" }, function (a, b) {
    return { result: a + b };
});
runtime.define("-", { result: "result" }, function (a, b) {
    return { result: a - b };
});
runtime.define("*", { result: "result" }, function (a, b) {
    return { result: a * b };
});
runtime.define("/", { result: "result" }, function (a, b) {
    return { result: a / b };
});
runtime.define("^", { result: "result" }, function (a, b) {
    return { result: Math.pow(a, b) };
});
//---------------------------------------------------------
// AST and compiler
//---------------------------------------------------------
// view: view, kind[union|query|table]
// action: view, action, kind[select|calculate|project|union|ununion|stateful|limit|sort|group|aggregate], ix
// action source: action, source view
// action mapping: action, from, to source, to field
// action mapping constant: action, from, value
function addRecompileTriggers(eve) {
    var recompileTrigger = {
        exec: function (ixer) {
            for (var _i = 0, _a = ixer.find("view"); _i < _a.length; _i++) {
                var view = _a[_i];
                if (view.kind === "table")
                    continue;
                try {
                    var query = compile(ixer, view.view);
                    ixer.asView(query);
                }
                catch (e) {
                    console.error("BAD QUERY IN THE DB :(");
                    console.error("View Id: " + view.view);
                    console.log(e.stack);
                    ixer.applyDiff(Query.remove(view.view, ixer));
                }
            }
            return {};
        }
    };
    eve.addTable("view", ["view", "kind"]);
    eve.addTable("action", ["view", "action", "kind", "ix"]);
    eve.addTable("action source", ["action", "source view"]);
    eve.addTable("action mapping", ["action", "from", "to source", "to field"]);
    eve.addTable("action mapping constant", ["action", "from", "value"]);
    eve.addTable("action mapping sorted", ["action", "ix", "source", "field", "direction"]);
    eve.addTable("action mapping limit", ["action", "limit type", "value"]);
    eve.table("view").triggers["recompile"] = recompileTrigger;
    eve.table("action").triggers["recompile"] = recompileTrigger;
    eve.table("action source").triggers["recompile"] = recompileTrigger;
    eve.table("action mapping").triggers["recompile"] = recompileTrigger;
    eve.table("action mapping constant").triggers["recompile"] = recompileTrigger;
    eve.table("action mapping sorted").triggers["recompile"] = recompileTrigger;
    eve.table("action mapping limit").triggers["recompile"] = recompileTrigger;
    return eve;
}
function compile(ixer, viewId) {
    var view = ixer.findOne("view", { view: viewId });
    if (!view) {
        throw new Error("No view found for " + viewId + ".");
    }
    var compiled = ixer[view.kind](viewId);
    var actions = ixer.find("action", { view: viewId });
    if (!actions) {
        throw new Error("View " + viewId + " has no actions.");
    }
    // sort actions by ix
    actions.sort(function (a, b) { return a.ix - b.ix; });
    for (var _i = 0; _i < actions.length; _i++) {
        var action = actions[_i];
        var actionKind = action.kind;
        if (actionKind === "limit") {
            var limit = {};
            for (var _a = 0, _b = ixer.find("action mapping limit", { action: action.action }); _a < _b.length; _a++) {
                var limitMapping = _b[_a];
                limit[limitMapping["limit type"]] = limitMapping["value"];
            }
            compiled.limit(limit);
        }
        else if (actionKind === "sort" || actionKind === "group") {
            var sorted = [];
            var mappings = ixer.find("action mapping sorted", { action: action.action });
            mappings.sort(function (a, b) { return a.ix - b.ix; });
            for (var _c = 0; _c < mappings.length; _c++) {
                var mapping = mappings[_c];
                sorted.push([mapping["source"], mapping["field"], mapping["direction"]]);
            }
            if (sorted.length) {
                compiled[actionKind](sorted);
            }
            else {
                throw new Error(actionKind + " without any mappings: " + action.action);
            }
        }
        else {
            var mappings = ixer.find("action mapping", { action: action.action });
            var mappingObject = {};
            for (var _d = 0; _d < mappings.length; _d++) {
                var mapping = mappings[_d];
                var source_1 = mapping["to source"];
                var field = mapping["to field"];
                if (actionKind === "union" || actionKind === "ununion") {
                    mappingObject[mapping.from] = [field];
                }
                else {
                    mappingObject[mapping.from] = [source_1, field];
                }
            }
            var constants = ixer.find("action mapping constant", { action: action.action });
            for (var _e = 0; _e < constants.length; _e++) {
                var constant = constants[_e];
                mappingObject[constant.from] = constant.value;
            }
            var source = ixer.findOne("action source", { action: action.action });
            if (!source && actionKind !== "project") {
                throw new Error(actionKind + " action without a source in '" + viewId + "'");
            }
            if (actionKind !== "project") {
                compiled[actionKind](source["source view"], mappingObject, action.action);
            }
            else {
                compiled[actionKind](mappingObject);
            }
        }
    }
    return compiled;
}
exports.compile = compile;
//---------------------------------------------------------
// Public API
//---------------------------------------------------------
exports.SUCCEED = [{ success: true }];
exports.FAIL = [];
function indexer() {
    var ixer = new Indexer();
    addProvenanceTable(ixer);
    addRecompileTriggers(ixer);
    return ixer;
}
exports.indexer = indexer;
function clearAllQueries(eve) {
    var finalDiff = eve.diff();
    for (var _i = 0, _a = eve.find("query to id"); _i < _a.length; _i++) {
        var query = _a[_i];
        finalDiff.merge(Query.remove(query.id, eve));
    }
    finalDiff.remove("query to id", {});
    eve.applyDiff(finalDiff);
}
exports.clearAllQueries = clearAllQueries;
if (utils_1.ENV === "browser")
    window["runtime"] = exports;

},{"./utils":19}],16:[function(require,module,exports){
var CodeMirror = require("codemirror");
var utils_1 = require("./utils");
var runtime_1 = require("./runtime");
var richTextEditor_1 = require("./richTextEditor");
var uitk = require("./uitk");
var uitk_1 = require("./uitk");
var app_1 = require("./app");
var parser_1 = require("./parser");
var NLQueryParser_1 = require("./NLQueryParser");
(function (PANE) {
    PANE[PANE["FULL"] = 0] = "FULL";
    PANE[PANE["WINDOW"] = 1] = "WINDOW";
    PANE[PANE["POPOUT"] = 2] = "POPOUT";
})(exports.PANE || (exports.PANE = {}));
var PANE = exports.PANE;
;
var BLOCK;
(function (BLOCK) {
    BLOCK[BLOCK["TEXT"] = 0] = "TEXT";
    BLOCK[BLOCK["PROJECTION"] = 1] = "PROJECTION";
})(BLOCK || (BLOCK = {}));
;
// Because html5 is full of broken promises and broken dreams
var popoutHistory = [];
//------------------------------------------------------------------------------
// State
//------------------------------------------------------------------------------
exports.uiState = {
    widget: {
        search: {},
        table: {},
        collapsible: {},
        attributes: {},
        card: {},
    },
    pane: {},
    prompt: { open: false, paneId: undefined, prompt: undefined },
};
//---------------------------------------------------------
// Utils
//---------------------------------------------------------
// @NOTE: ids must not contain whitespace
function asEntity(raw) {
    var cleaned = raw && ("" + raw).trim();
    if (!cleaned)
        return;
    if (app_1.eve.findOne("entity", { entity: cleaned }))
        return cleaned;
    cleaned = NLQueryParser_1.normalizeString(cleaned);
    if (app_1.eve.findOne("entity", { entity: cleaned }))
        return cleaned; // This can be removed if we remove caps from ids. UUIDv4 does not use caps in ids
    var _a = (app_1.eve.findOne("index name", { name: cleaned }) || {}).id, id = _a === void 0 ? undefined : _a;
    return id;
}
exports.asEntity = asEntity;
function setURL(paneId, contains, replace) {
    var name = uitk.resolveName(contains);
    if (paneId !== "p1")
        return; // @TODO: Make this a constant
    var url;
    if (contains.length === 0)
        url = "#";
    else if (name === contains)
        url = "#/search/" + utils_1.slugify(contains);
    else
        url = "#/" + utils_1.slugify(name) + "/" + utils_1.slugify(contains);
    var state = { paneId: paneId, contains: contains };
    window["states"] = window["states"] || [];
    window["states"].push(state);
    if (replace)
        window.history.replaceState(state, null, url);
    else
        window.history.pushState(state, null, url);
    historyState = state;
    historyURL = url;
    ga('send', 'pageview', {
        'page': location.pathname + location.search + location.hash
    });
}
exports.setURL = setURL;
function inferRepresentation(search, baseParams) {
    if (baseParams === void 0) { baseParams = {}; }
    var params = utils_1.copy(baseParams);
    var entityId = asEntity(search);
    var cleaned = (search && ("" + search).trim().toLowerCase()) || "";
    if (entityId || cleaned.length === 0) {
        var rep = "entity";
        params.entity = entityId || utils_1.builtinId("home");
        if (params.entity === utils_1.builtinId("home")) {
            rep = "directory";
        }
        return { rep: rep, params: params };
    }
    var _a = cleaned.split("|"), rawContent = _a[0], rawParams = _a[1];
    var parsedParams = getCellParams(rawContent, rawParams);
    params = utils_1.mergeObject(params, parsedParams);
    if (params.rep === "table") {
        params.search = cleaned;
    }
    return { rep: params.rep, params: params };
}
function staticOrMappedTable(search, params) {
    var parsed = safeNLParse(search);
    var topParse = parsed[0];
    console.log(topParse);
    params.rep = "table";
    params.search = search;
    // @NOTE: This requires the first project to be the main result of the search
    params.fields = topParse.query.projects[0].fields.map(function (field) { return field.name; });
    params.groups = topParse.context.groupings.map(function (group) {
        // @FIXME: This needs to really come off the group itself.
        if (group.attribute)
            return group.attribute.projectedAs;
        if (group.entity)
            return group.entity.projectedAs;
        if (group.collection)
            return group.collection.projectedAs;
        if (group.fxn)
            return group.fxn.projectedAs;
        else
            return group.name;
    });
    //params.fields = uitk.getFields({example: results[0], blacklist: ["__id"]});
    if (!topParse || topParse.intent !== NLQueryParser_1.Intents.QUERY)
        return params;
    // Must not contain any primitive relations
    var editable = true;
    var subject;
    var entity;
    var fieldMap = {};
    var collections = [];
    for (var ctx in topParse.context) {
        if (ctx === "attributes" || ctx === "entities" || ctx === "collections")
            continue;
        for (var _i = 0, _a = topParse.context[ctx]; _i < _a.length; _i++) {
            var node = _a[_i];
            if (node.fxn && node.fxn.project) {
                editable = false;
                break;
            }
        }
    }
    // Number of subjects (projected entities or collections) must be 1.
    if (editable) {
        for (var _b = 0, _c = topParse.context.collections; _b < _c.length; _b++) {
            var node = _c[_b];
            var coll = node.collection;
            if (coll.project) {
                if (subject) {
                    editable = false;
                    break;
                }
                else {
                    subject = coll.projectedAs;
                }
            }
            collections.push(coll.id);
        }
    }
    if (editable) {
        for (var _d = 0, _e = topParse.context.entities; _d < _e.length; _d++) {
            var node = _e[_d];
            var ent = node.entity;
            if (ent.project) {
                if (subject) {
                    editable = false;
                    break;
                }
                else {
                    subject = ent.projectedAs;
                    entity = ent.id;
                }
            }
        }
    }
    if (editable) {
        for (var _f = 0, _g = topParse.context.attributes; _f < _g.length; _f++) {
            var node = _g[_f];
            var attr = node.attribute;
            if (attr.project) {
                fieldMap[attr.projectedAs] = attr.id;
            }
        }
        if (entity && Object.keys(fieldMap).length !== 1)
            editable = false;
    }
    if (editable) {
        params.rep = "mappedTable";
        params.subject = subject;
        params.entity = entity;
        params.fieldMap = fieldMap;
        params.collections = collections;
        console.log("MAPPED PARAMS", params);
        return params;
    }
    return params;
}
function safeNLParse(query) {
    try {
        return NLQueryParser_1.parse(query);
    }
    catch (e) {
        console.error("NLParse error");
        console.error(e);
        return [{ intent: NLQueryParser_1.Intents.NORESULT, context: {}, query: {}, projects: {} }];
    }
}
//---------------------------------------------------------
// Dispatches
//---------------------------------------------------------
app_1.handle("ui update search", function (changes, _a) {
    var paneId = _a.paneId, value = _a.value;
    var state = exports.uiState.widget.search[paneId] = exports.uiState.widget.search[paneId] || { value: value };
    state.value = value;
});
app_1.handle("ui focus search", function (changes, _a) {
    var paneId = _a.paneId, value = _a.value;
    var state = exports.uiState.widget.search[paneId] = exports.uiState.widget.search[paneId] || { value: value };
    state.focused = true;
});
// @TODO: abstract (search) => {rep, params} fn and use it to infer {rep, params} for set pane and set popout.
// @TODO: Update pane(paneId) to take the actual pane fact so it's not tied to the DB.
// @TODO: Update pane(pane) to just directly call represent with the pane's facts.
app_1.handle("set pane", function (changes, info) {
    // Infer valid rep and params if search has changed
    if (info.contains !== undefined && !info.rep) {
        var inferred = inferRepresentation(info.contains, typeof info.params === "string" ? parseParams(info.params) : info.params);
        info.rep = inferred.rep;
        info.params = inferred.params;
        if (!info.rep)
            throw new Error("Could not infer a valid representation for search '" + info.contains + "' in pane '" + info.paneId + "'");
    }
    // Fill missing properties from the previous fact, if present
    var prev = app_1.eve.findOne("ui pane", { pane: info.paneId }) || {};
    var paneId = info.paneId, _a = info.kind, kind = _a === void 0 ? prev.kind : _a, _b = info.rep, rep = _b === void 0 ? prev.rep : _b, _c = info.contains, raw = _c === void 0 ? prev.contains : _c, _d = info.params, rawParams = _d === void 0 ? prev.params : _d, _e = info.popState, popState = _e === void 0 ? false : _e;
    if (kind === undefined || rep == undefined || raw === undefined || rawParams === undefined) {
        throw new Error("Cannot create new pane without all parameters specified for pane '" + paneId + "'");
    }
    var contains = asEntity(raw) || ("" + raw).trim();
    var params = typeof rawParams === "object" ? stringifyParams(rawParams) : rawParams || "";
    var state = exports.uiState.widget.search[paneId] = exports.uiState.widget.search[paneId] || { value: contains, focused: false };
    state.value = contains;
    state.focused = false;
    app_1.dispatch("remove pane", { paneId: paneId }, changes);
    changes.add("ui pane", { pane: paneId, kind: kind, rep: rep, contains: contains, params: params });
    // @TODO: Make "p1" a constant
    if (paneId === "p1") {
        popoutHistory = [];
        if (!popState)
            setURL(paneId, contains);
    }
});
app_1.handle("remove pane", function (changes, _a) {
    var paneId = _a.paneId;
    var children = app_1.eve.find("ui pane parent", { parent: paneId });
    for (var _i = 0; _i < children.length; _i++) {
        var child = children[_i].pane;
        app_1.dispatch("remove pane", { paneId: child }, changes);
    }
    changes.remove("ui pane", { pane: paneId })
        .remove("ui pane position", { pane: paneId })
        .remove("ui pane parent", { parent: paneId })
        .remove("ui pane parent", { pane: paneId });
});
app_1.handle("set popout", function (changes, info) {
    // Recycle the parent's existing popout if it exists, otherwise create a new one
    var parentId = info.parentId;
    var paneId = utils_1.uuid();
    var children = app_1.eve.find("ui pane parent", { parent: parentId });
    var parent = app_1.eve.findOne("ui pane", { pane: parentId });
    var reusing = false;
    // if(parent && parent.kind === PANE.POPOUT) {
    //   reusing = true;
    //   paneId = parentId;
    //   parentId = eve.findOne("ui pane parent", {pane: parentId}).parent;
    // } else 
    if (children.length) {
        //check if there is already a child popout
        for (var _i = 0; _i < children.length; _i++) {
            var childRel = children[_i];
            var child = app_1.eve.findOne("ui pane", { pane: childRel.pane });
            if (child.kind === PANE.POPOUT) {
                paneId = child.pane;
                break;
            }
        }
    }
    // Infer valid rep and params if search has changed
    if (info.contains && !info.rep) {
        var inferred = inferRepresentation(info.contains, typeof info.params === "string" ? parseParams(info.params) : info.params);
        info.rep = inferred.rep;
        info.params = inferred.params;
        if (!info.rep)
            throw new Error("Could not infer a valid representation for search '" + info.contains + "' in popout '" + paneId + "'");
    }
    // Fill missing properties from the previous fact, if present
    var prev = app_1.eve.findOne("ui pane", { pane: paneId }) || {};
    var prevPos = app_1.eve.findOne("ui pane position", { pane: paneId }) || {};
    var _a = info.rep, rep = _a === void 0 ? prev.rep : _a, _b = info.contains, raw = _b === void 0 ? prev.contains : _b, _c = info.params, rawParams = _c === void 0 ? prev.params : _c, _d = info.x, x = _d === void 0 ? prevPos.x : _d, _e = info.y, y = _e === void 0 ? prevPos.y : _e, _f = info.popState, popState = _f === void 0 ? false : _f;
    if (rep === undefined || raw === undefined || rawParams === undefined || x === undefined || y === undefined) {
        throw new Error("Cannot create new popout without all parameters specified for pane '" + paneId + "'");
    }
    if (reusing) {
        x = prevPos.x;
        y = prevPos.y;
    }
    var params = typeof rawParams === "string" ? rawParams : stringifyParams(rawParams);
    var contains = asEntity(raw) || ("" + raw).trim();
    if (!popState && prev.pane)
        popoutHistory.push({ rep: prev.rep, contains: prev.contains, params: prev.params, x: prevPos.x, y: prevPos.y });
    app_1.dispatch("remove pane", { paneId: paneId }, changes);
    changes.add("ui pane", { pane: paneId, kind: PANE.POPOUT, rep: rep, contains: contains, params: params })
        .add("ui pane parent", { parent: parentId, pane: paneId })
        .add("ui pane position", { pane: paneId, x: x, y: y });
});
// @TODO: take parentId
app_1.handle("remove popup", function (changes, _a) {
    var popup = app_1.eve.findOne("ui pane", { kind: PANE.POPOUT });
    if (popup)
        app_1.dispatch("remove pane", { paneId: popup.pane }, changes);
    popoutHistory = [];
});
app_1.handle("close card", function (changes, _a) {
    var paneId = _a.paneId;
    if (app_1.eve.findOne("ui pane", { pane: paneId }).kind === PANE.FULL) {
        changes.dispatch("set pane", { paneId: paneId, contains: "" });
    }
    else {
        changes.dispatch("remove pane", { paneId: paneId });
    }
});
app_1.handle("ui toggle search plan", function (changes, _a) {
    var paneId = _a.paneId;
    var state = exports.uiState.widget.search[paneId] = exports.uiState.widget.search[paneId] || { value: "" };
    state.plan = !state.plan;
});
app_1.handle("add sourced eav", function (changes, eav) {
    var entity = eav.entity, attrName = eav.attribute, value = eav.value, source = eav.source, forceEntity = eav.forceEntity;
    if (!source) {
        source = utils_1.uuid();
    }
    var attribute = NLQueryParser_1.normalizeString(attrName);
    var valueId = asEntity(value);
    var coerced = utils_1.coerceInput(value);
    var strValue = value.toString().trim();
    if (valueId) {
        value = valueId;
    }
    else if (strValue[0] === '"' && strValue[strValue.length - 1] === '"') {
        value = JSON.parse(strValue);
    }
    else if (typeof coerced === "number") {
        value = coerced;
    }
    else if (forceEntity || attribute === "is a") {
        var newEntity = utils_1.uuid();
        var pageId = utils_1.uuid();
        changes.dispatch("create page", { page: pageId, content: "" })
            .dispatch("create entity", { entity: newEntity, name: strValue, page: pageId });
        value = newEntity;
    }
    else {
        value = coerced;
    }
    changes.add("sourced eav", { entity: entity, attribute: attribute, value: value, source: source })
        .remove("display name", { id: attribute })
        .add("display name", { id: attribute, name: attrName });
});
app_1.handle("remove sourced eav", function (changes, eav) {
    changes.remove("sourced eav", eav);
});
app_1.handle("update page", function (changes, _a) {
    var page = _a.page, content = _a.content;
    changes.remove("page content", { page: page });
    changes.add("page content", { page: page, content: content });
    // let trimmed = content.trim();
    // let endIx = trimmed.indexOf("\n");
    // let name = trimmed.slice(1, endIx !== -1 ? endIx : undefined).trim();
    // let {entity} = eve.findOne("entity page", {page});
    // let {name:prevName = undefined} = eve.findOne("display name", {id: entity}) || {};
    // if(name !== prevName) {
    //   changes.remove("display name", {id: entity, name: prevName});
    //   changes.add("display name", {id: entity, name});
    //   let parts = getLocation().split("/");
    //   if(parts.length > 2 && parts[2].replace(/_/gi, " ") === entity) {
    //     window.history.replaceState(window.history.state, null, `/${slugify(name)}/${slugify(entity)}`);
    //   }
    // }
});
app_1.handle("create entity", function (changes, _a) {
    var entity = _a.entity, page = _a.page, _b = _a.name, name = _b === void 0 ? "Untitled" : _b;
    changes
        .add("entity page", { entity: entity, page: page })
        .add("display name", { id: entity, name: name });
});
app_1.handle("create page", function (changes, _a) {
    var page = _a.page, _b = _a.content, content = _b === void 0 ? undefined : _b;
    if (content === undefined)
        content = "This page is empty. Type something to add some content!";
    changes.add("page content", { page: page, content: content });
});
app_1.handle("create query", function (changes, _a) {
    var id = _a.id, content = _a.content;
    var page = utils_1.uuid();
    changes
        .add("page content", { page: page, content: "#" + content + " query" })
        .add("entity page", { id: id, page: page })
        .add("display name", { id: id, content: content })
        .add("sourced eav", { entity: id, attribute: "is a", value: utils_1.builtinId("query") })
        .add("sourced eav", { entity: id, attribute: "content", value: content });
    var artifacts = parser_1.parseDSL(content);
    if (artifacts.changeset)
        changes.merge(artifacts.changeset);
    for (var viewId in artifacts.views) {
        changes.add("sourced eav", { entity: id, attribute: "artifact", value: viewId });
        var name_1 = artifacts.views[viewId]["displayName"];
        if (!app_1.eve.findOne("display name", { id: viewId }) && name_1)
            changes.add("display name", { id: viewId, name: name_1 });
        changes.merge(artifacts.views[viewId].changeset(app_1.eve));
    }
});
app_1.handle("insert query", function (changes, _a) {
    var query = _a.query;
    query = query.trim().toLowerCase();
    var parsed = safeNLParse(query);
    var topParse = parsed[0];
    if (app_1.eve.findOne("query to id", { query: query }))
        return;
    if (topParse.intent === NLQueryParser_1.Intents.QUERY) {
        var artifacts = parser_1.parseDSL(parsed[0].query.toString());
        if (artifacts.changeset)
            changes.merge(artifacts.changeset);
        var rootId;
        for (var viewId in artifacts.views) {
            if (!rootId)
                rootId = viewId;
            var name_2 = artifacts.views[viewId]["displayName"];
            if (!app_1.eve.findOne("display name", { id: viewId }) && name_2)
                changes.add("display name", { id: viewId, name: name_2 });
            changes.merge(artifacts.views[viewId].changeset(app_1.eve));
        }
        changes.add("query to id", { query: query, id: rootId });
    }
});
app_1.handle("handle setAttribute in a search", function (changes, _a) {
    var attribute = _a.attribute, entity = _a.entity, value = _a.value, replace = _a.replace;
    if (replace) {
        //check if there's a generator, if so, remove that.
        var generated = app_1.eve.find("generated eav", { entity: entity, attribute: attribute });
        if (generated.length) {
            for (var _i = 0; _i < generated.length; _i++) {
                var gen = generated[_i];
                changes.merge(app_1.dispatch("remove attribute generating query", { eav: { entity: entity, attribute: attribute }, view: gen["source"] }));
            }
        }
        else {
            changes.remove("sourced eav", { entity: entity, attribute: attribute });
        }
    }
    changes.merge(app_1.dispatch("add sourced eav", { entity: entity, attribute: attribute, value: value, forceEntity: true }));
});
function dispatchSearchSetAttributes(query, chain) {
    if (!chain) {
        chain = app_1.dispatch();
    }
    var parsed = safeNLParse(query);
    var topParse = parsed[0];
    var isSetSearch = false;
    if (topParse.intent === NLQueryParser_1.Intents.INSERT) {
        // debugger;
        var attributes = [];
        for (var _i = 0, _a = topParse.inserts; _i < _a.length; _i++) {
            var insert = _a[_i];
            // @TODO: NLP needs to tell us whether we're supposed to modify this attribute
            // or if we're just adding a new eav for it.
            var replace = true;
            var entity = insert.entity.entity.id;
            var attribute = void 0;
            if (insert.attribute.attribute) {
                attribute = insert.attribute.attribute.displayName;
            }
            else {
                attribute = insert.attribute.name;
            }
            var value = void 0;
            if (insert.value.type === NLQueryParser_1.NodeTypes.ENTITY) {
                var localValue = insert.value;
                value = localValue.entity.id;
            }
            else if (insert.value.type === NLQueryParser_1.NodeTypes.NUMBER || insert.value.type === NLQueryParser_1.NodeTypes.STRING || insert.value.type === undefined) {
                var localValue = insert.value;
                value = localValue.name;
            }
            if (value === undefined)
                continue;
            chain.dispatch("handle setAttribute in a search", { entity: entity, attribute: attribute, value: value, replace: replace });
            attributes.push("" + attribute);
        }
        query = attributes.join(" and ");
        isSetSearch = true;
    }
    return { chain: chain, query: query, isSetSearch: isSetSearch };
}
// @TODO: there's a lot of duplication between insert query, create query, and insert implication
app_1.handle("insert implication", function (changes, _a) {
    var query = _a.query;
    var artifacts = parser_1.parseDSL(query);
    if (artifacts.changeset)
        changes.merge(artifacts.changeset);
    for (var viewId in artifacts.views) {
        var name_3 = artifacts.views[viewId]["displayName"];
        if (!app_1.eve.findOne("display name", { id: viewId }) && name_3)
            changes.add("display name", { id: viewId, name: name_3 });
        changes.merge(artifacts.views[viewId].changeset(app_1.eve));
    }
});
app_1.handle("remove entity attribute", function (changes, _a) {
    var entity = _a.entity, attribute = _a.attribute, value = _a.value;
    changes.remove("sourced eav", { entity: entity, attribute: attribute, value: value });
    // @FIXME: Make embeds auto-gc themselves when invalidated.
});
app_1.handle("update entity attribute", function (changes, _a) {
    var entity = _a.entity, attribute = _a.attribute, prev = _a.prev, value = _a.value;
    // @FIXME: proper unique source id
    var _b = (app_1.eve.findOne("sourced eav", { entity: entity, attribute: attribute, value: prev }) || {}).source, source = _b === void 0 ? "<global>" : _b;
    if (prev !== undefined)
        changes.remove("sourced eav", { entity: entity, attribute: attribute, value: prev });
    changes.add("sourced eav", { entity: entity, attribute: attribute, value: value, source: source });
});
app_1.handle("rename entity attribute", function (changes, _a) {
    var entity = _a.entity, attrName = _a.attribute, prev = _a.prev, value = _a.value;
    // @FIXME: proper unique source id
    var _b = (app_1.eve.findOne("sourced eav", { entity: entity, attribute: prev, value: value }) || {}).source, source = _b === void 0 ? "<global>" : _b;
    var attribute = NLQueryParser_1.normalizeString(attrName);
    if (prev !== undefined) {
        changes.remove("sourced eav", { entity: entity, attribute: prev, value: value })
            .remove("display name", { id: prev });
    }
    changes.add("sourced eav", { entity: entity, attribute: attribute, value: value, source: source })
        .add("display name", { id: attribute, name: attrName });
});
app_1.handle("sort table", function (changes, _a) {
    var state = _a.state, field = _a.field, direction = _a.direction;
    if (field !== undefined) {
        state.sortField = field;
        state.sortDirection = 1;
    }
    if (direction !== undefined)
        state.sortDirection = direction;
});
app_1.handle("toggle settings", function (changes, _a) {
    var paneId = _a.paneId, _b = _a.open, open = _b === void 0 ? undefined : _b;
    var state = exports.uiState.pane[paneId] || { settings: false };
    state.settings = open !== undefined ? open : !state.settings;
    exports.uiState.pane[paneId] = state;
});
app_1.handle("toggle collapse", function (changes, _a) {
    var collapsible = _a.collapsible, _b = _a.open, open = _b === void 0 ? undefined : _b;
    var state = exports.uiState.widget.collapsible[collapsible] || { open: false };
    state.open = open !== undefined ? open : !state.open;
    exports.uiState.widget.collapsible[collapsible] = state;
});
app_1.handle("toggle prompt", function (changes, _a) {
    var _b = _a.prompt, prompt = _b === void 0 ? undefined : _b, _c = _a.paneId, paneId = _c === void 0 ? undefined : _c, _d = _a.open, open = _d === void 0 ? undefined : _d;
    var state = exports.uiState.prompt;
    if (state.prompt !== prompt) {
        state.prompt = prompt;
        state.open = open !== undefined ? open : true;
        state.paneId = paneId;
    }
    else {
        state.open !== undefined ? open : !state.open;
    }
    exports.uiState.prompt = state;
});
app_1.handle("remove entity", function (changes, _a) {
    var entity = _a.entity;
    changes.remove("sourced eav", { entity: entity })
        .remove("display name", { id: entity })
        .remove("manual eavs", { entity: entity })
        .remove("entity page", { entity: entity });
});
//---------------------------------------------------------
// Wiki Containers
//---------------------------------------------------------
function root() {
    var panes = [];
    for (var _i = 0, _a = app_1.eve.find("ui pane", { kind: PANE.FULL }); _i < _a.length; _i++) {
        var paneId = _a[_i].pane;
        panes.push(pane(paneId));
    }
    if (exports.uiState.prompt.open && exports.uiState.prompt.prompt && !exports.uiState.prompt.paneId) {
        panes.push({ c: "shade", click: closePrompt, children: [
                exports.uiState.prompt.prompt()
            ] });
    }
    if (!localStorage["hideBanner"]) {
        panes.unshift({ id: "feedback-banner", c: "banner", children: [
                { c: "content", children: [
                        { text: "This is an early release of Eve meant for " },
                        { t: "a", c: "link", href: "https://groups.google.com/forum/#!forum/eve-talk", text: "feedback" },
                        { text: ". We're shooting for quality over quantity, so please don't post this to HN, Reddit, etc, but feel free to share it with friends." },
                    ] },
                { c: "flex-grow spacer" },
                { t: "button", c: "ion-close", click: hideBanner }
            ] });
    }
    panes.unshift({ c: "feedback-bar", children: [
            { t: "a", target: "_blank", href: "https://github.com/witheve/Eve/issues", text: "bugs" },
            { t: "a", target: "_blank", href: "https://groups.google.com/forum/#!forum/eve-talk", text: "suggestions" },
            { t: "a", target: "_blank", href: "https://groups.google.com/forum/#!forum/eve-talk", text: "discussion" },
        ] });
    return { c: "wiki-root", id: "root", children: panes };
}
exports.root = root;
function hideBanner(event, elem) {
    localStorage["hideBanner"] = true;
    app_1.dispatch("").commit();
}
// @TODO: Add search functionality + Pane Chrome
var paneChrome = (_a = {},
    _a[PANE.FULL] = function (paneId, entityId) { return ({
        c: "fullscreen",
        header: { t: "header", c: "flex-row", children: [
                // {c: "logo eve-logo", data: {paneId}, link: "", click: navigate},
                searchInput(paneId, entityId),
                { c: "controls visible", children: [
                        { c: "ion-gear-a toggle-settings", style: "font-size: 1.35em;", prompt: paneSettings, paneId: paneId, click: openPrompt }
                    ] }
            ] }
    }); },
    _a[PANE.POPOUT] = function (paneId, entityId) {
        // let parent = eve.findOne("ui pane parent", {pane: paneId})["parent"];
        return {
            c: "window",
            captureClicks: true,
            header: { t: "header", c: "", children: [] },
        };
    },
    _a[PANE.WINDOW] = function (paneId, entityId) { return ({
        c: "window",
        header: { t: "header", c: "flex-row", children: [
                { c: "flex-grow title", text: entityId },
                { c: "flex-row controls", children: [
                        { c: "ion-android-search" },
                        { c: "ion-minus-round" },
                        { c: "ion-close-round" }
                    ] }
            ] }
    }); },
    _a
);
function openPrompt(event, elem) {
    app_1.dispatch("toggle prompt", { prompt: elem.prompt, paneId: elem.paneId, open: true }).commit();
}
function closePrompt(event, elem) {
    if (event.target === event.currentTarget) {
        app_1.dispatch("toggle prompt", { open: false }).commit();
    }
}
function navigateParent(event, elem) {
    var root = app_1.eve.findOne("ui pane", { kind: PANE.FULL })["pane"];
    app_1.dispatch("remove popup", { paneId: elem.paneId })
        .dispatch("set pane", { paneId: root, contains: elem.link })
        .commit();
}
function removePopup(event, elem) {
    if (!event.defaultPrevented) {
        var chain = app_1.dispatch("remove popup", {}).dispatch("clearActiveCells", {});
        for (var entity in exports.uiState.widget.attributes) {
            chain.dispatch("clearActiveAttribute", { entity: entity });
        }
        chain.commit();
    }
}
function loadFromFile(event, elem) {
    var target = event.target;
    if (!target.files.length)
        return;
    if (target.files.length > 1)
        throw new Error("Cannot load multiple files at once");
    var file = target.files[0];
    var reader = new FileReader();
    reader.onload = function (event) {
        var serialized = event.target.result;
        app_1.eve.deleteDB();
        app_1.eve.load(serialized);
        app_1.dispatch("toggle prompt", { prompt: loadedPrompt, open: true }).commit();
    };
    reader.readAsText(file);
}
function deleteDatabasePrompt() {
    return { c: "modal-prompt delete-prompt", children: [
            { t: "header", c: "flex-row", children: [
                    { t: "h2", text: "DELETE DATABASE" },
                    { c: "flex-grow" },
                    { c: "controls", children: [{ c: "ion-close-round", click: closePrompt }] }
                ] },
            { c: "info", text: "This will remove all information currently stored in Eve for you and cannot be undone." },
            { c: "flex-row", children: [
                    { t: "button", c: "delete-btn", text: "DELETE EVERYTHING FOREVER", click: nukeDatabase },
                    { c: "flex-grow" },
                    { t: "button", text: "Cancel", click: closePrompt },
                ] }
        ] };
}
function nukeDatabase() {
    localStorage["local-eve"] = "";
    window.location.href = window.location.origin + "/";
}
function savePrompt() {
    var serialized = localStorage[app_1.eveLocalStorageKey];
    var blob = new Blob([serialized], { type: "application/json" });
    var url = URL.createObjectURL(blob);
    return { c: "modal-prompt save-prompt", children: [
            { t: "header", c: "flex-row", children: [
                    { t: "h2", text: "Save DB" },
                    { c: "flex-grow" },
                    { c: "controls", children: [{ c: "ion-close-round", click: closePrompt }] }
                ] },
            { t: "a", href: url, download: "save.evedb", text: "save to file" }
        ] };
}
function loadPrompt() {
    var serialized = localStorage[app_1.eveLocalStorageKey];
    return { c: "modal-prompt load-prompt", children: [
            { t: "header", c: "flex-row", children: [
                    { t: "h2", text: "Load DB" },
                    { c: "flex-grow" },
                    { c: "controls", children: [{ c: "ion-close-round", click: closePrompt }] }
                ] },
            { t: "p", children: [
                    { t: "span", text: "WARNING: This will overwrite your current database. This is irreversible. You should consider " },
                    { t: "a", text: "saving your DB", prompt: savePrompt, click: openPrompt },
                    { t: "span", text: " first." }
                ] },
            { t: "input", type: "file", text: "load from file", change: loadFromFile }
        ] };
}
function loadedPrompt() {
    return { c: "modal-prompt load-prompt", children: [
            { t: "header", c: "flex-row", children: [
                    { t: "h2", text: "Load DB" },
                    { c: "flex-grow" },
                    { c: "controls", children: [{ c: "ion-close-round", click: closePrompt }] }
                ] },
            { text: "Successfully loaded DB from file" }
        ] };
}
function pane(paneId) {
    // @FIXME: Add kind to ui panes
    var _a = app_1.eve.findOne("ui pane", { pane: paneId }) || {}, _b = _a.contains, rawContains = _b === void 0 ? undefined : _b, _c = _a.kind, kind = _c === void 0 ? PANE.FULL : _c, _d = _a.rep, rep = _d === void 0 ? undefined : _d, _e = _a.params, rawParams = _e === void 0 ? undefined : _e;
    var _f = queryUIInfo(rawContains || "home"), results = _f.results, parsedParams = _f.params, contains = _f.content;
    var params = utils_1.mergeObject(parseParams(rawParams), parsedParams);
    params.paneId = paneId;
    var makeChrome = paneChrome[kind];
    if (!makeChrome)
        throw new Error("Unknown pane kind: '" + kind + "' (" + PANE[kind] + ")");
    var _g = makeChrome(paneId, contains), klass = _g.c, header = _g.header, footer = _g.footer, captureClicks = _g.captureClicks;
    var entityId = asEntity(contains);
    var content;
    var contentType = "invalid";
    if (contains.length === 0 || entityId)
        contentType = "entity";
    else if (app_1.eve.findOne("query to id", { query: contains.trim().toLowerCase() }))
        contentType = "search";
    if (params.rep || rep) {
        params["search"] = contains;
        content = represent(contains, params.rep || rep, results, params, (params.unwrapped ? undefined : function (elem, ix) { return uitk.card({ id: paneId + "|" + contains + "|" + (ix === undefined ? "" : ix), children: [elem] }); }));
        content.t = "content";
        content.c = (content.c || "") + " " + (params.unwrapped ? "unwrapped" : "");
    }
    var disambiguation;
    if (contentType === "invalid") {
        disambiguation = { c: "flex-row spaced-row disambiguation", children: [
                { t: "span", text: "I couldn't find anything; should I" },
                { t: "a", c: "link btn add-btn", text: "add " + contains, name: contains, paneId: paneId, click: createPage },
                { t: "span", text: "?" },
            ] };
        content = undefined;
    }
    else if (contentType === "search") {
        // @TODO: This needs to move into Eve's notification / chat bar
        disambiguation = { id: "search-disambiguation", c: "flex-row spaced-row disambiguation", children: [
                { text: "Or should I" },
                { t: "a", c: "link btn add-btn", text: "add a card", name: contains, paneId: paneId, click: createPage },
                { text: "for " + contains + "?" }
            ] };
    }
    var scroller = content;
    if (kind === PANE.FULL) {
        var panes = app_1.eve.find("ui pane").filter(function (pane) { return pane.kind !== PANE.FULL; });
        var children = [content].concat(panes.map(function (p) { return pane(p.pane); }));
        scroller = { c: "scroller", children: children };
    }
    var curPane = { c: "wiki-pane " + (klass || ""), paneId: paneId, children: [header, disambiguation, scroller, footer] };
    var pos = app_1.eve.findOne("ui pane position", { pane: paneId });
    if (pos) {
    }
    if (captureClicks) {
        curPane.click = uitk_1.preventDefault;
    }
    if (exports.uiState.prompt.open && exports.uiState.prompt.paneId === paneId) {
        curPane.children.push({ c: "shade", paneId: paneId, click: closePrompt }, exports.uiState.prompt.prompt(paneId));
    }
    return curPane;
}
exports.pane = pane;
function search(search, paneId) {
    var _a = search.split("|"), rawContent = _a[0], rawParams = _a[1];
    var parsedParams = getCellParams(rawContent, rawParams);
    var _b = queryUIInfo(search), results = _b.results, params = _b.params, content = _b.content;
    params["paneId"] = paneId;
    utils_1.mergeObject(params, parsedParams);
    var rep = represent(content, params["rep"], results, params);
    return { t: "content", c: "wiki-search", children: [
            rep
        ] };
}
exports.search = search;
function createPage(evt, elem) {
    var name = elem["name"];
    var entity = utils_1.uuid();
    var page = utils_1.uuid();
    app_1.dispatch("create page", { page: page, content: "" })
        .dispatch("create entity", { entity: entity, page: page, name: name })
        .dispatch("set pane", { paneId: elem["paneId"], contains: entity, rep: "entity", params: "" }).commit();
}
function deleteEntity(event, elem) {
    var name = uitk.resolveName(elem.entity);
    app_1.dispatch("remove entity", { entity: elem.entity }).commit();
    app_1.dispatch("set pane", { paneId: elem.paneId, contains: name }).commit();
}
function paneSettings(paneId) {
    var pane = app_1.eve.findOne("ui pane", { pane: paneId });
    var _a = (app_1.eve.findOne("entity", { entity: uitk.resolveId(pane.contains) }) || {}).entity, entity = _a === void 0 ? undefined : _a;
    var isSystem = !!(entity && app_1.eve.findOne("entity eavs", { entity: entity, attribute: "is a", value: utils_1.builtinId("system") }));
    return { t: "ul", c: "settings", children: [
            { t: "li", c: "save-btn", text: "save", prompt: savePrompt, click: openPrompt },
            { t: "li", c: "load-btn", text: "load", prompt: loadPrompt, click: openPrompt },
            entity && !isSystem ? { t: "li", c: "delete-btn", text: "delete card", entity: entity, paneId: paneId, click: deleteEntity } : undefined,
            { t: "li", c: "delete-btn", text: "DELETE DATABASE", prompt: deleteDatabasePrompt, click: openPrompt },
        ] };
}
function sizeColumns(node, elem) {
    // @FIXME: Horrible hack to get around randomly added "undefined" text node that's coming from in microreact.
    var cur = node;
    while (cur.parentElement)
        cur = cur.parentElement;
    if (cur.tagName !== "HTML")
        document.body.appendChild(cur);
    var child, ix = 0;
    var widths = {};
    var columns = node.querySelectorAll(".column");
    for (var _i = 0; _i < columns.length; _i++) {
        var column = columns[_i];
        column.style.width = "auto";
        widths[column["value"]] = widths[column["value"]] || 0;
        if (column.offsetWidth > widths[column["value"]])
            widths[column["value"]] = column.offsetWidth;
    }
    for (var _a = 0; _a < columns.length; _a++) {
        var column = columns[_a];
        column.style.width = widths[column["value"]] + 1;
    }
    if (cur.tagName !== "HTML")
        document.body.removeChild(cur);
}
//---------------------------------------------------------
// Wiki editor functions
//---------------------------------------------------------
function parseParams(rawParams) {
    var params = {};
    if (!rawParams)
        return params;
    for (var _i = 0, _a = rawParams.split(";"); _i < _a.length; _i++) {
        var kv = _a[_i];
        var _b = kv.split("="), key = _b[0], value = _b[1];
        if (!key || !key.trim())
            continue;
        value = value.trim();
        if (!value)
            throw new Error("Must specify value for key '" + key + "'");
        if (value[0] === "{" && value[value.length - 1] === "}" || value[0] === "[" && value[value.length - 1] === "]") {
            try {
                var result = JSON.parse(value);
                value = result;
            }
            catch (err) { }
        }
        params[key.trim()] = utils_1.coerceInput(value);
    }
    return params;
}
function stringifyParams(params) {
    var rawParams = "";
    if (!params)
        return rawParams;
    for (var key in params) {
        if (params[key] === undefined || params[key] === null)
            continue;
        rawParams += "" + (rawParams.length ? "; " : "") + key + " = " + (typeof params[key] === "object" ? JSON.stringify(params[key]) : params[key]);
    }
    return rawParams;
}
function cellUI(paneId, query, cell) {
    var _a = queryUIInfo(query), params = _a.params, results = _a.results, content = _a.content;
    params["paneId"] = params["paneId"] || paneId;
    params["cell"] = cell;
    params["childRep"] = params["rep"];
    params["rep"] = "embeddedCell";
    return { c: "cell", children: [represent(content, params["rep"], results, params)] };
}
// Credit to https://mathiasbynens.be/demo/url-regex and @gruber
var urlRegex = /\b(([\w-]+:\/\/?|www[.])[^\s()<>]+(?:\([\w\d]+\)|([^[\.,\-\/#!$%' "^*;:{_`~()\-\s]|\/)))/i;
function queryUIInfo(query) {
    var _a = query.split("|"), content = _a[0], rawParams = _a[1];
    var embedType;
    // let params = getCellParams(content, rawParams);
    var params = parseParams(rawParams);
    var results;
    var entityId = asEntity(content);
    if (entityId) {
        results = { unprojected: [{ entity: entityId }], results: [{ entity: entityId }] };
    }
    else if (urlRegex.exec(content)) {
        results = { unprojected: [{ url: content }], results: [{ url: content }] };
    }
    else {
        var cleaned = content && content.trim().toLowerCase();
        var queryId = app_1.eve.findOne("query to id", { query: cleaned });
        if (queryId) {
            var queryResults = app_1.eve.find(queryId.id);
            var queryUnprojected = app_1.eve.table(queryId.id).unprojected;
            if (!queryResults.length) {
                params["rep"] = "error";
                params["message"] = "No results";
            }
            else {
                results = { unprojected: queryUnprojected, results: queryResults };
            }
        }
        else {
            params["rep"] = "error";
            params["message"] = "invalid search";
        }
    }
    return { results: results, params: params, content: content };
}
function getCellParams(content, rawParams) {
    content = content.trim();
    var params = parseParams(rawParams);
    var entityId = asEntity(content);
    if (entityId) {
        params["rep"] = params["rep"] || "link";
    }
    else if (urlRegex.exec(content)) {
        params["rep"] = params["rep"] || "externalLink";
    }
    else {
        if (params["rep"])
            return params;
        var parsed = safeNLParse(content);
        var currentParse = parsed[0];
        if (currentParse.intent === NLQueryParser_1.Intents.NORESULT) {
            params["rep"] = "error";
            return params;
        }
        var context = currentParse.context;
        var hasCollections = context.collections.length;
        var field;
        var rep;
        var aggregates = [];
        // console.log(currentParse.query.toString())
        for (var _i = 0, _a = context.fxns; _i < _a.length; _i++) {
            var fxn = _a[_i];
            if (fxn.fxn.type === NLQueryParser_1.FunctionTypes.AGGREGATE) {
                aggregates.push(fxn);
            }
        }
        var totalFound = 0;
        for (var _b = 0, _c = ["attributes", "entities", "collections", "fxns", "maybeAttributes", "maybeEntities", "maybeCollections", "maybeFunctions"]; _b < _c.length; _b++) {
            var item = _c[_b];
            totalFound += context[item].length;
        }
        console.log(context);
        if (aggregates.length === 1 && context["groupings"].length === 0) {
            rep = "result";
            field = aggregates[0].fxn.projectedAs;
        }
        else if (!hasCollections && context.fxns.length === 1 && context.fxns[0].fxn.type !== NLQueryParser_1.FunctionTypes.BOOLEAN) {
            rep = "result";
            field = context.fxns[0].fxn.projectedAs;
        }
        else if (!hasCollections && context.attributes.length === 1) {
            rep = "result";
            field = context.attributes[0].attribute.projectedAs;
        }
        else if (context.entities.length + context.fxns.length === totalFound) {
            // if there are only entities and boolean functions then we want to show this as cards
            params["rep"] = "entity";
        }
        else if (currentParse.query && currentParse.query.projects.length) {
            staticOrMappedTable(content, params);
        }
        else {
            // Error state, unknown entity
            params["rep"] = "error";
        }
        if (rep) {
            params["rep"] = rep;
            params["field"] = field;
        }
    }
    console.log("PARAMS", params);
    return params;
}
var paneEditors = {};
function wikiEditor(node, elem) {
    richTextEditor_1.createEditor(node, elem);
    var _a = elem.meta, paneId = _a.paneId, entityId = _a.entityId;
    paneEditors[(paneId + "|" + entityId)] = node.editor;
}
exports.wikiEditor = wikiEditor;
function reparentCell(node, elem) {
    if (node.parentNode.id !== elem.containerId) {
        document.getElementById(elem.containerId).appendChild(node);
    }
    node.parentNode["mark"].changed();
}
function focusCellEditor(node, elem) {
    utils_1.autoFocus(node, elem);
    if (!node.didFocus) {
        node.didFocus = true;
        utils_1.setEndOfContentEditable(node);
    }
}
//---------------------------------------------------------
function cellEditor(entityId, paneId, cell) {
    var text = exports.activeCells[cell.id].query;
    var _a = autocompleterOptions(entityId, paneId, cell), options = _a.options, selected = _a.selected;
    var autoFocus = true;
    if (text.match(/\$\$.*\$\$/)) {
        text = "";
    }
    var _b = (app_1.eve.findOne("display name", { id: text }) || {}).name, name = _b === void 0 ? undefined : _b;
    if (name) {
        text = name;
    }
    return { children: [
            { c: "embedded-cell", children: [
                    { c: "adornment", text: "=" },
                    { t: "span", c: "", contentEditable: true, text: text, click: uitk_1.preventDefault, input: updateActiveCell, keydown: embeddedCellKeys, cell: cell, selected: selected, paneId: paneId, postRender: autoFocus ? focusCellEditor : undefined },
                ] },
            autocompleter(options, paneId, cell)
        ] };
}
function autocompleter(options, paneId, cell) {
    var children = [];
    for (var _i = 0; _i < options.length; _i++) {
        var option = options[_i];
        var item = { c: "option", children: option.children, text: option.text, selected: option, cell: cell, paneId: paneId, click: executeAutocompleterOption, keydown: optionKeys };
        if (option.selected) {
            item.c += " selected";
        }
        children.push(item);
    }
    return { c: "autocompleter", key: performance.now().toString(), cell: cell, containerId: paneId + "|" + cell.id + "|container", children: children, postRender: positionAutocompleter };
}
function optionKeys(event, elem) {
    if (event.keyCode === utils_1.KEYS.ENTER) {
        executeAutocompleterOption(event.currentTarget, elem);
    }
}
function executeAutocompleterOption(event, elem) {
    if (event.defaultPrevented)
        return;
    var paneId = elem.paneId, cell = elem.cell;
    var editor = paneEditors[cell.editorId];
    var cm = editor.cmInstance;
    var mark = editor.marks[cell.id];
    var doEmbed = makeDoEmbedFunction(cm, mark, cell, paneId);
    if (elem.selected && elem.selected.action) {
        if (typeof elem.selected.action === "function") {
            elem.selected.action(elem, cell.query, doEmbed);
        }
    }
}
function autocompleterOptions(entityId, paneId, cell) {
    var _a = cell.query.trim().split("|"), text = _a[0], rawParams = _a[1];
    if (text.match(/\$\$.*\$\$/)) {
        return { options: [], selected: {} };
    }
    var params = {};
    try {
        params = getCellParams(text, rawParams);
    }
    catch (e) {
    }
    var contentEntityId = asEntity(text);
    if (contentEntityId) {
        text = uitk.resolveName(contentEntityId);
    }
    var isEntity = app_1.eve.findOne("display name", { id: contentEntityId });
    var parsed = [];
    if (text !== "") {
        try {
            parsed = safeNLParse(text); // @TODO: this should come from the NLP parser once it's hooked up.
        }
        catch (e) {
        }
    }
    // the autocomplete can have multiple states
    var state = cell.state || "query";
    // every option has a score for how pertinent it is
    // things with a score of 0 will be filtered, everything else
    // will be sorted descending.
    var options;
    if (state === "query") {
        options = queryAutocompleteOptions(isEntity, parsed, text, params, entityId);
    }
    else if (state === "represent") {
        options = representAutocompleteOptions(isEntity, parsed, text, params, entityId);
    }
    else if (state === "create") {
        options = createAutocompleteOptions(isEntity, parsed, text, params, entityId);
    }
    else if (state === "define") {
        options = defineAutocompleteOptions(isEntity, parsed, text, params, entityId);
    }
    else if (state === "modify") {
        options = modifyAutocompleteOptions(isEntity, parsed, text, params, entityId);
    }
    else if (state === "property") {
        options = propertyAutocompleteOptions(isEntity, parsed, text, params, entityId);
    }
    else if (state === "url") {
        options = urlAutocompleteOptions(isEntity, parsed, text, params, entityId);
    }
    options = options.sort(function (a, b) { return b.score - a.score; });
    var selected;
    if (options.length) {
        var selectedIx = cell.selected % options.length;
        if (selectedIx < 0)
            selectedIx = options.length + selectedIx;
        selected = options[selectedIx];
        selected.selected = true;
    }
    for (var _i = 0; _i < options.length; _i++) {
        var option = options[_i];
        option["cell"] = cell;
        option["paneId"] = paneId;
    }
    return { options: options, selected: selected };
}
function positionAutocompleter(node, elem) {
    var containerId = elem.containerId;
    var container = document.getElementById(containerId);
    var _a = container.getBoundingClientRect(), bottom = _a.bottom, left = _a.left;
    document.body.appendChild(node);
    node.style.top = bottom;
    node.style.left = left;
}
function queryAutocompleteOptions(isEntity, parsed, text, params, entityId) {
    var pageName = uitk.resolveName(entityId);
    var options = [];
    var hasValidParse = parsed.some(function (parse) { return parse.intent === NLQueryParser_1.Intents.QUERY; });
    parsed.sort(function (a, b) { return b.score - a.score; });
    var topOption = parsed[0];
    var joiner = "a";
    if (text && text[0].match(/[aeiou]/i)) {
        joiner = "an";
    }
    var isAttribute = false;
    if (topOption) {
        var totalFound = 0;
        var context = topOption.context;
        for (var item in context) {
            totalFound += context[item].length;
        }
        var isEntAttr = totalFound === 2 && (context.entities.length === 1 || context.collections.length === 1);
        if (isEntAttr && context.maybeAttributes.length === 1) {
            options.push({ score: 4, action: setCellState, state: "define", text: "add " + text });
            isAttribute = true;
        }
        else if (isEntAttr && context.attributes.length === 1) {
            options.push({ score: 2.5, action: setCellState, state: "modify", text: "modify " + text });
        }
    }
    // create
    if (!isEntity && text !== "" && text != "=") {
        options.push({ score: 1, action: setCellState, state: "create", text: "Create " + joiner + " \"" + text + "\" page" });
    }
    // disambiguations
    if (parsed.length > 1) {
        options.push({ score: 3, action: "disambiguate stuff", text: "DISAMBIGUATE!" });
    }
    if (!isEntity && hasValidParse && params["rep"]) {
        options.push({ score: 4, action: embedAs, rep: params["rep"], params: params, text: "embed as a " + params["rep"] });
    }
    // repesentation
    // we can only repesent things if we've found them
    if (isEntity || hasValidParse) {
        // @TODO: how do we figure out what representations actually make sense to show?
        options.push({ score: 2, action: setCellState, state: "represent", text: "embed as ..." });
    }
    // set attribute
    if (text && app_1.eve.findOne("index name", { id: entityId }).name !== text.toLowerCase()) {
        if (!isAttribute) {
            options.push({ score: 2.5, action: setCellState, state: "property", text: "add as a property of " + pageName });
        }
        if (isEntity) {
            var isAScore = 2.5;
            if (app_1.eve.findOne("collection", { collection: isEntity.id })) {
                isAScore = 3;
            }
            options.push({ score: 2.5, action: addAttributeAndEmbed, replace: "is a", entityId: entityId, value: isEntity.id, attribute: "related to", text: pageName + " is related to " + text });
            options.push({ score: isAScore, action: addAttributeAndEmbed, replace: "related to", entityId: entityId, value: isEntity.id, attribute: "is a", text: pageName + " is " + joiner + " " + text });
        }
    }
    // url embedding
    if (urlRegex.exec(text)) {
        options.push({ score: 3, action: setCellState, state: "url", text: "embed url as..." });
    }
    return options;
}
function addAttributeAndEmbed(elem, strValue, doEmbed) {
    var _a = elem.selected, entityId = _a.entityId, value = _a.value, attribute = _a.attribute, replace = _a.replace;
    var chain = app_1.dispatch("add sourced eav", { entity: entityId, attribute: attribute, value: value, source: utils_1.uuid() });
    if (replace) {
        chain.dispatch("remove entity attribute", { entity: entityId, attribute: replace, value: value });
    }
    chain.commit();
    doEmbed(value + "|rep=link;");
}
function setCellState(elem, value, doEmbed) {
    app_1.dispatch("setCellState", { id: elem.cell.id, state: elem.selected.state }).commit();
}
function createAutocompleteOptions(isEntity, parsed, text, params, entityId) {
    var options = [];
    var pageName = uitk.resolveName(entityId);
    var isCollection = isEntity ? app_1.eve.findOne("collection", { collection: isEntity.id }) : false;
    var joiner = "a";
    if (text && text[0].match(/[aeiou]/i)) {
        joiner = "an";
    }
    var isAScore = 2.5;
    if (isCollection) {
        isAScore = 3;
    }
    options.push({ score: 2.5, action: createAndEmbed, replace: "is a", entityId: entityId, attribute: "related to", text: pageName + " is related to " + text });
    options.push({ score: isAScore, action: createAndEmbed, replace: "related to", entityId: entityId, attribute: "is a", text: pageName + " is " + joiner + " " + text });
    return options;
}
function createAndEmbed(elem, value, doEmbed) {
    //create the page and embed a link to it
    var entity = utils_1.uuid();
    var page = utils_1.uuid();
    var _a = elem.selected, entityId = _a.entityId, attribute = _a.attribute, replace = _a.replace;
    var chain = app_1.dispatch("create page", { page: page, content: "" })
        .dispatch("create entity", { entity: entity, page: page, name: value })
        .dispatch("add sourced eav", { entity: entityId, attribute: attribute, value: entity, source: utils_1.uuid() });
    if (replace) {
        chain.dispatch("remove entity attribute", { entity: entityId, attribute: replace, value: entity });
    }
    chain.commit();
    doEmbed(value + "|rep=link;");
}
function representAutocompleteOptions(isEntity, parsed, text, params, entityId) {
    var options = [];
    var isCollection = isEntity ? app_1.eve.findOne("collection", { collection: isEntity.id }) : false;
    options.push({ score: 1, text: "a table", action: embedAs, rep: "table", params: params });
    // options.push({score:1, text: "embed as a value", action: embedAs, rep: "value"});
    if (isEntity) {
        options.push({ score: 1, text: "a link", action: embedAs, rep: "link", params: params });
    }
    if (isCollection) {
        options.push({ score: 1, text: "a list", action: embedAs, rep: "index", params: params });
        options.push({ score: 1, text: "a directory", action: embedAs, rep: "directory", params: params });
    }
    if (isEntity) {
        options.push({ score: 1, text: "a list of related pages", action: embedAs, rep: "related", params: params });
    }
    return options;
}
function urlAutocompleteOptions(isEntity, parsed, url, params, entityId) {
    // @NOTE: url must be normalized before reaching here.
    // @FIXME: Need to get a url property onto the params. Should that be done here?
    var ext = url.slice(url.lastIndexOf(".") + 1).trim().toLowerCase();
    var domain = url.slice(url.indexOf("//") + 2).split("/")[0];
    var isImage = ["png", "jpg", "jpeg", "bmp", "tiff"].indexOf(ext) !== -1;
    var isVideo = (["mp4", "ogv", "webm", "mov", "avi", "flv"].indexOf(ext) !== -1) || (["www.youtube.com", "youtu.be"].indexOf(domain) !== -1);
    var options = [
        { score: 2, text: "a link", action: embedAs, rep: "externalLink", params: params },
        { score: isImage ? 3 : 1, text: "an image", action: embedAs, rep: "externalImage", params: params },
        { score: isVideo ? 3 : 1, text: "a video", action: embedAs, rep: "externalVideo", params: params },
    ];
    return options;
}
function embedAs(elem, value, doEmbed) {
    var text = value.split("|")[0];
    var params = elem.selected.params;
    var rawParams = "rep=" + elem.selected.rep;
    for (var param in params) {
        if (param !== "rep") {
            rawParams += "; " + param + "=" + params[param];
        }
    }
    doEmbed(text + "|" + rawParams);
}
function propertyAutocompleteOptions(isEntity, parsed, text, params, entityId) {
    var options = [];
    var topParse = parsed[0];
    var asQuery = topParse && topParse.intent === NLQueryParser_1.Intents.QUERY;
    var option = { score: 1, action: definePropertyAndEmbed, entityId: entityId, asQuery: asQuery };
    option.children = [
        { c: "attribute-name", text: "property" },
        { c: "inline-cell", contentEditable: true, selected: option, keydown: defineKeys, postRender: utils_1.autoFocus }
    ];
    options.push(option);
    return options;
}
function definePropertyAndEmbed(elem, value, doEmbed) {
    var selected = elem.selected;
    var entityId = selected.entityId, asQuery = selected.asQuery, defineValue = selected.defineValue;
    if (asQuery) {
        value = "= " + value;
    }
    var success = handleAttributeDefinition(entityId, defineValue, value);
    var entityName = uitk.resolveName(entityId);
    doEmbed(entityName + "'s " + defineValue + "|rep=CSV;field=" + defineValue);
}
function defineAutocompleteOptions(isEntity, parsed, text, params, entityId) {
    var options = [];
    var topParse = parsed[0];
    var context = topParse.context;
    var attribute;
    if (context.maybeAttributes[0]) {
        attribute = context.maybeAttributes[0].name;
    }
    else {
        attribute = context.attributes[0].displayName;
    }
    var subject = context.entities[0] || context.collections[0];
    var entity = subject.id;
    var option = { score: 1, action: defineAndEmbed, attribute: attribute, entity: entity };
    option.children = [
        { c: "attribute-name", text: attribute },
        { c: "inline-cell", contentEditable: true, selected: option, keydown: defineKeys, postRender: utils_1.autoFocus }
    ];
    options.push(option);
    return options;
}
function focusSelected(node, elem) {
    if (elem.selected.selected && node !== document.activeElement) {
        node.focus();
        utils_1.setEndOfContentEditable(node);
    }
}
function selectOptionIx(event, elem) {
    event.preventDefault();
    app_1.dispatch("moveCellAutocomplete", { cell: elem.selected.cell, value: elem.optionIx }).commit();
}
function modifyAutocompleteOptions(isEntity, parsed, text, params, entityId) {
    var options = [];
    var topParse = parsed[0];
    var context = topParse.context;
    var attribute = context.attributes[0].displayName;
    var subject = context.entities[0] || context.collections[0];
    var entity = subject.id;
    var eavs = app_1.eve.find("entity eavs", { entity: entity, attribute: attribute });
    var ix = 0;
    var sourcesSeen = {};
    for (var _i = 0; _i < eavs.length; _i++) {
        var eav = eavs[_i];
        var option_1 = { score: 1, action: modifyAndEmbed, eav: eav, params: params };
        var generated = app_1.eve.findOne("generated eav", { entity: eav.entity, attribute: eav.attribute, value: eav.value });
        var text_1 = eav.value;
        var sourceView = void 0;
        var display = app_1.eve.findOne("display name", { id: text_1 });
        if (generated) {
            sourceView = generated.source;
            if (sourcesSeen[sourceView])
                continue;
            sourcesSeen[sourceView] = true;
            text_1 = "= " + app_1.eve.findOne("query to id", { id: sourceView }).query;
            option_1.sourceView = sourceView;
            option_1.query = text_1;
        }
        else if (display) {
            text_1 = "= " + display.name;
        }
        option_1.children = [
            { c: "attribute-name", text: attribute },
            { c: "inline-cell", contentEditable: true, text: text_1, optionIx: ix, click: selectOptionIx, selected: option_1, keydown: defineKeys, postRender: focusSelected }
        ];
        options.push(option_1);
        ix++;
    }
    var option = { score: 1, action: defineAndEmbed, attribute: attribute, entity: entity };
    option.children = [
        { c: "attribute-name", text: attribute },
        { c: "inline-cell", contentEditable: true, selected: option, keydown: defineKeys, postRender: focusSelected }
    ];
    options.push(option);
    return options;
}
function modifyAndEmbed(elem, text, doEmbed) {
    var _a = elem.selected, eav = _a.eav, defineValue = _a.defineValue, params = _a.params, sourceView = _a.sourceView, query = _a.query;
    var success = submitAttribute({ currentTarget: { value: defineValue } }, { eav: eav, sourceView: sourceView, query: query });
    if (!success) {
        console.log("I don't know what to do");
    }
    // if you didn't remove all the attributes, just re-embed what was there
    if (app_1.eve.findOne("entity eavs", { entity: eav.entity, attribute: eav.attribute })) {
        doEmbed(text + "|" + stringifyParams(params));
    }
    else {
        // otherwise there's no point in embedding an error cell
        doEmbed("");
    }
}
function interpretAttributeValue(value) {
    var cleaned = value.trim();
    var isNumber = parseFloat(value);
    if (!isNumber) {
        //parse it
        cleaned = cleaned.trim();
        var entityId = asEntity(cleaned);
        if (entityId) {
            return { isValue: true, value: entityId };
        }
        var parsed = safeNLParse(cleaned);
        return { isValue: false, parse: parsed, value: cleaned };
    }
    else {
        return { isValue: true, value: utils_1.coerceInput(cleaned) };
    }
}
function handleAttributeDefinition(entity, attribute, search, chain) {
    if (!chain) {
        chain = app_1.dispatch();
    }
    var _a = interpretAttributeValue(search), isValue = _a.isValue, value = _a.value, parse = _a.parse;
    console.log("HANDLING", isValue, value, parse);
    if (isValue) {
        chain.dispatch("add sourced eav", { entity: entity, attribute: attribute, value: value }).commit();
    }
    else {
        var queryText = value.trim();
        // add the query
        app_1.dispatch("insert query", { query: queryText }).commit();
        // create another query that projects eavs
        var cleaned = queryText && queryText.trim().toLowerCase();
        var queryToId = app_1.eve.findOne("query to id", { query: cleaned });
        if (!queryToId)
            return false;
        var id = queryToId.id;
        var params = getCellParams(queryText, "");
        if (!params["field"]) {
            return false;
        }
        else {
            //build a query
            var eavProject = "(query :$$view \"" + entity + "|" + attribute + "|" + id + "\" (select \"" + id + "\" :" + params["field"].replace(" ", "-") + " value)\n      (project! \"generated eav\" :entity \"" + entity + "\" :attribute \"" + attribute + "\" :value value :source \"" + id + "\"))";
            chain.dispatch("insert implication", { query: eavProject }).commit();
        }
    }
    return true;
}
function defineAndEmbed(elem, text, doEmbed) {
    var selected = elem.selected;
    var entity = selected.entity, attribute = selected.attribute, defineValue = selected.defineValue;
    var success = handleAttributeDefinition(entity, attribute, defineValue);
    if (success) {
        doEmbed(text + "|rep=CSV;field=" + attribute);
    }
    else {
        console.error("Couldn't figure out subject of: " + defineValue);
        doEmbed(text + "|rep=error;message=I couldn't figure out the subject of that search;");
    }
}
function defineKeys(event, elem) {
    var cell = elem.selected.cell;
    if (event.keyCode === utils_1.KEYS.ENTER) {
        elem.selected.defineValue = event.currentTarget.textContent;
        event.preventDefault();
    }
    else if (event.keyCode === utils_1.KEYS.UP) {
        app_1.dispatch("moveCellAutocomplete", { cell: cell, direction: -1 }).commit();
    }
    else if (event.keyCode === utils_1.KEYS.DOWN) {
        app_1.dispatch("moveCellAutocomplete", { cell: cell, direction: 1 }).commit();
    }
    else if (event.keyCode === utils_1.KEYS.ESC) {
        app_1.dispatch("clearActiveCells").commit();
        if (elem.selected.paneId) {
            paneEditors[cell.editorId].cmInstance.focus();
        }
    }
}
function maybeActivateCell(cm, paneId) {
    if (!cm.somethingSelected()) {
        var pos = cm.getCursor("from");
        var marks = cm.findMarksAt(pos);
        var cell;
        for (var _i = 0; _i < marks.length; _i++) {
            var mark = marks[_i];
            var to = mark.find().to;
            if (mark.cell && to.ch === pos.ch) {
                cell = mark.cell;
                break;
            }
        }
        if (cell) {
            var query = cell.query.split("|")[0];
            app_1.dispatch("addActiveCell", { id: cell.id, cell: cell, query: query }).commit();
            return;
        }
    }
    return CodeMirror.Pass;
}
function maybeNavigate(cm, paneId) {
    if (!cm.somethingSelected()) {
        var pos = cm.getCursor("from");
        var marks = cm.findMarksAt(pos);
        var toClick;
        for (var _i = 0; _i < marks.length; _i++) {
            var mark = marks[_i];
            if (mark.cell) {
                toClick = mark;
            }
        }
        if (toClick) {
            // @HACK: there really should be a better way for me to find out
            // if there's a link in this cell and if it is what that link is
            // to.
            var link = toClick.widgetNode.querySelector(".link");
            if (link) {
                var elem = app_1.renderer.tree[link._id];
                var coords = cm.cursorCoords(true, "page");
                uitk_1.navigate({ clientX: coords.left, clientY: coords.top, preventDefault: function () { } }, elem);
            }
        }
    }
}
exports.activeCells = {};
app_1.handle("clearActiveCells", function (changes, info) {
    for (var cell in exports.activeCells) {
        changes.dispatch("removeActiveCell", exports.activeCells[cell]);
    }
});
app_1.handle("addActiveCell", function (changes, info) {
    changes.dispatch("clearActiveCells", {});
    var id = info.id;
    info.selected = 0;
    info.editorId = info.cell.editorId;
    exports.activeCells[id] = info;
});
app_1.handle("removeActiveCell", function (changes, info) {
    var id = info.id;
    delete exports.activeCells[id];
});
app_1.handle("setCellState", function (changes, info) {
    var active = exports.activeCells[info.id];
    active.selected = 0;
    active.state = info.state;
});
app_1.handle("updateActiveCell", function (changes, info) {
    var active = exports.activeCells[info.id];
    active.query = info.query;
    active.selected = 0;
    active.state = "query";
});
app_1.handle("moveCellAutocomplete", function (changes, info) {
    var active = exports.activeCells[info.cell.id];
    var direction = info.direction, value = info.value;
    if (value === undefined) {
        active.selected += direction;
    }
    else {
        active.selected = value;
    }
});
function updateActiveCell(event, elem) {
    var cell = elem.cell;
    app_1.dispatch("updateActiveCell", { id: cell.id, cell: cell, query: event.currentTarget.textContent }).commit();
}
function activateCell(event, elem) {
    var cell = elem.cell;
    var query = cell.query.split("|")[0];
    app_1.dispatch("addActiveCell", { id: cell.id, cell: cell, query: query }).commit();
    event.preventDefault();
}
function createEmbedPopout(cm, editorId) {
    cm.operation(function () {
        var from = cm.getCursor("from");
        var id = utils_1.uuid();
        cm.replaceRange("=", from, cm.getCursor("to"));
        var to = cm.getCursor("from");
        var fromIx = cm.indexFromPos(from);
        var toIx = cm.indexFromPos(to);
        var cell = { id: id, start: fromIx, length: toIx - fromIx, placeholder: true, query: "", editorId: editorId };
        app_1.dispatch("addActiveCell", { id: id, query: "", cell: cell, placeholder: true });
    });
}
function makeDoEmbedFunction(cm, mark, cell, paneId) {
    return function (value) {
        var _a = mark.find(), from = _a.from, to = _a.to;
        if (value[0] === "=") {
            value = value.substring(1);
        }
        value = value.trim();
        var _b = value.split("|"), text = _b[0], rawParams = _b[1];
        text = text.trim();
        // @TODO: this doesn't take disambiguations into account
        var entityId = asEntity(text);
        if (entityId) {
            text = entityId;
        }
        var replacement = "{" + text + "|" + (rawParams || "") + "}";
        if (text === "") {
            replacement = "";
        }
        if (cm.getRange(from, to) !== replacement) {
            cm.replaceRange(replacement, from, to);
        }
        paneEditors[cell.editorId].cmInstance.focus();
        var chain = app_1.dispatch("removeActiveCell", cell);
        if (replacement) {
            chain.dispatch("insert query", { query: text });
        }
        chain.commit();
    };
}
function embeddedCellKeys(event, elem) {
    var paneId = elem.paneId, cell = elem.cell;
    var target = event.currentTarget;
    var value = target.textContent;
    var editor = paneEditors[cell.editorId];
    var cm = editor.cmInstance;
    var mark = editor.marks[cell.id];
    if (event.keyCode === utils_1.KEYS.BACKSPACE && value === "") {
        var _a = mark.find(), from = _a.from, to = _a.to;
        cm.replaceRange("", from, to);
        paneEditors[cell.editorId].cmInstance.focus();
        app_1.dispatch("removeActiveCell", cell).commit();
        event.preventDefault();
    }
    else if (event.keyCode === utils_1.KEYS.ESC || (event.keyCode === utils_1.KEYS.ENTER && value.trim() === "")) {
        var _b = mark.find(), from = _b.from, to = _b.to;
        if (cell.placeholder) {
            cm.replaceRange("= ", from, to);
        }
        paneEditors[cell.editorId].cmInstance.focus();
        app_1.dispatch("removeActiveCell", cell).commit();
        event.preventDefault();
    }
    else if (event.keyCode === utils_1.KEYS.ENTER) {
        var doEmbed = makeDoEmbedFunction(cm, mark, cell, paneId);
        if (elem.selected && elem.selected.action) {
            if (typeof elem.selected.action === "function") {
                elem.selected.action(elem, value, doEmbed);
            }
        }
        event.preventDefault();
    }
    else if (event.keyCode === utils_1.KEYS.UP) {
        app_1.dispatch("moveCellAutocomplete", { cell: cell, direction: -1 }).commit();
        event.preventDefault();
    }
    else if (event.keyCode === utils_1.KEYS.DOWN) {
        app_1.dispatch("moveCellAutocomplete", { cell: cell, direction: 1 }).commit();
        event.preventDefault();
    }
    event.stopPropagation();
}
function updatePage(meta, content) {
    app_1.dispatch("update page", { page: meta.page, content: content }).commit();
}
//---------------------------------------------------------
// Editor prep
//---------------------------------------------------------
function prepareCardEditor(entityId, paneId) {
    var _a = (app_1.eve.findOne("entity", { entity: entityId }) || {}).content, content = _a === void 0 ? undefined : _a;
    var page = app_1.eve.findOne("entity page", { entity: entityId })["page"];
    var name = uitk.resolveName(entityId);
    var cells = getCells(content, paneId + "|" + entityId);
    var cellItems = cells.map(function (cell, ix) {
        var ui;
        var active = exports.activeCells[cell.id];
        if (active) {
            ui = cellEditor(entityId, paneId, active || cell);
        }
        else {
            ui = cellUI(paneId, cell.query, cell);
        }
        ui.id = paneId + "|" + cell.id;
        ui.postRender = reparentCell;
        ui["containerId"] = paneId + "|" + cell.id + "|container";
        ui["cell"] = cell;
        return ui;
    });
    var editorId = paneId + "|" + entityId;
    var keys = {
        "Backspace": function (cm) { return maybeActivateCell(cm, editorId); },
        "Cmd-Enter": function (cm) { return maybeNavigate(cm, editorId); },
        "=": function (cm) { return createEmbedPopout(cm, editorId); }
    };
    return { postRender: wikiEditor, onUpdate: updatePage, options: { keys: keys }, cells: cells, cellItems: cellItems };
}
//---------------------------------------------------------
// Page parsing
//---------------------------------------------------------
function getCells(content, editorId) {
    var cells = [];
    var ix = 0;
    var ids = {};
    for (var _i = 0, _a = content.split(/({[^]*?})/gm); _i < _a.length; _i++) {
        var part = _a[_i];
        if (part[0] === "{") {
            var id = part;
            if (!ids[part]) {
                ids[part] = 2;
            }
            else if (ids[part] >= 2) {
                id += ids[part];
                ids[part]++;
            }
            var placeholder = false;
            if (part.match(/\{\$\$.*\$\$\}/)) {
                placeholder = true;
            }
            cells.push({ start: ix, length: part.length, value: part, query: part.substring(1, part.length - 1), id: id, placeholder: placeholder, editorId: editorId });
        }
        ix += part.length;
    }
    for (var active in exports.activeCells) {
        var cell = exports.activeCells[active].cell;
        if (cell.placeholder && cell.editorId === editorId) {
            cells.push(cell);
        }
    }
    return cells;
}
//---------------------------------------------------------
// Attributes
//---------------------------------------------------------
app_1.handle("add entity attribute", function (changes, _a) {
    var entity = _a.entity, attribute = _a.attribute, value = _a.value;
    var success = handleAttributeDefinition(entity, attribute.trim(), value, changes);
});
app_1.handle("toggle add tile", function (changes, _a) {
    var key = _a.key, entityId = _a.entityId;
    var state = exports.uiState.widget.card[key] || { showAdd: false };
    state.showAdd = !state.showAdd;
    state.entityId = entityId;
    state.key = key;
    state.activeTile = undefined;
    // in case you closed it with an adder selected
    if (state.showAdd) {
        state.adder = undefined;
    }
    exports.uiState.widget.card[key] = state;
});
app_1.handle("set tile adder", function (changes, _a) {
    var key = _a.key, adder = _a.adder;
    var state = exports.uiState.widget.card[key] || { showAdd: true, key: key };
    state.adder = adder;
    exports.uiState.widget.card[key] = state;
});
app_1.handle("set tile adder attribute", function (changes, _a) {
    var key = _a.key, attribute = _a.attribute, value = _a.value, isActiveTileAttribute = _a.isActiveTileAttribute;
    var state = exports.uiState.widget.card[key] || { showAdd: true, key: key };
    if (!isActiveTileAttribute) {
        state[attribute] = value.trim();
    }
    else {
        state.activeTile[attribute] = value.trim();
    }
    exports.uiState.widget.card[key] = state;
});
app_1.handle("submit tile adder", function (changes, _a) {
    var key = _a.key, node = _a.node;
    var state = exports.uiState.widget.card[key] || { showAdd: true, key: key };
    if (state.adder && state.adder.submit) {
        state.adder.submit(state.adder, state, node);
    }
    exports.uiState.widget.card[key] = state;
});
app_1.handle("activate tile", function (changes, _a) {
    var tileId = _a.tileId, cardId = _a.cardId;
    var state = exports.uiState.widget.card[cardId] || { showAdd: false, key: cardId };
    if (tileId && (!state.activeTile || state.activeTile.id !== tileId)) {
        state.activeTile = { id: tileId };
    }
    else if (!tileId) {
        state.activeTile = undefined;
    }
    exports.uiState.widget.card[cardId] = state;
});
function activateTile(event, elem) {
    if (event.defaultPrevented)
        return;
    app_1.dispatch("activate tile", { tileId: elem.tileId, cardId: elem.cardId }).commit();
}
function submitActiveTile(event, elem) {
    if (elem.source) {
        // replace
        app_1.dispatch("replace sourced tile", { key: elem.cardId, source: elem.source, attribute: elem.attribute, entityId: elem.entityId }).commit();
    }
    else {
        // handle a list submit
        app_1.dispatch("submit list tile", { cardId: elem.cardId, attribute: elem.attribute, entityId: elem.entityId, reverseEntityAndValue: elem.reverseEntityAndValue }).commit();
    }
    event.preventDefault();
}
function removeActiveTile(event, elem) {
    if (elem.source) {
        app_1.dispatch("remove sourced eav", { source: elem.source }).commit();
    }
    else {
        console.error("Tried to remove a tile without a source. What do we do?");
    }
    event.preventDefault();
}
function tile(elem) {
    var cardId = elem.cardId, tileId = elem.tileId, active = elem.active, attribute = elem.attribute, entityId = elem.entityId, source = elem.source, reverseEntityAndValue = elem.reverseEntityAndValue;
    var klass = (elem.c || "") + " tile";
    if (active) {
        klass += " active";
    }
    elem.c = klass;
    // elem.click = activateTile;
    elem.children = [
        { c: "tile-content-wrapper", children: elem.children },
        { c: "edit ion-edit", click: activateTile, cardId: cardId, tileId: tileId, entityId: entityId, source: source },
        { c: "controls", children: [
                !elem.removeOnly ? { c: "ion-checkmark submit", click: submitActiveTile, cardId: cardId, attribute: attribute, entityId: entityId, source: source, reverseEntityAndValue: reverseEntityAndValue } : undefined,
                !elem.submitOnly ? { c: "ion-backspace cancel", click: removeActiveTile, cardId: cardId, attribute: attribute, entityId: entityId, source: source } : undefined,
            ] }
    ];
    return elem;
}
function isTileActive(cardId, tileId) {
    var state = exports.uiState.widget.card[cardId];
    return state && state.activeTile && state.activeTile.id === tileId;
}
app_1.handle("toggle active tile item", function (changes, _a) {
    var cardId = _a.cardId, attribute = _a.attribute, id = _a.id;
    var state = exports.uiState.widget.card[cardId] || { showAdd: true, key: cardId, activeTile: {} };
    if (!state.activeTile[attribute]) {
        state.activeTile[attribute] = {};
    }
    var cur = state.activeTile[attribute][id];
    if (cur) {
        delete state.activeTile[attribute][id];
    }
    else {
        state.activeTile[attribute][id] = true;
    }
    exports.uiState.widget.card[cardId] = state;
});
app_1.handle("submit list tile", function (changes, _a) {
    var cardId = _a.cardId, attribute = _a.attribute, entityId = _a.entityId, reverseEntityAndValue = _a.reverseEntityAndValue;
    var state = exports.uiState.widget.card[cardId] || { activeTile: {} };
    var _b = state.activeTile, itemsToRemove = _b.itemsToRemove, itemsToAdd = _b.itemsToAdd;
    if (itemsToRemove) {
        for (var source in itemsToRemove) {
            changes.remove("sourced eav", { source: source });
        }
    }
    if (itemsToAdd) {
        for (var _i = 0; _i < itemsToAdd.length; _i++) {
            var value = itemsToAdd[_i];
            if (value === "" || value === undefined)
                continue;
            if (!reverseEntityAndValue) {
                changes.dispatch("add sourced eav", { entity: entityId, attribute: attribute, value: value.trim(), forceEntity: true });
            }
            else {
                var cleaned = value.trim();
                var entityValue = asEntity(cleaned);
                if (!entityValue) {
                    //create an entity with that name
                    entityValue = utils_1.uuid();
                    var pageId = utils_1.uuid();
                    changes.dispatch("create page", { page: pageId, content: "" })
                        .dispatch("create entity", { entity: entityValue, name: cleaned, page: pageId });
                }
                changes.dispatch("add sourced eav", { entity: entityValue, attribute: attribute, value: entityId });
            }
        }
    }
    changes.dispatch("activate tile", { cardId: cardId });
});
function toggleListTileItem(event, elem) {
    app_1.dispatch("toggle active tile item", { cardId: elem.cardId, attribute: elem.storeAttribute, id: elem.storeId }).commit();
    event.preventDefault();
}
app_1.handle("add active tile item", function (changes, _a) {
    var cardId = _a.cardId, attribute = _a.attribute, id = _a.id, value = _a.value, tileId = _a.tileId;
    var state = exports.uiState.widget.card[cardId] || { showAdd: true, key: cardId, activeTile: { id: tileId } };
    if (!state.activeTile) {
        state.activeTile = { id: tileId };
    }
    if (!state.activeTile[attribute]) {
        state.activeTile[attribute] = [];
    }
    var cur = state.activeTile[attribute][id];
    state.activeTile[attribute][id] = value;
    exports.uiState.widget.card[cardId] = state;
});
function autosizeAndStoreListTileItem(event, elem) {
    var node = event.currentTarget;
    app_1.dispatch("add active tile item", { cardId: elem.cardId, attribute: elem.storeAttribute, tileId: elem.tileId, id: elem.storeId, value: node.value }).commit();
    uitk.autosizeInput(node, elem);
}
function listTile(elem) {
    var values = elem.values, data = elem.data, tileId = elem.tileId, attribute = elem.attribute, cardId = elem.cardId, entityId = elem.entityId, forceActive = elem.forceActive, reverseEntityAndValue = elem.reverseEntityAndValue, noProperty = elem.noProperty, _a = elem.rep, rep = _a === void 0 ? "value" : _a, _b = elem.c, klass = _b === void 0 ? "" : _b;
    tileId = tileId || attribute;
    var state = exports.uiState.widget.card[cardId] || {};
    var active = forceActive || isTileActive(cardId, tileId);
    var listChildren = [];
    var max = 0;
    for (var _i = 0; _i < values.length; _i++) {
        var value = values[_i];
        var current = reverseEntityAndValue ? value.eav.entity : value.eav.value;
        if (uitk.resolveName(current) === "entity" && attribute === "is a")
            continue;
        var source = value.source;
        var valueElem = { c: "value", data: data, value: current, autolink: !active };
        if (rep === "externalImage") {
            valueElem.url = current;
            valueElem.text = undefined;
        }
        var ui = { c: "value-wrapper", data: data, children: [uitk[rep](valueElem)] };
        if (active) {
            ui["cardId"] = cardId;
            ui["storeAttribute"] = "itemsToRemove";
            ui["storeId"] = source;
            ui.click = toggleListTileItem;
            if (state.activeTile.itemsToRemove && state.activeTile.itemsToRemove[source]) {
                ui.c = (ui.c || "") + " marked-to-remove";
            }
        }
        listChildren.push(ui);
    }
    if (active) {
        var added = (state.activeTile ? state.activeTile.itemsToAdd : false) || [];
        var ix = 0;
        for (var _c = 0; _c < added.length; _c++) {
            var add = added[_c];
            listChildren.push({ c: "value", children: [
                    { t: "input", placeholder: "add", value: add, attribute: attribute, entityId: entityId, storeAttribute: "itemsToAdd", storeId: ix, cardId: cardId, input: autosizeAndStoreListTileItem, postRender: uitk.autosizeAndFocus, keydown: handleTileKeys, reverseEntityAndValue: reverseEntityAndValue }
                ] });
            ix++;
        }
        listChildren.push({ c: "value", children: [
                { t: "input", placeholder: "add", value: "", attribute: attribute, entityId: entityId, storeAttribute: "itemsToAdd", storeId: ix, cardId: cardId, input: autosizeAndStoreListTileItem, postRender: ix === 0 ? uitk.autosizeAndFocus : uitk.autosizeInput, keydown: handleTileKeys, reverseEntityAndValue: reverseEntityAndValue }
            ] });
    }
    var tileChildren = [];
    var isIsA = attribute === "is a";
    if (!noProperty) {
        tileChildren.push({ c: "property", text: isIsA ? "tags" : attribute });
    }
    tileChildren.push({ c: "list", children: listChildren });
    var size = isIsA ? "is a" : "full";
    return tile({ c: klass + " " + size, size: size, cardId: cardId, data: data, tileId: tileId, active: active, attribute: attribute, entityId: entityId, reverseEntityAndValue: reverseEntityAndValue, submitOnly: true, children: tileChildren });
}
exports.listTile = listTile;
function autosizeTextarea(node, elem) {
    node.style.height = "1px";
    node.style.height = 1 + node.scrollHeight + "px";
}
function autosizeAndFocusTextArea(node, elem) {
    utils_1.autoFocus(node, elem);
    autosizeTextarea(node, elem);
}
function storeActiveTileValue(elem, value) {
    app_1.dispatch("set tile adder attribute", { key: elem.cardId, attribute: elem.storeAttribute, value: value, isActiveTileAttribute: true }).commit();
}
app_1.handle("replace sourced tile", function (changes, _a) {
    var key = _a.key, attribute = _a.attribute, entityId = _a.entityId, source = _a.source;
    var state = exports.uiState.widget.card[key] || { activeTile: {} };
    var replaceValue = state.activeTile.replaceValue;
    var sourced = app_1.eve.findOne("sourced eav", { source: source });
    if (!sourced) {
        console.error("Tried to modify a sourced eav that doesn't exist?");
        return;
    }
    if (replaceValue !== undefined && sourced.value !== replaceValue.trim()) {
        changes.remove("sourced eav", { source: source });
        if (attribute === "description") {
            replaceValue = "\"" + replaceValue.replace(/\"/g, '\\"') + "\"";
        }
        changes.dispatch("add sourced eav", { entity: entityId, attribute: attribute, value: replaceValue, forceEntity: true });
    }
    changes.dispatch("activate tile", { cardId: key });
});
function handleTileKeys(event, elem) {
    if (event.keyCode === utils_1.KEYS.ENTER) {
        if (elem.source) {
            app_1.dispatch("replace sourced tile", { key: elem.cardId, source: elem.source, attribute: elem.attribute, entityId: elem.entityId }).commit();
        }
        else {
            app_1.dispatch("submit list tile", { cardId: elem.cardId, attribute: elem.attribute, entityId: elem.entityId, reverseEntityAndValue: elem.reverseEntityAndValue }).commit();
        }
        event.preventDefault();
    }
    else if (event.keyCode === utils_1.KEYS.ESC) {
        app_1.dispatch("activate tile", { cardId: elem.cardId }).commit();
    }
}
function autosizeAndStoreTextarea(event, elem) {
    var node = event.currentTarget;
    storeActiveTileValue(elem, node.value);
    autosizeTextarea(node, elem);
}
function textTile(elem) {
    var value = elem.value, data = elem.data, attribute = elem.attribute, cardId = elem.cardId, entityId = elem.entityId;
    var tileId = value.source;
    var source = value.source;
    var state = exports.uiState.widget.card[cardId] || {};
    var active = isTileActive(cardId, tileId);
    var tileChildren = [];
    if (attribute !== "description") {
        tileChildren.push({ c: "property", text: attribute });
    }
    if (!active) {
        tileChildren.push({ c: "value text", text: value.eav.value });
    }
    else {
        tileChildren.push({ t: "textarea", c: "value text", source: source, attribute: attribute, storeAttribute: "replaceValue", cardId: cardId, entityId: entityId,
            keydown: handleTileKeys, input: autosizeAndStoreTextarea, postRender: autosizeAndFocusTextArea, value: value.eav.value });
    }
    return tile({ c: "full", tileId: tileId, cardId: cardId, entityId: entityId, attribute: attribute, source: source, active: active, children: tileChildren });
}
function autosizeAndStoreInput(event, elem) {
    var node = event.currentTarget;
    storeActiveTileValue(elem, node.value);
    uitk.autosizeInput(node, elem);
}
function valueTile(elem) {
    var value = elem.value, data = elem.data, attribute = elem.attribute, cardId = elem.cardId, entityId = elem.entityId;
    var tileId = attribute;
    var source = value.source;
    var state = exports.uiState.widget.card[cardId] || {};
    var active = isTileActive(cardId, tileId);
    var tileChildren = [];
    tileChildren.push({ c: "property", text: attribute });
    var ui;
    var content = uitk.resolveName(value.eav.value);
    if (!content)
        content = value.eav.value;
    if (!active) {
        ui = uitk.value({ c: "value", data: data, value: value.eav.value });
    }
    else {
        ui = { t: "input", c: "value", source: source, attribute: attribute, storeAttribute: "replaceValue", cardId: cardId, entityId: entityId, value: content, postRender: uitk.autosizeAndFocus,
            input: autosizeAndStoreInput, keydown: handleTileKeys };
    }
    var max = Math.max(content.toString().length, 0);
    tileChildren.push({ c: "value", children: [ui] });
    var size;
    if (max <= 8) {
        size = "small";
    }
    else if (max <= 16) {
        size = "medium";
    }
    else {
        size = "full";
    }
    var klass = size;
    if (!value.isManual) {
        klass += " computed";
    }
    return tile({ c: klass, size: size, cardId: cardId, data: data, tileId: tileId, active: active, attribute: attribute, source: source, entityId: entityId, children: tileChildren });
}
function imageTile(elem) {
    var values = elem.values, data = elem.data, attribute = elem.attribute, cardId = elem.cardId, entityId = elem.entityId;
    var ui;
    if (values.length > 1) {
        elem.rep = "externalImage";
        elem.noProperty = true;
        elem.c = "image ";
        ui = listTile(elem);
    }
    else {
        var value = values[0];
        var source = value.source;
        var size = "full";
        var klass = "image full";
        var tileId = attribute;
        var tileChildren = [{ t: "img", c: "image", src: "" + value.eav.value }];
        var active = isTileActive(cardId, tileId);
        ui = tile({ c: klass, size: size, cardId: cardId, data: data, tileId: tileId, active: active, attribute: attribute, source: source, entityId: entityId, children: tileChildren });
    }
    return ui;
}
function documentTile(elem) {
    var value = elem.value, data = elem.data, attribute = elem.attribute, cardId = elem.cardId, entityId = elem.entityId;
    var tileChildren = [];
    var tileId = attribute;
    var source = value.source;
    var state = exports.uiState.widget.card[cardId] || {};
    var active = isTileActive(cardId, tileId);
    var size = "full";
    var klass = "document full";
    return tile({ c: klass, size: size, cardId: cardId, data: data, tileId: tileId, active: active, attribute: attribute, source: source, entityId: entityId, children: tileChildren });
}
function row(elem) {
    elem.c = (elem.c || "") + " row flex-row";
    return elem;
}
function getEAVInfo(eav) {
    var entity = eav.entity, attribute = eav.attribute, value = eav.value;
    var found = app_1.eve.findOne("generated eav", { entity: entity, attribute: attribute, value: value });
    var sourceId = app_1.eve.findOne("sourced eav", { entity: entity, attribute: attribute, value: value });
    var item = { eav: eav, isManual: !found };
    if (found) {
        item.sourceView = found.source;
        item.source = found.source;
    }
    else if (sourceId) {
        item.source = sourceId.source;
    }
    return item;
}
function entityTilesUI(entityId, paneId, cardId) {
    var eavs = app_1.eve.find("entity eavs", { entity: entityId });
    var items = {};
    var attrs = [];
    for (var _i = 0; _i < eavs.length; _i++) {
        var eav = eavs[_i];
        var attribute = eav.attribute;
        var info = getEAVInfo(eav);
        if (!items[attribute]) {
            items[attribute] = [];
            attrs.push(attribute);
        }
        items[attribute].push(info);
    }
    var tiles = { "small": [], "medium": [], "full": [], "is a": [] };
    var rows = [];
    var data = { paneId: paneId, entityId: entityId };
    if (items["image"]) {
        var values = items["image"];
        var tile_1 = imageTile({ values: values, data: data, cardId: cardId, entityId: entityId, attribute: "image" });
        rows.push(row({ children: [tile_1] }));
        delete items["image"];
    }
    if (items["description"]) {
        var values = items["description"];
        for (var _a = 0; _a < values.length; _a++) {
            var value = values[_a];
            var tile_2 = textTile({ value: value, data: data, cardId: cardId, entityId: entityId, attribute: "description" });
            rows.push(row({ children: [tile_2] }));
        }
        delete items["description"];
    }
    if (app_1.eve.findOne("collection", { collection: entityId }) || app_1.eve.findOne("entity eavs", { entity: entityId, attribute: "is a", value: asEntity("collection") })) {
        var listChildren = [];
        var entities = app_1.eve.find("entity eavs", { attribute: "is a", value: entityId });
        var values = entities.map(getEAVInfo);
        var tile_3 = listTile({ values: values, data: data, cardId: cardId, entityId: entityId, attribute: "is a", reverseEntityAndValue: true, tileId: "_collectionItems", noProperty: true });
        rows.push(row({ children: [tile_3] }));
    }
    var tilesToPlace = 0;
    for (var _b = 0; _b < attrs.length; _b++) {
        var attribute = attrs[_b];
        var values = items[attribute];
        if (!values)
            continue;
        var newTile = void 0;
        if (values.length > 1 || attribute === "is a") {
            newTile = listTile({ values: values, data: data, attribute: attribute, cardId: cardId, entityId: entityId });
        }
        else {
            newTile = valueTile({ value: values[0], data: data, attribute: attribute, cardId: cardId, entityId: entityId });
        }
        var size = newTile.size;
        tiles[size].push(newTile);
        if (size !== "is a")
            tilesToPlace++;
    }
    var optionIx = 0;
    while (tilesToPlace > 0) {
        var rowChildren = [];
        var iter = 0;
        while (iter < 5 && !rowChildren.length) {
            if (optionIx === 0 && tiles["full"].length) {
                rowChildren.push(tiles["full"].pop());
                break;
            }
            if (optionIx === 1 && tiles["medium"].length > 1) {
                rowChildren.push(tiles["medium"].pop());
                rowChildren.push(tiles["medium"].pop());
                break;
            }
            if (optionIx === 2 && tiles["medium"].length && tiles["small"].length >= 1) {
                rowChildren.push(tiles["medium"].pop());
                rowChildren.push(tiles["small"].pop());
                break;
            }
            if (optionIx === 3 && tiles["small"].length >= 3) {
                rowChildren.push(tiles["small"].pop());
                rowChildren.push(tiles["small"].pop());
                rowChildren.push(tiles["small"].pop());
                break;
            }
            if (optionIx === 4 && tiles["medium"].length) {
                rowChildren.push(tiles["medium"].pop());
                break;
            }
            if (optionIx > 4)
                optionIx = 0;
            else
                optionIx++;
            iter++;
        }
        // any smalls leftover
        if (!rowChildren.length) {
            while (tiles["small"].length) {
                rowChildren.push(tiles["small"].pop());
            }
        }
        tilesToPlace -= rowChildren.length;
        rows.push({ c: "flex-row row", children: rowChildren });
    }
    if (tiles["is a"]) {
        rows.push({ c: "flex-row row", children: [tiles["is a"][0]] });
    }
    var state = exports.uiState.widget.attributes[entityId] || {};
    return { c: "tile-scroll", children: [{ c: "tiles", children: rows }] };
}
exports.entityTilesUI = entityTilesUI;
function attributesUIAutocompleteOptions(isEntity, parsed, text, params, entityId) {
    var options = [];
    //there are two possible things either we're creating a page
    // or we need to pick what field of the result we want
    return options;
}
app_1.handle("setActiveAttribute", function (changes, _a) {
    var eav = _a.eav, sourceView = _a.sourceView;
    if (!exports.uiState.widget.attributes[eav.entity]) {
        exports.uiState.widget.attributes[eav.entity] = {};
    }
    var cur = exports.uiState.widget.attributes[eav.entity];
    cur.active = eav;
    cur.sourceView = sourceView;
});
app_1.handle("clearActiveAttribute", function (changes, _a) {
    var entity = _a.entity;
    var cur = exports.uiState.widget.attributes[entity];
    if (cur) {
        cur.active = false;
        cur.sourceView = false;
    }
});
function removeSubItem(event, elem) {
    event.preventDefault();
    submitAttribute(event, elem);
}
function setActiveAttribute(event, elem) {
    if (!event.defaultPrevented) {
        app_1.dispatch("setActiveAttribute", { eav: elem.eav, sourceView: elem.sourceView }).commit();
        event.preventDefault();
    }
}
function handleAttributesKey(event, elem) {
    if (event.keyCode === utils_1.KEYS.ENTER && elem.submit) {
        elem.submit(event, elem);
    }
    else if (event.keyCode === utils_1.KEYS.ESC) {
        app_1.dispatch("setActiveAttribute", { eav: { entity: elem.eav.entity }, sourceView: false }).commit();
    }
}
app_1.handle("setAttributeAdder", function (changes, _a) {
    var entityId = _a.entityId, field = _a.field, value = _a.value;
    var cur = exports.uiState.widget.attributes[entityId];
    if (!exports.uiState.widget.attributes[entityId]) {
        cur = exports.uiState.widget.attributes[entityId] = {};
    }
    cur[field] = value;
});
function setAdder(event, elem) {
    var value = event.currentTarget.value;
    app_1.dispatch("setAttributeAdder", { entityId: elem.entityId, field: elem.field, value: value }).commit();
}
function submitAdder(event, elem) {
    var entityId = elem.entityId;
    var state = exports.uiState.widget.attributes[entityId];
    if (!state)
        return;
    var adderAttribute = state.adderAttribute, adderValue = state.adderValue;
    var success = false;
    if (adderAttribute && adderValue) {
        var chain = app_1.dispatch("setAttributeAdder", { entityId: entityId, field: "adderAttribute", value: "" })
            .dispatch("setAttributeAdder", { entityId: entityId, field: "adderValue", value: "" });
        success = handleAttributeDefinition(entityId, adderAttribute, adderValue, chain);
    }
    //make sure the focus ends up back in the property input
    event.currentTarget.parentNode.firstChild.focus();
    return success;
}
app_1.handle("remove attribute generating query", function (changes, _a) {
    var eav = _a.eav, view = _a.view;
    var queryId = eav.entity + "|" + eav.attribute + "|" + view;
    app_1.eve.removeView(queryId);
    changes.merge(runtime_1.Query.remove(queryId, app_1.eve));
    //find all the unions this was used with
    for (var _i = 0, _b = app_1.eve.find("action source", { "source view": queryId }); _i < _b.length; _i++) {
        var source = _b[_i];
        var action = source.action;
        changes.remove("action", { action: action });
        changes.remove("action mapping", { action: action });
        changes.remove("action mapping constant", { action: action });
    }
    changes.remove("action source", { source: queryId });
});
function submitAttribute(event, elem) {
    var eav = elem.eav, sourceView = elem.sourceView, query = elem.query;
    var chain = app_1.dispatch("clearActiveAttribute", { entity: eav.entity });
    var value = event.currentTarget.value;
    if (query !== undefined && value === query) {
        return chain.commit();
    }
    if (elem.sourceView !== undefined) {
        //remove the previous source
        chain.dispatch("remove attribute generating query", { eav: eav, view: sourceView });
    }
    else {
        //remove the previous eav
        var fact = utils_1.copy(eav);
        fact.__id = undefined;
        chain.dispatch("remove entity attribute", fact);
    }
    if (value !== undefined && value !== "") {
        return handleAttributeDefinition(eav.entity, eav.attribute, value, chain);
    }
    else {
        chain.commit();
    }
}
//---------------------------------------------------------
// Wiki Widgets
//---------------------------------------------------------
function searchInput(paneId, value) {
    var state = exports.uiState.widget.search[paneId] || { focused: false, plan: false };
    var name = state.value;
    if (!state.value)
        state.value = name;
    var display = app_1.eve.findOne("display name", { id: name });
    if (display)
        name = display.name;
    return {
        c: "flex-grow wiki-search-wrapper",
        children: [
            { c: "controls", children: [
                    // {c: `ion-ios-arrow-${state.plan ? 'up' : 'down'} plan`, click: toggleSearchPlan, paneId},
                    // while technically a button, we don't need to do anything as clicking it will blur the editor
                    // which will execute the search
                    { c: "ion-android-search visible", paneId: paneId, click: focusOrSetSearch }
                ] },
            codeMirrorElement({
                c: "flex-grow wiki-search-input " + (state.focused ? "selected" : ""),
                paneId: paneId,
                autoFocus: true,
                value: name,
                focus: focusSearch,
                // blur: setSearch,
                cursorPosition: "end",
                change: updateSearch,
                shortcuts: { "Enter": setSearch }
            }),
        ]
    };
}
exports.searchInput = searchInput;
;
function focusSearch(event, elem) {
    app_1.dispatch("ui focus search", elem).commit();
}
function setSearch(event, elem) {
    var state = exports.uiState.widget.search[elem.paneId] || { value: "" };
    var value = event.value !== undefined ? event.value : state.value;
    var pane = app_1.eve.findOne("ui pane", { pane: elem.paneId });
    if (!pane || pane.contains !== event.value) {
        var _a = dispatchSearchSetAttributes(value), chain = _a.chain, isSetSearch = _a.isSetSearch;
        if (isSetSearch) {
            chain.dispatch("ui update search", { paneId: elem.paneId, value: pane.contains });
            chain.commit();
        }
        else {
            chain.dispatch("insert query", { query: value })
                .dispatch("set pane", { paneId: elem.paneId, contains: value })
                .commit();
        }
    }
}
function focusOrSetSearch(event, elem) {
    var target = document.querySelector(".wiki-search-input");
    var cm = target["cm"];
    var state = exports.uiState.widget.search[elem.paneId] || { value: "" };
    var rawVal = cm.getDoc().getValue();
    var value = rawVal !== undefined ? rawVal : state.value;
    var pane = app_1.eve.findOne("ui pane", { pane: elem.paneId });
    if (!pane || pane.contains !== (asEntity(value) || value)) {
        var _a = dispatchSearchSetAttributes(value), chain = _a.chain, isSetSearch = _a.isSetSearch;
        chain.dispatch("insert query", { query: value })
            .dispatch("set pane", { paneId: elem.paneId, contains: value })
            .commit();
    }
    else {
        cm.focus();
    }
}
function updateSearch(event, elem) {
    app_1.dispatch("ui update search", { paneId: elem.paneId, value: event.value }).commit();
}
function toggleSearchPlan(event, elem) {
    app_1.dispatch("ui toggle search plan", elem).commit();
}
;
function codeMirrorElement(elem) {
    elem.postRender = codeMirrorPostRender(elem.postRender);
    elem["cmChange"] = elem.change;
    elem["cmBlur"] = elem.blur;
    elem["cmFocus"] = elem.focus;
    elem.change = undefined;
    elem.blur = undefined;
    elem.focus = undefined;
    return elem;
}
exports.codeMirrorElement = codeMirrorElement;
var _codeMirrorPostRenderMemo = {};
function handleCMEvent(handler, elem) {
    return function (cm) {
        var evt = (new CustomEvent("CMEvent"));
        evt.editor = cm;
        evt.value = cm.getDoc().getValue();
        handler(evt, elem);
    };
}
function codeMirrorPostRender(postRender) {
    var key = postRender ? postRender.toString() : "";
    if (_codeMirrorPostRenderMemo[key])
        return _codeMirrorPostRenderMemo[key];
    return _codeMirrorPostRenderMemo[key] = function (node, elem) {
        var cm = node.cm;
        if (!cm) {
            var extraKeys = {};
            if (elem.shortcuts) {
                for (var shortcut in elem.shortcuts)
                    extraKeys[shortcut] = handleCMEvent(elem.shortcuts[shortcut], elem);
            }
            cm = node.cm = CodeMirror(node, {
                lineWrapping: elem.lineWrapping !== false ? true : false,
                lineNumbers: elem.lineNumbers,
                mode: elem.mode || "text",
                extraKeys: extraKeys
            });
            if (elem["cmChange"])
                cm.on("change", handleCMEvent(elem["cmChange"], elem));
            if (elem["cmBlur"])
                cm.on("blur", handleCMEvent(elem["cmBlur"], elem));
            if (elem["cmFocus"])
                cm.on("focus", handleCMEvent(elem["cmFocus"], elem));
            if (elem.autoFocus)
                cm.focus();
        }
        if (cm.getDoc().getValue() !== elem.value) {
            cm.setValue(elem.value || "");
            if (elem["cursorPosition"] === "end") {
                cm.setCursor(100000);
            }
        }
        if (postRender)
            postRender(node, elem);
    };
}
function getEntitiesFromResults(results, _a) {
    var _b = (_a === void 0 ? {} : _a).fields, fields = _b === void 0 ? ["entity"] : _b;
    var entities = [];
    if (!results.length)
        return entities;
    for (var _i = 0; _i < fields.length; _i++) {
        var field = fields[_i];
        if (results[0][field] === undefined)
            field = utils_1.builtinId(field);
        for (var _c = 0; _c < results.length; _c++) {
            var fact = results[_c];
            entities.push(fact[field]);
        }
    }
    return entities;
}
function getURLsFromResults(results, _a) {
    var _b = (_a === void 0 ? {} : _a).fields, fields = _b === void 0 ? ["url"] : _b;
    var urls = [];
    if (!results.length)
        return urls;
    for (var _i = 0; _i < fields.length; _i++) {
        var field = fields[_i];
        if (results[0][field] === undefined)
            field = utils_1.builtinId(field);
        for (var _c = 0; _c < results.length; _c++) {
            var fact = results[_c];
            if (urlRegex.exec(fact[field]))
                urls.push(fact[field]);
        }
    }
    return urls;
}
function prepareEntity(results, params) {
    var elem = {};
    var entities = getEntitiesFromResults(results, { fields: params.field ? [params.field] : undefined });
    var elems = [];
    for (var _i = 0; _i < entities.length; _i++) {
        var entity = entities[_i];
        var elem_1 = utils_1.copy(params);
        elem_1.entity = entity;
        elems.push(elem_1);
    }
    if (elems.length === 1)
        return elems[0];
    else
        return elems;
}
function prepareURL(results, params) {
    var elem = {};
    var urls = getURLsFromResults(results, { fields: params.field ? [params.field] : undefined });
    var elems = [];
    for (var _i = 0; _i < urls.length; _i++) {
        var url = urls[_i];
        var elem_2 = utils_1.copy(params);
        elem_2.url = url;
        elems.push(elem_2);
    }
    if (elems.length === 1)
        return elems[0];
    else
        return elems;
}
var _prepare = {
    name: prepareEntity,
    link: prepareEntity,
    attributes: prepareEntity,
    related: prepareEntity,
    index: prepareEntity,
    view: prepareEntity,
    results: prepareEntity,
    value: function (results, params) {
        if (!params.field)
            throw new Error("Value representation requires a 'field' param indicating which field to represent");
        var field = params.field;
        if (!results.length)
            return [];
        // If field isn't in results, try to resolve it as a field name, otherwise error out
        if (results[0][field] === undefined) {
            var neueField = asEntity(field);
            if (!neueField)
                throw new Error("Unable to uniquely resolve field name " + field + " in result fields " + Object.keys(results[0]));
            else
                field = neueField;
        }
        var elems = [];
        for (var _i = 0; _i < results.length; _i++) {
            var row_1 = results[_i];
            elems.push({ text: row_1[field], data: params.data });
        }
        return elems;
    },
    CSV: function (results, params) {
        if (!params.field)
            throw new Error("Value representation requires a 'field' param indicating which field to represent");
        var field = params.field;
        if (!results.length)
            return [];
        // If field isn't in results, try to resolve it as a field name, otherwise error out
        if (results[0][field] === undefined) {
            var neueField = asEntity(field);
            if (!neueField)
                throw new Error("Unable to uniquely resolve field name " + field + " in result fields " + Object.keys(results[0]));
            else
                field = neueField;
        }
        var values = [];
        for (var _i = 0; _i < results.length; _i++) {
            var row_2 = results[_i];
            values.push(row_2[field]);
        }
        return { values: values, data: params.data };
    },
    result: function (results, params) {
        var elem = _prepare["CSV"](results, params);
        elem.search = params["search"];
        return elem;
    },
    entity: function (results, params) {
        var entities = [];
        var firstResult = results[0];
        var fields = Object.keys(firstResult).filter(function (field) {
            return !!asEntity(firstResult[field]);
        });
        for (var _i = 0; _i < results.length; _i++) {
            var result = results[_i];
            for (var _a = 0; _a < fields.length; _a++) {
                var field = fields[_a];
                var entityId = result[field];
                var paneId = params["paneId"];
                var editor = prepareCardEditor(entityId, paneId);
                entities.push({ entity: result[field], data: params, editor: editor });
            }
        }
        return entities;
    },
    error: function (results, params) {
        return { text: params["message"] };
    },
    mappedTable: function (results, params) {
        var paneId = params.paneId || params.data && params.data.paneId;
        var key = paneId + "|" + params.search;
        var state = exports.uiState.widget.table[key];
        if (!state) {
            state = exports.uiState.widget.table[key] = { sortField: undefined, sortDirection: 1, adders: [{}], changes: [] };
        }
        params["sortable"] = true;
        params["rows"] = results;
        params["state"] = state;
        return params;
    },
    table: function (results, params) {
        var paneId = params.paneId || params.data && params.data.paneId;
        var key = paneId + "|" + params.search;
        var state = exports.uiState.widget.table[key];
        if (!state) {
            state = exports.uiState.widget.table[key] = { sortField: undefined, sortDirection: 1 };
        }
        params["rows"] = results;
        params["state"] = state;
        return params;
        //return {rows: results, fields, state, groups: groupings, sortable: true, data: params.data};
    },
    directory: function (results, params) {
        //let entities = getEntitiesFromResults(results, {fields: params.field ? [params.field] : undefined});
        var entities = [utils_1.builtinId("entity")];
        if (entities.length === 1) {
            var collection = entities[0];
            entities.length = 0;
            for (var _i = 0, _a = app_1.eve.find("is a attributes", { collection: collection }); _i < _a.length; _i++) {
                var fact = _a[_i];
                entities.push(fact.entity);
            }
        }
        return { entities: entities, data: params.data };
    },
    externalLink: prepareURL,
    externalImage: prepareURL,
    externalVideo: prepareURL,
    embeddedCell: function (results, params) {
        var rep = params["childRep"];
        var childInfo;
        if (_prepare[rep]) {
            params["data"] = params["data"] || params;
            childInfo = _prepare[rep](results, params);
            childInfo.data = childInfo.data || params;
        }
        else {
            childInfo = { data: params };
        }
        return { childInfo: childInfo, rep: rep, click: activateCell, cell: params["cell"] };
    },
};
function represent(search, rep, results, params, wrapEach) {
    if (rep in _prepare) {
        var embedParamSets = _prepare[rep](results && results.results, params);
        var isArray = embedParamSets && embedParamSets.constructor === Array;
        try {
            if (!embedParamSets || isArray && embedParamSets.length === 0) {
                return uitk.error({ text: search + " as " + rep });
            }
            else if (embedParamSets.constructor === Array) {
                var wrapper = { c: "flex-column", children: [] };
                var ix = 0;
                for (var _i = 0; _i < embedParamSets.length; _i++) {
                    var embedParams = embedParamSets[_i];
                    embedParams["data"] = embedParams["data"] || params;
                    if (wrapEach)
                        wrapper.children.push(wrapEach(uitk[rep](embedParams), ix++));
                    else
                        wrapper.children.push(uitk[rep](embedParams));
                }
                return wrapper;
            }
            else {
                var embedParams = embedParamSets;
                embedParams["data"] = embedParams["data"] || params;
                if (wrapEach)
                    return { c: "flex-column", children: [wrapEach(uitk[rep](embedParams))] };
                else
                    return { c: "flex-column", children: [uitk[rep](embedParams)] };
            }
        }
        catch (err) {
            console.error("REPRESENTATION ERROR");
            console.error({ search: search, rep: rep, results: results, params: params });
            console.error(err);
            return uitk.error({ text: "Failed to embed as " + (params["childRep"] || rep) });
        }
    }
    else {
        console.error("REPRESENTATION ERROR");
        console.error({ search: search, rep: rep, results: results, params: params });
        return uitk.error({ text: "Unknown representation " + (params["childRep"] || rep) });
    }
}
var historyState = window.history.state;
var historyURL = utils_1.location();
window.addEventListener("popstate", function (evt) {
    var popout = app_1.eve.findOne("ui pane", { kind: PANE.POPOUT });
    if (popout && popoutHistory.length) {
        window.history.pushState(historyState, null, historyURL);
        var _a = popoutHistory.pop(), rep = _a.rep, contains_1 = _a.contains, params = _a.params, x = _a.x, y = _a.y;
        app_1.dispatch("set popout", { parentId: "p1", rep: rep, contains: contains_1, params: params, x: x, y: y, popState: true }).commit(); // @TODO: make "p1" a constant
        return;
    }
    else if (evt.state && evt.state.root) {
        window.history.back();
        return;
    }
    historyState = evt.state;
    historyURL = utils_1.location();
    var _b = evt.state || {}, _c = _b.paneId, paneId = _c === void 0 ? undefined : _c, _d = _b.contains, contains = _d === void 0 ? undefined : _d;
    if (paneId === undefined || contains === undefined)
        return;
    app_1.dispatch("set pane", { paneId: paneId, contains: contains, popState: true }).commit();
});
// Prevent backspace from going back
window.addEventListener("keydown", function (event) {
    var current = event.target;
    if (event.keyCode === utils_1.KEYS.BACKSPACE && current.nodeName !== "INPUT" && current.nodeName !== "TEXTAREA" && current.contentEditable !== "true") {
        event.preventDefault();
    }
});
// @NOTE: Uncomment this to enable the new UI, or type `window["NEUE_UI"] = true; app.render()` into the console to enable it transiently.
window["NEUE_UI"] = true;
var _a;

},{"./NLQueryParser":8,"./app":9,"./parser":13,"./richTextEditor":14,"./runtime":15,"./uitk":18,"./utils":19,"codemirror":2}],17:[function(require,module,exports){
var utils_1 = require("./utils");
var runtime_1 = require("./runtime");
function resolve(table, fact) {
    var neue = {};
    for (var field in fact)
        neue[(table + ": " + field)] = fact[field];
    return neue;
}
function humanize(table, fact) {
    var neue = {};
    for (var field in fact)
        neue[field.slice(table.length + 2)] = fact[field];
    return neue;
}
function resolvedAdd(changeset, table, fact) {
    return changeset.add(table, resolve(table, fact));
}
function resolvedRemove(changeset, table, fact) {
    return changeset.remove(table, resolve(table, fact));
}
function humanizedFind(ixer, table, query) {
    var results = [];
    for (var _i = 0, _a = ixer.find(table, resolve(table, query)); _i < _a.length; _i++) {
        var fact = _a[_i];
        results.push(humanize(table, fact));
    }
    var diag = {};
    for (var table_1 in ixer.tables)
        diag[table_1] = ixer.tables[table_1].table.length;
    return results;
}
var UI = (function () {
    function UI(id) {
        this.id = id;
        this._children = [];
        this._attributes = {};
        this._events = {};
    }
    UI.remove = function (template, ixer) {
        var changeset = ixer.diff();
        resolvedRemove(changeset, "ui template", { template: template });
        resolvedRemove(changeset, "ui template binding", { template: template });
        var bindings = humanizedFind(ixer, "ui template binding", { template: template });
        for (var _i = 0; _i < bindings.length; _i++) {
            var binding = bindings[_i];
            changeset.merge(runtime_1.Query.remove(binding.binding, ixer));
        }
        resolvedRemove(changeset, "ui embed", { template: template });
        var embeds = humanizedFind(ixer, "ui embed", { template: template });
        for (var _a = 0; _a < embeds.length; _a++) {
            var embed = embeds[_a];
            resolvedRemove(changeset, "ui embed scope", { template: template, embed: embed.embed });
            resolvedRemove(changeset, "ui embed scope binding", { template: template, embed: embed.embed });
        }
        resolvedRemove(changeset, "ui attribute", { template: template });
        resolvedRemove(changeset, "ui attribute binding", { template: template });
        resolvedRemove(changeset, "ui event", { template: template });
        var events = humanizedFind(ixer, "ui event", { template: template });
        for (var _b = 0; _b < events.length; _b++) {
            var event_1 = events[_b];
            resolvedRemove(changeset, "ui event state", { template: template, event: event_1.event });
            resolvedRemove(changeset, "ui event state binding", { template: template, event: event_1.event });
        }
        for (var _c = 0, _d = humanizedFind(ixer, "ui template", { parent: template }); _c < _d.length; _c++) {
            var child = _d[_c];
            changeset.merge(UI.remove(child.template, ixer));
        }
        return changeset;
    };
    UI.prototype.copy = function () {
        var neue = new UI(this.id);
        neue._binding = this._binding;
        neue._embedded = this._embedded;
        neue._children = this._children;
        neue._attributes = this._attributes;
        neue._events = this._events;
        neue._parent = this._parent;
        return neue;
    };
    UI.prototype.changeset = function (ixer) {
        var changeset = ixer.diff();
        var parent = this._attributes["parent"] || (this._parent && this._parent.id) || "";
        var ix = this._attributes["ix"];
        if (ix === undefined)
            ix = (this._parent && this._parent._children.indexOf(this));
        if (ix === -1 || ix === undefined)
            ix = "";
        if (this._embedded)
            parent = "";
        resolvedAdd(changeset, "ui template", { template: this.id, parent: parent, ix: ix });
        if (this._binding) {
            if (!this._binding.name || this._binding.name === "unknown")
                this._binding.name = "bound view " + this.id;
            changeset.merge(this._binding.changeset(ixer));
            resolvedAdd(changeset, "ui template binding", { template: this.id, binding: this._binding.name });
        }
        if (this._embedded) {
            var embed = utils_1.uuid();
            resolvedAdd(changeset, "ui embed", { embed: embed, template: this.id, parent: (this._parent || {}).id, ix: ix });
            for (var key in this._embedded) {
                var value = this._attributes[key];
                if (value instanceof Array)
                    resolvedAdd(changeset, "ui embed scope binding", { embed: embed, key: key, source: value[0], alias: value[1] });
                else
                    resolvedAdd(changeset, "ui embed scope", { embed: embed, key: key, value: value });
            }
        }
        for (var property in this._attributes) {
            var value = this._attributes[property];
            if (value instanceof Array)
                resolvedAdd(changeset, "ui attribute binding", { template: this.id, property: property, source: value[0], alias: value[1] });
            else
                resolvedAdd(changeset, "ui attribute", { template: this.id, property: property, value: value });
        }
        for (var event_2 in this._events) {
            resolvedAdd(changeset, "ui event", { template: this.id, event: event_2 });
            var state = this._events[event_2];
            for (var key in state) {
                var value = state[key];
                if (value instanceof Array)
                    resolvedAdd(changeset, "ui event state binding", { template: this.id, event: event_2, key: key, source: value[0], alias: value[1] });
                else
                    resolvedAdd(changeset, "ui event state", { template: this.id, event: event_2, key: key, value: value });
            }
        }
        for (var _i = 0, _a = this._children; _i < _a.length; _i++) {
            var child = _a[_i];
            changeset.merge(child.changeset(ixer));
        }
        return changeset;
    };
    UI.prototype.load = function (template, ixer, parent) {
        var fact = humanizedFind(ixer, "ui template", { template: template })[0];
        if (!fact)
            return this;
        if (parent || fact.parent)
            this._parent = parent || new UI(this._parent);
        var binding = humanizedFind(ixer, "ui template binding", { template: template })[0];
        if (binding)
            this.bind((new runtime_1.Query(ixer, binding.binding)));
        var embed = humanizedFind(ixer, "ui embed", { template: template, parent: this._parent ? this._parent.id : "" })[0];
        if (embed) {
            var scope = {};
            for (var _i = 0, _a = humanizedFind(ixer, "ui embed scope", { embed: embed.embed }); _i < _a.length; _i++) {
                var attr = _a[_i];
                scope[attr.key] = attr.value;
            }
            for (var _b = 0, _c = humanizedFind(ixer, "ui embed scope binding", { embed: embed.embed }); _b < _c.length; _b++) {
                var attr = _c[_b];
                scope[attr.key] = [attr.source, attr.alias];
            }
            this.embed(scope);
        }
        for (var _d = 0, _e = humanizedFind(ixer, "ui attribute", { template: template }); _d < _e.length; _d++) {
            var attr = _e[_d];
            this.attribute(attr.property, attr.value);
        }
        for (var _f = 0, _g = humanizedFind(ixer, "ui attribute binding", { template: template }); _f < _g.length; _f++) {
            var attr = _g[_f];
            this.attribute(attr.property, [attr.source, attr.alias]);
        }
        for (var _h = 0, _j = humanizedFind(ixer, "ui event", { template: template }); _h < _j.length; _h++) {
            var event_3 = _j[_h];
            var state = {};
            for (var _k = 0, _l = humanizedFind(ixer, "ui event state", { template: template, event: event_3.event }); _k < _l.length; _k++) {
                var attr = _l[_k];
                state[event_3.key] = event_3.value;
            }
            for (var _m = 0, _o = humanizedFind(ixer, "ui event state binding", { template: template, event: event_3.event }); _m < _o.length; _m++) {
                var attr = _o[_m];
                state[event_3.key] = [event_3.source, event_3.alias];
            }
            this.event(event_3.event, state);
        }
        for (var _p = 0, _q = humanizedFind(ixer, "ui template", { parent: template }); _p < _q.length; _p++) {
            var child = _q[_p];
            this.child((new UI(child.template)).load(child.template, ixer, this));
        }
        return this;
    };
    UI.prototype.children = function (neue, append) {
        if (append === void 0) { append = false; }
        if (!neue)
            return this._children;
        if (!append)
            this._children.length = 0;
        for (var _i = 0; _i < neue.length; _i++) {
            var child = neue[_i];
            var copied = child.copy();
            copied._parent = this;
            this._children.push(copied);
        }
        return this._children;
    };
    UI.prototype.child = function (child, ix, embed) {
        child = child.copy();
        child._parent = this;
        if (embed)
            child.embed(embed);
        if (!ix)
            this._children.push(child);
        else
            this._children.splice(ix, 0, child);
        return child;
    };
    UI.prototype.removeChild = function (ix) {
        return this._children.splice(ix, 1);
    };
    UI.prototype.attributes = function (properties, merge) {
        if (merge === void 0) { merge = false; }
        if (!properties)
            return this._attributes;
        if (!merge) {
            for (var prop in this._attributes)
                delete this._attributes[prop];
        }
        for (var prop in properties)
            this._attributes[prop] = properties[prop];
        return this;
    };
    UI.prototype.attribute = function (property, value) {
        if (value === undefined)
            return this._attributes[property];
        this._attributes[property] = value;
        return this;
    };
    UI.prototype.removeAttribute = function (property) {
        delete this._attributes[property];
        return this;
    };
    UI.prototype.events = function (events, merge) {
        if (merge === void 0) { merge = false; }
        if (!events)
            return this._events;
        if (!merge) {
            for (var event_4 in this._events)
                delete this._events[event_4];
        }
        for (var event_5 in events)
            this._events[event_5] = events[event_5];
        return this;
    };
    UI.prototype.event = function (event, state) {
        if (state === undefined)
            return this._events[event];
        this._attributes[event] = state;
        return this;
    };
    UI.prototype.removeEvent = function (event) {
        delete this._events[event];
        return this;
    };
    UI.prototype.embed = function (scope) {
        if (scope === void 0) { scope = {}; }
        if (!scope) {
            this._embedded = undefined;
            return this;
        }
        if (scope === true)
            scope = {};
        this._embedded = scope;
        return this;
    };
    UI.prototype.bind = function (binding) {
        this._binding = binding;
        return this;
    };
    return UI;
})();
exports.UI = UI;
// @TODO: Finish reference impl.
// @TODO: Then build bit-generating version
var UIRenderer = (function () {
    function UIRenderer(ixer) {
        this.ixer = ixer;
        this.compiled = 0;
        this._tagCompilers = {};
        this._handlers = [];
    }
    UIRenderer.prototype.compile = function (roots) {
        if (utils_1.DEBUG.RENDERER)
            console.group("ui compile");
        var compiledElems = [];
        for (var _i = 0; _i < roots.length; _i++) {
            var root = roots[_i];
            // @TODO: reparent dynamic roots if needed.
            if (typeof root === "string") {
                var elems = this._compileWrapper(root, compiledElems.length);
                compiledElems.push.apply(compiledElems, elems);
                var base = this.ixer.findOne("ui template", { "ui template: template": root });
                if (!base)
                    continue;
                var parent_1 = base["ui template: parent"];
                if (parent_1) {
                    for (var _a = 0; _a < elems.length; _a++) {
                        var elem = elems[_a];
                        elem.parent = parent_1;
                    }
                }
            }
            else {
                if (!root.ix)
                    root.ix = compiledElems.length;
                compiledElems.push(root);
            }
        }
        if (utils_1.DEBUG.RENDERER)
            console.groupEnd();
        return compiledElems;
    };
    UIRenderer.prototype._compileWrapper = function (template, baseIx, constraints, bindingStack, depth) {
        if (constraints === void 0) { constraints = {}; }
        if (bindingStack === void 0) { bindingStack = []; }
        if (depth === void 0) { depth = 0; }
        var elems = [];
        var binding = this.ixer.findOne("ui template binding", { "ui template binding: template": template });
        if (!binding) {
            var elem = this._compileElement(template, bindingStack, depth);
            if (elem)
                elems[0] = elem;
        }
        else {
            var boundQuery = binding["ui template binding: binding"];
            var facts = this.getBoundFacts(boundQuery, constraints);
            var ix = 0;
            for (var _i = 0; _i < facts.length; _i++) {
                var fact = facts[_i];
                bindingStack.push(fact);
                var elem = this._compileElement(template, bindingStack, depth);
                bindingStack.pop();
                if (elem)
                    elems.push(elem);
            }
        }
        elems.sort(function (a, b) { return a.ix - b.ix; });
        var prevIx = undefined;
        for (var _a = 0; _a < elems.length; _a++) {
            var elem = elems[_a];
            elem.ix = elem.ix ? elem.ix + baseIx : baseIx;
            if (elem.ix === prevIx)
                elem.ix++;
            prevIx = elem.ix;
        }
        return elems;
    };
    UIRenderer.prototype._compileElement = function (template, bindingStack, depth) {
        if (utils_1.DEBUG.RENDERER)
            console.log(utils_1.repeat("  ", depth) + "* compile", template);
        var elementToChildren = this.ixer.index("ui template", ["ui template: parent"]);
        var elementToEmbeds = this.ixer.index("ui embed", ["ui embed: parent"]);
        var embedToScope = this.ixer.index("ui embed scope", ["ui embed scope: embed"]);
        var embedToScopeBinding = this.ixer.index("ui embed scope binding", ["ui embed scope binding: embed"]);
        var elementToAttrs = this.ixer.index("ui attribute", ["ui attribute: template"]);
        var elementToAttrBindings = this.ixer.index("ui attribute binding", ["ui attribute binding: template"]);
        var elementToEvents = this.ixer.index("ui event", ["ui event: template"]);
        this.compiled++;
        var base = this.ixer.findOne("ui template", { "ui template: template": template });
        if (!base) {
            console.warn("ui template " + template + " does not exist. Ignoring.");
            return undefined;
        }
        var attrs = elementToAttrs[template];
        var boundAttrs = elementToAttrBindings[template];
        var events = elementToEvents[template];
        // Handle meta properties
        var elem = { _template: template, ix: base["ui template: ix"] };
        // Handle static properties
        if (attrs) {
            for (var _i = 0; _i < attrs.length; _i++) {
                var _a = attrs[_i], prop = _a["ui attribute: property"], val = _a["ui attribute: value"];
                elem[prop] = val;
            }
        }
        // Handle bound properties
        if (boundAttrs) {
            // @FIXME: What do with source?
            for (var _b = 0; _b < boundAttrs.length; _b++) {
                var _c = boundAttrs[_b], prop = _c["ui attribute binding: property"], source = _c["ui attribute binding: source"], alias = _c["ui attribute binding: alias"];
                elem[prop] = this.getBoundValue(source, alias, bindingStack);
            }
        }
        // Attach event handlers
        if (events) {
            for (var _d = 0; _d < events.length; _d++) {
                var event_6 = events[_d]["ui event: event"];
                elem[event_6] = this.generateEventHandler(elem, event_6, bindingStack);
            }
        }
        // Compile children
        var children = elementToChildren[template] || [];
        var embeds = elementToEmbeds[template] || [];
        if (children.length || embeds.length) {
            elem.children = [];
            var childIx = 0, embedIx = 0;
            while (childIx < children.length || embedIx < embeds.length) {
                var child = children[childIx];
                var embed = embeds[embedIx];
                var add = void 0, constraints = {}, childBindingStack = bindingStack;
                if (!embed || child && child.ix <= embed.ix) {
                    add = children[childIx++]["ui template: template"];
                    // Resolve bound aliases into constraints
                    constraints = this.getBoundScope(bindingStack);
                }
                else {
                    add = embeds[embedIx++]["ui embed: template"];
                    for (var _e = 0, _f = embedToScope[embed["ui embed: embed"]] || []; _e < _f.length; _e++) {
                        var scope = _f[_e];
                        constraints[scope["ui embed scope: key"]] = scope["ui embed scope: value"];
                    }
                    for (var _g = 0, _h = embedToScopeBinding[embed["ui embed: embed"]] || []; _g < _h.length; _g++) {
                        var scope = _h[_g];
                        // @FIXME: What do about source?
                        var key = scope["ui embed scope binding: key"], source = scope["ui embed scope binding: source"], alias = scope["ui embed scope binding: alias"];
                        constraints[key] = this.getBoundValue(source, alias, bindingStack);
                    }
                    childBindingStack = [constraints];
                }
                elem.children.push.apply(elem.children, this._compileWrapper(add, elem.children.length, constraints, childBindingStack, depth + 1));
            }
        }
        if (this._tagCompilers[elem.t]) {
            try {
                this._tagCompilers[elem.t](elem);
            }
            catch (err) {
                console.warn("Failed to compile template: '" + template + "' due to '" + err + "' for element '" + JSON.stringify(elem) + "'");
                elem.t = "ui-error";
            }
        }
        return elem;
    };
    UIRenderer.prototype.getBoundFacts = function (query, constraints) {
        return this.ixer.find(query, constraints);
    };
    UIRenderer.prototype.getBoundScope = function (bindingStack) {
        var scope = {};
        for (var _i = 0; _i < bindingStack.length; _i++) {
            var fact = bindingStack[_i];
            for (var alias in fact)
                scope[alias] = fact[alias];
        }
        return scope;
    };
    //@FIXME: What do about source?
    UIRenderer.prototype.getBoundValue = function (source, alias, bindingStack) {
        for (var ix = bindingStack.length - 1; ix >= 0; ix--) {
            var fact = bindingStack[ix];
            if (source in fact && fact[alias])
                return fact[alias];
        }
    };
    UIRenderer.prototype.generateEventHandler = function (elem, event, bindingStack) {
        var template = elem["_template"];
        var memoKey = template + "::" + event;
        var attrKey = event + "::state";
        elem[attrKey] = this.getEventState(template, event, bindingStack);
        if (this._handlers[memoKey])
            return this._handlers[memoKey];
        var self = this;
        if (event === "change" || event === "input") {
            this._handlers[memoKey] = function (evt, elem) {
                var props = {};
                if (elem.t === "select" || elem.t === "input" || elem.t === "textarea")
                    props.value = evt.target.value;
                if (elem.type === "checkbox")
                    props.value = evt.target.checked;
                self.handleEvent(template, event, evt, elem, props);
            };
        }
        else {
            this._handlers[memoKey] = function (evt, elem) {
                self.handleEvent(template, event, evt, elem, {});
            };
        }
        return this._handlers[memoKey];
    };
    UIRenderer.prototype.handleEvent = function (template, eventName, event, elem, eventProps) {
        var attrKey = eventName + "::state";
        var state = elem[attrKey];
        var content = (_a = ["\n      # ", " ({is a: event})\n      ## Meta\n      event target: {event target: ", "}\n      event template: {event template: ", "}\n      event type: {event type: ", "}\n\n      ## State\n    "], _a.raw = ["\n      # ", " ({is a: event})\n      ## Meta\n      event target: {event target: ", "}\n      event template: {event template: ", "}\n      event type: {event type: ", "}\n\n      ## State\n    "], utils_1.unpad(6)(_a, eventName, elem.id, template, eventName));
        if (state["*event*"]) {
            for (var prop in state["*event*"])
                content += prop + ": {" + prop + ": " + eventProps[state["*event*"][prop]] + "}\n";
        }
        for (var prop in state) {
            if (prop === "*event*")
                continue;
            content += prop + ": {" + prop + ": " + state[prop] + "}\n";
        }
        var changeset = this.ixer.diff();
        var raw = utils_1.uuid();
        var entity = eventName + " event " + raw.slice(-12);
        changeset.add("builtin entity", { entity: entity, content: content });
        this.ixer.applyDiff(changeset);
        console.log(entity);
        var _a;
    };
    UIRenderer.prototype.getEventState = function (template, event, bindingStack) {
        var state = {};
        var staticAttrs = this.ixer.find("ui event state", { "ui event state: template": template, "ui event state: event": event });
        for (var _i = 0; _i < staticAttrs.length; _i++) {
            var _a = staticAttrs[_i], key = _a["ui event state: key"], val = _a["ui event state: value"];
            state[key] = val;
        }
        var boundAttrs = this.ixer.find("ui event state binding", { "ui event state binding: template": template, "ui event state binding: event": event });
        for (var _b = 0; _b < boundAttrs.length; _b++) {
            var _c = boundAttrs[_b], key = _c["ui event state binding: key"], source = _c["ui event state binding: source"], alias = _c["ui event state binding: alias"];
            if (source === "*event*") {
                state["*event*"] = state["*event*"] || {};
                state["*event*"][key] = alias;
            }
            else {
                state[key] = this.getBoundValue(source, alias, bindingStack);
            }
        }
        return state;
    };
    return UIRenderer;
})();
exports.UIRenderer = UIRenderer;
if (this.window)
    window["uiRenderer"] = exports;

},{"./runtime":15,"./utils":19}],18:[function(require,module,exports){
var utils_1 = require("./utils");
var app_1 = require("./app");
var ui_1 = require("./ui");
var masonry_1 = require("./masonry");
//------------------------------------------------------------------------------
// Utilities
//------------------------------------------------------------------------------
function resolveName(maybeId) {
    var display = app_1.eve.findOne("display name", { id: maybeId });
    return display ? display.name : maybeId;
}
exports.resolveName = resolveName;
function resolveId(maybeName) {
    var display = app_1.eve.findOne("display name", { name: maybeName });
    return display ? display.id : maybeName;
}
exports.resolveId = resolveId;
function resolveValue(maybeValue) {
    maybeValue = utils_1.coerceInput(maybeValue);
    if (typeof maybeValue !== "string")
        return maybeValue;
    var val = maybeValue.trim();
    var entity = ui_1.asEntity(maybeValue);
    if (entity)
        return entity;
    //if(val[0] === "\"" && val[val.length - 1] === "\"") return val.slice(1, -1);
    return val;
}
exports.resolveValue = resolveValue;
function isEntity(maybeId) {
    return !!app_1.eve.findOne("entity", { entity: maybeId });
}
exports.isEntity = isEntity;
function getNodeContent(node) {
    if (node.nodeName === "INPUT")
        return node.value;
    else
        return node.textContent;
}
exports.getNodeContent = getNodeContent;
function sortByFieldValue(field, direction) {
    if (direction === void 0) { direction = 1; }
    var fwd = direction;
    var back = -1 * direction;
    return function (rowA, rowB) {
        var a = resolveName(resolveValue(rowA[field])), b = resolveName(resolveValue(rowB[field]));
        return (a === b) ? 0 :
            (a === undefined) ? fwd :
                (b === undefined) ? back :
                    (a > b) ? fwd : back;
    };
}
var wordSplitter = /\s+/gi;
var statWeights = { links: 100, pages: 200, words: 1 };
function classifyEntities(rawEntities) {
    var entities = rawEntities.slice();
    var collections = [];
    var systems = [];
    // Measure relatedness + length of entities
    // @TODO: mtimes of entities
    var relatedCounts = {};
    var wordCounts = {};
    var childCounts = {};
    var scores = {};
    for (var _i = 0; _i < entities.length; _i++) {
        var entity_1 = entities[_i];
        var _a = (app_1.eve.findOne("entity", { entity: entity_1 }) || {}).content, content = _a === void 0 ? "" : _a;
        relatedCounts[entity_1] = app_1.eve.find("directionless links", { entity: entity_1 }).length;
        wordCounts[entity_1] = content.trim().replace(wordSplitter, " ").split(" ").length;
        var _b = (app_1.eve.findOne("collection", { collection: entity_1 }) || {}).count, childCount = _b === void 0 ? 0 : _b;
        childCounts[entity_1] = childCount;
        scores[entity_1] =
            relatedCounts[entity_1] * statWeights.links +
                wordCounts[entity_1] * statWeights.words +
                childCounts[entity_1] * statWeights.pages;
    }
    // Separate system entities
    var ix = 0;
    while (ix < entities.length) {
        if (app_1.eve.findOne("is a attributes", { collection: utils_1.builtinId("system"), entity: entities[ix] })) {
            systems.push(entities.splice(ix, 1)[0]);
        }
        else
            ix++;
    }
    // Separate user collections from other entities
    ix = 0;
    while (ix < entities.length) {
        if (childCounts[entities[ix]]) {
            collections.push(entities.splice(ix, 1)[0]);
        }
        else
            ix++;
    }
    return { systems: systems, collections: collections, entities: entities, scores: scores, relatedCounts: relatedCounts, wordCounts: wordCounts, childCounts: childCounts };
}
function getFields(_a) {
    var example = _a.example, whitelist = _a.whitelist, blacklist = _a.blacklist;
    // Determine display fields based on whitelist, blacklist, and the first row
    var fields;
    if (whitelist) {
        fields = whitelist.slice();
    }
    else {
        fields = Object.keys(example);
        if (blacklist) {
            for (var _i = 0; _i < blacklist.length; _i++) {
                var field = blacklist[_i];
                var fieldIx = fields.indexOf(field);
                if (fieldIx !== -1) {
                    fields.splice(fieldIx, 1);
                }
            }
        }
    }
    return fields;
}
exports.getFields = getFields;
//------------------------------------------------------------------------------
// Handlers
//------------------------------------------------------------------------------
function preventDefault(event) {
    event.preventDefault();
}
exports.preventDefault = preventDefault;
function preventDefaultUnlessFocused(event) {
    if (event.target !== document.activeElement)
        event.preventDefault();
}
function closePopup(event, elem, chain) {
    var commit = false;
    if (!chain) {
        chain = app_1.dispatch("rerender");
        commit = true;
    }
    var paneId = elem.paneId || elem.data && elem.data.paneId;
    for (var _i = 0, _a = app_1.eve.find("ui pane parent", { parent: paneId }); _i < _a.length; _i++) {
        var child = _a[_i].pane;
        var popout = app_1.eve.findOne("ui pane", { pane: child, kind: ui_1.PANE.POPOUT });
        if (!popout)
            continue;
        chain.dispatch("remove popup", { paneId: popout.pane });
    }
    if (commit)
        chain.commit();
}
function navigate(event, elem) {
    var paneId = elem.data.paneId;
    if (elem.peek)
        app_1.dispatch("set popout", { parentId: paneId, contains: elem.link, x: event.clientX, y: event.clientY }).commit();
    else
        app_1.dispatch("set pane", { paneId: paneId, contains: elem.link }).commit();
    event.preventDefault();
    event.stopPropagation();
}
exports.navigate = navigate;
function blurOnEnter(event, elem) {
    if (event.keyCode === utils_1.KEYS.ENTER) {
        event.target.blur();
        event.preventDefault();
    }
}
//interface TableCellElem extends Element { row: TableRowElem, field: string, rows?: any[]}
//interface TableFieldElem extends Element { table: string, field: string, direction?: number }
function updateEntityValue(event, elem) {
    var value = utils_1.coerceInput(event.detail);
    var tableElem = elem.table, row = elem.row, field = elem.field;
    var entity = tableElem["entity"];
    throw new Error("@TODO: FIXME");
    // let rows = elem.rows || [row];
    // let chain = dispatch();
    // for(let row of rows) {
    //   if(field === "value" && row.value !== value && row.attribute !== undefined) {
    //     chain.dispatch("update entity attribute", {entity, attribute: row.attribute, prev: row.value, value});
    //   } else if(field === "attribute" && row.attribute !== value && row.value !== undefined) {
    //     chain.dispatch("rename entity attribute", {entity, prev: row.attribute, attribute: value, value: row.value});
    //   }
    // }
    // chain.commit();
}
function updateEntityAttributes(event, elem) {
    var _a = elem.row, tableElem = _a.table, row = _a.row;
    var entity = tableElem["entity"];
    if (event.detail === "add") {
        var state = elem["state"]["adder"];
        var valid = elem["fields"].every(function (field) {
            return state[field] !== undefined;
        });
        if (valid) {
            app_1.dispatch("add sourced eav", { entity: entity, attribute: state.attribute, value: resolveValue(state.value) }).commit();
            elem["state"]["adder"] = {};
        }
    }
    else {
        app_1.dispatch("remove entity attribute", { entity: entity, attribute: row.attribute, value: row.value }).commit();
    }
}
function sortTable(event, elem) {
    var table = elem.table, _a = elem.field, field = _a === void 0 ? undefined : _a, _b = elem.direction, direction = _b === void 0 ? undefined : _b;
    if (field === undefined && direction === undefined) {
        field = event.target.value;
        direction = -1;
    }
    app_1.dispatch("sort table", { state: table.state, field: field, direction: direction }).commit();
}
//------------------------------------------------------------------------------
// Embedded cell representation wrapper
//------------------------------------------------------------------------------
var uitk = this;
function embeddedCell(elem) {
    var children = [];
    var childInfo = elem.childInfo, rep = elem.rep;
    if (childInfo.constructor === Array) {
        for (var _i = 0; _i < childInfo.length; _i++) {
            var child = childInfo[_i];
            child["data"] = child["data"] || childInfo.params;
            children.push(uitk[rep](child));
        }
    }
    else {
        children.push(uitk[rep](childInfo));
    }
    children.push({ c: "edit-button-container", children: [
            { c: "edit-button ion-edit", click: elem.click, cell: elem.cell }
        ] });
    return { c: "non-editing-embedded-cell", children: children, cell: elem.cell };
}
exports.embeddedCell = embeddedCell;
//------------------------------------------------------------------------------
// Representations for cards
//------------------------------------------------------------------------------
// @FIXME: if there isn't an ID here, microReact does the wrong thing, investigate
// after the release
function card(elem) {
    elem.c = "card " + (elem.c || "");
    return elem;
}
exports.card = card;
function toggleAddTile(event, elem) {
    app_1.dispatch("toggle add tile", { key: elem.key, entityId: elem.entityId }).commit();
}
function setTileAdder(event, elem) {
    app_1.dispatch("set tile adder", { key: elem.key, adder: elem.adder }).commit();
}
function closeCard(event, elem) {
    app_1.dispatch("close card", { paneId: elem.paneId }).commit();
}
function navigateRoot(event, elem) {
    var root = app_1.eve.findOne("ui pane", { kind: ui_1.PANE.FULL })["pane"];
    app_1.dispatch("set pane", { paneId: root, contains: elem.entityId }).commit();
}
function entity(elem) {
    var entityId = elem.entity;
    var paneId = elem.data.paneId;
    var key = elem.key || entityId + "|" + paneId;
    var state = ui_1.uiState.widget.card[key] || {};
    var name = app_1.eve.findOne("display name", { id: ui_1.asEntity(entityId) }).name;
    var attrs = ui_1.entityTilesUI(entityId, paneId, key);
    attrs.c += " page-attributes";
    // let editor = pageEditor(entityId, paneId, elem.editor);
    var adder = tileAdder({ entityId: entityId, key: key });
    return { c: "entity " + (state.showAdd ? "adding" : ""), children: [
            { c: "header", children: [
                    { text: name },
                    { c: "flex-grow spacer" },
                    { c: "control ion-ios-upload-outline", click: navigateRoot, entityId: entityId },
                    { c: "control " + (state.showAdd ? "ion-android-remove" : "ion-android-add") + " add-tile", click: toggleAddTile, key: key, entityId: entityId },
                    { c: "control ion-android-close", click: closeCard, paneId: paneId },
                ] },
            adder,
            attrs,
        ] };
}
exports.entity = entity;
var measureSpan = document.createElement("span");
measureSpan.className = "measure-span";
document.body.appendChild(measureSpan);
function autosizeInput(node, elem) {
    var minWidth = 50;
    measureSpan.style.fontSize = window.getComputedStyle(node, null)["font-size"];
    measureSpan.textContent = node.value;
    var measuredWidth = measureSpan.getBoundingClientRect().width;
    node.style.width = Math.ceil(Math.max(minWidth, measuredWidth)) + 5 + "px";
}
exports.autosizeInput = autosizeInput;
function autosizeAndFocus(node, elem) {
    autosizeInput(node, elem);
    utils_1.autoFocus(node, elem);
}
exports.autosizeAndFocus = autosizeAndFocus;
function trackPropertyAdderInput(event, elem) {
    var value = event.currentTarget.value;
    app_1.dispatch("set tile adder attribute", { key: elem.key, attribute: elem.attribute, value: value }).commit();
    if (event.currentTarget.nodeName === "INPUT") {
        autosizeInput(event.currentTarget, elem);
    }
}
function adderKeys(event, elem) {
    if (event.keyCode === utils_1.KEYS.ENTER) {
        app_1.dispatch("submit tile adder", { key: elem.key, node: event.currentTarget }).commit();
    }
    else if (event.keyCode === utils_1.KEYS.ESC) {
        app_1.dispatch("toggle add tile", { key: elem.key }).commit();
    }
}
function submitAdder(event, elem) {
    // @HACK: yeah...
    app_1.dispatch("submit tile adder", { key: elem.key, node: event.currentTarget.parentNode.parentNode.firstChild.firstChild }).commit();
}
function submitProperty(adder, state, node) {
    if (state.propertyProperty === undefined || state.propertyValue === undefined)
        return;
    app_1.dispatch("add sourced eav", { entity: state.entityId, attribute: state.propertyProperty, value: state.propertyValue, forceEntity: true }).commit();
    state.propertyValue = undefined;
    state.propertyProperty = undefined;
    //make sure the focus is in the value
    node.parentNode.firstChild.focus();
}
function propertyAdderUI(elem) {
    var entityId = elem.entityId, key = elem.key;
    var state = ui_1.uiState.widget.card[key] || {};
    return { c: "property-adder", children: [
            { children: [
                    { c: "tile small", children: [
                            { c: "tile-content-wrapper", children: [
                                    { t: "input", c: "property", placeholder: "property", value: state.propertyProperty || "", attribute: "propertyProperty", input: trackPropertyAdderInput, postRender: autosizeAndFocus, keydown: adderKeys, entityId: entityId, key: key },
                                    { t: "input", c: "value", placeholder: "value", value: state.propertyValue || "", attribute: "propertyValue", input: trackPropertyAdderInput, postRender: autosizeInput, keydown: adderKeys, entityId: entityId, key: key },
                                ] },
                            { c: "controls flex-row", children: [
                                    { c: "ion-checkmark submit", click: submitAdder, key: key },
                                    { c: "ion-close cancel", click: setTileAdder, key: key },
                                ] }
                        ] }
                ] }
        ] };
}
function descriptionAdderUI(elem) {
    var entityId = elem.entityId, key = elem.key;
    var state = ui_1.uiState.widget.card[key] || {};
    return { c: "property-adder description-adder", children: [
            { children: [
                    { c: "tile full", children: [
                            { c: "tile-content-wrapper", children: [
                                    { t: "textarea", c: "value", placeholder: "description", value: state.descriptionValue, attribute: "descriptionValue", input: trackPropertyAdderInput, postRender: utils_1.autoFocus, keydown: adderKeys, entityId: entityId, key: key },
                                ] },
                            { c: "controls flex-row", children: [
                                    { c: "ion-checkmark submit", click: submitAdder, key: key },
                                    { c: "ion-close cancel", click: setTileAdder, key: key },
                                ] }
                        ] },
                ] }
        ] };
}
function submitDescription(adder, state, node) {
    var chain = app_1.dispatch("add sourced eav", { entity: state.entityId, attribute: "description", value: state.descriptionValue });
    state.descriptionValue = "";
    chain.dispatch("toggle add tile", { key: state.key }).commit();
}
function autosizeAndStoreListTileItem(event, elem) {
    var node = event.currentTarget;
    app_1.dispatch("add active tile item", { cardId: elem.cardId, attribute: elem.storeAttribute, tileId: elem.tileId, id: elem.storeId, value: node.value }).commit();
    autosizeInput(node, elem);
}
function collectionTileAdder(elem) {
    var values = elem.values, data = elem.data, tileId = elem.tileId, attribute = elem.attribute, cardId = elem.cardId, entityId = elem.entityId, forceActive = elem.forceActive, reverseEntityAndValue = elem.reverseEntityAndValue, noProperty = elem.noProperty, _a = elem.rep, rep = _a === void 0 ? "value" : _a, _b = elem.c, klass = _b === void 0 ? "" : _b;
    tileId = tileId || attribute;
    var state = ui_1.uiState.widget.card[cardId] || {};
    var listChildren = [];
    var added = (state.activeTile ? state.activeTile.itemsToAdd : false) || [];
    var ix = 0;
    for (var _i = 0; _i < added.length; _i++) {
        var add = added[_i];
        listChildren.push({ c: "value", children: [
                { t: "input", placeholder: "add", value: add, attribute: attribute, entityId: entityId, storeAttribute: "itemsToAdd", storeId: ix, cardId: cardId, input: autosizeAndStoreListTileItem, postRender: autosizeAndFocus, keydown: adderKeys, key: cardId }
            ] });
        ix++;
    }
    listChildren.push({ c: "value", children: [
            { t: "input", placeholder: "add item", value: "", attribute: attribute, entityId: entityId, storeAttribute: "itemsToAdd", storeId: ix, cardId: cardId, input: autosizeAndStoreListTileItem, postRender: ix === 0 ? autosizeAndFocus : autosizeInput, keydown: adderKeys, key: cardId }
        ] });
    var size = "full";
    var tileChildren = [];
    tileChildren.push({ t: "input", c: "property", placeholder: "collection name", attribute: "collectionProperty", value: state.collectionProperty, input: trackPropertyAdderInput, key: cardId });
    tileChildren.push({ c: "list", children: listChildren });
    return { c: "property-adder collection-adder", children: [
            { children: [
                    { c: "tile full", children: [
                            { c: "tile-content-wrapper", children: tileChildren },
                            { c: "controls flex-row", children: [
                                    { c: "ion-checkmark submit", click: submitAdder, key: cardId },
                                    { c: "ion-close cancel", click: setTileAdder, key: cardId },
                                ] }
                        ] },
                ] }
        ] };
}
function collectionAdderUI(elem) {
    var entityId = elem.entityId, key = elem.key;
    var state = ui_1.uiState.widget.card[key] || {};
    var tile = collectionTileAdder({ values: [], cardId: key, entityId: entityId, forceActive: true, tileId: "collectionAdder", data: {}, noProperty: true, });
    return tile;
}
function submitCollection(adder, state, node) {
    var chain;
    // determine whether this is making the current entity a collection, or if this is just a normal collection.
    if (!state.collectionProperty || pluralize(state.collectionProperty.trim(), 1).toLowerCase() === resolveName(state.entityId).toLowerCase()) {
        // this is turning the current entity into a collection
        chain = app_1.dispatch("submit list tile", { cardId: state.key, attribute: "is a", entityId: state.entityId, reverseEntityAndValue: true });
    }
    else {
        chain = app_1.dispatch("submit list tile", { cardId: state.key, attribute: state.collectionProperty, entityId: state.entityId, reverseEntityAndValue: false });
    }
    state.collectionProperty = undefined;
    chain.dispatch("toggle add tile", { key: state.key }).commit();
    console.log(JSON.stringify(state));
}
function imageAdderUI(elem) {
    var entityId = elem.entityId, key = elem.key;
    var state = ui_1.uiState.widget.card[key] || {};
    return { c: "property-adder image-adder", children: [
            { children: [
                    { c: "tile small", children: [
                            { c: "tile-content-wrapper", children: [
                                    { t: "input", c: "value", placeholder: "image url", value: state.imageValue, attribute: "imageValue", input: trackPropertyAdderInput, postRender: autosizeAndFocus, keydown: adderKeys, entityId: entityId, key: key },
                                ] },
                            { c: "controls flex-row", children: [
                                    { c: "ion-checkmark submit", click: submitAdder, key: key },
                                    { c: "ion-close cancel", click: setTileAdder, key: key },
                                ] }
                        ] }
                ] }
        ] };
}
function submitImage(adder, state, node) {
    var chain = app_1.dispatch("add sourced eav", { entity: state.entityId, attribute: "image", value: "\"" + state.imageValue + "\"" });
    state.imageValue = undefined;
    chain.dispatch("toggle add tile", { key: state.key }).commit();
}
function comingSoonAdderUI(elem) {
    var entityId = elem.entityId, key = elem.key;
    var state = ui_1.uiState.widget.card[key] || {};
    return { c: "property-adder", children: [
            { children: [
                    { c: "tile small", children: [
                            { c: "tile-content-wrapper", children: [
                                    { text: "This tile type is coming soon." }
                                ] },
                            { c: "controls flex-row", children: [
                                    { c: "ion-close cancel", click: setTileAdder, key: key },
                                ] }
                        ] }
                ] }
        ] };
}
function tileAdder(elem) {
    var entityId = elem.entityId, key = elem.key;
    var state = ui_1.uiState.widget.card[key] || {};
    var rows = [];
    var klass = "";
    if (!state.adder) {
        var adders = [
            { name: "Property", icon: "ion-compose", ui: propertyAdderUI, submit: submitProperty },
            { name: "Description", icon: "ion-drag", ui: descriptionAdderUI, submit: submitDescription },
            { name: "Collection", klass: "collection", icon: "ion-ios-list-outline", ui: collectionAdderUI, submit: submitCollection },
            { name: "Image", icon: "ion-image", ui: imageAdderUI, submit: submitImage },
            { name: "Document", icon: "ion-document", ui: comingSoonAdderUI },
            { name: "Computed", icon: "ion-calculator", ui: comingSoonAdderUI },
        ];
        var count = 0;
        var curRow = { c: "row flex-row", children: [] };
        for (var _i = 0; _i < adders.length; _i++) {
            var adder = adders[_i];
            curRow.children.push({ c: "tile small", adder: adder, key: key, click: setTileAdder, children: [
                    { c: "tile-content-wrapper", children: [
                            { c: "property", text: adder.name },
                            { c: "value " + adder.icon },
                        ] }
                ] });
            count++;
            if (curRow.children.length === 3 || count === adders.length) {
                rows.push(curRow);
                curRow = { c: "row flex-row", children: [] };
            }
        }
    }
    else {
        var adderElem = { entityId: entityId, key: key };
        if (state.adder.ui) {
            rows.push(state.adder.ui(adderElem));
        }
        klass = state.adder.klass || "";
    }
    return { c: "tile-adder " + klass, children: rows };
}
exports.tileAdder = tileAdder;
function pageEditor(entityId, paneId, elem) {
    var _a = (app_1.eve.findOne("entity", { entity: entityId }) || {}).content, content = _a === void 0 ? undefined : _a;
    var page = app_1.eve.findOne("entity page", { entity: entityId })["page"];
    var name = resolveName(entityId);
    elem.c = "wiki-editor " + (elem.c || "");
    elem.meta = { entityId: entityId, page: page, paneId: paneId };
    elem.options.noFocus = true;
    elem.value = content;
    elem.children = elem.cellItems;
    return elem;
}
exports.pageEditor = pageEditor;
//------------------------------------------------------------------------------
// Representations for Errors
//------------------------------------------------------------------------------
function error(elem) {
    elem.c = "error-rep " + (elem.c || "");
    return elem;
}
exports.error = error;
function name(elem) {
    var entity = elem.entity;
    var _a = (app_1.eve.findOne("display name", { id: entity }) || {}).name, name = _a === void 0 ? entity : _a;
    elem.text = name;
    elem.c = "entity " + (elem.c || "");
    return elem;
}
exports.name = name;
function link(elem) {
    var entity = elem.entity;
    var name = resolveName(entity);
    elem.c = (elem.c || "") + " entity link inline";
    if (!elem["nameAsChild"]) {
        elem.text = elem.text || name;
    }
    else {
        elem.children = [{ text: elem.text || name }];
    }
    elem["link"] = elem["link"] || entity;
    elem.click = elem.click || navigate;
    elem["peek"] = elem["peek"] !== undefined ? elem["peek"] : true;
    return elem;
}
exports.link = link;
function attributes(elem) {
    var entity = elem.entity;
    var attributes = [];
    for (var _i = 0, _a = app_1.eve.find("entity eavs", { entity: entity }); _i < _a.length; _i++) {
        var eav = _a[_i];
        attributes.push({ attribute: eav.attribute, value: eav.value });
    }
    attributes.sort(function (a, b) {
        if (a.attribute === b.attribute)
            return 0;
        else if (a.attribute < b.attribute)
            return -1;
        return 1;
    });
    elem["groups"] = ["attribute"];
    elem["rows"] = attributes;
    elem["editCell"] = updateEntityValue;
    elem["editRow"] = updateEntityAttributes;
    elem["noHeader"] = true;
    return table(elem);
}
exports.attributes = attributes;
function related(elem) {
    var entity = elem.entity, _a = elem.data, data = _a === void 0 ? undefined : _a;
    var name = resolveName(entity);
    var relations = [];
    for (var _i = 0, _b = app_1.eve.find("directionless links", { entity: entity }); _i < _b.length; _i++) {
        var link_1 = _b[_i];
        relations.push(link_1.link);
    }
    elem.c = elem.c !== undefined ? elem.c : "flex-row flex-wrap csv";
    if (relations.length) {
        elem.children = [{ t: "h2", text: name + " is related to " + relations.length + " " + pluralize("entities", relations.length) + ":" }];
        for (var _c = 0; _c < relations.length; _c++) {
            var rel = relations[_c];
            elem.children.push(link({ entity: rel, data: data }));
        }
    }
    else
        elem.text = name + " is not related to any other entities.";
    return elem;
}
exports.related = related;
function index(elem) {
    var entity = elem.entity;
    var name = resolveName(entity);
    var facts = app_1.eve.find("is a attributes", { collection: entity });
    var list = { t: "ul", children: [] };
    for (var _i = 0; _i < facts.length; _i++) {
        var fact = facts[_i];
        list.children.push(link({ t: "li", entity: fact.entity, data: elem.data }));
    }
    elem.children = [
        { t: "h2", text: "There " + pluralize("are", facts.length) + " " + facts.length + " " + pluralize(name, facts.length) + ":" },
        list
    ];
    return elem;
}
exports.index = index;
function view(elem) {
    var entity = elem.entity;
    var name = resolveName(entity);
    // @TODO: Check if given entity is a view, or render an error
    var rows = app_1.eve.find(entity);
    elem["rows"] = rows;
    return table(elem);
}
exports.view = view;
function results(elem) {
    var entity = elem.entity, _a = elem.data, data = _a === void 0 ? undefined : _a;
    elem.children = [name({ entity: entity, data: data })];
    for (var _i = 0, _b = app_1.eve.find("entity eavs", { entity: entity, attribute: "artifact" }); _i < _b.length; _i++) {
        var eav = _b[_i];
        elem.children.push(name({ t: "h3", entity: eav.value, data: data }), view({ entity: eav.value, data: data }));
    }
    return elem;
}
exports.results = results;
//------------------------------------------------------------------------------
// Representations for values
//------------------------------------------------------------------------------
function toggleEditValue(event, elem) {
    if (!elem.state) {
        console.warn("Cannot edit value without state");
        return;
    }
    elem.state.editing = elem.open !== undefined ? elem.open : !elem.state.editing;
    var chain = app_1.dispatch("rerender");
    if (elem.state.editing) {
        closePopup(event, elem, chain);
    }
    chain.commit();
}
function openEditValue(event, elem) {
    elem.open = true;
    toggleEditValue(event, elem);
    delete elem.open;
}
function closeEditValue(event, elem) {
    elem.open = false;
    toggleEditValue(event, elem);
    delete elem.open;
}
function value(elem) {
    var value = elem.value, _a = elem.autolink, autolink = _a === void 0 ? true : _a, data = elem.data;
    elem["original"] = value;
    var entity = ui_1.asEntity(value);
    elem.text = value;
    if (entity) {
        elem["entity"] = entity;
        var name_1 = resolveName(entity);
        elem.text = name_1;
        if (autolink) {
            link(elem);
        }
    }
    return elem;
}
exports.value = value;
function valueEditor(elem) {
    elem.c = "flex-row cell " + (elem.c || "");
    var state = elem.state, _a = elem.disabled, disabled = _a === void 0 ? false : _a, data = elem.data;
    if (elem.original === undefined)
        elem.original = elem.value;
    var content = value({ value: elem.value, autolink: elem.autolink, data: data });
    var input;
    if (!disabled) {
        var _focus = elem.focus;
        var focus_1 = function (event, inputElem) {
            if (_focus)
                _focus(event, elem);
            openEditValue(event, elem);
        };
        var _blur = elem.blur;
        var blur_1 = function (event, inputElem) {
            if (_blur)
                _blur(event, elem);
            closeEditValue(event, elem);
        };
        input = { t: "input", focus: focus_1, blur: blur_1, value: "", strictText: true, placeholder: "" };
        if (!elem.value || state.editing) {
            input.placeholder = "<empty>";
        }
        if (state.editing) {
            ["input", "change", "keyup", "keydown"].map(function (handler) {
                if (!elem[handler])
                    return;
                var _handle = elem[handler];
                input[handler] = function (event, inputElem) {
                    _handle(event, elem);
                };
                delete elem[handler];
            });
            input.value = content.text;
            content = undefined;
        }
    }
    elem.children = [{ c: "cell-content", children: [content] }, { c: "flex-grow cell-input", children: [input] }];
    return elem;
}
exports.valueEditor = valueEditor;
function CSV(elem) {
    var values = elem.values, _a = elem.autolink, autolink = _a === void 0 ? undefined : _a, data = elem.data;
    return { c: "flex-row csv", children: values.map(function (val) { return value({ t: "span", autolink: autolink, value: val, data: data }); }) };
}
exports.CSV = CSV;
function result(elem) {
    elem.c = "result";
    elem.children = [
        elem["search"] ? { c: "header", children: [{ text: elem["search"] }] } : undefined,
        CSV(utils_1.copy(elem))
    ];
    return elem;
}
exports.result = result;
function tableBody(elem) {
    var state = elem.state, rows = elem.rows, _a = elem.overrides, overrides = _a === void 0 ? [] : _a, fields = elem.fields, data = elem.data, _b = elem.groups, groups = _b === void 0 ? [] : _b;
    fields = fields.slice();
    if (!rows.length) {
        elem.text = "<Empty Table>";
        return elem;
    }
    var disabled = {};
    for (var _i = 0, _c = elem.disabled || []; _i < _c.length; _i++) {
        var field_1 = _c[_i];
        disabled[field_1] = true;
    }
    // Strip grouped fields out of display fields -- the former implies the latter and must be handled first
    for (var _d = 0; _d < groups.length; _d++) {
        var field_2 = groups[_d];
        var fieldIx = fields.indexOf(field_2);
        if (fieldIx !== -1) {
            fields.splice(fieldIx, 1);
        }
    }
    // Manage interactivity
    var _e = elem.sortable, sortable = _e === void 0 ? false : _e, editCell = elem.editCell, editGroup = elem.editGroup, removeRow = elem.removeRow;
    if (editCell) {
        if (!state.cellStates)
            state.cellStates = [];
        var _editCell = editCell;
        editCell = function (event, elem) {
            var val = resolveValue(getNodeContent(event.target));
            if (val === elem["original"])
                return;
            _editCell(new CustomEvent("editcell", { detail: val }), elem);
        };
        var _editGroup = editGroup;
        editGroup = function (event, elem) {
            var val = resolveValue(getNodeContent(event.target));
            if (val === elem["original"])
                return;
            if (_editGroup)
                _editGroup(new CustomEvent("editgroup", { detail: val }), elem);
            else {
                for (var _i = 0, _a = elem.rows; _i < _a.length; _i++) {
                    var row = _a[_i];
                    _editCell(new CustomEvent("editcell", { detail: val }), elem);
                }
            }
        };
    }
    // Sort rows
    if (state.sortField && state.sortDirection) {
        rows.sort(sortByFieldValue(state.sortField, state.sortDirection));
    }
    for (var _f = 0; _f < groups.length; _f++) {
        var field = groups[_f];
        rows.sort(sortByFieldValue(field, field === state.sortField ? state.sortDirection : 1));
    }
    elem.children = [];
    var body = elem;
    var openRows = {};
    var openVals = {};
    var rowIx = 0;
    for (var _g = 0; _g < rows.length; _g++) {
        var row = rows[_g];
        var override = {};
        for (var _h = 0; _h < overrides.length; _h++) {
            var change = overrides[_h];
            if (change.row === row) {
                override[change.field] = change.value;
            }
        }
        if (editCell && !state.cellStates[rowIx]) {
            state.cellStates[rowIx] = {};
        }
        var group = void 0;
        for (var _j = 0; _j < groups.length; _j++) {
            var field_3 = groups[_j];
            var val = (field_3 in override ? override[field_3] : row[field_3]) || "";
            if (editCell && !state.cellStates[rowIx][field_3]) {
                state.cellStates[rowIx][field_3] = {};
            }
            var cellState = editCell && state.cellStates[rowIx][field_3];
            if (openVals[field_3] === val) {
                group = openRows[field_3];
                group.children[0].rows.push(row);
            }
            else {
                openVals[field_3] = val;
                var cur = openRows[field_3] = {
                    c: "table-row grouped",
                    children: [
                        valueEditor({
                            c: "column cell",
                            value: val,
                            state: cellState,
                            data: data,
                            table: elem,
                            field: field_3,
                            rows: [row],
                            disabled: !editGroup || disabled[field_3],
                            keydown: blurOnEnter,
                            blur: editGroup
                        }),
                        { c: "flex-column flex-grow group", children: [] }
                    ]
                };
                if (group) {
                    group.children[1].children.push(cur);
                }
                else {
                    body.children.push(cur);
                }
                group = cur;
            }
        }
        var rowItem = { c: "table-row", children: [] };
        for (var _k = 0; _k < fields.length; _k++) {
            var field_4 = fields[_k];
            var val = (field_4 in override ? override[field_4] : row[field_4]) || "";
            if (editCell && !state.cellStates[rowIx][field_4]) {
                state.cellStates[rowIx][field_4] = {};
            }
            var cellState = editCell && state.cellStates[rowIx][field_4];
            rowItem.children.push(valueEditor({
                c: "column cell",
                value: val,
                state: cellState,
                data: data,
                table: elem,
                field: field_4,
                row: row,
                disabled: !editCell || disabled[field_4],
                keydown: blurOnEnter,
                blur: editCell
            }));
        }
        rowItem.children.push({ c: "controls", children: [
                removeRow ? { c: "ion-icon-android-close", row: rowItem, click: removeRow } : undefined
            ] });
        if (group) {
            group.children[1].children.push(rowItem);
        }
        else {
            body.children.push(rowItem);
        }
        rowIx++;
    }
    elem.c = "table-body " + (elem.c || "");
    return { c: "table-body-scroller", children: [elem] };
}
exports.tableBody = tableBody;
function tableHeader(elem) {
    var state = elem.state, fields = elem.fields, _a = elem.groups, groups = _a === void 0 ? [] : _a, _b = elem.sortable, sortable = _b === void 0 ? false : _b, data = elem.data;
    fields = fields.slice();
    // Strip grouped fields out of display fields -- the former implies the latter and must be handled first
    for (var _i = 0; _i < groups.length; _i++) {
        var field = groups[_i];
        var fieldIx = fields.indexOf(field);
        if (fieldIx !== -1) {
            fields.splice(fieldIx, 1);
        }
    }
    var addField = elem.addField, removeField = elem.removeField;
    // Build header
    elem.t = "header";
    elem.c = "table-header " + (elem.c || "");
    elem.children = [];
    for (var _c = 0, _d = groups.concat(fields); _c < _d.length; _c++) {
        var field = _d[_c];
        var isActive = field === state.sortField;
        var direction = isActive ? state.sortDirection : 0;
        var klass = "sort-toggle " + (isActive && direction < 0 ? "ion-arrow-up-b" : "ion-arrow-down-b") + " " + (isActive ? "active" : "");
        elem.children.push({ c: "column field", children: [
                value({ c: "text", value: field, data: data, autolink: false }),
                { c: "flex-grow" },
                { c: "controls", children: [
                        sortable ? { c: klass, table: elem, field: field, direction: -direction || 1, click: sortTable } : undefined,
                        removeField ? { c: "ion-close-round", table: elem, field: field, click: removeField } : undefined
                    ] }
            ] });
    }
    ;
    elem.children.push({ c: "controls", children: [
            addField ? { c: "ion-plus-round add-field-btn", table: elem, click: addField } : undefined
        ] });
    return elem;
}
function tableAdderRow(elem) {
    var row = elem.row, cellStates = elem.cellStates, fields = elem.fields, _a = elem.confirm, confirm = _a === void 0 ? true : _a, editCell = elem.editCell, submit = elem.submit, data = elem.data;
    elem.c = "table-row table-adder " + (elem.c || "");
    elem.children = [];
    var disabled = {};
    for (var _i = 0, _b = elem.disabled || []; _i < _b.length; _i++) {
        var field = _b[_i];
        disabled[field] = true;
    }
    // By default, accept all changes
    if (!editCell) {
        editCell = function (event, cellElem) {
            row[cellElem.field] = resolveValue(getNodeContent(event.target));
        };
    }
    // Wrap submission to point at the adder element instead of the add button
    if (submit) {
        var _submit = submit;
        submit = function (event, _) { return _submit(event, elem); };
    }
    // If we should add without confirmation, submit whenever the row is completely filled in
    if (!confirm && submit) {
        var _editCell = editCell;
        editCell = function (event, cellElem) {
            var valid = !_editCell(event, cellElem);
            for (var _i = 0; _i < fields.length; _i++) {
                var field = fields[_i];
                if (row[field] === undefined)
                    valid = false;
            }
            if (valid)
                submit(event, elem);
        };
    }
    for (var _c = 0; _c < fields.length; _c++) {
        var field = fields[_c];
        if (!cellStates[field]) {
            cellStates[field] = {};
        }
        elem.children.push(valueEditor({
            c: "column cell " + (disabled[field] ? "disabled" : ""),
            disabled: disabled[field],
            value: row[field] || "",
            state: cellStates[field],
            data: data,
            table: elem,
            field: field,
            row: row,
            keydown: blurOnEnter,
            blur: editCell
        }));
    }
    if (confirm) {
        elem.children.push({ c: "controls", children: [{ c: "confirm-row ion-checkmark-round", table: elem, row: row, click: submit }] });
    }
    return elem;
}
exports.tableAdderRow = tableAdderRow;
function createFact(chain, row, _a) {
    var subject = _a.subject, entity = _a.entity, fieldMap = _a.fieldMap, collections = _a.collections;
    var name = row[subject];
    if (!entity) {
        entity = ui_1.asEntity(name);
    }
    if (!entity) {
        entity = utils_1.uuid();
        var pageId = utils_1.uuid();
        console.log(" - creating entity", entity);
        chain.dispatch("create page", { page: pageId, content: "" })
            .dispatch("create entity", { entity: entity, name: name, page: pageId });
    }
    for (var field in fieldMap) {
        var value_1 = resolveValue(row[field]);
        console.log(" - adding attr", fieldMap[field], "=", value_1, "for", entity);
        if (value_1[0] === "\"" && value_1[value_1.length - 1] === "\"") {
            value_1 = value_1.slice(1, -1);
        }
        else if (typeof value_1 === "string") {
            if (!isEntity(value_1)) {
                var pageId = utils_1.uuid();
                var entity_2 = utils_1.uuid();
                var name_2 = value_1;
                value_1 = entity_2;
                console.log("   - creating entity", entity_2);
                chain.dispatch("create page", { page: pageId, content: "" })
                    .dispatch("create entity", { entity: entity_2, name: name_2, page: pageId });
            }
        }
        chain.dispatch("add sourced eav", { entity: entity, attribute: fieldMap[field], value: value_1 });
    }
    if (collections) {
        for (var _i = 0; _i < collections.length; _i++) {
            var coll = collections[_i];
            console.log(" - adding coll", "is a", "=", coll, "for", entity);
            chain.dispatch("add sourced eav", { entity: entity, attribute: "is a", value: coll });
        }
    }
}
function tableStateValid(tableElem) {
    var state = tableElem.state, fields = tableElem.fields, _a = tableElem.groups, groups = _a === void 0 ? [] : _a;
    // A new adder is added every time the previous adder was changes, so the last one is empty.
    var adders = state.adders.slice(0, -1);
    // Ensure all batched changes are valid before committing any of them.
    for (var _i = 0; _i < adders.length; _i++) {
        var adder = adders[_i];
        for (var _b = 0, _c = fields.concat(groups); _b < _c.length; _b++) {
            var field = _c[_b];
            if (adder[field] === undefined || adder[field] === "")
                return false;
        }
    }
    for (var _d = 0, _e = state.changes; _d < _e.length; _d++) {
        var change = _e[_d];
        if (change.value === undefined || change.value === "")
            return false;
    }
    return true;
}
function manageAdders(state, row, field) {
    if (row[field] !== undefined && row[field] !== "") {
        if (row === state.adders[state.adders.length - 1]) {
            // We added a value to the blank adder and need to push a new adder
            state.adders.push({});
        }
    }
    else {
        var ix = 0;
        while (ix < state.adders.length - 1) {
            var adder = state.adders[ix];
            var gc = true;
            for (var field_5 in adder) {
                if (adder[field_5] !== undefined && adder[field_5] !== "") {
                    gc = false;
                    break;
                }
            }
            if (gc) {
                state.adders.splice(ix, 1);
            }
            else {
                ix++;
            }
        }
    }
}
function changeAttributeAdder(event, elem) {
    var tableElem = elem.table, row = elem.row, field = elem.field;
    var state = tableElem.state;
    row[field] = resolveValue(getNodeContent(event.target));
    manageAdders(state, row, field);
    app_1.dispatch("rerender").commit();
}
function changeEntityAdder(event, elem) {
    var tableElem = elem.table, row = elem.row, field = elem.field;
    var state = tableElem.state, subject = tableElem.subject, fieldMap = tableElem.fieldMap;
    row[field] = resolveValue(getNodeContent(event.target));
    if (field === subject) {
        // @NOTE: Should this really be done by inserting "= " when the input is focused?
        var entityId = ui_1.asEntity(resolveValue(row[subject]));
        if (entityId) {
            for (var field_6 in fieldMap) {
                var _a = (app_1.eve.findOne("entity eavs", { entity: entityId, attribute: fieldMap[field_6] }) || {}).value, value_2 = _a === void 0 ? undefined : _a;
                if (!row[field_6] && value_2 !== undefined) {
                    row[field_6] = value_2;
                }
            }
        }
    }
    manageAdders(state, row, field);
    app_1.dispatch("rerender").commit();
}
function updateRowAttribute(event, elem) {
    var field = elem.field, row = elem.row, tableElem = elem.table;
    var state = tableElem.state, subject = tableElem.subject, fieldMap = tableElem.fieldMap;
    var value = resolveValue(event.detail);
    var change;
    for (var _i = 0, _a = state.changes; _i < _a.length; _i++) {
        var cur = _a[_i];
        if (cur.field === field && cur.row === row) {
            change = cur;
            break;
        }
    }
    if (!change) {
        change = { field: field, prev: row[field], row: row, value: value };
        state.changes.push(change);
    }
    else {
        change.value = value;
    }
    app_1.dispatch("rerender").commit();
}
function commitChanges(event, elem) {
    // @TODO: Batch changes to existing rows in editCell into state.changes[]
    // @TODO: Submit all batched cell changes
    // @TODO: Update resolveValue to use new string semantics
    var tableElem = elem.table;
    var subject = tableElem.subject, fieldMap = tableElem.fieldMap, state = tableElem.state;
    var chain = app_1.dispatch("rerender");
    // A new adder is added every time the previous adder was changes, so the last one is empty.
    var adders = state.adders.slice(0, -1);
    if (tableStateValid(tableElem)) {
        for (var _i = 0; _i < adders.length; _i++) {
            var adder = adders[_i];
            createFact(chain, adder, tableElem);
        }
        for (var _a = 0, _b = state.changes; _a < _b.length; _a++) {
            var _c = _b[_a], field = _c.field, prev = _c.prev, row = _c.row, value_3 = _c.value;
            var entity_3 = row[subject];
            app_1.dispatch("update entity attribute", { entity: entity_3, attribute: fieldMap[field], prev: prev, value: value_3 }).commit();
        }
        state.adders = [{}];
        state.changes = [];
        chain.commit();
    }
    else {
        console.warn("One or more changes is invalid, so all changes have not been committed");
    }
}
function commitChangesOnEnter(event, elem) {
    if (event.keyCode === utils_1.KEYS.ENTER) {
        var target = event.target;
        if (target && target.blur) {
            target.blur();
        }
        commitChanges(event, { table: elem });
    }
}
function table(elem) {
    var state = elem.state, rows = elem.rows, fields = elem.fields, groups = elem.groups, disabled = elem.disabled, sortable = elem.sortable, editCell = elem.editCell, data = elem.data;
    elem.c = "table-wrapper table " + (elem.c || "");
    elem.children = [
        elem.search ? { t: "h2", text: elem.search } : undefined,
        tableHeader({ state: state, fields: fields, groups: groups, sortable: sortable, data: data }),
        tableBody({ rows: rows, state: state, fields: fields, groups: groups, disabled: disabled, sortable: sortable, editCell: editCell, data: data })
    ];
    return elem;
}
exports.table = table;
function mappedTable(elem) {
    var state = elem.state, entity = elem.entity, subject = elem.subject, fieldMap = elem.fieldMap, collections = elem.collections, data = elem.data;
    // If we're mapped to an entity search we can only add new attributes to that entity
    for (var _i = 0, _a = state.adders; _i < _a.length; _i++) {
        var adder = _a[_i];
        if (entity && adder[subject] !== entity) {
            adder[subject] = entity;
        }
    }
    if (!state.adderCellStates) {
        state.adderCellStates = [];
    }
    if (state.adders.length !== state.adderCellStates.length) {
        if (state.adders.length > state.adderCellStates.length) {
            for (var ix = 0; ix = state.adders.length - state.adderCellStates.length; ix++) {
                state.adderCellStates.push({});
            }
        }
        else {
            state.adderCellStates.splice(state.adders.length, state.adderCellStates.length);
        }
    }
    var rows = elem.rows, fields = elem.fields, groups = elem.groups, _b = elem.disabled, disabled = _b === void 0 ? [subject] : _b, _c = elem.sortable, sortable = _c === void 0 ? true : _c;
    var adderChanged = entity ? changeAttributeAdder : changeEntityAdder;
    var adderDisabled = entity ? [subject] : undefined;
    var stateValid = tableStateValid(elem);
    elem.c = "table-wrapper mapped-table " + (elem.c || "");
    elem.keydown = commitChangesOnEnter;
    elem.children = [
        elem.search ? { t: "h2", text: elem.search } : undefined,
        tableHeader({ state: state, fields: fields, groups: groups, sortable: sortable, data: data }),
        tableBody({ rows: rows, overrides: state.changes, state: state, fields: fields, groups: groups, disabled: disabled, sortable: sortable, subject: subject, fieldMap: fieldMap, editCell: updateRowAttribute, data: data }),
        { c: "table-adders", children: state.adders.map(function (row, ix) { return tableAdderRow({
                row: row,
                state: state,
                cellStates: state.adderCellStates[ix],
                fields: fields,
                disabled: adderDisabled,
                confirm: false,
                subject: subject,
                fieldMap: fieldMap,
                collections: collections,
                data: data,
                editCell: adderChanged
            }); }) },
        { c: "ion-checkmark-round commit-btn " + (stateValid ? "valid" : "invalid"), table: elem, click: stateValid && commitChanges }
    ];
    return elem;
}
exports.mappedTable = mappedTable;
function tableFilter(elem) {
    var key = elem.key, _a = elem.search, search = _a === void 0 ? undefined : _a, _b = elem.sortFields, sortFields = _b === void 0 ? undefined : _b;
    elem.children = [];
    if (sortFields) {
        var state = ui_1.uiState.widget.table[key] || { sortField: undefined, sortDirection: undefined };
        var sortOpts = [];
        for (var _i = 0; _i < sortFields.length; _i++) {
            var field = sortFields[_i];
            sortOpts.push({ t: "option", text: resolveName(field), value: field, selected: field === state.sortField });
        }
        elem.children.push({ c: "flex-grow" });
        elem.children.push({ c: "sort", children: [
                { text: "Sort by" },
                { t: "select", c: "select-sort-field select", value: state.sortField, children: sortOpts, key: key, change: sortTable },
                { c: "toggle-sort-dir " + (state.sortDirection === -1 ? "ion-arrow-up-b" : "ion-arrow-down-b"), key: key, direction: -state.sortDirection || 1, click: sortTable },
            ] });
    }
    elem.c = "table-filter " + (elem.c || "");
    return elem;
}
exports.tableFilter = tableFilter;
function externalLink(elem) {
    elem.t = "a";
    elem.c = "link " + (elem.c || "");
    elem.href = elem.url;
    elem.text = elem.text || elem.url;
    return elem;
}
exports.externalLink = externalLink;
function externalImage(elem) {
    elem.t = "img";
    elem.c = "img " + (elem.c || "");
    elem.src = elem.url;
    return elem;
}
exports.externalImage = externalImage;
function externalVideo(elem) {
    var ext = elem.url.slice(elem.url.lastIndexOf(".")).trim().toLowerCase();
    var domain = elem.url.slice(elem.url.indexOf("//") + 2).split("/")[0];
    var isFile = ["mp4", "ogv", "webm", "mov", "avi", "flv"].indexOf(ext) !== -1;
    if (isFile) {
        elem.t = "video";
    }
    else {
        elem.t = "iframe";
    }
    elem.c = "video " + (elem.c || "");
    elem.src = elem.url;
    elem.allowfullscreen = true;
    return elem;
}
exports.externalVideo = externalVideo;
function collapsible(elem) {
    if (elem.key === undefined)
        throw new Error("Must specify a key to maintain collapsible state");
    var state = ui_1.uiState.widget.collapsible[elem.key] || { open: elem.open !== undefined ? elem.open : true };
    var content = { children: elem.children };
    var header = { t: "header", children: [{ c: "collapse-toggle " + (state.open ? "ion-chevron-up" : "ion-chevron-down"), collapsible: elem.key, open: state.open, click: toggleCollapse }, elem.header] };
    elem.c = "collapsible " + (elem.c || "");
    elem.children = [header, state.open ? content : undefined];
    return elem;
}
exports.collapsible = collapsible;
function toggleCollapse(evt, elem) {
    app_1.dispatch("toggle collapse", { collapsible: elem.collapsible, open: !elem.open });
}
var directoryTileLayouts = [
    { size: 4, c: "big", format: function (elem) {
            // elem.children.unshift
            elem.children.push();
            return elem;
        } },
    { size: 2, c: "detailed", format: function (elem) {
            elem.children.push();
            return elem;
        } },
    { size: 1, c: "normal", grouped: 2 }
];
var directoryTileStyles = ["tile-style-1", "tile-style-2", "tile-style-3", "tile-style-4", "tile-style-5", "tile-style-6", "tile-style-7"];
function directory(elem) {
    var key = "directory|home"; // @TODO: FIXME
    var MAX_ENTITIES_BEFORE_OVERFLOW = 14;
    var rawEntities = elem.entities, _a = elem.data, data = _a === void 0 ? undefined : _a;
    var _b = classifyEntities(rawEntities), systems = _b.systems, collections = _b.collections, entities = _b.entities, scores = _b.scores, relatedCounts = _b.relatedCounts, wordCounts = _b.wordCounts, childCounts = _b.childCounts;
    var sortByScores = utils_1.sortByLookup(scores);
    entities.sort(sortByScores);
    collections.sort(sortByScores);
    systems.sort(sortByScores);
    var collectionTableState = ui_1.uiState.widget.table[(key + "|collections table")] || { sortField: "score", sortDirection: -1, adders: [] };
    ui_1.uiState.widget.table[(key + "|collections table")] = collectionTableState;
    var entityTableState = ui_1.uiState.widget.table[(key + "|entities table")] || { sortField: "score", sortDirection: -1, adders: [] };
    ui_1.uiState.widget.table[(key + "|entities table")] = entityTableState;
    // Link to entity
    // Peek with most significant statistic (e.g. 13 related; or 14 childrenpages; or 5000 words)
    // Slider pane will all statistics
    // Click opens popup preview
    function getStats(entity) {
        var stats = { name: entity, best: "", links: relatedCounts[entity], pages: childCounts[entity], words: wordCounts[entity] };
        var maxContribution = 0;
        for (var stat in stats) {
            if (!statWeights[stat])
                continue;
            var contribution = stats[stat] * statWeights[stat];
            if (contribution > maxContribution) {
                maxContribution = contribution;
                stats.best = stat;
            }
        }
        return stats;
    }
    function formatTile(entity) {
        var stats = getStats(entity);
        return { size: scores[entity], stats: stats, children: [
                link({ entity: entity, data: data, nameAsChild: true })
            ] };
    }
    function formatList(name, entities, state) {
        var sortOpts = [];
        for (var _i = 0, _a = ["score", "links", "words"]; _i < _a.length; _i++) {
            var field = _a[_i];
            sortOpts.push({ t: "option", text: resolveName(field), value: field, selected: field === state.sortField });
        }
        return { c: "directory-list flex-grow flex-row", children: [
                collapsible({ c: "flex-grow", key: key + "|" + name + " collapsible", header: { text: "Show all " + name }, open: false, children: [
                        { c: "flex-row", children: [
                                { c: "table-wrapper", children: [
                                        tableBody({ rows: entities.map(getStats), fields: ["name"].concat([state.sortField] || []), sortable: false, state: state, data: data }),
                                    ] },
                                { t: "select", c: "select-sort-field select", value: state.sortField, table: { state: state }, children: sortOpts, change: sortTable },
                            ] }
                    ] })
            ] };
    }
    collections = collections.filter(function (coll) { return ui_1.asEntity("test data") !== coll; });
    var highlights = collections.slice(0, 4).concat(entities.slice(0, 4));
    return { c: "directory flex-column", children: [
            { c: "header", children: [
                    { text: "Home" },
                ] },
            { c: "tile-scroll", children: [
                    { c: "tiles", children: [
                            { c: "row flex-row", children: [
                                    { c: "tile full", children: [
                                            { c: "tile-content-wrapper", children: [
                                                    { c: "value text", children: [
                                                            { text: "Welcome to Eve! Here are some of the cards currently in the system:" }
                                                        ] }
                                                ] }
                                        ] },
                                ] },
                            { c: "row flex-row", children: [
                                    exports.masonry({ c: "directory-highlights", rowSize: 6, layouts: directoryTileLayouts, styles: directoryTileStyles, children: highlights.map(formatTile) }),
                                ] }
                        ] }
                ] }
        ] };
}
exports.directory = directory;
exports.masonry = masonry_1.masonry;

},{"./app":9,"./masonry":11,"./ui":16,"./utils":19}],19:[function(require,module,exports){
var uuid_1 = require("../vendor/uuid");
exports.uuid = uuid_1.v4;
exports.ENV = "browser";
try {
    window;
    window["utils"] = exports;
}
catch (err) {
    exports.ENV = "node";
}
exports.DEBUG = {};
if (exports.ENV === "browser")
    window["DEBUG"] = exports.DEBUG;
function builtinId(name) {
    return "AUTOGENERATED " + name + " THIS SHOULDN'T SHOW UP ANYWHERE";
}
exports.builtinId = builtinId;
exports.unpad = function (indent) {
    if (exports.unpad.memo[indent])
        return exports.unpad.memo[indent];
    return exports.unpad.memo[indent] = function (strings) {
        var values = [];
        for (var _i = 1; _i < arguments.length; _i++) {
            values[_i - 1] = arguments[_i];
        }
        if (!strings.length)
            return;
        var res = "";
        var ix = 0;
        for (var _a = 0; _a < strings.length; _a++) {
            var str = strings[_a];
            res += str + (values.length > ix ? values[ix++] : "");
        }
        if (res[0] === "\n")
            res = res.slice(1);
        var charIx = 0;
        while (true) {
            res = res.slice(0, charIx) + res.slice(charIx + indent);
            charIx = res.indexOf("\n", charIx) + 1;
            if (!charIx)
                break;
        }
        return res;
    };
};
exports.unpad.memo = {};
function repeat(str, length) {
    var len = length / str.length;
    var res = "";
    for (var ix = 0; ix < len; ix++)
        res += str;
    return (res.length > length) ? res.slice(0, length) : res;
}
exports.repeat = repeat;
function underline(startIx, length) {
    return repeat(" ", startIx) + "^" + repeat("~", length - 1);
}
exports.underline = underline;
function capitalize(word) {
    return word[0].toUpperCase() + word.slice(1);
}
exports.capitalize = capitalize;
function titlecase(name) {
    return name.split(" ").map(capitalize).join(" ");
}
exports.titlecase = titlecase;
var _slugifyReplacements = {
    "-": "dash",
    "_": "under",
    "$": "dollar",
    "&": "and",
    "+": "plus",
    ",": "comma",
    "/": "slash",
    ":": "colon",
    ";": "semicolon",
    "=": "equals",
    "?": "question",
    "@": "at",
    "<": "lt",
    ">": "gt",
    "#": "hash",
    "%": "percent",
    "{": "opencurly",
    "}": "closecurly",
    "|": "pipe",
    "\\": "whack",
    "^": "caret",
    "~": "tilde",
    "[": "openbracket",
    "]": "closebracket",
    "`": "grave"
};
var _deslugifyReplacements = {};
for (var char in _slugifyReplacements) {
    _deslugifyReplacements[_slugifyReplacements[char]] = char;
}
// Slugify encodes a uri component in a fairly human readable fashion
function slugify(text) {
    var url = "";
    for (var _i = 0; _i < text.length; _i++) {
        var char = text[_i];
        var replacement = _slugifyReplacements[char];
        if (char === " ") {
            url += "_";
        }
        else if (replacement) {
            url += "-'" + replacement + "-";
        }
        else {
            url += char;
        }
    }
    return encodeURIComponent(url);
}
exports.slugify = slugify;
function deslugify(url) {
    var text = [];
    for (var _i = 0, _a = url.split("_"); _i < _a.length; _i++) {
        var word = _a[_i];
        if (word.indexOf("-") === -1) {
            text.push(word);
            continue;
        }
        var replaced = "";
        var tokens = word.split("-");
        replaced += tokens.shift();
        var tail_1 = tokens.pop();
        for (var _b = 0; _b < tokens.length; _b++) {
            var token = tokens[_b];
            var replacement = _deslugifyReplacements[token.slice(1)];
            if (replacement && token.indexOf("'") === 0) {
                replaced += replacement;
            }
            else {
                replaced += token;
            }
        }
        replaced += tail_1;
        text.push(replaced);
    }
    return decodeURIComponent(text.join(" "));
}
exports.deslugify = deslugify;
exports.string = {
    unpad: exports.unpad,
    repeat: repeat,
    underline: underline,
    capitalize: capitalize,
    titlecase: titlecase,
    slugify: slugify,
    deslugify: deslugify
};
function tail(arr) {
    return arr[arr.length - 1];
}
exports.tail = tail;
exports.array = {
    tail: tail
};
function coerceInput(input) {
    // http://jsperf.com/regex-vs-plus-coercion
    if (input === "")
        return input;
    else if (typeof input === "object")
        return input;
    else if (!isNaN(+input))
        return +input;
    else if (input === "true")
        return true;
    else if (input === "false")
        return false;
    return input;
}
exports.coerceInput = coerceInput;
// Shallow copy the given object.
function copy(obj) {
    if (!obj || typeof obj !== "object")
        return obj;
    if (obj instanceof Array)
        return obj.slice();
    var res = {};
    for (var key in obj)
        res[key] = obj[key];
    return res;
}
exports.copy = copy;
function mergeObject(root, obj) {
    for (var key in obj) {
        root[key] = obj[key];
    }
    return root;
}
exports.mergeObject = mergeObject;
function autoFocus(node, elem) {
    if (!node.focused) {
        node.focused = true;
        node.focus();
    }
}
exports.autoFocus = autoFocus;
exports.KEYS = {
    ESC: 27,
    ENTER: 13,
    UP: 38,
    DOWN: 40,
    BACKSPACE: 8,
    "]": 221,
};
// FROM: http://stackoverflow.com/questions/1125292/how-to-move-cursor-to-end-of-contenteditable-entity/3866442#3866442
function setEndOfContentEditable(contentEditableElement) {
    var range, selection;
    if (document.createRange) {
        range = document.createRange(); //Create a range (a range is a like the selection but invisible)
        range.selectNodeContents(contentEditableElement); //Select the entire contents of the element with the range
        range.collapse(false); //collapse the range to the end point. false means collapse to end rather than the start
        selection = window.getSelection(); //get the selection object (allows you to change selection)
        selection.removeAllRanges(); //remove any selections already made
        selection.addRange(range); //make the range you have just created the visible selection
    }
}
exports.setEndOfContentEditable = setEndOfContentEditable;
// LCG courtesy of <https://gist.github.com/Protonk/5389384>
function srand(z) {
    var m = Math.pow(2, 24), a = 16598013, c = 12820163;
    return function () { return z = (a * z + c) % m / m; };
}
exports.srand = srand;
function shuffle(arr, rand) {
    if (rand === void 0) { rand = Math.random; }
    for (var i = arr.length - 1; i > 0; i -= 1) {
        var j = Math.floor(rand() * (i + 1));
        var tmp = arr[i];
        arr[i] = arr[j];
        arr[j] = tmp;
    }
    return arr;
}
exports.shuffle = shuffle;
function sortByField(field, direction) {
    if (direction === void 0) { direction = 1; }
    var back = -1 * direction;
    var fwd = direction;
    return function (a, b) {
        return (a[field] === b[field]) ? 0 :
            (a[field] > b[field]) ? back :
                (a[field] < b[field]) ? fwd :
                    (a[field] === undefined) ? fwd : back;
    };
}
exports.sortByField = sortByField;
function sortByLookup(lookup, direction) {
    if (direction === void 0) { direction = 1; }
    var back = -1 * direction;
    var fwd = direction;
    return function (a, b) {
        return (lookup[a] === lookup[b]) ? 0 :
            (lookup[a] > lookup[b]) ? back :
                (lookup[a] < lookup[b]) ? fwd :
                    (lookup[a] === undefined) ? fwd : back;
    };
}
exports.sortByLookup = sortByLookup;
function location() {
    return window.location.hash.slice(1);
}
exports.location = location;

},{"../vendor/uuid":22}],20:[function(require,module,exports){
"use strict";
var app = require("./app");
var bootstrap = require("./bootstrap");
var ui = require("./ui");
var utils_1 = require("./utils");
app.renderRoots["wiki"] = ui.root;
// @HACK: we have to use bootstrap in some way to get it to actually be included and
// executed
var ixer = bootstrap.ixer;
function initSearches(eve) {
    for (var _i = 0, _a = eve.find("ui pane"); _i < _a.length; _i++) {
        var pane = _a[_i];
        if (eve.findOne("entity", { entity: pane.contains }))
            continue;
    }
}
app.init("wiki", function () {
    document.body.classList.add(localStorage["theme"] || "light");
    app.activeSearches = {};
    initSearches(app.eve);
    window.history.replaceState({ root: true }, null, window.location.hash);
    var mainPane = app.eve.findOne("ui pane", { pane: "p1" });
    var path = utils_1.location();
    var _a = path.split("/"), _ = _a[0], kind = _a[1], _b = _a[2], raw = _b === void 0 ? "" : _b;
    var content = utils_1.deslugify(raw) || "home";
    var cur = app.dispatch("set pane", { paneId: mainPane.pane, contains: content });
    if (content && !app.eve.findOne("query to id", { query: content })) {
        cur.dispatch("insert query", { query: content });
    }
    cur.commit();
});
window.addEventListener("hashchange", function () {
    var mainPane = app.eve.findOne("ui pane", { pane: "p1" });
    var path = utils_1.location();
    var _a = path.split("/"), _ = _a[0], kind = _a[1], _b = _a[2], raw = _b === void 0 ? "" : _b;
    var content = utils_1.deslugify(raw) || "home";
    content = ui.asEntity(content) || content;
    if (mainPane.contains === content)
        return;
    var cur = app.dispatch("set pane", { paneId: mainPane.pane, contains: content });
    if (content && !app.eve.findOne("query to id", { query: content })) {
        cur.dispatch("insert query", { query: content });
    }
    cur.commit();
});

},{"./app":9,"./bootstrap":10,"./ui":16,"./utils":19}],21:[function(require,module,exports){

},{}],22:[function(require,module,exports){
//     uuid.js
//
//     Copyright (c) 2010-2012 Robert Kieffer
//     MIT License - http://opensource.org/licenses/mit-license.php

(function() {
  var _global = this;

  // Unique ID creation requires a high quality random # generator.  We feature
  // detect to determine the best RNG source, normalizing to a function that
  // returns 128-bits of randomness, since that's what's usually required
  var _rng;

  // Node.js crypto-based RNG - http://nodejs.org/docs/v0.6.2/api/crypto.html
  //
  // Moderately fast, high quality
  if (typeof(_global.require) == 'function') {
    try {
      var _rb = _global.require('crypto').randomBytes;
      _rng = _rb && function() {return _rb(16);};
    } catch(e) {}
  }

  if (!_rng && _global.crypto && crypto.getRandomValues) {
    // WHATWG crypto-based RNG - http://wiki.whatwg.org/wiki/Crypto
    //
    // Moderately fast, high quality
    var _rnds8 = new Uint8Array(16);
    _rng = function whatwgRNG() {
      crypto.getRandomValues(_rnds8);
      return _rnds8;
    };
  }

  if (!_rng) {
    // Math.random()-based (RNG)
    //
    // If all else fails, use Math.random().  It's fast, but is of unspecified
    // quality.
    var  _rnds = new Array(16);
    _rng = function() {
      for (var i = 0, r; i < 16; i++) {
        if ((i & 0x03) === 0) r = Math.random() * 0x100000000;
        _rnds[i] = r >>> ((i & 0x03) << 3) & 0xff;
      }

      return _rnds;
    };
  }

  // Buffer class to use
  var BufferClass = typeof(_global.Buffer) == 'function' ? _global.Buffer : Array;

  // Maps for number <-> hex string conversion
  var _byteToHex = [];
  var _hexToByte = {};
  for (var i = 0; i < 256; i++) {
    _byteToHex[i] = (i + 0x100).toString(16).substr(1);
    _hexToByte[_byteToHex[i]] = i;
  }

  // **`parse()` - Parse a UUID into it's component bytes**
  function parse(s, buf, offset) {
    var i = (buf && offset) || 0, ii = 0;

    buf = buf || [];
    s.toLowerCase().replace(/[0-9a-f]{2}/g, function(oct) {
      if (ii < 16) { // Don't overflow!
        buf[i + ii++] = _hexToByte[oct];
      }
    });

    // Zero out remaining bytes if string was short
    while (ii < 16) {
      buf[i + ii++] = 0;
    }

    return buf;
  }

  // **`unparse()` - Convert UUID byte array (ala parse()) into a string**
  function unparse(buf, offset) {
    var i = offset || 0, bth = _byteToHex;
    return  bth[buf[i++]] + bth[buf[i++]] +
            bth[buf[i++]] + bth[buf[i++]] + '-' +
            bth[buf[i++]] + bth[buf[i++]] + '-' +
            bth[buf[i++]] + bth[buf[i++]] + '-' +
            bth[buf[i++]] + bth[buf[i++]] + '-' +
            bth[buf[i++]] + bth[buf[i++]] +
            bth[buf[i++]] + bth[buf[i++]] +
            bth[buf[i++]] + bth[buf[i++]];
  }

  // **`v1()` - Generate time-based UUID**
  //
  // Inspired by https://github.com/LiosK/UUID.js
  // and http://docs.python.org/library/uuid.html

  // random #'s we need to init node and clockseq
  var _seedBytes = _rng();

  // Per 4.5, create and 48-bit node id, (47 random bits + multicast bit = 1)
  var _nodeId = [
    _seedBytes[0] | 0x01,
    _seedBytes[1], _seedBytes[2], _seedBytes[3], _seedBytes[4], _seedBytes[5]
  ];

  // Per 4.2.2, randomize (14 bit) clockseq
  var _clockseq = (_seedBytes[6] << 8 | _seedBytes[7]) & 0x3fff;

  // Previous uuid creation time
  var _lastMSecs = 0, _lastNSecs = 0;

  // See https://github.com/broofa/node-uuid for API details
  function v1(options, buf, offset) {
    var i = buf && offset || 0;
    var b = buf || [];

    options = options || {};

    var clockseq = options.clockseq != null ? options.clockseq : _clockseq;

    // UUID timestamps are 100 nano-second units since the Gregorian epoch,
    // (1582-10-15 00:00).  JSNumbers aren't precise enough for this, so
    // time is handled internally as 'msecs' (integer milliseconds) and 'nsecs'
    // (100-nanoseconds offset from msecs) since unix epoch, 1970-01-01 00:00.
    var msecs = options.msecs != null ? options.msecs : new Date().getTime();

    // Per 4.2.1.2, use count of uuid's generated during the current clock
    // cycle to simulate higher resolution clock
    var nsecs = options.nsecs != null ? options.nsecs : _lastNSecs + 1;

    // Time since last uuid creation (in msecs)
    var dt = (msecs - _lastMSecs) + (nsecs - _lastNSecs)/10000;

    // Per 4.2.1.2, Bump clockseq on clock regression
    if (dt < 0 && options.clockseq == null) {
      clockseq = clockseq + 1 & 0x3fff;
    }

    // Reset nsecs if clock regresses (new clockseq) or we've moved onto a new
    // time interval
    if ((dt < 0 || msecs > _lastMSecs) && options.nsecs == null) {
      nsecs = 0;
    }

    // Per 4.2.1.2 Throw error if too many uuids are requested
    if (nsecs >= 10000) {
      throw new Error('uuid.v1(): Can\'t create more than 10M uuids/sec');
    }

    _lastMSecs = msecs;
    _lastNSecs = nsecs;
    _clockseq = clockseq;

    // Per 4.1.4 - Convert from unix epoch to Gregorian epoch
    msecs += 12219292800000;

    // `time_low`
    var tl = ((msecs & 0xfffffff) * 10000 + nsecs) % 0x100000000;
    b[i++] = tl >>> 24 & 0xff;
    b[i++] = tl >>> 16 & 0xff;
    b[i++] = tl >>> 8 & 0xff;
    b[i++] = tl & 0xff;

    // `time_mid`
    var tmh = (msecs / 0x100000000 * 10000) & 0xfffffff;
    b[i++] = tmh >>> 8 & 0xff;
    b[i++] = tmh & 0xff;

    // `time_high_and_version`
    b[i++] = tmh >>> 24 & 0xf | 0x10; // include version
    b[i++] = tmh >>> 16 & 0xff;

    // `clock_seq_hi_and_reserved` (Per 4.2.2 - include variant)
    b[i++] = clockseq >>> 8 | 0x80;

    // `clock_seq_low`
    b[i++] = clockseq & 0xff;

    // `node`
    var node = options.node || _nodeId;
    for (var n = 0; n < 6; n++) {
      b[i + n] = node[n];
    }

    return buf ? buf : unparse(b);
  }

  // **`v4()` - Generate random UUID**

  // See https://github.com/broofa/node-uuid for API details
  function v4(options, buf, offset) {
    // Deprecated - 'format' argument, as supported in v1.2
    var i = buf && offset || 0;

    if (typeof(options) == 'string') {
      buf = options == 'binary' ? new BufferClass(16) : null;
      options = null;
    }
    options = options || {};

    var rnds = options.random || (options.rng || _rng)();

    // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`
    rnds[6] = (rnds[6] & 0x0f) | 0x40;
    rnds[8] = (rnds[8] & 0x3f) | 0x80;

    // Copy bytes to buffer, if provided
    if (buf) {
      for (var ii = 0; ii < 16; ii++) {
        buf[i + ii] = rnds[ii];
      }
    }

    return buf || unparse(rnds);
  }

  // Export public API
  var uuid = v4;
  uuid.v1 = v1;
  uuid.v4 = v4;
  uuid.parse = parse;
  uuid.unparse = unparse;
  uuid.BufferClass = BufferClass;

  if (typeof define === 'function' && define.amd) {
    // Publish as AMD module
    define(function() {return uuid;});
  } else if (typeof(module) != 'undefined' && module.exports) {
    // Publish as node.js module
    module.exports = uuid;
  } else {
    // Publish as global (in browsers)
    var _previousRoot = _global.uuid;

    // **`noConflict()` - (browser only) to reset global 'uuid' var**
    uuid.noConflict = function() {
      _global.uuid = _previousRoot;
      return uuid;
    };

    _global.uuid = uuid;
  }
}).call(this);

},{}]},{},[20,21])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJub2RlX21vZHVsZXMvY29kZW1pcnJvci9hZGRvbi9tb2RlL292ZXJsYXkuanMiLCJub2RlX21vZHVsZXMvY29kZW1pcnJvci9saWIvY29kZW1pcnJvci5qcyIsIm5vZGVfbW9kdWxlcy9jb2RlbWlycm9yL21vZGUvY2xvanVyZS9jbG9qdXJlLmpzIiwibm9kZV9tb2R1bGVzL2NvZGVtaXJyb3IvbW9kZS9nZm0vZ2ZtLmpzIiwibm9kZV9tb2R1bGVzL2NvZGVtaXJyb3IvbW9kZS9tYXJrZG93bi9tYXJrZG93bi5qcyIsIm5vZGVfbW9kdWxlcy9jb2RlbWlycm9yL21vZGUvbWV0YS5qcyIsIm5vZGVfbW9kdWxlcy9jb2RlbWlycm9yL21vZGUveG1sL3htbC5qcyIsInNyYy9OTFF1ZXJ5UGFyc2VyLnRzIiwic3JjL2FwcC50cyIsInNyYy9ib290c3RyYXAudHMiLCJzcmMvbWFzb25yeS50cyIsInNyYy9taWNyb1JlYWN0LnRzIiwic3JjL3BhcnNlci50cyIsInNyYy9yaWNoVGV4dEVkaXRvci50cyIsInNyYy9ydW50aW1lLnRzIiwic3JjL3VpLnRzIiwic3JjL3VpUmVuZGVyZXIudHMiLCJzcmMvdWl0ay50cyIsInNyYy91dGlscy50cyIsInNyYy93aWtpLnRzIiwidHlwaW5ncy90c2QuZC50cyIsInZlbmRvci91dWlkLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNyRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMxclJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3pQQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2xJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDbnlCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN6TUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMxWUEsb0JBQWtCLE9BQU8sQ0FBQyxDQUFBO0FBaUIxQixXQUFZLFNBQVM7SUFDbkIsNkNBQU0sQ0FBQTtJQUNOLHFEQUFVLENBQUE7SUFDVixtREFBUyxDQUFBO0lBQ1QsNkNBQU0sQ0FBQTtJQUNOLDZDQUFNLENBQUE7SUFDTixpREFBUSxDQUFBO0FBQ1YsQ0FBQyxFQVBXLGlCQUFTLEtBQVQsaUJBQVMsUUFPcEI7QUFQRCxJQUFZLFNBQVMsR0FBVCxpQkFPWCxDQUFBO0FBUUQsV0FBWSxPQUFPO0lBQ2pCLHVDQUFLLENBQUE7SUFDTCx5Q0FBTSxDQUFBO0lBQ04sNkNBQVEsQ0FBQTtJQUNSLDZDQUFRLENBQUE7QUFDVixDQUFDLEVBTFcsZUFBTyxLQUFQLGVBQU8sUUFLbEI7QUFMRCxJQUFZLE9BQU8sR0FBUCxlQUtYLENBQUE7QUFFRCx1QkFBdUI7QUFDdkIsZUFBc0IsV0FBbUIsRUFBRSxTQUFrQjtJQUMzRCxJQUFJLElBQVUsQ0FBQztJQUNmLElBQUksT0FBZ0IsQ0FBQztJQUNyQixJQUFJLE1BQW9CLENBQUM7SUFDekIscURBQXFEO0lBQ3JELEVBQUUsQ0FBQyxDQUFDLFNBQVMsS0FBSyxTQUFTLENBQUMsQ0FBQyxDQUFDO1FBQzVCLElBQUksU0FBUyxHQUFHLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUNqQyxTQUFTLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDM0MsSUFBSSxHQUFHLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUMxQixJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQztRQUNsQixPQUFPLEdBQUcsVUFBVSxFQUFFLENBQUM7UUFDdkIsTUFBTSxHQUFHLENBQUMsU0FBUyxDQUFDLENBQUM7SUFFdkIsQ0FBQztJQUFDLElBQUksQ0FBQyxDQUFDO1FBQ04sSUFBSSxHQUFHLFNBQVMsQ0FBQyxJQUFJLENBQUM7UUFDdEIsT0FBTyxHQUFHLFNBQVMsQ0FBQyxPQUFPLENBQUM7UUFDNUIsTUFBTSxHQUFHLFNBQVMsQ0FBQyxNQUFNLENBQUM7SUFDNUIsQ0FBQztJQUNELHlDQUF5QztJQUN6QyxJQUFJLEtBQUssR0FBRyxvQkFBb0IsQ0FBQyxXQUFXLENBQUMsQ0FBQztJQUM5QyxHQUFHLENBQUMsQ0FBYSxVQUFLLEVBQWpCLGlCQUFRLEVBQVIsSUFBaUIsQ0FBQztRQUFsQixJQUFJLElBQUksR0FBSSxLQUFLLElBQVQ7UUFDWCxlQUFlO1FBQ2YsSUFBSSxLQUFLLEdBQUcsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzVCLCtCQUErQjtRQUMvQixJQUFJLFNBQVMsR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQztRQUMxQyxTQUFTLENBQUMsSUFBSSxHQUFHLEtBQUssQ0FBQztRQUN2QixLQUFLLENBQUMsSUFBSSxHQUFHLFNBQVMsQ0FBQztRQUN2QixNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ25CLDRCQUE0QjtRQUM1QixJQUFJLElBQUksR0FBRyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDMUIsSUFBSSxVQUFVLEdBQUcsUUFBUSxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsT0FBTyxDQUFDLENBQUM7UUFDL0MsSUFBSSxHQUFHLFVBQVUsQ0FBQyxJQUFJLENBQUM7UUFDdkIsT0FBTyxHQUFHLFVBQVUsQ0FBQyxPQUFPLENBQUM7S0FDOUI7SUFDRCxpQkFBaUI7SUFDakIsT0FBTyxDQUFDLFFBQVEsR0FBRyxPQUFPLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxVQUFDLENBQUMsSUFBSyxPQUFBLENBQUMsQ0FBQyxXQUFXLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsV0FBVyxDQUFDLFVBQVUsQ0FBQyxRQUFRLENBQUMsRUFBOUcsQ0FBOEcsQ0FBQyxDQUFDO0lBQy9KLE9BQU8sQ0FBQyxXQUFXLEdBQUcsT0FBTyxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsVUFBQyxDQUFDLElBQUssT0FBQSxDQUFDLENBQUMsV0FBVyxDQUFDLFVBQVUsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxXQUFXLENBQUMsVUFBVSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDLEVBQWxILENBQWtILENBQUMsQ0FBQztJQUN0SyxPQUFPLENBQUMsVUFBVSxHQUFHLE9BQU8sQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLFVBQUMsQ0FBQyxJQUFLLE9BQUEsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxVQUFVLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsV0FBVyxDQUFDLFVBQVUsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxXQUFXLENBQUMsVUFBVSxDQUFDLFFBQVEsQ0FBQyxFQUFqSCxDQUFpSCxDQUFDLENBQUM7SUFDcEssT0FBTyxDQUFDLGVBQWUsR0FBRyxPQUFPLENBQUMsZUFBZSxDQUFDLE1BQU0sQ0FBQyxVQUFDLENBQUMsSUFBSyxPQUFBLENBQUMsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsS0FBSyxFQUEvQyxDQUErQyxDQUFDLENBQUM7SUFDakgsT0FBTyxDQUFDLGdCQUFnQixHQUFHLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxNQUFNLENBQUMsVUFBQyxDQUFDLElBQUssT0FBQSxDQUFDLENBQUMsQ0FBQyxXQUFXLENBQUMsVUFBVSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEtBQUssRUFBL0MsQ0FBK0MsQ0FBQyxDQUFDO0lBQ25ILE9BQU8sQ0FBQyxhQUFhLEdBQUcsT0FBTyxDQUFDLGFBQWEsQ0FBQyxNQUFNLENBQUMsVUFBQyxDQUFDLElBQUssT0FBQSxDQUFDLENBQUMsQ0FBQyxXQUFXLENBQUMsVUFBVSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEtBQUssRUFBL0MsQ0FBK0MsQ0FBQyxDQUFDO0lBRTdHLGlCQUFpQjtJQUNqQixJQUFJLE1BQU0sR0FBRyxPQUFPLENBQUMsUUFBUSxDQUFDO0lBQzlCLElBQUksS0FBSyxHQUFHLFFBQVEsRUFBRSxDQUFDO0lBQ3ZCLElBQUksYUFBYSxHQUFHLEVBQUUsQ0FBQztJQUN2QixFQUFFLENBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ25CLElBQUksT0FBTyxHQUFHLE9BQU8sQ0FBQyxZQUFZLENBQUMsTUFBTSxDQUFDLFVBQUMsQ0FBQyxJQUFLLE9BQUEsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxJQUFJLEtBQUssYUFBYSxDQUFDLE1BQU0sRUFBbkMsQ0FBbUMsQ0FBQyxDQUFDO1FBQ3RGLEVBQUUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUN2QixNQUFNLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBQztZQUN4QixxQkFBcUI7WUFDckIsR0FBRyxDQUFDLENBQWUsVUFBTyxFQUFyQixtQkFBVSxFQUFWLElBQXFCLENBQUM7Z0JBQXRCLElBQUksTUFBTSxHQUFJLE9BQU8sSUFBWDtnQkFDYixFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxVQUFDLENBQUMsSUFBSyxPQUFBLENBQUMsQ0FBQyxLQUFLLEVBQVAsQ0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDO29CQUMxQyw4REFBOEQ7b0JBQzlELEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLE1BQU0sR0FBRyxDQUFDLElBQUksTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLFVBQUMsQ0FBQyxJQUFLLE9BQUEsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUF2QixDQUF1QixDQUFDLENBQUMsQ0FBQyxDQUFDO3dCQUNoSCxJQUFJLEtBQUssR0FBRyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsVUFBQyxDQUFDLElBQUssT0FBQSxDQUFDLENBQUMsSUFBSSxFQUFOLENBQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQzt3QkFDckUsSUFBSSxNQUFNLEdBQUcsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDO3dCQUM3QixJQUFJLEtBQUssR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7d0JBQzVCLEtBQUssQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDO3dCQUNuQixLQUFLLENBQUMsSUFBSSxHQUFHLFNBQVMsQ0FBQyxNQUFNLENBQUM7d0JBQzlCLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsQ0FBQzt3QkFDNUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUM7b0JBQ3JDLENBQUM7b0JBQ0QsSUFBSSxZQUFZLEdBQVc7d0JBQ3pCLE1BQU0sRUFBRSxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7d0JBQ3RDLFNBQVMsRUFBRSxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7d0JBQ3pDLEtBQUssRUFBRSxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7cUJBQ3RDLENBQUE7b0JBQ0QsYUFBYSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQztnQkFDbkMsQ0FBQzthQUNGO1FBQ0gsQ0FBQztRQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxPQUFPLENBQUMsZUFBZSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzlDLE1BQU0sR0FBRyxPQUFPLENBQUMsUUFBUSxDQUFDO1FBRTVCLENBQUM7UUFBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxNQUFNLEdBQUcsQ0FBQztZQUN4QixDQUFDLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsVUFBQyxDQUFDLElBQUssT0FBQSxDQUFDLENBQUMsU0FBUyxDQUFDLElBQUksS0FBSyxTQUFTLElBQUksQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDLEVBQTVFLENBQTRFLENBQUMsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO2dCQUM1SCxDQUFDLE9BQU8sQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLFVBQUMsQ0FBQyxJQUFLLE9BQUEsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUE1QixDQUE0QixDQUFDLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3pGLE1BQU0sR0FBRyxPQUFPLENBQUMsUUFBUSxDQUFDO1FBQzVCLENBQUM7UUFBQyxJQUFJLENBQUMsQ0FBQztZQUNOLE1BQU0sR0FBRyxPQUFPLENBQUMsS0FBSyxDQUFDO1FBQ3pCLENBQUM7SUFDSCxDQUFDO0lBQ0QsRUFBRSxDQUFDLENBQUMsTUFBTSxLQUFLLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO1FBQzdCLHFDQUFxQztRQUNyQyxNQUFNLEdBQUcsT0FBTyxDQUFDLEtBQUssQ0FBQztRQUN2QixHQUFHLENBQUMsbUJBQW1CLENBQUMsQ0FBQztRQUN6QixLQUFLLEdBQUcsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3hCLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsTUFBTSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDaEMsTUFBTSxHQUFHLE9BQU8sQ0FBQyxRQUFRLENBQUM7WUFDMUIsS0FBSyxHQUFHLFFBQVEsRUFBRSxDQUFDO1FBQ3JCLENBQUM7SUFDSCxDQUFDO0lBRUQsTUFBTSxDQUFDLENBQUMsRUFBQyxNQUFNLEVBQUUsTUFBTSxFQUFFLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsT0FBTyxFQUFFLGFBQWEsRUFBQyxDQUFDLENBQUM7QUFDaEgsQ0FBQztBQTlGZSxhQUFLLFFBOEZwQixDQUFBO0FBRUQsa0RBQWtEO0FBQ2xELDZDQUE2QztBQUM3QyxzQkFBc0IsSUFBVTtJQUM5QixFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxLQUFLLEtBQUssQ0FBQyxDQUFDLENBQUM7UUFDekIsTUFBTSxDQUFDLEtBQUssQ0FBQztJQUNmLENBQUM7SUFBQyxJQUFJLENBQUMsQ0FBQztRQUNOLElBQUksY0FBYyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBQ3JELE1BQU0sQ0FBQyxjQUFjLENBQUMsS0FBSyxDQUFDLFVBQUMsS0FBSyxJQUFLLE9BQUEsS0FBSyxLQUFLLElBQUksRUFBZCxDQUFjLENBQUMsQ0FBQztJQUN6RCxDQUFDO0FBQ0gsQ0FBQztBQU9ELHNFQUFzRTtBQUN0RSw4QkFBcUMsV0FBbUI7SUFDdEQsMERBQTBEO0lBQzFELElBQUkscUJBQXFCLEdBQUcsV0FBVyxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUMsS0FBSyxDQUFDLENBQUM7SUFDNUQscUJBQXFCLEdBQUcscUJBQXFCLENBQUMsT0FBTyxDQUFDLElBQUksRUFBQyxLQUFLLENBQUMsQ0FBQztJQUNsRSxxQkFBcUIsR0FBRyxxQkFBcUIsQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ25FLHFCQUFxQixHQUFHLHFCQUFxQixDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUMsS0FBSyxDQUFDLENBQUM7SUFDbkUscUJBQXFCLEdBQUcscUJBQXFCLENBQUMsT0FBTyxDQUFDLElBQUksRUFBQyxLQUFLLENBQUMsQ0FBQztJQUNsRSxxQkFBcUIsR0FBRyxxQkFBcUIsQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ25FLHFCQUFxQixHQUFHLHFCQUFxQixDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUMsS0FBSyxDQUFDLENBQUM7SUFDbkUscUJBQXFCLEdBQUcscUJBQXFCLENBQUMsT0FBTyxDQUFDLElBQUksRUFBQyxLQUFLLENBQUMsQ0FBQztJQUNsRSwyQkFBMkI7SUFDM0IscUJBQXFCLEdBQUcscUJBQXFCLENBQUMsT0FBTyxDQUFDLE1BQU0sRUFBQyxPQUFPLENBQUMsQ0FBQztJQUN0RSxxQkFBcUIsR0FBRyxxQkFBcUIsQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQ3JFLG1EQUFtRDtJQUNuRCxxQkFBcUIsR0FBRyxxQkFBcUIsQ0FBQyxPQUFPLENBQUMsb0RBQW9ELEVBQUMsR0FBRyxDQUFDLENBQUM7SUFDaEgseUJBQXlCO0lBQ3pCLHFCQUFxQixHQUFHLHFCQUFxQixDQUFDLE9BQU8sQ0FBQyxNQUFNLEVBQUMsR0FBRyxDQUFDLENBQUM7SUFDbEUsNEJBQTRCO0lBQzVCLElBQUksWUFBWSxHQUFHLHFCQUFxQixDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUNwRCxJQUFJLEtBQUssR0FBRyxZQUFZLENBQUMsR0FBRyxDQUFDLFVBQUMsSUFBSSxFQUFFLENBQUMsSUFBTSxNQUFNLENBQUMsRUFBQyxFQUFFLEVBQUUsQ0FBQyxHQUFHLENBQUMsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFDLENBQUMsQ0FBQSxDQUFDLENBQUMsQ0FBQztJQUM3RSxLQUFLLEdBQUcsS0FBSyxDQUFDLE1BQU0sQ0FBQyxVQUFDLElBQUksSUFBSyxPQUFBLElBQUksQ0FBQyxJQUFJLEtBQUssRUFBRSxFQUFoQixDQUFnQixDQUFDLENBQUM7SUFDakQsTUFBTSxDQUFDLEtBQUssQ0FBQztBQUNmLENBQUM7QUF0QmUsNEJBQW9CLHVCQXNCbkMsQ0FBQTtBQUVELHlCQUFnQyxXQUFtQjtJQUNqRCwwREFBMEQ7SUFDMUQsSUFBSSxVQUFVLEdBQUcsV0FBVyxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUMsS0FBSyxDQUFDLENBQUM7SUFDakQsVUFBVSxHQUFHLFVBQVUsQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFDLEtBQUssQ0FBQyxDQUFDO0lBQzVDLFVBQVUsR0FBRyxVQUFVLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBQyxLQUFLLENBQUMsQ0FBQztJQUM3QyxVQUFVLEdBQUcsVUFBVSxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUMsS0FBSyxDQUFDLENBQUM7SUFDN0MsVUFBVSxHQUFHLFVBQVUsQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFDLEtBQUssQ0FBQyxDQUFDO0lBQzVDLFVBQVUsR0FBRyxVQUFVLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBQyxLQUFLLENBQUMsQ0FBQztJQUM3QyxVQUFVLEdBQUcsVUFBVSxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUMsS0FBSyxDQUFDLENBQUM7SUFDN0MsVUFBVSxHQUFHLFVBQVUsQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFDLEtBQUssQ0FBQyxDQUFDO0lBQzVDLDJCQUEyQjtJQUMzQixVQUFVLEdBQUcsVUFBVSxDQUFDLE9BQU8sQ0FBQyxNQUFNLEVBQUMsT0FBTyxDQUFDLENBQUM7SUFDaEQsVUFBVSxHQUFHLFVBQVUsQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQy9DLG1EQUFtRDtJQUNuRCxVQUFVLEdBQUcsVUFBVSxDQUFDLE9BQU8sQ0FBQyxvREFBb0QsRUFBQyxHQUFHLENBQUMsQ0FBQztJQUMxRix5QkFBeUI7SUFDekIsVUFBVSxHQUFHLFVBQVUsQ0FBQyxPQUFPLENBQUMsTUFBTSxFQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQzVDLFVBQVUsR0FBRyxVQUFVLENBQUMsV0FBVyxFQUFFLENBQUM7SUFDdEMsVUFBVSxHQUFHLFdBQVcsQ0FBQyxVQUFVLENBQUMsQ0FBQztJQUNyQyxNQUFNLENBQUMsVUFBVSxDQUFDO0FBQ3BCLENBQUM7QUFwQmUsdUJBQWUsa0JBb0I5QixDQUFBO0FBRUQsK0VBQStFO0FBQy9FLGtCQUFrQjtBQUNsQiwrRUFBK0U7QUFFL0UsSUFBSyxrQkFVSjtBQVZELFdBQUssa0JBQWtCO0lBQ3JCLDJEQUFJLENBQUE7SUFDSiwyREFBSSxDQUFBO0lBQ0oscUVBQVMsQ0FBQTtJQUNULCtEQUFNLENBQUE7SUFDTiwyREFBSSxDQUFBO0lBQ0osNkRBQUssQ0FBQTtJQUNMLDJEQUFJLENBQUE7SUFDSiwrREFBTSxDQUFBO0lBQ04sK0RBQU0sQ0FBQTtBQUNSLENBQUMsRUFWSSxrQkFBa0IsS0FBbEIsa0JBQWtCLFFBVXRCO0FBRUQsSUFBSyxrQkFpRUo7QUFqRUQsV0FBSyxrQkFBa0I7SUFDckIsMkRBQUksQ0FBQTtJQUNKLE9BQU87SUFDUCx1REFBRSxDQUFBO0lBQ0YseURBQUcsQ0FBQTtJQUNILHlEQUFHLENBQUE7SUFDSCx5REFBRyxDQUFBO0lBQ0gseURBQUcsQ0FBQTtJQUNILHlEQUFHLENBQUE7SUFDSCx1REFBRSxDQUFBO0lBQ0YseURBQUcsQ0FBQTtJQUNILFlBQVk7SUFDWix1REFBRSxDQUFBO0lBQ0YsMERBQUcsQ0FBQTtJQUNILDBEQUFHLENBQUE7SUFDSCxTQUFTO0lBQ1Qsd0RBQUUsQ0FBQTtJQUNGLDBEQUFHLENBQUE7SUFDSCwwREFBRyxDQUFBO0lBQ0gsT0FBTztJQUNQLHdEQUFFLENBQUE7SUFDRiw0REFBSSxDQUFBO0lBQ0osNERBQUksQ0FBQTtJQUNKLHdEQUFFLENBQUE7SUFDRiwwREFBRyxDQUFBO0lBQ0gsd0RBQUUsQ0FBQTtJQUNGLGNBQWM7SUFDZCwwREFBRyxDQUFBO0lBQ0gsNERBQUksQ0FBQTtJQUNKLDBEQUFHLENBQUE7SUFDSCwwREFBRyxDQUFBO0lBQ0gsMERBQUcsQ0FBQTtJQUNILDBEQUFHLENBQUE7SUFDSCxPQUFPO0lBQ1Asd0RBQUUsQ0FBQTtJQUNGLHdEQUFFLENBQUE7SUFDRix3REFBRSxDQUFBO0lBQ0Ysd0RBQUUsQ0FBQTtJQUNGLDBEQUFHLENBQUE7SUFDSCx3REFBRSxDQUFBO0lBQ0Ysd0RBQUUsQ0FBQTtJQUNGLHdEQUFFLENBQUE7SUFDRixRQUFRO0lBQ1Isd0RBQUUsQ0FBQTtJQUNGLHdEQUFFLENBQUE7SUFDRix3REFBRSxDQUFBO0lBQ0YsU0FBUztJQUNULHdEQUFFLENBQUE7SUFDRix3REFBRSxDQUFBO0lBQ0YsMERBQUcsQ0FBQTtJQUNILDBEQUFHLENBQUE7SUFDSCx3REFBRSxDQUFBO0lBQ0YsMERBQUcsQ0FBQTtJQUNILDREQUFJLENBQUE7SUFDSiw4REFBSyxDQUFBO0lBQ0wsMERBQUcsQ0FBQTtJQUNILDBEQUFHLENBQUE7SUFDSCwwREFBRyxDQUFBO0lBQ0gsMERBQUcsQ0FBQTtJQUNILDBEQUFHLENBQUE7SUFDSCxXQUFXO0lBQ1gsMERBQUcsQ0FBQTtJQUNILHdEQUFFLENBQUE7SUFDRiwwREFBRyxDQUFBO0lBQ0gsMERBQUcsQ0FBQSxDQUFHLHlDQUF5QztBQUNqRCxDQUFDLEVBakVJLGtCQUFrQixLQUFsQixrQkFBa0IsUUFpRXRCO0FBZUQsa0JBQWtCLElBQVk7SUFDNUIsSUFBSSxLQUFLLEdBQUcsU0FBUyxDQUFDLEVBQUMsRUFBRSxFQUFFLENBQUMsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFDLENBQUMsQ0FBQztJQUMzQyxLQUFLLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDLENBQUM7SUFDM0MsTUFBTSxDQUFDLEtBQUssQ0FBQztBQUNmLENBQUM7QUFFRCxvQkFBb0IsS0FBWTtJQUM5QixJQUFJLEtBQUssR0FBVTtRQUNqQixFQUFFLEVBQUUsS0FBSyxDQUFDLEVBQUU7UUFDWixZQUFZLEVBQUUsS0FBSyxDQUFDLFlBQVk7UUFDaEMsY0FBYyxFQUFFLEtBQUssQ0FBQyxjQUFjO1FBQ3BDLEdBQUcsRUFBRSxLQUFLLENBQUMsR0FBRztRQUNkLFVBQVUsRUFBRSxFQUFFO0tBQ2YsQ0FBQztJQUNGLEtBQUssQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLFVBQUMsUUFBUSxJQUFLLE9BQUEsS0FBSyxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLEVBQS9CLENBQStCLENBQUMsQ0FBQztJQUNwRSxNQUFNLENBQUMsS0FBSyxDQUFDO0FBQ2YsQ0FBQztBQUVELElBQUssVUFvQ0o7QUFwQ0QsV0FBSyxVQUFVO0lBQ2Isa0JBQWtCO0lBQ2xCLDJDQUFJLENBQUE7SUFDSixZQUFZO0lBQ1osdURBQVUsQ0FBQTtJQUNWLCtDQUFNLENBQUE7SUFDTixxREFBUyxDQUFBO0lBQ1QsbURBQVEsQ0FBQTtJQUNSLG1EQUFRLENBQUE7SUFDUiwrQ0FBTSxDQUFBO0lBQ04sd0JBQXdCO0lBQ3hCLCtDQUFNLENBQUE7SUFDTiw2Q0FBSyxDQUFBO0lBQ0wsbURBQVEsQ0FBQTtJQUNSLHNEQUFTLENBQUE7SUFDVCxzREFBUyxDQUFBO0lBQ1Qsb0RBQVEsQ0FBQTtJQUNSLG1CQUFtQjtJQUNuQixnREFBTSxDQUFBO0lBQ04sZ0RBQU0sQ0FBQTtJQUNOLHdEQUFVLENBQUE7SUFDVixvRUFBZ0IsQ0FBQTtJQUNoQiwwREFBVyxDQUFBO0lBQ1gsMERBQVcsQ0FBQTtJQUNYLGtEQUFPLENBQUE7SUFDUCxzREFBUyxDQUFBO0lBQ1QsMERBQVcsQ0FBQTtJQUNYLGdEQUFNLENBQUE7SUFDTixnREFBTSxDQUFBO0lBQ04sb0RBQVEsQ0FBQTtJQUNSLG9EQUFRLENBQUE7SUFDUixZQUFZO0lBQ1osa0RBQU8sQ0FBQTtJQUNQLG9EQUFRLENBQUE7SUFDUixvREFBUSxDQUFBO0lBQ1Isc0RBQVMsQ0FBQTtBQUNYLENBQUMsRUFwQ0ksVUFBVSxLQUFWLFVBQVUsUUFvQ2Q7QUFFRCx1Q0FBdUM7QUFDdkMsbUJBQW1CLElBQVU7SUFDM0IsOERBQThEO0lBQzlELElBQUksR0FBRyxHQUF1QixrQkFBa0IsQ0FBQyxFQUFFLENBQUM7SUFDcEQsSUFBSSxVQUFVLEdBQXNCLEVBQUUsQ0FBQztJQUN2QyxJQUFJLFlBQVksR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDO0lBQzdCLElBQUksY0FBYyxHQUFHLFlBQVksQ0FBQztJQUNsQyxJQUFJLEtBQUssR0FBRyxLQUFLLENBQUM7SUFFbEIsSUFBSSxnQkFBZ0IsR0FBRyxDQUFDLEdBQUcsRUFBQyxHQUFHLEVBQUMsR0FBRyxFQUFDLEdBQUcsRUFBQyxHQUFHLEVBQUMsR0FBRyxFQUFDLEdBQUcsRUFBQyxHQUFHLEVBQUMsR0FBRyxFQUFDLEdBQUcsRUFBQyxHQUFHLEVBQUMsR0FBRyxFQUFDLEdBQUcsRUFBQyxHQUFHLEVBQUMsR0FBRyxFQUFDLEdBQUcsRUFBQyxHQUFHLEVBQUMsR0FBRyxFQUFDLEdBQUcsRUFBQyxHQUFHLEVBQUMsR0FBRyxFQUFDLEdBQUcsRUFBQyxHQUFHLEVBQUMsR0FBRyxFQUFDLEdBQUcsRUFBQyxHQUFHLENBQUMsQ0FBQztJQUNqSSxJQUFJLGdCQUFnQixHQUFHLENBQUMsR0FBRyxFQUFDLEdBQUcsRUFBQyxHQUFHLEVBQUMsR0FBRyxFQUFDLEdBQUcsRUFBQyxHQUFHLEVBQUMsR0FBRyxFQUFDLEdBQUcsRUFBQyxHQUFHLEVBQUMsR0FBRyxFQUFDLEdBQUcsRUFBQyxHQUFHLEVBQUMsR0FBRyxFQUFDLEdBQUcsRUFBQyxHQUFHLEVBQUMsR0FBRyxFQUFDLEdBQUcsRUFBQyxHQUFHLEVBQUMsR0FBRyxFQUFDLEdBQUcsRUFBQyxHQUFHLEVBQUMsR0FBRyxFQUFDLEdBQUcsRUFBQyxHQUFHLEVBQUMsR0FBRyxFQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ2pJLElBQUksTUFBTSxHQUFHLENBQUMsR0FBRyxFQUFDLEdBQUcsRUFBQyxHQUFHLEVBQUMsR0FBRyxFQUFDLEdBQUcsRUFBQyxHQUFHLEVBQUMsR0FBRyxFQUFDLEdBQUcsRUFBQyxHQUFHLEVBQUMsR0FBRyxDQUFDLENBQUM7SUFDdkQsSUFBSSxVQUFVLEdBQUcsQ0FBQyxHQUFHLEVBQUMsR0FBRyxFQUFDLEdBQUcsRUFBQyxHQUFHLENBQUMsQ0FBQztJQUNuQyxJQUFJLFNBQVMsR0FBRyxDQUFDLEdBQUcsRUFBQyxHQUFHLEVBQUMsR0FBRyxFQUFDLEdBQUcsRUFBQyxHQUFHLENBQUMsQ0FBQztJQUN0QyxJQUFJLFdBQVcsR0FBRyxDQUFDLEdBQUcsRUFBQyxJQUFJLEVBQUMsR0FBRyxFQUFDLElBQUksRUFBQyxHQUFHLEVBQUMsSUFBSSxDQUFDLENBQUM7SUFFL0MsK0RBQStEO0lBQy9ELG1EQUFtRDtJQUNuRCxxQ0FBcUM7SUFDckMsMkdBQTJHO0lBQzNHLElBQUksY0FBYyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDN0IsSUFBSSxXQUFXLEdBQUcsQ0FBQyxNQUFNLEVBQUUsS0FBSyxFQUFFLFFBQVEsRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLE9BQU8sRUFBRSxTQUFTLEVBQUUsUUFBUSxFQUFFLFdBQVcsRUFBRSxTQUFTLEVBQUUsSUFBSSxFQUFFLEdBQUcsRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDaFAsSUFBSSxPQUFPLEdBQUcsQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxPQUFPLEVBQUUsU0FBUyxDQUFDLENBQUM7SUFDNUgsSUFBSSxZQUFZLEdBQUcsQ0FBQyxLQUFLLEVBQUUsV0FBVyxFQUFFLElBQUksRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFFLFNBQVMsRUFBRSxRQUFRLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDeEssSUFBSSxZQUFZLEdBQUcsQ0FBQyxNQUFNLEVBQUUsT0FBTyxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxTQUFTLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLFFBQVEsRUFBRSxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsT0FBTyxFQUFFLE9BQU8sRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxLQUFLLEVBQUUsU0FBUyxFQUFFLFlBQVksRUFBRSxTQUFTLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLFNBQVMsRUFBRSxPQUFPLEVB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V0FBVyxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDeEMsR0FBRyxHQUFHLE9BQU8sQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLFVBQUMsQ0FBQyxJQUFLLE9BQUEsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsS0FBSyxFQUE1QyxDQUE0QyxDQUFDLENBQUMsS0FBSyxFQUFFLENBQUM7SUFDN0YsQ0FBQztJQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLFVBQVUsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDbkQsR0FBRyxHQUFHLE9BQU8sQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLFVBQUMsQ0FBQyxJQUFLLE9BQUEsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxVQUFVLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsS0FBSyxFQUFoRCxDQUFnRCxDQUFDLENBQUMsS0FBSyxFQUFFLENBQUM7SUFDakcsQ0FBQztJQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLFVBQVUsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDbEQsR0FBRyxHQUFHLE9BQU8sQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLFVBQUMsQ0FBQyxJQUFLLE9BQUEsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxVQUFVLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsS0FBSyxFQUEvQyxDQUErQyxDQUFDLENBQUMsS0FBSyxFQUFFLENBQUM7SUFDaEcsQ0FBQztJQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLFVBQVUsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDakQsR0FBRyxHQUFHLE9BQU8sQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLFVBQUMsQ0FBQyxJQUFLLE9BQUEsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsS0FBSyxFQUE5QyxDQUE4QyxDQUFDLENBQUMsS0FBSyxFQUFFLENBQUM7SUFDL0YsQ0FBQztJQUFDLElBQUksQ0FBQyxDQUFDO1FBQ04sR0FBRyxHQUFHLE9BQU8sQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLFVBQUMsQ0FBQyxJQUFLLE9BQUEsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLEVBQTlCLENBQThCLENBQUMsQ0FBQyxLQUFLLEVBQUUsQ0FBQztJQUMvRSxDQUFDO0lBRUQsMEJBQTBCO0lBQzFCLEVBQUUsQ0FBQyxDQUFDLEdBQUcsS0FBSyxTQUFTLENBQUMsQ0FBQyxDQUFDO1FBQ3RCLEVBQUUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxLQUFLLGFBQWEsQ0FBQyxLQUFLLElBQUksR0FBRyxDQUFDLElBQUksS0FBSyxZQUFZLENBQUMsQ0FBQyxDQUFDO1lBQzFFLE9BQU8sQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQzdCLEdBQUcsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDckIsQ0FBQztRQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLElBQUksS0FBSyxhQUFhLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztZQUNyRCxJQUFJLElBQUksR0FBRyxzQkFBc0IsQ0FBQyxPQUFPLEVBQUUsVUFBVSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQzVELFlBQVksQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUN0QixPQUFPLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUMsQ0FBQyxDQUFDLENBQUM7WUFDeEUsT0FBTyxDQUFDLFlBQVksQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLEVBQUMsQ0FBQyxDQUFDLENBQUM7WUFDckUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1lBQzVDLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDcEIsTUFBTSxDQUFDLElBQUksQ0FBQztRQUNkLENBQUM7UUFBQyxJQUFJLENBQUMsQ0FBQztZQUNOLEdBQUcsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDckIsQ0FBQztRQUNELEdBQUcsQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDO1FBQ2pCLE1BQU0sQ0FBQyxJQUFJLENBQUM7SUFDZCxDQUFDO0lBQUMsSUFBSSxDQUFDLENBQUM7UUFDTixNQUFNLENBQUMsS0FBSyxDQUFDO0lBQ2YsQ0FBQztBQUNILENBQUM7QUE4QkQseUJBQXlCLFVBQXNCO0lBQzdDLElBQUksS0FBSyxHQUFlO1FBQ3RCLEVBQUUsRUFBRSxVQUFVLENBQUMsRUFBRTtRQUNqQixXQUFXLEVBQUUsVUFBVSxDQUFDLFdBQVc7UUFDbkMsSUFBSSxFQUFFLFVBQVUsQ0FBQyxJQUFJO1FBQ3JCLFFBQVEsRUFBRSxVQUFVLENBQUMsUUFBUTtRQUM3QixPQUFPLEVBQUUsVUFBVSxDQUFDLE9BQU87S0FDNUIsQ0FBQTtJQUNELE1BQU0sQ0FBQyxLQUFLLENBQUM7QUFDZixDQUFDO0FBY0Qsa0RBQWtEO0FBQ2xELGdEQUFnRDtBQUNoRCx5QkFBeUI7QUFDekIsNkNBQTZDO0FBQzdDLG1FQUFtRTtBQUNuRSxzQkFBc0I7QUFDdEIsc0RBQXNEO0FBQ3RELHVCQUF1QixNQUFjO0lBQ25DLEdBQUcsQ0FBQyx3QkFBd0IsR0FBRyxNQUFNLENBQUMsQ0FBQztJQUN2QyxJQUFJLFdBQVcsQ0FBQztJQUNoQixJQUFJLElBQVksQ0FBQztJQUNqQixvQ0FBb0M7SUFDcEMsSUFBSSxPQUFPLEdBQUcsU0FBRyxDQUFDLE9BQU8sQ0FBQyxZQUFZLEVBQUMsRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLENBQUMsQ0FBQztJQUN6RCxFQUFFLENBQUMsQ0FBQyxPQUFPLEtBQUssU0FBUyxDQUFDLENBQUMsQ0FBQztRQUMxQixXQUFXLEdBQUcsU0FBRyxDQUFDLE9BQU8sQ0FBQyxRQUFRLEVBQUUsRUFBRSxNQUFNLEVBQUUsT0FBTyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFDNUQsSUFBSSxHQUFHLE1BQU0sQ0FBQztJQUVoQixDQUFDO0lBQUMsSUFBSSxDQUFDLENBQUM7UUFDTixXQUFXLEdBQUcsU0FBRyxDQUFDLE9BQU8sQ0FBQyxRQUFRLEVBQUUsRUFBRSxNQUFNLEVBQUUsTUFBTSxFQUFFLENBQUMsQ0FBQztJQUMxRCxDQUFDO0lBQ0QsbUJBQW1CO0lBQ25CLEVBQUUsQ0FBQyxDQUFDLFdBQVcsS0FBSyxTQUFTLENBQUMsQ0FBQyxDQUFDO1FBQzlCLEVBQUUsQ0FBQyxDQUFDLElBQUksS0FBSyxTQUFTLENBQUMsQ0FBQyxDQUFDO1lBQ3ZCLE9BQU8sR0FBRyxTQUFHLENBQUMsT0FBTyxDQUFDLGNBQWMsRUFBQyxFQUFFLEVBQUUsRUFBRSxNQUFNLEVBQUUsQ0FBQyxDQUFDO1lBQ3JELElBQUksR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDO1FBQ3RCLENBQUM7UUFDRCxJQUFJLE1BQU0sR0FBVztZQUNuQixFQUFFLEVBQUUsV0FBVyxDQUFDLE1BQU07WUFDdEIsV0FBVyxFQUFFLElBQUk7WUFDakIsUUFBUSxFQUFFLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFDLEVBQUUsQ0FBQztZQUMvQixPQUFPLEVBQUUsSUFBSTtZQUNiLFVBQVUsRUFBRSxLQUFLO1lBQ2pCLFNBQVMsRUFBRSxLQUFLO1lBQ2hCLFFBQVEsRUFBRSxLQUFLO1NBQ2hCLENBQUE7UUFDRCxHQUFHLENBQUMsVUFBVSxHQUFHLE1BQU0sQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUM1QixNQUFNLENBQUMsTUFBTSxDQUFDO0lBQ2hCLENBQUM7SUFBQyxJQUFJLENBQUMsQ0FBQztRQUNOLEdBQUcsQ0FBQyxjQUFjLEdBQUcsTUFBTSxDQUFDLENBQUM7UUFDN0IsTUFBTSxDQUFDLFNBQVMsQ0FBQztJQUNuQixDQUFDO0FBQ0gsQ0FBQztBQUNELHNEQUFzRDtBQUN0RCwyQkFBMkIsTUFBYztJQUN2QyxHQUFHLENBQUMsNEJBQTRCLEdBQUcsTUFBTSxDQUFDLENBQUM7SUFDM0MsSUFBSSxlQUFlLENBQUM7SUFDcEIsSUFBSSxJQUFZLENBQUM7SUFDakIsb0NBQW9DO0lBQ3BDLElBQUksT0FBTyxHQUFHLFNBQUcsQ0FBQyxPQUFPLENBQUMsWUFBWSxFQUFDLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRSxDQUFDLENBQUM7SUFDekQsRUFBRSxDQUFDLENBQUMsT0FBTyxLQUFLLFNBQVMsQ0FBQyxDQUFDLENBQUM7UUFDMUIsZUFBZSxHQUFHLFNBQUcsQ0FBQyxPQUFPLENBQUMsWUFBWSxFQUFFLEVBQUUsVUFBVSxFQUFFLE9BQU8sQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBQ3hFLElBQUksR0FBRyxNQUFNLENBQUM7SUFFaEIsQ0FBQztJQUFDLElBQUksQ0FBQyxDQUFDO1FBQ04sZUFBZSxHQUFHLFNBQUcsQ0FBQyxPQUFPLENBQUMsWUFBWSxFQUFFLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBRSxDQUFDLENBQUM7SUFDdEUsQ0FBQztJQUNELHVCQUF1QjtJQUN2QixFQUFFLENBQUMsQ0FBQyxlQUFlLEtBQUssU0FBUyxDQUFDLENBQUMsQ0FBQztRQUNsQyxFQUFFLENBQUMsQ0FBQyxJQUFJLEtBQUssU0FBUyxDQUFDLENBQUMsQ0FBQztZQUN2QixPQUFPLEdBQUcsU0FBRyxDQUFDLE9BQU8sQ0FBQyxjQUFjLEVBQUMsRUFBRSxFQUFFLEVBQUUsTUFBTSxFQUFFLENBQUMsQ0FBQztZQUNyRCxJQUFJLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQztRQUN0QixDQUFDO1FBQ0QsSUFBSSxVQUFVLEdBQWU7WUFDM0IsRUFBRSxFQUFFLGVBQWUsQ0FBQyxVQUFVO1lBQzlCLFdBQVcsRUFBRSxJQUFJO1lBQ2pCLFFBQVEsRUFBRSxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksRUFBQyxFQUFFLENBQUM7WUFDL0IsT0FBTyxFQUFFLElBQUk7U0FDZCxDQUFBO1FBQ0QsR0FBRyxDQUFDLFVBQVUsR0FBRyxVQUFVLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDaEMsTUFBTSxDQUFDLFVBQVUsQ0FBQztJQUNwQixDQUFDO0lBQUMsSUFBSSxDQUFDLENBQUM7UUFDTixHQUFHLENBQUMsY0FBYyxHQUFHLE1BQU0sQ0FBQyxDQUFDO1FBQzdCLE1BQU0sQ0FBQyxTQUFTLENBQUM7SUFDbkIsQ0FBQztBQUNILENBQUM7QUFFRCxpRkFBaUY7QUFDakYsOEZBQThGO0FBQzlGLDBCQUEwQixJQUFZO0lBQ3BDLEdBQUcsQ0FBQywyQkFBMkIsR0FBRyxJQUFJLENBQUMsQ0FBQztJQUN4QyxJQUFJLGNBQWMsR0FBRyxTQUFHLENBQUMsT0FBTyxDQUFDLGFBQWEsRUFBRSxFQUFFLFNBQVMsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO0lBQ3JFLEVBQUUsQ0FBQyxDQUFDLGNBQWMsS0FBSyxTQUFTLENBQUMsQ0FBQyxDQUFDO1FBQ2pDLElBQUksU0FBUyxHQUFjO1lBQ3pCLEVBQUUsRUFBRSxjQUFjLENBQUMsU0FBUztZQUM1QixXQUFXLEVBQUUsSUFBSTtZQUNqQixRQUFRLEVBQUUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUMsRUFBRSxDQUFDO1lBQy9CLE9BQU8sRUFBRSxJQUFJO1NBQ2QsQ0FBQTtRQUNELEdBQUcsQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDLENBQUM7UUFDdkIsR0FBRyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQ2YsTUFBTSxDQUFDLFNBQVMsQ0FBQztJQUNuQixDQUFDO0lBQ0QsR0FBRyxDQUFDLGNBQWMsR0FBRyxJQUFJLENBQUMsQ0FBQztJQUMzQixNQUFNLENBQUMsU0FBUyxDQUFDO0FBQ25CLENBQUM7QUFFRCxJQUFLLGlCQU1KO0FBTkQsV0FBSyxpQkFBaUI7SUFDcEIseURBQUksQ0FBQTtJQUNKLDZEQUFNLENBQUE7SUFDTiw2REFBTSxDQUFBO0lBQ04sNkRBQU0sQ0FBQTtJQUNOLHlFQUFZLENBQUE7QUFDZCxDQUFDLEVBTkksaUJBQWlCLEtBQWpCLGlCQUFpQixRQU1yQjtBQVFELDBCQUEwQixLQUFXLEVBQUUsS0FBVyxFQUFFLE9BQWdCO0lBQ2xFLElBQUksWUFBWSxHQUFHLEVBQUMsSUFBSSxFQUFFLGlCQUFpQixDQUFDLElBQUksRUFBQyxDQUFDO0lBQ2xELEVBQUUsQ0FBQyxDQUFDLENBQUMsS0FBSyxLQUFLLEtBQUssQ0FBQztRQUNqQixDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDO1FBQzNCLENBQUMsS0FBSyxDQUFDLFdBQVcsQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDLElBQUksS0FBSyxDQUFDLFdBQVcsQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDdkYsTUFBTSxDQUFDLFlBQVksQ0FBQztJQUN0QixDQUFDO0lBQ0QsR0FBRyxDQUFDLG9DQUFpQyxLQUFLLENBQUMsSUFBSSxpQkFBVSxLQUFLLENBQUMsSUFBSSxPQUFHLENBQUMsQ0FBQztJQUV4RSwwQkFBMEI7SUFDMUIsaUJBQWlCO0lBQ2pCLGFBQWE7SUFDYixlQUFlO0lBQ2YsY0FBYztJQUNkLGNBQWM7SUFDZCxZQUFZO0lBQ1osS0FBSyxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsVUFBQyxDQUFDLEVBQUUsQ0FBQyxJQUFLLE9BQUEsQ0FBQyxHQUFHLENBQUMsRUFBTCxDQUFLLENBQUMsQ0FBQztJQUN2QyxLQUFLLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxVQUFDLENBQUMsRUFBRSxDQUFDLElBQUssT0FBQSxDQUFDLEdBQUcsQ0FBQyxFQUFMLENBQUssQ0FBQyxDQUFDO0lBQ3ZDLElBQUksS0FBSyxHQUFHLENBQUMsS0FBSyxFQUFFLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFDLENBQUMsRUFBRSxDQUFDLElBQUssT0FBQSxDQUFDLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLEVBQWpDLENBQWlDLENBQUMsQ0FBQztJQUM3RSxLQUFLLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFBO0lBQ2hCLEtBQUssR0FBRyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFFakIsK0JBQStCO0lBQy9CLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxXQUFXLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxJQUFJLEtBQUssQ0FBQyxXQUFXLENBQUMsVUFBVSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNwRixZQUFZLEdBQUcseUJBQXlCLENBQUMsS0FBSyxFQUFFLEtBQUssRUFBRSxPQUFPLENBQUMsQ0FBQztJQUNsRSxDQUFDO0lBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxXQUFXLENBQUMsVUFBVSxDQUFDLFVBQVUsQ0FBQyxJQUFJLEtBQUssQ0FBQyxXQUFXLENBQUMsVUFBVSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUMvRixZQUFZLEdBQUcsMEJBQTBCLENBQUMsS0FBSyxFQUFFLEtBQUssRUFBRSxPQUFPLENBQUMsQ0FBQztJQUNuRSxDQUFDO0lBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxXQUFXLENBQUMsVUFBVSxDQUFDLFVBQVUsQ0FBQyxJQUFJLEtBQUssQ0FBQyxXQUFXLENBQUMsVUFBVSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNoRyxZQUFZLEdBQUcsMEJBQTBCLENBQUMsS0FBSyxFQUFFLEtBQUssRUFBRSxPQUFPLENBQUMsQ0FBQztJQUNuRSxDQUFDO0lBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxXQUFXLENBQUMsVUFBVSxDQUFDLFNBQVMsQ0FBQyxJQUFJLEtBQUssQ0FBQyxXQUFXLENBQUMsVUFBVSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUM5RixZQUFZLEdBQUcsMEJBQTBCLENBQUMsS0FBSyxFQUFFLEtBQUssRUFBRSxPQUFPLENBQUMsQ0FBQztJQUNuRSxDQUFDO0lBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxXQUFXLENBQUMsVUFBVSxDQUFDLFVBQVUsQ0FBQyxJQUFJLEtBQUssQ0FBQyxXQUFXLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUM1RixZQUFZLEdBQUcseUJBQXlCLENBQUMsS0FBSyxFQUFFLEtBQUssRUFBRSxPQUFPLENBQUMsQ0FBQztJQUNsRSxDQUFDO0lBRUQsNkNBQTZDO0lBQzdDLEVBQUUsQ0FBQyxDQUFDLFlBQVksQ0FBQyxJQUFJLEtBQUssaUJBQWlCLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztRQUNqRCxLQUFLLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQztRQUN2QyxLQUFLLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQztRQUN2QyxPQUFPLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQztJQUUzQyxDQUFDO0lBQUMsSUFBSSxDQUFDLENBQUM7UUFDTixLQUFLLEdBQUcsQ0FBQyxLQUFLLEVBQUUsS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQUMsQ0FBQyxFQUFDLENBQUMsSUFBSyxPQUFBLENBQUMsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDLEVBQUUsRUFBWCxDQUFXLENBQUMsQ0FBQztRQUNsRCxLQUFLLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ2pCLEtBQUssR0FBRyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDakIsSUFBSSxVQUFVLEdBQUcsS0FBSyxDQUFDO1FBQ3ZCLHNHQUFzRztRQUN0RyxFQUFFLENBQUMsQ0FBQyxLQUFLLENBQUMsV0FBVyxDQUFDLFVBQVUsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxXQUFXLENBQUMsVUFBVSxDQUFDLFNBQVMsQ0FBQyxJQUFJLEtBQUssQ0FBQyxlQUFlLENBQUMsU0FBUyxLQUFLLFNBQVMsQ0FBQyxDQUFDLENBQUM7WUFDMUksVUFBVSxHQUFHLG9CQUFvQixDQUFDLEtBQUssRUFBRSxVQUFVLENBQUMsU0FBUyxFQUFFLE9BQU8sQ0FBQyxDQUFDO1FBQzFFLENBQUM7UUFBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLFdBQVcsQ0FBQyxVQUFVLENBQUMsVUFBVSxDQUFDLElBQUksS0FBSyxDQUFDLFdBQVcsQ0FBQyxVQUFVLENBQUMsVUFBVSxDQUFDLElBQUksS0FBSyxDQUFDLGVBQWUsQ0FBQyxTQUFTLEtBQUssU0FBUyxDQUFDLENBQUMsQ0FBQztZQUNqSixVQUFVLEdBQUcsb0JBQW9CLENBQUMsS0FBSyxFQUFFLFVBQVUsQ0FBQyxTQUFTLEVBQUUsT0FBTyxDQUFDLENBQUM7UUFDMUUsQ0FBQztRQUNELEVBQUUsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUM7WUFDZixZQUFZLEdBQUcsZ0JBQWdCLENBQUMsS0FBSyxFQUFFLEtBQUssRUFBRSxPQUFPLENBQUMsQ0FBQztRQUN6RCxDQUFDO0lBQ0gsQ0FBQztJQUNELE1BQU0sQ0FBQyxZQUFZLENBQUM7QUFDdEIsQ0FBQztBQUVELDBCQUEwQjtBQUMxQixvQ0FBb0MsS0FBVyxFQUFFLEtBQVcsRUFBRSxPQUFnQjtJQUM1RSxHQUFHLENBQUMsaURBQThDLEtBQUssQ0FBQyxJQUFJLGlCQUFVLEtBQUssQ0FBQyxJQUFJLFVBQU0sQ0FBQyxDQUFDO0lBRXhGLE9BQU8sQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUE7SUFDbEIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQTtJQUVsQixFQUFFLENBQUMsQ0FBQyxLQUFLLENBQUMsV0FBVyxDQUFDLFVBQVUsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDM0MsSUFBSSxJQUFJLEdBQUcsS0FBSyxDQUFDO1FBQ2pCLEtBQUssR0FBRyxLQUFLLENBQUM7UUFDZCxLQUFLLEdBQUcsSUFBSSxDQUFDO0lBQ2YsQ0FBQztJQUVELG9DQUFvQztJQUNwQyxFQUFFLENBQUMsQ0FBQyxLQUFLLENBQUMsYUFBYSxDQUFDLE1BQU0sR0FBRyxDQUFDLElBQUksS0FBSyxDQUFDLFdBQVcsQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQy9ILEtBQUssQ0FBQyxTQUFTLENBQUMsUUFBUSxHQUFHLEtBQUcsS0FBSyxDQUFDLFFBQVUsQ0FBQztRQUMvQyxLQUFLLENBQUMsU0FBUyxDQUFDLFlBQVksR0FBRyxLQUFLLENBQUM7UUFDckMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxPQUFPLEdBQUcsS0FBSyxDQUFDO1FBQ2hDLE1BQU0sQ0FBQyxFQUFDLElBQUksRUFBRSxpQkFBaUIsQ0FBQyxNQUFNLEVBQUUsS0FBSyxFQUFFLENBQUMsS0FBSyxFQUFFLEtBQUssQ0FBQyxFQUFDLENBQUM7SUFDakUsQ0FBQztJQUFDLElBQUksQ0FBQyxDQUFDO1FBQ04sTUFBTSxDQUFDLEVBQUMsSUFBSSxFQUFFLGlCQUFpQixDQUFDLElBQUksRUFBQyxDQUFDO0lBQ3hDLENBQUM7SUFFRCw2REFBNkQ7SUFDN0QsSUFBSSxNQUFNLEdBQUcsS0FBSyxDQUFDO0lBQ25CLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxXQUFXLENBQUMsVUFBVSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUM3QyxNQUFNLEdBQUcsSUFBSSxDQUFDO0lBQ2hCLENBQUM7SUFBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLFdBQVcsQ0FBQyxVQUFVLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3BELElBQUksS0FBSyxHQUFHLEtBQUssQ0FBQztRQUNsQixLQUFLLEdBQUcsS0FBSyxDQUFDO1FBQ2QsS0FBSyxHQUFHLEtBQUssQ0FBQztRQUNkLE1BQU0sR0FBRyxJQUFJLENBQUM7SUFDaEIsQ0FBQztJQUVELEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7UUFDWCxHQUFHLENBQUMsK0JBQStCLENBQUMsQ0FBQztRQUNyQyw2QkFBNkI7UUFDN0IsSUFBSSxVQUFVLEdBQUcsS0FBSyxDQUFDLFNBQVMsQ0FBQztRQUNqQyxJQUFJLEdBQUcsR0FBVztZQUNoQixFQUFFLEVBQUUsVUFBVSxDQUFDLFFBQVE7WUFDdkIsV0FBVyxFQUFFLFVBQVUsQ0FBQyxRQUFRO1lBQ2hDLFFBQVEsRUFBRSxVQUFVLENBQUMsUUFBUTtZQUM3QixPQUFPLEVBQUUsS0FBSztZQUNkLFVBQVUsRUFBRSxJQUFJO1lBQ2hCLFNBQVMsRUFBRSxLQUFLO1lBQ2hCLFFBQVEsRUFBRSxLQUFLO1NBQ2hCLENBQUE7UUFDRCxJQUFJLE1BQU0sR0FBRyxRQUFRLENBQUMsVUFBVSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQzNDLElBQUksS0FBSyxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUM1QixLQUFLLENBQUMsTUFBTSxHQUFHLEdBQUcsQ0FBQztRQUNuQixHQUFHLENBQUMsSUFBSSxHQUFHLEtBQUssQ0FBQztRQUNqQixLQUFLLENBQUMsU0FBUyxDQUFDLFFBQVEsR0FBTSxLQUFLLENBQUMsU0FBUyxDQUFDLFFBQVEsU0FBSSxLQUFLLENBQUMsU0FBUyxDQUFDLEVBQUksQ0FBQztRQUMvRSxLQUFLLENBQUMsU0FBUyxDQUFDLElBQUksR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQy9CLE1BQU0sQ0FBQyxFQUFDLElBQUksRUFBRSxpQkFBaUIsQ0FBQyxNQUFNLEVBQUUsS0FBSyxFQUFFLENBQUMsS0FBSyxFQUFFLEtBQUssQ0FBQyxFQUFDLENBQUM7SUFDakUsQ0FBQztJQUNELE1BQU0sQ0FBQyxFQUFDLElBQUksRUFBRSxpQkFBaUIsQ0FBQyxJQUFJLEVBQUMsQ0FBQztBQUN4QyxDQUFDO0FBR0QsOEJBQThCO0FBQzlCLG1DQUFtQyxJQUFVLEVBQUUsR0FBUyxFQUFFLE9BQWdCO0lBQ3hFLEdBQUcsQ0FBQyxnREFBNkMsSUFBSSxDQUFDLElBQUksaUJBQVUsR0FBRyxDQUFDLElBQUksVUFBTSxDQUFDLENBQUM7SUFDcEY7Ozs7Ozs7O09BUUc7SUFDSCxJQUFJLGVBQWUsR0FBRyxTQUFHLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQztTQUNoQyxNQUFNLENBQUMscUJBQXFCLEVBQUUsRUFBRSxVQUFVLEVBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxFQUFFLEVBQUUsRUFBRSxZQUFZLENBQUM7U0FDL0UsTUFBTSxDQUFDLHFCQUFxQixFQUFFLEVBQUUsTUFBTSxFQUFFLENBQUMsWUFBWSxFQUFFLFFBQVEsQ0FBQyxFQUFFLElBQUksRUFBRSxHQUFHLENBQUMsTUFBTSxDQUFDLEVBQUUsRUFBRSxFQUFFLE9BQU8sQ0FBQztTQUNqRyxJQUFJLEVBQUUsQ0FBQztJQUNWLEVBQUUsQ0FBQyxDQUFDLGVBQWUsQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztRQUN2QyxJQUFJLFFBQVEsR0FBRyxzQkFBc0IsQ0FBQyxlQUFlLENBQUMsV0FBVyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsTUFBTSxDQUFDLENBQUM7UUFDakYsSUFBSSxXQUFXLEdBQUcscUJBQXFCLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDbEQsSUFBSSxVQUFVLENBQUM7UUFDZixFQUFFLENBQUMsQ0FBQyxXQUFXLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDM0IsR0FBRyxDQUFDLDZCQUE2QixDQUFDLENBQUM7WUFDbkMsSUFBSSxNQUFNLEdBQUcsR0FBRyxDQUFDLE1BQU0sQ0FBQztZQUN4QixNQUFNLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQztZQUN4QixNQUFNLENBQUMsT0FBTyxHQUFHLEtBQUssQ0FBQztZQUN2QixNQUFNLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDO1lBQzNDLElBQUksWUFBWSxHQUFHLEVBQUMsSUFBSSxFQUFFLGlCQUFpQixDQUFDLE1BQU0sRUFBRSxLQUFLLEVBQUUsQ0FBQyxJQUFJLEVBQUUsR0FBRyxDQUFDLEVBQUMsQ0FBQztZQUN4RSxNQUFNLENBQUMsWUFBWSxDQUFDO1FBQ3RCLENBQUM7SUFDSCxDQUFDO0lBQ0Q7Ozs7Ozs7Ozs7T0FVRztJQUNILEdBQUcsQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDO0lBQy9CLE1BQU0sQ0FBQyxFQUFFLElBQUksRUFBRSxpQkFBaUIsQ0FBQyxJQUFJLEVBQUUsQ0FBQztBQUMxQyxDQUFDO0FBRUQsbUNBQW1DLEdBQVMsRUFBRSxJQUFVLEVBQUUsT0FBZ0I7SUFDeEUsR0FBRyxDQUFDLGdEQUE2QyxHQUFHLENBQUMsSUFBSSxpQkFBVSxJQUFJLENBQUMsSUFBSSxVQUFNLENBQUMsQ0FBQztJQUVwRixzRkFBc0Y7SUFDdEYsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsVUFBVSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNuRixJQUFJLENBQUMsU0FBUyxDQUFDLFFBQVEsR0FBRyxHQUFHLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQztRQUN4QyxJQUFJLENBQUMsU0FBUyxDQUFDLFlBQVksR0FBRyxLQUFLLENBQUM7UUFDcEMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxPQUFPLEdBQUcsS0FBSyxDQUFDO1FBQy9CLEdBQUcsQ0FBQyxNQUFNLENBQUMsT0FBTyxHQUFHLEtBQUssQ0FBQztRQUMzQixHQUFHLENBQUMsTUFBTSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUM7UUFDMUIsTUFBTSxDQUFDLEVBQUMsSUFBSSxFQUFFLGlCQUFpQixDQUFDLE1BQU0sRUFBRSxLQUFLLEVBQUUsQ0FBQyxHQUFHLEVBQUUsSUFBSSxDQUFDLEVBQUMsQ0FBQztJQUM5RCxDQUFDO0lBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDekMsTUFBTSxDQUFDLEVBQUMsSUFBSSxFQUFFLGlCQUFpQixDQUFDLElBQUksRUFBQyxDQUFDO0lBQ3hDLENBQUM7SUFFRCxrQ0FBa0M7SUFDbEMsb0JBQW9CO0lBQ3BCLElBQUksZUFBZSxHQUFHLFNBQUcsQ0FBQyxPQUFPLENBQUMsYUFBYSxFQUFFLEVBQUUsTUFBTSxFQUFFLEdBQUcsQ0FBQyxNQUFNLENBQUMsRUFBRSxFQUFFLFNBQVMsRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7SUFDMUcsRUFBRSxDQUFDLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQztRQUNwQixHQUFHLENBQUMsZ0NBQWdDLENBQUMsQ0FBQztRQUN0QyxJQUFJLFNBQVMsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDO1FBQy9CLElBQUksT0FBTyxHQUFHLENBQUcsR0FBRyxDQUFDLElBQUksU0FBSSxJQUFJLENBQUMsSUFBSSxDQUFFLENBQUMsT0FBTyxDQUFDLElBQUksRUFBQyxFQUFFLENBQUMsQ0FBQztRQUMxRCxTQUFTLENBQUMsUUFBUSxHQUFHLE9BQU8sQ0FBQztRQUM3QixTQUFTLENBQUMsSUFBSSxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDdkIsU0FBUyxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUM7UUFDekIsR0FBRyxDQUFDLE1BQU0sQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDO1FBQzFCLE1BQU0sQ0FBQyxFQUFDLElBQUksRUFBRSxpQkFBaUIsQ0FBQyxNQUFNLEVBQUUsS0FBSyxFQUFFLENBQUMsR0FBRyxFQUFFLElBQUksQ0FBQyxFQUFFLGFBQWEsRUFBRSxFQUFFLEVBQUMsQ0FBQztJQUNqRixDQUFDO0lBQ0QsbUNBQW1DO0lBQ25DLGlDQUFpQztJQUNqQyxlQUFlLEdBQUcsU0FBRyxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUM7U0FDNUIsTUFBTSxDQUFDLHFCQUFxQixFQUFFLEVBQUUsTUFBTSxFQUFFLEdBQUcsQ0FBQyxNQUFNLENBQUMsRUFBRSxFQUFFLEVBQUUsT0FBTyxDQUFDO1NBQ2pFLE1BQU0sQ0FBQyxhQUFhLEVBQUUsRUFBRSxNQUFNLEVBQUUsQ0FBQyxPQUFPLEVBQUUsTUFBTSxDQUFDLEVBQUUsU0FBUyxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsRUFBRSxFQUFFLEVBQUUsS0FBSyxDQUFDO1NBQ3pGLElBQUksRUFBRSxDQUFDO0lBQ1YsRUFBRSxDQUFDLENBQUMsZUFBZSxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO1FBRXZDLEdBQUcsQ0FBQyxlQUFlLENBQUMsQ0FBQztRQUNyQix3QkFBd0I7UUFDeEIsSUFBSSxRQUFRLEdBQUcsc0JBQXNCLENBQUMsZUFBZSxDQUFDLFdBQVcsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxDQUFDO1FBQ2pGLElBQUksV0FBVyxHQUFHLHFCQUFxQixDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBRWxELElBQUksVUFBVSxDQUFDO1FBQ2YsRUFBRSxDQUFDLENBQUMsV0FBVyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzNCLEdBQUcsQ0FBQyw4QkFBOEIsQ0FBQyxDQUFDO1lBRXBDLHVEQUF1RDtZQUN2RCxvREFBb0Q7WUFDcEQsVUFBVSxHQUFHLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUU1QixJQUFJLGVBQWUsR0FBRyxpQkFBaUIsQ0FBQyxVQUFVLENBQUMsQ0FBQztZQUNwRCxJQUFJLFNBQVMsR0FBRyxRQUFRLENBQUMsZUFBZSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1lBQ3RELElBQUksY0FBYyxHQUFHLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUN4QyxjQUFjLENBQUMsY0FBYyxFQUFFLE9BQU8sQ0FBQyxDQUFDO1lBQ3hDLElBQUksU0FBUyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUM7WUFDL0IsSUFBSSxPQUFPLEdBQUcsQ0FBRyxjQUFjLENBQUMsSUFBSSxTQUFJLElBQUksQ0FBQyxJQUFJLENBQUUsQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFDLEVBQUUsQ0FBQyxDQUFDO1lBQ3JFLFNBQVMsQ0FBQyxRQUFRLEdBQUcsT0FBTyxDQUFDO1lBQzdCLFNBQVMsQ0FBQyxJQUFJLEdBQUcsQ0FBQyxjQUFjLENBQUMsQ0FBQztZQUVsQyx3QkFBd0I7WUFDeEIsSUFBSSxPQUFPLEdBQUcsU0FBRyxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUM7aUJBQ1YsTUFBTSxDQUFDLHFCQUFxQixFQUFFLEVBQUUsTUFBTSxFQUFFLEdBQUcsQ0FBQyxNQUFNLENBQUMsRUFBRSxFQUFFLEVBQUUsT0FBTyxDQUFDO2lCQUNqRSxNQUFNLENBQUMsYUFBYSxFQUFFLEVBQUUsTUFBTSxFQUFFLENBQUMsT0FBTyxFQUFFLE1BQU0sQ0FBQyxFQUFFLEtBQUssRUFBRSxHQUFHLENBQUMsTUFBTSxDQUFDLEVBQUUsRUFBRSxFQUFFLEtBQUssQ0FBQztpQkFDakYsSUFBSSxFQUFFLENBQUM7WUFDeEIsSUFBSSxVQUFVLEdBQUcsc0JBQXNCLENBQUMsT0FBTyxDQUFDLFdBQVcsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLFdBQVcsQ0FBQyxDQUFDO1lBQzdFLFVBQVUsR0FBRyxVQUFVLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1lBQzNDLElBQUksVUFBVSxDQUFDO1lBQ2YsSUFBSSxLQUFLLENBQUM7WUFDVixJQUFJLGFBQWEsR0FBRyxFQUFFLENBQUM7WUFDdkIsRUFBRSxDQUFDLENBQUMsVUFBVSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUMxQixVQUFVLEdBQUcsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUMzQiw4QkFBOEI7Z0JBQzlCLElBQUksT0FBTyxHQUFHLFVBQVUsQ0FBQztnQkFDekIsSUFBSSxNQUFNLEdBQUcsUUFBUSxDQUFDLE9BQU8sQ0FBQyxDQUFDO2dCQUMvQixLQUFLLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDO2dCQUN4QixJQUFJLFVBQVUsR0FBYztvQkFDMUIsRUFBRSxFQUFFLFVBQVU7b0JBQ2QsSUFBSSxFQUFFLENBQUMsY0FBYyxDQUFDO29CQUN0QixJQUFJLEVBQUUsS0FBSztvQkFDWCxXQUFXLEVBQUUsVUFBVTtvQkFDdkIsUUFBUSxFQUFFLE9BQUksR0FBRyxDQUFDLE1BQU0sQ0FBQyxFQUFFLE9BQUc7b0JBQzlCLE9BQU8sRUFBRSxLQUFLO2lCQUNmLENBQUE7Z0JBQ0QsS0FBSyxDQUFDLFNBQVMsR0FBRyxVQUFVLENBQUM7Z0JBQzdCLEtBQUssQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxTQUFTLENBQUMsQ0FBQztnQkFDNUMsS0FBSyxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUM7Z0JBQ25CLGFBQWEsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDNUIsQ0FBQztZQUNELDBCQUEwQjtZQUMxQixTQUFTLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQztZQUN6QixHQUFHLENBQUMsTUFBTSxDQUFDLE9BQU8sR0FBRyxLQUFLLENBQUM7WUFDM0IsR0FBRyxDQUFDLE1BQU0sQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDO1lBQzFCLElBQUksWUFBWSxHQUFHLEVBQUMsSUFBSSxFQUFFLGlCQUFpQixDQUFDLE1BQU0sRUFBRSxLQUFLLEVBQUUsQ0FBQyxHQUFHLEVBQUUsSUFBSSxDQUFDLEVBQUUsYUFBYSxFQUFFLGFBQWEsRUFBQyxDQUFDO1lBQ3RHLEVBQUUsQ0FBQyxDQUFDLEtBQUssS0FBSyxTQUFTLENBQUMsQ0FBQyxDQUFDO2dCQUN4QixLQUFLLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQztZQUN6QyxDQUFDO1lBQ0QsTUFBTSxDQUFDLFlBQVksQ0FBQTtRQUNyQixDQUFDO0lBQ0gsQ0FBQztJQUNEOzs7Ozs7Ozs7O09BVUc7SUFDSCxHQUFHLENBQUMsMEJBQTBCLENBQUMsQ0FBQztJQUNoQyxNQUFNLENBQUMsRUFBRSxJQUFJLEVBQUUsaUJBQWlCLENBQUMsSUFBSSxFQUFFLENBQUM7QUFDMUMsQ0FBQztBQUVELG9DQUEyQyxLQUFXLEVBQUUsS0FBVyxFQUFFLE9BQWdCO0lBQ25GLEdBQUcsQ0FBQyxpREFBOEMsS0FBSyxDQUFDLFVBQVUsQ0FBQyxXQUFXLGlCQUFVLEtBQUssQ0FBQyxVQUFVLENBQUMsV0FBVyxVQUFNLENBQUMsQ0FBQztJQUM1SCxpQ0FBaUM7SUFDakMsSUFBSSxZQUFZLEdBQUcsU0FBRyxDQUFDLEtBQUssQ0FBSSxLQUFLLENBQUMsVUFBVSxDQUFDLFdBQVcsVUFBSyxLQUFLLENBQUMsVUFBVSxDQUFDLFdBQWEsQ0FBQztTQUM3RixNQUFNLENBQUMscUJBQXFCLEVBQUUsRUFBRSxVQUFVLEVBQUUsS0FBSyxDQUFDLFVBQVUsQ0FBQyxFQUFFLEVBQUUsRUFBRSxPQUFPLENBQUM7U0FDM0UsTUFBTSxDQUFDLHFCQUFxQixFQUFFLEVBQUUsVUFBVSxFQUFFLEtBQUssQ0FBQyxVQUFVLENBQUMsRUFBRSxFQUFFLE1BQU0sRUFBRSxDQUFDLE9BQU8sRUFBRSxRQUFRLENBQUMsRUFBRSxFQUFFLE9BQU8sQ0FBQztTQUN4RyxJQUFJLEVBQUUsQ0FBQztJQUNWLHNEQUFzRDtJQUN0RCxJQUFJLGVBQWUsR0FBRyxTQUFHLENBQUMsS0FBSyxDQUFDLDJCQUF5QixLQUFLLENBQUMsVUFBVSxDQUFDLFdBQVcsYUFBUSxLQUFLLENBQUMsVUFBVSxDQUFDLFdBQWEsQ0FBQztTQUN6SCxNQUFNLENBQUMscUJBQXFCLEVBQUUsRUFBRSxVQUFVLEVBQUUsS0FBSyxDQUFDLFVBQVUsQ0FBQyxFQUFFLEVBQUUsRUFBRSxPQUFPLENBQUM7U0FDM0UsTUFBTSxDQUFDLHFCQUFxQixFQUFFLEVBQUUsTUFBTSxFQUFFLENBQUMsT0FBTyxFQUFFLFFBQVEsQ0FBQyxFQUFFLEVBQUUsT0FBTyxDQUFDO1NBQ3ZFLE1BQU0sQ0FBQyxxQkFBcUIsRUFBRSxFQUFFLFVBQVUsRUFBRSxLQUFLLENBQUMsVUFBVSxDQUFDLEVBQUUsRUFBRSxNQUFNLEVBQUUsQ0FBQyxPQUFPLEVBQUUsTUFBTSxDQUFDLEVBQUUsRUFBRSxPQUFPLENBQUM7U0FDdEcsS0FBSyxDQUFDLENBQUMsQ0FBQyxPQUFPLEVBQUUsTUFBTSxDQUFDLENBQUMsQ0FBQztTQUMxQixTQUFTLENBQUMsT0FBTyxFQUFFLEVBQUUsRUFBRSxPQUFPLENBQUM7U0FDL0IsT0FBTyxDQUFDLEVBQUUsSUFBSSxFQUFFLENBQUMsT0FBTyxFQUFFLE1BQU0sQ0FBQyxFQUFFLEtBQUssRUFBRSxDQUFDLE9BQU8sRUFBRSxPQUFPLENBQUMsRUFBRSxDQUFDO1NBQy9ELElBQUksRUFBRSxDQUFDO0lBQ1YsSUFBSSxNQUFNLEdBQUcsRUFBRSxJQUFJLEVBQUUsRUFBRSxFQUFFLEtBQUssRUFBRSxDQUFDLEVBQUUsQ0FBQztJQUNwQyxHQUFHLENBQUMsQ0FBZSxVQUF1QixFQUF2QixLQUFBLGVBQWUsQ0FBQyxPQUFPLEVBQXJDLGNBQVUsRUFBVixJQUFxQyxDQUFDO1FBQXRDLElBQUksTUFBTSxTQUFBO1FBQ2IsRUFBRSxDQUFDLENBQUMsTUFBTSxDQUFDLEtBQUssR0FBRyxNQUFNLENBQUMsS0FBSyxDQUFDO1lBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQztLQUNsRDtJQUVELDJFQUEyRTtJQUMzRSwyQkFBMkI7SUFDM0IsSUFBSSxnQkFBZ0IsR0FBRyxZQUFZLENBQUMsV0FBVyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUM7SUFDM0QsRUFBRSxDQUFDLENBQUMsTUFBTSxDQUFDLEtBQUssR0FBRyxnQkFBZ0IsQ0FBQyxDQUFDLENBQUM7UUFDcEM7Ozs7Ozt5REFNaUQ7UUFDakQsR0FBRyxDQUFDLDRCQUE0QixDQUFDLENBQUM7UUFDbEMsSUFBSSxLQUFLLEdBQU0sS0FBSyxDQUFDLElBQUksU0FBSSxLQUFLLENBQUMsSUFBTSxDQUFDO1FBQzFDLElBQUksTUFBTSxHQUFHLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUM3QixJQUFJLEtBQUssR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDNUIsb0JBQW9CO1FBQ3BCLElBQUksTUFBTSxHQUFXO1lBQ25CLEVBQUUsRUFBRSxLQUFLO1lBQ1QsV0FBVyxFQUFFLEtBQUs7WUFDbEIsUUFBUSxFQUFFLEtBQUssQ0FBQyxVQUFVLENBQUMsUUFBUTtZQUNuQyxLQUFLLEVBQUUsS0FBSyxDQUFDLFVBQVUsQ0FBQyxRQUFRO1lBQ2hDLE9BQU8sRUFBRSxLQUFLO1lBQ2QsVUFBVSxFQUFFLEtBQUs7WUFDakIsU0FBUyxFQUFFLElBQUk7WUFDZixRQUFRLEVBQUUsSUFBSTtZQUNkLElBQUksRUFBRSxLQUFLO1lBQ1gsT0FBTyxFQUFFLEtBQUs7U0FDZixDQUFBO1FBQ0QsS0FBSyxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ3pDLEtBQUssQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDO1FBQ3RCLEtBQUssQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDO1FBQ25CLEtBQUssQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDdEIsSUFBSSxZQUFZLEdBQUcsRUFBQyxJQUFJLEVBQUUsaUJBQWlCLENBQUMsTUFBTSxFQUFFLEtBQUssRUFBRSxDQUFDLEtBQUssRUFBRSxLQUFLLENBQUMsRUFBQyxDQUFDO1FBQzNFLEtBQUssQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBQ3ZDLE1BQU0sQ0FBQyxZQUFZLENBQUM7SUFDdEIsQ0FBQztJQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxnQkFBZ0IsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ2hDLEdBQUcsQ0FBQyxtQ0FBbUMsQ0FBQyxDQUFDO1FBQ3pDLEtBQUssQ0FBQyxVQUFVLENBQUMsUUFBUSxHQUFHLEtBQUssQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDO1FBQ3RELEtBQUssQ0FBQyxVQUFVLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQztRQUNoQyxLQUFLLENBQUMsVUFBVSxDQUFDLE9BQU8sR0FBRyxLQUFLLENBQUM7UUFDakMsTUFBTSxDQUFDLEVBQUMsSUFBSSxFQUFFLGlCQUFpQixDQUFDLFlBQVksRUFBRSxLQUFLLEVBQUUsQ0FBQyxLQUFLLEVBQUUsS0FBSyxDQUFDLEVBQUMsQ0FBQztJQUN2RSxDQUFDO0lBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxLQUFLLEtBQUssQ0FBQyxJQUFJLGdCQUFnQixLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDeEQsR0FBRyxDQUFDLDBCQUEwQixDQUFDLENBQUM7UUFDaEMsTUFBTSxDQUFDLEVBQUMsSUFBSSxFQUFFLGlCQUFpQixDQUFDLElBQUksRUFBQyxDQUFDO0lBQ3hDLENBQUM7SUFBQyxJQUFJLENBQUMsQ0FBQztRQUNOLFFBQVE7UUFDUixHQUFHLENBQUMsMEJBQTBCLENBQUMsQ0FBQztRQUNoQyxNQUFNLENBQUMsRUFBQyxJQUFJLEVBQUUsaUJBQWlCLENBQUMsSUFBSSxFQUFDLENBQUM7SUFDeEMsQ0FBQztBQUNILENBQUM7QUF0RWUsa0NBQTBCLDZCQXNFekMsQ0FBQTtBQUVELG9DQUFvQyxJQUFVLEVBQUUsSUFBVSxFQUFFLE9BQWdCO0lBQzFFLCtEQUErRDtJQUMvRCx5Q0FBeUM7SUFDekMsR0FBRyxDQUFDLGlEQUE4QyxJQUFJLENBQUMsSUFBSSxpQkFBVSxJQUFJLENBQUMsSUFBSSxVQUFNLENBQUMsQ0FBQztJQUN0RixJQUFJLGVBQWUsR0FBRyxTQUFHLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQztTQUNoQyxNQUFNLENBQUMscUJBQXFCLEVBQUUsRUFBRSxVQUFVLEVBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxFQUFFLEVBQUUsRUFBRSxZQUFZLENBQUM7U0FDL0UsTUFBTSxDQUFDLGFBQWEsRUFBRSxFQUFFLE1BQU0sRUFBRSxDQUFDLFlBQVksRUFBRSxRQUFRLENBQUMsRUFBRSxTQUFTLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxFQUFFLEVBQUUsRUFBRSxLQUFLLENBQUM7U0FDaEcsSUFBSSxFQUFFLENBQUM7SUFDVixFQUFFLENBQUMsQ0FBQyxlQUFlLENBQUMsV0FBVyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzNDLEdBQUcsQ0FBQyw2QkFBNkIsQ0FBQyxDQUFDO1FBQ25DLDBCQUEwQjtRQUMxQixJQUFJLFNBQVMsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDO1FBQy9CLElBQUksT0FBTyxHQUFHLENBQUcsSUFBSSxDQUFDLElBQUksU0FBSSxJQUFJLENBQUMsSUFBSSxDQUFFLENBQUMsT0FBTyxDQUFDLElBQUksRUFBQyxFQUFFLENBQUMsQ0FBQztRQUMzRCxTQUFTLENBQUMsUUFBUSxHQUFHLE9BQU8sQ0FBQztRQUM3QixTQUFTLENBQUMsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDeEIsU0FBUyxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUM7UUFDekIsTUFBTSxDQUFDLEVBQUMsSUFBSSxFQUFFLGlCQUFpQixDQUFDLE1BQU0sRUFBRSxLQUFLLEVBQUUsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLEVBQUUsYUFBYSxFQUFFLEVBQUUsRUFBQyxDQUFDO0lBQ2xGLENBQUM7SUFDRCwrQkFBK0I7SUFDL0IsaUVBQWlFO0lBQ2pFLGVBQWUsR0FBRyxTQUFHLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQztTQUM1QixNQUFNLENBQUMscUJBQXFCLEVBQUUsRUFBRSxVQUFVLEVBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxFQUFFLEVBQUUsRUFBRSxZQUFZLENBQUM7U0FDL0UsTUFBTSxDQUFDLHFCQUFxQixFQUFFLEVBQUUsTUFBTSxFQUFFLENBQUMsWUFBWSxFQUFFLFFBQVEsQ0FBQyxFQUFFLEVBQUUsT0FBTyxDQUFDO1NBQzVFLE1BQU0sQ0FBQyxhQUFhLEVBQUUsRUFBRSxNQUFNLEVBQUUsQ0FBQyxPQUFPLEVBQUUsTUFBTSxDQUFDLEVBQUUsU0FBUyxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsRUFBRSxFQUFFLEVBQUUsS0FBSyxDQUFDO1NBQ3pGLElBQUksRUFBRSxDQUFDO0lBQ1YsRUFBRSxDQUFDLENBQUMsZUFBZSxDQUFDLFdBQVcsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUMzQyxHQUFHLENBQUMsOEJBQThCLENBQUMsQ0FBQztRQUNwQyxHQUFHLENBQUMsZUFBZSxDQUFDLENBQUE7UUFDcEIsd0JBQXdCO1FBQ3hCLElBQUksUUFBUSxHQUFHLHNCQUFzQixDQUFDLGVBQWUsQ0FBQyxXQUFXLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxNQUFNLENBQUMsQ0FBQztRQUNqRixJQUFJLFdBQVcsR0FBRyxxQkFBcUIsQ0FBQyxRQUFRLENBQUMsQ0FBQTtRQUNqRCxJQUFJLE1BQU0sQ0FBQztRQUNYLEVBQUUsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUMzQix1REFBdUQ7WUFDdkQsb0RBQW9EO1lBQ3BELE1BQU0sR0FBRyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDMUIsQ0FBQztRQUNELHdCQUF3QjtRQUN4QixJQUFJLGVBQWUsR0FBRyxpQkFBaUIsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUNoRCxJQUFJLFNBQVMsR0FBRyxRQUFRLENBQUMsZUFBZSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQ3RELElBQUksY0FBYyxHQUFHLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUN4QyxjQUFjLENBQUMsY0FBYyxFQUFFLE9BQU8sQ0FBQyxDQUFDO1FBQ3hDLElBQUksU0FBUyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUM7UUFDL0IsSUFBSSxPQUFPLEdBQUcsQ0FBRyxjQUFjLENBQUMsSUFBSSxTQUFJLElBQUksQ0FBQyxJQUFJLENBQUUsQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ3JFLFNBQVMsQ0FBQyxRQUFRLEdBQUcsT0FBTyxDQUFDO1FBQzdCLFNBQVMsQ0FBQyxJQUFJLEdBQUcsQ0FBQyxjQUFjLENBQUMsQ0FBQztRQUNsQyxTQUFTLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQztRQUN6Qiw4QkFBOEI7UUFDOUIsSUFBSSxPQUFPLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxRQUFRLENBQUM7UUFDdkMsSUFBSSxNQUFNLEdBQUcsUUFBUSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQy9CLElBQUksS0FBSyxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUM1QixJQUFJLFVBQVUsR0FBYztZQUMxQixFQUFFLEVBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxXQUFXO1lBQy9CLElBQUksRUFBRSxDQUFDLGNBQWMsQ0FBQztZQUN0QixJQUFJLEVBQUUsS0FBSztZQUNYLFdBQVcsRUFBRSxPQUFPO1lBQ3BCLFFBQVEsRUFBRSxPQUFPO1lBQ2pCLE9BQU8sRUFBRSxLQUFLO1NBQ2YsQ0FBQTtRQUNELEtBQUssQ0FBQyxTQUFTLEdBQUcsVUFBVSxDQUFDO1FBQzdCLEtBQUssQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUM1QyxLQUFLLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQztRQUNuQiwwQkFBMEI7UUFDMUIsY0FBYyxDQUFDLFVBQVUsQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDO1FBQ3pDLElBQUksQ0FBQyxVQUFVLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQztRQUMvQixJQUFJLFlBQVksR0FBRyxFQUFDLElBQUksRUFBRSxpQkFBaUIsQ0FBQyxNQUFNLEVBQUUsS0FBSyxFQUFFLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxFQUFFLGFBQWEsRUFBRSxDQUFDLEtBQUssQ0FBQyxFQUFDLENBQUM7UUFDakcsS0FBSyxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUM7UUFDdkMsY0FBYyxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUM7UUFDaEQsTUFBTSxDQUFDLFlBQVksQ0FBQztJQUN0QixDQUFDO0lBQ0Q7Ozs7Ozs7Ozs7OztPQVlHO0lBQ0gsR0FBRyxDQUFDLHlCQUF5QixDQUFDLENBQUM7SUFDL0IsTUFBTSxDQUFDLEVBQUMsSUFBSSxFQUFFLGlCQUFpQixDQUFDLElBQUksRUFBQyxDQUFDO0FBQ3hDLENBQUM7QUFFRCw2Q0FBNkM7QUFDN0MsZ0NBQWdDLElBQUksRUFBRSxFQUFVLEVBQUUsSUFBWSxFQUFFLEtBQWE7SUFDM0UsSUFBSSxPQUFPLEdBQWtCLEVBQUUsQ0FBQztJQUNoQyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsRUFBRSxHQUFHLEdBQUcsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDLEdBQUcsR0FBRyxFQUFFLENBQUMsSUFBSSxJQUFJLEVBQUUsQ0FBQztRQUN0RCxPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztJQUNwQyxDQUFDO0lBQ0QsTUFBTSxDQUFDLE9BQU8sQ0FBQztBQUNqQixDQUFDO0FBRUQsZ0RBQWdEO0FBQ2hELCtCQUErQixRQUF1QjtJQUNwRCxJQUFJLFlBQVksR0FBRyx3QkFBd0IsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUN6RCxZQUFZLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDcEIsR0FBRyxDQUFDLENBQWMsVUFBaUIsRUFBakIsS0FBQSxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxFQUE5QixjQUFTLEVBQVQsSUFBOEIsQ0FBQztRQUEvQixJQUFJLEtBQUssU0FBQTtRQUNaLElBQUksR0FBRyxHQUFHLHdCQUF3QixDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQzFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUNYLGNBQWMsQ0FBQyxZQUFZLEVBQUUsR0FBRyxDQUFDLENBQUM7S0FDbkM7SUFDRCxZQUFZLENBQUMsSUFBSSxDQUFDLFVBQUMsQ0FBQyxFQUFFLENBQUM7UUFDckIsTUFBTSxDQUFDLFNBQUcsQ0FBQyxPQUFPLENBQUMsWUFBWSxFQUFFLEVBQUUsVUFBVSxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsT0FBTyxDQUFDLEdBQUcsU0FBRyxDQUFDLE9BQU8sQ0FBQyxZQUFZLEVBQUUsRUFBRSxVQUFVLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUN2SCxDQUFDLENBQUMsQ0FBQztJQUNILE1BQU0sQ0FBQyxZQUFZLENBQUM7QUFDdEIsQ0FBQztBQUVELGtDQUFrQyxNQUFjO0lBQzlDLElBQUksUUFBUSxHQUFHLFNBQUcsQ0FBQyxJQUFJLENBQUMscUJBQXFCLEVBQUUsRUFBRSxRQUFBLE1BQU0sRUFBRSxDQUFDLENBQUM7SUFDM0QsTUFBTSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsVUFBQyxDQUFDLElBQUssT0FBQSxDQUFDLENBQUMsWUFBWSxDQUFDLEVBQWYsQ0FBZSxDQUFDLENBQUM7QUFDOUMsQ0FBQztBQUVELHdCQUF3QixJQUFVLEVBQUUsT0FBZ0I7SUFDbEQsSUFBSSxVQUFzQixDQUFDO0lBQzNCLFVBQVUsR0FBRyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDMUMsRUFBRSxDQUFDLENBQUMsVUFBVSxLQUFLLFNBQVMsQ0FBQyxDQUFDLENBQUM7UUFDN0IsT0FBTyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDekIsVUFBVSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7UUFDdkIsSUFBSSxDQUFDLFVBQVUsR0FBRyxVQUFVLENBQUM7UUFDN0IsSUFBSSxDQUFDLGVBQWUsQ0FBQyxVQUFVLEdBQUcsVUFBVSxDQUFDO1FBQzdDLElBQUksQ0FBQyxJQUFJLEdBQUcsU0FBUyxDQUFDLFVBQVUsQ0FBQztRQUNqQyxJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQztRQUNsQixJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDNUMsTUFBTSxDQUFDLElBQUksQ0FBQztJQUNkLENBQUM7SUFDRCxNQUFNLENBQUMsS0FBSyxDQUFDO0FBQ2YsQ0FBQztBQUVELG9CQUFvQixJQUFVLEVBQUUsT0FBZ0I7SUFDOUMsSUFBSSxNQUFjLENBQUM7SUFDbkIsTUFBTSxHQUFHLGFBQWEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDbEMsRUFBRSxDQUFDLENBQUMsTUFBTSxLQUFLLFNBQVMsQ0FBQyxDQUFDLENBQUM7UUFDekIsT0FBTyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDekIsTUFBTSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7UUFDbkIsSUFBSSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUM7UUFDckIsSUFBSSxDQUFDLGVBQWUsQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDO1FBQ3JDLElBQUksQ0FBQyxJQUFJLEdBQUcsU0FBUyxDQUFDLE1BQU0sQ0FBQztRQUM3QixJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQztRQUNsQixJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDeEMsTUFBTSxDQUFDLElBQUksQ0FBQztJQUNkLENBQUM7SUFDRCxNQUFNLENBQUMsS0FBSyxDQUFDO0FBQ2YsQ0FBQztBQUVELHVCQUF1QixJQUFVLEVBQUUsT0FBZ0I7SUFDakQsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksS0FBSyxNQUFNLENBQUMsQ0FBQyxDQUFDO1FBQ3pCLE1BQU0sQ0FBQyxLQUFLLENBQUM7SUFDZixDQUFDO0lBQ0QsSUFBSSxTQUFvQixDQUFDO0lBQ3pCLFNBQVMsR0FBRyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDeEMsRUFBRSxDQUFDLENBQUMsU0FBUyxLQUFLLFNBQVMsQ0FBQyxDQUFDLENBQUM7UUFDNUIsT0FBTyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDekIsU0FBUyxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7UUFDdEIsSUFBSSxDQUFDLFNBQVMsR0FBRyxTQUFTLENBQUM7UUFDM0IsSUFBSSxDQUFDLGVBQWUsQ0FBQyxTQUFTLEdBQUcsU0FBUyxDQUFDO1FBQzNDLElBQUksQ0FBQyxJQUFJLEdBQUcsU0FBUyxDQUFDLFNBQVMsQ0FBQztRQUNoQyxJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQztRQUNsQixJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDM0MsTUFBTSxDQUFDLElBQUksQ0FBQztJQUNkLENBQUM7SUFDRCxNQUFNLENBQUMsS0FBSyxDQUFDO0FBQ2YsQ0FBQztBQTJCRCw0QkFBNEIsYUFBMkIsRUFBRSxNQUFvQjtJQUMzRSxJQUFJLEtBQUssQ0FBQTtJQUNULEdBQUcsQ0FBQyxDQUFVLFVBQU0sRUFBZixrQkFBSyxFQUFMLElBQWUsQ0FBQztRQUFoQixLQUFLLEdBQUksTUFBTSxJQUFWO1FBQ1IsSUFBSSxjQUFjLEdBQUcsYUFBYSxDQUFDLE1BQU0sQ0FBQyxVQUFDLENBQUMsSUFBSyxPQUFBLENBQUMsQ0FBQyxJQUFJLEtBQUssS0FBSyxDQUFDLElBQUksRUFBckIsQ0FBcUIsQ0FBQyxDQUFDO1FBQ3hFLEVBQUUsQ0FBQyxDQUFDLGNBQWMsQ0FBQyxNQUFNLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNoQyxhQUFhLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQzVCLENBQUM7S0FDRjtBQUNILENBQUM7QUFFRCxvQkFBb0IsSUFBVTtJQUM1QixFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxLQUFLLGFBQWEsSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxLQUFLLFNBQVMsSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksS0FBSyxPQUFPLENBQUMsQ0FBQyxDQUFDO1FBQ3BHLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBQyxDQUFDLENBQUMsQ0FBQztJQUMxQixDQUFDO0lBQ0QsSUFBSSxNQUFNLEdBQUcsUUFBUSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztJQUM5QixNQUFNLENBQUMsSUFBSSxHQUFHLFFBQVEsQ0FBQztJQUN2QixNQUFNLENBQUMsTUFBTSxDQUFDO0FBQ2hCLENBQUM7QUFFRCxrQkFBeUIsS0FBbUIsRUFBRSxVQUF5QixFQUFFLFFBQXNCO0lBQzdGLEVBQUUsQ0FBQyxDQUFDLEtBQUssS0FBSyxTQUFTLENBQUMsQ0FBQyxDQUFDO1FBQ3hCLEtBQUssR0FBRyxFQUFFLENBQUM7SUFDYixDQUFDO0lBQ0QsRUFBRSxDQUFDLENBQUMsVUFBVSxLQUFLLFNBQVMsQ0FBQyxDQUFDLENBQUM7UUFDN0IsVUFBVSxHQUFHLEVBQUUsQ0FBQztJQUNsQixDQUFDO0lBQ0QsRUFBRSxDQUFDLENBQUMsUUFBUSxLQUFLLFNBQVMsQ0FBQyxDQUFDLENBQUM7UUFDM0IsUUFBUSxHQUFHLEVBQUUsQ0FBQztJQUNoQixDQUFDO0lBQ0QsZUFBZTtJQUNmLElBQUksV0FBVyxHQUFHLEtBQUssQ0FBQyxHQUFHLENBQUMsWUFBWSxDQUFDLENBQUM7SUFDMUMsSUFBSSxXQUFXLEdBQW1CLFdBQVcsQ0FBQyxHQUFHLENBQUMsVUFBQyxLQUFLLEVBQUUsS0FBSyxFQUFFLElBQUk7UUFDbkUsTUFBTSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLEtBQUssS0FBSyxDQUFDO0lBQ3ZDLENBQUMsQ0FBQyxDQUFDO0lBQ0gsS0FBSyxHQUFHLEtBQUssQ0FBQyxNQUFNLENBQUMsVUFBQyxJQUFJLEVBQUUsS0FBSyxJQUFLLE9BQUEsV0FBVyxDQUFDLEtBQUssQ0FBQyxFQUFsQixDQUFrQixDQUFDLENBQUM7SUFDMUQsSUFBSSxLQUFLLEdBQVU7UUFDakIsSUFBSSxFQUFFLE9BQU87UUFDYixLQUFLLEVBQUUsS0FBSztRQUNaLFVBQVUsRUFBRSxVQUFVO1FBQ3RCLFFBQVEsRUFBRSxRQUFRO1FBQ2xCLFFBQVEsRUFBRSxhQUFhO0tBQ3hCLENBQUE7SUFDRCx1QkFBdUIsS0FBYztRQUNuQyxFQUFFLENBQUMsQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLE1BQU0sS0FBSyxDQUFDLElBQUksS0FBSyxDQUFDLFFBQVEsQ0FBQyxNQUFNLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUM1RCxNQUFNLENBQUMsRUFBRSxDQUFDO1FBQ1osQ0FBQztRQUNELEVBQUUsQ0FBQyxDQUFDLEtBQUssS0FBSyxTQUFTLENBQUMsQ0FBQyxDQUFDO1lBQ3hCLEtBQUssR0FBRyxDQUFDLENBQUM7UUFDWixDQUFDO1FBQ0QsSUFBSSxNQUFNLEdBQUcsS0FBSyxDQUFDLEtBQUssR0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDdkMsSUFBSSxXQUFXLEdBQUcsTUFBTSxHQUFHLEdBQUcsQ0FBQztRQUMvQiw2Q0FBNkM7UUFDN0MsSUFBSSxVQUFVLEdBQUcsS0FBSyxDQUFDLElBQUksQ0FBQztRQUM1QixJQUFJLFVBQVUsR0FBRyxLQUFLLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxVQUFDLElBQUksSUFBSyxPQUFBLFlBQVksQ0FBQyxJQUFJLEVBQUMsS0FBSyxHQUFDLENBQUMsQ0FBQyxFQUExQixDQUEwQixDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ2xGLElBQUksZ0JBQWdCLEdBQUcsS0FBSyxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsVUFBQyxLQUFLLElBQUssT0FBQSxLQUFLLENBQUMsUUFBUSxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUMsRUFBekIsQ0FBeUIsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUM3RixJQUFJLGNBQWMsR0FBRyxLQUFLLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxVQUFDLElBQUksSUFBSyxPQUFBLFlBQVksQ0FBQyxJQUFJLEVBQUMsS0FBSyxHQUFDLENBQUMsQ0FBQyxFQUExQixDQUEwQixDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3pGLCtCQUErQjtRQUMvQixXQUFXLElBQUksVUFBVSxDQUFDO1FBQzFCLFdBQVcsSUFBSSxVQUFVLEtBQUssRUFBRSxHQUFHLEVBQUUsR0FBRyxJQUFJLEdBQUcsVUFBVSxDQUFDO1FBQzFELFdBQVcsSUFBSSxnQkFBZ0IsS0FBSyxFQUFFLEdBQUcsRUFBRSxHQUFHLElBQUksR0FBRyxnQkFBZ0IsQ0FBQztRQUN0RSxXQUFXLElBQUksY0FBYyxLQUFLLEVBQUUsR0FBRyxFQUFFLEdBQUcsSUFBSSxHQUFHLGNBQWMsQ0FBQztRQUNsRSxzQkFBc0I7UUFDdEIsV0FBVyxJQUFJLElBQUksR0FBRyxNQUFNLEdBQUcsR0FBRyxDQUFDO1FBQ25DLE1BQU0sQ0FBQyxXQUFXLENBQUM7SUFDckIsQ0FBQztJQUNELHNCQUFzQixJQUFVLEVBQUUsS0FBYztRQUM5QyxFQUFFLENBQUMsQ0FBQyxLQUFLLEtBQUssU0FBUyxDQUFDLENBQUMsQ0FBQztZQUN4QixLQUFLLEdBQUcsQ0FBQyxDQUFDO1FBQ1osQ0FBQztRQUNELElBQUksTUFBTSxHQUFHLEtBQUssQ0FBQyxLQUFLLEdBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3ZDLElBQUksVUFBVSxHQUFHLE1BQU0sR0FBRyxHQUFHLENBQUM7UUFDOUIsVUFBVSxJQUFPLElBQUksQ0FBQyxJQUFJLE1BQUcsQ0FBQztRQUM5QixVQUFVLElBQUksTUFBRyxJQUFJLENBQUMsS0FBSyxLQUFLLFNBQVMsR0FBRyxFQUFFLEdBQUcsT0FBSSxJQUFJLENBQUMsS0FBSyxRQUFJLENBQUUsQ0FBQztRQUN0RSxVQUFVLElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsVUFBQyxLQUFLLElBQUssT0FBQSxPQUFJLEtBQUssQ0FBQyxJQUFJLFVBQUksS0FBSyxDQUFDLFFBQVEsR0FBRyxLQUFLLENBQUMsS0FBSyxHQUFHLE9BQUksS0FBSyxDQUFDLEtBQUssT0FBRyxFQUFFLEVBQXJFLENBQXFFLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDMUgsVUFBVSxJQUFJLEdBQUcsQ0FBQztRQUNsQixNQUFNLENBQUMsVUFBVSxDQUFDO0lBQ3BCLENBQUM7SUFDRCxNQUFNLENBQUMsS0FBSyxDQUFDO0FBQ2YsQ0FBQztBQTNEZSxnQkFBUSxXQTJEdkIsQ0FBQTtBQUVELG1CQUFtQixJQUFVO0lBQzNCLElBQUksS0FBSyxHQUFVLFFBQVEsRUFBRSxDQUFDO0lBQzlCLElBQUksYUFBYSxHQUFpQixFQUFFLENBQUM7SUFFckMsNEJBQTRCO0lBQzVCLDRCQUE0QjtJQUM1Qiw0QkFBNEI7SUFFNUIsSUFBSSxZQUFZLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDaEQsd0JBQXdCO0lBQ3hCLElBQUkscUJBQXFCLEdBQWlCLEVBQUUsQ0FBQztJQUM3QyxHQUFHLENBQUMsQ0FBZSxVQUFZLEVBQTFCLHdCQUFVLEVBQVYsSUFBMEIsQ0FBQztRQUEzQixJQUFJLE1BQU0sR0FBSSxZQUFZLElBQWhCO1FBQ2IsS0FBSyxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDL0MsS0FBSyxDQUFDLFVBQVUsR0FBRyxLQUFLLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDOUQsMkJBQTJCO1FBQzNCLEdBQUcsQ0FBQyxDQUFnQixVQUFlLEVBQWYsS0FBQSxNQUFNLENBQUMsUUFBUSxFQUE5QixjQUFXLEVBQVgsSUFBOEIsQ0FBQztZQUEvQixJQUFJLE9BQU8sU0FBQTtZQUNkLEVBQUUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxLQUFLLEtBQUssU0FBUyxDQUFDLENBQUMsQ0FBQztnQkFDaEMsa0JBQWtCLENBQUMscUJBQXFCLEVBQUUsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQzVELENBQUM7U0FDRjtLQUNGO0lBQ0QsRUFBRSxDQUFDLENBQUMscUJBQXFCLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDckMsYUFBYSxHQUFHLHFCQUFxQixDQUFDO0lBQ3hDLENBQUM7SUFDRCxhQUFhO0lBQ2IsS0FBSyxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxVQUFDLENBQUMsRUFBQyxDQUFDO1FBQ2pDLElBQUksS0FBSyxHQUFHLE9BQU8sQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDN0IsSUFBSSxLQUFLLEdBQUcsT0FBTyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUM3QixpQkFBaUIsS0FBYTtZQUM1QixFQUFFLENBQUMsQ0FBQyxLQUFLLEtBQUssYUFBYSxDQUFDLENBQUMsQ0FBQztnQkFBQyxNQUFNLENBQUMsQ0FBQyxDQUFBO1lBQUMsQ0FBQztZQUN6QyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsS0FBSyxLQUFLLHFCQUFxQixDQUFDLENBQUMsQ0FBQztnQkFBQyxNQUFNLENBQUMsQ0FBQyxDQUFBO1lBQUMsQ0FBQztZQUN0RCxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsS0FBSyxLQUFLLGlCQUFpQixDQUFDLENBQUMsQ0FBQztnQkFBQyxNQUFNLENBQUMsQ0FBQyxDQUFBO1lBQUMsQ0FBQztZQUNsRCxJQUFJLENBQUMsQ0FBQztnQkFBQyxNQUFNLENBQUMsQ0FBQyxDQUFBO1lBQUMsQ0FBQztRQUNuQixDQUFDO1FBQ0QsTUFBTSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUM7SUFDdkIsQ0FBQyxDQUFDLENBQUM7SUFFSCwyQkFBMkI7SUFDM0IsMEJBQTBCO0lBQzFCLDJCQUEyQjtJQUUzQiwwQkFBMEI7SUFDMUIsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLElBQUksSUFBSSxDQUFDLFdBQVcsQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQy9FLEVBQUUsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUM3QixJQUFJLE9BQU8sR0FBRztnQkFDWixJQUFJLEVBQUUsVUFBVTtnQkFDaEIsTUFBTSxFQUFFLGFBQWE7YUFDdEIsQ0FBQTtZQUNELEtBQUssQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQy9CLENBQUM7UUFDRCxNQUFNLENBQUMsS0FBSyxDQUFDO0lBQ2YsQ0FBQztJQUNELG1EQUFtRDtJQUNuRCxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLFVBQVUsQ0FBQyxRQUFRLENBQUM7UUFDckMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEtBQUssYUFBYSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7UUFDM0MsR0FBRyxDQUFDLDRCQUE0QixHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUM5QyxJQUFJLFdBQVcsR0FBRyxLQUFLLENBQUMsS0FBSyxDQUFDLEdBQUcsRUFBRSxDQUFDO1FBQ3BDLElBQUksWUFBWSxHQUFHLFVBQVUsQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUMzQyxLQUFLLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQztRQUNwQyxhQUFhLEdBQUcsRUFBRSxDQUFDO0lBQ3JCLENBQUM7SUFDRCxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLFVBQVUsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUN6QyxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksS0FBSyxhQUFhLENBQUMsU0FBUztRQUN6QyxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksS0FBSyxhQUFhLENBQUMsU0FBUztRQUN6QyxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksS0FBSyxhQUFhLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzVDLHlEQUF5RDtRQUN6RCxJQUFJLFlBQVksR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxVQUFDLEtBQUssSUFBSyxPQUFBLEtBQUssQ0FBQyxLQUFLLEVBQVgsQ0FBVyxDQUFDLENBQUM7UUFFL0Qsb0RBQW9EO1FBQ3BELElBQUksTUFBTSxDQUFDO1FBQ1gsRUFBRSxDQUFDLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQztZQUNqQixHQUFHLENBQUMsOEJBQThCLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ2hELElBQUksSUFBSSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLFVBQUMsS0FBSyxJQUFLLE9BQUEsS0FBSyxDQUFDLFdBQVcsQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDLEVBQXRDLENBQXNDLENBQUMsQ0FBQyxHQUFHLENBQUMsVUFBQyxHQUFHLElBQUssT0FBQSxHQUFHLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxFQUFmLENBQWUsQ0FBQyxDQUFDO1lBQ2pILElBQUksTUFBTSxHQUFpQixJQUFJLENBQUMsR0FBRyxDQUFDLFVBQUMsR0FBRyxFQUFDLENBQUM7Z0JBQ3hDLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7b0JBQzVDLE1BQU0sQ0FBQyxTQUFTLENBQUM7Z0JBQ25CLENBQUM7Z0JBQ0QsTUFBTSxDQUFDLEVBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUk7b0JBQzdCLEtBQUssRUFBRSxHQUFHLENBQUMsU0FBUyxDQUFDLFFBQVE7b0JBQzdCLFFBQVEsRUFBRSxHQUFHLENBQUMsU0FBUyxDQUFDLFlBQVksS0FBSyxTQUFTLEdBQUcsR0FBRyxDQUFDLFNBQVMsQ0FBQyxZQUFZLEdBQUcsSUFBSTtpQkFDdEYsQ0FBQztZQUNYLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxVQUFDLENBQUMsSUFBSyxPQUFBLENBQUMsS0FBSyxTQUFTLEVBQWYsQ0FBZSxDQUFDLENBQUM7WUFDbEMsSUFBSSxJQUFJLEdBQVM7Z0JBQ2YsSUFBSSxFQUFFLFFBQVE7Z0JBQ2QsS0FBSyxFQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSTtnQkFDcEIsTUFBTSxFQUFFLE1BQU07Z0JBQ2QsSUFBSSxFQUFFLElBQUk7YUFDWCxDQUFBO1lBQ0QsS0FBSyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDdkIsOEJBQThCO1lBQzlCLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsT0FBTyxLQUFLLElBQUksQ0FBQyxDQUFDLENBQUM7Z0JBQzlCLGFBQWEsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLFVBQUMsR0FBRyxJQUFLLE9BQUEsR0FBRyxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxFQUF6QyxDQUF5QyxDQUFDO3FCQUMxRCxHQUFHLENBQUMsVUFBQyxHQUFHO29CQUFNLE1BQU0sQ0FBQyxFQUFDLElBQUksRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUk7d0JBQ25CLEtBQUssRUFBRSxHQUFHLENBQUMsU0FBUyxDQUFDLFFBQVE7d0JBQzdCLFFBQVEsRUFBRSxJQUFJLEVBQUMsQ0FBQTtnQkFBQSxDQUFDLENBQUMsQ0FBQztnQkFDN0QsSUFBSSxDQUFDLEdBQUcsQ0FBQyxVQUFDLENBQUM7b0JBQ1QsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxVQUFVLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDO3dCQUN4QyxDQUFDLENBQUMsU0FBUyxDQUFDLE9BQU8sR0FBRyxLQUFLLENBQUM7d0JBQzVCLENBQUMsQ0FBQyxTQUFTLENBQUMsV0FBVyxHQUFHLFNBQVMsQ0FBQztvQkFDdEMsQ0FBQztvQkFBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxVQUFVLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDO3dCQUNoRCxDQUFDLENBQUMsVUFBVSxDQUFDLE9BQU8sR0FBRyxLQUFLLENBQUM7d0JBQzdCLENBQUMsQ0FBQyxVQUFVLENBQUMsV0FBVyxHQUFHLFNBQVMsQ0FBQztvQkFDdkMsQ0FBQztnQkFDSCxDQUFDLENBQUMsQ0FBQztnQkFDSCxLQUFLLENBQUMsUUFBUSxHQUFHLEVBQUUsQ0FBQyxDQUFDLCtCQUErQjtZQUN0RCxDQUFDO1FBQ0gsQ0FBQztJQUNILENBQUM7SUFDRCxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLFVBQVUsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUN6QyxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksS0FBSyxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzNDLElBQUksWUFBWSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLFVBQUMsS0FBSyxJQUFLLE9BQUEsS0FBSyxDQUFDLEtBQUssRUFBWCxDQUFXLENBQUMsQ0FBQztRQUMvRCxFQUFFLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDO1lBQ2pCLEdBQUcsQ0FBQyw4QkFBOEIsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7WUFFaEQsSUFBSSxTQUFTLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDN0MsRUFBRSxDQUFDLENBQUMsU0FBUyxDQUFDLFdBQVcsQ0FBQyxVQUFVLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUNqRCxTQUFTLENBQUMsVUFBVSxDQUFDLE9BQU8sR0FBRyxLQUFLLENBQUM7WUFDdkMsQ0FBQztZQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxTQUFTLENBQUMsV0FBVyxDQUFDLFVBQVUsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ3ZELFNBQVMsQ0FBQyxTQUFTLENBQUMsT0FBTyxHQUFHLEtBQUssQ0FBQztZQUN0QyxDQUFDO1lBRUQsSUFBSSxRQUFRLEdBQUcsS0FBSyxDQUFDO1lBQ3JCLElBQUksTUFBTSxHQUFHLFNBQVMsQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUNsQyxLQUFLLEdBQUcsUUFBUSxFQUFFLENBQUM7WUFDbkIsS0FBSyxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDaEMsS0FBSyxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDakQsQ0FBQztJQUNILENBQUM7SUFDRCxvREFBb0Q7SUFDcEQsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxVQUFVLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7UUFDdEUsR0FBRyxDQUFDLCtCQUErQixHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNqRCxJQUFJLE1BQU0sR0FBaUIsRUFBRSxDQUFDO1FBQzlCLElBQUksSUFBSSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUM7UUFDMUIsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksS0FBSyxTQUFTLENBQUMsQ0FBQyxDQUFDO1lBQzVCLEdBQUcsQ0FBQyxDQUFZLFVBQVMsRUFBVCxLQUFBLElBQUksQ0FBQyxJQUFJLEVBQXBCLGNBQU8sRUFBUCxJQUFvQixDQUFDO2dCQUFyQixJQUFJLEdBQUcsU0FBQTtnQkFDVixJQUFJLFNBQVMsR0FBRyxHQUFHLENBQUMsTUFBTSxLQUFLLFNBQVMsR0FBRyxHQUFHLENBQUMsTUFBTSxDQUFDLEVBQUUsR0FBRyxHQUFHLENBQUMsVUFBVSxDQUFDLFFBQVEsQ0FBQztnQkFDbkYsSUFBSSxRQUFRLEdBQUcsR0FBRyxDQUFDLE1BQU0sS0FBSyxTQUFTLElBQUksR0FBRyxDQUFDLE1BQU0sQ0FBQyxVQUFVLEtBQUssS0FBSyxHQUFHLEtBQUssR0FBRyxJQUFJLENBQUM7Z0JBQzFGLEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxNQUFNLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztvQkFDeEIsSUFBSSxXQUFXLEdBQUc7d0JBQ2hCLElBQUksRUFBRSxRQUFRO3dCQUNkLEtBQUssRUFBRSxTQUFTO3dCQUNoQixRQUFRLEVBQUUsUUFBUTtxQkFDbkIsQ0FBQztvQkFDRixNQUFNLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO2dCQUMzQixDQUFDO2dCQUNELGlFQUFpRTtnQkFDakUsSUFBSSxRQUFRLEdBQUcsU0FBUyxDQUFDLEdBQUcsQ0FBQyxDQUFDO2dCQUM5QixLQUFLLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQztnQkFDakQsRUFBRSxDQUFDLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztvQkFDakMsa0JBQWtCLENBQUMsYUFBYSxFQUFFLFFBQVEsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUE7Z0JBQ2hFLENBQUM7YUFDRjtRQUNILENBQUM7UUFDRCxJQUFJLFNBQVMsR0FBRztZQUNkLElBQUksRUFBRSxXQUFXO1lBQ2pCLEtBQUssRUFBRSxJQUFJLENBQUMsRUFBRTtZQUNkLFFBQVEsRUFBRSxLQUFLO1NBQ2hCLENBQUM7UUFDRixNQUFNLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQ3ZCLElBQUksVUFBVSxHQUFHO1lBQ2YsSUFBSSxFQUFFLE9BQU87WUFDYixLQUFLLEVBQUUsSUFBSSxDQUFDLFFBQVE7WUFDcEIsUUFBUSxFQUFFLElBQUksQ0FBQyxZQUFZLEtBQUssU0FBUyxHQUFHLElBQUksQ0FBQyxZQUFZLEdBQUcsSUFBSTtTQUNyRSxDQUFDO1FBQ0YsTUFBTSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUN4QixJQUFJLElBQUksR0FBUztZQUNmLElBQUksRUFBRSxRQUFRO1lBQ2QsS0FBSyxFQUFFLGFBQWE7WUFDcEIsTUFBTSxFQUFFLE1BQU07WUFDZCxJQUFJLEVBQUUsSUFBSTtTQUNYLENBQUE7UUFDRCxLQUFLLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUN2Qix1QkFBdUI7UUFDdkIsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO1lBQzNCLElBQUksZ0JBQWdCLEdBQUc7Z0JBQ3JCLElBQUksRUFBRSxJQUFJLENBQUMsV0FBVyxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUMsRUFBRSxDQUFDO2dCQUN2QyxLQUFLLEVBQUUsSUFBSSxDQUFDLFFBQVE7Z0JBQ3BCLFFBQVEsRUFBRSxJQUFJO2FBQ2YsQ0FBQztZQUNGLElBQUksQ0FBQyxXQUFXLEdBQUcsZ0JBQWdCLENBQUMsSUFBSSxDQUFDO1lBQ3pDLGtCQUFrQixDQUFDLGFBQWEsRUFBRSxDQUFDLGdCQUFnQixDQUFDLENBQUMsQ0FBQztRQUN4RCxDQUFDO1FBQ0QsSUFBSSxDQUFDLFNBQVMsQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDO0lBQ2hDLENBQUM7SUFDRCxxREFBcUQ7SUFDckQsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxVQUFVLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7UUFDeEUsR0FBRyxDQUFDLGdDQUFnQyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNsRCxJQUFJLFVBQVUsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDO1FBQ2pDLElBQUksV0FBVyxHQUFHO1lBQ2hCLElBQUksRUFBRSxRQUFRO1lBQ2QsS0FBSyxFQUFFLFVBQVUsQ0FBQyxRQUFRO1lBQzFCLFFBQVEsRUFBRSxJQUFJO1NBQ2YsQ0FBQztRQUNGLElBQUksZUFBZSxHQUFHO1lBQ3BCLElBQUksRUFBRSxZQUFZO1lBQ2xCLEtBQUssRUFBRSxVQUFVLENBQUMsRUFBRTtZQUNwQixRQUFRLEVBQUUsS0FBSztTQUNoQixDQUFDO1FBQ0YsSUFBSSxJQUFJLEdBQVM7WUFDZixJQUFJLEVBQUUsUUFBUTtZQUNkLEtBQUssRUFBRSxpQkFBaUI7WUFDeEIsTUFBTSxFQUFFLENBQUMsV0FBVyxFQUFFLGVBQWUsQ0FBQztZQUN0QyxJQUFJLEVBQUUsSUFBSTtTQUNYLENBQUE7UUFDRCxLQUFLLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUN2Qix1QkFBdUI7UUFDdkIsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO1lBQzVCLElBQUksaUJBQWlCLEdBQUc7Z0JBQ3RCLElBQUksRUFBRSxVQUFVLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUMsRUFBRSxDQUFDO2dCQUMxQyxLQUFLLEVBQUUsVUFBVSxDQUFDLFFBQVE7Z0JBQzFCLFFBQVEsRUFBRSxJQUFJO2FBQ2YsQ0FBQztZQUNGLFVBQVUsQ0FBQyxXQUFXLEdBQUcsaUJBQWlCLENBQUMsSUFBSSxDQUFDO1lBQ2hELGtCQUFrQixDQUFDLGFBQWEsRUFBRSxDQUFDLGlCQUFpQixDQUFDLENBQUMsQ0FBQztRQUN6RCxDQUFDO1FBQ0QsSUFBSSxDQUFDLFVBQVUsQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDO0lBQ2pDLENBQUM7SUFDRCxrREFBa0Q7SUFDbEQsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7UUFDaEUsR0FBRyxDQUFDLDRCQUE0QixHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUM5QyxJQUFJLE1BQU0sR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDO1FBQ3pCLElBQUksTUFBTSxHQUFHLEVBQUUsQ0FBQztRQUNoQixJQUFJLFdBQVcsR0FBRztZQUNoQixJQUFJLEVBQUUsUUFBUTtZQUNkLEtBQUssRUFBRSxNQUFNLENBQUMsU0FBUyxHQUFHLE1BQU0sQ0FBQyxRQUFRLEdBQUcsTUFBTSxDQUFDLEVBQUU7WUFDckQsUUFBUSxFQUFFLE1BQU0sQ0FBQyxTQUFTO1NBQzNCLENBQUM7UUFDRixNQUFNLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBRXpCLEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDO1lBQ3JCLElBQUksVUFBVSxHQUFHO2dCQUNmLElBQUksRUFBRSxNQUFNLENBQUMsU0FBUyxHQUFHLE1BQU0sR0FBRyxPQUFPO2dCQUN6QyxLQUFLLEVBQUUsTUFBTSxDQUFDLFFBQVEsR0FBRyxNQUFNLENBQUMsS0FBSyxHQUFHLE1BQU0sQ0FBQyxFQUFFO2dCQUNqRCxRQUFRLEVBQUUsTUFBTSxDQUFDLFFBQVE7YUFDMUIsQ0FBQztZQUNGLE1BQU0sQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDMUIsQ0FBQztRQUNELElBQUksSUFBSSxHQUFTO1lBQ2YsSUFBSSxFQUFFLFFBQVE7WUFDZCxLQUFLLEVBQUUsTUFBTSxDQUFDLFNBQVMsR0FBRyxxQkFBcUIsR0FBRyxhQUFhO1lBQy9ELE1BQU0sRUFBRSxNQUFNO1lBQ2QsSUFBSSxFQUFFLElBQUk7U0FDWCxDQUFBO1FBQ0QsS0FBSyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDdkIsdUJBQXVCO1FBQ3ZCLEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxPQUFPLEtBQUssSUFBSSxDQUFDLENBQUMsQ0FBQztZQUM1QixJQUFJLGFBQWEsR0FBRztnQkFDbEIsSUFBSSxFQUFFLE1BQU0sQ0FBQyxXQUFXLENBQUMsT0FBTyxDQUFDLElBQUksRUFBQyxFQUFFLENBQUM7Z0JBQ3pDLEtBQUssRUFBRSxNQUFNLENBQUMsRUFBRTtnQkFDaEIsUUFBUSxFQUFFLEtBQUs7YUFDaEIsQ0FBQztZQUNGLE1BQU0sQ0FBQyxXQUFXLEdBQUcsYUFBYSxDQUFDLElBQUksQ0FBQztZQUN4QyxrQkFBa0IsQ0FBQyxhQUFhLEVBQUUsQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFDO1FBQ3JELENBQUM7UUFDRCxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUM7SUFDN0IsQ0FBQztJQUNELHdDQUF3QztJQUN4QyxFQUFFLENBQUMsQ0FBQyxhQUFhLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDN0IsSUFBSSxPQUFPLEdBQUc7WUFDWixJQUFJLEVBQUUsVUFBVTtZQUNoQixNQUFNLEVBQUUsYUFBYTtTQUN0QixDQUFBO1FBQ0QsS0FBSyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDL0IsQ0FBQztJQUNELE1BQU0sQ0FBQyxLQUFLLENBQUM7QUFDZixDQUFDO0FBRUQsK0VBQStFO0FBQy9FLDBCQUEwQjtBQUMxQixnRkFBZ0Y7QUFDaEYsSUFBSSxPQUFPLEdBQUcsa0ZBQWtGLENBQUM7QUFFdEYsYUFBSyxHQUFHLEtBQUssQ0FBQztBQUV6QixhQUFhLENBQU07SUFDakIsRUFBRSxDQUFDLENBQUMsYUFBSyxDQUFDLENBQUMsQ0FBQztRQUNWLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDakIsQ0FBQztBQUNILENBQUM7QUFFRCx1QkFBdUIsS0FBWSxFQUFFLEVBQVcsRUFBRSxFQUFXLEVBQUUsRUFBVyxFQUFFLEVBQVcsRUFBRSxFQUFXO0lBQ2xHLElBQUksVUFBVSxHQUFHLE1BQUksS0FBSyxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsVUFBQyxRQUFvQixJQUFLLE9BQUEsVUFBVSxDQUFDLFFBQVEsQ0FBQyxFQUFwQixDQUFvQixDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxNQUFHLENBQUM7SUFDdkcsVUFBVSxHQUFHLFVBQVUsQ0FBQyxNQUFNLEtBQUssQ0FBQyxHQUFHLEVBQUUsR0FBRyxVQUFVLENBQUM7SUFDdkQsSUFBSSxTQUFTLEdBQUcsS0FBSyxDQUFDLEtBQUssS0FBSyxTQUFTLEdBQUcsR0FBRyxHQUFHLE9BQUssS0FBSyxDQUFDLEtBQUssU0FBSSxLQUFLLENBQUMsR0FBRyxPQUFJLENBQUM7SUFDcEYsSUFBSSxPQUFPLEdBQUcsS0FBSyxDQUFDLEVBQUUsR0FBQyxNQUFHLEtBQUssQ0FBQyxFQUFFLENBQUUsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQzNELElBQUksT0FBTyxHQUFHLEtBQUssQ0FBQyxFQUFFLEdBQUMsTUFBRyxLQUFLLENBQUMsWUFBWSxDQUFFLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUNyRSxJQUFJLE9BQU8sR0FBRyxLQUFLLENBQUMsRUFBRSxHQUFDLE1BQUcsS0FBSyxDQUFDLGNBQWMsQ0FBRSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDdkUsSUFBSSxPQUFPLEdBQUcsS0FBSyxDQUFDLEVBQUUsR0FBRyxNQUFHLGtCQUFrQixDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBRSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDL0YsSUFBSSxPQUFPLEdBQUcsS0FBSyxDQUFDLEVBQUUsR0FBRyxNQUFHLGtCQUFrQixDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBRSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDbEYsSUFBSSxXQUFXLEdBQU0sS0FBSyxDQUFDLEVBQUUsU0FBSSxPQUFPLFNBQUksS0FBSyxDQUFDLFlBQVksR0FBRyxPQUFPLFdBQU0sS0FBSyxDQUFDLGNBQWMsR0FBRyxPQUFPLFdBQU0sa0JBQWtCLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLE9BQU8sV0FBTSxrQkFBa0IsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLEdBQUcsT0FBTyxXQUFNLFVBQVksQ0FBRTtJQUN2TyxNQUFNLENBQUMsV0FBVyxDQUFDO0FBQ3JCLENBQUM7QUFFRCw0QkFBbUMsTUFBb0I7SUFDckQsSUFBSSxFQUFFLEdBQVcsTUFBRyxNQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sR0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUUsQ0FBQyxNQUFNLENBQUM7SUFDeEQsSUFBSSxFQUFFLEdBQVcsTUFBTSxDQUFDLEdBQUcsQ0FBQyxVQUFDLEtBQUssSUFBSyxPQUFBLEtBQUssQ0FBQyxZQUFZLENBQUMsTUFBTSxFQUF6QixDQUF5QixDQUFDLENBQUMsTUFBTSxDQUFDLFVBQUMsQ0FBQyxFQUFDLENBQUM7UUFDM0UsRUFBRSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO1FBQUMsQ0FBQztRQUFDLElBQUksQ0FBQyxDQUFDO1lBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztRQUFDLENBQUM7SUFDN0MsQ0FBQyxDQUFDLENBQUM7SUFDSCxJQUFJLEVBQUUsR0FBVyxNQUFNLENBQUMsR0FBRyxDQUFDLFVBQUMsS0FBSyxJQUFLLE9BQUEsS0FBSyxDQUFDLGNBQWMsQ0FBQyxNQUFNLEVBQTNCLENBQTJCLENBQUMsQ0FBQyxNQUFNLENBQUMsVUFBQyxDQUFDLEVBQUMsQ0FBQztRQUM3RSxFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7UUFBQyxDQUFDO1FBQUMsSUFBSSxDQUFDLENBQUM7WUFBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO1FBQUMsQ0FBQztJQUM3QyxDQUFDLENBQUMsQ0FBQztJQUNILElBQUksRUFBRSxHQUFXLE1BQU0sQ0FBQyxHQUFHLENBQUMsVUFBQyxLQUFLLElBQUssT0FBQSxNQUFHLGtCQUFrQixDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBRSxDQUFDLE1BQU0sRUFBdEQsQ0FBc0QsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxVQUFDLENBQUMsRUFBQyxDQUFDO1FBQ3hHLEVBQUUsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztRQUFDLENBQUM7UUFBQyxJQUFJLENBQUMsQ0FBQztZQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7UUFBQyxDQUFDO0lBQzdDLENBQUMsQ0FBQyxDQUFDO0lBQ0gsSUFBSSxFQUFFLEdBQVcsTUFBTSxDQUFDLEdBQUcsQ0FBQyxVQUFDLEtBQUssSUFBSyxPQUFBLE1BQUcsa0JBQWtCLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFFLENBQUMsTUFBTSxFQUF6QyxDQUF5QyxDQUFDLENBQUMsTUFBTSxDQUFDLFVBQUMsQ0FBQyxFQUFDLENBQUM7UUFDM0YsRUFBRSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO1FBQUMsQ0FBQztRQUFDLElBQUksQ0FBQyxDQUFDO1lBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztRQUFDLENBQUM7SUFDN0MsQ0FBQyxDQUFDLENBQUM7SUFDSCxJQUFJLGdCQUFnQixHQUFHLE1BQU0sQ0FBQyxHQUFHLENBQUMsVUFBQyxLQUFLLElBQUssT0FBQSxhQUFhLENBQUMsS0FBSyxFQUFDLEVBQUUsRUFBQyxFQUFFLEVBQUMsRUFBRSxFQUFDLEVBQUUsRUFBQyxFQUFFLENBQUMsRUFBbkMsQ0FBbUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUM3RixNQUFNLENBQUMsT0FBTyxHQUFHLElBQUksR0FBRyxnQkFBZ0IsR0FBRyxJQUFJLEdBQUcsT0FBTyxDQUFDO0FBQzVELENBQUM7QUFoQmUsMEJBQWtCLHFCQWdCakMsQ0FBQTtBQUVELCtFQUErRTtBQUMvRSxvQkFBb0I7QUFDcEIsK0VBQStFO0FBRS9FLDRCQUE0QixXQUE4QjtJQUN4RCxJQUFJLFNBQVMsR0FBZSxFQUFFLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxFQUFFLEVBQUMsV0FBVyxDQUFDLENBQUM7SUFDNUQsTUFBTSxDQUFDLFNBQVMsQ0FBQztBQUNuQixDQUFDO0FBRUQsb0JBQW9CLEtBQUssRUFBRSxLQUFLLEVBQUUsSUFBSTtJQUNwQyxNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsS0FBSyxLQUFLLENBQUM7QUFDdkMsQ0FBQztBQUVELHdCQUF3QixDQUFDLEVBQUUsQ0FBQztJQUMxQixJQUFJLEVBQUUsR0FBRyxDQUFDLENBQUM7SUFDWCxJQUFJLEVBQUUsR0FBRyxDQUFDLENBQUM7SUFDWCxJQUFJLE1BQU0sR0FBRyxFQUFFLENBQUM7SUFDaEIsT0FBTyxFQUFFLEdBQUcsQ0FBQyxDQUFDLE1BQU0sSUFBSSxFQUFFLEdBQUcsQ0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDO1FBQ3RDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUM7WUFBQyxFQUFFLEVBQUUsQ0FBQztRQUN4QixJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUFDLEVBQUUsRUFBRSxDQUFDO1FBQzdCLElBQUksQ0FBQyxDQUFDO1lBQ0osTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztZQUNuQixFQUFFLEVBQUUsQ0FBQztZQUNMLEVBQUUsRUFBRSxDQUFDO1FBQ1AsQ0FBQztJQUNILENBQUM7SUFDRCxNQUFNLENBQUMsTUFBTSxDQUFDO0FBQ2hCLENBQUM7QUFFRCxtQkFBbUIsQ0FBTTtJQUN2QixNQUFNLENBQUMsQ0FBQyxLQUFLLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQzlDLENBQUM7QUFFRCxrQkFBa0IsSUFBVTtJQUMxQixJQUFJLE1BQU0sR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsQ0FBQyxLQUFLLENBQUMsVUFBQyxDQUFDLElBQUcsT0FBQSxDQUFDLEVBQUQsQ0FBQyxDQUFDLENBQUM7SUFDdkQsRUFBRSxDQUFDLENBQUMsTUFBTSxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO1FBQ3pCLE1BQU0sQ0FBQyxJQUFJLENBQUM7SUFDZCxDQUFDO0lBQUMsSUFBSSxDQUFDLENBQUM7UUFDTixNQUFNLENBQUMsS0FBSyxDQUFDO0lBQ2YsQ0FBQztBQUNILENBQUM7QUFJRCxNQUFNLENBQUMsTUFBTSxDQUFDLEdBQUcsT0FBTyxDQUFDOzs7QUMxeUZ6QixzQ0FBc0M7QUFDdEMsOENBQThDO0FBQzlDLElBQVksVUFBVSxXQUFNLGNBQWMsQ0FBQyxDQUFBO0FBQzNDLElBQVksT0FBTyxXQUFNLFdBQVcsQ0FBQyxDQUFBO0FBQ3JDLDJCQUF5QixjQUFjLENBQUMsQ0FBQTtBQUN4QyxzQkFBK0IsU0FBUyxDQUFDLENBQUE7QUFFOUIsb0JBQVksR0FBRyxDQUFDLGFBQWEsRUFBRSxNQUFNLEVBQUUsUUFBUSxFQUFFLGVBQWUsRUFBRSxnQkFBZ0IsRUFBRSx5QkFBeUIsRUFBRSx1QkFBdUIsRUFBRSxzQkFBc0IsQ0FBQyxDQUFDO0FBQ2hLLDBCQUFrQixHQUFHLEtBQUssQ0FBQztBQUV0QywyREFBMkQ7QUFDM0QsV0FBVztBQUNYLDJEQUEyRDtBQUUzRCxJQUFJLFNBQVMsQ0FBQztBQUNkLElBQUksV0FBVyxDQUFDO0FBQ2hCLElBQUksVUFBVSxHQUFHLENBQUMsQ0FBQztBQUduQjtJQUNFLGdCQUFRLEdBQUcsSUFBSSxVQUFVLENBQUMsUUFBUSxFQUFFLENBQUM7SUFDckMsa0JBQVUsR0FBRyxJQUFJLHVCQUFVLENBQUMsV0FBRyxDQUFDLENBQUM7SUFDakMsUUFBUSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsZ0JBQVEsQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUM1QyxNQUFNLENBQUMsZ0JBQWdCLENBQUMsUUFBUSxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQzFDLFdBQVcsR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQzVDLFdBQVcsQ0FBQyxFQUFFLEdBQUcsV0FBVyxDQUFDO0lBQzdCLFFBQVEsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLFdBQVcsQ0FBQyxDQUFDO0FBQ3pDLENBQUM7QUFFRCxFQUFFLENBQUEsQ0FBQyxXQUFHLEtBQUssU0FBUyxDQUFDO0lBQUMsSUFBSSxXQUFXLEdBQUcsTUFBTSxDQUFDLGFBQWEsQ0FBQyxJQUFJLEVBQUUsR0FBRyxFQUFFLGNBQU0sT0FBQSxDQUFDLElBQUksSUFBSSxFQUFFLENBQUMsQ0FBQyxPQUFPLEVBQUUsRUFBdEIsQ0FBc0IsRUFBRSxDQUFBO0FBRTNGLG1CQUFXLEdBQUcsRUFBRSxDQUFDO0FBQzVCO0lBQ0UsRUFBRSxDQUFBLENBQUMsQ0FBQyxnQkFBUSxJQUFJLGdCQUFRLENBQUMsTUFBTSxDQUFDO1FBQUMsTUFBTSxDQUFDO0lBQ3hDLGdCQUFRLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQztJQUN2QixxQkFBcUIsQ0FBQztRQUNwQixJQUFJLEtBQUssR0FBTyxFQUFFLENBQUM7UUFDbkIsSUFBSSxLQUFLLEdBQUcsV0FBVyxDQUFDLEdBQUcsRUFBRSxDQUFDO1FBRTlCLElBQUksS0FBSyxHQUFHLEVBQUUsQ0FBQztRQUNmLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxJQUFJLElBQUksbUJBQVcsQ0FBQyxDQUFDLENBQUM7WUFDN0IsS0FBSyxDQUFDLElBQUksQ0FBQyxtQkFBVyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUNsQyxDQUFDO1FBRUQsS0FBSyxDQUFDLElBQUksR0FBRyxDQUFDLFdBQVcsQ0FBQyxHQUFHLEVBQUUsR0FBRyxLQUFLLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDcEQsRUFBRSxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsSUFBSSxHQUFHLEVBQUUsQ0FBQztZQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsYUFBYSxHQUFHLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUUvRCxLQUFLLEdBQUcsV0FBVyxDQUFDLEdBQUcsRUFBRSxDQUFDO1FBQzFCLElBQUksU0FBUyxHQUFHLFdBQUcsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUMsR0FBRyxDQUFDLFVBQUMsRUFBRSxJQUFLLE9BQUEsRUFBRSxDQUFDLFVBQVUsQ0FBQyxFQUFkLENBQWMsQ0FBQyxDQUFDO1FBQ2xFLEVBQUUsQ0FBQSxDQUFDLGFBQUssSUFBSSxhQUFLLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQztZQUM3QixPQUFPLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRSxTQUFTLENBQUMsQ0FBQztZQUNyQyxPQUFPLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxrQkFBVSxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDO1FBQ25ELENBQUM7UUFDRCxLQUFLLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLEVBQUUsa0JBQVUsQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQztRQUN2RCxLQUFLLENBQUMsU0FBUyxHQUFHLENBQUMsV0FBVyxDQUFDLEdBQUcsRUFBRSxHQUFHLEtBQUssQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUN6RCxFQUFFLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxTQUFTLEdBQUcsRUFBRSxDQUFDO1lBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxtQkFBbUIsR0FBRyxLQUFLLENBQUMsU0FBUyxDQUFDLENBQUM7UUFFL0UsS0FBSyxHQUFHLFdBQVcsQ0FBQyxHQUFHLEVBQUUsQ0FBQztRQUMxQixnQkFBUSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUN2QixLQUFLLENBQUMsTUFBTSxHQUFHLENBQUMsV0FBVyxDQUFDLEdBQUcsRUFBRSxHQUFHLEtBQUssQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUN0RCxLQUFLLENBQUMsTUFBTSxHQUFHLFVBQVUsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFFckMsSUFBSSxJQUFJLEdBQUcsRUFBRSxDQUFDO1FBQ2QsSUFBSSxJQUFJLGlCQUFlLEtBQUssQ0FBQyxJQUFJLFlBQVMsQ0FBQztRQUMzQyx5REFBeUQ7UUFDekQsSUFBSSxJQUFJLG1CQUFpQixLQUFLLENBQUMsTUFBTSxZQUFTLENBQUM7UUFDL0MsSUFBSSxJQUFJLG1CQUFpQixLQUFLLENBQUMsTUFBTSxZQUFTLENBQUM7UUFDL0MsV0FBVyxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUM7UUFDN0IsU0FBUyxHQUFHLEtBQUssQ0FBQztRQUVsQixnQkFBUSxDQUFDLE1BQU0sR0FBRyxLQUFLLENBQUM7SUFDMUIsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDO0FBeENlLGNBQU0sU0F3Q3JCLENBQUE7QUFFRCxJQUFJLFdBQVcsR0FBRyxLQUFLLENBQUM7QUFDeEI7SUFDRSxFQUFFLENBQUEsQ0FBQyxXQUFXLENBQUM7UUFBQyxNQUFNLENBQUM7SUFDdkIsV0FBVyxHQUFHLElBQUksQ0FBQztJQUNuQixVQUFVLENBQUM7UUFDVCxJQUFJLFVBQVUsR0FBRyxXQUFHLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3JDLEVBQUUsQ0FBQyxDQUFDLDBCQUFrQixLQUFLLEtBQUssQ0FBQyxDQUFDLENBQUM7WUFDakMsR0FBRyxDQUFDLENBQWUsVUFBWSxFQUExQixnQ0FBVSxFQUFWLElBQTBCLENBQUM7Z0JBQTNCLElBQUksTUFBTSxHQUFJLG9CQUFZLElBQWhCO2dCQUNiLE9BQU8sVUFBVSxDQUFDLE1BQU0sQ0FBQyxDQUFDO2FBQzNCO1FBQ0gsQ0FBQztRQUNELE9BQU8sVUFBVSxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBQ2hDLFlBQVksQ0FBQywwQkFBa0IsQ0FBQyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDOUQsV0FBVyxHQUFHLEtBQUssQ0FBQztJQUN0QixDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUM7QUFDWCxDQUFDO0FBRUQsMkRBQTJEO0FBQzNELFdBQVc7QUFDWCwyREFBMkQ7QUFFM0QsSUFBSSxVQUFVLEdBQUcsRUFBRSxDQUFDO0FBRXBCLGdCQUF1QixLQUFLLEVBQUUsSUFBSTtJQUNoQyxFQUFFLENBQUMsQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3RCLE9BQU8sQ0FBQyxLQUFLLENBQUMsOEJBQTRCLEtBQUssTUFBRyxDQUFDLENBQUM7SUFDdEQsQ0FBQztJQUNELFVBQVUsQ0FBQyxLQUFLLENBQUMsR0FBRyxJQUFJLENBQUM7QUFDM0IsQ0FBQztBQUxlLGNBQU0sU0FLckIsQ0FBQTtBQUVELGtCQUF5QixLQUFjLEVBQUUsSUFBNkIsRUFBRSxZQUFhO0lBQ25GLElBQUksTUFBTSxHQUFHLFlBQVksQ0FBQztJQUMxQixFQUFFLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7UUFDWixNQUFNLEdBQUcsV0FBRyxDQUFDLElBQUksRUFBRSxDQUFDO1FBQ3BCLE1BQU0sQ0FBQyxJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQztRQUMxQixNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUM7SUFDM0IsQ0FBQztJQUNELE1BQU0sQ0FBQyxRQUFRLEdBQUcsVUFBQyxLQUFLLEVBQUUsSUFBSTtRQUM1QixNQUFNLENBQUMsUUFBUSxDQUFDLEtBQUssRUFBRSxJQUFJLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFDdkMsQ0FBQyxDQUFDO0lBQ0YsTUFBTSxDQUFDLE1BQU0sR0FBRztRQUNkLElBQUksS0FBSyxHQUFHLFdBQVcsQ0FBQyxHQUFHLEVBQUUsQ0FBQztRQUM5Qiw4RUFBOEU7UUFDOUUsb0ZBQW9GO1FBQ3BGLG1EQUFtRDtRQUNuRCxrQ0FBa0M7UUFDbEMsbURBQW1EO1FBQ25ELHdDQUF3QztRQUN4Qyx3Q0FBd0M7UUFDeEMsNkVBQTZFO1FBQzdFLE9BQU87UUFDUCxFQUFFLENBQUEsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDO1lBQ3hCLFdBQUcsQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDeEIsQ0FBQztRQUFDLElBQUksQ0FBQyxDQUFDO1lBQ04sV0FBRyxDQUFDLG9CQUFvQixDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ25DLENBQUM7UUFDRCxFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7WUFDdkIsTUFBTSxFQUFFLENBQUM7UUFDWCxDQUFDO1FBQ0QsRUFBRSxDQUFDLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO1lBQ3RCLFlBQVksRUFBRSxDQUFDO1lBQ2YsRUFBRSxDQUFDLENBQUMsMEJBQWtCLEtBQUssS0FBSyxDQUFDLENBQUMsQ0FBQztnQkFDakMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQ3hCLENBQUM7UUFDSCxDQUFDO1FBQ0QsVUFBVSxHQUFHLFdBQVcsQ0FBQyxHQUFHLEVBQUUsR0FBRyxLQUFLLENBQUM7SUFDekMsQ0FBQyxDQUFBO0lBQ0QsRUFBRSxDQUFBLENBQUMsQ0FBQyxLQUFLLENBQUM7UUFBQyxNQUFNLENBQUMsTUFBTSxDQUFDO0lBQ3pCLElBQUksSUFBSSxHQUFHLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUM3QixFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7UUFDVixPQUFPLENBQUMsS0FBSyxDQUFDLHdCQUFzQixLQUFLLGVBQVUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUksQ0FBQyxDQUFDO0lBQzlFLENBQUM7SUFBQyxJQUFJLENBQUMsQ0FBQztRQUNOLElBQUksQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDckIsQ0FBQztJQUNELE1BQU0sQ0FBQyxNQUFNLENBQUM7QUFDaEIsQ0FBQztBQTdDZSxnQkFBUSxXQTZDdkIsQ0FBQTtBQUVELHlEQUF5RDtBQUN6RCxNQUFNLENBQUMsVUFBVSxFQUFFLFVBQUMsT0FBb0I7QUFDeEMsQ0FBQyxDQUFDLENBQUM7QUFHSCwyREFBMkQ7QUFDM0QsUUFBUTtBQUNSLDJEQUEyRDtBQUVoRCxXQUFHLEdBQUcsT0FBTyxDQUFDLE9BQU8sRUFBRSxDQUFDO0FBQ3hCLG9CQUFZLEdBQUcsRUFBRSxDQUFDO0FBQ2xCLHNCQUFjLEdBQUcsRUFBRSxDQUFDO0FBRS9CLGNBQXFCLElBQUksRUFBRSxJQUFJO0lBQzdCLG9CQUFZLENBQUMsSUFBSSxDQUFDLEdBQUcsSUFBSSxDQUFDO0FBQzVCLENBQUM7QUFGZSxZQUFJLE9BRW5CLENBQUE7QUFFRDtJQUNFLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxRQUFRLElBQUksb0JBQVksQ0FBQyxDQUFDLENBQUM7UUFDbEMsb0JBQVksQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDO0lBQzNCLENBQUM7QUFDSCxDQUFDO0FBRUQsMkRBQTJEO0FBQzNELFlBQVk7QUFDWiwyREFBMkQ7QUFFM0QsSUFBSSxFQUFFLEdBQUcsWUFBSSxFQUFFLENBQUM7QUFDaEIsRUFBRSxDQUFBLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUM7SUFDckIsRUFBRSxDQUFBLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQUMsRUFBRSxHQUFHLFlBQVksQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUMvQyxJQUFJO1FBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQztBQUMvQixDQUFDO0FBR0Q7SUFDRSxjQUFNLEdBQUcsSUFBSSxTQUFTLENBQUMsV0FBUSxNQUFNLENBQUMsUUFBUSxDQUFDLFFBQVEsSUFBSSxXQUFXLFdBQU8sQ0FBQyxDQUFDO0lBQy9FLGNBQU0sQ0FBQyxPQUFPLEdBQUc7UUFDZixPQUFPLENBQUMsS0FBSyxDQUFDLDREQUE0RCxDQUFDLENBQUM7UUFDNUUsMEJBQWtCLEdBQUcsV0FBVyxDQUFDO1FBQ2pDLG1CQUFtQixFQUFFLENBQUM7UUFDdEIsTUFBTSxFQUFFLENBQUM7SUFDWCxDQUFDLENBQUE7SUFDRCxjQUFNLENBQUMsTUFBTSxHQUFHO1FBQ2QsVUFBVSxDQUFDLFNBQVMsRUFBRSxFQUFFLENBQUMsQ0FBQztJQUM1QixDQUFDLENBQUE7SUFDRCxjQUFNLENBQUMsU0FBUyxHQUFHLFVBQUMsSUFBSTtRQUN0QixJQUFJLE1BQU0sR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNuQyxPQUFPLENBQUMsR0FBRyxDQUFDLGFBQWEsRUFBRSxNQUFNLENBQUMsQ0FBQztRQUVuQyxFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsSUFBSSxLQUFLLE1BQU0sQ0FBQyxDQUFDLENBQUM7WUFDM0IseUJBQXlCO1lBQ3pCLG1CQUFtQixFQUFFLENBQUM7WUFDdEIsTUFBTSxFQUFFLENBQUM7UUFDWCxDQUFDO1FBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxJQUFJLEtBQUssV0FBVyxDQUFDLENBQUMsQ0FBQztZQUN2QyxJQUFJLElBQUksR0FBRyxXQUFHLENBQUMsSUFBSSxFQUFFLENBQUM7WUFDdEIsSUFBSSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDO1lBQzFCLFdBQUcsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDcEIsTUFBTSxFQUFFLENBQUM7UUFDWCxDQUFDO0lBQ0gsQ0FBQyxDQUFDO0FBQ0osQ0FBQztBQUVELG9CQUFvQixXQUFXLEVBQUUsSUFBSTtJQUNuQyxFQUFFLENBQUMsQ0FBQyxDQUFDLGNBQU0sQ0FBQztRQUFDLE1BQU0sQ0FBQztJQUNwQixjQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsRUFBRSxJQUFJLEVBQUUsV0FBVyxFQUFFLElBQUEsRUFBRSxFQUFFLElBQUksRUFBRSxDQUFDLElBQUksSUFBSSxDQUFDLENBQUMsT0FBTyxFQUFFLEVBQUUsTUFBQSxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUM7QUFDM0YsQ0FBQztBQUVELHVCQUF1QixTQUFTO0lBQzlCLEVBQUUsQ0FBQyxDQUFDLENBQUMsY0FBTSxDQUFDO1FBQUMsTUFBTSxDQUFDO0lBQ3BCLElBQUksT0FBTyxHQUFHLEVBQUUsQ0FBQztJQUNqQixJQUFJLElBQUksR0FBRyxLQUFLLENBQUM7SUFDakIsR0FBRyxDQUFDLENBQWMsVUFBWSxFQUF6QixnQ0FBUyxFQUFULElBQXlCLENBQUM7UUFBMUIsSUFBSSxLQUFLLEdBQUksb0JBQVksSUFBaEI7UUFDWixFQUFFLENBQUMsQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUM1QixJQUFJLEdBQUcsSUFBSSxDQUFDO1lBQ1osT0FBTyxDQUFDLEtBQUssQ0FBQyxHQUFHLFNBQVMsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDM0MsQ0FBQztLQUNGO0lBQ0QsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDO1FBQUMsVUFBVSxDQUFDLFdBQVcsRUFBRSxPQUFPLENBQUMsQ0FBQztBQUM3QyxDQUFDO0FBRUQsMkRBQTJEO0FBQzNELEtBQUs7QUFDTCwyREFBMkQ7QUFDM0QsRUFBRSxDQUFBLENBQUMsV0FBRyxLQUFLLFNBQVMsQ0FBQyxDQUFDLENBQUM7SUFDckIsUUFBUSxDQUFDLGdCQUFnQixDQUFDLGtCQUFrQixFQUFFLFVBQVMsS0FBSztRQUMxRCxZQUFZLEVBQUUsQ0FBQztRQUNmLHFCQUFxQjtRQUNyQiwwQkFBa0IsR0FBRyxXQUFXLENBQUM7UUFDakMsbUJBQW1CLEVBQUUsQ0FBQztRQUN0QixNQUFNLEVBQUUsQ0FBQztJQUNYLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQztBQUVELElBQUksQ0FBQyxXQUFXLEVBQUM7SUFDZixJQUFJLE1BQU0sR0FBRyxZQUFZLENBQUMsMEJBQWtCLENBQUMsQ0FBQztJQUM5QyxFQUFFLENBQUEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO1FBQ1YsV0FBRyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUNuQixDQUFDO0FBQ0gsQ0FBQyxDQUFDLENBQUM7QUFHSCxFQUFFLENBQUEsQ0FBQyxXQUFHLEtBQUssU0FBUyxDQUFDO0lBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxHQUFHLE9BQU8sQ0FBQzs7O0FDNVA5QyxzQkFBMEMsU0FDMUMsQ0FBQyxDQURrRDtBQUNuRCxJQUFZLE9BQU8sV0FBTSxXQUN6QixDQUFDLENBRG1DO0FBQ3BDLElBQVksR0FBRyxXQUFNLE9BQ3JCLENBQUMsQ0FEMkI7QUFDNUIsb0JBQWtCLE9BQ2xCLENBQUMsQ0FEd0I7QUFDekIsdUJBQTBDLFVBQzFDLENBQUMsQ0FEbUQ7QUFDcEQsOEJBQThCLGlCQUM5QixDQUFDLENBRDhDO0FBQy9DLDJCQUFpQixjQUVqQixDQUFDLENBRjhCO0FBRXBCLFlBQUksR0FBRyxTQUFHLENBQUM7QUFHdEIsK0VBQStFO0FBQy9FLFlBQVk7QUFDWiwrRUFBK0U7QUFFL0UsT0FBTyxDQUFDLE1BQU0sQ0FBQyxrQkFBa0IsRUFBRSxFQUFDLE1BQU0sRUFBRSxRQUFRLEVBQUMsRUFBRSxVQUFTLElBQUk7SUFDbEUsRUFBRSxDQUFBLENBQUMsT0FBTyxJQUFJLEtBQUssUUFBUSxDQUFDLENBQUMsQ0FBQztRQUM1QixNQUFNLENBQUMsRUFBQyxNQUFNLEVBQUUsK0JBQWUsQ0FBQyxJQUFJLENBQUMsRUFBQyxDQUFDO0lBQ3pDLENBQUM7SUFDRCxNQUFNLENBQUMsRUFBQyxNQUFNLEVBQUUsSUFBSSxFQUFDLENBQUM7QUFDeEIsQ0FBQyxDQUFDLENBQUE7QUFFRiw2Q0FBNkM7QUFDN0MsMkNBQTJDO0FBQzNDLDRDQUE0QztBQUM1Qyx3RkFBd0Y7QUFDeEYsbURBQW1EO0FBQ25ELDREQUE0RDtBQUM1RCxnREFBZ0Q7QUFDaEQsMEJBQTBCO0FBQzFCLHdFQUF3RTtBQUN4RSxRQUFRO0FBQ1IsbUJBQW1CO0FBQ25CLE1BQU07QUFDTixzQ0FBc0M7QUFDdEMsSUFBSTtBQUVKO0lBUUUsaUJBQW1CLElBQW9CLEVBQVMsU0FBdUI7UUFBOUIseUJBQThCLEdBQTlCLFlBQW1CLElBQUksQ0FBQyxJQUFJLEVBQUU7UUFBcEQsU0FBSSxHQUFKLElBQUksQ0FBZ0I7UUFBUyxjQUFTLEdBQVQsU0FBUyxDQUFjO1FBUDdELFdBQU0sR0FBMkIsRUFBRSxDQUFDO1FBQ3BDLGdCQUFXLEdBQTZCLEVBQUUsQ0FBQztRQUMzQyxjQUFTLEdBQVksRUFBRSxDQUFDO1FBQ3hCLFNBQUksR0FBcUIsRUFBRSxDQUFDO1FBQzVCLGFBQVEsR0FBbUMsRUFBRSxDQUFDO1FBQzlDLFdBQU0sR0FBMkIsRUFBRSxDQUFDO0lBRTRCLENBQUM7SUFFM0UsMEJBQVEsR0FBUixVQUFTLElBQVc7UUFDbEIsTUFBTSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDM0IsQ0FBQztJQUNELDRCQUFVLEdBQVYsVUFBVyxJQUFXO1FBQ3BCLE1BQU0sQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ2hDLENBQUM7SUFDRCx1QkFBSyxHQUFMLFVBQU0sWUFBcUI7UUFDekIsR0FBRyxDQUFBLENBQUMsR0FBRyxDQUFDLElBQUksSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztZQUM1QixFQUFFLENBQUEsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLE9BQU8sQ0FBQztnQkFBQyxZQUFJLENBQUMsUUFBUSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7UUFDaEYsQ0FBQztRQUNELEVBQUUsQ0FBQSxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUM7WUFDaEIsR0FBRyxDQUFBLENBQUMsR0FBRyxDQUFDLElBQUksSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztnQkFDNUIsRUFBRSxDQUFBLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxPQUFPLENBQUM7b0JBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1lBQ2hHLENBQUM7WUFDRCxHQUFHLENBQUEsQ0FBZSxVQUFjLEVBQWQsS0FBQSxJQUFJLENBQUMsU0FBUyxFQUE1QixjQUFVLEVBQVYsSUFBNEIsQ0FBQztnQkFBN0IsSUFBSSxNQUFNLFNBQUE7Z0JBQW9CLElBQUksQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLGdCQUFnQixFQUFFLEVBQUMsUUFBQSxNQUFNLEVBQUMsQ0FBQyxDQUFDO2FBQUE7WUFDcEYsR0FBRyxDQUFBLENBQUMsR0FBRyxDQUFDLEVBQUUsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDO2dCQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLGVBQUUsQ0FBQyxNQUFNLENBQUMsRUFBRSxFQUFFLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1FBQzFFLENBQUM7UUFDRCxZQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUNqQyxDQUFDO0lBRUQsK0VBQStFO0lBQy9FLFNBQVM7SUFDVCwrRUFBK0U7SUFDL0UseUJBQU8sR0FBUCxVQUFRLEtBQVksRUFBRSxJQUFPO1FBQzNCLElBQUksQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsQ0FBQztRQUNoQyxNQUFNLENBQUMsSUFBSSxDQUFDO0lBQ2QsQ0FBQztJQUVELDJCQUFTLEdBQVQsVUFBVSxNQUFhLEVBQUUsSUFBVyxFQUFFLEtBQWMsRUFBRSxVQUFjLEVBQUUsWUFBb0I7UUFDeEYsTUFBTSxHQUFHLGlCQUFTLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDM0IsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxNQUFNLENBQUM7UUFDM0IsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDNUIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxjQUFjLEVBQUUsRUFBQyxFQUFFLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUMsQ0FBQyxDQUFDO1FBQ3ZELElBQUksSUFBSSxHQUFHLEVBQUUsQ0FBQztRQUNkLEdBQUcsQ0FBQSxDQUFhLFVBQUssRUFBakIsaUJBQVEsRUFBUixJQUFpQixDQUFDO1lBQWxCLElBQUksSUFBSSxHQUFJLEtBQUssSUFBVDtZQUNWLElBQUksUUFBUSxHQUFNLE1BQU0sY0FBUyxJQUFNLENBQUM7WUFDeEMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFJLElBQUksZ0NBQTJCLFFBQVEsTUFBRyxDQUFDLENBQUM7WUFDMUQsSUFBSSxVQUFVLEdBQUcsaUJBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNqQyxJQUFJLENBQUMsT0FBTyxDQUFDLGNBQWMsRUFBRSxFQUFDLEVBQUUsRUFBRSxVQUFVLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBQyxDQUFDLENBQUM7WUFDM0QsSUFBSSxDQUFDLE9BQU8sQ0FBQyxhQUFhLEVBQUUsRUFBQyxRQUFBLE1BQU0sRUFBRSxTQUFTLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxVQUFVLEVBQUUsTUFBTSxFQUFFLFFBQVEsRUFBQyxDQUFDLENBQUE7U0FDOUY7UUFDRCxJQUFJLGVBQWUsR0FBRyxFQUFFLENBQUM7UUFDekIsRUFBRSxDQUFBLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQztZQUNiLGVBQWUsR0FBTSxpQkFBUyxDQUFDLElBQUksQ0FBQyxjQUFTLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFJLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxHQUFHLEtBQUssR0FBRyxFQUFFLFVBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLE1BQUcsQ0FBQztRQUN4SSxJQUFJLE9BQU8sR0FBRyxPQUFTLFVBQ25CLEVBQWUsUUFDbEIsb0NBRmEsYUFBSyxDQUFDLENBQUMsQ0FBQyxLQUNsQixlQUFlLEVBQ2xCLENBQUM7UUFDRixFQUFFLENBQUEsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDO1lBQ2QsR0FBRyxDQUFBLENBQUMsR0FBRyxDQUFDLElBQUksSUFBSSxVQUFVLENBQUMsQ0FBQyxDQUFDO2dCQUMzQixJQUFJLFFBQVEsR0FBTSxNQUFNLFNBQUksSUFBSSxTQUFJLFVBQVUsQ0FBQyxJQUFJLENBQUcsQ0FBQztnQkFDdkQsSUFBSSxLQUFLLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxVQUFVLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQzlELElBQUksQ0FBQyxPQUFPLENBQUMsYUFBYSxFQUFFLEVBQUMsUUFBQSxNQUFNLEVBQUUsU0FBUyxFQUFFLElBQUksRUFBRSxPQUFBLEtBQUssRUFBRSxNQUFNLEVBQUUsUUFBUSxFQUFDLENBQUMsQ0FBQztZQUNsRixDQUFDO1FBQ0gsQ0FBQztRQUNELEVBQUUsQ0FBQSxDQUFDLFlBQVksQ0FBQztZQUFDLE9BQU8sSUFBSSxJQUFJLEdBQUcsWUFBWSxDQUFDO1FBQ2hELElBQUksSUFBSSxHQUFNLE1BQU0sVUFBTyxDQUFDO1FBQzVCLElBQUksQ0FBQyxPQUFPLENBQUMsY0FBYyxFQUFFLEVBQUMsTUFBQSxJQUFJLEVBQUUsU0FBQSxPQUFPLEVBQUMsQ0FBQyxDQUFDO1FBQzlDLElBQUksQ0FBQyxPQUFPLENBQUMsYUFBYSxFQUFFLEVBQUMsUUFBQSxNQUFNLEVBQUUsTUFBQSxJQUFJLEVBQUMsQ0FBQyxDQUFDO1FBQzVDLE1BQU0sQ0FBQyxJQUFJLENBQUM7O0lBQ2QsQ0FBQztJQUVELHlCQUFPLEdBQVAsVUFBUSxJQUFXLEVBQUUsSUFBVyxFQUFFLE1BQWU7UUFDL0MsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxJQUFJLENBQUM7UUFDekIsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsR0FBRyxNQUFNLENBQUM7UUFDaEMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLEVBQUUsRUFBQyxNQUFBLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFDLENBQUMsQ0FBQztRQUN6QyxHQUFHLENBQUEsQ0FBYyxVQUFNLEVBQW5CLGtCQUFTLEVBQVQsSUFBbUIsQ0FBQztZQUFwQixJQUFJLEtBQUssR0FBSSxNQUFNLElBQVY7WUFBWSxJQUFJLENBQUMsT0FBTyxDQUFDLE9BQU8sRUFBRSxFQUFDLE1BQUEsSUFBSSxFQUFFLE9BQUEsS0FBSyxFQUFDLENBQUMsQ0FBQztTQUFBO1FBQzlELElBQUksTUFBTSxHQUFNLElBQUksVUFBTyxDQUFDO1FBQzVCLElBQUksQ0FBQyxTQUFTLENBQUMsTUFBTSxFQUFFLE1BQU0sRUFBRSxDQUFDLFFBQVEsRUFBRSxJQUFJLENBQUMsRUFBRSxTQUFTLEVBQUUsT0FBUywyQkFFakUsRUFBb0QsUUFDdkQscURBSDJELGFBQUssQ0FBQyxDQUFDLENBQUMsS0FFaEUsTUFBTSxDQUFDLEdBQUcsQ0FBQyxVQUFDLEtBQUssSUFBSyxPQUFBLFFBQUssS0FBSyxDQUFFLEVBQVosQ0FBWSxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxFQUN2RCxDQUFDLENBQUM7UUFDSCxNQUFNLENBQUMsSUFBSSxDQUFDOztJQUNkLENBQUM7SUFFRCwwQkFBUSxHQUFSLFVBQVMsSUFBVyxFQUFFLE1BQWU7UUFDbkMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsT0FBTyxFQUFFLE1BQU0sQ0FBQyxDQUFDO1FBQ3BDLE1BQU0sQ0FBQyxJQUFJLENBQUM7SUFDZCxDQUFDO0lBRUQsMEJBQVEsR0FBUixVQUFTLElBQVcsRUFBRSxNQUFlLEVBQUUsT0FBc0I7UUFBdEIsdUJBQXNCLEdBQXRCLGNBQXNCO1FBQzNELElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFFLE9BQU8sRUFBRSxNQUFNLENBQUMsQ0FBQztRQUNwQyxFQUFFLENBQUEsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO1lBQ1gsSUFBSSxLQUFLLEdBQUcsYUFBVyxJQUFNLENBQUM7WUFDOUIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLEVBQUUsTUFBTSxDQUFDLENBQUM7WUFDN0IsSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDbkMsQ0FBQztRQUVELE1BQU0sQ0FBQyxJQUFJLENBQUM7SUFDZCxDQUFDO0lBRUQsZ0NBQWMsR0FBZCxVQUFlLEtBQVksRUFBRSxNQUFjLEVBQUUsT0FBVztRQUN0RCw2QkFBNkI7UUFDN0IsRUFBRSxDQUFBLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO1lBQ1osRUFBRSxDQUFBLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsS0FBSyxPQUFPLENBQUM7Z0JBQUMsTUFBTSxJQUFJLEtBQUssQ0FBQyxZQUFVLEtBQUssMENBQXVDLENBQUMsQ0FBQztZQUM3RyxPQUFPLEdBQUcsRUFBRSxDQUFDO1lBQ2IsR0FBRyxDQUFBLENBQWMsVUFBc0IsRUFBdEIsS0FBQSxJQUFJLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxFQUFuQyxjQUFTLEVBQVQsSUFBbUMsQ0FBQztnQkFBcEMsSUFBSSxLQUFLLFNBQUE7Z0JBQTRCLE9BQU8sQ0FBQyxLQUFLLENBQUMsR0FBRyxLQUFLLENBQUM7YUFBQTtRQUNsRSxDQUFDO1FBQ0QsSUFBSSxNQUFNLEdBQU0sS0FBSyxhQUFRLE1BQU0sYUFBUSxJQUFJLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBRyxDQUFDO1FBQ3JFLElBQUksQ0FBQyxPQUFPLENBQUMsUUFBUSxFQUFFLEVBQUMsSUFBSSxFQUFFLEtBQUssRUFBRSxRQUFBLE1BQU0sRUFBRSxJQUFJLEVBQUUsT0FBTyxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUMsQ0FBQzthQUNoRSxPQUFPLENBQUMsZUFBZSxFQUFFLEVBQUMsUUFBQSxNQUFNLEVBQUUsYUFBYSxFQUFFLE1BQU0sRUFBQyxDQUFDLENBQUM7UUFFN0QsR0FBRyxDQUFBLENBQUMsR0FBRyxDQUFDLEtBQUssSUFBSSxPQUFPLENBQUMsQ0FBQyxDQUFDO1lBQ3pCLElBQUksTUFBTSxHQUFHLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUM1QixFQUFFLENBQUEsQ0FBQyxNQUFNLENBQUMsV0FBVyxLQUFLLEtBQUssQ0FBQyxDQUFDLENBQUM7Z0JBQ2hDLElBQUksQ0FBQyxPQUFPLENBQUMseUJBQXlCLEVBQUUsRUFBQyxRQUFBLE1BQU0sRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLE9BQU8sRUFBRSxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUMsQ0FBQyxDQUFDO1lBQ3JGLENBQUM7WUFBQyxJQUFJLENBQUMsQ0FBQztnQkFDTixJQUFJLENBQUMsT0FBTyxDQUFDLGdCQUFnQixFQUFFLEVBQUMsUUFBQSxNQUFNLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxXQUFXLEVBQUUsTUFBTSxFQUFFLFVBQVUsRUFBRSxNQUFNLEVBQUMsQ0FBQyxDQUFDO1lBQ2pHLENBQUM7UUFDSCxDQUFDO1FBQ0QsTUFBTSxDQUFDLElBQUksQ0FBQztJQUNkLENBQUM7SUFFRCwwQkFBUSxHQUFSLFVBQVMsSUFBVyxFQUFFLEtBQW1CO1FBQ3ZDLEtBQUssQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDO1FBQ2xCLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLEdBQUcsS0FBSyxDQUFDO1FBQzVCLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFFLE9BQU8sRUFBRSxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxhQUFhLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQztRQUNwRSxJQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1FBQ2pELE1BQU0sQ0FBQyxJQUFJLENBQUM7SUFDZCxDQUFDO0lBRUQsOEJBQVksR0FBWixVQUFhLFNBQW1CO1FBQzlCLElBQUksS0FBSyxHQUFHLFNBQVMsQ0FBQyxLQUFLLENBQUM7UUFDNUIsR0FBRyxDQUFBLENBQUMsR0FBRyxDQUFDLElBQUksSUFBSSxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztZQUNoQyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLE9BQU8sQ0FBQztRQUM5QixDQUFDO1FBQ0QsR0FBRyxDQUFBLENBQUMsR0FBRyxDQUFDLEVBQUUsSUFBSSxLQUFLLENBQUM7WUFBQyxJQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLENBQUMsU0FBUyxDQUFDLFNBQUcsQ0FBQyxDQUFDLENBQUM7UUFDcEUsTUFBTSxDQUFDLElBQUksQ0FBQztJQUNkLENBQUM7SUFFRCx1QkFBSyxHQUFMLFVBQU0sRUFBUyxFQUFFLEVBQUs7UUFDcEIsRUFBRSxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUM7UUFDWCxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxHQUFHLEVBQUUsQ0FBQztRQUNuQixJQUFJLENBQUMsU0FBUyxDQUFDLEVBQUUsRUFBRSxFQUFFLEVBQUUsQ0FBQyxRQUFRLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQztRQUN6QyxJQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1FBQzlDLE1BQU0sQ0FBQyxJQUFJLENBQUM7SUFDZCxDQUFDO0lBRUgsY0FBQztBQUFELENBbkpBLEFBbUpDLElBQUE7QUFFRCwrRUFBK0U7QUFDL0UsZ0JBQWdCO0FBQ2hCLCtFQUErRTtBQUUvRSxHQUFHLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRTtJQUNwQiwrRUFBK0U7SUFDL0UsZ0JBQWdCO0lBQ2hCLCtFQUErRTtJQUMvRSxJQUFJLEtBQUssR0FBRyxJQUFJLE9BQU8sQ0FBQyxTQUFHLENBQUMsQ0FBQztJQUM3QixLQUFLLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxjQUFjLEVBQUUsQ0FBQyxFQUFDLEVBQUUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBQyxFQUFFLEVBQUMsRUFBRSxFQUFFLFNBQVMsRUFBRSxJQUFJLEVBQUUsU0FBUyxFQUFDLEVBQUUsRUFBQyxFQUFFLEVBQUUsVUFBVSxFQUFFLElBQUksRUFBRSxVQUFVLEVBQUMsQ0FBQyxDQUFDLENBQUM7SUFDNUksS0FBSyxDQUFDLFFBQVEsQ0FBQyxlQUFlLEVBQUUsQ0FBQyxRQUFRLEVBQUUsU0FBUyxDQUFDLENBQUMsQ0FBQztJQUN2RCxLQUFLLENBQUMsUUFBUSxDQUFDLGFBQWEsRUFBRSxDQUFDLFFBQVEsRUFBRSxXQUFXLEVBQUUsT0FBTyxFQUFFLFFBQVEsQ0FBQyxDQUFDLENBQUM7SUFDMUUsS0FBSyxDQUFDLFFBQVEsQ0FBQyxjQUFjLEVBQUUsQ0FBQyxNQUFNLEVBQUUsU0FBUyxDQUFDLENBQUMsQ0FBQztJQUNwRCxLQUFLLENBQUMsUUFBUSxDQUFDLGFBQWEsRUFBRSxDQUFDLFFBQVEsRUFBRSxNQUFNLENBQUMsQ0FBQyxDQUFDO0lBQ2xELEtBQUssQ0FBQyxRQUFRLENBQUMsZUFBZSxFQUFFLENBQUMsUUFBUSxFQUFFLFNBQVMsRUFBRSxRQUFRLENBQUMsQ0FBQyxDQUFDO0lBQ2pFLEtBQUs7U0FDRixTQUFTLENBQUMsUUFBUSxFQUFFLFFBQVEsRUFBRSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1NBQ3pDLFNBQVMsQ0FBQyxZQUFZLEVBQUUsWUFBWSxFQUFFLENBQUMsUUFBUSxDQUFDLENBQUM7U0FDakQsU0FBUyxDQUFDLFFBQVEsRUFBRSxRQUFRLEVBQUUsQ0FBQyxRQUFRLEVBQUUsWUFBWSxDQUFDLENBQUM7U0FDdkQsU0FBUyxDQUFDLE9BQU8sRUFBRSxPQUFPLEVBQUUsQ0FBQyxRQUFRLEVBQUUsWUFBWSxDQUFDLENBQUM7U0FDckQsU0FBUyxDQUFDLE9BQU8sRUFBRSxPQUFPLEVBQUUsQ0FBQyxRQUFRLEVBQUUsWUFBWSxDQUFDLENBQUM7U0FDckQsU0FBUyxDQUFDLE9BQU8sRUFBRSxPQUFPLEVBQUUsQ0FBQyxRQUFRLEVBQUUsWUFBWSxDQUFDLENBQUM7U0FDckQsU0FBUyxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsQ0FBQyxRQUFRLEVBQUUsWUFBWSxDQUFDLENBQUM7U0FDL0MsU0FBUyxDQUFDLE1BQU0sRUFBRSxNQUFNLEVBQUUsQ0FBQyxRQUFRLENBQUMsRUFBRSxTQUFTLEVBQUUsT0FBUyx3Q0FFMUQsd0RBRmlELGFBQUssQ0FBQyxDQUFDLENBQUMsS0FFekQsQ0FBQyxDQUFDO0lBRUwsS0FBSyxDQUFDLFFBQVEsQ0FBQyxhQUFhLEVBQUUsQ0FBQyxRQUFRLEVBQUUsV0FBVyxFQUFFLE9BQU8sQ0FBQyxFQUFFLElBQUksQ0FBQztTQUNsRSxjQUFjLENBQUMsYUFBYSxFQUFFLGVBQWUsRUFBRSxFQUFDLE1BQU0sRUFBRSxRQUFRLEVBQUUsU0FBUyxFQUFFLFdBQVcsRUFBRSxLQUFLLEVBQUUsT0FBTyxFQUFDLENBQUM7U0FDMUcsY0FBYyxDQUFDLGFBQWEsRUFBRSxhQUFhLEVBQUUsRUFBQyxNQUFNLEVBQUUsUUFBUSxFQUFFLFNBQVMsRUFBRSxXQUFXLEVBQUUsS0FBSyxFQUFFLE9BQU8sRUFBQyxDQUFDO1NBR3hHLGNBQWMsQ0FBQyxhQUFhLEVBQUUsWUFBWSxDQUFDLENBQUM7SUFFL0MsS0FBSyxDQUFDLFFBQVEsQ0FBQyxjQUFjLEVBQUUsQ0FBQyxRQUFRLEVBQUUsTUFBTSxFQUFFLE1BQU0sQ0FBQyxDQUFDO1NBQ3ZELGNBQWMsQ0FBQyxjQUFjLEVBQUUsa0JBQWtCLENBQUM7U0FDbEQsY0FBYyxDQUFDLGNBQWMsRUFBRSxpQkFBaUIsRUFBRSxFQUFDLE1BQU0sRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFLFlBQVksRUFBRSxJQUFJLEVBQUUsQ0FBQyxNQUFNLENBQUMsRUFBQyxDQUFDLENBQUM7SUFFN0csS0FBSyxDQUFDLFFBQVEsQ0FBQyxxQkFBcUIsRUFBRSxDQUFDLFFBQVEsRUFBRSxNQUFNLENBQUMsQ0FBQztTQUN0RCxjQUFjLENBQUMscUJBQXFCLEVBQUUsY0FBYyxDQUFDO1NBQ3JELGNBQWMsQ0FBQyxxQkFBcUIsRUFBRSxjQUFjLEVBQUUsRUFBQyxNQUFNLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUMsQ0FBQyxDQUFDO0lBRTNGLEtBQUssQ0FBQyxRQUFRLENBQUMscUJBQXFCLEVBQUUsQ0FBQyxRQUFRLEVBQUUsWUFBWSxDQUFDLENBQUM7U0FDNUQsY0FBYyxDQUFDLHFCQUFxQixFQUFFLGlCQUFpQixDQUFDLENBQUM7SUFFNUQsS0FBSyxDQUFDLFlBQVksQ0FBQyxpQkFBUSxDQUFDLHlMQUszQixDQUFDLENBQUMsQ0FBQztJQUVKLEtBQUssQ0FBQyxZQUFZLENBQUMsaUJBQVEsQ0FBQyx3TUFLM0IsQ0FBQyxDQUFDLENBQUM7SUFFSixLQUFLLENBQUMsWUFBWSxDQUFDLGlCQUFRLENBQUMsd09BSzNCLENBQUMsQ0FBQyxDQUFDO0lBRUosS0FBSyxDQUFDLFlBQVksQ0FBQyxpQkFBUSxDQUFDLCtMQUkzQixDQUFDLENBQUMsQ0FBQztJQUVKLHNHQUFzRztJQUN0RyxtRkFBbUY7SUFDbkYsS0FBSyxDQUFDLFlBQVksQ0FBQyxpQkFBUSxDQUFDLHFRQUszQixDQUFDLENBQUMsQ0FBQztJQUVKLEtBQUssQ0FBQyxZQUFZLENBQUMsaUJBQVEsQ0FBQywwT0FLM0IsQ0FBQyxDQUFDLENBQUM7SUFFSixLQUFLLENBQUMsWUFBWSxDQUFDLGlCQUFRLENBQUMsK1NBTzNCLENBQUMsQ0FBQyxDQUFDO0lBRUosS0FBSyxDQUFDLFNBQVMsQ0FBQyxRQUFRLEVBQUUsUUFBUSxFQUFFLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQztJQUNoRCxLQUFLLENBQUMsU0FBUyxDQUFDLFlBQVksRUFBRSxZQUFZLEVBQUUsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDO0lBQ3hELEtBQUssQ0FBQyxZQUFZLENBQUMsaUJBQVEsQ0FBQyxPQUFTLHFLQUdrQyxFQUFtQixVQUN6RixpTUFKMkIsYUFBSyxDQUFDLENBQUMsQ0FBQyxLQUdtQyxpQkFBUyxDQUFDLFFBQVEsQ0FBQyxFQUN6RixDQUFDLENBQUMsQ0FBQztJQUNKLEtBQUssQ0FBQyxZQUFZLENBQUMsaUJBQVEsQ0FBQyxPQUFTLGlMQUdnQyxFQUF1QixVQUMzRiw2TUFKMkIsYUFBSyxDQUFDLENBQUMsQ0FBQyxLQUdpQyxpQkFBUyxDQUFDLFlBQVksQ0FBQyxFQUMzRixDQUFDLENBQUMsQ0FBQztJQUNOOzs7Ozs7Ozs7VUFTTTtJQUVKLEtBQUssQ0FBQyxRQUFRLENBQUMsU0FBUyxFQUFFLENBQUMsTUFBTSxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsVUFBVSxFQUFFLFFBQVEsQ0FBQyxDQUFDLENBQUM7SUFDekUsRUFBRSxDQUFBLENBQUMsU0FBRyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxNQUFNLEtBQUssQ0FBQyxDQUFDO1FBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxTQUFTLEVBQUUsRUFBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxDQUFDLEVBQUUsR0FBRyxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsRUFBRSxFQUFFLE1BQU0sRUFBRSxFQUFFLEVBQUMsQ0FBQyxDQUFDO0lBQzlILEtBQUssQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUM7SUFFbEIsK0VBQStFO0lBQy9FLEtBQUs7SUFDTCwrRUFBK0U7SUFDL0UsS0FBSyxHQUFHLElBQUksT0FBTyxDQUFDLFNBQUcsQ0FBQyxDQUFDO0lBRXpCLDhDQUE4QztJQUM5QyxpQkFBaUIsS0FBSyxFQUFFLE1BQU07UUFDNUIsTUFBTSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsVUFBQyxLQUFLLElBQUssT0FBQSxDQUFHLEtBQUssVUFBSyxLQUFLLENBQUUsRUFBcEIsQ0FBb0IsQ0FBQyxDQUFDO0lBQ3JELENBQUM7SUFDRCxLQUFLLENBQUMsUUFBUSxDQUFDLGFBQWEsRUFBRSxPQUFPLENBQUMsYUFBYSxFQUFFLENBQUMsVUFBVSxFQUFFLFFBQVEsRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDcEYsS0FBSyxDQUFDLFFBQVEsQ0FBQyxxQkFBcUIsRUFBRSxPQUFPLENBQUMscUJBQXFCLEVBQUUsQ0FBQyxVQUFVLEVBQUUsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQzdGLEtBQUssQ0FBQyxRQUFRLENBQUMsVUFBVSxFQUFFLE9BQU8sQ0FBQyxVQUFVLEVBQUUsQ0FBQyxPQUFPLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDdkYsS0FBSyxDQUFDLFFBQVEsQ0FBQyxnQkFBZ0IsRUFBRSxPQUFPLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQyxPQUFPLEVBQUUsS0FBSyxFQUFFLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUN2RixLQUFLLENBQUMsUUFBUSxDQUFDLHdCQUF3QixFQUFFLE9BQU8sQ0FBQyx3QkFBd0IsRUFBRSxDQUFDLE9BQU8sRUFBRSxLQUFLLEVBQUUsUUFBUSxFQUFFLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNqSCxLQUFLLENBQUMsUUFBUSxDQUFDLGNBQWMsRUFBRSxPQUFPLENBQUMsY0FBYyxFQUFFLENBQUMsVUFBVSxFQUFFLFVBQVUsRUFBRSxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDM0YsS0FBSyxDQUFDLFFBQVEsQ0FBQyxzQkFBc0IsRUFBRSxPQUFPLENBQUMsc0JBQXNCLEVBQUUsQ0FBQyxVQUFVLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDckgsS0FBSyxDQUFDLFFBQVEsQ0FBQyxVQUFVLEVBQUUsT0FBTyxDQUFDLFVBQVUsRUFBRSxDQUFDLFVBQVUsRUFBRSxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDdkUsS0FBSyxDQUFDLFFBQVEsQ0FBQyxnQkFBZ0IsRUFBRSxPQUFPLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQyxVQUFVLEVBQUUsT0FBTyxFQUFFLEtBQUssRUFBRSxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDbkcsS0FBSyxDQUFDLFFBQVEsQ0FBQyx3QkFBd0IsRUFBRSxPQUFPLENBQUMsd0JBQXdCLEVBQUUsQ0FBQyxVQUFVLEVBQUUsT0FBTyxFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUUsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBRTdILEtBQUssQ0FBQyxRQUFRLENBQUMsV0FBVyxFQUFFLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQztJQUUxQyxLQUFLLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDO0lBRWxCLCtFQUErRTtJQUMvRSxVQUFVO0lBQ1YsK0VBQStFO0lBQy9FLEtBQUssR0FBRyxJQUFJLE9BQU8sQ0FBQyxTQUFHLENBQUMsQ0FBQztJQUN6QixJQUFJLFFBQVEsR0FBRztRQUNiLFdBQVcsRUFBRSxFQUFFO1FBQ2YsR0FBRyxFQUFFLEVBQUU7UUFDUCxNQUFNLEVBQUUsRUFBRTtRQUNWLFNBQVMsRUFBRSxFQUFFO1FBQ2IsR0FBRyxFQUFFLENBQUMsS0FBSyxDQUFDO1FBQ1osR0FBRyxFQUFFLENBQUMsS0FBSyxDQUFDO1FBQ1osSUFBSSxFQUFFLENBQUMsS0FBSyxDQUFDO1FBQ2IsS0FBSyxFQUFFLENBQUMsS0FBSyxFQUFFLFFBQVEsQ0FBQztRQUN4QixLQUFLLEVBQUUsQ0FBQyxLQUFLLEVBQUUsUUFBUSxDQUFDO1FBQ3hCLEtBQUssRUFBRSxDQUFDLEtBQUssRUFBRSxRQUFRLENBQUM7UUFDeEIsUUFBUSxFQUFFLENBQUMsUUFBUSxDQUFDO1FBQ3BCLE9BQU8sRUFBRSxDQUFDLFFBQVEsQ0FBQztRQUNuQixPQUFPLEVBQUUsQ0FBQyxRQUFRLEVBQUUsV0FBVyxDQUFDO1FBRWhDLE9BQU8sRUFBRSxFQUFFO1FBQ1gsTUFBTSxFQUFFLENBQUMsU0FBUyxDQUFDO1FBRW5CLFVBQVUsRUFBRSxFQUFFO1FBQ2QsV0FBVyxFQUFFLENBQUMsWUFBWSxDQUFDO1FBQzNCLFVBQVUsRUFBRSxDQUFDLFlBQVksQ0FBQztRQUMxQixLQUFLLEVBQUUsQ0FBQyxZQUFZLENBQUM7UUFFckIsUUFBUSxFQUFFLEVBQUU7UUFDWixJQUFJLEVBQUUsQ0FBQyxVQUFVLENBQUM7UUFDbEIsS0FBSyxFQUFFLENBQUMsVUFBVSxDQUFDO1FBQ25CLEtBQUssRUFBRSxDQUFDLFVBQVUsQ0FBQztRQUNuQixHQUFHLEVBQUUsQ0FBQyxVQUFVLENBQUM7UUFDakIsSUFBSSxFQUFFLENBQUMsVUFBVSxDQUFDO0tBQ25CLENBQUM7SUFDRixJQUFJLFNBQVMsR0FBRztRQUNkLEdBQUcsRUFBRSxFQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUM7UUFDaEIsR0FBRyxFQUFFLEVBQUMsTUFBTSxFQUFFLENBQUMsRUFBQztRQUNoQixJQUFJLEVBQUUsRUFBQyxNQUFNLEVBQUUsQ0FBQyxFQUFDO1FBQ2pCLEtBQUssRUFBRSxFQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUM7UUFDbEIsS0FBSyxFQUFFLEVBQUMsTUFBTSxFQUFFLENBQUMsRUFBQztRQUNsQixLQUFLLEVBQUUsRUFBQyxNQUFNLEVBQUUsQ0FBQyxFQUFDO1FBQ2xCLFdBQVcsRUFBRSxFQUFDLE9BQU8sRUFBRSxRQUFRLEVBQUM7UUFDaEMsVUFBVSxFQUFFLEVBQUMsT0FBTyxFQUFFLFFBQVEsRUFBQztRQUMvQixLQUFLLEVBQUUsRUFBQyxPQUFPLEVBQUUsUUFBUSxFQUFDO1FBRTFCLElBQUksRUFBRSxFQUFDLFVBQVUsRUFBRSxhQUFhLEVBQUUsTUFBTSxFQUFFLENBQUMsRUFBQztRQUM1QyxLQUFLLEVBQUUsRUFBQyxVQUFVLEVBQUUsYUFBYSxFQUFFLE1BQU0sRUFBRSxFQUFFLEVBQUM7UUFDOUMsS0FBSyxFQUFFLEVBQUMsVUFBVSxFQUFFLGFBQWEsRUFBRSxNQUFNLEVBQUUsRUFBRSxFQUFDO1FBQzlDLElBQUksRUFBRSxFQUFDLFVBQVUsRUFBRSxhQUFhLEVBQUUsTUFBTSxFQUFFLENBQUMsRUFBQztRQUM1QyxHQUFHLEVBQUUsRUFBQyxVQUFVLEVBQUUsWUFBWSxFQUFFLE1BQU0sRUFBRSxFQUFFLEVBQUM7S0FDNUMsQ0FBQztJQUNGLEdBQUcsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxNQUFNLElBQUksUUFBUSxDQUFDO1FBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxNQUFNLEVBQUUsTUFBTSxFQUFFLENBQUMsV0FBVyxDQUFDLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLFNBQVMsQ0FBQyxNQUFNLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQztJQUUzSCwrQ0FBK0M7SUFDL0Msd0RBQXdEO0lBQ3hELHVEQUF1RDtJQUN2RCxtREFBbUQ7SUFDbkQsbUVBQW1FO0lBQ25FLG9GQUFvRjtJQUNwRixxRkFBcUY7SUFDckYsb0ZBQW9GO0lBQ3BGLGtGQUFrRjtJQUVsRixxQkFBcUI7SUFDckIsTUFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLEtBQUssQ0FBQzs7QUFDdEIsQ0FBQyxDQUFDLENBQUM7QUFHSCxNQUFNLENBQUMsV0FBVyxDQUFDLEdBQUcsT0FBTyxDQUFDOzs7QUNsWjlCLHNCQUEwQyxTQUFTLENBQUMsQ0FBQTtBQUdwRCxhQUFhLElBQWE7SUFDeEIsSUFBSSxLQUFLLEdBQUcsQ0FBQyxDQUFDO0lBQ2QsR0FBRyxDQUFBLENBQVksVUFBSSxFQUFmLGdCQUFPLEVBQVAsSUFBZSxDQUFDO1FBQWhCLElBQUksR0FBRyxHQUFJLElBQUksSUFBUjtRQUFVLEtBQUssSUFBSSxHQUFHLENBQUM7S0FBQTtJQUNsQyxNQUFNLENBQUMsS0FBSyxDQUFDO0FBQ2YsQ0FBQztBQUVELGdCQUFnQixDQUFVLEVBQUUsQ0FBVTtJQUNwQyxFQUFFLENBQUEsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsTUFBTSxLQUFLLENBQUMsQ0FBQyxNQUFNLENBQUM7UUFBQyxNQUFNLElBQUksS0FBSyxDQUFDLDJCQUEyQixDQUFDLENBQUM7SUFDbkYsSUFBSSxNQUFNLEdBQUcsRUFBRSxDQUFDO0lBQ2hCLEdBQUcsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxFQUFFLEdBQUcsR0FBRyxDQUFDLENBQUMsTUFBTSxFQUFFLENBQUMsR0FBRyxHQUFHLEVBQUUsQ0FBQyxFQUFFO1FBQUUsTUFBTSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDckUsTUFBTSxDQUFDLE1BQU0sQ0FBQztBQUNoQixDQUFDO0FBTUQsSUFBSSxRQUFRLEdBQW1CO0lBQzdCLEVBQUMsSUFBSSxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsS0FBSyxFQUFDO0lBQ25CLEVBQUMsSUFBSSxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsVUFBVSxFQUFDO0lBQ3hCLEVBQUMsSUFBSSxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsUUFBUSxFQUFFLE9BQU8sRUFBRSxDQUFDLEVBQUM7Q0FDbkMsQ0FBQztBQUNGLGlCQUF3QixJQUFnQjtJQUN0QyxJQUFJLEtBQTRFLElBQUksT0FBL0UsSUFBSSxtQkFBRyxDQUFDLFlBQW1FLElBQUksVUFBckUsT0FBTyxtQkFBRyxDQUFDLFlBQXNELElBQUksVUFBeEQsT0FBTyxtQkFBRyxRQUFRLFlBQWtDLElBQUksU0FBcEMsTUFBTSxtQkFBRyxTQUFTLE9BQUUsUUFBUSxHQUFJLElBQUksU0FBQSxDQUFDO0lBQ3JGLElBQUksSUFBSSxHQUFHLGFBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUN2QixPQUFPLENBQUMsSUFBSSxDQUFDLG1CQUFXLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztJQUVsQyxxRkFBcUY7SUFDckYsSUFBSSxFQUFFLEdBQUcsQ0FBQyxDQUFDO0lBQ1gsSUFBSSxjQUFjLEdBQUcsRUFBRSxDQUFDO0lBQ3hCLElBQUksZUFBZSxHQUFHLENBQUMsQ0FBQztJQUN4QixJQUFJLEtBQUssR0FBRyxFQUFFLENBQUM7SUFDZixHQUFHLENBQUEsQ0FBZSxVQUFPLEVBQXJCLG1CQUFVLEVBQVYsSUFBcUIsQ0FBQztRQUF0QixJQUFJLE1BQU0sR0FBSSxPQUFPLElBQVg7UUFDWixNQUFNLENBQUMsSUFBSSxHQUFHLE1BQU0sQ0FBQyxJQUFJLElBQUksQ0FBQyxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUM7UUFDN0MsZUFBZSxJQUFJLE1BQU0sQ0FBQyxJQUFJLENBQUM7S0FDaEM7SUFDRCxHQUFHLENBQUEsQ0FBZSxVQUFPLEVBQXJCLG1CQUFVLEVBQVYsSUFBcUIsQ0FBQztRQUF0QixJQUFJLE1BQU0sR0FBSSxPQUFPLElBQVg7UUFDWixLQUFLLENBQUMsRUFBRSxDQUFDLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQztRQUN4QixjQUFjLENBQUMsRUFBRSxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxJQUFJLEdBQUcsZUFBZSxHQUFHLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQztLQUNwRjtJQUVELDJFQUEyRTtJQUMzRSxJQUFJLEtBQUssQ0FBQztJQUNWLElBQUksS0FBSyxHQUFHLENBQUMsQ0FBQztJQUNkLE9BQU0sQ0FBQyxLQUFLLEdBQUcsR0FBRyxDQUFDLGNBQWMsQ0FBQyxDQUFDLEtBQUssUUFBUSxDQUFDLE1BQU0sRUFBRSxDQUFDO1FBQ3hELEVBQUUsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxjQUFjLENBQUMsR0FBRyxRQUFRLENBQUMsTUFBTSxDQUFDO1lBQUMsY0FBYyxDQUFDLGNBQWMsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3pGLElBQUksQ0FBQyxFQUFFLENBQUEsQ0FBQyxHQUFHLENBQUMsY0FBYyxDQUFDLEdBQUcsUUFBUSxDQUFDLE1BQU0sQ0FBQztZQUFDLGNBQWMsQ0FBQyxjQUFjLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUNoRyxDQUFDO0lBRUQsaUVBQWlFO0lBQ2pFLEtBQUssR0FBRyxDQUFDLEVBQUUsRUFBRSxHQUFHLENBQUMsQ0FBQztJQUNsQixJQUFJLE9BQU8sR0FBRyxPQUFPLENBQUMsT0FBTyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUM7SUFDL0MsT0FBTSxJQUFJLEVBQUUsQ0FBQztRQUNYLElBQUksWUFBVSxHQUFHLEdBQUcsQ0FBQyxNQUFNLENBQUMsY0FBYyxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUM7UUFDcEQsSUFBSSxVQUFRLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxZQUFVLEdBQUcsT0FBTyxDQUFDLENBQUM7UUFDL0MsSUFBSSxLQUFLLEdBQUcsT0FBTyxHQUFHLFVBQVEsR0FBRyxZQUFVLENBQUM7UUFDNUMsRUFBRSxDQUFBLENBQUMsS0FBSyxJQUFJLENBQUMsSUFBSSxLQUFLLEVBQUUsR0FBRyxJQUFJLENBQUM7WUFBQyxLQUFLLENBQUM7UUFDdkMsb0dBQW9HO1FBQ3BHLEVBQUUsQ0FBQSxDQUFDLEVBQUUsS0FBSyxPQUFPLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQztZQUFDLEVBQUUsR0FBRyxDQUFDLENBQUM7UUFDckMsRUFBRSxDQUFBLENBQUMsS0FBSyxJQUFJLE9BQU8sQ0FBQyxFQUFFLENBQUMsQ0FBQyxJQUFJLEdBQUcsT0FBTyxDQUFDLENBQUMsQ0FBQztZQUN2QyxjQUFjLENBQUMsT0FBTyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDO1lBQ3JDLGNBQWMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDO1FBQ3ZCLENBQUM7UUFBQyxJQUFJLENBQUMsRUFBRSxDQUFBLENBQUMsRUFBRSxLQUFLLE9BQU8sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNwQyw0REFBNEQ7WUFDNUQsS0FBSyxDQUFDO1FBQ1IsQ0FBQztRQUNELEVBQUUsRUFBRSxDQUFDO0lBQ1AsQ0FBQztJQUVELHVFQUF1RTtJQUN2RSxRQUFRLENBQUMsSUFBSSxDQUFDLG1CQUFXLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztJQUNuQyxJQUFJLEtBQUssR0FBRyxFQUFFLEVBQUUsUUFBUSxHQUFHLENBQUMsRUFBRSxNQUFNLEdBQUcsQ0FBQyxDQUFDO0lBQ3pDLEdBQUcsQ0FBQSxDQUFjLFVBQWMsRUFBM0IsMEJBQVMsRUFBVCxJQUEyQixDQUFDO1FBQTVCLElBQUksS0FBSyxHQUFJLGNBQWMsSUFBbEI7UUFDWCxJQUFJLE1BQU0sR0FBRyxPQUFPLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBQztRQUNqQyxFQUFFLENBQUEsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO1lBQ25CLEdBQUcsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxJQUFFLEdBQUcsTUFBTSxFQUFHLElBQUUsR0FBRyxNQUFNLEdBQUcsS0FBSyxFQUFFLElBQUUsRUFBRSxFQUFFLENBQUM7Z0JBQ2hELElBQUksSUFBSSxHQUFHLFFBQVEsQ0FBQyxJQUFFLENBQUMsQ0FBQztnQkFDeEIsSUFBSSxDQUFDLENBQUMsR0FBRyxxQkFBa0IsSUFBSSxDQUFDLENBQUMsSUFBSSxFQUFFLFdBQUksTUFBTSxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUUsQ0FBQztnQkFDNUQsRUFBRSxDQUFBLENBQUMsTUFBTSxDQUFDO29CQUFDLElBQUksQ0FBQyxDQUFDLElBQUksR0FBRyxHQUFHLE1BQU0sQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDO2dCQUMxRCxFQUFFLENBQUEsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDO29CQUFDLElBQUksR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDO2dCQUM3QyxLQUFLLENBQUMsSUFBSSxDQUFDLEVBQUMsQ0FBQyxFQUFFLFlBQVMsTUFBTSxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUUsRUFBRSxRQUFBLE1BQU0sRUFBRSxJQUFJLEVBQUUsTUFBTSxDQUFDLElBQUksRUFBRSxRQUFRLEVBQUUsQ0FBQyxJQUFJLENBQUMsRUFBQyxDQUFDLENBQUM7WUFDMUYsQ0FBQztRQUNILENBQUM7UUFBQyxJQUFJLENBQUMsQ0FBQztZQUNOLHFGQUFxRjtZQUNyRixJQUFJLEtBQUssR0FBRyxDQUFDLENBQUM7WUFBQSxDQUFDO1lBQ2YsR0FBRyxDQUFBLENBQUMsR0FBRyxDQUFDLElBQUUsR0FBRyxNQUFNLEVBQUcsSUFBRSxHQUFHLE1BQU0sR0FBRyxLQUFLLEVBQUUsSUFBRSxJQUFJLE1BQU0sQ0FBQyxPQUFPLEVBQUUsQ0FBQztnQkFDaEUsSUFBSSxLQUFLLEdBQUcsRUFBQyxDQUFDLEVBQUUsWUFBUyxNQUFNLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBRSxFQUFFLFFBQUEsTUFBTSxFQUFFLElBQUksRUFBRSxNQUFNLENBQUMsSUFBSSxHQUFHLE1BQU0sQ0FBQyxPQUFPLEVBQUUsUUFBUSxFQUFFLEVBQUUsRUFBQyxDQUFDO2dCQUNyRyxHQUFHLENBQUEsQ0FBQyxHQUFHLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRSxNQUFNLEdBQUcsTUFBTSxDQUFDLE9BQU8sSUFBSSxLQUFLLEdBQUcsS0FBSyxFQUFFLE1BQU0sRUFBRSxFQUFFLENBQUM7b0JBQ3ZFLElBQUksSUFBSSxHQUFHLFFBQVEsQ0FBQyxJQUFFLEdBQUcsTUFBTSxDQUFDLENBQUM7b0JBQ2pDLElBQUksQ0FBQyxDQUFDLEdBQUcscUJBQWtCLElBQUksQ0FBQyxDQUFDLElBQUksRUFBRSxXQUFJLE1BQU0sQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFFLENBQUM7b0JBQzVELEVBQUUsQ0FBQSxDQUFDLE1BQU0sQ0FBQzt3QkFBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLEdBQUcsR0FBRyxNQUFNLENBQUMsQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDO29CQUNyRSxFQUFFLENBQUEsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDO3dCQUFDLElBQUksR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDO29CQUM3QyxLQUFLLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztvQkFDMUIsS0FBSyxFQUFFLENBQUM7Z0JBQ1YsQ0FBQztnQkFDRCxLQUFLLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQ3BCLENBQUM7UUFDSCxDQUFDO1FBQ0QsTUFBTSxJQUFJLEtBQUssQ0FBQztLQUNqQjtJQUVELGlFQUFpRTtJQUNqRSxJQUFJLFVBQVUsR0FBRyxHQUFHLENBQUMsTUFBTSxDQUFDLGNBQWMsRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUFDO0lBQ3BELElBQUksUUFBUSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxHQUFHLE9BQU8sQ0FBQyxDQUFDO0lBQy9DLElBQUksSUFBSSxHQUFHLEVBQUUsQ0FBQztJQUNkLEdBQUcsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxJQUFFLEdBQUcsQ0FBQyxFQUFFLElBQUUsR0FBRyxRQUFRLEVBQUUsSUFBRSxFQUFFO1FBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFDLENBQUMsRUFBRSxhQUFhLEVBQUUsUUFBUSxFQUFFLEVBQUUsRUFBRSxJQUFJLEVBQUUsQ0FBQyxFQUFDLENBQUMsQ0FBQztJQUMxRixLQUFLLEdBQUcsQ0FBQyxDQUFDO0lBQ1YsSUFBSSxLQUFLLEdBQUcsQ0FBQyxDQUFDO0lBQ2QsR0FBRyxDQUFBLENBQWEsVUFBSyxFQUFqQixpQkFBUSxFQUFSLElBQWlCLENBQUM7UUFBbEIsSUFBSSxJQUFJLEdBQUksS0FBSyxJQUFUO1FBQ1YsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sSUFBSSxDQUFDLENBQUMsQ0FBQztRQUN6RCxJQUFJLE1BQU0sR0FBRyxLQUFLLENBQUM7UUFDbkIsSUFBSSxRQUFRLEdBQUcsQ0FBQyxDQUFDO1FBQ2pCLE9BQU0sQ0FBQyxNQUFNLEVBQUUsQ0FBQztZQUNkLElBQUksR0FBRyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUN0QixFQUFFLENBQUEsQ0FBQyxHQUFHLENBQUMsSUFBSSxHQUFHLElBQUksSUFBSSxPQUFPLENBQUMsQ0FBQyxDQUFDO2dCQUM5QixHQUFHLENBQUMsSUFBSSxJQUFJLElBQUksQ0FBQztnQkFDakIsR0FBRyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQ3hCLE1BQU0sR0FBRyxJQUFJLENBQUM7WUFDaEIsQ0FBQztZQUVELEtBQUssRUFBRSxDQUFDO1lBQ1IsRUFBRSxDQUFBLENBQUMsS0FBSyxJQUFJLFFBQVEsQ0FBQztnQkFBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDO1lBQ2hDLFFBQVEsRUFBRSxDQUFDO1lBQ1gsRUFBRSxDQUFBLENBQUMsUUFBUSxLQUFLLFFBQVEsQ0FBQztnQkFBQyxLQUFLLENBQUM7UUFDbEMsQ0FBQztRQUNELEVBQUUsQ0FBQSxDQUFDLENBQUMsTUFBTSxDQUFDO1lBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxzQkFBc0IsRUFBRSxJQUFJLENBQUMsQ0FBQztLQUN6RDtJQUNELEVBQUUsR0FBRyxDQUFDLENBQUM7SUFDUCx5RUFBeUU7SUFDekUsR0FBRyxDQUFBLENBQVksVUFBSSxFQUFmLGdCQUFPLEVBQVAsSUFBZSxDQUFDO1FBQWhCLElBQUksR0FBRyxHQUFJLElBQUksSUFBUjtRQUFVLGVBQU8sQ0FBQyxHQUFHLENBQUMsUUFBUSxFQUFFLElBQUksQ0FBQyxDQUFDO0tBQUE7SUFDakQsZUFBTyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztJQUVwQixJQUFJLENBQUMsQ0FBQyxHQUFHLGNBQVcsSUFBSSxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUUsQ0FBQztJQUNuQyxJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQztJQUNyQixNQUFNLENBQUMsSUFBSSxDQUFDO0FBQ2QsQ0FBQztBQWpIZSxlQUFPLFVBaUh0QixDQUFBOzs7QUNyQkQ7SUFDRSxFQUFFLENBQUEsQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQztRQUN0QixNQUFNLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxHQUFHLEVBQUUsQ0FBQztJQUNsQyxDQUFDO0lBQ0QsTUFBTSxDQUFDLENBQUMsSUFBSSxJQUFJLEVBQUUsQ0FBQyxDQUFDLE9BQU8sRUFBRSxDQUFDO0FBQ2hDLENBQUM7QUFFRCx1QkFBdUIsQ0FBQyxFQUFFLENBQUM7SUFDekIsRUFBRSxDQUFBLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUM7SUFDeEIsRUFBRSxDQUFBLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7UUFBQyxNQUFNLENBQUMsS0FBSyxDQUFDO0lBQzFCLEdBQUcsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNmLEVBQUUsQ0FBQSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFBQyxNQUFNLENBQUMsS0FBSyxDQUFDO0lBQ2pDLENBQUM7SUFDRCxHQUFHLENBQUEsQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDZixFQUFFLENBQUEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQztJQUNqQyxDQUFDO0lBQ0QsTUFBTSxDQUFDLElBQUksQ0FBQztBQUNkLENBQUM7QUFFRCw2QkFBNkIsUUFBUTtJQUNuQyxHQUFHLENBQUEsQ0FBYSxVQUFRLEVBQXBCLG9CQUFRLEVBQVIsSUFBb0IsQ0FBQztRQUFyQixJQUFJLElBQUksR0FBSSxRQUFRLElBQVo7UUFDVixFQUFFLENBQUEsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDO1lBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLENBQUM7S0FDdkQ7QUFDSCxDQUFDO0FBRUQ7SUFtQkU7UUFDRSxJQUFJLENBQUMsT0FBTyxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDN0MsSUFBSSxDQUFDLE9BQU8sQ0FBQyxTQUFTLEdBQUcsUUFBUSxDQUFDO1FBQ2xDLElBQUksQ0FBQyxZQUFZLEdBQUcsRUFBRSxRQUFRLEVBQUUsSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFDO1FBQy9DLElBQUksQ0FBQyxRQUFRLEdBQUcsRUFBRSxDQUFDO1FBQ25CLElBQUksQ0FBQyxJQUFJLEdBQUcsRUFBRSxDQUFDO1FBQ2YsSUFBSSxDQUFDLFdBQVcsR0FBRyxFQUFFLENBQUM7UUFDdEIsSUFBSSxDQUFDLFFBQVEsR0FBRyxFQUFDLElBQUksRUFBRSxFQUFFLEVBQUUsT0FBTyxFQUFFLEVBQUUsRUFBQyxDQUFDO1FBQ3hDLElBQUksSUFBSSxHQUFHLElBQUksQ0FBQztRQUNoQixJQUFJLENBQUMsV0FBVyxHQUFHLHFCQUFxQixDQUFRO1lBQzlDLElBQUksRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDLGFBQWEsSUFBSSxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDOUMsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUN6QixFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztnQkFBQyxNQUFNLENBQUM7WUFDbEIsSUFBSSxPQUFPLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUMzQixFQUFFLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO2dCQUFDLE9BQU8sQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUM7WUFBQyxDQUFDO1FBQ3BDLENBQUMsQ0FBQztJQUNKLENBQUM7SUFoQ00sZ0JBQU8sR0FBZCxVQUFlLElBQVk7UUFDekIsRUFBRSxDQUFBLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDO1lBQUMsTUFBTSxJQUFJLEtBQUssQ0FBQyxpQ0FBaUMsR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDMUUsSUFBSSxRQUFRLEdBQUcsUUFBUSxDQUFDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUNsRCxFQUFFLENBQUEsQ0FBQyxDQUFDLFFBQVEsQ0FBQztZQUFDLFFBQVEsR0FBRyxRQUFRLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxHQUFHLElBQUksUUFBUSxFQUFFLENBQUM7UUFDN0UsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7UUFDeEIsTUFBTSxDQUFDLFFBQVEsQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQ3hDLENBQUM7SUEyQkQsd0JBQUssR0FBTDtRQUNFLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQztRQUMxQixJQUFJLENBQUMsSUFBSSxHQUFHLEVBQUUsQ0FBQztRQUNmLElBQUksQ0FBQyxXQUFXLEdBQUcsRUFBRSxDQUFDO0lBQ3hCLENBQUM7SUFFRCx5QkFBTSxHQUFOO1FBQ0UsSUFBSSxRQUFRLEdBQVcsRUFBRSxDQUFDLENBQUMsbUVBQW1FO1FBQzlGLElBQUksUUFBUSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUM7UUFDekIsSUFBSSxZQUFZLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQztRQUNqQyxJQUFJLElBQUksR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDO1FBQ3pCLElBQUksSUFBSSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUM7UUFDckIsSUFBSSxPQUFPLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQztRQUMzQixJQUFJLFFBQVEsR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQ3BDLElBQUksWUFBWSxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUM7UUFDckMsSUFBSSxTQUFTLEdBQU8sRUFBRSxDQUFDO1FBRXZCLCtFQUErRTtRQUMvRSxVQUFVO1FBQ1YsR0FBRyxDQUFBLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLEVBQUUsR0FBRyxHQUFHLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxHQUFHLEdBQUcsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO1lBQy9DLElBQUksRUFBRSxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNqQixJQUFJLEdBQUcsR0FBRyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUM7WUFDdkIsSUFBSSxHQUFRLENBQUM7WUFDYixFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztnQkFDWixHQUFHLEdBQUcsUUFBUSxDQUFDLGVBQWUsQ0FBQyw0QkFBNEIsRUFBRSxHQUFHLENBQUMsQ0FBQyxJQUFJLE1BQU0sQ0FBQyxDQUFDO1lBQ2hGLENBQUM7WUFBQyxJQUFJLENBQUMsQ0FBQztnQkFDTixHQUFHLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLEtBQUssQ0FBQyxDQUFDO1lBQy9DLENBQUM7WUFDRCxHQUFHLENBQUMsR0FBRyxHQUFHLEVBQUUsQ0FBQztZQUNiLFlBQVksQ0FBQyxFQUFFLENBQUMsR0FBRyxHQUFHLENBQUM7WUFDdkIsRUFBRSxDQUFBLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7Z0JBQ2IsRUFBRSxDQUFBLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO29CQUNuQixHQUFHLENBQUMsS0FBSyxDQUFDLE9BQU8sR0FBRyxNQUFNLENBQUM7b0JBQzNCLEdBQUcsQ0FBQyxLQUFLLENBQUMsT0FBTyxHQUFHLE1BQU0sQ0FBQztnQkFDN0IsQ0FBQztnQkFFRCxRQUFRLENBQUMsR0FBRyxFQUFFLEdBQUcsQ0FBQyxLQUFLLEVBQUUsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBRXRDLENBQUM7UUFDSCxDQUFDO1FBRUQsR0FBRyxDQUFBLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLEVBQUUsR0FBRyxHQUFHLFFBQVEsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxHQUFHLEdBQUcsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO1lBQ25ELElBQUksRUFBRSxHQUFHLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNyQixJQUFJLEdBQUcsR0FBRyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUM7WUFDdkIsSUFBSSxJQUFJLEdBQUcsWUFBWSxDQUFDLEVBQUUsQ0FBQyxJQUFJLFFBQVEsQ0FBQztZQUN4QyxJQUFJLElBQUksR0FBRyxPQUFPLENBQUMsRUFBRSxDQUFDLENBQUM7WUFDdkIsSUFBSSxHQUFHLENBQUM7WUFDUixFQUFFLENBQUEsQ0FBQyxJQUFJLEtBQUssVUFBVSxDQUFDLENBQUMsQ0FBQztnQkFDdkIsSUFBSSxFQUFFLEdBQUcsWUFBWSxDQUFDLEVBQUUsQ0FBQyxDQUFDO2dCQUMxQixFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsVUFBVSxDQUFDO29CQUFDLEVBQUUsQ0FBQyxVQUFVLENBQUMsV0FBVyxDQUFDLEVBQUUsQ0FBQyxDQUFDO2dCQUNqRCxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztvQkFDWixHQUFHLEdBQUcsUUFBUSxDQUFDLGVBQWUsQ0FBQyw0QkFBNEIsRUFBRSxHQUFHLENBQUMsQ0FBQyxJQUFJLE1BQU0sQ0FBQyxDQUFDO2dCQUNoRixDQUFDO2dCQUFDLElBQUksQ0FBQyxDQUFDO29CQUNOLEdBQUcsR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksS0FBSyxDQUFDLENBQUM7Z0JBQy9DLENBQUM7Z0JBQ0QsSUFBSSxHQUFHLFFBQVEsQ0FBQztnQkFDaEIsR0FBRyxDQUFDLEdBQUcsR0FBRyxFQUFFLENBQUM7Z0JBQ2IsWUFBWSxDQUFDLEVBQUUsQ0FBQyxHQUFHLEdBQUcsQ0FBQztZQUN6QixDQUFDO1lBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLElBQUksS0FBSyxTQUFTLENBQUMsQ0FBQyxDQUFDO2dCQUM5QixpRUFBaUU7Z0JBQ2pFLGdFQUFnRTtnQkFDaEUsbUVBQW1FO2dCQUNuRSxzRUFBc0U7Z0JBQ3RFLElBQUksRUFBRSxHQUFHLFlBQVksQ0FBQyxFQUFFLENBQUMsQ0FBQTtnQkFDekIsRUFBRSxDQUFBLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7b0JBQ2QsSUFBSSxDQUFDLEtBQUssQ0FBQyxRQUFRLEdBQUcsbUJBQW1CLENBQUM7b0JBQzFDLEVBQUUsQ0FBQSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQzt3QkFDdkIsRUFBRSxDQUFDLEtBQUssQ0FBQyxRQUFRLEdBQUcsVUFBVSxDQUFDO29CQUNqQyxDQUFDO29CQUNELFFBQVEsQ0FBQyxFQUFFLEVBQUUsSUFBSSxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7Z0JBQ3ZDLENBQUM7Z0JBQ0QsSUFBSSxDQUFDLEVBQUUsQ0FBQSxDQUFDLEVBQUUsQ0FBQyxVQUFVLENBQUM7b0JBQUMsRUFBRSxDQUFDLFVBQVUsQ0FBQyxXQUFXLENBQUMsRUFBRSxDQUFDLENBQUM7Z0JBQ3JELFlBQVksQ0FBQyxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUM7Z0JBQ3hCLFFBQVEsQ0FBQztZQUNYLENBQUM7WUFBQyxJQUFJLENBQUMsQ0FBQztnQkFDTixHQUFHLEdBQUcsWUFBWSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1lBQ3pCLENBQUM7WUFFRCxJQUFJLEtBQUssR0FBRyxHQUFHLENBQUMsS0FBSyxDQUFDO1lBQ3RCLEVBQUUsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEtBQUssSUFBSSxDQUFDLENBQUMsQ0FBQztnQkFBQyxHQUFHLENBQUMsU0FBUyxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUM7WUFDM0MsRUFBRSxDQUFBLENBQUMsR0FBRyxDQUFDLFNBQVMsS0FBSyxJQUFJLENBQUMsU0FBUyxDQUFDO2dCQUFDLEdBQUcsQ0FBQyxTQUFTLEdBQUcsR0FBRyxDQUFDLFNBQVMsS0FBSyxTQUFTLEdBQUcsSUFBSSxHQUFHLE1BQU0sQ0FBQztZQUNqRyxFQUFFLENBQUEsQ0FBQyxHQUFHLENBQUMsZUFBZSxLQUFLLElBQUksQ0FBQyxlQUFlLENBQUM7Z0JBQUMsR0FBRyxDQUFDLGVBQWUsR0FBRyxHQUFHLENBQUMsZUFBZSxLQUFLLFNBQVMsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxlQUFlLENBQUMsR0FBRyxTQUFTLENBQUM7WUFDM0osRUFBRSxDQUFBLENBQUMsR0FBRyxDQUFDLE9BQU8sS0FBSyxJQUFJLENBQUMsT0FBTyxDQUFDO2dCQUFDLEdBQUcsQ0FBQyxPQUFPLEdBQUcsR0FBRyxDQUFDLE9BQU8sQ0FBQztZQUMzRCxFQUFFLENBQUEsQ0FBQyxHQUFHLENBQUMsV0FBVyxLQUFLLElBQUksQ0FBQyxXQUFXLENBQUM7Z0JBQUMsR0FBRyxDQUFDLFlBQVksQ0FBQyxhQUFhLEVBQUUsR0FBRyxDQUFDLFdBQVcsQ0FBQyxDQUFDO1lBQzFGLEVBQUUsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxRQUFRLEtBQUssSUFBSSxDQUFDLFFBQVEsQ0FBQztnQkFBQyxHQUFHLENBQUMsUUFBUSxHQUFHLEdBQUcsQ0FBQyxRQUFRLENBQUM7WUFDL0QsRUFBRSxDQUFBLENBQUMsQ0FBQyxHQUFHLENBQUMsS0FBSyxLQUFLLElBQUksQ0FBQyxLQUFLLElBQUksR0FBRyxDQUFDLFVBQVUsQ0FBQyxJQUFJLEdBQUcsQ0FBQyxLQUFLLEtBQUssR0FBRyxDQUFDLEtBQUssQ0FBQztnQkFBQyxHQUFHLENBQUMsS0FBSyxHQUFHLEdBQUcsQ0FBQyxLQUFLLENBQUM7WUFDbEcsRUFBRSxDQUFBLENBQUMsR0FBRyxDQUFDLENBQUMsS0FBSyxPQUFPLElBQUksR0FBRyxDQUFDLElBQUksS0FBSyxJQUFJLENBQUMsSUFBSSxDQUFDO2dCQUFDLEdBQUcsQ0FBQyxJQUFJLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQztZQUNwRSxFQUFFLENBQUEsQ0FBQyxHQUFHLENBQUMsQ0FBQyxLQUFLLE9BQU8sSUFBSSxHQUFHLENBQUMsT0FBTyxLQUFLLElBQUksQ0FBQyxPQUFPLENBQUM7Z0JBQUMsR0FBRyxDQUFDLE9BQU8sR0FBRyxHQUFHLENBQUMsT0FBTyxDQUFDO1lBQ2hGLEVBQUUsQ0FBQSxDQUFDLENBQUMsR0FBRyxDQUFDLElBQUksS0FBSyxJQUFJLENBQUMsSUFBSSxJQUFJLEdBQUcsQ0FBQyxVQUFVLENBQUMsSUFBSSxHQUFHLENBQUMsV0FBVyxLQUFLLEdBQUcsQ0FBQyxJQUFJLENBQUM7Z0JBQUMsR0FBRyxDQUFDLFdBQVcsR0FBRyxHQUFHLENBQUMsSUFBSSxLQUFLLFNBQVMsR0FBRyxFQUFFLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQztZQUN4SSxFQUFFLENBQUEsQ0FBQyxHQUFHLENBQUMsUUFBUSxLQUFLLElBQUksQ0FBQyxRQUFRLENBQUM7Z0JBQUMsR0FBRyxDQUFDLFlBQVksQ0FBQyxVQUFVLEVBQUUsR0FBRyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQzlFLEVBQUUsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEtBQUssSUFBSSxDQUFDLElBQUksQ0FBQztnQkFBQyxHQUFHLENBQUMsWUFBWSxDQUFDLE1BQU0sRUFBRSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDOUQsRUFBRSxDQUFBLENBQUMsR0FBRyxDQUFDLEdBQUcsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDO2dCQUFDLEdBQUcsQ0FBQyxZQUFZLENBQUMsS0FBSyxFQUFFLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUMxRCxFQUFFLENBQUEsQ0FBQyxHQUFHLENBQUMsTUFBTSxLQUFLLElBQUksQ0FBQyxNQUFNLENBQUM7Z0JBQUMsR0FBRyxDQUFDLFlBQVksQ0FBQyxRQUFRLEVBQUUsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQ3RFLEVBQUUsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEtBQUssSUFBSSxDQUFDLElBQUksQ0FBQztnQkFBQyxHQUFHLENBQUMsWUFBWSxDQUFDLE1BQU0sRUFBRSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDOUQsRUFBRSxDQUFBLENBQUMsR0FBRyxDQUFDLFFBQVEsS0FBSyxJQUFJLENBQUMsUUFBUSxDQUFDO2dCQUFDLEdBQUcsQ0FBQyxZQUFZLENBQUMsVUFBVSxFQUFFLEdBQUcsQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUM5RSxFQUFFLENBQUEsQ0FBQyxHQUFHLENBQUMsZUFBZSxLQUFLLElBQUksQ0FBQyxlQUFlLENBQUM7Z0JBQUMsR0FBRyxDQUFDLFlBQVksQ0FBQyxpQkFBaUIsRUFBRSxHQUFHLENBQUMsZUFBZSxDQUFDLENBQUM7WUFFMUcseUJBQXlCO1lBQ3pCLElBQUksS0FBSyxHQUFHLEdBQUcsQ0FBQyxLQUFLLElBQUksU0FBUyxDQUFDO1lBQ25DLEVBQUUsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEtBQUssSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7Z0JBQzFCLEVBQUUsQ0FBQSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUM7b0JBQUMsU0FBUyxDQUFDLElBQUksR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFDO2dCQUN6QyxJQUFJO29CQUFDLEtBQUssQ0FBQyxJQUFJLEdBQUcsR0FBRyxDQUFDLElBQUksS0FBSyxTQUFTLEdBQUcsRUFBRSxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUM7WUFDM0QsQ0FBQztZQUNELEVBQUUsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEtBQUssSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7Z0JBQ3hCLEVBQUUsQ0FBQSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUM7b0JBQUMsU0FBUyxDQUFDLElBQUksR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFDO2dCQUN6QyxJQUFJO29CQUFDLEtBQUssQ0FBQyxJQUFJLEdBQUcsR0FBRyxDQUFDLElBQUksS0FBSyxTQUFTLEdBQUcsRUFBRSxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUM7WUFDN0QsQ0FBQztZQUNELEVBQUUsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxHQUFHLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7Z0JBQ3hCLEVBQUUsQ0FBQSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUM7b0JBQUMsU0FBUyxDQUFDLEdBQUcsR0FBRyxHQUFHLENBQUMsR0FBRyxDQUFDO2dCQUN0QyxJQUFJO29CQUFDLEtBQUssQ0FBQyxHQUFHLEdBQUcsR0FBRyxDQUFDLEdBQUcsS0FBSyxTQUFTLEdBQUcsRUFBRSxHQUFHLEdBQUcsQ0FBQyxHQUFHLENBQUM7WUFDeEQsQ0FBQztZQUNELEVBQUUsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxNQUFNLEtBQUssSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7Z0JBQzlCLEVBQUUsQ0FBQSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUM7b0JBQUMsU0FBUyxDQUFDLE1BQU0sR0FBRyxHQUFHLENBQUMsTUFBTSxDQUFDO2dCQUMvQyxJQUFJO29CQUFDLEtBQUssQ0FBQyxNQUFNLEdBQUcsR0FBRyxDQUFDLE1BQU0sS0FBSyxTQUFTLEdBQUcsTUFBTSxHQUFHLEdBQUcsQ0FBQyxNQUFNLENBQUM7WUFDckUsQ0FBQztZQUNELEVBQUUsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxLQUFLLEtBQUssSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7Z0JBQzVCLEVBQUUsQ0FBQSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUM7b0JBQUMsU0FBUyxDQUFDLEtBQUssR0FBRyxHQUFHLENBQUMsS0FBSyxDQUFDO2dCQUM1QyxJQUFJO29CQUFDLEtBQUssQ0FBQyxLQUFLLEdBQUcsR0FBRyxDQUFDLEtBQUssS0FBSyxTQUFTLEdBQUcsTUFBTSxHQUFHLEdBQUcsQ0FBQyxLQUFLLENBQUM7WUFDbEUsQ0FBQztZQUNELEVBQUUsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxNQUFNLEtBQUssSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7Z0JBQzlCLEVBQUUsQ0FBQSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUM7b0JBQUMsU0FBUyxDQUFDLE1BQU0sR0FBRyxHQUFHLENBQUMsTUFBTSxDQUFDO2dCQUMvQyxJQUFJO29CQUFDLEtBQUssQ0FBQyxNQUFNLEdBQUcsR0FBRyxDQUFDLE1BQU0sQ0FBQztZQUNqQyxDQUFDO1lBQ0QsRUFBRSxDQUFBLENBQUMsR0FBRyxDQUFDLGVBQWUsS0FBSyxJQUFJLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQztn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QUFDLGNBQWMsQ0FBQyxJQUFJLEVBQUUsUUFBUSxFQUFFLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQztnQkFDOUUsRUFBRSxDQUFBLENBQUMsR0FBRyxDQUFDLFdBQVcsS0FBSyxJQUFJLENBQUMsV0FBVyxDQUFDO29CQUFDLEdBQUcsQ0FBQyxjQUFjLENBQUMsSUFBSSxFQUFFLGNBQWMsRUFBRSxHQUFHLENBQUMsV0FBVyxDQUFDLENBQUM7Z0JBQ25HLEVBQUUsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEtBQUssSUFBSSxDQUFDLENBQUMsQ0FBQztvQkFBQyxHQUFHLENBQUMsY0FBYyxDQUFDLElBQUksRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUMxRCxFQUFFLENBQUEsQ0FBQyxHQUFHLENBQUMsQ0FBQyxLQUFLLElBQUksQ0FBQyxDQUFDLENBQUM7b0JBQUMsR0FBRyxDQUFDLGNBQWMsQ0FBQyxJQUFJLEVBQUUsT0FBTyxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDOUQsRUFBRSxDQUFBLENBQUMsR0FBRyxDQUFDLENBQUMsS0FBSyxJQUFJLENBQUMsQ0FBQyxDQUFDO29CQUFFLEdBQUcsQ0FBQyxjQUFjLENBQUMsSUFBSSxFQUFFLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQzNELEVBQUUsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEtBQUssSUFBSSxDQUFDLENBQUMsQ0FBQztvQkFBQyxHQUFHLENBQUMsY0FBYyxDQUFDLElBQUksRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUMxRCxFQUFFLENBQUEsQ0FBQyxHQUFHLENBQUMsRUFBRSxLQUFLLElBQUksQ0FBQyxFQUFFLENBQUM7b0JBQUUsR0FBRyxDQUFDLGNBQWMsQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQztnQkFDL0QsRUFBRSxDQUFBLENBQUMsR0FBRyxDQUFDLEVBQUUsS0FBSyxJ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Q0FBQyxRQUFRLEtBQUssU0FBUyxHQUFHLElBQUksQ0FBQyxXQUFXLEdBQUcsU0FBUyxDQUFDO1lBQzlHLEVBQUUsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxLQUFLLEtBQUssSUFBSSxDQUFDLEtBQUssQ0FBQztnQkFBQyxHQUFHLENBQUMsT0FBTyxHQUFHLEdBQUcsQ0FBQyxLQUFLLEtBQUssU0FBUyxHQUFHLElBQUksQ0FBQyxXQUFXLEdBQUcsU0FBUyxDQUFDO1lBQ2xHLEVBQUUsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxXQUFXLEtBQUssSUFBSSxDQUFDLFdBQVcsQ0FBQztnQkFBQyxHQUFHLENBQUMsYUFBYSxHQUFHLEdBQUcsQ0FBQyxXQUFXLEtBQUssU0FBUyxHQUFHLElBQUksQ0FBQyxXQUFXLEdBQUcsU0FBUyxDQUFDO1lBQzFILEVBQUUsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxTQUFTLEtBQUssSUFBSSxDQUFDLFNBQVMsQ0FBQztnQkFBQyxHQUFHLENBQUMsV0FBVyxHQUFHLEdBQUcsQ0FBQyxTQUFTLEtBQUssU0FBUyxHQUFHLElBQUksQ0FBQyxXQUFXLEdBQUcsU0FBUyxDQUFDO1lBQ2xILEVBQUUsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxTQUFTLEtBQUssSUFBSSxDQUFDLFNBQVMsQ0FBQztnQkFBQyxHQUFHLENBQUMsV0FBVyxHQUFHLEdBQUcsQ0FBQyxTQUFTLEtBQUssU0FBUyxHQUFHLElBQUksQ0FBQyxXQUFXLEdBQUcsU0FBUyxDQUFDO1lBQ2xILEVBQUUsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxPQUFPLEtBQUssSUFBSSxDQUFDLE9BQU8sQ0FBQztnQkFBQyxHQUFHLENBQUMsU0FBUyxHQUFHLEdBQUcsQ0FBQyxPQUFPLEtBQUssU0FBUyxHQUFHLElBQUksQ0FBQyxXQUFXLEdBQUcsU0FBUyxDQUFDO1lBQzFHLEVBQUUsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxTQUFTLEtBQUssSUFBSSxDQUFDLFNBQVMsQ0FBQztnQkFBQyxHQUFHLENBQUMsV0FBVyxHQUFHLEdBQUcsQ0FBQyxTQUFTLEtBQUssU0FBUyxHQUFHLElBQUksQ0FBQyxXQUFXLEdBQUcsU0FBUyxDQUFDO1lBQ2xILEVBQUUsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxRQUFRLEtBQUssSUFBSSxDQUFDLFFBQVEsQ0FBQztnQkFBQyxHQUFHLENBQUMsVUFBVSxHQUFHLEdBQUcsQ0FBQyxRQUFRLEtBQUssU0FBUyxHQUFHLElBQUksQ0FBQyxXQUFXLEdBQUcsU0FBUyxDQUFDO1lBQzlHLEVBQUUsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxVQUFVLEtBQUssSUFBSSxDQUFDLFVBQVUsQ0FBQztnQkFBQyxHQUFHLENBQUMsWUFBWSxHQUFHLEdBQUcsQ0FBQyxVQUFVLEtBQUssU0FBUyxHQUFHLElBQUksQ0FBQyxXQUFXLEdBQUcsU0FBUyxDQUFDO1lBQ3RILEVBQUUsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxVQUFVLEtBQUssSUFBSSxDQUFDLFVBQVUsQ0FBQztnQkFBQyxHQUFHLENBQUMsV0FBVyxHQUFHLEdBQUcsQ0FBQyxVQUFVLEtBQUssU0FBUyxHQUFHLElBQUksQ0FBQyxXQUFXLEdBQUcsU0FBUyxDQUFDO1lBQ3JILEVBQUUsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxRQUFRLEtBQUssSUFBSSxDQUFDLFFBQVEsQ0FBQztnQkFBQyxHQUFHLENBQUMsVUFBVSxHQUFHLEdBQUcsQ0FBQyxRQUFRLEtBQUssU0FBUyxHQUFHLElBQUksQ0FBQyxXQUFXLEdBQUcsU0FBUyxDQUFDO1lBQzlHLEVBQUUsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxTQUFTLEtBQUssSUFBSSxDQUFDLFNBQVMsQ0FBQztnQkFBQyxHQUFHLENBQUMsV0FBVyxHQUFHLEdBQUcsQ0FBQyxTQUFTLEtBQUssU0FBUyxHQUFHLElBQUksQ0FBQyxXQUFXLEdBQUcsU0FBUyxDQUFDO1lBQ2xILEVBQUUsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxPQUFPLEtBQUssSUFBSSxDQUFDLE9BQU8sQ0FBQztnQkFBQyxHQUFHLENBQUMsU0FBUyxHQUFHLEdBQUcsQ0FBQyxPQUFPLEtBQUssU0FBUyxHQUFHLElBQUksQ0FBQyxXQUFXLEdBQUcsU0FBUyxDQUFDO1lBQzFHLEVBQUUsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEtBQUssSUFBSSxDQUFDLElBQUksQ0FBQztnQkFBQyxHQUFHLENBQUMsTUFBTSxHQUFHLEdBQUcsQ0FBQyxJQUFJLEtBQUssU0FBUyxHQUFHLElBQUksQ0FBQyxXQUFXLEdBQUcsU0FBUyxDQUFDO1lBQzlGLEVBQUUsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEtBQUssSUFBSSxDQUFDLElBQUksQ0FBQztnQkFBQyxHQUFHLENBQUMsTUFBTSxHQUFHLEdBQUcsQ0FBQyxJQUFJLEtBQUssU0FBUyxHQUFHLElBQUksQ0FBQyxXQUFXLEdBQUcsU0FBUyxDQUFDO1lBQzlGLEVBQUUsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxNQUFNLEtBQUssSUFBSSxDQUFDLE1BQU0sQ0FBQztnQkFBQyxHQUFHLENBQUMsUUFBUSxHQUFHLEdBQUcsQ0FBQyxNQUFNLEtBQUssU0FBUyxHQUFHLElBQUksQ0FBQyxXQUFXLEdBQUcsU0FBUyxDQUFDO1lBQ3RHLEVBQUUsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxLQUFLLEtBQUssSUFBSSxDQUFDLEtBQUssQ0FBQztnQkFBQyxHQUFHLENBQUMsT0FBTyxHQUFHLEdBQUcsQ0FBQyxLQUFLLEtBQUssU0FBUyxHQUFHLElBQUksQ0FBQyxXQUFXLEdBQUcsU0FBUyxDQUFDO1lBQ2xHLEVBQUUsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEtBQUssSUFBSSxDQUFDLElBQUksQ0FBQztnQkFBQyxHQUFHLENBQUMsTUFBTSxHQUFHLEdBQUcsQ0FBQyxJQUFJLEtBQUssU0FBUyxHQUFHLElBQUksQ0FBQyxXQUFXLEdBQUcsU0FBUyxDQUFDO1lBQzlGLEVBQUUsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxLQUFLLEtBQUssSUFBSSxDQUFDLEtBQUssQ0FBQztnQkFBQyxHQUFHLENBQUMsT0FBTyxHQUFHLEdBQUcsQ0FBQyxLQUFLLEtBQUssU0FBUyxHQUFHLElBQUksQ0FBQyxXQUFXLEdBQUcsU0FBUyxDQUFD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QUFJLENBQUMsR0FBRyxLQUFLLElBQUksQ0FBQyxHQUFHO21CQUNyQixJQUFJLENBQUMsSUFBSSxLQUFLLElBQUksQ0FBQyxJQUFJO21CQUN2QixJQUFJLENBQUMsSUFBSSxLQUFLLElBQUksQ0FBQyxJQUFJO21CQUN2QixJQUFJLENBQUMsS0FBSyxLQUFLLElBQUksQ0FBQyxLQUFLO21CQUN6QixJQUFJLENBQUMsTUFBTSxLQUFLLElBQUksQ0FBQyxNQUFNO21CQUMzQixJQUFJLENBQUMsTUFBTSxLQUFLLElBQUksQ0FBQyxNQUFNO21CQUMzQixJQUFJLENBQUMsZUFBZSxLQUFLLElBQUksQ0FBQyxlQUFlO21CQUM3QyxJQUFJLENBQUMsZUFBZSxLQUFLLElBQUksQ0FBQyxlQUFlO21CQUM3QyxJQUFJLENBQUMsS0FBSyxLQUFLLElBQUksQ0FBQyxLQUFLO21CQUN6QixJQUFJLENBQUMsT0FBTyxLQUFLLElBQUksQ0FBQyxPQUFPO21CQUM3QixJQUFJLENBQUMsTUFBTSxLQUFLLElBQUksQ0FBQyxNQUFNO21CQUMzQixJQUFJLENBQUMsV0FBVyxLQUFLLElBQUksQ0FBQyxXQUFXO21CQUNyQyxJQUFJLENBQUMsV0FBVyxLQUFLLElBQUksQ0FBQyxXQUFXO21CQUNyQyxJQUFJLENBQUMsWUFBWSxLQUFLLElBQUksQ0FBQyxZQUFZO21CQUN2QyxJQUFJLENBQUMsT0FBTyxLQUFLLElBQUksQ0FBQyxPQUFPO21CQUM3QixJQUFJLENBQUMsVUFBVSxLQUFLLElBQUksQ0FBQyxVQUFVO21CQUNuQyxJQUFJLENBQUMsUUFBUSxLQUFLLElBQUksQ0FBQyxRQUFRO21CQUMvQixJQUFJLENBQUMsU0FBUyxLQUFLLElBQUksQ0FBQyxTQUFTO21CQUNqQyxJQUFJLENBQUMsU0FBUyxLQUFLLElBQUksQ0FBQyxTQUFTO21CQUNqQyxJQUFJLENBQUMsYUFBYSxLQUFLLElBQUksQ0FBQyxhQUFhO21CQUN6QyxJQUFJLENBQUMsUUFBUSxLQUFLLElBQUksQ0FBQyxRQUFRO21CQUMvQixJQUFJLENBQUMsS0FBSyxLQUFL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QUFFLFVBQVMsQ0FBQyxFQUFFLENBQUM7SUFDOUQsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsT0FBTyxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDO0FBQ2pELENBQUMsQ0FBQyxDQUFDO0FBRUgsT0FBTyxDQUFDLE1BQU0sQ0FBQyxHQUFHLEVBQUUsRUFBQyxNQUFNLEVBQUUsUUFBUSxFQUFDLEVBQUUsVUFBUyxDQUFDLEVBQUUsQ0FBQztJQUNuRCxNQUFNLENBQUMsRUFBQyxNQUFNLEVBQUUsQ0FBQyxHQUFHLENBQUMsRUFBQyxDQUFDO0FBQ3pCLENBQUMsQ0FBQyxDQUFDO0FBRUgsT0FBTyxDQUFDLE1BQU0sQ0FBQyxHQUFHLEVBQUUsRUFBQyxNQUFNLEVBQUUsUUFBUSxFQUFDLEVBQUUsVUFBUyxDQUFDLEVBQUUsQ0FBQztJQUNuRCxNQUFNLENBQUMsRUFBQyxNQUFNLEVBQUUsQ0FBQyxHQUFHLENBQUMsRUFBQyxDQUFDO0FBQ3pCLENBQUMsQ0FBQyxDQUFDO0FBRUgsT0FBTyxDQUFDLE1BQU0sQ0FBQyxHQUFHLEVBQUUsRUFBQyxNQUFNLEVBQUUsUUFBUSxFQUFDLEVBQUUsVUFBUyxDQUFDLEVBQUUsQ0FBQztJQUNuRCxNQUFNLENBQUMsRUFBQyxNQUFNLEVBQUUsQ0FBQyxHQUFHLENBQUMsRUFBQyxDQUFDO0FBQ3pCLENBQUMsQ0FBQyxDQUFDO0FBRUgsT0FBTyxDQUFDLE1BQU0sQ0FBQyxHQUFHLEVBQUUsRUFBQyxNQUFNLEVBQUUsUUFBUSxFQUFDLEVBQUUsVUFBUyxDQUFDLEVBQUUsQ0FBQztJQUNuRCxNQUFNLENBQUMsRUFBQyxNQUFNLEVBQUUsQ0FBQyxHQUFHLENBQUMsRUFBQyxDQUFDO0FBQ3pCLENBQUMsQ0FBQyxDQUFDO0FBRUgsT0FBTyxDQUFDLE1BQU0sQ0FBQyxHQUFHLEVBQUUsRUFBQyxNQUFNLEVBQUUsUUFBUSxFQUFDLEVBQUUsVUFBUyxDQUFDLEVBQUUsQ0FBQztJQUNuRCxNQUFNLENBQUMsRUFBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLEdBQUcs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QztnQkFDaEQsV0FBVyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQztnQkFDeEMsV0FBVyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQztnQkFDeEMsS0FBSyxDQUFDO1lBQ1IsQ0FBQztZQUNELEVBQUUsQ0FBQSxDQUFDLFFBQVEsS0FBSyxDQUFDLElBQUksS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFDLE1BQU0sSUFBSSxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsTUFBTSxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQzFFLFdBQVcsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUM7Z0JBQ3hDLFdBQVcsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUM7Z0JBQ3ZDLEtBQUssQ0FBQztZQUNSLENBQUM7WUFDRCxFQUFFLENBQUEsQ0FBQyxRQUFRLEtBQUssQ0FBQyxJQUFJLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxNQUFNLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDaEQsV0FBVyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQztnQkFDdkMsV0FBVyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQztnQkFDdkMsV0FBVyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQztnQkFDdkMsS0FBSyxDQUFDO1lBQ1IsQ0FBQztZQUNELEVBQUUsQ0FBQSxDQUFDLFFBQVEsS0FBSyxDQUFDLElBQUksS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7Z0JB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QUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiLy8gQ29kZU1pcnJvciwgY29weXJpZ2h0IChjKSBieSBNYXJpam4gSGF2ZXJiZWtlIGFuZCBvdGhlcnNcbi8vIERpc3RyaWJ1dGVkIHVuZGVyIGFuIE1JVCBsaWNlbnNlOiBodHRwOi8vY29kZW1pcnJvci5uZXQvTElDRU5TRVxuXG4vLyBVdGlsaXR5IGZ1bmN0aW9uIHRoYXQgYWxsb3dzIG1vZGVzIHRvIGJlIGNvbWJpbmVkLiBUaGUgbW9kZSBnaXZlblxuLy8gYXMgdGhlIGJhc2UgYXJndW1lbnQgdGFrZXMgY2FyZSBvZiBtb3N0IG9mIHRoZSBub3JtYWwgbW9kZVxuLy8gZnVuY3Rpb25hbGl0eSwgYnV0IGEgc2Vjb25kICh0eXBpY2FsbHkgc2ltcGxlKSBtb2RlIGlzIHVzZWQsIHdoaWNoXG4vLyBjYW4gb3ZlcnJpZGUgdGhlIHN0eWxlIG9mIHRleHQuIEJvdGggbW9kZXMgZ2V0IHRvIHBhcnNlIGFsbCBvZiB0aGVcbi8vIHRleHQsIGJ1dCB3aGVuIGJvdGggYXNzaWduIGEgbm9uLW51bGwgc3R5bGUgdG8gYSBwaWVjZSBvZiBjb2RlLCB0aGVcbi8vIG92ZXJsYXkgd2lucywgdW5sZXNzIHRoZSBjb21iaW5lIGFyZ3VtZW50IHdhcyB0cnVlIGFuZCBub3Qgb3ZlcnJpZGRlbixcbi8vIG9yIHN0YXRlLm92ZXJsYXkuY29tYmluZVRva2VucyB3YXMgdHJ1ZSwgaW4gd2hpY2ggY2FzZSB0aGUgc3R5bGVzIGFyZVxuLy8gY29tYmluZWQuXG5cbihmdW5jdGlvbihtb2QpIHtcbiAgaWYgKHR5cGVvZiBleHBvcnRzID09IFwib2JqZWN0XCIgJiYgdHlwZW9mIG1vZHVsZSA9PSBcIm9iamVjdFwiKSAvLyBDb21tb25KU1xuICAgIG1vZChyZXF1aXJlKFwiLi4vLi4vbGliL2NvZGVtaXJyb3JcIikpO1xuICBlbHNlIGlmICh0eXBlb2YgZGVmaW5lID09IFwiZnVuY3Rpb25cIiAmJiBkZWZpbmUuYW1kKSAvLyBBTURcbiAgICBkZWZpbmUoW1wiLi4vLi4vbGliL2NvZGVtaXJyb3JcIl0sIG1vZCk7XG4gIGVsc2UgLy8gUGxhaW4gYnJvd3NlciBlbnZcbiAgICBtb2QoQ29kZU1pcnJvcik7XG59KShmdW5jdGlvbihDb2RlTWlycm9yKSB7XG5cInVzZSBzdHJpY3RcIjtcblxuQ29kZU1pcnJvci5vdmVybGF5TW9kZSA9IGZ1bmN0aW9uKGJhc2UsIG92ZXJsYXksIGNvbWJpbmUpIHtcbiAgcmV0dXJuIHtcbiAgICBzdGFydFN0YXRlOiBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGJhc2U6IENvZGVNaXJyb3Iuc3RhcnRTdGF0ZShiYXNlKSxcbiAgICAgICAgb3ZlcmxheTogQ29kZU1pcnJvci5zdGFydFN0YXRlKG92ZXJsYXkpLFxuICAgICAgICBiYXNlUG9zOiAwLCBiYXNlQ3VyOiBudWxsLFxuICAgICAgICBvdmVybGF5UG9zOiAwLCBvdmVybGF5Q3VyOiBudWxsLFxuICAgICAgICBzdHJlYW1TZWVuOiBudWxsXG4gICAgICB9O1xuICAgIH0sXG4gICAgY29weVN0YXRlOiBmdW5jdGlvbihzdGF0ZSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgYmFzZTogQ29kZU1pcnJvci5jb3B5U3RhdGUoYmFzZSwgc3RhdGUuYmFzZSksXG4gICAgICAgIG92ZXJsYXk6IENvZGVNaXJyb3IuY29weVN0YXRlKG92ZXJsYXksIHN0YXRlLm92ZXJsYXkpLFxuICAgICAgICBiYXNlUG9zOiBzdGF0ZS5iYXNlUG9zLCBiYXNlQ3VyOiBudWxsLFxuICAgICAgICBvdmVybGF5UG9zOiBzdGF0ZS5vdmVybGF5UG9zLCBvdmVybGF5Q3VyOiBudWxsXG4gICAgICB9O1xuICAgIH0sXG5cbiAgICB0b2tlbjogZnVuY3Rpb24oc3RyZWFtLCBzdGF0ZSkge1xuICAgICAgaWYgKHN0cmVhbSAhPSBzdGF0ZS5zdHJlYW1TZWVuIHx8XG4gICAgICAgICAgTWF0aC5taW4oc3RhdGUuYmFzZVBvcywgc3RhdGUub3ZlcmxheVBvcykgPCBzdHJlYW0uc3RhcnQpIHtcbiAgICAgICAgc3RhdGUuc3RyZWFtU2VlbiA9IHN0cmVhbTtcbiAgICAgICAgc3RhdGUuYmFzZVBvcyA9IHN0YXRlLm92ZXJsYXlQb3MgPSBzdHJlYW0uc3RhcnQ7XG4gICAgICB9XG5cbiAgICAgIGlmIChzdHJlYW0uc3RhcnQgPT0gc3RhdGUuYmFzZVBvcykge1xuICAgICAgICBzdGF0ZS5iYXNlQ3VyID0gYmFzZS50b2tlbihzdHJlYW0sIHN0YXRlLmJhc2UpO1xuICAgICAgICBzdGF0ZS5iYXNlUG9zID0gc3RyZWFtLnBvcztcbiAgICAgIH1cbiAgICAgIGlmIChzdHJlYW0uc3RhcnQgPT0gc3RhdGUub3ZlcmxheVBvcykge1xuICAgICAgICBzdHJlYW0ucG9zID0gc3RyZWFtLnN0YXJ0O1xuICAgICAgICBzdGF0ZS5vdmVybGF5Q3VyID0gb3ZlcmxheS50b2tlbihzdHJlYW0sIHN0YXRlLm92ZXJsYXkpO1xuICAgICAgICBzdGF0ZS5vdmVybGF5UG9zID0gc3RyZWFtLnBvcztcbiAgICAgIH1cbiAgICAgIHN0cmVhbS5wb3MgPSBNYXRoLm1pbihzdGF0ZS5iYXNlUG9zLCBzdGF0ZS5vdmVybGF5UG9zKTtcblxuICAgICAgLy8gc3RhdGUub3ZlcmxheS5jb21iaW5lVG9rZW5zIGFsd2F5cyB0YWtlcyBwcmVjZWRlbmNlIG92ZXIgY29tYmluZSxcbiAgICAgIC8vIHVubGVzcyBzZXQgdG8gbnVsbFxuICAgICAgaWYgKHN0YXRlLm92ZXJsYXlDdXIgPT0gbnVsbCkgcmV0dXJuIHN0YXRlLmJhc2VDdXI7XG4gICAgICBlbHNlIGlmIChzdGF0ZS5iYXNlQ3VyICE9IG51bGwgJiZcbiAgICAgICAgICAgICAgIHN0YXRlLm92ZXJsYXkuY29tYmluZVRva2VucyB8fFxuICAgICAgICAgICAgICAgY29tYmluZSAmJiBzdGF0ZS5vdmVybGF5LmNvbWJpbmVUb2tlbnMgPT0gbnVsbClcbiAgICAgICAgcmV0dXJuIHN0YXRlLmJhc2VDdXIgKyBcIiBcIiArIHN0YXRlLm92ZXJsYXlDdXI7XG4gICAgICBlbHNlIHJldHVybiBzdGF0ZS5vdmVybGF5Q3VyO1xuICAgIH0sXG5cbiAgICBpbmRlbnQ6IGJhc2UuaW5kZW50ICYmIGZ1bmN0aW9uKHN0YXRlLCB0ZXh0QWZ0ZXIpIHtcbiAgICAgIHJldHVybiBiYXNlLmluZGVudChzdGF0ZS5iYXNlLCB0ZXh0QWZ0ZXIpO1xuICAgIH0sXG4gICAgZWxlY3RyaWNDaGFyczogYmFzZS5lbGVjdHJpY0NoYXJzLFxuXG4gICAgaW5uZXJNb2RlOiBmdW5jdGlvbihzdGF0ZSkgeyByZXR1cm4ge3N0YXRlOiBzdGF0ZS5iYXNlLCBtb2RlOiBiYXNlfTsgfSxcblxuICAgIGJsYW5rTGluZTogZnVuY3Rpb24oc3RhdGUpIHtcbiAgICAgIGlmIChiYXNlLmJsYW5rTGluZSkgYmFzZS5ibGFua0xpbmUoc3RhdGUuYmFzZSk7XG4gICAgICBpZiAob3ZlcmxheS5ibGFua0xpbmUpIG92ZXJsYXkuYmxhbmtMaW5lKHN0YXRlLm92ZXJsYXkpO1xuICAgIH1cbiAgfTtcbn07XG5cbn0pO1xuIiwiLy8gQ29kZU1pcnJvciwgY29weXJpZ2h0IChjKSBieSBNYXJpam4gSGF2ZXJiZWtlIGFuZCBvdGhlcnNcbi8vIERpc3RyaWJ1dGVkIHVuZGVyIGFuIE1JVCBsaWNlbnNlOiBodHRwOi8vY29kZW1pcnJvci5uZXQvTElDRU5TRVxuXG4vLyBUaGlzIGlzIENvZGVNaXJyb3IgKGh0dHA6Ly9jb2RlbWlycm9yLm5ldCksIGEgY29kZSBlZGl0b3Jcbi8vIGltcGxlbWVudGVkIGluIEphdmFTY3JpcHQgb24gdG9wIG9mIHRoZSBicm93c2VyJ3MgRE9NLlxuLy9cbi8vIFlvdSBjYW4gZmluZCBzb21lIHRlY2huaWNhbCBiYWNrZ3JvdW5kIGZvciBzb21lIG9mIHRoZSBjb2RlIGJlbG93XG4vLyBhdCBodHRwOi8vbWFyaWpuaGF2ZXJiZWtlLm5sL2Jsb2cvI2NtLWludGVybmFscyAuXG5cbihmdW5jdGlvbihtb2QpIHtcbiAgaWYgKHR5cGVvZiBleHBvcnRzID09IFwib2JqZWN0XCIgJiYgdHlwZW9mIG1vZHVsZSA9PSBcIm9iamVjdFwiKSAvLyBDb21tb25KU1xuICAgIG1vZHVsZS5leHBvcnRzID0gbW9kKCk7XG4gIGVsc2UgaWYgKHR5cGVvZiBkZWZpbmUgPT0gXCJmdW5jdGlvblwiICYmIGRlZmluZS5hbWQpIC8vIEFNRFxuICAgIHJldHVybiBkZWZpbmUoW10sIG1vZCk7XG4gIGVsc2UgLy8gUGxhaW4gYnJvd3NlciBlbnZcbiAgICAodGhpcyB8fCB3aW5kb3cpLkNvZGVNaXJyb3IgPSBtb2QoKTtcbn0pKGZ1bmN0aW9uKCkge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICAvLyBCUk9XU0VSIFNOSUZGSU5HXG5cbiAgLy8gS2x1ZGdlcyBmb3IgYnVncyBhbmQgYmVoYXZpb3IgZGlmZmVyZW5jZXMgdGhhdCBjYW4ndCBiZSBmZWF0dXJlXG4gIC8vIGRldGVjdGVkIGFyZSBlbmFibGVkIGJhc2VkIG9uIHVzZXJBZ2VudCBldGMgc25pZmZpbmcuXG4gIHZhciB1c2VyQWdlbnQgPSBuYXZpZ2F0b3IudXNlckFnZW50O1xuICB2YXIgcGxhdGZvcm0gPSBuYXZpZ2F0b3IucGxhdGZvcm07XG5cbiAgdmFyIGdlY2tvID0gL2dlY2tvXFwvXFxkL2kudGVzdCh1c2VyQWdlbnQpO1xuICB2YXIgaWVfdXB0bzEwID0gL01TSUUgXFxkLy50ZXN0KHVzZXJBZ2VudCk7XG4gIHZhciBpZV8xMXVwID0gL1RyaWRlbnRcXC8oPzpbNy05XXxcXGR7Mix9KVxcLi4qcnY6KFxcZCspLy5leGVjKHVzZXJBZ2VudCk7XG4gIHZhciBpZSA9IGllX3VwdG8xMCB8fCBpZV8xMXVwO1xuICB2YXIgaWVfdmVyc2lvbiA9IGllICYmIChpZV91cHRvMTAgPyBkb2N1bWVudC5kb2N1bWVudE1vZGUgfHwgNiA6IGllXzExdXBbMV0pO1xuICB2YXIgd2Via2l0ID0gL1dlYktpdFxcLy8udGVzdCh1c2VyQWdlbnQpO1xuICB2YXIgcXR3ZWJraXQgPSB3ZWJraXQgJiYgL1F0XFwvXFxkK1xcLlxcZCsvLnRlc3QodXNlckFnZW50KTtcbiAgdmFyIGNocm9tZSA9IC9DaHJvbWVcXC8vLnRlc3QodXNlckFnZW50KTtcbiAgdmFyIHByZXN0byA9IC9PcGVyYVxcLy8udGVzdCh1c2VyQWdlbnQpO1xuICB2YXIgc2FmYXJpID0gL0FwcGxlIENvbXB1dGVyLy50ZXN0KG5hdmlnYXRvci52ZW5kb3IpO1xuICB2YXIgbWFjX2dlTW91bnRhaW5MaW9uID0gL01hYyBPUyBYIDFcXGRcXEQoWzgtOV18XFxkXFxkKVxcRC8udGVzdCh1c2VyQWdlbnQpO1xuICB2YXIgcGhhbnRvbSA9IC9QaGFudG9tSlMvLnRlc3QodXNlckFnZW50KTtcblxuICB2YXIgaW9zID0gL0FwcGxlV2ViS2l0Ly50ZXN0KHVzZXJBZ2VudCkgJiYgL01vYmlsZVxcL1xcdysvLnRlc3QodXNlckFnZW50KTtcbiAgLy8gVGhpcyBpcyB3b2VmdWxseSBpbmNvbXBsZXRlLiBTdWdnZXN0aW9ucyBmb3IgYWx0ZXJuYXRpdmUgbWV0aG9kcyB3ZWxjb21lLlxuICB2YXIgbW9iaWxlID0gaW9zIHx8IC9BbmRyb2lkfHdlYk9TfEJsYWNrQmVycnl8T3BlcmEgTWluaXxPcGVyYSBNb2JpfElFTW9iaWxlL2kudGVzdCh1c2VyQWdlbnQpO1xuICB2YXIgbWFjID0gaW9zIHx8IC9NYWMvLnRlc3QocGxhdGZvcm0pO1xuICB2YXIgd2luZG93cyA9IC93aW4vaS50ZXN0KHBsYXRmb3JtKTtcblxuICB2YXIgcHJlc3RvX3ZlcnNpb24gPSBwcmVzdG8gJiYgdXNlckFnZW50Lm1hdGNoKC9WZXJzaW9uXFwvKFxcZCpcXC5cXGQqKS8pO1xuICBpZiAocHJlc3RvX3ZlcnNpb24pIHByZXN0b192ZXJzaW9uID0gTnVtYmVyKHByZXN0b192ZXJzaW9uWzFdKTtcbiAgaWYgKHByZXN0b192ZXJzaW9uICYmIHByZXN0b192ZXJzaW9uID49IDE1KSB7IHByZXN0byA9IGZhbHNlOyB3ZWJraXQgPSB0cnVlOyB9XG4gIC8vIFNvbWUgYnJvd3NlcnMgdXNlIHRoZSB3cm9uZyBldmVudCBwcm9wZXJ0aWVzIHRvIHNpZ25hbCBjbWQvY3RybCBvbiBPUyBYXG4gIHZhciBmbGlwQ3RybENtZCA9IG1hYyAmJiAocXR3ZWJraXQgfHwgcHJlc3RvICYmIChwcmVzdG9fdmVyc2lvbiA9PSBudWxsIHx8IHByZXN0b192ZXJzaW9uIDwgMTIuMTEpKTtcbiAgdmFyIGNhcHR1cmVSaWdodENsaWNrID0gZ2Vja28gfHwgKGllICYmIGllX3ZlcnNpb24gPj0gOSk7XG5cbiAgLy8gT3B0aW1pemUgc29tZSBjb2RlIHdoZW4gdGhlc2UgZmVhdHVyZXMgYXJlIG5vdCB1c2VkLlxuICB2YXIgc2F3UmVhZE9ubHlTcGFucyA9IGZhbHNlLCBzYXdDb2xsYXBzZWRTcGFucyA9IGZhbHNlO1xuXG4gIC8vIEVESVRPUiBDT05TVFJVQ1RPUlxuXG4gIC8vIEEgQ29kZU1pcnJvciBpbnN0YW5jZSByZXByZXNlbnRzIGFuIGVkaXRvci4gVGhpcyBpcyB0aGUgb2JqZWN0XG4gIC8vIHRoYXQgdXNlciBjb2RlIGlzIHVzdWFsbHkgZGVhbGluZyB3aXRoLlxuXG4gIGZ1bmN0aW9uIENvZGVNaXJyb3IocGxhY2UsIG9wdGlvbnMpIHtcbiAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgQ29kZU1pcnJvcikpIHJldHVybiBuZXcgQ29kZU1pcnJvcihwbGFjZSwgb3B0aW9ucyk7XG5cbiAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zID0gb3B0aW9ucyA/IGNvcHlPYmoob3B0aW9ucykgOiB7fTtcbiAgICAvLyBEZXRlcm1pbmUgZWZmZWN0aXZlIG9wdGlvbnMgYmFzZWQgb24gZ2l2ZW4gdmFsdWVzIGFuZCBkZWZhdWx0cy5cbiAgICBjb3B5T2JqKGRlZmF1bHRzLCBvcHRpb25zLCBmYWxzZSk7XG4gICAgc2V0R3V0dGVyc0ZvckxpbmVOdW1iZXJzKG9wdGlvbnMpO1xuXG4gICAgdmFyIGRvYyA9IG9wdGlvbnMudmFsdWU7XG4gICAgaWYgKHR5cGVvZiBkb2MgPT0gXCJzdHJpbmdcIikgZG9jID0gbmV3IERvYyhkb2MsIG9wdGlvbnMubW9kZSwgbnVsbCwgb3B0aW9ucy5saW5lU2VwYXJhdG9yKTtcbiAgICB0aGlzLmRvYyA9IGRvYztcblxuICAgIHZhciBpbnB1dCA9IG5ldyBDb2RlTWlycm9yLmlucHV0U3R5bGVzW29wdGlvbnMuaW5wdXRTdHlsZV0odGhpcyk7XG4gICAgdmFyIGRpc3BsYXkgPSB0aGlzLmRpc3BsYXkgPSBuZXcgRGlzcGxheShwbGFjZSwgZG9jLCBpbnB1dCk7XG4gICAgZGlzcGxheS53cmFwcGVyLkNvZGVNaXJyb3IgPSB0aGlzO1xuICAgIHVwZGF0ZUd1dHRlcnModGhpcyk7XG4gICAgdGhlbWVDaGFuZ2VkKHRoaXMpO1xuICAgIGlmIChvcHRpb25zLmxpbmVXcmFwcGluZylcbiAgICAgIHRoaXMuZGlzcGxheS53cmFwcGVyLmNsYXNzTmFtZSArPSBcIiBDb2RlTWlycm9yLXdyYXBcIjtcbiAgICBpZiAob3B0aW9ucy5hdXRvZm9jdXMgJiYgIW1vYmlsZSkgZGlzcGxheS5pbnB1dC5mb2N1cygpO1xuICAgIGluaXRTY3JvbGxiYXJzKHRoaXMpO1xuXG4gICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgIGtleU1hcHM6IFtdLCAgLy8gc3RvcmVzIG1hcHMgYWRkZWQgYnkgYWRkS2V5TWFwXG4gICAgICBvdmVybGF5czogW10sIC8vIGhpZ2hsaWdodGluZyBvdmVybGF5cywgYXMgYWRkZWQgYnkgYWRkT3ZlcmxheVxuICAgICAgbW9kZUdlbjogMCwgICAvLyBidW1wZWQgd2hlbiBtb2RlL292ZXJsYXkgY2hhbmdlcywgdXNlZCB0byBpbnZhbGlkYXRlIGhpZ2hsaWdodGluZyBpbmZvXG4gICAgICBvdmVyd3JpdGU6IGZhbHNlLFxuICAgICAgZGVsYXlpbmdCbHVyRXZlbnQ6IGZhbHNlLFxuICAgICAgZm9jdXNlZDogZmFsc2UsXG4gICAgICBzdXBwcmVzc0VkaXRzOiBmYWxzZSwgLy8gdXNlZCB0byBkaXNhYmxlIGVkaXRpbmcgZHVyaW5nIGtleSBoYW5kbGVycyB3aGVuIGluIHJlYWRPbmx5IG1vZGVcbiAgICAgIHBhc3RlSW5jb21pbmc6IGZhbHNlLCBjdXRJbmNvbWluZzogZmFsc2UsIC8vIGhlbHAgcmVjb2duaXplIHBhc3RlL2N1dCBlZGl0cyBpbiBpbnB1dC5wb2xsXG4gICAgICBzZWxlY3RpbmdUZXh0OiBmYWxzZSxcbiAgICAgIGRyYWdnaW5nVGV4dDogZmFsc2UsXG4gICAgICBoaWdobGlnaHQ6IG5ldyBEZWxheWVkKCksIC8vIHN0b3JlcyBoaWdobGlnaHQgd29ya2VyIHRpbWVvdXRcbiAgICAgIGtleVNlcTogbnVsbCwgIC8vIFVuZmluaXNoZWQga2V5IHNlcXVlbmNlXG4gICAgICBzcGVjaWFsQ2hhcnM6IG51bGxcbiAgICB9O1xuXG4gICAgdmFyIGNtID0gdGhpcztcblxuICAgIC8vIE92ZXJyaWRlIG1hZ2ljIHRleHRhcmVhIGNvbnRlbnQgcmVzdG9yZSB0aGF0IElFIHNvbWV0aW1lcyBkb2VzXG4gICAgLy8gb24gb3VyIGhpZGRlbiB0ZXh0YXJlYSBvbiByZWxvYWRcbiAgICBpZiAoaWUgJiYgaWVfdmVyc2lvbiA8IDExKSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgeyBjbS5kaXNwbGF5LmlucHV0LnJlc2V0KHRydWUpOyB9LCAyMCk7XG5cbiAgICByZWdpc3RlckV2ZW50SGFuZGxlcnModGhpcyk7XG4gICAgZW5zdXJlR2xvYmFsSGFuZGxlcnMoKTtcblxuICAgIHN0YXJ0T3BlcmF0aW9uKHRoaXMpO1xuICAgIHRoaXMuY3VyT3AuZm9yY2VVcGRhdGUgPSB0cnVlO1xuICAgIGF0dGFjaERvYyh0aGlzLCBkb2MpO1xuXG4gICAgaWYgKChvcHRpb25zLmF1dG9mb2N1cyAmJiAhbW9iaWxlKSB8fCBjbS5oYXNGb2N1cygpKVxuICAgICAgc2V0VGltZW91dChiaW5kKG9uRm9jdXMsIHRoaXMpLCAyMCk7XG4gICAgZWxzZVxuICAgICAgb25CbHVyKHRoaXMpO1xuXG4gICAgZm9yICh2YXIgb3B0IGluIG9wdGlvbkhhbmRsZXJzKSBpZiAob3B0aW9uSGFuZGxlcnMuaGFzT3duUHJvcGVydHkob3B0KSlcbiAgICAgIG9wdGlvbkhhbmRsZXJzW29wdF0odGhpcywgb3B0aW9uc1tvcHRdLCBJbml0KTtcbiAgICBtYXliZVVwZGF0ZUxpbmVOdW1iZXJXaWR0aCh0aGlzKTtcbiAgICBpZiAob3B0aW9ucy5maW5pc2hJbml0KSBvcHRpb25zLmZpbmlzaEluaXQodGhpcyk7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBpbml0SG9va3MubGVuZ3RoOyArK2kpIGluaXRIb29rc1tpXSh0aGlzKTtcbiAgICBlbmRPcGVyYXRpb24odGhpcyk7XG4gICAgLy8gU3VwcHJlc3Mgb3B0aW1pemVsZWdpYmlsaXR5IGluIFdlYmtpdCwgc2luY2UgaXQgYnJlYWtzIHRleHRcbiAgICAvLyBtZWFzdXJpbmcgb24gbGluZSB3cmFwcGluZyBib3VuZGFyaWVzLlxuICAgIGlmICh3ZWJraXQgJiYgb3B0aW9ucy5saW5lV3JhcHBpbmcgJiZcbiAgICAgICAgZ2V0Q29tcHV0ZWRTdHlsZShkaXNwbGF5LmxpbmVEaXYpLnRleHRSZW5kZXJpbmcgPT0gXCJvcHRpbWl6ZWxlZ2liaWxpdHlcIilcbiAgICAgIGRpc3BsYXkubGluZURpdi5zdHlsZS50ZXh0UmVuZGVyaW5nID0gXCJhdXRvXCI7XG4gIH1cblxuICAvLyBESVNQTEFZIENPTlNUUlVDVE9SXG5cbiAgLy8gVGhlIGRpc3BsYXkgaGFuZGxlcyB0aGUgRE9NIGludGVncmF0aW9uLCBib3RoIGZvciBpbnB1dCByZWFkaW5nXG4gIC8vIGFuZCBjb250ZW50IGRyYXdpbmcuIEl0IGhvbGRzIHJlZmVyZW5jZXMgdG8gRE9NIG5vZGVzIGFuZFxuICAvLyBkaXNwbGF5LXJlbGF0ZWQgc3RhdGUuXG5cbiAgZnVuY3Rpb24gRGlzcGxheShwbGFjZSwgZG9jLCBpbnB1dCkge1xuICAgIHZhciBkID0gdGhpcztcbiAgICB0aGlzLmlucHV0ID0gaW5wdXQ7XG5cbiAgICAvLyBDb3ZlcnMgYm90dG9tLXJpZ2h0IHNxdWFyZSB3aGVuIGJvdGggc2Nyb2xsYmFycyBhcmUgcHJlc2VudC5cbiAgICBkLnNjcm9sbGJhckZpbGxlciA9IGVsdChcImRpdlwiLCBudWxsLCBcIkNvZGVNaXJyb3Itc2Nyb2xsYmFyLWZpbGxlclwiKTtcbiAgICBkLnNjcm9sbGJhckZpbGxlci5zZXRBdHRyaWJ1dGUoXCJjbS1ub3QtY29udGVudFwiLCBcInRydWVcIik7XG4gICAgLy8gQ292ZXJzIGJvdHRvbSBvZiBndXR0ZXIgd2hlbiBjb3Zlckd1dHRlck5leHRUb1Njcm9sbGJhciBpcyBvblxuICAgIC8vIGFuZCBoIHNjcm9sbGJhciBpcyBwcmVzZW50LlxuICAgIGQuZ3V0dGVyRmlsbGVyID0gZWx0KFwiZGl2XCIsIG51bGwsIFwiQ29kZU1pcnJvci1ndXR0ZXItZmlsbGVyXCIpO1xuICAgIGQuZ3V0dGVyRmlsbGVyLnNldEF0dHJpYnV0ZShcImNtLW5vdC1jb250ZW50XCIsIFwidHJ1ZVwiKTtcbiAgICAvLyBXaWxsIGNvbnRhaW4gdGhlIGFjdHVhbCBjb2RlLCBwb3NpdGlvbmVkIHRvIGNvdmVyIHRoZSB2aWV3cG9ydC5cbiAgICBkLmxpbmVEaXYgPSBlbHQoXCJkaXZcIiwgbnVsbCwgXCJDb2RlTWlycm9yLWNvZGVcIik7XG4gICAgLy8gRWxlbWVudHMgYXJlIGFkZGVkIHRvIHRoZXNlIHRvIHJlcHJlc2VudCBzZWxlY3Rpb24gYW5kIGN1cnNvcnMuXG4gICAgZC5zZWxlY3Rpb25EaXYgPSBlbHQoXCJkaXZcIiwgbnVsbCwgbnVsbCwgXCJwb3NpdGlvbjogcmVsYXRpdmU7IHotaW5kZXg6IDFcIik7XG4gICAgZC5jdXJzb3JEaXYgPSBlbHQoXCJkaXZcIiwgbnVsbCwgXCJDb2RlTWlycm9yLWN1cnNvcnNcIik7XG4gICAgLy8gQSB2aXNpYmlsaXR5OiBoaWRkZW4gZWxlbWVudCB1c2VkIHRvIGZpbmQgdGhlIHNpemUgb2YgdGhpbmdzLlxuICAgIGQubWVhc3VyZSA9IGVsdChcImRpdlwiLCBudWxsLCBcIkNvZGVNaXJyb3ItbWVhc3VyZVwiKTtcbiAgICAvLyBXaGVuIGxpbmVzIG91dHNpZGUgb2YgdGhlIHZpZXdwb3J0IGFyZSBtZWFzdXJlZCwgdGhleSBhcmUgZHJhd24gaW4gdGhpcy5cbiAgICBkLmxpbmVNZWFzdXJlID0gZWx0KFwiZGl2XCIsIG51bGwsIFwiQ29kZU1pcnJvci1tZWFzdXJlXCIpO1xuICAgIC8vIFdyYXBzIGV2ZXJ5dGhpbmcgdGhhdCBuZWVkcyB0byBleGlzdCBpbnNpZGUgdGhlIHZlcnRpY2FsbHktcGFkZGVkIGNvb3JkaW5hdGUgc3lzdGVtXG4gICAgZC5saW5lU3BhY2UgPSBlbHQoXCJkaXZcIiwgW2QubWVhc3VyZSwgZC5saW5lTWVhc3VyZSwgZC5zZWxlY3Rpb25EaXYsIGQuY3Vyc29yRGl2LCBkLmxpbmVEaXZdLFxuICAgICAgICAgICAgICAgICAgICAgIG51bGwsIFwicG9zaXRpb246IHJlbGF0aXZlOyBvdXRsaW5lOiBub25lXCIpO1xuICAgIC8vIE1vdmVkIGFyb3VuZCBpdHMgcGFyZW50IHRvIGNvdmVyIHZpc2libGUgdmlldy5cbiAgICBkLm1vdmVyID0gZWx0KFwiZGl2XCIsIFtlbHQoXCJkaXZcIiwgW2QubGluZVNwYWNlXSwgXCJDb2RlTWlycm9yLWxpbmVzXCIpXSwgbnVsbCwgXCJwb3NpdGlvbjogcmVsYXRpdmVcIik7XG4gICAgLy8gU2V0IHRvIHRoZSBoZWlnaHQgb2YgdGhlIGRvY3VtZW50LCBhbGxvd2luZyBzY3JvbGxpbmcuXG4gICAgZC5zaXplciA9IGVsdChcImRpdlwiLCBbZC5tb3Zlcl0sIFwiQ29kZU1pcnJvci1zaXplclwiKTtcbiAgICBkLnNpemVyV2lkdGggPSBudWxsO1xuICAgIC8vIEJlaGF2aW9yIG9mIGVsdHMgd2l0aCBvdmVyZmxvdzogYXV0byBhbmQgcGFkZGluZyBpc1xuICAgIC8vIGluY29uc2lzdGVudCBhY3Jvc3MgYnJvd3NlcnMuIFRoaXMgaXMgdXNlZCB0byBlbnN1cmUgdGhlXG4gICAgLy8gc2Nyb2xsYWJsZSBhcmVhIGlzIGJpZyBlbm91Z2guXG4gICAgZC5oZWlnaHRGb3JjZXIgPSBlbHQoXCJkaXZcIiwgbnVsbCwgbnVsbCwgXCJwb3NpdGlvbjogYWJzb2x1dGU7IGhlaWdodDogXCIgKyBzY3JvbGxlckdhcCArIFwicHg7IHdpZHRoOiAxcHg7XCIpO1xuICAgIC8vIFdpbGwgY29udGFpbiB0aGUgZ3V0dGVycywgaWYgYW55LlxuICAgIGQuZ3V0dGVycyA9IGVsdChcImRpdlwiLCBudWxsLCBcIkNvZGVNaXJyb3ItZ3V0dGVyc1wiKTtcbiAgICBkLmxpbmVHdXR0ZXIgPSBudWxsO1xuICAgIC8vIEFjdHVhbCBzY3JvbGxhYmxlIGVsZW1lbnQuXG4gICAgZC5zY3JvbGxlciA9IGVsdChcImRpdlwiLCBbZC5zaXplciwgZC5oZWlnaHRGb3JjZXIsIGQuZ3V0dGVyc10sIFwiQ29kZU1pcnJvci1zY3JvbGxcIik7XG4gICAgZC5zY3JvbGxlci5zZXRBdHRyaWJ1dGUoXCJ0YWJJbmRleFwiLCBcIi0xXCIpO1xuICAgIC8vIFRoZSBlbGVtZW50IGluIHdoaWNoIHRoZSBlZGl0b3IgbGl2ZXMuXG4gICAgZC53cmFwcGVyID0gZWx0KFwiZGl2XCIsIFtkLnNjcm9sbGJhckZpbGxlciwgZC5ndXR0ZXJGaWxsZXIsIGQuc2Nyb2xsZXJdLCBcIkNvZGVNaXJyb3JcIik7XG5cbiAgICAvLyBXb3JrIGFyb3VuZCBJRTcgei1pbmRleCBidWcgKG5vdCBwZXJmZWN0LCBoZW5jZSBJRTcgbm90IHJlYWxseSBiZWluZyBzdXBwb3J0ZWQpXG4gICAgaWYgKGllICYmIGllX3ZlcnNpb24gPCA4KSB7IGQuZ3V0dGVycy5zdHlsZS56SW5kZXggPSAtMTsgZC5zY3JvbGxlci5zdHlsZS5wYWRkaW5nUmlnaHQgPSAwOyB9XG4gICAgaWYgKCF3ZWJraXQgJiYgIShnZWNrbyAmJiBtb2JpbGUpKSBkLnNjcm9sbGVyLmRyYWdnYWJsZSA9IHRydWU7XG5cbiAgICBpZiAocGxhY2UpIHtcbiAgICAgIGlmIChwbGFjZS5hcHBlbmRDaGlsZCkgcGxhY2UuYXBwZW5kQ2hpbGQoZC53cmFwcGVyKTtcbiAgICAgIGVsc2UgcGxhY2UoZC53cmFwcGVyKTtcbiAgICB9XG5cbiAgICAvLyBDdXJyZW50IHJlbmRlcmVkIHJhbmdlIChtYXkgYmUgYmlnZ2VyIHRoYW4gdGhlIHZpZXcgd2luZG93KS5cbiAgICBkLnZpZXdGcm9tID0gZC52aWV3VG8gPSBkb2MuZmlyc3Q7XG4gICAgZC5yZXBvcnRlZFZpZXdGcm9tID0gZC5yZXBvcnRlZFZpZXdUbyA9IGRvYy5maXJzdDtcbiAgICAvLyBJbmZvcm1hdGlvbiBhYm91dCB0aGUgcmVuZGVyZWQgbGluZXMuXG4gICAgZC52aWV3ID0gW107XG4gICAgZC5yZW5kZXJlZFZpZXcgPSBudWxsO1xuICAgIC8vIEhvbGRzIGluZm8gYWJvdXQgYSBzaW5nbGUgcmVuZGVyZWQgbGluZSB3aGVuIGl0IHdhcyByZW5kZXJlZFxuICAgIC8vIGZvciBtZWFzdXJlbWVudCwgd2hpbGUgbm90IGluIHZpZXcuXG4gICAgZC5leHRlcm5hbE1lYXN1cmVkID0gbnVsbDtcbiAgICAvLyBFbXB0eSBzcGFjZSAoaW4gcGl4ZWxzKSBhYm92ZSB0aGUgdmlld1xuICAgIGQudmlld09mZnNldCA9IDA7XG4gICAgZC5sYXN0V3JhcEhlaWdodCA9IGQubGFzdFdyYXBXaWR0aCA9IDA7XG4gICAgZC51cGRhdGVMaW5lTnVtYmVycyA9IG51bGw7XG5cbiAgICBkLm5hdGl2ZUJhcldpZHRoID0gZC5iYXJIZWlnaHQgPSBkLmJhcldpZHRoID0gMDtcbiAgICBkLnNjcm9sbGJhcnNDbGlwcGVkID0gZmFsc2U7XG5cbiAgICAvLyBVc2VkIHRvIG9ubHkgcmVzaXplIHRoZSBsaW5lIG51bWJlciBndXR0ZXIgd2hlbiBuZWNlc3NhcnkgKHdoZW5cbiAgICAvLyB0aGUgYW1vdW50IG9mIGxpbmVzIGNyb3NzZXMgYSBib3VuZGFyeSB0aGF0IG1ha2VzIGl0cyB3aWR0aCBjaGFuZ2UpXG4gICAgZC5saW5lTnVtV2lkdGggPSBkLmxpbmVOdW1Jbm5lcldpZHRoID0gZC5saW5lTnVtQ2hhcnMgPSBudWxsO1xuICAgIC8vIFNldCB0byB0cnVlIHdoZW4gYSBub24taG9yaXpvbnRhbC1zY3JvbGxpbmcgbGluZSB3aWRnZXQgaXNcbiAgICAvLyBhZGRlZC4gQXMgYW4gb3B0aW1pemF0aW9uLCBsaW5lIHdpZGdldCBhbGlnbmluZyBpcyBza2lwcGVkIHdoZW5cbiAgICAvLyB0aGlzIGlzIGZhbHNlLlxuICAgIGQuYWxpZ25XaWRnZXRzID0gZmFsc2U7XG5cbiAgICBkLmNhY2hlZENoYXJXaWR0aCA9IGQuY2FjaGVkVGV4dEhlaWdodCA9IGQuY2FjaGVkUGFkZGluZ0ggPSBudWxsO1xuXG4gICAgLy8gVHJhY2tzIHRoZSBtYXhpbXVtIGxpbmUgbGVuZ3RoIHNvIHRoYXQgdGhlIGhvcml6b250YWwgc2Nyb2xsYmFyXG4gICAgLy8gY2FuIGJlIGtlcHQgc3RhdGljIHdoZW4gc2Nyb2xsaW5nLlxuICAgIGQubWF4TGluZSA9IG51bGw7XG4gICAgZC5tYXhMaW5lTGVuZ3RoID0gMDtcbiAgICBkLm1heExpbmVDaGFuZ2VkID0gZmFsc2U7XG5cbiAgICAvLyBVc2VkIGZvciBtZWFzdXJpbmcgd2hlZWwgc2Nyb2xsaW5nIGdyYW51bGFyaXR5XG4gICAgZC53aGVlbERYID0gZC53aGVlbERZID0gZC53aGVlbFN0YXJ0WCA9IGQud2hlZWxTdGFydFkgPSBudWxsO1xuXG4gICAgLy8gVHJ1ZSB3aGVuIHNoaWZ0IGlzIGhlbGQgZG93bi5cbiAgICBkLnNoaWZ0ID0gZmFsc2U7XG5cbiAgICAvLyBVc2VkIHRvIHRyYWNrIHdoZXRoZXIgYW55dGhpbmcgaGFwcGVuZWQgc2luY2UgdGhlIGNvbnRleHQgbWVudVxuICAgIC8vIHdhcyBvcGVuZWQuXG4gICAgZC5zZWxGb3JDb250ZXh0TWVudSA9IG51bGw7XG5cbiAgICBkLmFjdGl2ZVRvdWNoID0gbnVsbDtcblxuICAgIGlucHV0LmluaXQoZCk7XG4gIH1cblxuICAvLyBTVEFURSBVUERBVEVTXG5cbiAgLy8gVXNlZCB0byBnZXQgdGhlIGVkaXRvciBpbnRvIGEgY29uc2lzdGVudCBzdGF0ZSBhZ2FpbiB3aGVuIG9wdGlvbnMgY2hhbmdlLlxuXG4gIGZ1bmN0aW9uIGxvYWRNb2RlKGNtKSB7XG4gICAgY20uZG9jLm1vZGUgPSBDb2RlTWlycm9yLmdldE1vZGUoY20ub3B0aW9ucywgY20uZG9jLm1vZGVPcHRpb24pO1xuICAgIHJlc2V0TW9kZVN0YXRlKGNtKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHJlc2V0TW9kZVN0YXRlKGNtKSB7XG4gICAgY20uZG9jLml0ZXIoZnVuY3Rpb24obGluZSkge1xuICAgICAgaWYgKGxpbmUuc3RhdGVBZnRlcikgbGluZS5zdGF0ZUFmdGVyID0gbnVsbDtcbiAgICAgIGlmIChsaW5lLnN0eWxlcykgbGluZS5zdHlsZXMgPSBudWxsO1xuICAgIH0pO1xuICAgIGNtLmRvYy5mcm9udGllciA9IGNtLmRvYy5maXJzdDtcbiAgICBzdGFydFdvcmtlcihjbSwgMTAwKTtcbiAgICBjbS5zdGF0ZS5tb2RlR2VuKys7XG4gICAgaWYgKGNtLmN1ck9wKSByZWdDaGFuZ2UoY20pO1xuICB9XG5cbiAgZnVuY3Rpb24gd3JhcHBpbmdDaGFuZ2VkKGNtKSB7XG4gICAgaWYgKGNtLm9wdGlvbnMubGluZVdyYXBwaW5nKSB7XG4gICAgICBhZGRDbGFzcyhjbS5kaXNwbGF5LndyYXBwZXIsIFwiQ29kZU1pcnJvci13cmFwXCIpO1xuICAgICAgY20uZGlzcGxheS5zaXplci5zdHlsZS5taW5XaWR0aCA9IFwiXCI7XG4gICAgICBjbS5kaXNwbGF5LnNpemVyV2lkdGggPSBudWxsO1xuICAgIH0gZWxzZSB7XG4gICAgICBybUNsYXNzKGNtLmRpc3BsYXkud3JhcHBlciwgXCJDb2RlTWlycm9yLXdyYXBcIik7XG4gICAgICBmaW5kTWF4TGluZShjbSk7XG4gICAgfVxuICAgIGVzdGltYXRlTGluZUhlaWdodHMoY20pO1xuICAgIHJlZ0NoYW5nZShjbSk7XG4gICAgY2xlYXJDYWNoZXMoY20pO1xuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXt1cGRhdGVTY3JvbGxiYXJzKGNtKTt9LCAxMDApO1xuICB9XG5cbiAgLy8gUmV0dXJucyBhIGZ1bmN0aW9uIHRoYXQgZXN0aW1hdGVzIHRoZSBoZWlnaHQgb2YgYSBsaW5lLCB0byB1c2UgYXNcbiAgLy8gZmlyc3QgYXBwcm94aW1hdGlvbiB1bnRpbCB0aGUgbGluZSBiZWNvbWVzIHZpc2libGUgKGFuZCBpcyB0aHVzXG4gIC8vIHByb3Blcmx5IG1lYXN1cmFibGUpLlxuICBmdW5jdGlvbiBlc3RpbWF0ZUhlaWdodChjbSkge1xuICAgIHZhciB0aCA9IHRleHRIZWlnaHQoY20uZGlzcGxheSksIHdyYXBwaW5nID0gY20ub3B0aW9ucy5saW5lV3JhcHBpbmc7XG4gICAgdmFyIHBlckxpbmUgPSB3cmFwcGluZyAmJiBNYXRoLm1heCg1LCBjbS5kaXNwbGF5LnNjcm9sbGVyLmNsaWVudFdpZHRoIC8gY2hhcldpZHRoKGNtLmRpc3BsYXkpIC0gMyk7XG4gICAgcmV0dXJuIGZ1bmN0aW9uKGxpbmUpIHtcbiAgICAgIGlmIChsaW5lSXNIaWRkZW4oY20uZG9jLCBsaW5lKSkgcmV0dXJuIDA7XG5cbiAgICAgIHZhciB3aWRnZXRzSGVpZ2h0ID0gMDtcbiAgICAgIGlmIChsaW5lLndpZGdldHMpIGZvciAodmFyIGkgPSAwOyBpIDwgbGluZS53aWRnZXRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGlmIChsaW5lLndpZGdldHNbaV0uaGVpZ2h0KSB3aWRnZXRzSGVpZ2h0ICs9IGxpbmUud2lkZ2V0c1tpXS5oZWlnaHQ7XG4gICAgICB9XG5cbiAgICAgIGlmICh3cmFwcGluZylcbiAgICAgICAgcmV0dXJuIHdpZGdldHNIZWlnaHQgKyAoTWF0aC5jZWlsKGxpbmUudGV4dC5sZW5ndGggLyBwZXJMaW5lKSB8fCAxKSAqIHRoO1xuICAgICAgZWxzZVxuICAgICAgICByZXR1cm4gd2lkZ2V0c0hlaWdodCArIHRoO1xuICAgIH07XG4gIH1cblxuICBmdW5jdGlvbiBlc3RpbWF0ZUxpbmVIZWlnaHRzKGNtKSB7XG4gICAgdmFyIGRvYyA9IGNtLmRvYywgZXN0ID0gZXN0aW1hdGVIZWlnaHQoY20pO1xuICAgIGRvYy5pdGVyKGZ1bmN0aW9uKGxpbmUpIHtcbiAgICAgIHZhciBlc3RIZWlnaHQgPSBlc3QobGluZSk7XG4gICAgICBpZiAoZXN0SGVpZ2h0ICE9IGxpbmUuaGVpZ2h0KSB1cGRhdGVMaW5lSGVpZ2h0KGxpbmUsIGVzdEhlaWdodCk7XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiB0aGVtZUNoYW5nZWQoY20pIHtcbiAgICBjbS5kaXNwbGF5LndyYXBwZXIuY2xhc3NOYW1lID0gY20uZGlzcGxheS53cmFwcGVyLmNsYXNzTmFtZS5yZXBsYWNlKC9cXHMqY20tcy1cXFMrL2csIFwiXCIpICtcbiAgICAgIGNtLm9wdGlvbnMudGhlbWUucmVwbGFjZSgvKF58XFxzKVxccyovZywgXCIgY20tcy1cIik7XG4gICAgY2xlYXJDYWNoZXMoY20pO1xuICB9XG5cbiAgZnVuY3Rpb24gZ3V0dGVyc0NoYW5nZWQoY20pIHtcbiAgICB1cGRhdGVHdXR0ZXJzKGNtKTtcbiAgICByZWdDaGFuZ2UoY20pO1xuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXthbGlnbkhvcml6b250YWxseShjbSk7fSwgMjApO1xuICB9XG5cbiAgLy8gUmVidWlsZCB0aGUgZ3V0dGVyIGVsZW1lbnRzLCBlbnN1cmUgdGhlIG1hcmdpbiB0byB0aGUgbGVmdCBvZiB0aGVcbiAgLy8gY29kZSBtYXRjaGVzIHRoZWlyIHdpZHRoLlxuICBmdW5jdGlvbiB1cGRhdGVHdXR0ZXJzKGNtKSB7XG4gICAgdmFyIGd1dHRlcnMgPSBjbS5kaXNwbGF5Lmd1dHRlcnMsIHNwZWNzID0gY20ub3B0aW9ucy5ndXR0ZXJzO1xuICAgIHJlbW92ZUNoaWxkcmVuKGd1dHRlcnMpO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc3BlY3MubGVuZ3RoOyArK2kpIHtcbiAgICAgIHZhciBndXR0ZXJDbGFzcyA9IHNwZWNzW2ldO1xuICAgICAgdmFyIGdFbHQgPSBndXR0ZXJzLmFwcGVuZENoaWxkKGVsdChcImRpdlwiLCBudWxsLCBcIkNvZGVNaXJyb3ItZ3V0dGVyIFwiICsgZ3V0dGVyQ2xhc3MpKTtcbiAgICAgIGlmIChndXR0ZXJDbGFzcyA9PSBcIkNvZGVNaXJyb3ItbGluZW51bWJlcnNcIikge1xuICAgICAgICBjbS5kaXNwbGF5LmxpbmVHdXR0ZXIgPSBnRWx0O1xuICAgICAgICBnRWx0LnN0eWxlLndpZHRoID0gKGNtLmRpc3BsYXkubGluZU51bVdpZHRoIHx8IDEpICsgXCJweFwiO1xuICAgICAgfVxuICAgIH1cbiAgICBndXR0ZXJzLnN0eWxlLmRpc3BsYXkgPSBpID8gXCJcIiA6IFwibm9uZVwiO1xuICAgIHVwZGF0ZUd1dHRlclNwYWNlKGNtKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHVwZGF0ZUd1dHRlclNwYWNlKGNtKSB7XG4gICAgdmFyIHdpZHRoID0gY20uZGlzcGxheS5ndXR0ZXJzLm9mZnNldFdpZHRoO1xuICAgIGNtLmRpc3BsYXkuc2l6ZXIuc3R5bGUubWFyZ2luTGVmdCA9IHdpZHRoICsgXCJweFwiO1xuICB9XG5cbiAgLy8gQ29tcHV0ZSB0aGUgY2hhcmFjdGVyIGxlbmd0aCBvZiBhIGxpbmUsIHRha2luZyBpbnRvIGFjY291bnRcbiAgLy8gY29sbGFwc2VkIHJhbmdlcyAoc2VlIG1hcmtUZXh0KSB0aGF0IG1pZ2h0IGhpZGUgcGFydHMsIGFuZCBqb2luXG4gIC8vIG90aGVyIGxpbmVzIG9udG8gaXQuXG4gIGZ1bmN0aW9uIGxpbmVMZW5ndGgobGluZSkge1xuICAgIGlmIChsaW5lLmhlaWdodCA9PSAwKSByZXR1cm4gMDtcbiAgICB2YXIgbGVuID0gbGluZS50ZXh0Lmxlbmd0aCwgbWVyZ2VkLCBjdXIgPSBsaW5lO1xuICAgIHdoaWxlIChtZXJnZWQgPSBjb2xsYXBzZWRTcGFuQXRTdGFydChjdXIpKSB7XG4gICAgICB2YXIgZm91bmQgPSBtZXJnZWQuZmluZCgwLCB0cnVlKTtcbiAgICAgIGN1ciA9IGZvdW5kLmZyb20ubGluZTtcbiAgICAgIGxlbiArPSBmb3VuZC5mcm9tLmNoIC0gZm91bmQudG8uY2g7XG4gICAgfVxuICAgIGN1ciA9IGxpbmU7XG4gICAgd2hpbGUgKG1lcmdlZCA9IGNvbGxhcHNlZFNwYW5BdEVuZChjdXIpKSB7XG4gICAgICB2YXIgZm91bmQgPSBtZXJnZWQuZmluZCgwLCB0cnVlKTtcbiAgICAgIGxlbiAtPSBjdXIudGV4dC5sZW5ndGggLSBmb3VuZC5mcm9tLmNoO1xuICAgICAgY3VyID0gZm91bmQudG8ubGluZTtcbiAgICAgIGxlbiArPSBjdXIudGV4dC5sZW5ndGggLSBmb3VuZC50by5jaDtcbiAgICB9XG4gICAgcmV0dXJuIGxlbjtcbiAgfVxuXG4gIC8vIEZpbmQgdGhlIGxvbmdlc3QgbGluZSBpbiB0aGUgZG9jdW1lbnQuXG4gIGZ1bmN0aW9uIGZpbmRNYXhMaW5lKGNtKSB7XG4gICAgdmFyIGQgPSBjbS5kaXNwbGF5LCBkb2MgPSBjbS5kb2M7XG4gICAgZC5tYXhMaW5lID0gZ2V0TGluZShkb2MsIGRvYy5maXJzdCk7XG4gICAgZC5tYXhMaW5lTGVuZ3RoID0gbGluZUxlbmd0aChkLm1heExpbmUpO1xuICAgIGQubWF4TGluZUNoYW5nZWQgPSB0cnVlO1xuICAgIGRvYy5pdGVyKGZ1bmN0aW9uKGxpbmUpIHtcbiAgICAgIHZhciBsZW4gPSBsaW5lTGVuZ3RoKGxpbmUpO1xuICAgICAgaWYgKGxlbiA+IGQubWF4TGluZUxlbmd0aCkge1xuICAgICAgICBkLm1heExpbmVMZW5ndGggPSBsZW47XG4gICAgICAgIGQubWF4TGluZSA9IGxpbmU7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvLyBNYWtlIHN1cmUgdGhlIGd1dHRlcnMgb3B0aW9ucyBjb250YWlucyB0aGUgZWxlbWVudFxuICAvLyBcIkNvZGVNaXJyb3ItbGluZW51bWJlcnNcIiB3aGVuIHRoZSBsaW5lTnVtYmVycyBvcHRpb24gaXMgdHJ1ZS5cbiAgZnVuY3Rpb24gc2V0R3V0dGVyc0ZvckxpbmVOdW1iZXJzKG9wdGlvbnMpIHtcbiAgICB2YXIgZm91bmQgPSBpbmRleE9mKG9wdGlvbnMuZ3V0dGVycywgXCJDb2RlTWlycm9yLWxpbmVudW1iZXJzXCIpO1xuICAgIGlmIChmb3VuZCA9PSAtMSAmJiBvcHRpb25zLmxpbmVOdW1iZXJzKSB7XG4gICAgICBvcHRpb25zLmd1dHRlcnMgPSBvcHRpb25zLmd1dHRlcnMuY29uY2F0KFtcIkNvZGVNaXJyb3ItbGluZW51bWJlcnNcIl0pO1xuICAgIH0gZWxzZSBpZiAoZm91bmQgPiAtMSAmJiAhb3B0aW9ucy5saW5lTnVtYmVycykge1xuICAgICAgb3B0aW9ucy5ndXR0ZXJzID0gb3B0aW9ucy5ndXR0ZXJzLnNsaWNlKDApO1xuICAgICAgb3B0aW9ucy5ndXR0ZXJzLnNwbGljZShmb3VuZCwgMSk7XG4gICAgfVxuICB9XG5cbiAgLy8gU0NST0xMQkFSU1xuXG4gIC8vIFByZXBhcmUgRE9NIHJlYWRzIG5lZWRlZCB0byB1cGRhdGUgdGhlIHNjcm9sbGJhcnMuIERvbmUgaW4gb25lXG4gIC8vIHNob3QgdG8gbWluaW1pemUgdXBkYXRlL21lYXN1cmUgcm91bmR0cmlwcy5cbiAgZnVuY3Rpb24gbWVhc3VyZUZvclNjcm9sbGJhcnMoY20pIHtcbiAgICB2YXIgZCA9IGNtLmRpc3BsYXksIGd1dHRlclcgPSBkLmd1dHRlcnMub2Zmc2V0V2lkdGg7XG4gICAgdmFyIGRvY0ggPSBNYXRoLnJvdW5kKGNtLmRvYy5oZWlnaHQgKyBwYWRkaW5nVmVydChjbS5kaXNwbGF5KSk7XG4gICAgcmV0dXJuIHtcbiAgICAgIGNsaWVudEhlaWdodDogZC5zY3JvbGxlci5jbGllbnRIZWlnaHQsXG4gICAgICB2aWV3SGVpZ2h0OiBkLndyYXBwZXIuY2xpZW50SGVpZ2h0LFxuICAgICAgc2Nyb2xsV2lkdGg6IGQuc2Nyb2xsZXIuc2Nyb2xsV2lkdGgsIGNsaWVudFdpZHRoOiBkLnNjcm9sbGVyLmNsaWVudFdpZHRoLFxuICAgICAgdmlld1dpZHRoOiBkLndyYXBwZXIuY2xpZW50V2lkdGgsXG4gICAgICBiYXJMZWZ0OiBjbS5vcHRpb25zLmZpeGVkR3V0dGVyID8gZ3V0dGVyVyA6IDAsXG4gICAgICBkb2NIZWlnaHQ6IGRvY0gsXG4gICAgICBzY3JvbGxIZWlnaHQ6IGRvY0ggKyBzY3JvbGxHYXAoY20pICsgZC5iYXJIZWlnaHQsXG4gICAgICBuYXRpdmVCYXJXaWR0aDogZC5uYXRpdmVCYXJXaWR0aCxcbiAgICAgIGd1dHRlcldpZHRoOiBndXR0ZXJXXG4gICAgfTtcbiAgfVxuXG4gIGZ1bmN0aW9uIE5hdGl2ZVNjcm9sbGJhcnMocGxhY2UsIHNjcm9sbCwgY20pIHtcbiAgICB0aGlzLmNtID0gY207XG4gICAgdmFyIHZlcnQgPSB0aGlzLnZlcnQgPSBlbHQoXCJkaXZcIiwgW2VsdChcImRpdlwiLCBudWxsLCBudWxsLCBcIm1pbi13aWR0aDogMXB4XCIpXSwgXCJDb2RlTWlycm9yLXZzY3JvbGxiYXJcIik7XG4gICAgdmFyIGhvcml6ID0gdGhpcy5ob3JpeiA9IGVsdChcImRpdlwiLCBbZWx0KFwiZGl2XCIsIG51bGwsIG51bGwsIFwiaGVpZ2h0OiAxMDAlOyBtaW4taGVpZ2h0OiAxcHhcIildLCBcIkNvZGVNaXJyb3ItaHNjcm9sbGJhclwiKTtcbiAgICBwbGFjZSh2ZXJ0KTsgcGxhY2UoaG9yaXopO1xuXG4gICAgb24odmVydCwgXCJzY3JvbGxcIiwgZnVuY3Rpb24oKSB7XG4gICAgICBpZiAodmVydC5jbGllbnRIZWlnaHQpIHNjcm9sbCh2ZXJ0LnNjcm9sbFRvcCwgXCJ2ZXJ0aWNhbFwiKTtcbiAgICB9KTtcbiAgICBvbihob3JpeiwgXCJzY3JvbGxcIiwgZnVuY3Rpb24oKSB7XG4gICAgICBpZiAoaG9yaXouY2xpZW50V2lkdGgpIHNjcm9sbChob3Jpei5zY3JvbGxMZWZ0LCBcImhvcml6b250YWxcIik7XG4gICAgfSk7XG5cbiAgICB0aGlzLmNoZWNrZWRaZXJvV2lkdGggPSBmYWxzZTtcbiAgICAvLyBOZWVkIHRvIHNldCBhIG1pbmltdW0gd2lkdGggdG8gc2VlIHRoZSBzY3JvbGxiYXIgb24gSUU3IChidXQgbXVzdCBub3Qgc2V0IGl0IG9uIElFOCkuXG4gICAgaWYgKGllICYmIGllX3ZlcnNpb24gPCA4KSB0aGlzLmhvcml6LnN0eWxlLm1pbkhlaWdodCA9IHRoaXMudmVydC5zdHlsZS5taW5XaWR0aCA9IFwiMThweFwiO1xuICB9XG5cbiAgTmF0aXZlU2Nyb2xsYmFycy5wcm90b3R5cGUgPSBjb3B5T2JqKHtcbiAgICB1cGRhdGU6IGZ1bmN0aW9uKG1lYXN1cmUpIHtcbiAgICAgIHZhciBuZWVkc0ggPSBtZWFzdXJlLnNjcm9sbFdpZHRoID4gbWVhc3VyZS5jbGllbnRXaWR0aCArIDE7XG4gICAgICB2YXIgbmVlZHNWID0gbWVhc3VyZS5zY3JvbGxIZWlnaHQgPiBtZWFzdXJlLmNsaWVudEhlaWdodCArIDE7XG4gICAgICB2YXIgc1dpZHRoID0gbWVhc3VyZS5uYXRpdmVCYXJXaWR0aDtcblxuICAgICAgaWYgKG5lZWRzVikge1xuICAgICAgICB0aGlzLnZlcnQuc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIjtcbiAgICAgICAgdGhpcy52ZXJ0LnN0eWxlLmJvdHRvbSA9IG5lZWRzSCA/IHNXaWR0aCArIFwicHhcIiA6IFwiMFwiO1xuICAgICAgICB2YXIgdG90YWxIZWlnaHQgPSBtZWFzdXJlLnZpZXdIZWlnaHQgLSAobmVlZHNIID8gc1dpZHRoIDogMCk7XG4gICAgICAgIC8vIEEgYnVnIGluIElFOCBjYW4gY2F1c2UgdGhpcyB2YWx1ZSB0byBiZSBuZWdhdGl2ZSwgc28gZ3VhcmQgaXQuXG4gICAgICAgIHRoaXMudmVydC5maXJzdENoaWxkLnN0eWxlLmhlaWdodCA9XG4gICAgICAgICAgTWF0aC5tYXgoMCwgbWVhc3VyZS5zY3JvbGxIZWlnaHQgLSBtZWFzdXJlLmNsaWVudEhlaWdodCArIHRvdGFsSGVpZ2h0KSArIFwicHhcIjtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMudmVydC5zdHlsZS5kaXNwbGF5ID0gXCJcIjtcbiAgICAgICAgdGhpcy52ZXJ0LmZpcnN0Q2hpbGQuc3R5bGUuaGVpZ2h0ID0gXCIwXCI7XG4gICAgICB9XG5cbiAgICAgIGlmIChuZWVkc0gpIHtcbiAgICAgICAgdGhpcy5ob3Jpei5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xuICAgICAgICB0aGlzLmhvcml6LnN0eWxlLnJpZ2h0ID0gbmVlZHNWID8gc1dpZHRoICsgXCJweFwiIDogXCIwXCI7XG4gICAgICAgIHRoaXMuaG9yaXouc3R5bGUubGVmdCA9IG1lYXN1cmUuYmFyTGVmdCArIFwicHhcIjtcbiAgICAgICAgdmFyIHRvdGFsV2lkdGggPSBtZWFzdXJlLnZpZXdXaWR0aCAtIG1lYXN1cmUuYmFyTGVmdCAtIChuZWVkc1YgPyBzV2lkdGggOiAwKTtcbiAgICAgICAgdGhpcy5ob3Jpei5maXJzdENoaWxkLnN0eWxlLndpZHRoID1cbiAgICAgICAgICAobWVhc3VyZS5zY3JvbGxXaWR0aCAtIG1lYXN1cmUuY2xpZW50V2lkdGggKyB0b3RhbFdpZHRoKSArIFwicHhcIjtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuaG9yaXouc3R5bGUuZGlzcGxheSA9IFwiXCI7XG4gICAgICAgIHRoaXMuaG9yaXouZmlyc3RDaGlsZC5zdHlsZS53aWR0aCA9IFwiMFwiO1xuICAgICAgfVxuXG4gICAgICBpZiAoIXRoaXMuY2hlY2tlZFplcm9XaWR0aCAmJiBtZWFzdXJlLmNsaWVudEhlaWdodCA+IDApIHtcbiAgICAgICAgaWYgKHNXaWR0aCA9PSAwKSB0aGlzLnplcm9XaWR0aEhhY2soKTtcbiAgICAgICAgdGhpcy5jaGVja2VkWmVyb1dpZHRoID0gdHJ1ZTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHtyaWdodDogbmVlZHNWID8gc1dpZHRoIDogMCwgYm90dG9tOiBuZWVkc0ggPyBzV2lkdGggOiAwfTtcbiAgICB9LFxuICAgIHNldFNjcm9sbExlZnQ6IGZ1bmN0aW9uKHBvcykge1xuICAgICAgaWYgKHRoaXMuaG9yaXouc2Nyb2xsTGVmdCAhPSBwb3MpIHRoaXMuaG9yaXouc2Nyb2xsTGVmdCA9IHBvcztcbiAgICAgIGlmICh0aGlzLmRpc2FibGVIb3JpeikgdGhpcy5lbmFibGVaZXJvV2lkdGhCYXIodGhpcy5ob3JpeiwgdGhpcy5kaXNhYmxlSG9yaXopO1xuICAgIH0sXG4gICAgc2V0U2Nyb2xsVG9wOiBmdW5jdGlvbihwb3MpIHtcbiAgICAgIGlmICh0aGlzLnZlcnQuc2Nyb2xsVG9wICE9IHBvcykgdGhpcy52ZXJ0LnNjcm9sbFRvcCA9IHBvcztcbiAgICAgIGlmICh0aGlzLmRpc2FibGVWZXJ0KSB0aGlzLmVuYWJsZVplcm9XaWR0aEJhcih0aGlzLnZlcnQsIHRoaXMuZGlzYWJsZVZlcnQpO1xuICAgIH0sXG4gICAgemVyb1dpZHRoSGFjazogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgdyA9IG1hYyAmJiAhbWFjX2dlTW91bnRhaW5MaW9uID8gXCIxMnB4XCIgOiBcIjE4cHhcIjtcbiAgICAgIHRoaXMuaG9yaXouc3R5bGUuaGVpZ2h0ID0gdGhpcy52ZXJ0LnN0eWxlLndpZHRoID0gdztcbiAgICAgIHRoaXMuaG9yaXouc3R5bGUucG9pbnRlckV2ZW50cyA9IHRoaXMudmVydC5zdHlsZS5wb2ludGVyRXZlbnRzID0gXCJub25lXCI7XG4gICAgICB0aGlzLmRpc2FibGVIb3JpeiA9IG5ldyBEZWxheWVkO1xuICAgICAgdGhpcy5kaXNhYmxlVmVydCA9IG5ldyBEZWxheWVkO1xuICAgIH0sXG4gICAgZW5hYmxlWmVyb1dpZHRoQmFyOiBmdW5jdGlvbihiYXIsIGRlbGF5KSB7XG4gICAgICBiYXIuc3R5bGUucG9pbnRlckV2ZW50cyA9IFwiYXV0b1wiO1xuICAgICAgZnVuY3Rpb24gbWF5YmVEaXNhYmxlKCkge1xuICAgICAgICAvLyBUbyBmaW5kIG91dCB3aGV0aGVyIHRoZSBzY3JvbGxiYXIgaXMgc3RpbGwgdmlzaWJsZSwgd2VcbiAgICAgICAgLy8gY2hlY2sgd2hldGhlciB0aGUgZWxlbWVudCB1bmRlciB0aGUgcGl4ZWwgaW4gdGhlIGJvdHRvbVxuICAgICAgICAvLyBsZWZ0IGNvcm5lciBvZiB0aGUgc2Nyb2xsYmFyIGJveCBpcyB0aGUgc2Nyb2xsYmFyIGJveFxuICAgICAgICAvLyBpdHNlbGYgKHdoZW4gdGhlIGJhciBpcyBzdGlsbCB2aXNpYmxlKSBvciBpdHMgZmlsbGVyIGNoaWxkXG4gICAgICAgIC8vICh3aGVuIHRoZSBiYXIgaXMgaGlkZGVuKS4gSWYgaXQgaXMgc3RpbGwgdmlzaWJsZSwgd2Uga2VlcFxuICAgICAgICAvLyBpdCBlbmFibGVkLCBpZiBpdCdzIGhpZGRlbiwgd2UgZGlzYWJsZSBwb2ludGVyIGV2ZW50cy5cbiAgICAgICAgdmFyIGJveCA9IGJhci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgICAgdmFyIGVsdCA9IGRvY3VtZW50LmVsZW1lbnRGcm9tUG9pbnQoYm94LmxlZnQgKyAxLCBib3guYm90dG9tIC0gMSk7XG4gICAgICAgIGlmIChlbHQgIT0gYmFyKSBiYXIuc3R5bGUucG9pbnRlckV2ZW50cyA9IFwibm9uZVwiO1xuICAgICAgICBlbHNlIGRlbGF5LnNldCgxMDAwLCBtYXliZURpc2FibGUpO1xuICAgICAgfVxuICAgICAgZGVsYXkuc2V0KDEwMDAsIG1heWJlRGlzYWJsZSk7XG4gICAgfSxcbiAgICBjbGVhcjogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgcGFyZW50ID0gdGhpcy5ob3Jpei5wYXJlbnROb2RlO1xuICAgICAgcGFyZW50LnJlbW92ZUNoaWxkKHRoaXMuaG9yaXopO1xuICAgICAgcGFyZW50LnJlbW92ZUNoaWxkKHRoaXMudmVydCk7XG4gICAgfVxuICB9LCBOYXRpdmVTY3JvbGxiYXJzLnByb3RvdHlwZSk7XG5cbiAgZnVuY3Rpb24gTnVsbFNjcm9sbGJhcnMoKSB7fVxuXG4gIE51bGxTY3JvbGxiYXJzLnByb3RvdHlwZSA9IGNvcHlPYmooe1xuICAgIHVwZGF0ZTogZnVuY3Rpb24oKSB7IHJldHVybiB7Ym90dG9tOiAwLCByaWdodDogMH07IH0sXG4gICAgc2V0U2Nyb2xsTGVmdDogZnVuY3Rpb24oKSB7fSxcbiAgICBzZXRTY3JvbGxUb3A6IGZ1bmN0aW9uKCkge30sXG4gICAgY2xlYXI6IGZ1bmN0aW9uKCkge31cbiAgfSwgTnVsbFNjcm9sbGJhcnMucHJvdG90eXBlKTtcblxuICBDb2RlTWlycm9yLnNjcm9sbGJhck1vZGVsID0ge1wibmF0aXZlXCI6IE5hdGl2ZVNjcm9sbGJhcnMsIFwibnVsbFwiOiBOdWxsU2Nyb2xsYmFyc307XG5cbiAgZnVuY3Rpb24gaW5pdFNjcm9sbGJhcnMoY20pIHtcbiAgICBpZiAoY20uZGlzcGxheS5zY3JvbGxiYXJzKSB7XG4gICAgICBjbS5kaXNwbGF5LnNjcm9sbGJhcnMuY2xlYXIoKTtcbiAgICAgIGlmIChjbS5kaXNwbGF5LnNjcm9sbGJhcnMuYWRkQ2xhc3MpXG4gICAgICAgIHJtQ2xhc3MoY20uZGlzcGxheS53cmFwcGVyLCBjbS5kaXNwbGF5LnNjcm9sbGJhcnMuYWRkQ2xhc3MpO1xuICAgIH1cblxuICAgIGNtLmRpc3BsYXkuc2Nyb2xsYmFycyA9IG5ldyBDb2RlTWlycm9yLnNjcm9sbGJhck1vZGVsW2NtLm9wdGlvbnMuc2Nyb2xsYmFyU3R5bGVdKGZ1bmN0aW9uKG5vZGUpIHtcbiAgICAgIGNtLmRpc3BsYXkud3JhcHBlci5pbnNlcnRCZWZvcmUobm9kZSwgY20uZGlzcGxheS5zY3JvbGxiYXJGaWxsZXIpO1xuICAgICAgLy8gUHJldmVudCBjbGlja3MgaW4gdGhlIHNjcm9sbGJhcnMgZnJvbSBraWxsaW5nIGZvY3VzXG4gICAgICBvbihub2RlLCBcIm1vdXNlZG93blwiLCBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKGNtLnN0YXRlLmZvY3VzZWQpIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7IGNtLmRpc3BsYXkuaW5wdXQuZm9jdXMoKTsgfSwgMCk7XG4gICAgICB9KTtcbiAgICAgIG5vZGUuc2V0QXR0cmlidXRlKFwiY20tbm90LWNvbnRlbnRcIiwgXCJ0cnVlXCIpO1xuICAgIH0sIGZ1bmN0aW9uKHBvcywgYXhpcykge1xuICAgICAgaWYgKGF4aXMgPT0gXCJob3Jpem9udGFsXCIpIHNldFNjcm9sbExlZnQoY20sIHBvcyk7XG4gICAgICBlbHNlIHNldFNjcm9sbFRvcChjbSwgcG9zKTtcbiAgICB9LCBjbSk7XG4gICAgaWYgKGNtLmRpc3BsYXkuc2Nyb2xsYmFycy5hZGRDbGFzcylcbiAgICAgIGFkZENsYXNzKGNtLmRpc3BsYXkud3JhcHBlciwgY20uZGlzcGxheS5zY3JvbGxiYXJzLmFkZENsYXNzKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHVwZGF0ZVNjcm9sbGJhcnMoY20sIG1lYXN1cmUpIHtcbiAgICBpZiAoIW1lYXN1cmUpIG1lYXN1cmUgPSBtZWFzdXJlRm9yU2Nyb2xsYmFycyhjbSk7XG4gICAgdmFyIHN0YXJ0V2lkdGggPSBjbS5kaXNwbGF5LmJhcldpZHRoLCBzdGFydEhlaWdodCA9IGNtLmRpc3BsYXkuYmFySGVpZ2h0O1xuICAgIHVwZGF0ZVNjcm9sbGJhcnNJbm5lcihjbSwgbWVhc3VyZSk7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCA0ICYmIHN0YXJ0V2lkdGggIT0gY20uZGlzcGxheS5iYXJXaWR0aCB8fCBzdGFydEhlaWdodCAhPSBjbS5kaXNwbGF5LmJhckhlaWdodDsgaSsrKSB7XG4gICAgICBpZiAoc3RhcnRXaWR0aCAhPSBjbS5kaXNwbGF5LmJhcldpZHRoICYmIGNtLm9wdGlvbnMubGluZVdyYXBwaW5nKVxuICAgICAgICB1cGRhdGVIZWlnaHRzSW5WaWV3cG9ydChjbSk7XG4gICAgICB1cGRhdGVTY3JvbGxiYXJzSW5uZXIoY20sIG1lYXN1cmVGb3JTY3JvbGxiYXJzKGNtKSk7XG4gICAgICBzdGFydFdpZHRoID0gY20uZGlzcGxheS5iYXJXaWR0aDsgc3RhcnRIZWlnaHQgPSBjbS5kaXNwbGF5LmJhckhlaWdodDtcbiAgICB9XG4gIH1cblxuICAvLyBSZS1zeW5jaHJvbml6ZSB0aGUgZmFrZSBzY3JvbGxiYXJzIHdpdGggdGhlIGFjdHVhbCBzaXplIG9mIHRoZVxuICAvLyBjb250ZW50LlxuICBmdW5jdGlvbiB1cGRhdGVTY3JvbGxiYXJzSW5uZXIoY20sIG1lYXN1cmUpIHtcbiAgICB2YXIgZCA9IGNtLmRpc3BsYXk7XG4gICAgdmFyIHNpemVzID0gZC5zY3JvbGxiYXJzLnVwZGF0ZShtZWFzdXJlKTtcblxuICAgIGQuc2l6ZXIuc3R5bGUucGFkZGluZ1JpZ2h0ID0gKGQuYmFyV2lkdGggPSBzaXplcy5yaWdodCkgKyBcInB4XCI7XG4gICAgZC5zaXplci5zdHlsZS5wYWRkaW5nQm90dG9tID0gKGQuYmFySGVpZ2h0ID0gc2l6ZXMuYm90dG9tKSArIFwicHhcIjtcblxuICAgIGlmIChzaXplcy5yaWdodCAmJiBzaXplcy5ib3R0b20pIHtcbiAgICAgIGQuc2Nyb2xsYmFyRmlsbGVyLnN0eWxlLmRpc3BsYXkgPSBcImJsb2NrXCI7XG4gICAgICBkLnNjcm9sbGJhckZpbGxlci5zdHlsZS5oZWlnaHQgPSBzaXplcy5ib3R0b20gKyBcInB4XCI7XG4gICAgICBkLnNjcm9sbGJhckZpbGxlci5zdHlsZS53aWR0aCA9IHNpemVzLnJpZ2h0ICsgXCJweFwiO1xuICAgIH0gZWxzZSBkLnNjcm9sbGJhckZpbGxlci5zdHlsZS5kaXNwbGF5ID0gXCJcIjtcbiAgICBpZiAoc2l6ZXMuYm90dG9tICYmIGNtLm9wdGlvbnMuY292ZXJHdXR0ZXJOZXh0VG9TY3JvbGxiYXIgJiYgY20ub3B0aW9ucy5maXhlZEd1dHRlcikge1xuICAgICAgZC5ndXR0ZXJGaWxsZXIuc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIjtcbiAgICAgIGQuZ3V0dGVyRmlsbGVyLnN0eWxlLmhlaWdodCA9IHNpemVzLmJvdHRvbSArIFwicHhcIjtcbiAgICAgIGQuZ3V0dGVyRmlsbGVyLnN0eWxlLndpZHRoID0gbWVhc3VyZS5ndXR0ZXJXaWR0aCArIFwicHhcIjtcbiAgICB9IGVsc2UgZC5ndXR0ZXJGaWxsZXIuc3R5bGUuZGlzcGxheSA9IFwiXCI7XG4gIH1cblxuICAvLyBDb21wdXRlIHRoZSBsaW5lcyB0aGF0IGFyZSB2aXNpYmxlIGluIGEgZ2l2ZW4gdmlld3BvcnQgKGRlZmF1bHRzXG4gIC8vIHRoZSB0aGUgY3VycmVudCBzY3JvbGwgcG9zaXRpb24pLiB2aWV3cG9ydCBtYXkgY29udGFpbiB0b3AsXG4gIC8vIGhlaWdodCwgYW5kIGVuc3VyZSAoc2VlIG9wLnNjcm9sbFRvUG9zKSBwcm9wZXJ0aWVzLlxuICBmdW5jdGlvbiB2aXNpYmxlTGluZXMoZGlzcGxheSwgZG9jLCB2aWV3cG9ydCkge1xuICAgIHZhciB0b3AgPSB2aWV3cG9ydCAmJiB2aWV3cG9ydC50b3AgIT0gbnVsbCA/IE1hdGgubWF4KDAsIHZpZXdwb3J0LnRvcCkgOiBkaXNwbGF5LnNjcm9sbGVyLnNjcm9sbFRvcDtcbiAgICB0b3AgPSBNYXRoLmZsb29yKHRvcCAtIHBhZGRpbmdUb3AoZGlzcGxheSkpO1xuICAgIHZhciBib3R0b20gPSB2aWV3cG9ydCAmJiB2aWV3cG9ydC5ib3R0b20gIT0gbnVsbCA/IHZpZXdwb3J0LmJvdHRvbSA6IHRvcCArIGRpc3BsYXkud3JhcHBlci5jbGllbnRIZWlnaHQ7XG5cbiAgICB2YXIgZnJvbSA9IGxpbmVBdEhlaWdodChkb2MsIHRvcCksIHRvID0gbGluZUF0SGVpZ2h0KGRvYywgYm90dG9tKTtcbiAgICAvLyBFbnN1cmUgaXMgYSB7ZnJvbToge2xpbmUsIGNofSwgdG86IHtsaW5lLCBjaH19IG9iamVjdCwgYW5kXG4gICAgLy8gZm9yY2VzIHRob3NlIGxpbmVzIGludG8gdGhlIHZpZXdwb3J0IChpZiBwb3NzaWJsZSkuXG4gICAgaWYgKHZpZXdwb3J0ICYmIHZpZXdwb3J0LmVuc3VyZSkge1xuICAgICAgdmFyIGVuc3VyZUZyb20gPSB2aWV3cG9ydC5lbnN1cmUuZnJvbS5saW5lLCBlbnN1cmVUbyA9IHZpZXdwb3J0LmVuc3VyZS50by5saW5lO1xuICAgICAgaWYgKGVuc3VyZUZyb20gPCBmcm9tKSB7XG4gICAgICAgIGZyb20gPSBlbnN1cmVGcm9tO1xuICAgICAgICB0byA9IGxpbmVBdEhlaWdodChkb2MsIGhlaWdodEF0TGluZShnZXRMaW5lKGRvYywgZW5zdXJlRnJvbSkpICsgZGlzcGxheS53cmFwcGVyLmNsaWVudEhlaWdodCk7XG4gICAgICB9IGVsc2UgaWYgKE1hdGgubWluKGVuc3VyZVRvLCBkb2MubGFzdExpbmUoKSkgPj0gdG8pIHtcbiAgICAgICAgZnJvbSA9IGxpbmVBdEhlaWdodChkb2MsIGhlaWdodEF0TGluZShnZXRMaW5lKGRvYywgZW5zdXJlVG8pKSAtIGRpc3BsYXkud3JhcHBlci5jbGllbnRIZWlnaHQpO1xuICAgICAgICB0byA9IGVuc3VyZVRvO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4ge2Zyb206IGZyb20sIHRvOiBNYXRoLm1heCh0bywgZnJvbSArIDEpfTtcbiAgfVxuXG4gIC8vIExJTkUgTlVNQkVSU1xuXG4gIC8vIFJlLWFsaWduIGxpbmUgbnVtYmVycyBhbmQgZ3V0dGVyIG1hcmtzIHRvIGNvbXBlbnNhdGUgZm9yXG4gIC8vIGhvcml6b250YWwgc2Nyb2xsaW5nLlxuICBmdW5jdGlvbiBhbGlnbkhvcml6b250YWxseShjbSkge1xuICAgIHZhciBkaXNwbGF5ID0gY20uZGlzcGxheSwgdmlldyA9IGRpc3BsYXkudmlldztcbiAgICBpZiAoIWRpc3BsYXkuYWxpZ25XaWRnZXRzICYmICghZGlzcGxheS5ndXR0ZXJzLmZpcnN0Q2hpbGQgfHwgIWNtLm9wdGlvbnMuZml4ZWRHdXR0ZXIpKSByZXR1cm47XG4gICAgdmFyIGNvbXAgPSBjb21wZW5zYXRlRm9ySFNjcm9sbChkaXNwbGF5KSAtIGRpc3BsYXkuc2Nyb2xsZXIuc2Nyb2xsTGVmdCArIGNtLmRvYy5zY3JvbGxMZWZ0O1xuICAgIHZhciBndXR0ZXJXID0gZGlzcGxheS5ndXR0ZXJzLm9mZnNldFdpZHRoLCBsZWZ0ID0gY29tcCArIFwicHhcIjtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHZpZXcubGVuZ3RoOyBpKyspIGlmICghdmlld1tpXS5oaWRkZW4pIHtcbiAgICAgIGlmIChjbS5vcHRpb25zLmZpeGVkR3V0dGVyICYmIHZpZXdbaV0uZ3V0dGVyKVxuICAgICAgICB2aWV3W2ldLmd1dHRlci5zdHlsZS5sZWZ0ID0gbGVmdDtcbiAgICAgIHZhciBhbGlnbiA9IHZpZXdbaV0uYWxpZ25hYmxlO1xuICAgICAgaWYgKGFsaWduKSBmb3IgKHZhciBqID0gMDsgaiA8IGFsaWduLmxlbmd0aDsgaisrKVxuICAgICAgICBhbGlnbltqXS5zdHlsZS5sZWZ0ID0gbGVmdDtcbiAgICB9XG4gICAgaWYgKGNtLm9wdGlvbnMuZml4ZWRHdXR0ZXIpXG4gICAgICBkaXNwbGF5Lmd1dHRlcnMuc3R5bGUubGVmdCA9IChjb21wICsgZ3V0dGVyVykgKyBcInB4XCI7XG4gIH1cblxuICAvLyBVc2VkIHRvIGVuc3VyZSB0aGF0IHRoZSBsaW5lIG51bWJlciBndXR0ZXIgaXMgc3RpbGwgdGhlIHJpZ2h0XG4gIC8vIHNpemUgZm9yIHRoZSBjdXJyZW50IGRvY3VtZW50IHNpemUuIFJldHVybnMgdHJ1ZSB3aGVuIGFuIHVwZGF0ZVxuICAvLyBpcyBuZWVkZWQuXG4gIGZ1bmN0aW9uIG1heWJlVXBkYXRlTGluZU51bWJlcldpZHRoKGNtKSB7XG4gICAgaWYgKCFjbS5vcHRpb25zLmxpbmVOdW1iZXJzKSByZXR1cm4gZmFsc2U7XG4gICAgdmFyIGRvYyA9IGNtLmRvYywgbGFzdCA9IGxpbmVOdW1iZXJGb3IoY20ub3B0aW9ucywgZG9jLmZpcnN0ICsgZG9jLnNpemUgLSAxKSwgZGlzcGxheSA9IGNtLmRpc3BsYXk7XG4gICAgaWYgKGxhc3QubGVuZ3RoICE9IGRpc3BsYXkubGluZU51bUNoYXJzKSB7XG4gICAgICB2YXIgdGVzdCA9IGRpc3BsYXkubWVhc3VyZS5hcHBlbmRDaGlsZChlbHQoXCJkaXZcIiwgW2VsdChcImRpdlwiLCBsYXN0KV0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJDb2RlTWlycm9yLWxpbmVudW1iZXIgQ29kZU1pcnJvci1ndXR0ZXItZWx0XCIpKTtcbiAgICAgIHZhciBpbm5lclcgPSB0ZXN0LmZpcnN0Q2hpbGQub2Zmc2V0V2lkdGgsIHBhZGRpbmcgPSB0ZXN0Lm9mZnNldFdpZHRoIC0gaW5uZXJXO1xuICAgICAgZGlzcGxheS5saW5lR3V0dGVyLnN0eWxlLndpZHRoID0gXCJcIjtcbiAgICAgIGRpc3BsYXkubGluZU51bUlubmVyV2lkdGggPSBNYXRoLm1heChpbm5lclcsIGRpc3BsYXkubGluZUd1dHRlci5vZmZzZXRXaWR0aCAtIHBhZGRpbmcpICsgMTtcbiAgICAgIGRpc3BsYXkubGluZU51bVdpZHRoID0gZGlzcGxheS5saW5lTnVtSW5uZXJXaWR0aCArIHBhZGRpbmc7XG4gICAgICBkaXNwbGF5LmxpbmVOdW1DaGFycyA9IGRpc3BsYXkubGluZU51bUlubmVyV2lkdGggPyBsYXN0Lmxlbmd0aCA6IC0xO1xuICAgICAgZGlzcGxheS5saW5lR3V0dGVyLnN0eWxlLndpZHRoID0gZGlzcGxheS5saW5lTnVtV2lkdGggKyBcInB4XCI7XG4gICAgICB1cGRhdGVHdXR0ZXJTcGFjZShjbSk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgZnVuY3Rpb24gbGluZU51bWJlckZvcihvcHRpb25zLCBpKSB7XG4gICAgcmV0dXJuIFN0cmluZyhvcHRpb25zLmxpbmVOdW1iZXJGb3JtYXR0ZXIoaSArIG9wdGlvbnMuZmlyc3RMaW5lTnVtYmVyKSk7XG4gIH1cblxuICAvLyBDb21wdXRlcyBkaXNwbGF5LnNjcm9sbGVyLnNjcm9sbExlZnQgKyBkaXNwbGF5Lmd1dHRlcnMub2Zmc2V0V2lkdGgsXG4gIC8vIGJ1dCB1c2luZyBnZXRCb3VuZGluZ0NsaWVudFJlY3QgdG8gZ2V0IGEgc3ViLXBpeGVsLWFjY3VyYXRlXG4gIC8vIHJlc3VsdC5cbiAgZnVuY3Rpb24gY29tcGVuc2F0ZUZvckhTY3JvbGwoZGlzcGxheSkge1xuICAgIHJldHVybiBkaXNwbGF5LnNjcm9sbGVyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmxlZnQgLSBkaXNwbGF5LnNpemVyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmxlZnQ7XG4gIH1cblxuICAvLyBESVNQTEFZIERSQVdJTkdcblxuICBmdW5jdGlvbiBEaXNwbGF5VXBkYXRlKGNtLCB2aWV3cG9ydCwgZm9yY2UpIHtcbiAgICB2YXIgZGlzcGxheSA9IGNtLmRpc3BsYXk7XG5cbiAgICB0aGlzLnZpZXdwb3J0ID0gdmlld3BvcnQ7XG4gICAgLy8gU3RvcmUgc29tZSB2YWx1ZXMgdGhhdCB3ZSdsbCBuZWVkIGxhdGVyIChidXQgZG9uJ3Qgd2FudCB0byBmb3JjZSBhIHJlbGF5b3V0IGZvcilcbiAgICB0aGlzLnZpc2libGUgPSB2aXNpYmxlTGluZXMoZGlzcGxheSwgY20uZG9jLCB2aWV3cG9ydCk7XG4gICAgdGhpcy5lZGl0b3JJc0hpZGRlbiA9ICFkaXNwbGF5LndyYXBwZXIub2Zmc2V0V2lkdGg7XG4gICAgdGhpcy53cmFwcGVySGVpZ2h0ID0gZGlzcGxheS53cmFwcGVyLmNsaWVudEhlaWdodDtcbiAgICB0aGlzLndyYXBwZXJXaWR0aCA9IGRpc3BsYXkud3JhcHBlci5jbGllbnRXaWR0aDtcbiAgICB0aGlzLm9sZERpc3BsYXlXaWR0aCA9IGRpc3BsYXlXaWR0aChjbSk7XG4gICAgdGhpcy5mb3JjZSA9IGZvcmNlO1xuICAgIHRoaXMuZGltcyA9IGdldERpbWVuc2lvbnMoY20pO1xuICAgIHRoaXMuZXZlbnRzID0gW107XG4gIH1cblxuICBEaXNwbGF5VXBkYXRlLnByb3RvdHlwZS5zaWduYWwgPSBmdW5jdGlvbihlbWl0dGVyLCB0eXBlKSB7XG4gICAgaWYgKGhhc0hhbmRsZXIoZW1pdHRlciwgdHlwZSkpXG4gICAgICB0aGlzLmV2ZW50cy5wdXNoKGFyZ3VtZW50cyk7XG4gIH07XG4gIERpc3BsYXlVcGRhdGUucHJvdG90eXBlLmZpbmlzaCA9IGZ1bmN0aW9uKCkge1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5ldmVudHMubGVuZ3RoOyBpKyspXG4gICAgICBzaWduYWwuYXBwbHkobnVsbCwgdGhpcy5ldmVudHNbaV0pO1xuICB9O1xuXG4gIGZ1bmN0aW9uIG1heWJlQ2xpcFNjcm9sbGJhcnMoY20pIHtcbiAgICB2YXIgZGlzcGxheSA9IGNtLmRpc3BsYXk7XG4gICAgaWYgKCFkaXNwbGF5LnNjcm9sbGJhcnNDbGlwcGVkICYmIGRpc3BsYXkuc2Nyb2xsZXIub2Zmc2V0V2lkdGgpIHtcbiAgICAgIGRpc3BsYXkubmF0aXZlQmFyV2lkdGggPSBkaXNwbGF5LnNjcm9sbGVyLm9mZnNldFdpZHRoIC0gZGlzcGxheS5zY3JvbGxlci5jbGllbnRXaWR0aDtcbiAgICAgIGRpc3BsYXkuaGVpZ2h0Rm9yY2VyLnN0eWxlLmhlaWdodCA9IHNjcm9sbEdhcChjbSkgKyBcInB4XCI7XG4gICAgICBkaXNwbGF5LnNpemVyLnN0eWxlLm1hcmdpbkJvdHRvbSA9IC1kaXNwbGF5Lm5hdGl2ZUJhcldpZHRoICsgXCJweFwiO1xuICAgICAgZGlzcGxheS5zaXplci5zdHlsZS5ib3JkZXJSaWdodFdpZHRoID0gc2Nyb2xsR2FwKGNtKSArIFwicHhcIjtcbiAgICAgIGRpc3BsYXkuc2Nyb2xsYmFyc0NsaXBwZWQgPSB0cnVlO1xuICAgIH1cbiAgfVxuXG4gIC8vIERvZXMgdGhlIGFjdHVhbCB1cGRhdGluZyBvZiB0aGUgbGluZSBkaXNwbGF5LiBCYWlscyBvdXRcbiAgLy8gKHJldHVybmluZyBmYWxzZSkgd2hlbiB0aGVyZSBpcyBub3RoaW5nIHRvIGJlIGRvbmUgYW5kIGZvcmNlZCBpc1xuICAvLyBmYWxzZS5cbiAgZnVuY3Rpb24gdXBkYXRlRGlzcGxheUlmTmVlZGVkKGNtLCB1cGRhdGUpIHtcbiAgICB2YXIgZGlzcGxheSA9IGNtLmRpc3BsYXksIGRvYyA9IGNtLmRvYztcblxuICAgIGlmICh1cGRhdGUuZWRpdG9ySXNIaWRkZW4pIHtcbiAgICAgIHJlc2V0VmlldyhjbSk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgLy8gQmFpbCBvdXQgaWYgdGhlIHZpc2libGUgYXJlYSBpcyBhbHJlYWR5IHJlbmRlcmVkIGFuZCBub3RoaW5nIGNoYW5nZWQuXG4gICAgaWYgKCF1cGRhdGUuZm9yY2UgJiZcbiAgICAgICAgdXBkYXRlLnZpc2libGUuZnJvbSA+PSBkaXNwbGF5LnZpZXdGcm9tICYmIHVwZGF0ZS52aXNpYmxlLnRvIDw9IGRpc3BsYXkudmlld1RvICYmXG4gICAgICAgIChkaXNwbGF5LnVwZGF0ZUxpbmVOdW1iZXJzID09IG51bGwgfHwgZGlzcGxheS51cGRhdGVMaW5lTnVtYmVycyA+PSBkaXNwbGF5LnZpZXdUbykgJiZcbiAgICAgICAgZGlzcGxheS5yZW5kZXJlZFZpZXcgPT0gZGlzcGxheS52aWV3ICYmIGNvdW50RGlydHlWaWV3KGNtKSA9PSAwKVxuICAgICAgcmV0dXJuIGZhbHNlO1xuXG4gICAgaWYgKG1heWJlVXBkYXRlTGluZU51bWJlcldpZHRoKGNtKSkge1xuICAgICAgcmVzZXRWaWV3KGNtKTtcbiAgICAgIHVwZGF0ZS5kaW1zID0gZ2V0RGltZW5zaW9ucyhjbSk7XG4gICAgfVxuXG4gICAgLy8gQ29tcHV0ZSBhIHN1aXRhYmxlIG5ldyB2aWV3cG9ydCAoZnJvbSAmIHRvKVxuICAgIHZhciBlbmQgPSBkb2MuZmlyc3QgKyBkb2Muc2l6ZTtcbiAgICB2YXIgZnJvbSA9IE1hdGgubWF4KHVwZGF0ZS52aXNpYmxlLmZyb20gLSBjbS5vcHRpb25zLnZpZXdwb3J0TWFyZ2luLCBkb2MuZmlyc3QpO1xuICAgIHZhciB0byA9IE1hdGgubWluKGVuZCwgdXBkYXRlLnZpc2libGUudG8gKyBjbS5vcHRpb25zLnZpZXdwb3J0TWFyZ2luKTtcbiAgICBpZiAoZGlzcGxheS52aWV3RnJvbSA8IGZyb20gJiYgZnJvbSAtIGRpc3BsYXkudmlld0Zyb20gPCAyMCkgZnJvbSA9IE1hdGgubWF4KGRvYy5maXJzdCwgZGlzcGxheS52aWV3RnJvbSk7XG4gICAgaWYgKGRpc3BsYXkudmlld1RvID4gdG8gJiYgZGlzcGxheS52aWV3VG8gLSB0byA8IDIwKSB0byA9IE1hdGgubWluKGVuZCwgZGlzcGxheS52aWV3VG8pO1xuICAgIGlmIChzYXdDb2xsYXBzZWRTcGFucykge1xuICAgICAgZnJvbSA9IHZpc3VhbExpbmVObyhjbS5kb2MsIGZyb20pO1xuICAgICAgdG8gPSB2aXN1YWxMaW5lRW5kTm8oY20uZG9jLCB0byk7XG4gICAgfVxuXG4gICAgdmFyIGRpZmZlcmVudCA9IGZyb20gIT0gZGlzcGxheS52aWV3RnJvbSB8fCB0byAhPSBkaXNwbGF5LnZpZXdUbyB8fFxuICAgICAgZGlzcGxheS5sYXN0V3JhcEhlaWdodCAhPSB1cGRhdGUud3JhcHBlckhlaWdodCB8fCBkaXNwbGF5Lmxhc3RXcmFwV2lkdGggIT0gdXBkYXRlLndyYXBwZXJXaWR0aDtcbiAgICBhZGp1c3RWaWV3KGNtLCBmcm9tLCB0byk7XG5cbiAgICBkaXNwbGF5LnZpZXdPZmZzZXQgPSBoZWlnaHRBdExpbmUoZ2V0TGluZShjbS5kb2MsIGRpc3BsYXkudmlld0Zyb20pKTtcbiAgICAvLyBQb3NpdGlvbiB0aGUgbW92ZXIgZGl2IHRvIGFsaWduIHdpdGggdGhlIGN1cnJlbnQgc2Nyb2xsIHBvc2l0aW9uXG4gICAgY20uZGlzcGxheS5tb3Zlci5zdHlsZS50b3AgPSBkaXNwbGF5LnZpZXdPZmZzZXQgKyBcInB4XCI7XG5cbiAgICB2YXIgdG9VcGRhdGUgPSBjb3VudERpcnR5VmlldyhjbSk7XG4gICAgaWYgKCFkaWZmZXJlbnQgJiYgdG9VcGRhdGUgPT0gMCAmJiAhdXBkYXRlLmZvcmNlICYmIGRpc3BsYXkucmVuZGVyZWRWaWV3ID09IGRpc3BsYXkudmlldyAmJlxuICAgICAgICAoZGlzcGxheS51cGRhdGVMaW5lTnVtYmVycyA9PSBudWxsIHx8IGRpc3BsYXkudXBkYXRlTGluZU51bWJlcnMgPj0gZGlzcGxheS52aWV3VG8pKVxuICAgICAgcmV0dXJuIGZhbHNlO1xuXG4gICAgLy8gRm9yIGJpZyBjaGFuZ2VzLCB3ZSBoaWRlIHRoZSBlbmNsb3NpbmcgZWxlbWVudCBkdXJpbmcgdGhlXG4gICAgLy8gdXBkYXRlLCBzaW5jZSB0aGF0IHNwZWVkcyB1cCB0aGUgb3BlcmF0aW9ucyBvbiBtb3N0IGJyb3dzZXJzLlxuICAgIHZhciBmb2N1c2VkID0gYWN0aXZlRWx0KCk7XG4gICAgaWYgKHRvVXBkYXRlID4gNCkgZGlzcGxheS5saW5lRGl2LnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICBwYXRjaERpc3BsYXkoY20sIGRpc3BsYXkudXBkYXRlTGluZU51bWJlcnMsIHVwZGF0ZS5kaW1zKTtcbiAgICBpZiAodG9VcGRhdGUgPiA0KSBkaXNwbGF5LmxpbmVEaXYuc3R5bGUuZGlzcGxheSA9IFwiXCI7XG4gICAgZGlzcGxheS5yZW5kZXJlZFZpZXcgPSBkaXNwbGF5LnZpZXc7XG4gICAgLy8gVGhlcmUgbWlnaHQgaGF2ZSBiZWVuIGEgd2lkZ2V0IHdpdGggYSBmb2N1c2VkIGVsZW1lbnQgdGhhdCBnb3RcbiAgICAvLyBoaWRkZW4gb3IgdXBkYXRlZCwgaWYgc28gcmUtZm9jdXMgaXQuXG4gICAgaWYgKGZvY3VzZWQgJiYgYWN0aXZlRWx0KCkgIT0gZm9jdXNlZCAmJiBmb2N1c2VkLm9mZnNldEhlaWdodCkgZm9jdXNlZC5mb2N1cygpO1xuXG4gICAgLy8gUHJldmVudCBzZWxlY3Rpb24gYW5kIGN1cnNvcnMgZnJvbSBpbnRlcmZlcmluZyB3aXRoIHRoZSBzY3JvbGxcbiAgICAvLyB3aWR0aCBhbmQgaGVpZ2h0LlxuICAgIHJlbW92ZUNoaWxkcmVuKGRpc3BsYXkuY3Vyc29yRGl2KTtcbiAgICByZW1vdmVDaGlsZHJlbihkaXNwbGF5LnNlbGVjdGlvbkRpdik7XG4gICAgZGlzcGxheS5ndXR0ZXJzLnN0eWxlLmhlaWdodCA9IGRpc3BsYXkuc2l6ZXIuc3R5bGUubWluSGVpZ2h0ID0gMDtcblxuICAgIGlmIChkaWZmZXJlbnQpIHtcbiAgICAgIGRpc3BsYXkubGFzdFdyYXBIZWlnaHQgPSB1cGRhdGUud3JhcHBlckhlaWdodDtcbiAgICAgIGRpc3BsYXkubGFzdFdyYXBXaWR0aCA9IHVwZGF0ZS53cmFwcGVyV2lkdGg7XG4gICAgICBzdGFydFdvcmtlcihjbSwgNDAwKTtcbiAgICB9XG5cbiAgICBkaXNwbGF5LnVwZGF0ZUxpbmVOdW1iZXJzID0gbnVsbDtcblxuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgZnVuY3Rpb24gcG9zdFVwZGF0ZURpc3BsYXkoY20sIHVwZGF0ZSkge1xuICAgIHZhciB2aWV3cG9ydCA9IHVwZGF0ZS52aWV3cG9ydDtcbiAgICBmb3IgKHZhciBmaXJzdCA9IHRydWU7OyBmaXJzdCA9IGZhbHNlKSB7XG4gICAgICBpZiAoIWZpcnN0IHx8ICFjbS5vcHRpb25zLmxpbmVXcmFwcGluZyB8fCB1cGRhdGUub2xkRGlzcGxheVdpZHRoID09IGRpc3BsYXlXaWR0aChjbSkpIHtcbiAgICAgICAgLy8gQ2xpcCBmb3JjZWQgdmlld3BvcnQgdG8gYWN0dWFsIHNjcm9sbGFibGUgYXJlYS5cbiAgICAgICAgaWYgKHZpZXdwb3J0ICYmIHZpZXdwb3J0LnRvcCAhPSBudWxsKVxuICAgICAgICAgIHZpZXdwb3J0ID0ge3RvcDogTWF0aC5taW4oY20uZG9jLmhlaWdodCArIHBhZGRpbmdWZXJ0KGNtLmRpc3BsYXkpIC0gZGlzcGxheUhlaWdodChjbSksIHZpZXdwb3J0LnRvcCl9O1xuICAgICAgICAvLyBVcGRhdGVkIGxpbmUgaGVpZ2h0cyBtaWdodCByZXN1bHQgaW4gdGhlIGRyYXduIGFyZWEgbm90XG4gICAgICAgIC8vIGFjdHVhbGx5IGNvdmVyaW5nIHRoZSB2aWV3cG9ydC4gS2VlcCBsb29waW5nIHVudGlsIGl0IGRvZXMuXG4gICAgICAgIHVwZGF0ZS52aXNpYmxlID0gdmlzaWJsZUxpbmVzKGNtLmRpc3BsYXksIGNtLmRvYywgdmlld3BvcnQpO1xuICAgICAgICBpZiAodXBkYXRlLnZpc2libGUuZnJvbSA+PSBjbS5kaXNwbGF5LnZpZXdGcm9tICYmIHVwZGF0ZS52aXNpYmxlLnRvIDw9IGNtLmRpc3BsYXkudmlld1RvKVxuICAgICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgaWYgKCF1cGRhdGVEaXNwbGF5SWZOZWVkZWQoY20sIHVwZGF0ZSkpIGJyZWFrO1xuICAgICAgdXBkYXRlSGVpZ2h0c0luVmlld3BvcnQoY20pO1xuICAgICAgdmFyIGJhck1lYXN1cmUgPSBtZWFzdXJlRm9yU2Nyb2xsYmFycyhjbSk7XG4gICAgICB1cGRhdGVTZWxlY3Rpb24oY20pO1xuICAgICAgc2V0RG9jdW1lbnRIZWlnaHQoY20sIGJhck1lYXN1cmUpO1xuICAgICAgdXBkYXRlU2Nyb2xsYmFycyhjbSwgYmFyTWVhc3VyZSk7XG4gICAgfVxuXG4gICAgdXBkYXRlLnNpZ25hbChjbSwgXCJ1cGRhdGVcIiwgY20pO1xuICAgIGlmIChjbS5kaXNwbGF5LnZpZXdGcm9tICE9IGNtLmRpc3BsYXkucmVwb3J0ZWRWaWV3RnJvbSB8fCBjbS5kaXNwbGF5LnZpZXdUbyAhPSBjbS5kaXNwbGF5LnJlcG9ydGVkVmlld1RvKSB7XG4gICAgICB1cGRhdGUuc2lnbmFsKGNtLCBcInZpZXdwb3J0Q2hhbmdlXCIsIGNtLCBjbS5kaXNwbGF5LnZpZXdGcm9tLCBjbS5kaXNwbGF5LnZpZXdUbyk7XG4gICAgICBjbS5kaXNwbGF5LnJlcG9ydGVkVmlld0Zyb20gPSBjbS5kaXNwbGF5LnZpZXdGcm9tOyBjbS5kaXNwbGF5LnJlcG9ydGVkVmlld1RvID0gY20uZGlzcGxheS52aWV3VG87XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gdXBkYXRlRGlzcGxheVNpbXBsZShjbSwgdmlld3BvcnQpIHtcbiAgICB2YXIgdXBkYXRlID0gbmV3IERpc3BsYXlVcGRhdGUoY20sIHZpZXdwb3J0KTtcbiAgICBpZiAodXBkYXRlRGlzcGxheUlmTmVlZGVkKGNtLCB1cGRhdGUpKSB7XG4gICAgICB1cGRhdGVIZWlnaHRzSW5WaWV3cG9ydChjbSk7XG4gICAgICBwb3N0VXBkYXRlRGlzcGxheShjbSwgdXBkYXRlKTtcbiAgICAgIHZhciBiYXJNZWFzdXJlID0gbWVhc3VyZUZvclNjcm9sbGJhcnMoY20pO1xuICAgICAgdXBkYXRlU2VsZWN0aW9uKGNtKTtcbiAgICAgIHNldERvY3VtZW50SGVpZ2h0KGNtLCBiYXJNZWFzdXJlKTtcbiAgICAgIHVwZGF0ZVNjcm9sbGJhcnMoY20sIGJhck1lYXN1cmUpO1xuICAgICAgdXBkYXRlLmZpbmlzaCgpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIHNldERvY3VtZW50SGVpZ2h0KGNtLCBtZWFzdXJlKSB7XG4gICAgY20uZGlzcGxheS5zaXplci5zdHlsZS5taW5IZWlnaHQgPSBtZWFzdXJlLmRvY0hlaWdodCArIFwicHhcIjtcbiAgICB2YXIgdG90YWwgPSBtZWFzdXJlLmRvY0hlaWdodCArIGNtLmRpc3BsYXkuYmFySGVpZ2h0O1xuICAgIGNtLmRpc3BsYXkuaGVpZ2h0Rm9yY2VyLnN0eWxlLnRvcCA9IHRvdGFsICsgXCJweFwiO1xuICAgIGNtLmRpc3BsYXkuZ3V0dGVycy5zdHlsZS5oZWlnaHQgPSBNYXRoLm1heCh0b3RhbCArIHNjcm9sbEdhcChjbSksIG1lYXN1cmUuY2xpZW50SGVpZ2h0KSArIFwicHhcIjtcbiAgfVxuXG4gIC8vIFJlYWQgdGhlIGFjdHVhbCBoZWlnaHRzIG9mIHRoZSByZW5kZXJlZCBsaW5lcywgYW5kIHVwZGF0ZSB0aGVpclxuICAvLyBzdG9yZWQgaGVpZ2h0cyB0byBtYXRjaC5cbiAgZnVuY3Rpb24gdXBkYXRlSGVpZ2h0c0luVmlld3BvcnQoY20pIHtcbiAgICB2YXIgZGlzcGxheSA9IGNtLmRpc3BsYXk7XG4gICAgdmFyIHByZXZCb3R0b20gPSBkaXNwbGF5LmxpbmVEaXYub2Zmc2V0VG9wO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZGlzcGxheS52aWV3Lmxlbmd0aDsgaSsrKSB7XG4gICAgICB2YXIgY3VyID0gZGlzcGxheS52aWV3W2ldLCBoZWlnaHQ7XG4gICAgICBpZiAoY3VyLmhpZGRlbikgY29udGludWU7XG4gICAgICBpZiAoaWUgJiYgaWVfdmVyc2lvbiA8IDgpIHtcbiAgICAgICAgdmFyIGJvdCA9IGN1ci5ub2RlLm9mZnNldFRvcCArIGN1ci5ub2RlLm9mZnNldEhlaWdodDtcbiAgICAgICAgaGVpZ2h0ID0gYm90IC0gcHJldkJvdHRvbTtcbiAgICAgICAgcHJldkJvdHRvbSA9IGJvdDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciBib3ggPSBjdXIubm9kZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgICAgaGVpZ2h0ID0gYm94LmJvdHRvbSAtIGJveC50b3A7XG4gICAgICB9XG4gICAgICB2YXIgZGlmZiA9IGN1ci5saW5lLmhlaWdodCAtIGhlaWdodDtcbiAgICAgIGlmIChoZWlnaHQgPCAyKSBoZWlnaHQgPSB0ZXh0SGVpZ2h0KGRpc3BsYXkpO1xuICAgICAgaWYgKGRpZmYgPiAuMDAxIHx8IGRpZmYgPCAtLjAwMSkge1xuICAgICAgICB1cGRhdGVMaW5lSGVpZ2h0KGN1ci5saW5lLCBoZWlnaHQpO1xuICAgICAgICB1cGRhdGVXaWRnZXRIZWlnaHQoY3VyLmxpbmUpO1xuICAgICAgICBpZiAoY3VyLnJlc3QpIGZvciAodmFyIGogPSAwOyBqIDwgY3VyLnJlc3QubGVuZ3RoOyBqKyspXG4gICAgICAgICAgdXBkYXRlV2lkZ2V0SGVpZ2h0KGN1ci5yZXN0W2pdKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvLyBSZWFkIGFuZCBzdG9yZSB0aGUgaGVpZ2h0IG9mIGxpbmUgd2lkZ2V0cyBhc3NvY2lhdGVkIHdpdGggdGhlXG4gIC8vIGdpdmVuIGxpbmUuXG4gIGZ1bmN0aW9uIHVwZGF0ZVdpZGdldEhlaWdodChsaW5lKSB7XG4gICAgaWYgKGxpbmUud2lkZ2V0cykgZm9yICh2YXIgaSA9IDA7IGkgPCBsaW5lLndpZGdldHMubGVuZ3RoOyArK2kpXG4gICAgICBsaW5lLndpZGdldHNbaV0uaGVpZ2h0ID0gbGluZS53aWRnZXRzW2ldLm5vZGUucGFyZW50Tm9kZS5vZmZzZXRIZWlnaHQ7XG4gIH1cblxuICAvLyBEbyBhIGJ1bGstcmVhZCBvZiB0aGUgRE9NIHBvc2l0aW9ucyBhbmQgc2l6ZXMgbmVlZGVkIHRvIGRyYXcgdGhlXG4gIC8vIHZpZXcsIHNvIHRoYXQgd2UgZG9uJ3QgaW50ZXJsZWF2ZSByZWFkaW5nIGFuZCB3cml0aW5nIHRvIHRoZSBET00uXG4gIGZ1bmN0aW9uIGdldERpbWVuc2lvbnMoY20pIHtcbiAgICB2YXIgZCA9IGNtLmRpc3BsYXksIGxlZnQgPSB7fSwgd2lkdGggPSB7fTtcbiAgICB2YXIgZ3V0dGVyTGVmdCA9IGQuZ3V0dGVycy5jbGllbnRMZWZ0O1xuICAgIGZvciAodmFyIG4gPSBkLmd1dHRlcnMuZmlyc3RDaGlsZCwgaSA9IDA7IG47IG4gPSBuLm5leHRTaWJsaW5nLCArK2kpIHtcbiAgICAgIGxlZnRbY20ub3B0aW9ucy5ndXR0ZXJzW2ldXSA9IG4ub2Zmc2V0TGVmdCArIG4uY2xpZW50TGVmdCArIGd1dHRlckxlZnQ7XG4gICAgICB3aWR0aFtjbS5vcHRpb25zLmd1dHRlcnNbaV1dID0gbi5jbGllbnRXaWR0aDtcbiAgICB9XG4gICAgcmV0dXJuIHtmaXhlZFBvczogY29tcGVuc2F0ZUZvckhTY3JvbGwoZCksXG4gICAgICAgICAgICBndXR0ZXJUb3RhbFdpZHRoOiBkLmd1dHRlcnMub2Zmc2V0V2lkdGgsXG4gICAgICAgICAgICBndXR0ZXJMZWZ0OiBsZWZ0LFxuICAgICAgICAgICAgZ3V0dGVyV2lkdGg6IHdpZHRoLFxuICAgICAgICAgICAgd3JhcHBlcldpZHRoOiBkLndyYXBwZXIuY2xpZW50V2lkdGh9O1xuICB9XG5cbiAgLy8gU3luYyB0aGUgYWN0dWFsIGRpc3BsYXkgRE9NIHN0cnVjdHVyZSB3aXRoIGRpc3BsYXkudmlldywgcmVtb3ZpbmdcbiAgLy8gbm9kZXMgZm9yIGxpbmVzIHRoYXQgYXJlIG5vIGxvbmdlciBpbiB2aWV3LCBhbmQgY3JlYXRpbmcgdGhlIG9uZXNcbiAgLy8gdGhhdCBhcmUgbm90IHRoZXJlIHlldCwgYW5kIHVwZGF0aW5nIHRoZSBvbmVzIHRoYXQgYXJlIG91dCBvZlxuICAvLyBkYXRlLlxuICBmdW5jdGlvbiBwYXRjaERpc3BsYXkoY20sIHVwZGF0ZU51bWJlcnNGcm9tLCBkaW1zKSB7XG4gICAgdmFyIGRpc3BsYXkgPSBjbS5kaXNwbGF5LCBsaW5lTnVtYmVycyA9IGNtLm9wdGlvbnMubGluZU51bWJlcnM7XG4gICAgdmFyIGNvbnRhaW5lciA9IGRpc3BsYXkubGluZURpdiwgY3VyID0gY29udGFpbmVyLmZpcnN0Q2hpbGQ7XG5cbiAgICBmdW5jdGlvbiBybShub2RlKSB7XG4gICAgICB2YXIgbmV4dCA9IG5vZGUubmV4dFNpYmxpbmc7XG4gICAgICAvLyBXb3JrcyBhcm91bmQgYSB0aHJvdy1zY3JvbGwgYnVnIGluIE9TIFggV2Via2l0XG4gICAgICBpZiAod2Via2l0ICYmIG1hYyAmJiBjbS5kaXNwbGF5LmN1cnJlbnRXaGVlbFRhcmdldCA9PSBub2RlKVxuICAgICAgICBub2RlLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICAgIGVsc2VcbiAgICAgICAgbm9kZS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKG5vZGUpO1xuICAgICAgcmV0dXJuIG5leHQ7XG4gICAgfVxuXG4gICAgdmFyIHZpZXcgPSBkaXNwbGF5LnZpZXcsIGxpbmVOID0gZGlzcGxheS52aWV3RnJvbTtcbiAgICAvLyBMb29wIG92ZXIgdGhlIGVsZW1lbnRzIGluIHRoZSB2aWV3LCBzeW5jaW5nIGN1ciAodGhlIERPTSBub2Rlc1xuICAgIC8vIGluIGRpc3BsYXkubGluZURpdikgd2l0aCB0aGUgdmlldyBhcyB3ZSBnby5cbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHZpZXcubGVuZ3RoOyBpKyspIHtcbiAgICAgIHZhciBsaW5lVmlldyA9IHZpZXdbaV07XG4gICAgICBpZiAobGluZVZpZXcuaGlkZGVuKSB7XG4gICAgICB9IGVsc2UgaWYgKCFsaW5lVmlldy5ub2RlIHx8IGxpbmVWaWV3Lm5vZGUucGFyZW50Tm9kZSAhPSBjb250YWluZXIpIHsgLy8gTm90IGRyYXduIHlldFxuICAgICAgICB2YXIgbm9kZSA9IGJ1aWxkTGluZUVsZW1lbnQoY20sIGxpbmVWaWV3LCBsaW5lTiwgZGltcyk7XG4gICAgICAgIGNvbnRhaW5lci5pbnNlcnRCZWZvcmUobm9kZSwgY3VyKTtcbiAgICAgIH0gZWxzZSB7IC8vIEFscmVhZHkgZHJhd25cbiAgICAgICAgd2hpbGUgKGN1ciAhPSBsaW5lVmlldy5ub2RlKSBjdXIgPSBybShjdXIpO1xuICAgICAgICB2YXIgdXBkYXRlTnVtYmVyID0gbGluZU51bWJlcnMgJiYgdXBkYXRlTnVtYmVyc0Zyb20gIT0gbnVsbCAmJlxuICAgICAgICAgIHVwZGF0ZU51bWJlcnNGcm9tIDw9IGxpbmVOICYmIGxpbmVWaWV3LmxpbmVOdW1iZXI7XG4gICAgICAgIGlmIChsaW5lVmlldy5jaGFuZ2VzKSB7XG4gICAgICAgICAgaWYgKGluZGV4T2YobGluZVZpZXcuY2hhbmdlcywgXCJndXR0ZXJcIikgPiAtMSkgdXBkYXRlTnVtYmVyID0gZmFsc2U7XG4gICAgICAgICAgdXBkYXRlTGluZUZvckNoYW5nZXMoY20sIGxpbmVWaWV3LCBsaW5lTiwgZGltcyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHVwZGF0ZU51bWJlcikge1xuICAgICAgICAgIHJlbW92ZUNoaWxkcmVuKGxpbmVWaWV3LmxpbmVOdW1iZXIpO1xuICAgICAgICAgIGxpbmVWaWV3LmxpbmVOdW1iZXIuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUobGluZU51bWJlckZvcihjbS5vcHRpb25zLCBsaW5lTikpKTtcbiAgICAgICAgfVxuICAgICAgICBjdXIgPSBsaW5lVmlldy5ub2RlLm5leHRTaWJsaW5nO1xuICAgICAgfVxuICAgICAgbGluZU4gKz0gbGluZVZpZXcuc2l6ZTtcbiAgICB9XG4gICAgd2hpbGUgKGN1cikgY3VyID0gcm0oY3VyKTtcbiAgfVxuXG4gIC8vIFdoZW4gYW4gYXNwZWN0IG9mIGEgbGluZSBjaGFuZ2VzLCBhIHN0cmluZyBpcyBhZGRlZCB0b1xuICAvLyBsaW5lVmlldy5jaGFuZ2VzLiBUaGlzIHVwZGF0ZXMgdGhlIHJlbGV2YW50IHBhcnQgb2YgdGhlIGxpbmUnc1xuICAvLyBET00gc3RydWN0dXJlLlxuICBmdW5jdGlvbiB1cGRhdGVMaW5lRm9yQ2hhbmdlcyhjbSwgbGluZVZpZXcsIGxpbmVOLCBkaW1zKSB7XG4gICAgZm9yICh2YXIgaiA9IDA7IGogPCBsaW5lVmlldy5jaGFuZ2VzLmxlbmd0aDsgaisrKSB7XG4gICAgICB2YXIgdHlwZSA9IGxpbmVWaWV3LmNoYW5nZXNbal07XG4gICAgICBpZiAodHlwZSA9PSBcInRleHRcIikgdXBkYXRlTGluZVRleHQoY20sIGxpbmVWaWV3KTtcbiAgICAgIGVsc2UgaWYgKHR5cGUgPT0gXCJndXR0ZXJcIikgdXBkYXRlTGluZUd1dHRlcihjbSwgbGluZVZpZXcsIGxpbmVOLCBkaW1zKTtcbiAgICAgIGVsc2UgaWYgKHR5cGUgPT0gXCJjbGFzc1wiKSB1cGRhdGVMaW5lQ2xhc3NlcyhsaW5lVmlldyk7XG4gICAgICBlbHNlIGlmICh0eXBlID09IFwid2lkZ2V0XCIpIHVwZGF0ZUxpbmVXaWRnZXRzKGNtLCBsaW5lVmlldywgZGltcyk7XG4gICAgfVxuICAgIGxpbmVWaWV3LmNoYW5nZXMgPSBudWxsO1xuICB9XG5cbiAgLy8gTGluZXMgd2l0aCBndXR0ZXIgZWxlbWVudHMsIHdpZGdldHMgb3IgYSBiYWNrZ3JvdW5kIGNsYXNzIG5lZWQgdG9cbiAgLy8gYmUgd3JhcHBlZCwgYW5kIGhhdmUgdGhlIGV4dHJhIGVsZW1lbnRzIGFkZGVkIHRvIHRoZSB3cmFwcGVyIGRpdlxuICBmdW5jdGlvbiBlbnN1cmVMaW5lV3JhcHBlZChsaW5lVmlldykge1xuICAgIGlmIChsaW5lVmlldy5ub2RlID09IGxpbmVWaWV3LnRleHQpIHtcbiAgICAgIGxpbmVWaWV3Lm5vZGUgPSBlbHQoXCJkaXZcIiwgbnVsbCwgbnVsbCwgXCJwb3NpdGlvbjogcmVsYXRpdmVcIik7XG4gICAgICBpZiAobGluZVZpZXcudGV4dC5wYXJlbnROb2RlKVxuICAgICAgICBsaW5lVmlldy50ZXh0LnBhcmVudE5vZGUucmVwbGFjZUNoaWxkKGxpbmVWaWV3Lm5vZGUsIGxpbmVWaWV3LnRleHQpO1xuICAgICAgbGluZVZpZXcubm9kZS5hcHBlbmRDaGlsZChsaW5lVmlldy50ZXh0KTtcbiAgICAgIGlmIChpZSAmJiBpZV92ZXJzaW9uIDwgOCkgbGluZVZpZXcubm9kZS5zdHlsZS56SW5kZXggPSAyO1xuICAgIH1cbiAgICByZXR1cm4gbGluZVZpZXcubm9kZTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHVwZGF0ZUxpbmVCYWNrZ3JvdW5kKGxpbmVWaWV3KSB7XG4gICAgdmFyIGNscyA9IGxpbmVWaWV3LmJnQ2xhc3MgPyBsaW5lVmlldy5iZ0NsYXNzICsgXCIgXCIgKyAobGluZVZpZXcubGluZS5iZ0NsYXNzIHx8IFwiXCIpIDogbGluZVZpZXcubGluZS5iZ0NsYXNzO1xuICAgIGlmIChjbHMpIGNscyArPSBcIiBDb2RlTWlycm9yLWxpbmViYWNrZ3JvdW5kXCI7XG4gICAgaWYgKGxpbmVWaWV3LmJhY2tncm91bmQpIHtcbiAgICAgIGlmIChjbHMpIGxpbmVWaWV3LmJhY2tncm91bmQuY2xhc3NOYW1lID0gY2xzO1xuICAgICAgZWxzZSB7IGxpbmVWaWV3LmJhY2tncm91bmQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChsaW5lVmlldy5iYWNrZ3JvdW5kKTsgbGluZVZpZXcuYmFja2dyb3VuZCA9IG51bGw7IH1cbiAgICB9IGVsc2UgaWYgKGNscykge1xuICAgICAgdmFyIHdyYXAgPSBlbnN1cmVMaW5lV3JhcHBlZChsaW5lVmlldyk7XG4gICAgICBsaW5lVmlldy5iYWNrZ3JvdW5kID0gd3JhcC5pbnNlcnRCZWZvcmUoZWx0KFwiZGl2XCIsIG51bGwsIGNscyksIHdyYXAuZmlyc3RDaGlsZCk7XG4gICAgfVxuICB9XG5cbiAgLy8gV3JhcHBlciBhcm91bmQgYnVpbGRMaW5lQ29udGVudCB3aGljaCB3aWxsIHJldXNlIHRoZSBzdHJ1Y3R1cmVcbiAgLy8gaW4gZGlzcGxheS5leHRlcm5hbE1lYXN1cmVkIHdoZW4gcG9zc2libGUuXG4gIGZ1bmN0aW9uIGdldExpbmVDb250ZW50KGNtLCBsaW5lVmlldykge1xuICAgIHZhciBleHQgPSBjbS5kaXNwbGF5LmV4dGVybmFsTWVhc3VyZWQ7XG4gICAgaWYgKGV4dCAmJiBleHQubGluZSA9PSBsaW5lVmlldy5saW5lKSB7XG4gICAgICBjbS5kaXNwbGF5LmV4dGVybmFsTWVhc3VyZWQgPSBudWxsO1xuICAgICAgbGluZVZpZXcubWVhc3VyZSA9IGV4dC5tZWFzdXJlO1xuICAgICAgcmV0dXJuIGV4dC5idWlsdDtcbiAgICB9XG4gICAgcmV0dXJuIGJ1aWxkTGluZUNvbnRlbnQoY20sIGxpbmVWaWV3KTtcbiAgfVxuXG4gIC8vIFJlZHJhdyB0aGUgbGluZSdzIHRleHQuIEludGVyYWN0cyB3aXRoIHRoZSBiYWNrZ3JvdW5kIGFuZCB0ZXh0XG4gIC8vIGNsYXNzZXMgYmVjYXVzZSB0aGUgbW9kZSBtYXkgb3V0cHV0IHRva2VucyB0aGF0IGluZmx1ZW5jZSB0aGVzZVxuICAvLyBjbGFzc2VzLlxuICBmdW5jdGlvbiB1cGRhdGVMaW5lVGV4dChjbSwgbGluZVZpZXcpIHtcbiAgICB2YXIgY2xzID0gbGluZVZpZXcudGV4dC5jbGFzc05hbWU7XG4gICAgdmFyIGJ1aWx0ID0gZ2V0TGluZUNvbnRlbnQoY20sIGxpbmVWaWV3KTtcbiAgICBpZiAobGluZVZpZXcudGV4dCA9PSBsaW5lVmlldy5ub2RlKSBsaW5lVmlldy5ub2RlID0gYnVpbHQucHJlO1xuICAgIGxpbmVWaWV3LnRleHQucGFyZW50Tm9kZS5yZXBsYWNlQ2hpbGQoYnVpbHQucHJlLCBsaW5lVmlldy50ZXh0KTtcbiAgICBsaW5lVmlldy50ZXh0ID0gYnVpbHQucHJlO1xuICAgIGlmIChidWlsdC5iZ0NsYXNzICE9IGxpbmVWaWV3LmJnQ2xhc3MgfHwgYnVpbHQudGV4dENsYXNzICE9IGxpbmVWaWV3LnRleHRDbGFzcykge1xuICAgICAgbGluZVZpZXcuYmdDbGFzcyA9IGJ1aWx0LmJnQ2xhc3M7XG4gICAgICBsaW5lVmlldy50ZXh0Q2xhc3MgPSBidWlsdC50ZXh0Q2xhc3M7XG4gICAgICB1cGRhdGVMaW5lQ2xhc3NlcyhsaW5lVmlldyk7XG4gICAgfSBlbHNlIGlmIChjbHMpIHtcbiAgICAgIGxpbmVWaWV3LnRleHQuY2xhc3NOYW1lID0gY2xzO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIHVwZGF0ZUxpbmVDbGFzc2VzKGxpbmVWaWV3KSB7XG4gICAgdXBkYXRlTGluZUJhY2tncm91bmQobGluZVZpZXcpO1xuICAgIGlmIChsaW5lVmlldy5saW5lLndyYXBDbGFzcylcbiAgICAgIGVuc3VyZUxpbmVXcmFwcGVkKGxpbmVWaWV3KS5jbGFzc05hbWUgPSBsaW5lVmlldy5saW5lLndyYXBDbGFzcztcbiAgICBlbHNlIGlmIChsaW5lVmlldy5ub2RlICE9IGxpbmVWaWV3LnRleHQpXG4gICAgICBsaW5lVmlldy5ub2RlLmNsYXNzTmFtZSA9IFwiXCI7XG4gICAgdmFyIHRleHRDbGFzcyA9IGxpbmVWaWV3LnRleHRDbGFzcyA/IGxpbmVWaWV3LnRleHRDbGFzcyArIFwiIFwiICsgKGxpbmVWaWV3LmxpbmUudGV4dENsYXNzIHx8IFwiXCIpIDogbGluZVZpZXcubGluZS50ZXh0Q2xhc3M7XG4gICAgbGluZVZpZXcudGV4dC5jbGFzc05hbWUgPSB0ZXh0Q2xhc3MgfHwgXCJcIjtcbiAgfVxuXG4gIGZ1bmN0aW9uIHVwZGF0ZUxpbmVHdXR0ZXIoY20sIGxpbmVWaWV3LCBsaW5lTiwgZGltcykge1xuICAgIGlmIChsaW5lVmlldy5ndXR0ZXIpIHtcbiAgICAgIGxpbmVWaWV3Lm5vZGUucmVtb3ZlQ2hpbGQobGluZVZpZXcuZ3V0dGVyKTtcbiAgICAgIGxpbmVWaWV3Lmd1dHRlciA9IG51bGw7XG4gICAgfVxuICAgIGlmIChsaW5lVmlldy5ndXR0ZXJCYWNrZ3JvdW5kKSB7XG4gICAgICBsaW5lVmlldy5ub2RlLnJlbW92ZUNoaWxkKGxpbmVWaWV3Lmd1dHRlckJhY2tncm91bmQpO1xuICAgICAgbGluZVZpZXcuZ3V0dGVyQmFja2dyb3VuZCA9IG51bGw7XG4gICAgfVxuICAgIGlmIChsaW5lVmlldy5saW5lLmd1dHRlckNsYXNzKSB7XG4gICAgICB2YXIgd3JhcCA9IGVuc3VyZUxpbmVXcmFwcGVkKGxpbmVWaWV3KTtcbiAgICAgIGxpbmVWaWV3Lmd1dHRlckJhY2tncm91bmQgPSBlbHQoXCJkaXZcIiwgbnVsbCwgXCJDb2RlTWlycm9yLWd1dHRlci1iYWNrZ3JvdW5kIFwiICsgbGluZVZpZXcubGluZS5ndXR0ZXJDbGFzcyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJsZWZ0OiBcIiArIChjbS5vcHRpb25zLmZpeGVkR3V0dGVyID8gZGltcy5maXhlZFBvcyA6IC1kaW1zLmd1dHRlclRvdGFsV2lkdGgpICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJweDsgd2lkdGg6IFwiICsgZGltcy5ndXR0ZXJUb3RhbFdpZHRoICsgXCJweFwiKTtcbiAgICAgIHdyYXAuaW5zZXJ0QmVmb3JlKGxpbmVWaWV3Lmd1dHRlckJhY2tncm91bmQsIGxpbmVWaWV3LnRleHQpO1xuICAgIH1cbiAgICB2YXIgbWFya2VycyA9IGxpbmVWaWV3LmxpbmUuZ3V0dGVyTWFya2VycztcbiAgICBpZiAoY20ub3B0aW9ucy5saW5lTnVtYmVycyB8fCBtYXJrZXJzKSB7XG4gICAgICB2YXIgd3JhcCA9IGVuc3VyZUxpbmVXcmFwcGVkKGxpbmVWaWV3KTtcbiAgICAgIHZhciBndXR0ZXJXcmFwID0gbGluZVZpZXcuZ3V0dGVyID0gZWx0KFwiZGl2XCIsIG51bGwsIFwiQ29kZU1pcnJvci1ndXR0ZXItd3JhcHBlclwiLCBcImxlZnQ6IFwiICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChjbS5vcHRpb25zLmZpeGVkR3V0dGVyID8gZGltcy5maXhlZFBvcyA6IC1kaW1zLmd1dHRlclRvdGFsV2lkdGgpICsgXCJweFwiKTtcbiAgICAgIGNtLmRpc3BsYXkuaW5wdXQuc2V0VW5lZGl0YWJsZShndXR0ZXJXcmFwKTtcbiAgICAgIHdyYXAuaW5zZXJ0QmVmb3JlKGd1dHRlcldyYXAsIGxpbmVWaWV3LnRleHQpO1xuICAgICAgaWYgKGxpbmVWaWV3LmxpbmUuZ3V0dGVyQ2xhc3MpXG4gICAgICAgIGd1dHRlcldyYXAuY2xhc3NOYW1lICs9IFwiIFwiICsgbGluZVZpZXcubGluZS5ndXR0ZXJDbGFzcztcbiAgICAgIGlmIChjbS5vcHRpb25zLmxpbmVOdW1iZXJzICYmICghbWFya2VycyB8fCAhbWFya2Vyc1tcIkNvZGVNaXJyb3ItbGluZW51bWJlcnNcIl0pKVxuICAgICAgICBsaW5lVmlldy5saW5lTnVtYmVyID0gZ3V0dGVyV3JhcC5hcHBlbmRDaGlsZChcbiAgICAgICAgICBlbHQoXCJkaXZcIiwgbGluZU51bWJlckZvcihjbS5vcHRpb25zLCBsaW5lTiksXG4gICAgICAgICAgICAgIFwiQ29kZU1pcnJvci1saW5lbnVtYmVyIENvZGVNaXJyb3ItZ3V0dGVyLWVsdFwiLFxuICAgICAgICAgICAgICBcImxlZnQ6IFwiICsgZGltcy5ndXR0ZXJMZWZ0W1wiQ29kZU1pcnJvci1saW5lbnVtYmVyc1wiXSArIFwicHg7IHdpZHRoOiBcIlxuICAgICAgICAgICAgICArIGNtLmRpc3BsYXkubGluZU51bUlubmVyV2lkdGggKyBcInB4XCIpKTtcbiAgICAgIGlmIChtYXJrZXJzKSBmb3IgKHZhciBrID0gMDsgayA8IGNtLm9wdGlvbnMuZ3V0dGVycy5sZW5ndGg7ICsraykge1xuICAgICAgICB2YXIgaWQgPSBjbS5vcHRpb25zLmd1dHRlcnNba10sIGZvdW5kID0gbWFya2Vycy5oYXNPd25Qcm9wZXJ0eShpZCkgJiYgbWFya2Vyc1tpZF07XG4gICAgICAgIGlmIChmb3VuZClcbiAgICAgICAgICBndXR0ZXJXcmFwLmFwcGVuZENoaWxkKGVsdChcImRpdlwiLCBbZm91bmRdLCBcIkNvZGVNaXJyb3ItZ3V0dGVyLWVsdFwiLCBcImxlZnQ6IFwiICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaW1zLmd1dHRlckxlZnRbaWRdICsgXCJweDsgd2lkdGg6IFwiICsgZGltcy5ndXR0ZXJXaWR0aFtpZF0gKyBcInB4XCIpKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiB1cGRhdGVMaW5lV2lkZ2V0cyhjbSwgbGluZVZpZXcsIGRpbXMpIHtcbiAgICBpZiAobGluZVZpZXcuYWxpZ25hYmxlKSBsaW5lVmlldy5hbGlnbmFibGUgPSBudWxsO1xuICAgIGZvciAodmFyIG5vZGUgPSBsaW5lVmlldy5ub2RlLmZpcnN0Q2hpbGQsIG5leHQ7IG5vZGU7IG5vZGUgPSBuZXh0KSB7XG4gICAgICB2YXIgbmV4dCA9IG5vZGUubmV4dFNpYmxpbmc7XG4gICAgICBpZiAobm9kZS5jbGFzc05hbWUgPT0gXCJDb2RlTWlycm9yLWxpbmV3aWRnZXRcIilcbiAgICAgICAgbGluZVZpZXcubm9kZS5yZW1vdmVDaGlsZChub2RlKTtcbiAgICB9XG4gICAgaW5zZXJ0TGluZVdpZGdldHMoY20sIGxpbmVWaWV3LCBkaW1zKTtcbiAgfVxuXG4gIC8vIEJ1aWxkIGEgbGluZSdzIERPTSByZXByZXNlbnRhdGlvbiBmcm9tIHNjcmF0Y2hcbiAgZnVuY3Rpb24gYnVpbGRMaW5lRWxlbWVudChjbSwgbGluZVZpZXcsIGxpbmVOLCBkaW1zKSB7XG4gICAgdmFyIGJ1aWx0ID0gZ2V0TGluZUNvbnRlbnQoY20sIGxpbmVWaWV3KTtcbiAgICBsaW5lVmlldy50ZXh0ID0gbGluZVZpZXcubm9kZSA9IGJ1aWx0LnByZTtcbiAgICBpZiAoYnVpbHQuYmdDbGFzcykgbGluZVZpZXcuYmdDbGFzcyA9IGJ1aWx0LmJnQ2xhc3M7XG4gICAgaWYgKGJ1aWx0LnRleHRDbGFzcykgbGluZVZpZXcudGV4dENsYXNzID0gYnVpbHQudGV4dENsYXNzO1xuXG4gICAgdXBkYXRlTGluZUNsYXNzZXMobGluZVZpZXcpO1xuICAgIHVwZGF0ZUxpbmVHdXR0ZXIoY20sIGxpbmVWaWV3LCBsaW5lTiwgZGltcyk7XG4gICAgaW5zZXJ0TGluZVdpZGdldHMoY20sIGxpbmVWaWV3LCBkaW1zKTtcbiAgICByZXR1cm4gbGluZVZpZXcubm9kZTtcbiAgfVxuXG4gIC8vIEEgbGluZVZpZXcgbWF5IGNvbnRhaW4gbXVsdGlwbGUgbG9naWNhbCBsaW5lcyAod2hlbiBtZXJnZWQgYnlcbiAgLy8gY29sbGFwc2VkIHNwYW5zKS4gVGhlIHdpZGdldHMgZm9yIGFsbCBvZiB0aGVtIG5lZWQgdG8gYmUgZHJhd24uXG4gIGZ1bmN0aW9uIGluc2VydExpbmVXaWRnZXRzKGNtLCBsaW5lVmlldywgZGltcykge1xuICAgIGluc2VydExpbmVXaWRnZXRzRm9yKGNtLCBsaW5lVmlldy5saW5lLCBsaW5lVmlldywgZGltcywgdHJ1ZSk7XG4gICAgaWYgKGxpbmVWaWV3LnJlc3QpIGZvciAodmFyIGkgPSAwOyBpIDwgbGluZVZpZXcucmVzdC5sZW5ndGg7IGkrKylcbiAgICAgIGluc2VydExpbmVXaWRnZXRzRm9yKGNtLCBsaW5lVmlldy5yZXN0W2ldLCBsaW5lVmlldywgZGltcywgZmFsc2UpO1xuICB9XG5cbiAgZnVuY3Rpb24gaW5zZXJ0TGluZVdpZGdldHNGb3IoY20sIGxpbmUsIGxpbmVWaWV3LCBkaW1zLCBhbGxvd0Fib3ZlKSB7XG4gICAgaWYgKCFsaW5lLndpZGdldHMpIHJldHVybjtcbiAgICB2YXIgd3JhcCA9IGVuc3VyZUxpbmVXcmFwcGVkKGxpbmVWaWV3KTtcbiAgICBmb3IgKHZhciBpID0gMCwgd3MgPSBsaW5lLndpZGdldHM7IGkgPCB3cy5sZW5ndGg7ICsraSkge1xuICAgICAgdmFyIHdpZGdldCA9IHdzW2ldLCBub2RlID0gZWx0KFwiZGl2XCIsIFt3aWRnZXQubm9kZV0sIFwiQ29kZU1pcnJvci1saW5ld2lkZ2V0XCIpO1xuICAgICAgaWYgKCF3aWRnZXQuaGFuZGxlTW91c2VFdmVudHMpIG5vZGUuc2V0QXR0cmlidXRlKFwiY20taWdub3JlLWV2ZW50c1wiLCBcInRydWVcIik7XG4gICAgICBwb3NpdGlvbkxpbmVXaWRnZXQod2lkZ2V0LCBub2RlLCBsaW5lVmlldywgZGltcyk7XG4gICAgICBjbS5kaXNwbGF5LmlucHV0LnNldFVuZWRpdGFibGUobm9kZSk7XG4gICAgICBpZiAoYWxsb3dBYm92ZSAmJiB3aWRnZXQuYWJvdmUpXG4gICAgICAgIHdyYXAuaW5zZXJ0QmVmb3JlKG5vZGUsIGxpbmVWaWV3Lmd1dHRlciB8fCBsaW5lVmlldy50ZXh0KTtcbiAgICAgIGVsc2VcbiAgICAgICAgd3JhcC5hcHBlbmRDaGlsZChub2RlKTtcbiAgICAgIHNpZ25hbExhdGVyKHdpZGdldCwgXCJyZWRyYXdcIik7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gcG9zaXRpb25MaW5lV2lkZ2V0KHdpZGdldCwgbm9kZSwgbGluZVZpZXcsIGRpbXMpIHtcbiAgICBpZiAod2lkZ2V0Lm5vSFNjcm9sbCkge1xuICAgICAgKGxpbmVWaWV3LmFsaWduYWJsZSB8fCAobGluZVZpZXcuYWxpZ25hYmxlID0gW10pKS5wdXNoKG5vZGUpO1xuICAgICAgdmFyIHdpZHRoID0gZGltcy53cmFwcGVyV2lkdGg7XG4gICAgICBub2RlLnN0eWxlLmxlZnQgPSBkaW1zLmZpeGVkUG9zICsgXCJweFwiO1xuICAgICAgaWYgKCF3aWRnZXQuY292ZXJHdXR0ZXIpIHtcbiAgICAgICAgd2lkdGggLT0gZGltcy5ndXR0ZXJUb3RhbFdpZHRoO1xuICAgICAgICBub2RlLnN0eWxlLnBhZGRpbmdMZWZ0ID0gZGltcy5ndXR0ZXJUb3RhbFdpZHRoICsgXCJweFwiO1xuICAgICAgfVxuICAgICAgbm9kZS5zdHlsZS53aWR0aCA9IHdpZHRoICsgXCJweFwiO1xuICAgIH1cbiAgICBpZiAod2lkZ2V0LmNvdmVyR3V0dGVyKSB7XG4gICAgICBub2RlLnN0eWxlLnpJbmRleCA9IDU7XG4gICAgICBub2RlLnN0eWxlLnBvc2l0aW9uID0gXCJyZWxhdGl2ZVwiO1xuICAgICAgaWYgKCF3aWRnZXQubm9IU2Nyb2xsKSBub2RlLnN0eWxlLm1hcmdpbkxlZnQgPSAtZGltcy5ndXR0ZXJUb3RhbFdpZHRoICsgXCJweFwiO1xuICAgIH1cbiAgfVxuXG4gIC8vIFBPU0lUSU9OIE9CSkVDVFxuXG4gIC8vIEEgUG9zIGluc3RhbmNlIHJlcHJlc2VudHMgYSBwb3NpdGlvbiB3aXRoaW4gdGhlIHRleHQuXG4gIHZhciBQb3MgPSBDb2RlTWlycm9yLlBvcyA9IGZ1bmN0aW9uKGxpbmUsIGNoKSB7XG4gICAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIFBvcykpIHJldHVybiBuZXcgUG9zKGxpbmUsIGNoKTtcbiAgICB0aGlzLmxpbmUgPSBsaW5lOyB0aGlzLmNoID0gY2g7XG4gIH07XG5cbiAgLy8gQ29tcGFyZSB0d28gcG9zaXRpb25zLCByZXR1cm4gMCBpZiB0aGV5IGFyZSB0aGUgc2FtZSwgYSBuZWdhdGl2ZVxuICAvLyBudW1iZXIgd2hlbiBhIGlzIGxlc3MsIGFuZCBhIHBvc2l0aXZlIG51bWJlciBvdGhlcndpc2UuXG4gIHZhciBjbXAgPSBDb2RlTWlycm9yLmNtcFBvcyA9IGZ1bmN0aW9uKGEsIGIpIHsgcmV0dXJuIGEubGluZSAtIGIubGluZSB8fCBhLmNoIC0gYi5jaDsgfTtcblxuICBmdW5jdGlvbiBjb3B5UG9zKHgpIHtyZXR1cm4gUG9zKHgubGluZSwgeC5jaCk7fVxuICBmdW5jdGlvbiBtYXhQb3MoYSwgYikgeyByZXR1cm4gY21wKGEsIGIpIDwgMCA/IGIgOiBhOyB9XG4gIGZ1bmN0aW9uIG1pblBvcyhhLCBiKSB7IHJldHVybiBjbXAoYSwgYikgPCAwID8gYSA6IGI7IH1cblxuICAvLyBJTlBVVCBIQU5ETElOR1xuXG4gIGZ1bmN0aW9uIGVuc3VyZUZvY3VzKGNtKSB7XG4gICAgaWYgKCFjbS5zdGF0ZS5mb2N1c2VkKSB7IGNtLmRpc3BsYXkuaW5wdXQuZm9jdXMoKTsgb25Gb2N1cyhjbSk7IH1cbiAgfVxuXG4gIC8vIFRoaXMgd2lsbCBiZSBzZXQgdG8gYW4gYXJyYXkgb2Ygc3RyaW5ncyB3aGVuIGNvcHlpbmcsIHNvIHRoYXQsXG4gIC8vIHdoZW4gcGFzdGluZywgd2Uga25vdyB3aGF0IGtpbmQgb2Ygc2VsZWN0aW9ucyB0aGUgY29waWVkIHRleHRcbiAgLy8gd2FzIG1hZGUgb3V0IG9mLlxuICB2YXIgbGFzdENvcGllZCA9IG51bGw7XG5cbiAgZnVuY3Rpb24gYXBwbHlUZXh0SW5wdXQoY20sIGluc2VydGVkLCBkZWxldGVkLCBzZWwsIG9yaWdpbikge1xuICAgIHZhciBkb2MgPSBjbS5kb2M7XG4gICAgY20uZGlzcGxheS5zaGlmdCA9IGZhbHNlO1xuICAgIGlmICghc2VsKSBzZWwgPSBkb2Muc2VsO1xuXG4gICAgdmFyIHBhc3RlID0gY20uc3RhdGUucGFzdGVJbmNvbWluZyB8fCBvcmlnaW4gPT0gXCJwYXN0ZVwiO1xuICAgIHZhciB0ZXh0TGluZXMgPSBkb2Muc3BsaXRMaW5lcyhpbnNlcnRlZCksIG11bHRpUGFzdGUgPSBudWxsO1xuICAgIC8vIFdoZW4gcGFzaW5nIE4gbGluZXMgaW50byBOIHNlbGVjdGlvbnMsIGluc2VydCBvbmUgbGluZSBwZXIgc2VsZWN0aW9uXG4gICAgaWYgKHBhc3RlICYmIHNlbC5yYW5nZXMubGVuZ3RoID4gMSkge1xuICAgICAgaWYgKGxhc3RDb3BpZWQgJiYgbGFzdENvcGllZC5qb2luKFwiXFxuXCIpID09IGluc2VydGVkKSB7XG4gICAgICAgIGlmIChzZWwucmFuZ2VzLmxlbmd0aCAlIGxhc3RDb3BpZWQubGVuZ3RoID09IDApIHtcbiAgICAgICAgICBtdWx0aVBhc3RlID0gW107XG4gICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsYXN0Q29waWVkLmxlbmd0aDsgaSsrKVxuICAgICAgICAgICAgbXVsdGlQYXN0ZS5wdXNoKGRvYy5zcGxpdExpbmVzKGxhc3RDb3BpZWRbaV0pKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmICh0ZXh0TGluZXMubGVuZ3RoID09IHNlbC5yYW5nZXMubGVuZ3RoKSB7XG4gICAgICAgIG11bHRpUGFzdGUgPSBtYXAodGV4dExpbmVzLCBmdW5jdGlvbihsKSB7IHJldHVybiBbbF07IH0pO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIE5vcm1hbCBiZWhhdmlvciBpcyB0byBpbnNlcnQgdGhlIG5ldyB0ZXh0IGludG8gZXZlcnkgc2VsZWN0aW9uXG4gICAgZm9yICh2YXIgaSA9IHNlbC5yYW5nZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICAgIHZhciByYW5nZSA9IHNlbC5yYW5nZXNbaV07XG4gICAgICB2YXIgZnJvbSA9IHJhbmdlLmZyb20oKSwgdG8gPSByYW5nZS50bygpO1xuICAgICAgaWYgKHJhbmdlLmVtcHR5KCkpIHtcbiAgICAgICAgaWYgKGRlbGV0ZWQgJiYgZGVsZXRlZCA+IDApIC8vIEhhbmRsZSBkZWxldGlvblxuICAgICAgICAgIGZyb20gPSBQb3MoZnJvbS5saW5lLCBmcm9tLmNoIC0gZGVsZXRlZCk7XG4gICAgICAgIGVsc2UgaWYgKGNtLnN0YXRlLm92ZXJ3cml0ZSAmJiAhcGFzdGUpIC8vIEhhbmRsZSBvdmVyd3JpdGVcbiAgICAgICAgICB0byA9IFBvcyh0by5saW5lLCBNYXRoLm1pbihnZXRMaW5lKGRvYywgdG8ubGluZSkudGV4dC5sZW5ndGgsIHRvLmNoICsgbHN0KHRleHRMaW5lcykubGVuZ3RoKSk7XG4gICAgICB9XG4gICAgICB2YXIgdXBkYXRlSW5wdXQgPSBjbS5jdXJPcC51cGRhdGVJbnB1dDtcbiAgICAgIHZhciBjaGFuZ2VFdmVudCA9IHtmcm9tOiBmcm9tLCB0bzogdG8sIHRleHQ6IG11bHRpUGFzdGUgPyBtdWx0aVBhc3RlW2kgJSBtdWx0aVBhc3RlLmxlbmd0aF0gOiB0ZXh0TGluZXMsXG4gICAgICAgICAgICAgICAgICAgICAgICAgb3JpZ2luOiBvcmlnaW4gfHwgKHBhc3RlID8gXCJwYXN0ZVwiIDogY20uc3RhdGUuY3V0SW5jb21pbmcgPyBcImN1dFwiIDogXCIraW5wdXRcIil9O1xuICAgICAgbWFrZUNoYW5nZShjbS5kb2MsIGNoYW5nZUV2ZW50KTtcbiAgICAgIHNpZ25hbExhdGVyKGNtLCBcImlucHV0UmVhZFwiLCBjbSwgY2hhbmdlRXZlbnQpO1xuICAgIH1cbiAgICBpZiAoaW5zZXJ0ZWQgJiYgIXBhc3RlKVxuICAgICAgdHJpZ2dlckVsZWN0cmljKGNtLCBpbnNlcnRlZCk7XG5cbiAgICBlbnN1cmVDdXJzb3JWaXNpYmxlKGNtKTtcbiAgICBjbS5jdXJPcC51cGRhdGVJbnB1dCA9IHVwZGF0ZUlucHV0O1xuICAgIGNtLmN1ck9wLnR5cGluZyA9IHRydWU7XG4gICAgY20uc3RhdGUucGFzdGVJbmNvbWluZyA9IGNtLnN0YXRlLmN1dEluY29taW5nID0gZmFsc2U7XG4gIH1cblxuICBmdW5jdGlvbiBoYW5kbGVQYXN0ZShlLCBjbSkge1xuICAgIHZhciBwYXN0ZWQgPSBlLmNsaXBib2FyZERhdGEgJiYgZS5jbGlwYm9hcmREYXRhLmdldERhdGEoXCJ0ZXh0L3BsYWluXCIpO1xuICAgIGlmIChwYXN0ZWQpIHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIGlmICghY20uaXNSZWFkT25seSgpICYmICFjbS5vcHRpb25zLmRpc2FibGVJbnB1dClcbiAgICAgICAgcnVuSW5PcChjbSwgZnVuY3Rpb24oKSB7IGFwcGx5VGV4dElucHV0KGNtLCBwYXN0ZWQsIDAsIG51bGwsIFwicGFzdGVcIik7IH0pO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gdHJpZ2dlckVsZWN0cmljKGNtLCBpbnNlcnRlZCkge1xuICAgIC8vIFdoZW4gYW4gJ2VsZWN0cmljJyBjaGFyYWN0ZXIgaXMgaW5zZXJ0ZWQsIGltbWVkaWF0ZWx5IHRyaWdnZXIgYSByZWluZGVudFxuICAgIGlmICghY20ub3B0aW9ucy5lbGVjdHJpY0NoYXJzIHx8ICFjbS5vcHRpb25zLnNtYXJ0SW5kZW50KSByZXR1cm47XG4gICAgdmFyIHNlbCA9IGNtLmRvYy5zZWw7XG5cbiAgICBmb3IgKHZhciBpID0gc2VsLnJhbmdlcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgdmFyIHJhbmdlID0gc2VsLnJhbmdlc1tpXTtcbiAgICAgIGlmIChyYW5nZS5oZWFkLmNoID4gMTAwIHx8IChpICYmIHNlbC5yYW5nZXNbaSAtIDFdLmhlYWQubGluZSA9PSByYW5nZS5oZWFkLmxpbmUpKSBjb250aW51ZTtcbiAgICAgIHZhciBtb2RlID0gY20uZ2V0TW9kZUF0KHJhbmdlLmhlYWQpO1xuICAgICAgdmFyIGluZGVudGVkID0gZmFsc2U7XG4gICAgICBpZiAobW9kZS5lbGVjdHJpY0NoYXJzKSB7XG4gICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgbW9kZS5lbGVjdHJpY0NoYXJzLmxlbmd0aDsgaisrKVxuICAgICAgICAgIGlmIChpbnNlcnRlZC5pbmRleE9mKG1vZGUuZWxlY3RyaWNDaGFycy5jaGFyQXQoaikpID4gLTEpIHtcbiAgICAgICAgICAgIGluZGVudGVkID0gaW5kZW50TGluZShjbSwgcmFuZ2UuaGVhZC5saW5lLCBcInNtYXJ0XCIpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmIChtb2RlLmVsZWN0cmljSW5wdXQpIHtcbiAgICAgICAgaWYgKG1vZGUuZWxlY3RyaWNJbnB1dC50ZXN0KGdldExpbmUoY20uZG9jLCByYW5nZS5oZWFkLmxpbmUpLnRleHQuc2xpY2UoMCwgcmFuZ2UuaGVhZC5jaCkpKVxuICAgICAgICAgIGluZGVudGVkID0gaW5kZW50TGluZShjbSwgcmFuZ2UuaGVhZC5saW5lLCBcInNtYXJ0XCIpO1xuICAgICAgfVxuICAgICAgaWYgKGluZGVudGVkKSBzaWduYWxMYXRlcihjbSwgXCJlbGVjdHJpY0lucHV0XCIsIGNtLCByYW5nZS5oZWFkLmxpbmUpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIGNvcHlhYmxlUmFuZ2VzKGNtKSB7XG4gICAgdmFyIHRleHQgPSBbXSwgcmFuZ2VzID0gW107XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjbS5kb2Muc2VsLnJhbmdlcy5sZW5ndGg7IGkrKykge1xuICAgICAgdmFyIGxpbmUgPSBjbS5kb2Muc2VsLnJhbmdlc1tpXS5oZWFkLmxpbmU7XG4gICAgICB2YXIgbGluZVJhbmdlID0ge2FuY2hvcjogUG9zKGxpbmUsIDApLCBoZWFkOiBQb3MobGluZSArIDEsIDApfTtcbiAgICAgIHJhbmdlcy5wdXNoKGxpbmVSYW5nZSk7XG4gICAgICB0ZXh0LnB1c2goY20uZ2V0UmFuZ2UobGluZVJhbmdlLmFuY2hvciwgbGluZVJhbmdlLmhlYWQpKTtcbiAgICB9XG4gICAgcmV0dXJuIHt0ZXh0OiB0ZXh0LCByYW5nZXM6IHJhbmdlc307XG4gIH1cblxuICBmdW5jdGlvbiBkaXNhYmxlQnJvd3Nlck1hZ2ljKGZpZWxkKSB7XG4gICAgZmllbGQuc2V0QXR0cmlidXRlKFwiYXV0b2NvcnJlY3RcIiwgXCJvZmZcIik7XG4gICAgZmllbGQuc2V0QXR0cmlidXRlKFwiYXV0b2NhcGl0YWxpemVcIiwgXCJvZmZcIik7XG4gICAgZmllbGQuc2V0QXR0cmlidXRlKFwic3BlbGxjaGVja1wiLCBcImZhbHNlXCIpO1xuICB9XG5cbiAgLy8gVEVYVEFSRUEgSU5QVVQgU1RZTEVcblxuICBmdW5jdGlvbiBUZXh0YXJlYUlucHV0KGNtKSB7XG4gICAgdGhpcy5jbSA9IGNtO1xuICAgIC8vIFNlZSBpbnB1dC5wb2xsIGFuZCBpbnB1dC5yZXNldFxuICAgIHRoaXMucHJldklucHV0ID0gXCJcIjtcblxuICAgIC8vIEZsYWcgdGhhdCBpbmRpY2F0ZXMgd2hldGhlciB3ZSBleHBlY3QgaW5wdXQgdG8gYXBwZWFyIHJlYWwgc29vblxuICAgIC8vIG5vdyAoYWZ0ZXIgc29tZSBldmVudCBsaWtlICdrZXlwcmVzcycgb3IgJ2lucHV0JykgYW5kIGFyZVxuICAgIC8vIHBvbGxpbmcgaW50ZW5zaXZlbHkuXG4gICAgdGhpcy5wb2xsaW5nRmFzdCA9IGZhbHNlO1xuICAgIC8vIFNlbGYtcmVzZXR0aW5nIHRpbWVvdXQgZm9yIHRoZSBwb2xsZXJcbiAgICB0aGlzLnBvbGxpbmcgPSBuZXcgRGVsYXllZCgpO1xuICAgIC8vIFRyYWNrcyB3aGVuIGlucHV0LnJlc2V0IGhhcyBwdW50ZWQgdG8ganVzdCBwdXR0aW5nIGEgc2hvcnRcbiAgICAvLyBzdHJpbmcgaW50byB0aGUgdGV4dGFyZWEgaW5zdGVhZCBvZiB0aGUgZnVsbCBzZWxlY3Rpb24uXG4gICAgdGhpcy5pbmFjY3VyYXRlU2VsZWN0aW9uID0gZmFsc2U7XG4gICAgLy8gVXNlZCB0byB3b3JrIGFyb3VuZCBJRSBpc3N1ZSB3aXRoIHNlbGVjdGlvbiBiZWluZyBmb3Jnb3R0ZW4gd2hlbiBmb2N1cyBtb3ZlcyBhd2F5IGZyb20gdGV4dGFyZWFcbiAgICB0aGlzLmhhc1NlbGVjdGlvbiA9IGZhbHNlO1xuICAgIHRoaXMuY29tcG9zaW5nID0gbnVsbDtcbiAgfTtcblxuICBmdW5jdGlvbiBoaWRkZW5UZXh0YXJlYSgpIHtcbiAgICB2YXIgdGUgPSBlbHQoXCJ0ZXh0YXJlYVwiLCBudWxsLCBudWxsLCBcInBvc2l0aW9uOiBhYnNvbHV0ZTsgcGFkZGluZzogMDsgd2lkdGg6IDFweDsgaGVpZ2h0OiAxZW07IG91dGxpbmU6IG5vbmVcIik7XG4gICAgdmFyIGRpdiA9IGVsdChcImRpdlwiLCBbdGVdLCBudWxsLCBcIm92ZXJmbG93OiBoaWRkZW47IHBvc2l0aW9uOiByZWxhdGl2ZTsgd2lkdGg6IDNweDsgaGVpZ2h0OiAwcHg7XCIpO1xuICAgIC8vIFRoZSB0ZXh0YXJlYSBpcyBrZXB0IHBvc2l0aW9uZWQgbmVhciB0aGUgY3Vyc29yIHRvIHByZXZlbnQgdGhlXG4gICAgLy8gZmFjdCB0aGF0IGl0J2xsIGJlIHNjcm9sbGVkIGludG8gdmlldyBvbiBpbnB1dCBmcm9tIHNjcm9sbGluZ1xuICAgIC8vIG91ciBmYWtlIGN1cnNvciBvdXQgb2Ygdmlldy4gT24gd2Via2l0LCB3aGVuIHdyYXA9b2ZmLCBwYXN0ZSBpc1xuICAgIC8vIHZlcnkgc2xvdy4gU28gbWFrZSB0aGUgYXJlYSB3aWRlIGluc3RlYWQuXG4gICAgaWYgKHdlYmtpdCkgdGUuc3R5bGUud2lkdGggPSBcIjEwMDBweFwiO1xuICAgIGVsc2UgdGUuc2V0QXR0cmlidXRlKFwid3JhcFwiLCBcIm9mZlwiKTtcbiAgICAvLyBJZiBib3JkZXI6IDA7IC0tIGlPUyBmYWlscyB0byBvcGVuIGtleWJvYXJkIChpc3N1ZSAjMTI4NylcbiAgICBpZiAoaW9zKSB0ZS5zdHlsZS5ib3JkZXIgPSBcIjFweCBzb2xpZCBibGFja1wiO1xuICAgIGRpc2FibGVCcm93c2VyTWFnaWModGUpO1xuICAgIHJldHVybiBkaXY7XG4gIH1cblxuICBUZXh0YXJlYUlucHV0LnByb3RvdHlwZSA9IGNvcHlPYmooe1xuICAgIGluaXQ6IGZ1bmN0aW9uKGRpc3BsYXkpIHtcbiAgICAgIHZhciBpbnB1dCA9IHRoaXMsIGNtID0gdGhpcy5jbTtcblxuICAgICAgLy8gV3JhcHMgYW5kIGhpZGVzIGlucHV0IHRleHRhcmVhXG4gICAgICB2YXIgZGl2ID0gdGhpcy53cmFwcGVyID0gaGlkZGVuVGV4dGFyZWEoKTtcbiAgICAgIC8vIFRoZSBzZW1paGlkZGVuIHRleHRhcmVhIHRoYXQgaXMgZm9jdXNlZCB3aGVuIHRoZSBlZGl0b3IgaXNcbiAgICAgIC8vIGZvY3VzZWQsIGFuZCByZWNlaXZlcyBpbnB1dC5cbiAgICAgIHZhciB0ZSA9IHRoaXMudGV4dGFyZWEgPSBkaXYuZmlyc3RDaGlsZDtcbiAgICAgIGRpc3BsYXkud3JhcHBlci5pbnNlcnRCZWZvcmUoZGl2LCBkaXNwbGF5LndyYXBwZXIuZmlyc3RDaGlsZCk7XG5cbiAgICAgIC8vIE5lZWRlZCB0byBoaWRlIGJpZyBibHVlIGJsaW5raW5nIGN1cnNvciBvbiBNb2JpbGUgU2FmYXJpIChkb2Vzbid0IHNlZW0gdG8gd29yayBpbiBpT1MgOCBhbnltb3JlKVxuICAgICAgaWYgKGlvcykgdGUuc3R5bGUud2lkdGggPSBcIjBweFwiO1xuXG4gICAgICBvbih0ZSwgXCJpbnB1dFwiLCBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKGllICYmIGllX3ZlcnNpb24gPj0gOSAmJiBpbnB1dC5oYXNTZWxlY3Rpb24pIGlucHV0Lmhhc1NlbGVjdGlvbiA9IG51bGw7XG4gICAgICAgIGlucHV0LnBvbGwoKTtcbiAgICAgIH0pO1xuXG4gICAgICBvbih0ZSwgXCJwYXN0ZVwiLCBmdW5jdGlvbihlKSB7XG4gICAgICAgIGlmIChzaWduYWxET01FdmVudChjbSwgZSkgfHwgaGFuZGxlUGFzdGUoZSwgY20pKSByZXR1cm5cblxuICAgICAgICBjbS5zdGF0ZS5wYXN0ZUluY29taW5nID0gdHJ1ZTtcbiAgICAgICAgaW5wdXQuZmFzdFBvbGwoKTtcbiAgICAgIH0pO1xuXG4gICAgICBmdW5jdGlvbiBwcmVwYXJlQ29weUN1dChlKSB7XG4gICAgICAgIGlmIChzaWduYWxET01FdmVudChjbSwgZSkpIHJldHVyblxuICAgICAgICBpZiAoY20uc29tZXRoaW5nU2VsZWN0ZWQoKSkge1xuICAgICAgICAgIGxhc3RDb3BpZWQgPSBjbS5nZXRTZWxlY3Rpb25zKCk7XG4gICAgICAgICAgaWYgKGlucHV0LmluYWNjdXJhdGVTZWxlY3Rpb24pIHtcbiAgICAgICAgICAgIGlucHV0LnByZXZJbnB1dCA9IFwiXCI7XG4gICAgICAgICAgICBpbnB1dC5pbmFjY3VyYXRlU2VsZWN0aW9uID0gZmFsc2U7XG4gICAgICAgICAgICB0ZS52YWx1ZSA9IGxhc3RDb3BpZWQuam9pbihcIlxcblwiKTtcbiAgICAgICAgICAgIHNlbGVjdElucHV0KHRlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAoIWNtLm9wdGlvbnMubGluZVdpc2VDb3B5Q3V0KSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHZhciByYW5nZXMgPSBjb3B5YWJsZVJhbmdlcyhjbSk7XG4gICAgICAgICAgbGFzdENvcGllZCA9IHJhbmdlcy50ZXh0O1xuICAgICAgICAgIGlmIChlLnR5cGUgPT0gXCJjdXRcIikge1xuICAgICAgICAgICAgY20uc2V0U2VsZWN0aW9ucyhyYW5nZXMucmFuZ2VzLCBudWxsLCBzZWxfZG9udFNjcm9sbCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlucHV0LnByZXZJbnB1dCA9IFwiXCI7XG4gICAgICAgICAgICB0ZS52YWx1ZSA9IHJhbmdlcy50ZXh0LmpvaW4oXCJcXG5cIik7XG4gICAgICAgICAgICBzZWxlY3RJbnB1dCh0ZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChlLnR5cGUgPT0gXCJjdXRcIikgY20uc3RhdGUuY3V0SW5jb21pbmcgPSB0cnVlO1xuICAgICAgfVxuICAgICAgb24odGUsIFwiY3V0XCIsIHByZXBhcmVDb3B5Q3V0KTtcbiAgICAgIG9uKHRlLCBcImNvcHlcIiwgcHJlcGFyZUNvcHlDdXQpO1xuXG4gICAgICBvbihkaXNwbGF5LnNjcm9sbGVyLCBcInBhc3RlXCIsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgaWYgKGV2ZW50SW5XaWRnZXQoZGlzcGxheSwgZSkgfHwgc2lnbmFsRE9NRXZlbnQoY20sIGUpKSByZXR1cm47XG4gICAgICAgIGNtLnN0YXRlLnBhc3RlSW5jb21pbmcgPSB0cnVlO1xuICAgICAgICBpbnB1dC5mb2N1cygpO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIFByZXZlbnQgbm9ybWFsIHNlbGVjdGlvbiBpbiB0aGUgZWRpdG9yICh3ZSBoYW5kbGUgb3VyIG93bilcbiAgICAgIG9uKGRpc3BsYXkubGluZVNwYWNlLCBcInNlbGVjdHN0YXJ0XCIsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgaWYgKCFldmVudEluV2lkZ2V0KGRpc3BsYXksIGUpKSBlX3ByZXZlbnREZWZhdWx0KGUpO1xuICAgICAgfSk7XG5cbiAgICAgIG9uKHRlLCBcImNvbXBvc2l0aW9uc3RhcnRcIiwgZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBzdGFydCA9IGNtLmdldEN1cnNvcihcImZyb21cIik7XG4gICAgICAgIGlmIChpbnB1dC5jb21wb3NpbmcpIGlucHV0LmNvbXBvc2luZy5yYW5nZS5jbGVhcigpXG4gICAgICAgIGlucHV0LmNvbXBvc2luZyA9IHtcbiAgICAgICAgICBzdGFydDogc3RhcnQsXG4gICAgICAgICAgcmFuZ2U6IGNtLm1hcmtUZXh0KHN0YXJ0LCBjbS5nZXRDdXJzb3IoXCJ0b1wiKSwge2NsYXNzTmFtZTogXCJDb2RlTWlycm9yLWNvbXBvc2luZ1wifSlcbiAgICAgICAgfTtcbiAgICAgIH0pO1xuICAgICAgb24odGUsIFwiY29tcG9zaXRpb25lbmRcIiwgZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmIChpbnB1dC5jb21wb3NpbmcpIHtcbiAgICAgICAgICBpbnB1dC5wb2xsKCk7XG4gICAgICAgICAgaW5wdXQuY29tcG9zaW5nLnJhbmdlLmNsZWFyKCk7XG4gICAgICAgICAgaW5wdXQuY29tcG9zaW5nID0gbnVsbDtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSxcblxuICAgIHByZXBhcmVTZWxlY3Rpb246IGZ1bmN0aW9uKCkge1xuICAgICAgLy8gUmVkcmF3IHRoZSBzZWxlY3Rpb24gYW5kL29yIGN1cnNvclxuICAgICAgdmFyIGNtID0gdGhpcy5jbSwgZGlzcGxheSA9IGNtLmRpc3BsYXksIGRvYyA9IGNtLmRvYztcbiAgICAgIHZhciByZXN1bHQgPSBwcmVwYXJlU2VsZWN0aW9uKGNtKTtcblxuICAgICAgLy8gTW92ZSB0aGUgaGlkZGVuIHRleHRhcmVhIG5lYXIgdGhlIGN1cnNvciB0byBwcmV2ZW50IHNjcm9sbGluZyBhcnRpZmFjdHNcbiAgICAgIGlmIChjbS5vcHRpb25zLm1vdmVJbnB1dFdpdGhDdXJzb3IpIHtcbiAgICAgICAgdmFyIGhlYWRQb3MgPSBjdXJzb3JDb29yZHMoY20sIGRvYy5zZWwucHJpbWFyeSgpLmhlYWQsIFwiZGl2XCIpO1xuICAgICAgICB2YXIgd3JhcE9mZiA9IGRpc3BsYXkud3JhcHBlci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSwgbGluZU9mZiA9IGRpc3BsYXkubGluZURpdi5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgICAgcmVzdWx0LnRlVG9wID0gTWF0aC5tYXgoMCwgTWF0aC5taW4oZGlzcGxheS53cmFwcGVyLmNsaWVudEhlaWdodCAtIDEwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWFkUG9zLnRvcCArIGxpbmVPZmYudG9wIC0gd3JhcE9mZi50b3ApKTtcbiAgICAgICAgcmVzdWx0LnRlTGVmdCA9IE1hdGgubWF4KDAsIE1hdGgubWluKGRpc3BsYXkud3JhcHBlci5jbGllbnRXaWR0aCAtIDEwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhZFBvcy5sZWZ0ICsgbGluZU9mZi5sZWZ0IC0gd3JhcE9mZi5sZWZ0KSk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfSxcblxuICAgIHNob3dTZWxlY3Rpb246IGZ1bmN0aW9uKGRyYXduKSB7XG4gICAgICB2YXIgY20gPSB0aGlzLmNtLCBkaXNwbGF5ID0gY20uZGlzcGxheTtcbiAgICAgIHJlbW92ZUNoaWxkcmVuQW5kQWRkKGRpc3BsYXkuY3Vyc29yRGl2LCBkcmF3bi5jdXJzb3JzKTtcbiAgICAgIHJlbW92ZUNoaWxkcmVuQW5kQWRkKGRpc3BsYXkuc2VsZWN0aW9uRGl2LCBkcmF3bi5zZWxlY3Rpb24pO1xuICAgICAgaWYgKGRyYXduLnRlVG9wICE9IG51bGwpIHtcbiAgICAgICAgdGhpcy53cmFwcGVyLnN0eWxlLnRvcCA9IGRyYXduLnRlVG9wICsgXCJweFwiO1xuICAgICAgICB0aGlzLndyYXBwZXIuc3R5bGUubGVmdCA9IGRyYXduLnRlTGVmdCArIFwicHhcIjtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgLy8gUmVzZXQgdGhlIGlucHV0IHRvIGNvcnJlc3BvbmQgdG8gdGhlIHNlbGVjdGlvbiAob3IgdG8gYmUgZW1wdHksXG4gICAgLy8gd2hlbiBub3QgdHlwaW5nIGFuZCBub3RoaW5nIGlzIHNlbGVjdGVkKVxuICAgIHJlc2V0OiBmdW5jdGlvbih0eXBpbmcpIHtcbiAgICAgIGlmICh0aGlzLmNvbnRleHRNZW51UGVuZGluZykgcmV0dXJuO1xuICAgICAgdmFyIG1pbmltYWwsIHNlbGVjdGVkLCBjbSA9IHRoaXMuY20sIGRvYyA9IGNtLmRvYztcbiAgICAgIGlmIChjbS5zb21ldGhpbmdTZWxlY3RlZCgpKSB7XG4gICAgICAgIHRoaXMucHJldklucHV0ID0gXCJcIjtcbiAgICAgICAgdmFyIHJhbmdlID0gZG9jLnNlbC5wcmltYXJ5KCk7XG4gICAgICAgIG1pbmltYWwgPSBoYXNDb3B5RXZlbnQgJiZcbiAgICAgICAgICAocmFuZ2UudG8oKS5saW5lIC0gcmFuZ2UuZnJvbSgpLmxpbmUgPiAxMDAgfHwgKHNlbGVjdGVkID0gY20uZ2V0U2VsZWN0aW9uKCkpLmxlbmd0aCA+IDEwMDApO1xuICAgICAgICB2YXIgY29udGVudCA9IG1pbmltYWwgPyBcIi1cIiA6IHNlbGVjdGVkIHx8IGNtLmdldFNlbGVjdGlvbigpO1xuICAgICAgICB0aGlzLnRleHRhcmVhLnZhbHVlID0gY29udGVudDtcbiAgICAgICAgaWYgKGNtLnN0YXRlLmZvY3VzZWQpIHNlbGVjdElucHV0KHRoaXMudGV4dGFyZWEpO1xuICAgICAgICBpZiAoaWUgJiYgaWVfdmVyc2lvbiA+PSA5KSB0aGlzLmhhc1NlbGVjdGlvbiA9IGNvbnRlbnQ7XG4gICAgICB9IGVsc2UgaWYgKCF0eXBpbmcpIHtcbiAgICAgICAgdGhpcy5wcmV2SW5wdXQgPSB0aGlzLnRleHRhcmVhLnZhbHVlID0gXCJcIjtcbiAgICAgICAgaWYgKGllICYmIGllX3ZlcnNpb24gPj0gOSkgdGhpcy5oYXNTZWxlY3Rpb24gPSBudWxsO1xuICAgICAgfVxuICAgICAgdGhpcy5pbmFjY3VyYXRlU2VsZWN0aW9uID0gbWluaW1hbDtcbiAgICB9LFxuXG4gICAgZ2V0RmllbGQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpcy50ZXh0YXJlYTsgfSxcblxuICAgIHN1cHBvcnRzVG91Y2g6IGZ1bmN0aW9uKCkgeyByZXR1cm4gZmFsc2U7IH0sXG5cbiAgICBmb2N1czogZnVuY3Rpb24oKSB7XG4gICAgICBpZiAodGhpcy5jbS5vcHRpb25zLnJlYWRPbmx5ICE9IFwibm9jdXJzb3JcIiAmJiAoIW1vYmlsZSB8fCBhY3RpdmVFbHQoKSAhPSB0aGlzLnRleHRhcmVhKSkge1xuICAgICAgICB0cnkgeyB0aGlzLnRleHRhcmVhLmZvY3VzKCk7IH1cbiAgICAgICAgY2F0Y2ggKGUpIHt9IC8vIElFOCB3aWxsIHRocm93IGlmIHRoZSB0ZXh0YXJlYSBpcyBkaXNwbGF5OiBub25lIG9yIG5vdCBpbiBET01cbiAgICAgIH1cbiAgICB9LFxuXG4gICAgYmx1cjogZnVuY3Rpb24oKSB7IHRoaXMudGV4dGFyZWEuYmx1cigpOyB9LFxuXG4gICAgcmVzZXRQb3NpdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLndyYXBwZXIuc3R5bGUudG9wID0gdGhpcy53cmFwcGVyLnN0eWxlLmxlZnQgPSAwO1xuICAgIH0sXG5cbiAgICByZWNlaXZlZEZvY3VzOiBmdW5jdGlvbigpIHsgdGhpcy5zbG93UG9sbCgpOyB9LFxuXG4gICAgLy8gUG9sbCBmb3IgaW5wdXQgY2hhbmdlcywgdXNpbmcgdGhlIG5vcm1hbCByYXRlIG9mIHBvbGxpbmcuIFRoaXNcbiAgICAvLyBydW5zIGFzIGxvbmcgYXMgdGhlIGVkaXRvciBpcyBmb2N1c2VkLlxuICAgIHNsb3dQb2xsOiBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBpbnB1dCA9IHRoaXM7XG4gICAgICBpZiAoaW5wdXQucG9sbGluZ0Zhc3QpIHJldHVybjtcbiAgICAgIGlucHV0LnBvbGxpbmcuc2V0KHRoaXMuY20ub3B0aW9ucy5wb2xsSW50ZXJ2YWwsIGZ1bmN0aW9uKCkge1xuICAgICAgICBpbnB1dC5wb2xsKCk7XG4gICAgICAgIGlmIChpbnB1dC5jbS5zdGF0ZS5mb2N1c2VkKSBpbnB1dC5zbG93UG9sbCgpO1xuICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8vIFdoZW4gYW4gZXZlbnQgaGFzIGp1c3QgY29tZSBpbiB0aGF0IGlzIGxpa2VseSB0byBhZGQgb3IgY2hhbmdlXG4gICAgLy8gc29tZXRoaW5nIGluIHRoZSBpbnB1dCB0ZXh0YXJlYSwgd2UgcG9sbCBmYXN0ZXIsIHRvIGVuc3VyZSB0aGF0XG4gICAgLy8gdGhlIGNoYW5nZSBhcHBlYXJzIG9uIHRoZSBzY3JlZW4gcXVpY2tseS5cbiAgICBmYXN0UG9sbDogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgbWlzc2VkID0gZmFsc2UsIGlucHV0ID0gdGhpcztcbiAgICAgIGlucHV0LnBvbGxpbmdGYXN0ID0gdHJ1ZTtcbiAgICAgIGZ1bmN0aW9uIHAoKSB7XG4gICAgICAgIHZhciBjaGFuZ2VkID0gaW5wdXQucG9sbCgpO1xuICAgICAgICBpZiAoIWNoYW5nZWQgJiYgIW1pc3NlZCkge21pc3NlZCA9IHRydWU7IGlucHV0LnBvbGxpbmcuc2V0KDYwLCBwKTt9XG4gICAgICAgIGVsc2Uge2lucHV0LnBvbGxpbmdGYXN0ID0gZmFsc2U7IGlucHV0LnNsb3dQb2xsKCk7fVxuICAgICAgfVxuICAgICAgaW5wdXQucG9sbGluZy5zZXQoMjAsIHApO1xuICAgIH0sXG5cbiAgICAvLyBSZWFkIGlucHV0IGZyb20gdGhlIHRleHRhcmVhLCBhbmQgdXBkYXRlIHRoZSBkb2N1bWVudCB0byBtYXRjaC5cbiAgICAvLyBXaGVuIHNvbWV0aGluZyBpcyBzZWxlY3RlZCwgaXQgaXMgcHJlc2VudCBpbiB0aGUgdGV4dGFyZWEsIGFuZFxuICAgIC8vIHNlbGVjdGVkICh1bmxlc3MgaXQgaXMgaHVnZSwgaW4gd2hpY2ggY2FzZSBhIHBsYWNlaG9sZGVyIGlzXG4gICAgLy8gdXNlZCkuIFdoZW4gbm90aGluZyBpcyBzZWxlY3RlZCwgdGhlIGN1cnNvciBzaXRzIGFmdGVyIHByZXZpb3VzbHlcbiAgICAvLyBzZWVuIHRleHQgKGNhbiBiZSBlbXB0eSksIHdoaWNoIGlzIHN0b3JlZCBpbiBwcmV2SW5wdXQgKHdlIG11c3RcbiAgICAvLyBub3QgcmVzZXQgdGhlIHRleHRhcmVhIHdoZW4gdHlwaW5nLCBiZWNhdXNlIHRoYXQgYnJlYWtzIElNRSkuXG4gICAgcG9sbDogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgY20gPSB0aGlzLmNtLCBpbnB1dCA9IHRoaXMudGV4dGFyZWEsIHByZXZJbnB1dCA9IHRoaXMucHJldklucHV0O1xuICAgICAgLy8gU2luY2UgdGhpcyBpcyBjYWxsZWQgYSAqbG90KiwgdHJ5IHRvIGJhaWwgb3V0IGFzIGNoZWFwbHkgYXNcbiAgICAgIC8vIHBvc3NpYmxlIHdoZW4gaXQgaXMgY2xlYXIgdGhhdCBub3RoaW5nIGhhcHBlbmVkLiBoYXNTZWxlY3Rpb25cbiAgICAgIC8vIHdpbGwgYmUgdGhlIGNhc2Ugd2hlbiB0aGVyZSBpcyBhIGxvdCBvZiB0ZXh0IGluIHRoZSB0ZXh0YXJlYSxcbiAgICAgIC8vIGluIHdoaWNoIGNhc2UgcmVhZGluZyBpdHMgdmFsdWUgd291bGQgYmUgZXhwZW5zaXZlLlxuICAgICAgaWYgKHRoaXMuY29udGV4dE1lbnVQZW5kaW5nIHx8ICFjbS5zdGF0ZS5mb2N1c2VkIHx8XG4gICAgICAgICAgKGhhc1NlbGVjdGlvbihpbnB1dCkgJiYgIXByZXZJbnB1dCAmJiAhdGhpcy5jb21wb3NpbmcpIHx8XG4gICAgICAgICAgY20uaXNSZWFkT25seSgpIHx8IGNtLm9wdGlvbnMuZGlzYWJsZUlucHV0IHx8IGNtLnN0YXRlLmtleVNlcSlcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuXG4gICAgICB2YXIgdGV4dCA9IGlucHV0LnZhbHVlO1xuICAgICAgLy8gSWYgbm90aGluZyBjaGFuZ2VkLCBiYWlsLlxuICAgICAgaWYgKHRleHQgPT0gcHJldklucHV0ICYmICFjbS5zb21ldGhpbmdTZWxlY3RlZCgpKSByZXR1cm4gZmFsc2U7XG4gICAgICAvLyBXb3JrIGFyb3VuZCBub25zZW5zaWNhbCBzZWxlY3Rpb24gcmVzZXR0aW5nIGluIElFOS8xMCwgYW5kXG4gICAgICAvLyBpbmV4cGxpY2FibGUgYXBwZWFyYW5jZSBvZiBwcml2YXRlIGFyZWEgdW5pY29kZSBjaGFyYWN0ZXJzIG9uXG4gICAgICAvLyBzb21lIGtleSBjb21ib3MgaW4gTWFjICgjMjY4OSkuXG4gICAgICBpZiAoaWUgJiYgaWVfdmVyc2lvbiA+PSA5ICYmIHRoaXMuaGFzU2VsZWN0aW9uID09PSB0ZXh0IHx8XG4gICAgICAgICAgbWFjICYmIC9bXFx1ZjcwMC1cXHVmN2ZmXS8udGVzdCh0ZXh0KSkge1xuICAgICAgICBjbS5kaXNwbGF5LmlucHV0LnJlc2V0KCk7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cblxuICAgICAgaWYgKGNtLmRvYy5zZWwgPT0gY20uZGlzcGxheS5zZWxGb3JDb250ZXh0TWVudSkge1xuICAgICAgICB2YXIgZmlyc3QgPSB0ZXh0LmNoYXJDb2RlQXQoMCk7XG4gICAgICAgIGlmIChmaXJzdCA9PSAweDIwMGIgJiYgIXByZXZJbnB1dCkgcHJldklucHV0ID0gXCJcXHUyMDBiXCI7XG4gICAgICAgIGlmIChmaXJzdCA9PSAweDIxZGEpIHsgdGhpcy5yZXNldCgpOyByZXR1cm4gdGhpcy5jbS5leGVjQ29tbWFuZChcInVuZG9cIik7IH1cbiAgICAgIH1cbiAgICAgIC8vIEZpbmQgdGhlIHBhcnQgb2YgdGhlIGlucHV0IHRoYXQgaXMgYWN0dWFsbHkgbmV3XG4gICAgICB2YXIgc2FtZSA9IDAsIGwgPSBNYXRoLm1pbihwcmV2SW5wdXQubGVuZ3RoLCB0ZXh0Lmxlbmd0aCk7XG4gICAgICB3aGlsZSAoc2FtZSA8IGwgJiYgcHJldklucHV0LmNoYXJDb2RlQXQoc2FtZSkgPT0gdGV4dC5jaGFyQ29kZUF0KHNhbWUpKSArK3NhbWU7XG5cbiAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgIHJ1bkluT3AoY20sIGZ1bmN0aW9uKCkge1xuICAgICAgICBhcHBseVRleHRJbnB1dChjbSwgdGV4dC5zbGljZShzYW1lKSwgcHJldklucHV0Lmxlbmd0aCAtIHNhbWUsXG4gICAgICAgICAgICAgICAgICAgICAgIG51bGwsIHNlbGYuY29tcG9zaW5nID8gXCIqY29tcG9zZVwiIDogbnVsbCk7XG5cbiAgICAgICAgLy8gRG9uJ3QgbGVhdmUgbG9uZyB0ZXh0IGluIHRoZSB0ZXh0YXJlYSwgc2luY2UgaXQgbWFrZXMgZnVydGhlciBwb2xsaW5nIHNsb3dcbiAgICAgICAgaWYgKHRleHQubGVuZ3RoID4gMTAwMCB8fCB0ZXh0LmluZGV4T2YoXCJcXG5cIikgPiAtMSkgaW5wdXQudmFsdWUgPSBzZWxmLnByZXZJbnB1dCA9IFwiXCI7XG4gICAgICAgIGVsc2Ugc2VsZi5wcmV2SW5wdXQgPSB0ZXh0O1xuXG4gICAgICAgIGlmIChzZWxmLmNvbXBvc2luZykge1xuICAgICAgICAgIHNlbGYuY29tcG9zaW5nLnJhbmdlLmNsZWFyKCk7XG4gICAgICAgICAgc2VsZi5jb21wb3NpbmcucmFuZ2UgPSBjbS5tYXJrVGV4dChzZWxmLmNvbXBvc2luZy5zdGFydCwgY20uZ2V0Q3Vyc29yKFwidG9cIiksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7Y2xhc3NOYW1lOiBcIkNvZGVNaXJyb3ItY29tcG9zaW5nXCJ9KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9LFxuXG4gICAgZW5zdXJlUG9sbGVkOiBmdW5jdGlvbigpIHtcbiAgICAgIGlmICh0aGlzLnBvbGxpbmdGYXN0ICYmIHRoaXMucG9sbCgpKSB0aGlzLnBvbGxpbmdGYXN0ID0gZmFsc2U7XG4gICAgfSxcblxuICAgIG9uS2V5UHJlc3M6IGZ1bmN0aW9uKCkge1xuICAgICAgaWYgKGllICYmIGllX3ZlcnNpb24gPj0gOSkgdGhpcy5oYXNTZWxlY3Rpb24gPSBudWxsO1xuICAgICAgdGhpcy5mYXN0UG9sbCgpO1xuICAgIH0sXG5cbiAgICBvbkNvbnRleHRNZW51OiBmdW5jdGlvbihlKSB7XG4gICAgICB2YXIgaW5wdXQgPSB0aGlzLCBjbSA9IGlucHV0LmNtLCBkaXNwbGF5ID0gY20uZGlzcGxheSwgdGUgPSBpbnB1dC50ZXh0YXJlYTtcbiAgICAgIHZhciBwb3MgPSBwb3NGcm9tTW91c2UoY20sIGUpLCBzY3JvbGxQb3MgPSBkaXNwbGF5LnNjcm9sbGVyLnNjcm9sbFRvcDtcbiAgICAgIGlmICghcG9zIHx8IHByZXN0bykgcmV0dXJuOyAvLyBPcGVyYSBpcyBkaWZmaWN1bHQuXG5cbiAgICAgIC8vIFJlc2V0IHRoZSBjdXJyZW50IHRleHQgc2VsZWN0aW9uIG9ubHkgaWYgdGhlIGNsaWNrIGlzIGRvbmUgb3V0c2lkZSBvZiB0aGUgc2VsZWN0aW9uXG4gICAgICAvLyBhbmQgJ3Jlc2V0U2VsZWN0aW9uT25Db250ZXh0TWVudScgb3B0aW9uIGlzIHRydWUuXG4gICAgICB2YXIgcmVzZXQgPSBjbS5vcHRpb25zLnJlc2V0U2VsZWN0aW9uT25Db250ZXh0TWVudTtcbiAgICAgIGlmIChyZXNldCAmJiBjbS5kb2Muc2VsLmNvbnRhaW5zKHBvcykgPT0gLTEpXG4gICAgICAgIG9wZXJhdGlvbihjbSwgc2V0U2VsZWN0aW9uKShjbS5kb2MsIHNpbXBsZVNlbGVjdGlvbihwb3MpLCBzZWxfZG9udFNjcm9sbCk7XG5cbiAgICAgIHZhciBvbGRDU1MgPSB0ZS5zdHlsZS5jc3NUZXh0O1xuICAgICAgaW5wdXQud3JhcHBlci5zdHlsZS5wb3NpdGlvbiA9IFwiYWJzb2x1dGVcIjtcbiAgICAgIHRlLnN0eWxlLmNzc1RleHQgPSBcInBvc2l0aW9uOiBmaXhlZDsgd2lkdGg6IDMwcHg7IGhlaWdodDogMzBweDsgdG9wOiBcIiArIChlLmNsaWVudFkgLSA1KSArXG4gICAgICAgIFwicHg7IGxlZnQ6IFwiICsgKGUuY2xpZW50WCAtIDUpICsgXCJweDsgei1pbmRleDogMTAwMDsgYmFja2dyb3VuZDogXCIgK1xuICAgICAgICAoaWUgPyBcInJnYmEoMjU1LCAyNTUsIDI1NSwgLjA1KVwiIDogXCJ0cmFuc3BhcmVudFwiKSArXG4gICAgICAgIFwiOyBvdXRsaW5lOiBub25lOyBib3JkZXItd2lkdGg6IDA7IG91dGxpbmU6IG5vbmU7IG92ZXJmbG93OiBoaWRkZW47IG9wYWNpdHk6IC4wNTsgZmlsdGVyOiBhbHBoYShvcGFjaXR5PTUpO1wiO1xuICAgICAgaWYgKHdlYmtpdCkgdmFyIG9sZFNjcm9sbFkgPSB3aW5kb3cuc2Nyb2xsWTsgLy8gV29yayBhcm91bmQgQ2hyb21lIGlzc3VlICgjMjcxMilcbiAgICAgIGRpc3BsYXkuaW5wdXQuZm9jdXMoKTtcbiAgICAgIGlmICh3ZWJraXQpIHdpbmRvdy5zY3JvbGxUbyhudWxsLCBvbGRTY3JvbGxZKTtcbiAgICAgIGRpc3BsYXkuaW5wdXQucmVzZXQoKTtcbiAgICAgIC8vIEFkZHMgXCJTZWxlY3QgYWxsXCIgdG8gY29udGV4dCBtZW51IGluIEZGXG4gICAgICBpZiAoIWNtLnNvbWV0aGluZ1NlbGVjdGVkKCkpIHRlLnZhbHVlID0gaW5wdXQucHJldklucHV0ID0gXCIgXCI7XG4gICAgICBpbnB1dC5jb250ZXh0TWVudVBlbmRpbmcgPSB0cnVlO1xuICAgICAgZGlzcGxheS5zZWxGb3JDb250ZXh0TWVudSA9IGNtLmRvYy5zZWw7XG4gICAgICBjbGVhclRpbWVvdXQoZGlzcGxheS5kZXRlY3RpbmdTZWxlY3RBbGwpO1xuXG4gICAgICAvLyBTZWxlY3QtYWxsIHdpbGwgYmUgZ3JleWVkIG91dCBpZiB0aGVyZSdzIG5vdGhpbmcgdG8gc2VsZWN0LCBzb1xuICAgICAgLy8gdGhpcyBhZGRzIGEgemVyby13aWR0aCBzcGFjZSBzbyB0aGF0IHdlIGNhbiBsYXRlciBjaGVjayB3aGV0aGVyXG4gICAgICAvLyBpdCBnb3Qgc2VsZWN0ZWQuXG4gICAgICBmdW5jdGlvbiBwcmVwYXJlU2VsZWN0QWxsSGFjaygpIHtcbiAgICAgICAgaWYgKHRlLnNlbGVjdGlvblN0YXJ0ICE9IG51bGwpIHtcbiAgICAgICAgICB2YXIgc2VsZWN0ZWQgPSBjbS5zb21ldGhpbmdTZWxlY3RlZCgpO1xuICAgICAgICAgIHZhciBleHR2YWwgPSBcIlxcdTIwMGJcIiArIChzZWxlY3RlZCA/IHRlLnZhbHVlIDogXCJcIik7XG4gICAgICAgICAgdGUudmFsdWUgPSBcIlxcdTIxZGFcIjsgLy8gVXNlZCB0byBjYXRjaCBjb250ZXh0LW1lbnUgdW5kb1xuICAgICAgICAgIHRlLnZhbHVlID0gZXh0dmFsO1xuICAgICAgICAgIGlucHV0LnByZXZJbnB1dCA9IHNlbGVjdGVkID8gXCJcIiA6IFwiXFx1MjAwYlwiO1xuICAgICAgICAgIHRlLnNlbGVjdGlvblN0YXJ0ID0gMTsgdGUuc2VsZWN0aW9uRW5kID0gZXh0dmFsLmxlbmd0aDtcbiAgICAgICAgICAvLyBSZS1zZXQgdGhpcywgaW4gY2FzZSBzb21lIG90aGVyIGhhbmRsZXIgdG91Y2hlZCB0aGVcbiAgICAgICAgICAvLyBzZWxlY3Rpb24gaW4gdGhlIG1lYW50aW1lLlxuICAgICAgICAgIGRpc3BsYXkuc2VsRm9yQ29udGV4dE1lbnUgPSBjbS5kb2Muc2VsO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBmdW5jdGlvbiByZWhpZGUoKSB7XG4gICAgICAgIGlucHV0LmNvbnRleHRNZW51UGVuZGluZyA9IGZhbHNlO1xuICAgICAgICBpbnB1dC53cmFwcGVyLnN0eWxlLnBvc2l0aW9uID0gXCJyZWxhdGl2ZVwiO1xuICAgICAgICB0ZS5zdHlsZS5jc3NUZXh0ID0gb2xkQ1NTO1xuICAgICAgICBpZiAoaWUgJiYgaWVfdmVyc2lvbiA8IDkpIGRpc3BsYXkuc2Nyb2xsYmFycy5zZXRTY3JvbGxUb3AoZGlzcGxheS5zY3JvbGxlci5zY3JvbGxUb3AgPSBzY3JvbGxQb3MpO1xuXG4gICAgICAgIC8vIFRyeSB0byBkZXRlY3QgdGhlIHVzZXIgY2hvb3Npbmcgc2VsZWN0LWFsbFxuICAgICAgICBpZiAodGUuc2VsZWN0aW9uU3RhcnQgIT0gbnVsbCkge1xuICAgICAgICAgIGlmICghaWUgfHwgKGllICYmIGllX3ZlcnNpb24gPCA5KSkgcHJlcGFyZVNlbGVjdEFsbEhhY2soKTtcbiAgICAgICAgICB2YXIgaSA9IDAsIHBvbGwgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmIChkaXNwbGF5LnNlbEZvckNvbnRleHRNZW51ID09IGNtLmRvYy5zZWwgJiYgdGUuc2VsZWN0aW9uU3RhcnQgPT0gMCAmJlxuICAgICAgICAgICAgICAgIHRlLnNlbGVjdGlvbkVuZCA+IDAgJiYgaW5wdXQucHJldklucHV0ID09IFwiXFx1MjAwYlwiKVxuICAgICAgICAgICAgICBvcGVyYXRpb24oY20sIGNvbW1hbmRzLnNlbGVjdEFsbCkoY20pO1xuICAgICAgICAgICAgZWxzZSBpZiAoaSsrIDwgMTApIGRpc3BsYXkuZGV0ZWN0aW5nU2VsZWN0QWxsID0gc2V0VGltZW91dChwb2xsLCA1MDApO1xuICAgICAgICAgICAgZWxzZSBkaXNwbGF5LmlucHV0LnJlc2V0KCk7XG4gICAgICAgICAgfTtcbiAgICAgICAgICBkaXNwbGF5LmRldGVjdGluZ1NlbGVjdEFsbCA9IHNldFRpbWVvdXQocG9sbCwgMjAwKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAoaWUgJiYgaWVfdmVyc2lvbiA+PSA5KSBwcmVwYXJlU2VsZWN0QWxsSGFjaygpO1xuICAgICAgaWYgKGNhcHR1cmVSaWdodENsaWNrKSB7XG4gICAgICAgIGVfc3RvcChlKTtcbiAgICAgICAgdmFyIG1vdXNldXAgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICBvZmYod2luZG93LCBcIm1vdXNldXBcIiwgbW91c2V1cCk7XG4gICAgICAgICAgc2V0VGltZW91dChyZWhpZGUsIDIwKTtcbiAgICAgICAgfTtcbiAgICAgICAgb24od2luZG93LCBcIm1vdXNldXBcIiwgbW91c2V1cCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzZXRUaW1lb3V0KHJlaGlkZSwgNTApO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICByZWFkT25seUNoYW5nZWQ6IGZ1bmN0aW9uKHZhbCkge1xuICAgICAgaWYgKCF2YWwpIHRoaXMucmVzZXQoKTtcbiAgICB9LFxuXG4gICAgc2V0VW5lZGl0YWJsZTogbm90aGluZyxcblxuICAgIG5lZWRzQ29udGVudEF0dHJpYnV0ZTogZmFsc2VcbiAgfSwgVGV4dGFyZWFJbnB1dC5wcm90b3R5cGUpO1xuXG4gIC8vIENPTlRFTlRFRElUQUJMRSBJTlBVVCBTVFlMRVxuXG4gIGZ1bmN0aW9uIENvbnRlbnRFZGl0YWJsZUlucHV0KGNtKSB7XG4gICAgdGhpcy5jbSA9IGNtO1xuICAgIHRoaXMubGFzdEFuY2hvck5vZGUgPSB0aGlzLmxhc3RBbmNob3JPZmZzZXQgPSB0aGlzLmxhc3RGb2N1c05vZGUgPSB0aGlzLmxhc3RGb2N1c09mZnNldCA9IG51bGw7XG4gICAgdGhpcy5wb2xsaW5nID0gbmV3IERlbGF5ZWQoKTtcbiAgICB0aGlzLmdyYWNlUGVyaW9kID0gZmFsc2U7XG4gIH1cblxuICBDb250ZW50RWRpdGFibGVJbnB1dC5wcm90b3R5cGUgPSBjb3B5T2JqKHtcbiAgICBpbml0OiBmdW5jdGlvbihkaXNwbGF5KSB7XG4gICAgICB2YXIgaW5wdXQgPSB0aGlzLCBjbSA9IGlucHV0LmNtO1xuICAgICAgdmFyIGRpdiA9IGlucHV0LmRpdiA9IGRpc3BsYXkubGluZURpdjtcbiAgICAgIGRpc2FibGVCcm93c2VyTWFnaWMoZGl2KTtcblxuICAgICAgb24oZGl2LCBcInBhc3RlXCIsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgaWYgKCFzaWduYWxET01FdmVudChjbSwgZSkpIGhhbmRsZVBhc3RlKGUsIGNtKTtcbiAgICAgIH0pXG5cbiAgICAgIG9uKGRpdiwgXCJjb21wb3NpdGlvbnN0YXJ0XCIsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgdmFyIGRhdGEgPSBlLmRhdGE7XG4gICAgICAgIGlucHV0LmNvbXBvc2luZyA9IHtzZWw6IGNtLmRvYy5zZWwsIGRhdGE6IGRhdGEsIHN0YXJ0RGF0YTogZGF0YX07XG4gICAgICAgIGlmICghZGF0YSkgcmV0dXJuO1xuICAgICAgICB2YXIgcHJpbSA9IGNtLmRvYy5zZWwucHJpbWFyeSgpO1xuICAgICAgICB2YXIgbGluZSA9IGNtLmdldExpbmUocHJpbS5oZWFkLmxpbmUpO1xuICAgICAgICB2YXIgZm91bmQgPSBsaW5lLmluZGV4T2YoZGF0YSwgTWF0aC5tYXgoMCwgcHJpbS5oZWFkLmNoIC0gZGF0YS5sZW5ndGgpKTtcbiAgICAgICAgaWYgKGZvdW5kID4gLTEgJiYgZm91bmQgPD0gcHJpbS5oZWFkLmNoKVxuICAgICAgICAgIGlucHV0LmNvbXBvc2luZy5zZWwgPSBzaW1wbGVTZWxlY3Rpb24oUG9zKHByaW0uaGVhZC5saW5lLCBmb3VuZCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQb3MocHJpbS5oZWFkLmxpbmUsIGZvdW5kICsgZGF0YS5sZW5ndGgpKTtcbiAgICAgIH0pO1xuICAgICAgb24oZGl2LCBcImNvbXBvc2l0aW9udXBkYXRlXCIsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgaW5wdXQuY29tcG9zaW5nLmRhdGEgPSBlLmRhdGE7XG4gICAgICB9KTtcbiAgICAgIG9uKGRpdiwgXCJjb21wb3NpdGlvbmVuZFwiLCBmdW5jdGlvbihlKSB7XG4gICAgICAgIHZhciBvdXJzID0gaW5wdXQuY29tcG9zaW5nO1xuICAgICAgICBpZiAoIW91cnMpIHJldHVybjtcbiAgICAgICAgaWYgKGUuZGF0YSAhPSBvdXJzLnN0YXJ0RGF0YSAmJiAhL1xcdTIwMGIvLnRlc3QoZS5kYXRhKSlcbiAgICAgICAgICBvdXJzLmRhdGEgPSBlLmRhdGE7XG4gICAgICAgIC8vIE5lZWQgYSBzbWFsbCBkZWxheSB0byBwcmV2ZW50IG90aGVyIGNvZGUgKGlucHV0IGV2ZW50LFxuICAgICAgICAvLyBzZWxlY3Rpb24gcG9sbGluZykgZnJvbSBkb2luZyBkYW1hZ2Ugd2hlbiBmaXJlZCByaWdodCBhZnRlclxuICAgICAgICAvLyBjb21wb3NpdGlvbmVuZC5cbiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICBpZiAoIW91cnMuaGFuZGxlZClcbiAgICAgICAgICAgIGlucHV0LmFwcGx5Q29tcG9zaXRpb24ob3Vycyk7XG4gICAgICAgICAgaWYgKGlucHV0LmNvbXBvc2luZyA9PSBvdXJzKVxuICAgICAgICAgICAgaW5wdXQuY29tcG9zaW5nID0gbnVsbDtcbiAgICAgICAgfSwgNTApO1xuICAgICAgfSk7XG5cbiAgICAgIG9uKGRpdiwgXCJ0b3VjaHN0YXJ0XCIsIGZ1bmN0aW9uKCkge1xuICAgICAgICBpbnB1dC5mb3JjZUNvbXBvc2l0aW9uRW5kKCk7XG4gICAgICB9KTtcblxuICAgICAgb24oZGl2LCBcImlucHV0XCIsIGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAoaW5wdXQuY29tcG9zaW5nKSByZXR1cm47XG4gICAgICAgIGlmIChjbS5pc1JlYWRPbmx5KCkgfHwgIWlucHV0LnBvbGxDb250ZW50KCkpXG4gICAgICAgICAgcnVuSW5PcChpbnB1dC5jbSwgZnVuY3Rpb24oKSB7cmVnQ2hhbmdlKGNtKTt9KTtcbiAgICAgIH0pO1xuXG4gICAgICBmdW5jdGlvbiBvbkNvcHlDdXQoZSkge1xuICAgICAgICBpZiAoc2lnbmFsRE9NRXZlbnQoY20sIGUpKSByZXR1cm5cbiAgICAgICAgaWYgKGNtLnNvbWV0aGluZ1NlbGVjdGVkKCkpIHtcbiAgICAgICAgICBsYXN0Q29waWVkID0gY20uZ2V0U2VsZWN0aW9ucygpO1xuICAgICAgICAgIGlmIChlLnR5cGUgPT0gXCJjdXRcIikgY20ucmVwbGFjZVNlbGVjdGlvbihcIlwiLCBudWxsLCBcImN1dFwiKTtcbiAgICAgICAgfSBlbHNlIGlmICghY20ub3B0aW9ucy5saW5lV2lzZUNvcHlDdXQpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdmFyIHJhbmdlcyA9IGNvcHlhYmxlUmFuZ2VzKGNtKTtcbiAgICAgICAgICBsYXN0Q29waWVkID0gcmFuZ2VzLnRleHQ7XG4gICAgICAgICAgaWYgKGUudHlwZSA9PSBcImN1dFwiKSB7XG4gICAgICAgICAgICBjbS5vcGVyYXRpb24oZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgIGNtLnNldFNlbGVjdGlvbnMocmFuZ2VzLnJhbmdlcywgMCwgc2VsX2RvbnRTY3JvbGwpO1xuICAgICAgICAgICAgICBjbS5yZXBsYWNlU2VsZWN0aW9uKFwiXCIsIG51bGwsIFwiY3V0XCIpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIGlPUyBleHBvc2VzIHRoZSBjbGlwYm9hcmQgQVBJLCBidXQgc2VlbXMgdG8gZGlzY2FyZCBjb250ZW50IGluc2VydGVkIGludG8gaXRcbiAgICAgICAgaWYgKGUuY2xpcGJvYXJkRGF0YSAmJiAhaW9zKSB7XG4gICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgIGUuY2xpcGJvYXJkRGF0YS5jbGVhckRhdGEoKTtcbiAgICAgICAgICBlLmNsaXBib2FyZERhdGEuc2V0RGF0YShcInRleHQvcGxhaW5cIiwgbGFzdENvcGllZC5qb2luKFwiXFxuXCIpKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBPbGQtZmFzaGlvbmVkIGJyaWVmbHktZm9jdXMtYS10ZXh0YXJlYSBoYWNrXG4gICAgICAgICAgdmFyIGtsdWRnZSA9IGhpZGRlblRleHRhcmVhKCksIHRlID0ga2x1ZGdlLmZpcnN0Q2hpbGQ7XG4gICAgICAgICAgY20uZGlzcGxheS5saW5lU3BhY2UuaW5zZXJ0QmVmb3JlKGtsdWRnZSwgY20uZGlzcGxheS5saW5lU3BhY2UuZmlyc3RDaGlsZCk7XG4gICAgICAgICAgdGUudmFsdWUgPSBsYXN0Q29waWVkLmpvaW4oXCJcXG5cIik7XG4gICAgICAgICAgdmFyIGhhZEZvY3VzID0gZG9jdW1lbnQuYWN0aXZlRWxlbWVudDtcbiAgICAgICAgICBzZWxlY3RJbnB1dCh0ZSk7XG4gICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGNtLmRpc3BsYXkubGluZVNwYWNlLnJlbW92ZUNoaWxkKGtsdWRnZSk7XG4gICAgICAgICAgICBoYWRGb2N1cy5mb2N1cygpO1xuICAgICAgICAgIH0sIDUwKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgb24oZGl2LCBcImNvcHlcIiwgb25Db3B5Q3V0KTtcbiAgICAgIG9uKGRpdiwgXCJjdXRcIiwgb25Db3B5Q3V0KTtcbiAgICB9LFxuXG4gICAgcHJlcGFyZVNlbGVjdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgcmVzdWx0ID0gcHJlcGFyZVNlbGVjdGlvbih0aGlzLmNtLCBmYWxzZSk7XG4gICAgICByZXN1bHQuZm9jdXMgPSB0aGlzLmNtLnN0YXRlLmZvY3VzZWQ7XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH0sXG5cbiAgICBzaG93U2VsZWN0aW9uOiBmdW5jdGlvbihpbmZvKSB7XG4gICAgICBpZiAoIWluZm8gfHwgIXRoaXMuY20uZGlzcGxheS52aWV3Lmxlbmd0aCkgcmV0dXJuO1xuICAgICAgaWYgKGluZm8uZm9jdXMpIHRoaXMuc2hvd1ByaW1hcnlTZWxlY3Rpb24oKTtcbiAgICAgIHRoaXMuc2hvd011bHRpcGxlU2VsZWN0aW9ucyhpbmZvKTtcbiAgICB9LFxuXG4gICAgc2hvd1ByaW1hcnlTZWxlY3Rpb246IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIHNlbCA9IHdpbmRvdy5nZXRTZWxlY3Rpb24oKSwgcHJpbSA9IHRoaXMuY20uZG9jLnNlbC5wcmltYXJ5KCk7XG4gICAgICB2YXIgY3VyQW5jaG9yID0gZG9tVG9Qb3ModGhpcy5jbSwgc2VsLmFuY2hvck5vZGUsIHNlbC5hbmNob3JPZmZzZXQpO1xuICAgICAgdmFyIGN1ckZvY3VzID0gZG9tVG9Qb3ModGhpcy5jbSwgc2VsLmZvY3VzTm9kZSwgc2VsLmZvY3VzT2Zmc2V0KTtcbiAgICAgIGlmIChjdXJBbmNob3IgJiYgIWN1ckFuY2hvci5iYWQgJiYgY3VyRm9jdXMgJiYgIWN1ckZvY3VzLmJhZCAmJlxuICAgICAgICAgIGNtcChtaW5Qb3MoY3VyQW5jaG9yLCBjdXJGb2N1cyksIHByaW0uZnJvbSgpKSA9PSAwICYmXG4gICAgICAgICAgY21wKG1heFBvcyhjdXJBbmNob3IsIGN1ckZvY3VzKSwgcHJpbS50bygpKSA9PSAwKVxuICAgICAgICByZXR1cm47XG5cbiAgICAgIHZhciBzdGFydCA9IHBvc1RvRE9NKHRoaXMuY20sIHByaW0uZnJvbSgpKTtcbiAgICAgIHZhciBlbmQgPSBwb3NUb0RPTSh0aGlzLmNtLCBwcmltLnRvKCkpO1xuICAgICAgaWYgKCFzdGFydCAmJiAhZW5kKSByZXR1cm47XG5cbiAgICAgIHZhciB2aWV3ID0gdGhpcy5jbS5kaXNwbGF5LnZpZXc7XG4gICAgICB2YXIgb2xkID0gc2VsLnJhbmdlQ291bnQgJiYgc2VsLmdldFJhbmdlQXQoMCk7XG4gICAgICBpZiAoIXN0YXJ0KSB7XG4gICAgICAgIHN0YXJ0ID0ge25vZGU6IHZpZXdbMF0ubWVhc3VyZS5tYXBbMl0sIG9mZnNldDogMH07XG4gICAgICB9IGVsc2UgaWYgKCFlbmQpIHsgLy8gRklYTUUgZGFuZ2Vyb3VzbHkgaGFja3lcbiAgICAgICAgdmFyIG1lYXN1cmUgPSB2aWV3W3ZpZXcubGVuZ3RoIC0gMV0ubWVhc3VyZTtcbiAgICAgICAgdmFyIG1hcCA9IG1lYXN1cmUubWFwcyA/IG1lYXN1cmUubWFwc1ttZWFzdXJlLm1hcHMubGVuZ3RoIC0gMV0gOiBtZWFzdXJlLm1hcDtcbiAgICAgICAgZW5kID0ge25vZGU6IG1hcFttYXAubGVuZ3RoIC0gMV0sIG9mZnNldDogbWFwW21hcC5sZW5ndGggLSAyXSAtIG1hcFttYXAubGVuZ3RoIC0gM119O1xuICAgICAgfVxuXG4gICAgICB0cnkgeyB2YXIgcm5nID0gcmFuZ2Uoc3RhcnQubm9kZSwgc3RhcnQub2Zmc2V0LCBlbmQub2Zmc2V0LCBlbmQubm9kZSk7IH1cbiAgICAgIGNhdGNoKGUpIHt9IC8vIE91ciBtb2RlbCBvZiB0aGUgRE9NIG1pZ2h0IGJlIG91dGRhdGVkLCBpbiB3aGljaCBjYXNlIHRoZSByYW5nZSB3ZSB0cnkgdG8gc2V0IGNhbiBiZSBpbXBvc3NpYmxlXG4gICAgICBpZiAocm5nKSB7XG4gICAgICAgIGlmICghZ2Vja28gJiYgdGhpcy5jbS5zdGF0ZS5mb2N1c2VkKSB7XG4gICAgICAgICAgc2VsLmNvbGxhcHNlKHN0YXJ0Lm5vZGUsIHN0YXJ0Lm9mZnNldCk7XG4gICAgICAgICAgaWYgKCFybmcuY29sbGFwc2VkKSBzZWwuYWRkUmFuZ2Uocm5nKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBzZWwucmVtb3ZlQWxsUmFuZ2VzKCk7XG4gICAgICAgICAgc2VsLmFkZFJhbmdlKHJuZyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG9sZCAmJiBzZWwuYW5jaG9yTm9kZSA9PSBudWxsKSBzZWwuYWRkUmFuZ2Uob2xkKTtcbiAgICAgICAgZWxzZSBpZiAoZ2Vja28pIHRoaXMuc3RhcnRHcmFjZVBlcmlvZCgpO1xuICAgICAgfVxuICAgICAgdGhpcy5yZW1lbWJlclNlbGVjdGlvbigpO1xuICAgIH0sXG5cbiAgICBzdGFydEdyYWNlUGVyaW9kOiBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBpbnB1dCA9IHRoaXM7XG4gICAgICBjbGVhclRpbWVvdXQodGhpcy5ncmFjZVBlcmlvZCk7XG4gICAgICB0aGlzLmdyYWNlUGVyaW9kID0gc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgaW5wdXQuZ3JhY2VQZXJpb2QgPSBmYWxzZTtcbiAgICAgICAgaWYgKGlucHV0LnNlbGVjdGlvbkNoYW5nZWQoKSlcbiAgICAgICAgICBpbnB1dC5jbS5vcGVyYXRpb24oZnVuY3Rpb24oKSB7IGlucHV0LmNtLmN1ck9wLnNlbGVjdGlvbkNoYW5nZWQgPSB0cnVlOyB9KTtcbiAgICAgIH0sIDIwKTtcbiAgICB9LFxuXG4gICAgc2hvd011bHRpcGxlU2VsZWN0aW9uczogZnVuY3Rpb24oaW5mbykge1xuICAgICAgcmVtb3ZlQ2hpbGRyZW5BbmRBZGQodGhpcy5jbS5kaXNwbGF5LmN1cnNvckRpdiwgaW5mby5jdXJzb3JzKTtcbiAgICAgIHJlbW92ZUNoaWxkcmVuQW5kQWRkKHRoaXMuY20uZGlzcGxheS5zZWxlY3Rpb25EaXYsIGluZm8uc2VsZWN0aW9uKTtcbiAgICB9LFxuXG4gICAgcmVtZW1iZXJTZWxlY3Rpb246IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIHNlbCA9IHdpbmRvdy5nZXRTZWxlY3Rpb24oKTtcbiAgICAgIHRoaXMubGFzdEFuY2hvck5vZGUgPSBzZWwuYW5jaG9yTm9kZTsgdGhpcy5sYXN0QW5jaG9yT2Zmc2V0ID0gc2VsLmFuY2hvck9mZnNldDtcbiAgICAgIHRoaXMubGFzdEZvY3VzTm9kZSA9IHNlbC5mb2N1c05vZGU7IHRoaXMubGFzdEZvY3VzT2Zmc2V0ID0gc2VsLmZvY3VzT2Zmc2V0O1xuICAgIH0sXG5cbiAgICBzZWxlY3Rpb25JbkVkaXRvcjogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgc2VsID0gd2luZG93LmdldFNlbGVjdGlvbigpO1xuICAgICAgaWYgKCFzZWwucmFuZ2VDb3VudCkgcmV0dXJuIGZhbHNlO1xuICAgICAgdmFyIG5vZGUgPSBzZWwuZ2V0UmFuZ2VBdCgwKS5jb21tb25BbmNlc3RvckNvbnRhaW5lcjtcbiAgICAgIHJldHVybiBjb250YWlucyh0aGlzLmRpdiwgbm9kZSk7XG4gICAgfSxcblxuICAgIGZvY3VzOiBmdW5jdGlvbigpIHtcbiAgICAgIGlmICh0aGlzLmNtLm9wdGlvbnMucmVhZE9ubHkgIT0gXCJub2N1cnNvclwiKSB0aGlzLmRpdi5mb2N1cygpO1xuICAgIH0sXG4gICAgYmx1cjogZnVuY3Rpb24oKSB7IHRoaXMuZGl2LmJsdXIoKTsgfSxcbiAgICBnZXRGaWVsZDogZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzLmRpdjsgfSxcblxuICAgIHN1cHBvcnRzVG91Y2g6IGZ1bmN0aW9uKCkgeyByZXR1cm4gdHJ1ZTsgfSxcblxuICAgIHJlY2VpdmVkRm9jdXM6IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGlucHV0ID0gdGhpcztcbiAgICAgIGlmICh0aGlzLnNlbGVjdGlvbkluRWRpdG9yKCkpXG4gICAgICAgIHRoaXMucG9sbFNlbGVjdGlvbigpO1xuICAgICAgZWxzZVxuICAgICAgICBydW5Jbk9wKHRoaXMuY20sIGZ1bmN0aW9uKCkgeyBpbnB1dC5jbS5jdXJPcC5zZWxlY3Rpb25DaGFuZ2VkID0gdHJ1ZTsgfSk7XG5cbiAgICAgIGZ1bmN0aW9uIHBvbGwoKSB7XG4gICAgICAgIGlmIChpbnB1dC5jbS5zdGF0ZS5mb2N1c2VkKSB7XG4gICAgICAgICAgaW5wdXQucG9sbFNlbGVjdGlvbigpO1xuICAgICAgICAgIGlucHV0LnBvbGxpbmcuc2V0KGlucHV0LmNtLm9wdGlvbnMucG9sbEludGVydmFsLCBwb2xsKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgdGhpcy5wb2xsaW5nLnNldCh0aGlzLmNtLm9wdGlvbnMucG9sbEludGVydmFsLCBwb2xsKTtcbiAgICB9LFxuXG4gICAgc2VsZWN0aW9uQ2hhbmdlZDogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgc2VsID0gd2luZG93LmdldFNlbGVjdGlvbigpO1xuICAgICAgcmV0dXJuIHNlbC5hbmNob3JOb2RlICE9IHRoaXMubGFzdEFuY2hvck5vZGUgfHwgc2VsLmFuY2hvck9mZnNldCAhPSB0aGlzLmxhc3RBbmNob3JPZmZzZXQgfHxcbiAgICAgICAgc2VsLmZvY3VzTm9kZSAhPSB0aGlzLmxhc3RGb2N1c05vZGUgfHwgc2VsLmZvY3VzT2Zmc2V0ICE9IHRoaXMubGFzdEZvY3VzT2Zmc2V0O1xuICAgIH0sXG5cbiAgICBwb2xsU2VsZWN0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgIGlmICghdGhpcy5jb21wb3NpbmcgJiYgIXRoaXMuZ3JhY2VQZXJpb2QgJiYgdGhpcy5zZWxlY3Rpb25DaGFuZ2VkKCkpIHtcbiAgICAgICAgdmFyIHNlbCA9IHdpbmRvdy5nZXRTZWxlY3Rpb24oKSwgY20gPSB0aGlzLmNtO1xuICAgICAgICB0aGlzLnJlbWVtYmVyU2VsZWN0aW9uKCk7XG4gICAgICAgIHZhciBhbmNob3IgPSBkb21Ub1BvcyhjbSwgc2VsLmFuY2hvck5vZGUsIHNlbC5hbmNob3JPZmZzZXQpO1xuICAgICAgICB2YXIgaGVhZCA9IGRvbVRvUG9zKGNtLCBzZWwuZm9jdXNOb2RlLCBzZWwuZm9jdXNPZmZzZXQpO1xuICAgICAgICBpZiAoYW5jaG9yICYmIGhlYWQpIHJ1bkluT3AoY20sIGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHNldFNlbGVjdGlvbihjbS5kb2MsIHNpbXBsZVNlbGVjdGlvbihhbmNob3IsIGhlYWQpLCBzZWxfZG9udFNjcm9sbCk7XG4gICAgICAgICAgaWYgKGFuY2hvci5iYWQgfHwgaGVhZC5iYWQpIGNtLmN1ck9wLnNlbGVjdGlvbkNoYW5nZWQgPSB0cnVlO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgcG9sbENvbnRlbnQ6IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGNtID0gdGhpcy5jbSwgZGlzcGxheSA9IGNtLmRpc3BsYXksIHNlbCA9IGNtLmRvYy5zZWwucHJpbWFyeSgpO1xuICAgICAgdmFyIGZyb20gPSBzZWwuZnJvbSgpLCB0byA9IHNlbC50bygpO1xuICAgICAgaWYgKGZyb20ubGluZSA8IGRpc3BsYXkudmlld0Zyb20gfHwgdG8ubGluZSA+IGRpc3BsYXkudmlld1RvIC0gMSkgcmV0dXJuIGZhbHNlO1xuXG4gICAgICB2YXIgZnJvbUluZGV4O1xuICAgICAgaWYgKGZyb20ubGluZSA9PSBkaXNwbGF5LnZpZXdGcm9tIHx8IChmcm9tSW5kZXggPSBmaW5kVmlld0luZGV4KGNtLCBmcm9tLmxpbmUpKSA9PSAwKSB7XG4gICAgICAgIHZhciBmcm9tTGluZSA9IGxpbmVObyhkaXNwbGF5LnZpZXdbMF0ubGluZSk7XG4gICAgICAgIHZhciBmcm9tTm9kZSA9IGRpc3BsYXkudmlld1swXS5ub2RlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIGZyb21MaW5lID0gbGluZU5vKGRpc3BsYXkudmlld1tmcm9tSW5kZXhdLmxpbmUpO1xuICAgICAgICB2YXIgZnJvbU5vZGUgPSBkaXNwbGF5LnZpZXdbZnJvbUluZGV4IC0gMV0ubm9kZS5uZXh0U2libGluZztcbiAgICAgIH1cbiAgICAgIHZhciB0b0luZGV4ID0gZmluZFZpZXdJbmRleChjbSwgdG8ubGluZSk7XG4gICAgICBpZiAodG9JbmRleCA9PSBkaXNwbGF5LnZpZXcubGVuZ3RoIC0gMSkge1xuICAgICAgICB2YXIgdG9MaW5lID0gZGlzcGxheS52aWV3VG8gLSAxO1xuICAgICAgICB2YXIgdG9Ob2RlID0gZGlzcGxheS5saW5lRGl2Lmxhc3RDaGlsZDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciB0b0xpbmUgPSBsaW5lTm8oZGlzcGxheS52aWV3W3RvSW5kZXggKyAxXS5saW5lKSAtIDE7XG4gICAgICAgIHZhciB0b05vZGUgPSBkaXNwbGF5LnZpZXdbdG9JbmRleCArIDFdLm5vZGUucHJldmlvdXNTaWJsaW5nO1xuICAgICAgfVxuXG4gICAgICB2YXIgbmV3VGV4dCA9IGNtLmRvYy5zcGxpdExpbmVzKGRvbVRleHRCZXR3ZWVuKGNtLCBmcm9tTm9kZSwgdG9Ob2RlLCBmcm9tTGluZSwgdG9MaW5lKSk7XG4gICAgICB2YXIgb2xkVGV4dCA9IGdldEJldHdlZW4oY20uZG9jLCBQb3MoZnJvbUxpbmUsIDApLCBQb3ModG9MaW5lLCBnZXRMaW5lKGNtLmRvYywgdG9MaW5lKS50ZXh0Lmxlbmd0aCkpO1xuICAgICAgd2hpbGUgKG5ld1RleHQubGVuZ3RoID4gMSAmJiBvbGRUZXh0Lmxlbmd0aCA+IDEpIHtcbiAgICAgICAgaWYgKGxzdChuZXdUZXh0KSA9PSBsc3Qob2xkVGV4dCkpIHsgbmV3VGV4dC5wb3AoKTsgb2xkVGV4dC5wb3AoKTsgdG9MaW5lLS07IH1cbiAgICAgICAgZWxzZSBpZiAobmV3VGV4dFswXSA9PSBvbGRUZXh0WzBdKSB7IG5ld1RleHQuc2hpZnQoKTsgb2xkVGV4dC5zaGlmdCgpOyBmcm9tTGluZSsrOyB9XG4gICAgICAgIGVsc2UgYnJlYWs7XG4gICAgICB9XG5cbiAgICAgIHZhciBjdXRGcm9udCA9IDAsIGN1dEVuZCA9IDA7XG4gICAgICB2YXIgbmV3VG9wID0gbmV3VGV4dFswXSwgb2xkVG9wID0gb2xkVGV4dFswXSwgbWF4Q3V0RnJvbnQgPSBNYXRoLm1pbihuZXdUb3AubGVuZ3RoLCBvbGRUb3AubGVuZ3RoKTtcbiAgICAgIHdoaWxlIChjdXRGcm9udCA8IG1heEN1dEZyb250ICYmIG5ld1RvcC5jaGFyQ29kZUF0KGN1dEZyb250KSA9PSBvbGRUb3AuY2hhckNvZGVBdChjdXRGcm9udCkpXG4gICAgICAgICsrY3V0RnJvbnQ7XG4gICAgICB2YXIgbmV3Qm90ID0gbHN0KG5ld1RleHQpLCBvbGRCb3QgPSBsc3Qob2xkVGV4dCk7XG4gICAgICB2YXIgbWF4Q3V0RW5kID0gTWF0aC5taW4obmV3Qm90Lmxlbmd0aCAtIChuZXdUZXh0Lmxlbmd0aCA9PSAxID8gY3V0RnJvbnQgOiAwKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbGRCb3QubGVuZ3RoIC0gKG9sZFRleHQubGVuZ3RoID09IDEgPyBjdXRGcm9udCA6IDApKTtcbiAgICAgIHdoaWxlIChjdXRFbmQgPCBtYXhDdXRFbmQgJiZcbiAgICAgICAgICAgICBuZXdCb3QuY2hhckNvZGVBdChuZXdCb3QubGVuZ3RoIC0gY3V0RW5kIC0gMSkgPT0gb2xkQm90LmNoYXJDb2RlQXQob2xkQm90Lmxlbmd0aCAtIGN1dEVuZCAtIDEpKVxuICAgICAgICArK2N1dEVuZDtcblxuICAgICAgbmV3VGV4dFtuZXdUZXh0Lmxlbmd0aCAtIDFdID0gbmV3Qm90LnNsaWNlKDAsIG5ld0JvdC5sZW5ndGggLSBjdXRFbmQpO1xuICAgICAgbmV3VGV4dFswXSA9IG5ld1RleHRbMF0uc2xpY2UoY3V0RnJvbnQpO1xuXG4gICAgICB2YXIgY2hGcm9tID0gUG9zKGZyb21MaW5lLCBjdXRGcm9udCk7XG4gICAgICB2YXIgY2hUbyA9IFBvcyh0b0xpbmUsIG9sZFRleHQubGVuZ3RoID8gbHN0KG9sZFRleHQpLmxlbmd0aCAtIGN1dEVuZCA6IDApO1xuICAgICAgaWYgKG5ld1RleHQubGVuZ3RoID4gMSB8fCBuZXdUZXh0WzBdIHx8IGNtcChjaEZyb20sIGNoVG8pKSB7XG4gICAgICAgIHJlcGxhY2VSYW5nZShjbS5kb2MsIG5ld1RleHQsIGNoRnJvbSwgY2hUbywgXCIraW5wdXRcIik7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICBlbnN1cmVQb2xsZWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy5mb3JjZUNvbXBvc2l0aW9uRW5kKCk7XG4gICAgfSxcbiAgICByZXNldDogZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLmZvcmNlQ29tcG9zaXRpb25FbmQoKTtcbiAgICB9LFxuICAgIGZvcmNlQ29tcG9zaXRpb25FbmQ6IGZ1bmN0aW9uKCkge1xuICAgICAgaWYgKCF0aGlzLmNvbXBvc2luZyB8fCB0aGlzLmNvbXBvc2luZy5oYW5kbGVkKSByZXR1cm47XG4gICAgICB0aGlzLmFwcGx5Q29tcG9zaXRpb24odGhpcy5jb21wb3NpbmcpO1xuICAgICAgdGhpcy5jb21wb3NpbmcuaGFuZGxlZCA9IHRydWU7XG4gICAgICB0aGlzLmRpdi5ibHVyKCk7XG4gICAgICB0aGlzLmRpdi5mb2N1cygpO1xuICAgIH0sXG4gICAgYXBwbHlDb21wb3NpdGlvbjogZnVuY3Rpb24oY29tcG9zaW5nKSB7XG4gICAgICBpZiAodGhpcy5jbS5pc1JlYWRPbmx5KCkpXG4gICAgICAgIG9wZXJhdGlvbih0aGlzLmNtLCByZWdDaGFuZ2UpKHRoaXMuY20pXG4gICAgICBlbHNlIGlmIChjb21wb3NpbmcuZGF0YSAmJiBjb21wb3NpbmcuZGF0YSAhPSBjb21wb3Npbmcuc3RhcnREYXRhKVxuICAgICAgICBvcGVyYXRpb24odGhpcy5jbSwgYXBwbHlUZXh0SW5wdXQpKHRoaXMuY20sIGNvbXBvc2luZy5kYXRhLCAwLCBjb21wb3Npbmcuc2VsKTtcbiAgICB9LFxuXG4gICAgc2V0VW5lZGl0YWJsZTogZnVuY3Rpb24obm9kZSkge1xuICAgICAgbm9kZS5jb250ZW50RWRpdGFibGUgPSBcImZhbHNlXCJcbiAgICB9LFxuXG4gICAgb25LZXlQcmVzczogZnVuY3Rpb24oZSkge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgaWYgKCF0aGlzLmNtLmlzUmVhZE9ubHkoKSlcbiAgICAgICAgb3BlcmF0aW9uKHRoaXMuY20sIGFwcGx5VGV4dElucHV0KSh0aGlzLmNtLCBTdHJpbmcuZnJvbUNoYXJDb2RlKGUuY2hhckNvZGUgPT0gbnVsbCA/IGUua2V5Q29kZSA6IGUuY2hhckNvZGUpLCAwKTtcbiAgICB9LFxuXG4gICAgcmVhZE9ubHlDaGFuZ2VkOiBmdW5jdGlvbih2YWwpIHtcbiAgICAgIHRoaXMuZGl2LmNvbnRlbnRFZGl0YWJsZSA9IFN0cmluZyh2YWwgIT0gXCJub2N1cnNvclwiKVxuICAgIH0sXG5cbiAgICBvbkNvbnRleHRNZW51OiBub3RoaW5nLFxuICAgIHJlc2V0UG9zaXRpb246IG5vdGhpbmcsXG5cbiAgICBuZWVkc0NvbnRlbnRBdHRyaWJ1dGU6IHRydWVcbiAgfSwgQ29udGVudEVkaXRhYmxlSW5wdXQucHJvdG90eXBlKTtcblxuICBmdW5jdGlvbiBwb3NUb0RPTShjbSwgcG9zKSB7XG4gICAgdmFyIHZpZXcgPSBmaW5kVmlld0ZvckxpbmUoY20sIHBvcy5saW5lKTtcbiAgICBpZiAoIXZpZXcgfHwgdmlldy5oaWRkZW4pIHJldHVybiBudWxsO1xuICAgIHZhciBsaW5lID0gZ2V0TGluZShjbS5kb2MsIHBvcy5saW5lKTtcbiAgICB2YXIgaW5mbyA9IG1hcEZyb21MaW5lVmlldyh2aWV3LCBsaW5lLCBwb3MubGluZSk7XG5cbiAgICB2YXIgb3JkZXIgPSBnZXRPcmRlcihsaW5lKSwgc2lkZSA9IFwibGVmdFwiO1xuICAgIGlmIChvcmRlcikge1xuICAgICAgdmFyIHBhcnRQb3MgPSBnZXRCaWRpUGFydEF0KG9yZGVyLCBwb3MuY2gpO1xuICAgICAgc2lkZSA9IHBhcnRQb3MgJSAyID8gXCJyaWdodFwiIDogXCJsZWZ0XCI7XG4gICAgfVxuICAgIHZhciByZXN1bHQgPSBub2RlQW5kT2Zmc2V0SW5MaW5lTWFwKGluZm8ubWFwLCBwb3MuY2gsIHNpZGUpO1xuICAgIHJlc3VsdC5vZmZzZXQgPSByZXN1bHQuY29sbGFwc2UgPT0gXCJyaWdodFwiID8gcmVzdWx0LmVuZCA6IHJlc3VsdC5zdGFydDtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgZnVuY3Rpb24gYmFkUG9zKHBvcywgYmFkKSB7IGlmIChiYWQpIHBvcy5iYWQgPSB0cnVlOyByZXR1cm4gcG9zOyB9XG5cbiAgZnVuY3Rpb24gZG9tVG9Qb3MoY20sIG5vZGUsIG9mZnNldCkge1xuICAgIHZhciBsaW5lTm9kZTtcbiAgICBpZiAobm9kZSA9PSBjbS5kaXNwbGF5LmxpbmVEaXYpIHtcbiAgICAgIGxpbmVOb2RlID0gY20uZGlzcGxheS5saW5lRGl2LmNoaWxkTm9kZXNbb2Zmc2V0XTtcbiAgICAgIGlmICghbGluZU5vZGUpIHJldHVybiBiYWRQb3MoY20uY2xpcFBvcyhQb3MoY20uZGlzcGxheS52aWV3VG8gLSAxKSksIHRydWUpO1xuICAgICAgbm9kZSA9IG51bGw7IG9mZnNldCA9IDA7XG4gICAgfSBlbHNlIHtcbiAgICAgIGZvciAobGluZU5vZGUgPSBub2RlOzsgbGluZU5vZGUgPSBsaW5lTm9kZS5wYXJlbnROb2RlKSB7XG4gICAgICAgIGlmICghbGluZU5vZGUgfHwgbGluZU5vZGUgPT0gY20uZGlzcGxheS5saW5lRGl2KSByZXR1cm4gbnVsbDtcbiAgICAgICAgaWYgKGxpbmVOb2RlLnBhcmVudE5vZGUgJiYgbGluZU5vZGUucGFyZW50Tm9kZSA9PSBjbS5kaXNwbGF5LmxpbmVEaXYpIGJyZWFrO1xuICAgICAgfVxuICAgIH1cbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNtLmRpc3BsYXkudmlldy5sZW5ndGg7IGkrKykge1xuICAgICAgdmFyIGxpbmVWaWV3ID0gY20uZGlzcGxheS52aWV3W2ldO1xuICAgICAgaWYgKGxpbmVWaWV3Lm5vZGUgPT0gbGluZU5vZGUpXG4gICAgICAgIHJldHVybiBsb2NhdGVOb2RlSW5MaW5lVmlldyhsaW5lVmlldywgbm9kZSwgb2Zmc2V0KTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBsb2NhdGVOb2RlSW5MaW5lVmlldyhsaW5lVmlldywgbm9kZSwgb2Zmc2V0KSB7XG4gICAgdmFyIHdyYXBwZXIgPSBsaW5lVmlldy50ZXh0LmZpcnN0Q2hpbGQsIGJhZCA9IGZhbHNlO1xuICAgIGlmICghbm9kZSB8fCAhY29udGFpbnMod3JhcHBlciwgbm9kZSkpIHJldHVybiBiYWRQb3MoUG9zKGxpbmVObyhsaW5lVmlldy5saW5lKSwgMCksIHRydWUpO1xuICAgIGlmIChub2RlID09IHdyYXBwZXIpIHtcbiAgICAgIGJhZCA9IHRydWU7XG4gICAgICBub2RlID0gd3JhcHBlci5jaGlsZE5vZGVzW29mZnNldF07XG4gICAgICBvZmZzZXQgPSAwO1xuICAgICAgaWYgKCFub2RlKSB7XG4gICAgICAgIHZhciBsaW5lID0gbGluZVZpZXcucmVzdCA/IGxzdChsaW5lVmlldy5yZXN0KSA6IGxpbmVWaWV3LmxpbmU7XG4gICAgICAgIHJldHVybiBiYWRQb3MoUG9zKGxpbmVObyhsaW5lKSwgbGluZS50ZXh0Lmxlbmd0aCksIGJhZCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgdmFyIHRleHROb2RlID0gbm9kZS5ub2RlVHlwZSA9PSAzID8gbm9kZSA6IG51bGwsIHRvcE5vZGUgPSBub2RlO1xuICAgIGlmICghdGV4dE5vZGUgJiYgbm9kZS5jaGlsZE5vZGVzLmxlbmd0aCA9PSAxICYmIG5vZGUuZmlyc3RDaGlsZC5ub2RlVHlwZSA9PSAzKSB7XG4gICAgICB0ZXh0Tm9kZSA9IG5vZGUuZmlyc3RDaGlsZDtcbiAgICAgIGlmIChvZmZzZXQpIG9mZnNldCA9IHRleHROb2RlLm5vZGVWYWx1ZS5sZW5ndGg7XG4gICAgfVxuICAgIHdoaWxlICh0b3BOb2RlLnBhcmVudE5vZGUgIT0gd3JhcHBlcikgdG9wTm9kZSA9IHRvcE5vZGUucGFyZW50Tm9kZTtcbiAgICB2YXIgbWVhc3VyZSA9IGxpbmVWaWV3Lm1lYXN1cmUsIG1hcHMgPSBtZWFzdXJlLm1hcHM7XG5cbiAgICBmdW5jdGlvbiBmaW5kKHRleHROb2RlLCB0b3BOb2RlLCBvZmZzZXQpIHtcbiAgICAgIGZvciAodmFyIGkgPSAtMTsgaSA8IChtYXBzID8gbWFwcy5sZW5ndGggOiAwKTsgaSsrKSB7XG4gICAgICAgIHZhciBtYXAgPSBpIDwgMCA/IG1lYXN1cmUubWFwIDogbWFwc1tpXTtcbiAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBtYXAubGVuZ3RoOyBqICs9IDMpIHtcbiAgICAgICAgICB2YXIgY3VyTm9kZSA9IG1hcFtqICsgMl07XG4gICAgICAgICAgaWYgKGN1ck5vZGUgPT0gdGV4dE5vZGUgfHwgY3VyTm9kZSA9PSB0b3BOb2RlKSB7XG4gICAgICAgICAgICB2YXIgbGluZSA9IGxpbmVObyhpIDwgMCA/IGxpbmVWaWV3LmxpbmUgOiBsaW5lVmlldy5yZXN0W2ldKTtcbiAgICAgICAgICAgIHZhciBjaCA9IG1hcFtqXSArIG9mZnNldDtcbiAgICAgICAgICAgIGlmIChvZmZzZXQgPCAwIHx8IGN1ck5vZGUgIT0gdGV4dE5vZGUpIGNoID0gbWFwW2ogKyAob2Zmc2V0ID8gMSA6IDApXTtcbiAgICAgICAgICAgIHJldHVybiBQb3MobGluZSwgY2gpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICB2YXIgZm91bmQgPSBmaW5kKHRleHROb2RlLCB0b3BOb2RlLCBvZmZzZXQpO1xuICAgIGlmIChmb3VuZCkgcmV0dXJuIGJhZFBvcyhmb3VuZCwgYmFkKTtcblxuICAgIC8vIEZJWE1FIHRoaXMgaXMgYWxsIHJlYWxseSBzaGFreS4gbWlnaHQgaGFuZGxlIHRoZSBmZXcgY2FzZXMgaXQgbmVlZHMgdG8gaGFuZGxlLCBidXQgbGlrZWx5IHRvIGNhdXNlIHByb2JsZW1zXG4gICAgZm9yICh2YXIgYWZ0ZXIgPSB0b3BOb2RlLm5leHRTaWJsaW5nLCBkaXN0ID0gdGV4dE5vZGUgPyB0ZXh0Tm9kZS5ub2RlVmFsdWUubGVuZ3RoIC0gb2Zmc2V0IDogMDsgYWZ0ZXI7IGFmdGVyID0gYWZ0ZXIubmV4dFNpYmxpbmcpIHtcbiAgICAgIGZvdW5kID0gZmluZChhZnRlciwgYWZ0ZXIuZmlyc3RDaGlsZCwgMCk7XG4gICAgICBpZiAoZm91bmQpXG4gICAgICAgIHJldHVybiBiYWRQb3MoUG9zKGZvdW5kLmxpbmUsIGZvdW5kLmNoIC0gZGlzdCksIGJhZCk7XG4gICAgICBlbHNlXG4gICAgICAgIGRpc3QgKz0gYWZ0ZXIudGV4dENvbnRlbnQubGVuZ3RoO1xuICAgIH1cbiAgICBmb3IgKHZhciBiZWZvcmUgPSB0b3BOb2RlLnByZXZpb3VzU2libGluZywgZGlzdCA9IG9mZnNldDsgYmVmb3JlOyBiZWZvcmUgPSBiZWZvcmUucHJldmlvdXNTaWJsaW5nKSB7XG4gICAgICBmb3VuZCA9IGZpbmQoYmVmb3JlLCBiZWZvcmUuZmlyc3RDaGlsZCwgLTEpO1xuICAgICAgaWYgKGZvdW5kKVxuICAgICAgICByZXR1cm4gYmFkUG9zKFBvcyhmb3VuZC5saW5lLCBmb3VuZC5jaCArIGRpc3QpLCBiYWQpO1xuICAgICAgZWxzZVxuICAgICAgICBkaXN0ICs9IGFmdGVyLnRleHRDb250ZW50Lmxlbmd0aDtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBkb21UZXh0QmV0d2VlbihjbSwgZnJvbSwgdG8sIGZyb21MaW5lLCB0b0xpbmUpIHtcbiAgICB2YXIgdGV4dCA9IFwiXCIsIGNsb3NpbmcgPSBmYWxzZSwgbGluZVNlcCA9IGNtLmRvYy5saW5lU2VwYXJhdG9yKCk7XG4gICAgZnVuY3Rpb24gcmVjb2duaXplTWFya2VyKGlkKSB7IHJldHVybiBmdW5jdGlvbihtYXJrZXIpIHsgcmV0dXJuIG1hcmtlci5pZCA9PSBpZDsgfTsgfVxuICAgIGZ1bmN0aW9uIHdhbGsobm9kZSkge1xuICAgICAgaWYgKG5vZGUubm9kZVR5cGUgPT0gMSkge1xuICAgICAgICB2YXIgY21UZXh0ID0gbm9kZS5nZXRBdHRyaWJ1dGUoXCJjbS10ZXh0XCIpO1xuICAgICAgICBpZiAoY21UZXh0ICE9IG51bGwpIHtcbiAgICAgICAgICBpZiAoY21UZXh0ID09IFwiXCIpIGNtVGV4dCA9IG5vZGUudGV4dENvbnRlbnQucmVwbGFjZSgvXFx1MjAwYi9nLCBcIlwiKTtcbiAgICAgICAgICB0ZXh0ICs9IGNtVGV4dDtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdmFyIG1hcmtlcklEID0gbm9kZS5nZXRBdHRyaWJ1dGUoXCJjbS1tYXJrZXJcIiksIHJhbmdlO1xuICAgICAgICBpZiAobWFya2VySUQpIHtcbiAgICAgICAgICB2YXIgZm91bmQgPSBjbS5maW5kTWFya3MoUG9zKGZyb21MaW5lLCAwKSwgUG9zKHRvTGluZSArIDEsIDApLCByZWNvZ25pemVNYXJrZXIoK21hcmtlcklEKSk7XG4gICAgICAgICAgaWYgKGZvdW5kLmxlbmd0aCAmJiAocmFuZ2UgPSBmb3VuZFswXS5maW5kKCkpKVxuICAgICAgICAgICAgdGV4dCArPSBnZXRCZXR3ZWVuKGNtLmRvYywgcmFuZ2UuZnJvbSwgcmFuZ2UudG8pLmpvaW4obGluZVNlcCk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChub2RlLmdldEF0dHJpYnV0ZShcImNvbnRlbnRlZGl0YWJsZVwiKSA9PSBcImZhbHNlXCIpIHJldHVybjtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBub2RlLmNoaWxkTm9kZXMubGVuZ3RoOyBpKyspXG4gICAgICAgICAgd2Fsayhub2RlLmNoaWxkTm9kZXNbaV0pO1xuICAgICAgICBpZiAoL14ocHJlfGRpdnxwKSQvaS50ZXN0KG5vZGUubm9kZU5hbWUpKVxuICAgICAgICAgIGNsb3NpbmcgPSB0cnVlO1xuICAgICAgfSBlbHNlIGlmIChub2RlLm5vZGVUeXBlID09IDMpIHtcbiAgICAgICAgdmFyIHZhbCA9IG5vZGUubm9kZVZhbHVlO1xuICAgICAgICBpZiAoIXZhbCkgcmV0dXJuO1xuICAgICAgICBpZiAoY2xvc2luZykge1xuICAgICAgICAgIHRleHQgKz0gbGluZVNlcDtcbiAgICAgICAgICBjbG9zaW5nID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgdGV4dCArPSB2YWw7XG4gICAgICB9XG4gICAgfVxuICAgIGZvciAoOzspIHtcbiAgICAgIHdhbGsoZnJvbSk7XG4gICAgICBpZiAoZnJvbSA9PSB0bykgYnJlYWs7XG4gICAgICBmcm9tID0gZnJvbS5uZXh0U2libGluZztcbiAgICB9XG4gICAgcmV0dXJuIHRleHQ7XG4gIH1cblxuICBDb2RlTWlycm9yLmlucHV0U3R5bGVzID0ge1widGV4dGFyZWFcIjogVGV4dGFyZWFJbnB1dCwgXCJjb250ZW50ZWRpdGFibGVcIjogQ29udGVudEVkaXRhYmxlSW5wdXR9O1xuXG4gIC8vIFNFTEVDVElPTiAvIENVUlNPUlxuXG4gIC8vIFNlbGVjdGlvbiBvYmplY3RzIGFyZSBpbW11dGFibGUuIEEgbmV3IG9uZSBpcyBjcmVhdGVkIGV2ZXJ5IHRpbWVcbiAgLy8gdGhlIHNlbGVjdGlvbiBjaGFuZ2VzLiBBIHNlbGVjdGlvbiBpcyBvbmUgb3IgbW9yZSBub24tb3ZlcmxhcHBpbmdcbiAgLy8gKGFuZCBub24tdG91Y2hpbmcpIHJhbmdlcywgc29ydGVkLCBhbmQgYW4gaW50ZWdlciB0aGF0IGluZGljYXRlc1xuICAvLyB3aGljaCBvbmUgaXMgdGhlIHByaW1hcnkgc2VsZWN0aW9uICh0aGUgb25lIHRoYXQncyBzY3JvbGxlZCBpbnRvXG4gIC8vIHZpZXcsIHRoYXQgZ2V0Q3Vyc29yIHJldHVybnMsIGV0YykuXG4gIGZ1bmN0aW9uIFNlbGVjdGlvbihyYW5nZXMsIHByaW1JbmRleCkge1xuICAgIHRoaXMucmFuZ2VzID0gcmFuZ2VzO1xuICAgIHRoaXMucHJpbUluZGV4ID0gcHJpbUluZGV4O1xuICB9XG5cbiAgU2VsZWN0aW9uLnByb3RvdHlwZSA9IHtcbiAgICBwcmltYXJ5OiBmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXMucmFuZ2VzW3RoaXMucHJpbUluZGV4XTsgfSxcbiAgICBlcXVhbHM6IGZ1bmN0aW9uKG90aGVyKSB7XG4gICAgICBpZiAob3RoZXIgPT0gdGhpcykgcmV0dXJuIHRydWU7XG4gICAgICBpZiAob3RoZXIucHJpbUluZGV4ICE9IHRoaXMucHJpbUluZGV4IHx8IG90aGVyLnJhbmdlcy5sZW5ndGggIT0gdGhpcy5yYW5nZXMubGVuZ3RoKSByZXR1cm4gZmFsc2U7XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMucmFuZ2VzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHZhciBoZXJlID0gdGhpcy5yYW5nZXNbaV0sIHRoZXJlID0gb3RoZXIucmFuZ2VzW2ldO1xuICAgICAgICBpZiAoY21wKGhlcmUuYW5jaG9yLCB0aGVyZS5hbmNob3IpICE9IDAgfHwgY21wKGhlcmUuaGVhZCwgdGhlcmUuaGVhZCkgIT0gMCkgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSxcbiAgICBkZWVwQ29weTogZnVuY3Rpb24oKSB7XG4gICAgICBmb3IgKHZhciBvdXQgPSBbXSwgaSA9IDA7IGkgPCB0aGlzLnJhbmdlcy5sZW5ndGg7IGkrKylcbiAgICAgICAgb3V0W2ldID0gbmV3IFJhbmdlKGNvcHlQb3ModGhpcy5yYW5nZXNbaV0uYW5jaG9yKSwgY29weVBvcyh0aGlzLnJhbmdlc1tpXS5oZWFkKSk7XG4gICAgICByZXR1cm4gbmV3IFNlbGVjdGlvbihvdXQsIHRoaXMucHJpbUluZGV4KTtcbiAgICB9LFxuICAgIHNvbWV0aGluZ1NlbGVjdGVkOiBmdW5jdGlvbigpIHtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5yYW5nZXMubGVuZ3RoOyBpKyspXG4gICAgICAgIGlmICghdGhpcy5yYW5nZXNbaV0uZW1wdHkoKSkgcmV0dXJuIHRydWU7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSxcbiAgICBjb250YWluczogZnVuY3Rpb24ocG9zLCBlbmQpIHtcbiAgICAgIGlmICghZW5kKSBlbmQgPSBwb3M7XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMucmFuZ2VzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHZhciByYW5nZSA9IHRoaXMucmFuZ2VzW2ldO1xuICAgICAgICBpZiAoY21wKGVuZCwgcmFuZ2UuZnJvbSgpKSA+PSAwICYmIGNtcChwb3MsIHJhbmdlLnRvKCkpIDw9IDApXG4gICAgICAgICAgcmV0dXJuIGk7XG4gICAgICB9XG4gICAgICByZXR1cm4gLTE7XG4gICAgfVxuICB9O1xuXG4gIGZ1bmN0aW9uIFJhbmdlKGFuY2hvciwgaGVhZCkge1xuICAgIHRoaXMuYW5jaG9yID0gYW5jaG9yOyB0aGlzLmhlYWQgPSBoZWFkO1xuICB9XG5cbiAgUmFuZ2UucHJvdG90eXBlID0ge1xuICAgIGZyb206IGZ1bmN0aW9uKCkgeyByZXR1cm4gbWluUG9zKHRoaXMuYW5jaG9yLCB0aGlzLmhlYWQpOyB9LFxuICAgIHRvOiBmdW5jdGlvbigpIHsgcmV0dXJuIG1heFBvcyh0aGlzLmFuY2hvciwgdGhpcy5oZWFkKTsgfSxcbiAgICBlbXB0eTogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gdGhpcy5oZWFkLmxpbmUgPT0gdGhpcy5hbmNob3IubGluZSAmJiB0aGlzLmhlYWQuY2ggPT0gdGhpcy5hbmNob3IuY2g7XG4gICAgfVxuICB9O1xuXG4gIC8vIFRha2UgYW4gdW5zb3J0ZWQsIHBvdGVudGlhbGx5IG92ZXJsYXBwaW5nIHNldCBvZiByYW5nZXMsIGFuZFxuICAvLyBidWlsZCBhIHNlbGVjdGlvbiBvdXQgb2YgaXQuICdDb25zdW1lcycgcmFuZ2VzIGFycmF5IChtb2RpZnlpbmdcbiAgLy8gaXQpLlxuICBmdW5jdGlvbiBub3JtYWxpemVTZWxlY3Rpb24ocmFuZ2VzLCBwcmltSW5kZXgpIHtcbiAgICB2YXIgcHJpbSA9IHJhbmdlc1twcmltSW5kZXhdO1xuICAgIHJhbmdlcy5zb3J0KGZ1bmN0aW9uKGEsIGIpIHsgcmV0dXJuIGNtcChhLmZyb20oKSwgYi5mcm9tKCkpOyB9KTtcbiAgICBwcmltSW5kZXggPSBpbmRleE9mKHJhbmdlcywgcHJpbSk7XG4gICAgZm9yICh2YXIgaSA9IDE7IGkgPCByYW5nZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgIHZhciBjdXIgPSByYW5nZXNbaV0sIHByZXYgPSByYW5nZXNbaSAtIDFdO1xuICAgICAgaWYgKGNtcChwcmV2LnRvKCksIGN1ci5mcm9tKCkpID49IDApIHtcbiAgICAgICAgdmFyIGZyb20gPSBtaW5Qb3MocHJldi5mcm9tKCksIGN1ci5mcm9tKCkpLCB0byA9IG1heFBvcyhwcmV2LnRvKCksIGN1ci50bygpKTtcbiAgICAgICAgdmFyIGludiA9IHByZXYuZW1wdHkoKSA/IGN1ci5mcm9tKCkgPT0gY3VyLmhlYWQgOiBwcmV2LmZyb20oKSA9PSBwcmV2LmhlYWQ7XG4gICAgICAgIGlmIChpIDw9IHByaW1JbmRleCkgLS1wcmltSW5kZXg7XG4gICAgICAgIHJhbmdlcy5zcGxpY2UoLS1pLCAyLCBuZXcgUmFuZ2UoaW52ID8gdG8gOiBmcm9tLCBpbnYgPyBmcm9tIDogdG8pKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG5ldyBTZWxlY3Rpb24ocmFuZ2VzLCBwcmltSW5kZXgpO1xuICB9XG5cbiAgZnVuY3Rpb24gc2ltcGxlU2VsZWN0aW9uKGFuY2hvciwgaGVhZCkge1xuICAgIHJldHVybiBuZXcgU2VsZWN0aW9uKFtuZXcgUmFuZ2UoYW5jaG9yLCBoZWFkIHx8IGFuY2hvcildLCAwKTtcbiAgfVxuXG4gIC8vIE1vc3Qgb2YgdGhlIGV4dGVybmFsIEFQSSBjbGlwcyBnaXZlbiBwb3NpdGlvbnMgdG8gbWFrZSBzdXJlIHRoZXlcbiAgLy8gYWN0dWFsbHkgZXhpc3Qgd2l0aGluIHRoZSBkb2N1bWVudC5cbiAgZnVuY3Rpb24gY2xpcExpbmUoZG9jLCBuKSB7cmV0dXJuIE1hdGgubWF4KGRvYy5maXJzdCwgTWF0aC5taW4obiwgZG9jLmZpcnN0ICsgZG9jLnNpemUgLSAxKSk7fVxuICBmdW5jdGlvbiBjbGlwUG9zKGRvYywgcG9zKSB7XG4gICAgaWYgKHBvcy5saW5lIDwgZG9jLmZpcnN0KSByZXR1cm4gUG9zKGRvYy5maXJzdCwgMCk7XG4gICAgdmFyIGxhc3QgPSBkb2MuZmlyc3QgKyBkb2Muc2l6ZSAtIDE7XG4gICAgaWYgKHBvcy5saW5lID4gbGFzdCkgcmV0dXJuIFBvcyhsYXN0LCBnZXRMaW5lKGRvYywgbGFzdCkudGV4dC5sZW5ndGgpO1xuICAgIHJldHVybiBjbGlwVG9MZW4ocG9zLCBnZXRMaW5lKGRvYywgcG9zLmxpbmUpLnRleHQubGVuZ3RoKTtcbiAgfVxuICBmdW5jdGlvbiBjbGlwVG9MZW4ocG9zLCBsaW5lbGVuKSB7XG4gICAgdmFyIGNoID0gcG9zLmNoO1xuICAgIGlmIChjaCA9PSBudWxsIHx8IGNoID4gbGluZWxlbikgcmV0dXJuIFBvcyhwb3MubGluZSwgbGluZWxlbik7XG4gICAgZWxzZSBpZiAoY2ggPCAwKSByZXR1cm4gUG9zKHBvcy5saW5lLCAwKTtcbiAgICBlbHNlIHJldHVybiBwb3M7XG4gIH1cbiAgZnVuY3Rpb24gaXNMaW5lKGRvYywgbCkge3JldHVybiBsID49IGRvYy5maXJzdCAmJiBsIDwgZG9jLmZpcnN0ICsgZG9jLnNpemU7fVxuICBmdW5jdGlvbiBjbGlwUG9zQXJyYXkoZG9jLCBhcnJheSkge1xuICAgIGZvciAodmFyIG91dCA9IFtdLCBpID0gMDsgaSA8IGFycmF5Lmxlbmd0aDsgaSsrKSBvdXRbaV0gPSBjbGlwUG9zKGRvYywgYXJyYXlbaV0pO1xuICAgIHJldHVybiBvdXQ7XG4gIH1cblxuICAvLyBTRUxFQ1RJT04gVVBEQVRFU1xuXG4gIC8vIFRoZSAnc2Nyb2xsJyBwYXJhbWV0ZXIgZ2l2ZW4gdG8gbWFueSBvZiB0aGVzZSBpbmRpY2F0ZWQgd2hldGhlclxuICAvLyB0aGUgbmV3IGN1cnNvciBwb3NpdGlvbiBzaG91bGQgYmUgc2Nyb2xsZWQgaW50byB2aWV3IGFmdGVyXG4gIC8vIG1vZGlmeWluZyB0aGUgc2VsZWN0aW9uLlxuXG4gIC8vIElmIHNoaWZ0IGlzIGhlbGQgb3IgdGhlIGV4dGVuZCBmbGFnIGlzIHNldCwgZXh0ZW5kcyBhIHJhbmdlIHRvXG4gIC8vIGluY2x1ZGUgYSBnaXZlbiBwb3NpdGlvbiAoYW5kIG9wdGlvbmFsbHkgYSBzZWNvbmQgcG9zaXRpb24pLlxuICAvLyBPdGhlcndpc2UsIHNpbXBseSByZXR1cm5zIHRoZSByYW5nZSBiZXR3ZWVuIHRoZSBnaXZlbiBwb3NpdGlvbnMuXG4gIC8vIFVzZWQgZm9yIGN1cnNvciBtb3Rpb24gYW5kIHN1Y2guXG4gIGZ1bmN0aW9uIGV4dGVuZFJhbmdlKGRvYywgcmFuZ2UsIGhlYWQsIG90aGVyKSB7XG4gICAgaWYgKGRvYy5jbSAmJiBkb2MuY20uZGlzcGxheS5zaGlmdCB8fCBkb2MuZXh0ZW5kKSB7XG4gICAgICB2YXIgYW5jaG9yID0gcmFuZ2UuYW5jaG9yO1xuICAgICAgaWYgKG90aGVyKSB7XG4gICAgICAgIHZhciBwb3NCZWZvcmUgPSBjbXAoaGVhZCwgYW5jaG9yKSA8IDA7XG4gICAgICAgIGlmIChwb3NCZWZvcmUgIT0gKGNtcChvdGhlciwgYW5jaG9yKSA8IDApKSB7XG4gICAgICAgICAgYW5jaG9yID0gaGVhZDtcbiAgICAgICAgICBoZWFkID0gb3RoZXI7XG4gICAgICAgIH0gZWxzZSBpZiAocG9zQmVmb3JlICE9IChjbXAoaGVhZCwgb3RoZXIpIDwgMCkpIHtcbiAgICAgICAgICBoZWFkID0gb3RoZXI7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBuZXcgUmFuZ2UoYW5jaG9yLCBoZWFkKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIG5ldyBSYW5nZShvdGhlciB8fCBoZWFkLCBoZWFkKTtcbiAgICB9XG4gIH1cblxuICAvLyBFeHRlbmQgdGhlIHByaW1hcnkgc2VsZWN0aW9uIHJhbmdlLCBkaXNjYXJkIHRoZSByZXN0LlxuICBmdW5jdGlvbiBleHRlbmRTZWxlY3Rpb24oZG9jLCBoZWFkLCBvdGhlciwgb3B0aW9ucykge1xuICAgIHNldFNlbGVjdGlvbihkb2MsIG5ldyBTZWxlY3Rpb24oW2V4dGVuZFJhbmdlKGRvYywgZG9jLnNlbC5wcmltYXJ5KCksIGhlYWQsIG90aGVyKV0sIDApLCBvcHRpb25zKTtcbiAgfVxuXG4gIC8vIEV4dGVuZCBhbGwgc2VsZWN0aW9ucyAocG9zIGlzIGFuIGFycmF5IG9mIHNlbGVjdGlvbnMgd2l0aCBsZW5ndGhcbiAgLy8gZXF1YWwgdGhlIG51bWJlciBvZiBzZWxlY3Rpb25zKVxuICBmdW5jdGlvbiBleHRlbmRTZWxlY3Rpb25zKGRvYywgaGVhZHMsIG9wdGlvbnMpIHtcbiAgICBmb3IgKHZhciBvdXQgPSBbXSwgaSA9IDA7IGkgPCBkb2Muc2VsLnJhbmdlcy5sZW5ndGg7IGkrKylcbiAgICAgIG91dFtpXSA9IGV4dGVuZFJhbmdlKGRvYywgZG9jLnNlbC5yYW5nZXNbaV0sIGhlYWRzW2ldLCBudWxsKTtcbiAgICB2YXIgbmV3U2VsID0gbm9ybWFsaXplU2VsZWN0aW9uKG91dCwgZG9jLnNlbC5wcmltSW5kZXgpO1xuICAgIHNldFNlbGVjdGlvbihkb2MsIG5ld1NlbCwgb3B0aW9ucyk7XG4gIH1cblxuICAvLyBVcGRhdGVzIGEgc2luZ2xlIHJhbmdlIGluIHRoZSBzZWxlY3Rpb24uXG4gIGZ1bmN0aW9uIHJlcGxhY2VPbmVTZWxlY3Rpb24oZG9jLCBpLCByYW5nZSwgb3B0aW9ucykge1xuICAgIHZhciByYW5nZXMgPSBkb2Muc2VsLnJhbmdlcy5zbGljZSgwKTtcbiAgICByYW5nZXNbaV0gPSByYW5nZTtcbiAgICBzZXRTZWxlY3Rpb24oZG9jLCBub3JtYWxpemVTZWxlY3Rpb24ocmFuZ2VzLCBkb2Muc2VsLnByaW1JbmRleCksIG9wdGlvbnMpO1xuICB9XG5cbiAgLy8gUmVzZXQgdGhlIHNlbGVjdGlvbiB0byBhIHNpbmdsZSByYW5nZS5cbiAgZnVuY3Rpb24gc2V0U2ltcGxlU2VsZWN0aW9uKGRvYywgYW5jaG9yLCBoZWFkLCBvcHRpb25zKSB7XG4gICAgc2V0U2VsZWN0aW9uKGRvYywgc2ltcGxlU2VsZWN0aW9uKGFuY2hvciwgaGVhZCksIG9wdGlvbnMpO1xuICB9XG5cbiAgLy8gR2l2ZSBiZWZvcmVTZWxlY3Rpb25DaGFuZ2UgaGFuZGxlcnMgYSBjaGFuZ2UgdG8gaW5mbHVlbmNlIGFcbiAgLy8gc2VsZWN0aW9uIHVwZGF0ZS5cbiAgZnVuY3Rpb24gZmlsdGVyU2VsZWN0aW9uQ2hhbmdlKGRvYywgc2VsLCBvcHRpb25zKSB7XG4gICAgdmFyIG9iaiA9IHtcbiAgICAgIHJhbmdlczogc2VsLnJhbmdlcyxcbiAgICAgIHVwZGF0ZTogZnVuY3Rpb24ocmFuZ2VzKSB7XG4gICAgICAgIHRoaXMucmFuZ2VzID0gW107XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcmFuZ2VzLmxlbmd0aDsgaSsrKVxuICAgICAgICAgIHRoaXMucmFuZ2VzW2ldID0gbmV3IFJhbmdlKGNsaXBQb3MoZG9jLCByYW5nZXNbaV0uYW5jaG9yKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGlwUG9zKGRvYywgcmFuZ2VzW2ldLmhlYWQpKTtcbiAgICAgIH0sXG4gICAgICBvcmlnaW46IG9wdGlvbnMgJiYgb3B0aW9ucy5vcmlnaW5cbiAgICB9O1xuICAgIHNpZ25hbChkb2MsIFwiYmVmb3JlU2VsZWN0aW9uQ2hhbmdlXCIsIGRvYywgb2JqKTtcbiAgICBpZiAoZG9jLmNtKSBzaWduYWwoZG9jLmNtLCBcImJlZm9yZVNlbGVjdGlvbkNoYW5nZVwiLCBkb2MuY20sIG9iaik7XG4gICAgaWYgKG9iai5yYW5nZXMgIT0gc2VsLnJhbmdlcykgcmV0dXJuIG5vcm1hbGl6ZVNlbGVjdGlvbihvYmoucmFuZ2VzLCBvYmoucmFuZ2VzLmxlbmd0aCAtIDEpO1xuICAgIGVsc2UgcmV0dXJuIHNlbDtcbiAgfVxuXG4gIGZ1bmN0aW9uIHNldFNlbGVjdGlvblJlcGxhY2VIaXN0b3J5KGRvYywgc2VsLCBvcHRpb25zKSB7XG4gICAgdmFyIGRvbmUgPSBkb2MuaGlzdG9yeS5kb25lLCBsYXN0ID0gbHN0KGRvbmUpO1xuICAgIGlmIChsYXN0ICYmIGxhc3QucmFuZ2VzKSB7XG4gICAgICBkb25lW2RvbmUubGVuZ3RoIC0gMV0gPSBzZWw7XG4gICAgICBzZXRTZWxlY3Rpb25Ob1VuZG8oZG9jLCBzZWwsIG9wdGlvbnMpO1xuICAgIH0gZWxzZSB7XG4gICAgICBzZXRTZWxlY3Rpb24oZG9jLCBzZWwsIG9wdGlvbnMpO1xuICAgIH1cbiAgfVxuXG4gIC8vIFNldCBhIG5ldyBzZWxlY3Rpb24uXG4gIGZ1bmN0aW9uIHNldFNlbGVjdGlvbihkb2MsIHNlbCwgb3B0aW9ucykge1xuICAgIHNldFNlbGVjdGlvbk5vVW5kbyhkb2MsIHNlbCwgb3B0aW9ucyk7XG4gICAgYWRkU2VsZWN0aW9uVG9IaXN0b3J5KGRvYywgZG9jLnNlbCwgZG9jLmNtID8gZG9jLmNtLmN1ck9wLmlkIDogTmFOLCBvcHRpb25zKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHNldFNlbGVjdGlvbk5vVW5kbyhkb2MsIHNlbCwgb3B0aW9ucykge1xuICAgIGlmIChoYXNIYW5kbGVyKGRvYywgXCJiZWZvcmVTZWxlY3Rpb25DaGFuZ2VcIikgfHwgZG9jLmNtICYmIGhhc0hhbmRsZXIoZG9jLmNtLCBcImJlZm9yZVNlbGVjdGlvbkNoYW5nZVwiKSlcbiAgICAgIHNlbCA9IGZpbHRlclNlbGVjdGlvbkNoYW5nZShkb2MsIHNlbCwgb3B0aW9ucyk7XG5cbiAgICB2YXIgYmlhcyA9IG9wdGlvbnMgJiYgb3B0aW9ucy5iaWFzIHx8XG4gICAgICAoY21wKHNlbC5wcmltYXJ5KCkuaGVhZCwgZG9jLnNlbC5wcmltYXJ5KCkuaGVhZCkgPCAwID8gLTEgOiAxKTtcbiAgICBzZXRTZWxlY3Rpb25Jbm5lcihkb2MsIHNraXBBdG9taWNJblNlbGVjdGlvbihkb2MsIHNlbCwgYmlhcywgdHJ1ZSkpO1xuXG4gICAgaWYgKCEob3B0aW9ucyAmJiBvcHRpb25zLnNjcm9sbCA9PT0gZmFsc2UpICYmIGRvYy5jbSlcbiAgICAgIGVuc3VyZUN1cnNvclZpc2libGUoZG9jLmNtKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHNldFNlbGVjdGlvbklubmVyKGRvYywgc2VsKSB7XG4gICAgaWYgKHNlbC5lcXVhbHMoZG9jLnNlbCkpIHJldHVybjtcblxuICAgIGRvYy5zZWwgPSBzZWw7XG5cbiAgICBpZiAoZG9jLmNtKSB7XG4gICAgICBkb2MuY20uY3VyT3AudXBkYXRlSW5wdXQgPSBkb2MuY20uY3VyT3Auc2VsZWN0aW9uQ2hhbmdlZCA9IHRydWU7XG4gICAgICBzaWduYWxDdXJzb3JBY3Rpdml0eShkb2MuY20pO1xuICAgIH1cbiAgICBzaWduYWxMYXRlcihkb2MsIFwiY3Vyc29yQWN0aXZpdHlcIiwgZG9jKTtcbiAgfVxuXG4gIC8vIFZlcmlmeSB0aGF0IHRoZSBzZWxlY3Rpb24gZG9lcyBub3QgcGFydGlhbGx5IHNlbGVjdCBhbnkgYXRvbWljXG4gIC8vIG1hcmtlZCByYW5nZXMuXG4gIGZ1bmN0aW9uIHJlQ2hlY2tTZWxlY3Rpb24oZG9jKSB7XG4gICAgc2V0U2VsZWN0aW9uSW5uZXIoZG9jLCBza2lwQXRvbWljSW5TZWxlY3Rpb24oZG9jLCBkb2Muc2VsLCBudWxsLCBmYWxzZSksIHNlbF9kb250U2Nyb2xsKTtcbiAgfVxuXG4gIC8vIFJldHVybiBhIHNlbGVjdGlvbiB0aGF0IGRvZXMgbm90IHBhcnRpYWxseSBzZWxlY3QgYW55IGF0b21pY1xuICAvLyByYW5nZXMuXG4gIGZ1bmN0aW9uIHNraXBBdG9taWNJblNlbGVjdGlvbihkb2MsIHNlbCwgYmlhcywgbWF5Q2xlYXIpIHtcbiAgICB2YXIgb3V0O1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2VsLnJhbmdlcy5sZW5ndGg7IGkrKykge1xuICAgICAgdmFyIHJhbmdlID0gc2VsLnJhbmdlc1tpXTtcbiAgICAgIHZhciBvbGQgPSBzZWwucmFuZ2VzLmxlbmd0aCA9PSBkb2Muc2VsLnJhbmdlcy5sZW5ndGggJiYgZG9jLnNlbC5yYW5nZXNbaV07XG4gICAgICB2YXIgbmV3QW5jaG9yID0gc2tpcEF0b21pYyhkb2MsIHJhbmdlLmFuY2hvciwgb2xkICYmIG9sZC5hbmNob3IsIGJpYXMsIG1heUNsZWFyKTtcbiAgICAgIHZhciBuZXdIZWFkID0gc2tpcEF0b21pYyhkb2MsIHJhbmdlLmhlYWQsIG9sZCAmJiBvbGQuaGVhZCwgYmlhcywgbWF5Q2xlYXIpO1xuICAgICAgaWYgKG91dCB8fCBuZXdBbmNob3IgIT0gcmFuZ2UuYW5jaG9yIHx8IG5ld0hlYWQgIT0gcmFuZ2UuaGVhZCkge1xuICAgICAgICBpZiAoIW91dCkgb3V0ID0gc2VsLnJhbmdlcy5zbGljZSgwLCBpKTtcbiAgICAgICAgb3V0W2ldID0gbmV3IFJhbmdlKG5ld0FuY2hvciwgbmV3SGVhZCk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBvdXQgPyBub3JtYWxpemVTZWxlY3Rpb24ob3V0LCBzZWwucHJpbUluZGV4KSA6IHNlbDtcbiAgfVxuXG4gIGZ1bmN0aW9uIHNraXBBdG9taWNJbm5lcihkb2MsIHBvcywgb2xkUG9zLCBkaXIsIG1heUNsZWFyKSB7XG4gICAgdmFyIGxpbmUgPSBnZXRMaW5lKGRvYywgcG9zLmxpbmUpO1xuICAgIGlmIChsaW5lLm1hcmtlZFNwYW5zKSBmb3IgKHZhciBpID0gMDsgaSA8IGxpbmUubWFya2VkU3BhbnMubGVuZ3RoOyArK2kpIHtcbiAgICAgIHZhciBzcCA9IGxpbmUubWFya2VkU3BhbnNbaV0sIG0gPSBzcC5tYXJrZXI7XG4gICAgICBpZiAoKHNwLmZyb20gPT0gbnVsbCB8fCAobS5pbmNsdXNpdmVMZWZ0ID8gc3AuZnJvbSA8PSBwb3MuY2ggOiBzcC5mcm9tIDwgcG9zLmNoKSkgJiZcbiAgICAgICAgICAoc3AudG8gPT0gbnVsbCB8fCAobS5pbmNsdXNpdmVSaWdodCA/IHNwLnRvID49IHBvcy5jaCA6IHNwLnRvID4gcG9zLmNoKSkpIHtcbiAgICAgICAgaWYgKG1heUNsZWFyKSB7XG4gICAgICAgICAgc2lnbmFsKG0sIFwiYmVmb3JlQ3Vyc29yRW50ZXJcIik7XG4gICAgICAgICAgaWYgKG0uZXhwbGljaXRseUNsZWFyZWQpIHtcbiAgICAgICAgICAgIGlmICghbGluZS5tYXJrZWRTcGFucykgYnJlYWs7XG4gICAgICAgICAgICBlbHNlIHstLWk7IGNvbnRpbnVlO31cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFtLmF0b21pYykgY29udGludWU7XG5cbiAgICAgICAgaWYgKG9sZFBvcykge1xuICAgICAgICAgIHZhciBuZWFyID0gbS5maW5kKGRpciA8IDAgPyAxIDogLTEpLCBkaWZmO1xuICAgICAgICAgIGlmIChkaXIgPCAwID8gbS5pbmNsdXNpdmVSaWdodCA6IG0uaW5jbHVzaXZlTGVmdCkgbmVhciA9IG1vdmVQb3MoZG9jLCBuZWFyLCAtZGlyLCBsaW5lKTtcbiAgICAgICAgICBpZiAobmVhciAmJiBuZWFyLmxpbmUgPT0gcG9zLmxpbmUgJiYgKGRpZmYgPSBjbXAobmVhciwgb2xkUG9zKSkgJiYgKGRpciA8IDAgPyBkaWZmIDwgMCA6IGRpZmYgPiAwKSlcbiAgICAgICAgICAgIHJldHVybiBza2lwQXRvbWljSW5uZXIoZG9jLCBuZWFyLCBwb3MsIGRpciwgbWF5Q2xlYXIpO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGZhciA9IG0uZmluZChkaXIgPCAwID8gLTEgOiAxKTtcbiAgICAgICAgaWYgKGRpciA8IDAgPyBtLmluY2x1c2l2ZUxlZnQgOiBtLmluY2x1c2l2ZVJpZ2h0KSBmYXIgPSBtb3ZlUG9zKGRvYywgZmFyLCBkaXIsIGxpbmUpO1xuICAgICAgICByZXR1cm4gZmFyID8gc2tpcEF0b21pY0lubmVyKGRvYywgZmFyLCBwb3MsIGRpciwgbWF5Q2xlYXIpIDogbnVsbDtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHBvcztcbiAgfVxuXG4gIC8vIEVuc3VyZSBhIGdpdmVuIHBvc2l0aW9uIGlzIG5vdCBpbnNpZGUgYW4gYXRvbWljIHJhbmdlLlxuICBmdW5jdGlvbiBza2lwQXRvbWljKGRvYywgcG9zLCBvbGRQb3MsIGJpYXMsIG1heUNsZWFyKSB7XG4gICAgdmFyIGRpciA9IGJpYXMgfHwgMTtcbiAgICB2YXIgZm91bmQgPSBza2lwQXRvbWljSW5uZXIoZG9jLCBwb3MsIG9sZFBvcywgZGlyLCBtYXlDbGVhcikgfHxcbiAgICAgICAgKCFtYXlDbGVhciAmJiBza2lwQXRvbWljSW5uZXIoZG9jLCBwb3MsIG9sZFBvcywgZGlyLCB0cnVlKSkgfHxcbiAgICAgICAgc2tpcEF0b21pY0lubmVyKGRvYywgcG9zLCBvbGRQb3MsIC1kaXIsIG1heUNsZWFyKSB8fFxuICAgICAgICAoIW1heUNsZWFyICYmIHNraXBBdG9taWNJbm5lcihkb2MsIHBvcywgb2xkUG9zLCAtZGlyLCB0cnVlKSk7XG4gICAgaWYgKCFmb3VuZCkge1xuICAgICAgZG9jLmNhbnRFZGl0ID0gdHJ1ZTtcbiAgICAgIHJldHVybiBQb3MoZG9jLmZpcnN0LCAwKTtcbiAgICB9XG4gICAgcmV0dXJuIGZvdW5kO1xuICB9XG5cbiAgZnVuY3Rpb24gbW92ZVBvcyhkb2MsIHBvcywgZGlyLCBsaW5lKSB7XG4gICAgaWYgKGRpciA8IDAgJiYgcG9zLmNoID09IDApIHtcbiAgICAgIGlmIChwb3MubGluZSA+IGRvYy5maXJzdCkgcmV0dXJuIGNsaXBQb3MoZG9jLCBQb3MocG9zLmxpbmUgLSAxKSk7XG4gICAgICBlbHNlIHJldHVybiBudWxsO1xuICAgIH0gZWxzZSBpZiAoZGlyID4gMCAmJiBwb3MuY2ggPT0gKGxpbmUgfHwgZ2V0TGluZShkb2MsIHBvcy5saW5lKSkudGV4dC5sZW5ndGgpIHtcbiAgICAgIGlmIChwb3MubGluZSA8IGRvYy5maXJzdCArIGRvYy5zaXplIC0gMSkgcmV0dXJuIFBvcyhwb3MubGluZSArIDEsIDApO1xuICAgICAgZWxzZSByZXR1cm4gbnVsbDtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIG5ldyBQb3MocG9zLmxpbmUsIHBvcy5jaCArIGRpcik7XG4gICAgfVxuICB9XG5cbiAgLy8gU0VMRUNUSU9OIERSQVdJTkdcblxuICBmdW5jdGlvbiB1cGRhdGVTZWxlY3Rpb24oY20pIHtcbiAgICBjbS5kaXNwbGF5LmlucHV0LnNob3dTZWxlY3Rpb24oY20uZGlzcGxheS5pbnB1dC5wcmVwYXJlU2VsZWN0aW9uKCkpO1xuICB9XG5cbiAgZnVuY3Rpb24gcHJlcGFyZVNlbGVjdGlvbihjbSwgcHJpbWFyeSkge1xuICAgIHZhciBkb2MgPSBjbS5kb2MsIHJlc3VsdCA9IHt9O1xuICAgIHZhciBjdXJGcmFnbWVudCA9IHJlc3VsdC5jdXJzb3JzID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpO1xuICAgIHZhciBzZWxGcmFnbWVudCA9IHJlc3VsdC5zZWxlY3Rpb24gPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7XG5cbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGRvYy5zZWwucmFuZ2VzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBpZiAocHJpbWFyeSA9PT0gZmFsc2UgJiYgaSA9PSBkb2Muc2VsLnByaW1JbmRleCkgY29udGludWU7XG4gICAgICB2YXIgcmFuZ2UgPSBkb2Muc2VsLnJhbmdlc1tpXTtcbiAgICAgIHZhciBjb2xsYXBzZWQgPSByYW5nZS5lbXB0eSgpO1xuICAgICAgaWYgKGNvbGxhcHNlZCB8fCBjbS5vcHRpb25zLnNob3dDdXJzb3JXaGVuU2VsZWN0aW5nKVxuICAgICAgICBkcmF3U2VsZWN0aW9uQ3Vyc29yKGNtLCByYW5nZS5oZWFkLCBjdXJGcmFnbWVudCk7XG4gICAgICBpZiAoIWNvbGxhcHNlZClcbiAgICAgICAgZHJhd1NlbGVjdGlvblJhbmdlKGNtLCByYW5nZSwgc2VsRnJhZ21lbnQpO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgLy8gRHJhd3MgYSBjdXJzb3IgZm9yIHRoZSBnaXZlbiByYW5nZVxuICBmdW5jdGlvbiBkcmF3U2VsZWN0aW9uQ3Vyc29yKGNtLCBoZWFkLCBvdXRwdXQpIHtcbiAgICB2YXIgcG9zID0gY3Vyc29yQ29vcmRzKGNtLCBoZWFkLCBcImRpdlwiLCBudWxsLCBudWxsLCAhY20ub3B0aW9ucy5zaW5nbGVDdXJzb3JIZWlnaHRQZXJMaW5lKTtcblxuICAgIHZhciBjdXJzb3IgPSBvdXRwdXQuYXBwZW5kQ2hpbGQoZWx0KFwiZGl2XCIsIFwiXFx1MDBhMFwiLCBcIkNvZGVNaXJyb3ItY3Vyc29yXCIpKTtcbiAgICBjdXJzb3Iuc3R5bGUubGVmdCA9IHBvcy5sZWZ0ICsgXCJweFwiO1xuICAgIGN1cnNvci5zdHlsZS50b3AgPSBwb3MudG9wICsgXCJweFwiO1xuICAgIGN1cnNvci5zdHlsZS5oZWlnaHQgPSBNYXRoLm1heCgwLCBwb3MuYm90dG9tIC0gcG9zLnRvcCkgKiBjbS5vcHRpb25zLmN1cnNvckhlaWdodCArIFwicHhcIjtcblxuICAgIGlmIChwb3Mub3RoZXIpIHtcbiAgICAgIC8vIFNlY29uZGFyeSBjdXJzb3IsIHNob3duIHdoZW4gb24gYSAnanVtcCcgaW4gYmktZGlyZWN0aW9uYWwgdGV4dFxuICAgICAgdmFyIG90aGVyQ3Vyc29yID0gb3V0cHV0LmFwcGVuZENoaWxkKGVsdChcImRpdlwiLCBcIlxcdTAwYTBcIiwgXCJDb2RlTWlycm9yLWN1cnNvciBDb2RlTWlycm9yLXNlY29uZGFyeWN1cnNvclwiKSk7XG4gICAgICBvdGhlckN1cnNvci5zdHlsZS5kaXNwbGF5ID0gXCJcIjtcbiAgICAgIG90aGVyQ3Vyc29yLnN0eWxlLmxlZnQgPSBwb3Mub3RoZXIubGVmdCArIFwicHhcIjtcbiAgICAgIG90aGVyQ3Vyc29yLnN0eWxlLnRvcCA9IHBvcy5vdGhlci50b3AgKyBcInB4XCI7XG4gICAgICBvdGhlckN1cnNvci5zdHlsZS5oZWlnaHQgPSAocG9zLm90aGVyLmJvdHRvbSAtIHBvcy5vdGhlci50b3ApICogLjg1ICsgXCJweFwiO1xuICAgIH1cbiAgfVxuXG4gIC8vIERyYXdzIHRoZSBnaXZlbiByYW5nZSBhcyBhIGhpZ2hsaWdodGVkIHNlbGVjdGlvblxuICBmdW5jdGlvbiBkcmF3U2VsZWN0aW9uUmFuZ2UoY20sIHJhbmdlLCBvdXRwdXQpIHtcbiAgICB2YXIgZGlzcGxheSA9IGNtLmRpc3BsYXksIGRvYyA9IGNtLmRvYztcbiAgICB2YXIgZnJhZ21lbnQgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7XG4gICAgdmFyIHBhZGRpbmcgPSBwYWRkaW5nSChjbS5kaXNwbGF5KSwgbGVmdFNpZGUgPSBwYWRkaW5nLmxlZnQ7XG4gICAgdmFyIHJpZ2h0U2lkZSA9IE1hdGgubWF4KGRpc3BsYXkuc2l6ZXJXaWR0aCwgZGlzcGxheVdpZHRoKGNtKSAtIGRpc3BsYXkuc2l6ZXIub2Zmc2V0TGVmdCkgLSBwYWRkaW5nLnJpZ2h0O1xuXG4gICAgZnVuY3Rpb24gYWRkKGxlZnQsIHRvcCwgd2lkdGgsIGJvdHRvbSkge1xuICAgICAgaWYgKHRvcCA8IDApIHRvcCA9IDA7XG4gICAgICB0b3AgPSBNYXRoLnJvdW5kKHRvcCk7XG4gICAgICBib3R0b20gPSBNYXRoLnJvdW5kKGJvdHRvbSk7XG4gICAgICBmcmFnbWVudC5hcHBlbmRDaGlsZChlbHQoXCJkaXZcIiwgbnVsbCwgXCJDb2RlTWlycm9yLXNlbGVjdGVkXCIsIFwicG9zaXRpb246IGFic29sdXRlOyBsZWZ0OiBcIiArIGxlZnQgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwicHg7IHRvcDogXCIgKyB0b3AgKyBcInB4OyB3aWR0aDogXCIgKyAod2lkdGggPT0gbnVsbCA/IHJpZ2h0U2lkZSAtIGxlZnQgOiB3aWR0aCkgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwicHg7IGhlaWdodDogXCIgKyAoYm90dG9tIC0gdG9wKSArIFwicHhcIikpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGRyYXdGb3JMaW5lKGxpbmUsIGZyb21BcmcsIHRvQXJnKSB7XG4gICAgICB2YXIgbGluZU9iaiA9IGdldExpbmUoZG9jLCBsaW5lKTtcbiAgICAgIHZhciBsaW5lTGVuID0gbGluZU9iai50ZXh0Lmxlbmd0aDtcbiAgICAgIHZhciBzdGFydCwgZW5kO1xuICAgICAgZnVuY3Rpb24gY29vcmRzKGNoLCBiaWFzKSB7XG4gICAgICAgIHJldHVybiBjaGFyQ29vcmRzKGNtLCBQb3MobGluZSwgY2gpLCBcImRpdlwiLCBsaW5lT2JqLCBiaWFzKTtcbiAgICAgIH1cblxuICAgICAgaXRlcmF0ZUJpZGlTZWN0aW9ucyhnZXRPcmRlcihsaW5lT2JqKSwgZnJvbUFyZyB8fCAwLCB0b0FyZyA9PSBudWxsID8gbGluZUxlbiA6IHRvQXJnLCBmdW5jdGlvbihmcm9tLCB0bywgZGlyKSB7XG4gICAgICAgIHZhciBsZWZ0UG9zID0gY29vcmRzKGZyb20sIFwibGVmdFwiKSwgcmlnaHRQb3MsIGxlZnQsIHJpZ2h0O1xuICAgICAgICBpZiAoZnJvbSA9PSB0bykge1xuICAgICAgICAgIHJpZ2h0UG9zID0gbGVmdFBvcztcbiAgICAgICAgICBsZWZ0ID0gcmlnaHQgPSBsZWZ0UG9zLmxlZnQ7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmlnaHRQb3MgPSBjb29yZHModG8gLSAxLCBcInJpZ2h0XCIpO1xuICAgICAgICAgIGlmIChkaXIgPT0gXCJydGxcIikgeyB2YXIgdG1wID0gbGVmdFBvczsgbGVmdFBvcyA9IHJpZ2h0UG9zOyByaWdodFBvcyA9IHRtcDsgfVxuICAgICAgICAgIGxlZnQgPSBsZWZ0UG9zLmxlZnQ7XG4gICAgICAgICAgcmlnaHQgPSByaWdodFBvcy5yaWdodDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZnJvbUFyZyA9PSBudWxsICYmIGZyb20gPT0gMCkgbGVmdCA9IGxlZnRTaWRlO1xuICAgICAgICBpZiAocmlnaHRQb3MudG9wIC0gbGVmdFBvcy50b3AgPiAzKSB7IC8vIERpZmZlcmVudCBsaW5lcywgZHJhdyB0b3AgcGFydFxuICAgICAgICAgIGFkZChsZWZ0LCBsZWZ0UG9zLnRvcCwgbnVsbCwgbGVmdFBvcy5ib3R0b20pO1xuICAgICAgICAgIGxlZnQgPSBsZWZ0U2lkZTtcbiAgICAgICAgICBpZiAobGVmdFBvcy5ib3R0b20gPCByaWdodFBvcy50b3ApIGFkZChsZWZ0LCBsZWZ0UG9zLmJvdHRvbSwgbnVsbCwgcmlnaHRQb3MudG9wKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodG9BcmcgPT0gbnVsbCAmJiB0byA9PSBsaW5lTGVuKSByaWdodCA9IHJpZ2h0U2lkZTtcbiAgICAgICAgaWYgKCFzdGFydCB8fCBsZWZ0UG9zLnRvcCA8IHN0YXJ0LnRvcCB8fCBsZWZ0UG9zLnRvcCA9PSBzdGFydC50b3AgJiYgbGVmdFBvcy5sZWZ0IDwgc3RhcnQubGVmdClcbiAgICAgICAgICBzdGFydCA9IGxlZnRQb3M7XG4gICAgICAgIGlmICghZW5kIHx8IHJpZ2h0UG9zLmJvdHRvbSA+IGVuZC5ib3R0b20gfHwgcmlnaHRQb3MuYm90dG9tID09IGVuZC5ib3R0b20gJiYgcmlnaHRQb3MucmlnaHQgPiBlbmQucmlnaHQpXG4gICAgICAgICAgZW5kID0gcmlnaHRQb3M7XG4gICAgICAgIGlmIChsZWZ0IDwgbGVmdFNpZGUgKyAxKSBsZWZ0ID0gbGVmdFNpZGU7XG4gICAgICAgIGFkZChsZWZ0LCByaWdodFBvcy50b3AsIHJpZ2h0IC0gbGVmdCwgcmlnaHRQb3MuYm90dG9tKTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHtzdGFydDogc3RhcnQsIGVuZDogZW5kfTtcbiAgICB9XG5cbiAgICB2YXIgc0Zyb20gPSByYW5nZS5mcm9tKCksIHNUbyA9IHJhbmdlLnRvKCk7XG4gICAgaWYgKHNGcm9tLmxpbmUgPT0gc1RvLmxpbmUpIHtcbiAgICAgIGRyYXdGb3JMaW5lKHNGcm9tLmxpbmUsIHNGcm9tLmNoLCBzVG8uY2gpO1xuICAgIH0gZWxzZSB7XG4gICAgICB2YXIgZnJvbUxpbmUgPSBnZXRMaW5lKGRvYywgc0Zyb20ubGluZSksIHRvTGluZSA9IGdldExpbmUoZG9jLCBzVG8ubGluZSk7XG4gICAgICB2YXIgc2luZ2xlVkxpbmUgPSB2aXN1YWxMaW5lKGZyb21MaW5lKSA9PSB2aXN1YWxMaW5lKHRvTGluZSk7XG4gICAgICB2YXIgbGVmdEVuZCA9IGRyYXdGb3JMaW5lKHNGcm9tLmxpbmUsIHNGcm9tLmNoLCBzaW5nbGVWTGluZSA/IGZyb21MaW5lLnRleHQubGVuZ3RoICsgMSA6IG51bGwpLmVuZDtcbiAgICAgIHZhciByaWdodFN0YXJ0ID0gZHJhd0ZvckxpbmUoc1RvLmxpbmUsIHNpbmdsZVZMaW5lID8gMCA6IG51bGwsIHNUby5jaCkuc3RhcnQ7XG4gICAgICBpZiAoc2luZ2xlVkxpbmUpIHtcbiAgICAgICAgaWYgKGxlZnRFbmQudG9wIDwgcmlnaHRTdGFydC50b3AgLSAyKSB7XG4gICAgICAgICAgYWRkKGxlZnRFbmQucmlnaHQsIGxlZnRFbmQudG9wLCBudWxsLCBsZWZ0RW5kLmJvdHRvbSk7XG4gICAgICAgICAgYWRkKGxlZnRTaWRlLCByaWdodFN0YXJ0LnRvcCwgcmlnaHRTdGFydC5sZWZ0LCByaWdodFN0YXJ0LmJvdHRvbSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgYWRkKGxlZnRFbmQucmlnaHQsIGxlZnRFbmQudG9wLCByaWdodFN0YXJ0LmxlZnQgLSBsZWZ0RW5kLnJpZ2h0LCBsZWZ0RW5kLmJvdHRvbSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmIChsZWZ0RW5kLmJvdHRvbSA8IHJpZ2h0U3RhcnQudG9wKVxuICAgICAgICBhZGQobGVmdFNpZGUsIGxlZnRFbmQuYm90dG9tLCBudWxsLCByaWdodFN0YXJ0LnRvcCk7XG4gICAgfVxuXG4gICAgb3V0cHV0LmFwcGVuZENoaWxkKGZyYWdtZW50KTtcbiAgfVxuXG4gIC8vIEN1cnNvci1ibGlua2luZ1xuICBmdW5jdGlvbiByZXN0YXJ0QmxpbmsoY20pIHtcbiAgICBpZiAoIWNtLnN0YXRlLmZvY3VzZWQpIHJldHVybjtcbiAgICB2YXIgZGlzcGxheSA9IGNtLmRpc3BsYXk7XG4gICAgY2xlYXJJbnRlcnZhbChkaXNwbGF5LmJsaW5rZXIpO1xuICAgIHZhciBvbiA9IHRydWU7XG4gICAgZGlzcGxheS5jdXJzb3JEaXYuc3R5bGUudmlzaWJpbGl0eSA9IFwiXCI7XG4gICAgaWYgKGNtLm9wdGlvbnMuY3Vyc29yQmxpbmtSYXRlID4gMClcbiAgICAgIGRpc3BsYXkuYmxpbmtlciA9IHNldEludGVydmFsKGZ1bmN0aW9uKCkge1xuICAgICAgICBkaXNwbGF5LmN1cnNvckRpdi5zdHlsZS52aXNpYmlsaXR5ID0gKG9uID0gIW9uKSA/IFwiXCIgOiBcImhpZGRlblwiO1xuICAgICAgfSwgY20ub3B0aW9ucy5jdXJzb3JCbGlua1JhdGUpO1xuICAgIGVsc2UgaWYgKGNtLm9wdGlvbnMuY3Vyc29yQmxpbmtSYXRlIDwgMClcbiAgICAgIGRpc3BsYXkuY3Vyc29yRGl2LnN0eWxlLnZpc2liaWxpdHkgPSBcImhpZGRlblwiO1xuICB9XG5cbiAgLy8gSElHSExJR0hUIFdPUktFUlxuXG4gIGZ1bmN0aW9uIHN0YXJ0V29ya2VyKGNtLCB0aW1lKSB7XG4gICAgaWYgKGNtLmRvYy5tb2RlLnN0YXJ0U3RhdGUgJiYgY20uZG9jLmZyb250aWVyIDwgY20uZGlzcGxheS52aWV3VG8pXG4gICAgICBjbS5zdGF0ZS5oaWdobGlnaHQuc2V0KHRpbWUsIGJpbmQoaGlnaGxpZ2h0V29ya2VyLCBjbSkpO1xuICB9XG5cbiAgZnVuY3Rpb24gaGlnaGxpZ2h0V29ya2VyKGNtKSB7XG4gICAgdmFyIGRvYyA9IGNtLmRvYztcbiAgICBpZiAoZG9jLmZyb250aWVyIDwgZG9jLmZpcnN0KSBkb2MuZnJvbnRpZXIgPSBkb2MuZmlyc3Q7XG4gICAgaWYgKGRvYy5mcm9udGllciA+PSBjbS5kaXNwbGF5LnZpZXdUbykgcmV0dXJuO1xuICAgIHZhciBlbmQgPSArbmV3IERhdGUgKyBjbS5vcHRpb25zLndvcmtUaW1lO1xuICAgIHZhciBzdGF0ZSA9IGNvcHlTdGF0ZShkb2MubW9kZSwgZ2V0U3RhdGVCZWZvcmUoY20sIGRvYy5mcm9udGllcikpO1xuICAgIHZhciBjaGFuZ2VkTGluZXMgPSBbXTtcblxuICAgIGRvYy5pdGVyKGRvYy5mcm9udGllciwgTWF0aC5taW4oZG9jLmZpcnN0ICsgZG9jLnNpemUsIGNtLmRpc3BsYXkudmlld1RvICsgNTAwKSwgZnVuY3Rpb24obGluZSkge1xuICAgICAgaWYgKGRvYy5mcm9udGllciA+PSBjbS5kaXNwbGF5LnZpZXdGcm9tKSB7IC8vIFZpc2libGVcbiAgICAgICAgdmFyIG9sZFN0eWxlcyA9IGxpbmUuc3R5bGVzLCB0b29Mb25nID0gbGluZS50ZXh0Lmxlbmd0aCA+IGNtLm9wdGlvbnMubWF4SGlnaGxpZ2h0TGVuZ3RoO1xuICAgICAgICB2YXIgaGlnaGxpZ2h0ZWQgPSBoaWdobGlnaHRMaW5lKGNtLCBsaW5lLCB0b29Mb25nID8gY29weVN0YXRlKGRvYy5tb2RlLCBzdGF0ZSkgOiBzdGF0ZSwgdHJ1ZSk7XG4gICAgICAgIGxpbmUuc3R5bGVzID0gaGlnaGxpZ2h0ZWQuc3R5bGVzO1xuICAgICAgICB2YXIgb2xkQ2xzID0gbGluZS5zdHlsZUNsYXNzZXMsIG5ld0NscyA9IGhpZ2hsaWdodGVkLmNsYXNzZXM7XG4gICAgICAgIGlmIChuZXdDbHMpIGxpbmUuc3R5bGVDbGFzc2VzID0gbmV3Q2xzO1xuICAgICAgICBlbHNlIGlmIChvbGRDbHMpIGxpbmUuc3R5bGVDbGFzc2VzID0gbnVsbDtcbiAgICAgICAgdmFyIGlzY2hhbmdlID0gIW9sZFN0eWxlcyB8fCBvbGRTdHlsZXMubGVuZ3RoICE9IGxpbmUuc3R5bGVzLmxlbmd0aCB8fFxuICAgICAgICAgIG9sZENscyAhPSBuZXdDbHMgJiYgKCFvbGRDbHMgfHwgIW5ld0NscyB8fCBvbGRDbHMuYmdDbGFzcyAhPSBuZXdDbHMuYmdDbGFzcyB8fCBvbGRDbHMudGV4dENsYXNzICE9IG5ld0Nscy50ZXh0Q2xhc3MpO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgIWlzY2hhbmdlICYmIGkgPCBvbGRTdHlsZXMubGVuZ3RoOyArK2kpIGlzY2hhbmdlID0gb2xkU3R5bGVzW2ldICE9IGxpbmUuc3R5bGVzW2ldO1xuICAgICAgICBpZiAoaXNjaGFuZ2UpIGNoYW5nZWRMaW5lcy5wdXNoKGRvYy5mcm9udGllcik7XG4gICAgICAgIGxpbmUuc3RhdGVBZnRlciA9IHRvb0xvbmcgPyBzdGF0ZSA6IGNvcHlTdGF0ZShkb2MubW9kZSwgc3RhdGUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKGxpbmUudGV4dC5sZW5ndGggPD0gY20ub3B0aW9ucy5tYXhIaWdobGlnaHRMZW5ndGgpXG4gICAgICAgICAgcHJvY2Vzc0xpbmUoY20sIGxpbmUudGV4dCwgc3RhdGUpO1xuICAgICAgICBsaW5lLnN0YXRlQWZ0ZXIgPSBkb2MuZnJvbnRpZXIgJSA1ID09IDAgPyBjb3B5U3RhdGUoZG9jLm1vZGUsIHN0YXRlKSA6IG51bGw7XG4gICAgICB9XG4gICAgICArK2RvYy5mcm9udGllcjtcbiAgICAgIGlmICgrbmV3IERhdGUgPiBlbmQpIHtcbiAgICAgICAgc3RhcnRXb3JrZXIoY20sIGNtLm9wdGlvbnMud29ya0RlbGF5KTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgfSk7XG4gICAgaWYgKGNoYW5nZWRMaW5lcy5sZW5ndGgpIHJ1bkluT3AoY20sIGZ1bmN0aW9uKCkge1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjaGFuZ2VkTGluZXMubGVuZ3RoOyBpKyspXG4gICAgICAgIHJlZ0xpbmVDaGFuZ2UoY20sIGNoYW5nZWRMaW5lc1tpXSwgXCJ0ZXh0XCIpO1xuICAgIH0pO1xuICB9XG5cbiAgLy8gRmluZHMgdGhlIGxpbmUgdG8gc3RhcnQgd2l0aCB3aGVuIHN0YXJ0aW5nIGEgcGFyc2UuIFRyaWVzIHRvXG4gIC8vIGZpbmQgYSBsaW5lIHdpdGggYSBzdGF0ZUFmdGVyLCBzbyB0aGF0IGl0IGNhbiBzdGFydCB3aXRoIGFcbiAgLy8gdmFsaWQgc3RhdGUuIElmIHRoYXQgZmFpbHMsIGl0IHJldHVybnMgdGhlIGxpbmUgd2l0aCB0aGVcbiAgLy8gc21hbGxlc3QgaW5kZW50YXRpb24sIHdoaWNoIHRlbmRzIHRvIG5lZWQgdGhlIGxlYXN0IGNvbnRleHQgdG9cbiAgLy8gcGFyc2UgY29ycmVjdGx5LlxuICBmdW5jdGlvbiBmaW5kU3RhcnRMaW5lKGNtLCBuLCBwcmVjaXNlKSB7XG4gICAgdmFyIG1pbmluZGVudCwgbWlubGluZSwgZG9jID0gY20uZG9jO1xuICAgIHZhciBsaW0gPSBwcmVjaXNlID8gLTEgOiBuIC0gKGNtLmRvYy5tb2RlLmlubmVyTW9kZSA/IDEwMDAgOiAxMDApO1xuICAgIGZvciAodmFyIHNlYXJjaCA9IG47IHNlYXJjaCA+IGxpbTsgLS1zZWFyY2gpIHtcbiAgICAgIGlmIChzZWFyY2ggPD0gZG9jLmZpcnN0KSByZXR1cm4gZG9jLmZpcnN0O1xuICAgICAgdmFyIGxpbmUgPSBnZXRMaW5lKGRvYywgc2VhcmNoIC0gMSk7XG4gICAgICBpZiAobGluZS5zdGF0ZUFmdGVyICYmICghcHJlY2lzZSB8fCBzZWFyY2ggPD0gZG9jLmZyb250aWVyKSkgcmV0dXJuIHNlYXJjaDtcbiAgICAgIHZhciBpbmRlbnRlZCA9IGNvdW50Q29sdW1uKGxpbmUudGV4dCwgbnVsbCwgY20ub3B0aW9ucy50YWJTaXplKTtcbiAgICAgIGlmIChtaW5saW5lID09IG51bGwgfHwgbWluaW5kZW50ID4gaW5kZW50ZWQpIHtcbiAgICAgICAgbWlubGluZSA9IHNlYXJjaCAtIDE7XG4gICAgICAgIG1pbmluZGVudCA9IGluZGVudGVkO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbWlubGluZTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGdldFN0YXRlQmVmb3JlKGNtLCBuLCBwcmVjaXNlKSB7XG4gICAgdmFyIGRvYyA9IGNtLmRvYywgZGlzcGxheSA9IGNtLmRpc3BsYXk7XG4gICAgaWYgKCFkb2MubW9kZS5zdGFydFN0YXRlKSByZXR1cm4gdHJ1ZTtcbiAgICB2YXIgcG9zID0gZmluZFN0YXJ0TGluZShjbSwgbiwgcHJlY2lzZSksIHN0YXRlID0gcG9zID4gZG9jLmZpcnN0ICYmIGdldExpbmUoZG9jLCBwb3MtMSkuc3RhdGVBZnRlcjtcbiAgICBpZiAoIXN0YXRlKSBzdGF0ZSA9IHN0YXJ0U3RhdGUoZG9jLm1vZGUpO1xuICAgIGVsc2Ugc3RhdGUgPSBjb3B5U3RhdGUoZG9jLm1vZGUsIHN0YXRlKTtcbiAgICBkb2MuaXRlcihwb3MsIG4sIGZ1bmN0aW9uKGxpbmUpIHtcbiAgICAgIHByb2Nlc3NMaW5lKGNtLCBsaW5lLnRleHQsIHN0YXRlKTtcbiAgICAgIHZhciBzYXZlID0gcG9zID09IG4gLSAxIHx8IHBvcyAlIDUgPT0gMCB8fCBwb3MgPj0gZGlzcGxheS52aWV3RnJvbSAmJiBwb3MgPCBkaXNwbGF5LnZpZXdUbztcbiAgICAgIGxpbmUuc3RhdGVBZnRlciA9IHNhdmUgPyBjb3B5U3RhdGUoZG9jLm1vZGUsIHN0YXRlKSA6IG51bGw7XG4gICAgICArK3BvcztcbiAgICB9KTtcbiAgICBpZiAocHJlY2lzZSkgZG9jLmZyb250aWVyID0gcG9zO1xuICAgIHJldHVybiBzdGF0ZTtcbiAgfVxuXG4gIC8vIFBPU0lUSU9OIE1FQVNVUkVNRU5UXG5cbiAgZnVuY3Rpb24gcGFkZGluZ1RvcChkaXNwbGF5KSB7cmV0dXJuIGRpc3BsYXkubGluZVNwYWNlLm9mZnNldFRvcDt9XG4gIGZ1bmN0aW9uIHBhZGRpbmdWZXJ0KGRpc3BsYXkpIHtyZXR1cm4gZGlzcGxheS5tb3Zlci5vZmZzZXRIZWlnaHQgLSBkaXNwbGF5LmxpbmVTcGFjZS5vZmZzZXRIZWlnaHQ7fVxuICBmdW5jdGlvbiBwYWRkaW5nSChkaXNwbGF5KSB7XG4gICAgaWYgKGRpc3BsYXkuY2FjaGVkUGFkZGluZ0gpIHJldHVybiBkaXNwbGF5LmNhY2hlZFBhZGRpbmdIO1xuICAgIHZhciBlID0gcmVtb3ZlQ2hpbGRyZW5BbmRBZGQoZGlzcGxheS5tZWFzdXJlLCBlbHQoXCJwcmVcIiwgXCJ4XCIpKTtcbiAgICB2YXIgc3R5bGUgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZSA/IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKGUpIDogZS5jdXJyZW50U3R5bGU7XG4gICAgdmFyIGRhdGEgPSB7bGVmdDogcGFyc2VJbnQoc3R5bGUucGFkZGluZ0xlZnQpLCByaWdodDogcGFyc2VJbnQoc3R5bGUucGFkZGluZ1JpZ2h0KX07XG4gICAgaWYgKCFpc05hTihkYXRhLmxlZnQpICYmICFpc05hTihkYXRhLnJpZ2h0KSkgZGlzcGxheS5jYWNoZWRQYWRkaW5nSCA9IGRhdGE7XG4gICAgcmV0dXJuIGRhdGE7XG4gIH1cblxuICBmdW5jdGlvbiBzY3JvbGxHYXAoY20pIHsgcmV0dXJuIHNjcm9sbGVyR2FwIC0gY20uZGlzcGxheS5uYXRpdmVCYXJXaWR0aDsgfVxuICBmdW5jdGlvbiBkaXNwbGF5V2lkdGgoY20pIHtcbiAgICByZXR1cm4gY20uZGlzcGxheS5zY3JvbGxlci5jbGllbnRXaWR0aCAtIHNjcm9sbEdhcChjbSkgLSBjbS5kaXNwbGF5LmJhcldpZHRoO1xuICB9XG4gIGZ1bmN0aW9uIGRpc3BsYXlIZWlnaHQoY20pIHtcbiAgICByZXR1cm4gY20uZGlzcGxheS5zY3JvbGxlci5jbGllbnRIZWlnaHQgLSBzY3JvbGxHYXAoY20pIC0gY20uZGlzcGxheS5iYXJIZWlnaHQ7XG4gIH1cblxuICAvLyBFbnN1cmUgdGhlIGxpbmVWaWV3LndyYXBwaW5nLmhlaWdodHMgYXJyYXkgaXMgcG9wdWxhdGVkLiBUaGlzIGlzXG4gIC8vIGFuIGFycmF5IG9mIGJvdHRvbSBvZmZzZXRzIGZvciB0aGUgbGluZXMgdGhhdCBtYWtlIHVwIGEgZHJhd25cbiAgLy8gbGluZS4gV2hlbiBsaW5lV3JhcHBpbmcgaXMgb24sIHRoZXJlIG1pZ2h0IGJlIG1vcmUgdGhhbiBvbmVcbiAgLy8gaGVpZ2h0LlxuICBmdW5jdGlvbiBlbnN1cmVMaW5lSGVpZ2h0cyhjbSwgbGluZVZpZXcsIHJlY3QpIHtcbiAgICB2YXIgd3JhcHBpbmcgPSBjbS5vcHRpb25zLmxpbmVXcmFwcGluZztcbiAgICB2YXIgY3VyV2lkdGggPSB3cmFwcGluZyAmJiBkaXNwbGF5V2lkdGgoY20pO1xuICAgIGlmICghbGluZVZpZXcubWVhc3VyZS5oZWlnaHRzIHx8IHdyYXBwaW5nICYmIGxpbmVWaWV3Lm1lYXN1cmUud2lkdGggIT0gY3VyV2lkdGgpIHtcbiAgICAgIHZhciBoZWlnaHRzID0gbGluZVZpZXcubWVhc3VyZS5oZWlnaHRzID0gW107XG4gICAgICBpZiAod3JhcHBpbmcpIHtcbiAgICAgICAgbGluZVZpZXcubWVhc3VyZS53aWR0aCA9IGN1cldpZHRoO1xuICAgICAgICB2YXIgcmVjdHMgPSBsaW5lVmlldy50ZXh0LmZpcnN0Q2hpbGQuZ2V0Q2xpZW50UmVjdHMoKTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCByZWN0cy5sZW5ndGggLSAxOyBpKyspIHtcbiAgICAgICAgICB2YXIgY3VyID0gcmVjdHNbaV0sIG5leHQgPSByZWN0c1tpICsgMV07XG4gICAgICAgICAgaWYgKE1hdGguYWJzKGN1ci5ib3R0b20gLSBuZXh0LmJvdHRvbSkgPiAyKVxuICAgICAgICAgICAgaGVpZ2h0cy5wdXNoKChjdXIuYm90dG9tICsgbmV4dC50b3ApIC8gMiAtIHJlY3QudG9wKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaGVpZ2h0cy5wdXNoKHJlY3QuYm90dG9tIC0gcmVjdC50b3ApO1xuICAgIH1cbiAgfVxuXG4gIC8vIEZpbmQgYSBsaW5lIG1hcCAobWFwcGluZyBjaGFyYWN0ZXIgb2Zmc2V0cyB0byB0ZXh0IG5vZGVzKSBhbmQgYVxuICAvLyBtZWFzdXJlbWVudCBjYWNoZSBmb3IgdGhlIGdpdmVuIGxpbmUgbnVtYmVyLiAoQSBsaW5lIHZpZXcgbWlnaHRcbiAgLy8gY29udGFpbiBtdWx0aXBsZSBsaW5lcyB3aGVuIGNvbGxhcHNlZCByYW5nZXMgYXJlIHByZXNlbnQuKVxuICBmdW5jdGlvbiBtYXBGcm9tTGluZVZpZXcobGluZVZpZXcsIGxpbmUsIGxpbmVOKSB7XG4gICAgaWYgKGxpbmVWaWV3LmxpbmUgPT0gbGluZSlcbiAgICAgIHJldHVybiB7bWFwOiBsaW5lVmlldy5tZWFzdXJlLm1hcCwgY2FjaGU6IGxpbmVWaWV3Lm1lYXN1cmUuY2FjaGV9O1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGluZVZpZXcucmVzdC5sZW5ndGg7IGkrKylcbiAgICAgIGlmIChsaW5lVmlldy5yZXN0W2ldID09IGxpbmUpXG4gICAgICAgIHJldHVybiB7bWFwOiBsaW5lVmlldy5tZWFzdXJlLm1hcHNbaV0sIGNhY2hlOiBsaW5lVmlldy5tZWFzdXJlLmNhY2hlc1tpXX07XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaW5lVmlldy5yZXN0Lmxlbmd0aDsgaSsrKVxuICAgICAgaWYgKGxpbmVObyhsaW5lVmlldy5yZXN0W2ldKSA+IGxpbmVOKVxuICAgICAgICByZXR1cm4ge21hcDogbGluZVZpZXcubWVhc3VyZS5tYXBzW2ldLCBjYWNoZTogbGluZVZpZXcubWVhc3VyZS5jYWNoZXNbaV0sIGJlZm9yZTogdHJ1ZX07XG4gIH1cblxuICAvLyBSZW5kZXIgYSBsaW5lIGludG8gdGhlIGhpZGRlbiBub2RlIGRpc3BsYXkuZXh0ZXJuYWxNZWFzdXJlZC4gVXNlZFxuICAvLyB3aGVuIG1lYXN1cmVtZW50IGlzIG5lZWRlZCBmb3IgYSBsaW5lIHRoYXQncyBub3QgaW4gdGhlIHZpZXdwb3J0LlxuICBmdW5jdGlvbiB1cGRhdGVFeHRlcm5hbE1lYXN1cmVtZW50KGNtLCBsaW5lKSB7XG4gICAgbGluZSA9IHZpc3VhbExpbmUobGluZSk7XG4gICAgdmFyIGxpbmVOID0gbGluZU5vKGxpbmUpO1xuICAgIHZhciB2aWV3ID0gY20uZGlzcGxheS5leHRlcm5hbE1lYXN1cmVkID0gbmV3IExpbmVWaWV3KGNtLmRvYywgbGluZSwgbGluZU4pO1xuICAgIHZpZXcubGluZU4gPSBsaW5lTjtcbiAgICB2YXIgYnVpbHQgPSB2aWV3LmJ1aWx0ID0gYnVpbGRMaW5lQ29udGVudChjbSwgdmlldyk7XG4gICAgdmlldy50ZXh0ID0gYnVpbHQucHJlO1xuICAgIHJlbW92ZUNoaWxkcmVuQW5kQWRkKGNtLmRpc3BsYXkubGluZU1lYXN1cmUsIGJ1aWx0LnByZSk7XG4gICAgcmV0dXJuIHZpZXc7XG4gIH1cblxuICAvLyBHZXQgYSB7dG9wLCBib3R0b20sIGxlZnQsIHJpZ2h0fSBib3ggKGluIGxpbmUtbG9jYWwgY29vcmRpbmF0ZXMpXG4gIC8vIGZvciBhIGdpdmVuIGNoYXJhY3Rlci5cbiAgZnVuY3Rpb24gbWVhc3VyZUNoYXIoY20sIGxpbmUsIGNoLCBiaWFzKSB7XG4gICAgcmV0dXJuIG1lYXN1cmVDaGFyUHJlcGFyZWQoY20sIHByZXBhcmVNZWFzdXJlRm9yTGluZShjbSwgbGluZSksIGNoLCBiaWFzKTtcbiAgfVxuXG4gIC8vIEZpbmQgYSBsaW5lIHZpZXcgdGhhdCBjb3JyZXNwb25kcyB0byB0aGUgZ2l2ZW4gbGluZSBudW1iZXIuXG4gIGZ1bmN0aW9uIGZpbmRWaWV3Rm9yTGluZShjbSwgbGluZU4pIHtcbiAgICBpZiAobGluZU4gPj0gY20uZGlzcGxheS52aWV3RnJvbSAmJiBsaW5lTiA8IGNtLmRpc3BsYXkudmlld1RvKVxuICAgICAgcmV0dXJuIGNtLmRpc3BsYXkudmlld1tmaW5kVmlld0luZGV4KGNtLCBsaW5lTildO1xuICAgIHZhciBleHQgPSBjbS5kaXNwbGF5LmV4dGVybmFsTWVhc3VyZWQ7XG4gICAgaWYgKGV4dCAmJiBsaW5lTiA+PSBleHQubGluZU4gJiYgbGluZU4gPCBleHQubGluZU4gKyBleHQuc2l6ZSlcbiAgICAgIHJldHVybiBleHQ7XG4gIH1cblxuICAvLyBNZWFzdXJlbWVudCBjYW4gYmUgc3BsaXQgaW4gdHdvIHN0ZXBzLCB0aGUgc2V0LXVwIHdvcmsgdGhhdFxuICAvLyBhcHBsaWVzIHRvIHRoZSB3aG9sZSBsaW5lLCBhbmQgdGhlIG1lYXN1cmVtZW50IG9mIHRoZSBhY3R1YWxcbiAgLy8gY2hhcmFjdGVyLiBGdW5jdGlvbnMgbGlrZSBjb29yZHNDaGFyLCB0aGF0IG5lZWQgdG8gZG8gYSBsb3Qgb2ZcbiAgLy8gbWVhc3VyZW1lbnRzIGluIGEgcm93LCBjYW4gdGh1cyBlbnN1cmUgdGhhdCB0aGUgc2V0LXVwIHdvcmsgaXNcbiAgLy8gb25seSBkb25lIG9uY2UuXG4gIGZ1bmN0aW9uIHByZXBhcmVNZWFzdXJlRm9yTGluZShjbSwgbGluZSkge1xuICAgIHZhciBsaW5lTiA9IGxpbmVObyhsaW5lKTtcbiAgICB2YXIgdmlldyA9IGZpbmRWaWV3Rm9yTGluZShjbSwgbGluZU4pO1xuICAgIGlmICh2aWV3ICYmICF2aWV3LnRleHQpIHtcbiAgICAgIHZpZXcgPSBudWxsO1xuICAgIH0gZWxzZSBpZiAodmlldyAmJiB2aWV3LmNoYW5nZXMpIHtcbiAgICAgIHVwZGF0ZUxpbmVGb3JDaGFuZ2VzKGNtLCB2aWV3LCBsaW5lTiwgZ2V0RGltZW5zaW9ucyhjbSkpO1xuICAgICAgY20uY3VyT3AuZm9yY2VVcGRhdGUgPSB0cnVlO1xuICAgIH1cbiAgICBpZiAoIXZpZXcpXG4gICAgICB2aWV3ID0gdXBkYXRlRXh0ZXJuYWxNZWFzdXJlbWVudChjbSwgbGluZSk7XG5cbiAgICB2YXIgaW5mbyA9IG1hcEZyb21MaW5lVmlldyh2aWV3LCBsaW5lLCBsaW5lTik7XG4gICAgcmV0dXJuIHtcbiAgICAgIGxpbmU6IGxpbmUsIHZpZXc6IHZpZXcsIHJlY3Q6IG51bGwsXG4gICAgICBtYXA6IGluZm8ubWFwLCBjYWNoZTogaW5mby5jYWNoZSwgYmVmb3JlOiBpbmZvLmJlZm9yZSxcbiAgICAgIGhhc0hlaWdodHM6IGZhbHNlXG4gICAgfTtcbiAgfVxuXG4gIC8vIEdpdmVuIGEgcHJlcGFyZWQgbWVhc3VyZW1lbnQgb2JqZWN0LCBtZWFzdXJlcyB0aGUgcG9zaXRpb24gb2YgYW5cbiAgLy8gYWN0dWFsIGNoYXJhY3RlciAob3IgZmV0Y2hlcyBpdCBmcm9tIHRoZSBjYWNoZSkuXG4gIGZ1bmN0aW9uIG1lYXN1cmVDaGFyUHJlcGFyZWQoY20sIHByZXBhcmVkLCBjaCwgYmlhcywgdmFySGVpZ2h0KSB7XG4gICAgaWYgKHByZXBhcmVkLmJlZm9yZSkgY2ggPSAtMTtcbiAgICB2YXIga2V5ID0gY2ggKyAoYmlhcyB8fCBcIlwiKSwgZm91bmQ7XG4gICAgaWYgKHByZXBhcmVkLmNhY2hlLmhhc093blByb3BlcnR5KGtleSkpIHtcbiAgICAgIGZvdW5kID0gcHJlcGFyZWQuY2FjaGVba2V5XTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKCFwcmVwYXJlZC5yZWN0KVxuICAgICAgICBwcmVwYXJlZC5yZWN0ID0gcHJlcGFyZWQudmlldy50ZXh0LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgaWYgKCFwcmVwYXJlZC5oYXNIZWlnaHRzKSB7XG4gICAgICAgIGVuc3VyZUxpbmVIZWlnaHRzKGNtLCBwcmVwYXJlZC52aWV3LCBwcmVwYXJlZC5yZWN0KTtcbiAgICAgICAgcHJlcGFyZWQuaGFzSGVpZ2h0cyA9IHRydWU7XG4gICAgICB9XG4gICAgICBmb3VuZCA9IG1lYXN1cmVDaGFySW5uZXIoY20sIHByZXBhcmVkLCBjaCwgYmlhcyk7XG4gICAgICBpZiAoIWZvdW5kLmJvZ3VzKSBwcmVwYXJlZC5jYWNoZVtrZXldID0gZm91bmQ7XG4gICAgfVxuICAgIHJldHVybiB7bGVmdDogZm91bmQubGVmdCwgcmlnaHQ6IGZvdW5kLnJpZ2h0LFxuICAgICAgICAgICAgdG9wOiB2YXJIZWlnaHQgPyBmb3VuZC5ydG9wIDogZm91bmQudG9wLFxuICAgICAgICAgICAgYm90dG9tOiB2YXJIZWlnaHQgPyBmb3VuZC5yYm90dG9tIDogZm91bmQuYm90dG9tfTtcbiAgfVxuXG4gIHZhciBudWxsUmVjdCA9IHtsZWZ0OiAwLCByaWdodDogMCwgdG9wOiAwLCBib3R0b206IDB9O1xuXG4gIGZ1bmN0aW9uIG5vZGVBbmRPZmZzZXRJbkxpbmVNYXAobWFwLCBjaCwgYmlhcykge1xuICAgIHZhciBub2RlLCBzdGFydCwgZW5kLCBjb2xsYXBzZTtcbiAgICAvLyBGaXJzdCwgc2VhcmNoIHRoZSBsaW5lIG1hcCBmb3IgdGhlIHRleHQgbm9kZSBjb3JyZXNwb25kaW5nIHRvLFxuICAgIC8vIG9yIGNsb3Nlc3QgdG8sIHRoZSB0YXJnZXQgY2hhcmFjdGVyLlxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbWFwLmxlbmd0aDsgaSArPSAzKSB7XG4gICAgICB2YXIgbVN0YXJ0ID0gbWFwW2ldLCBtRW5kID0gbWFwW2kgKyAxXTtcbiAgICAgIGlmIChjaCA8IG1TdGFydCkge1xuICAgICAgICBzdGFydCA9IDA7IGVuZCA9IDE7XG4gICAgICAgIGNvbGxhcHNlID0gXCJsZWZ0XCI7XG4gICAgICB9IGVsc2UgaWYgKGNoIDwgbUVuZCkge1xuICAgICAgICBzdGFydCA9IGNoIC0gbVN0YXJ0O1xuICAgICAgICBlbmQgPSBzdGFydCArIDE7XG4gICAgICB9IGVsc2UgaWYgKGkgPT0gbWFwLmxlbmd0aCAtIDMgfHwgY2ggPT0gbUVuZCAmJiBtYXBbaSArIDNdID4gY2gpIHtcbiAgICAgICAgZW5kID0gbUVuZCAtIG1TdGFydDtcbiAgICAgICAgc3RhcnQgPSBlbmQgLSAxO1xuICAgICAgICBpZiAoY2ggPj0gbUVuZCkgY29sbGFwc2UgPSBcInJpZ2h0XCI7XG4gICAgICB9XG4gICAgICBpZiAoc3RhcnQgIT0gbnVsbCkge1xuICAgICAgICBub2RlID0gbWFwW2kgKyAyXTtcbiAgICAgICAgaWYgKG1TdGFydCA9PSBtRW5kICYmIGJpYXMgPT0gKG5vZGUuaW5zZXJ0TGVmdCA/IFwibGVmdFwiIDogXCJyaWdodFwiKSlcbiAgICAgICAgICBjb2xsYXBzZSA9IGJpYXM7XG4gICAgICAgIGlmIChiaWFzID09IFwibGVmdFwiICYmIHN0YXJ0ID09IDApXG4gICAgICAgICAgd2hpbGUgKGkgJiYgbWFwW2kgLSAyXSA9PSBtYXBbaSAtIDNdICYmIG1hcFtpIC0gMV0uaW5zZXJ0TGVmdCkge1xuICAgICAgICAgICAgbm9kZSA9IG1hcFsoaSAtPSAzKSArIDJdO1xuICAgICAgICAgICAgY29sbGFwc2UgPSBcImxlZnRcIjtcbiAgICAgICAgICB9XG4gICAgICAgIGlmIChiaWFzID09IFwicmlnaHRcIiAmJiBzdGFydCA9PSBtRW5kIC0gbVN0YXJ0KVxuICAgICAgICAgIHdoaWxlIChpIDwgbWFwLmxlbmd0aCAtIDMgJiYgbWFwW2kgKyAzXSA9PSBtYXBbaSArIDRdICYmICFtYXBbaSArIDVdLmluc2VydExlZnQpIHtcbiAgICAgICAgICAgIG5vZGUgPSBtYXBbKGkgKz0gMykgKyAyXTtcbiAgICAgICAgICAgIGNvbGxhcHNlID0gXCJyaWdodFwiO1xuICAgICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB7bm9kZTogbm9kZSwgc3RhcnQ6IHN0YXJ0LCBlbmQ6IGVuZCwgY29sbGFwc2U6IGNvbGxhcHNlLCBjb3ZlclN0YXJ0OiBtU3RhcnQsIGNvdmVyRW5kOiBtRW5kfTtcbiAgfVxuXG4gIGZ1bmN0aW9uIG1lYXN1cmVDaGFySW5uZXIoY20sIHByZXBhcmVkLCBjaCwgYmlhcykge1xuICAgIHZhciBwbGFjZSA9IG5vZGVBbmRPZmZzZXRJbkxpbmVNYXAocHJlcGFyZWQubWFwLCBjaCwgYmlhcyk7XG4gICAgdmFyIG5vZGUgPSBwbGFjZS5ub2RlLCBzdGFydCA9IHBsYWNlLnN0YXJ0LCBlbmQgPSBwbGFjZS5lbmQsIGNvbGxhcHNlID0gcGxhY2UuY29sbGFwc2U7XG5cbiAgICB2YXIgcmVjdDtcbiAgICBpZiAobm9kZS5ub2RlVHlwZSA9PSAzKSB7IC8vIElmIGl0IGlzIGEgdGV4dCBub2RlLCB1c2UgYSByYW5nZSB0byByZXRyaWV2ZSB0aGUgY29vcmRpbmF0ZXMuXG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDQ7IGkrKykgeyAvLyBSZXRyeSBhIG1heGltdW0gb2YgNCB0aW1lcyB3aGVuIG5vbnNlbnNlIHJlY3RhbmdsZXMgYXJlIHJldHVybmVkXG4gICAgICAgIHdoaWxlIChzdGFydCAmJiBpc0V4dGVuZGluZ0NoYXIocHJlcGFyZWQubGluZS50ZXh0LmNoYXJBdChwbGFjZS5jb3ZlclN0YXJ0ICsgc3RhcnQpKSkgLS1zdGFydDtcbiAgICAgICAgd2hpbGUgKHBsYWNlLmNvdmVyU3RhcnQgKyBlbmQgPCBwbGFjZS5jb3ZlckVuZCAmJiBpc0V4dGVuZGluZ0NoYXIocHJlcGFyZWQubGluZS50ZXh0LmNoYXJBdChwbGFjZS5jb3ZlclN0YXJ0ICsgZW5kKSkpICsrZW5kO1xuICAgICAgICBpZiAoaWUgJiYgaWVfdmVyc2lvbiA8IDkgJiYgc3RhcnQgPT0gMCAmJiBlbmQgPT0gcGxhY2UuY292ZXJFbmQgLSBwbGFjZS5jb3ZlclN0YXJ0KSB7XG4gICAgICAgICAgcmVjdCA9IG5vZGUucGFyZW50Tm9kZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgICAgfSBlbHNlIGlmIChpZSAmJiBjbS5vcHRpb25zLmxpbmVXcmFwcGluZykge1xuICAgICAgICAgIHZhciByZWN0cyA9IHJhbmdlKG5vZGUsIHN0YXJ0LCBlbmQpLmdldENsaWVudFJlY3RzKCk7XG4gICAgICAgICAgaWYgKHJlY3RzLmxlbmd0aClcbiAgICAgICAgICAgIHJlY3QgPSByZWN0c1tiaWFzID09IFwicmlnaHRcIiA/IHJlY3RzLmxlbmd0aCAtIDEgOiAwXTtcbiAgICAgICAgICBlbHNlXG4gICAgICAgICAgICByZWN0ID0gbnVsbFJlY3Q7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmVjdCA9IHJhbmdlKG5vZGUsIHN0YXJ0LCBlbmQpLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpIHx8IG51bGxSZWN0O1xuICAgICAgICB9XG4gICAgICAgIGlmIChyZWN0LmxlZnQgfHwgcmVjdC5yaWdodCB8fCBzdGFydCA9PSAwKSBicmVhaztcbiAgICAgICAgZW5kID0gc3RhcnQ7XG4gICAgICAgIHN0YXJ0ID0gc3RhcnQgLSAxO1xuICAgICAgICBjb2xsYXBzZSA9IFwicmlnaHRcIjtcbiAgICAgIH1cbiAgICAgIGlmIChpZSAmJiBpZV92ZXJzaW9uIDwgMTEpIHJlY3QgPSBtYXliZVVwZGF0ZVJlY3RGb3Jab29taW5nKGNtLmRpc3BsYXkubWVhc3VyZSwgcmVjdCk7XG4gICAgfSBlbHNlIHsgLy8gSWYgaXQgaXMgYSB3aWRnZXQsIHNpbXBseSBnZXQgdGhlIGJveCBmb3IgdGhlIHdob2xlIHdpZGdldC5cbiAgICAgIGlmIChzdGFydCA+IDApIGNvbGxhcHNlID0gYmlhcyA9IFwicmlnaHRcIjtcbiAgICAgIHZhciByZWN0cztcbiAgICAgIGlmIChjbS5vcHRpb25zLmxpbmVXcmFwcGluZyAmJiAocmVjdHMgPSBub2RlLmdldENsaWVudFJlY3RzKCkpLmxlbmd0aCA+IDEpXG4gICAgICAgIHJlY3QgPSByZWN0c1tiaWFzID09IFwicmlnaHRcIiA/IHJlY3RzLmxlbmd0aCAtIDEgOiAwXTtcbiAgICAgIGVsc2VcbiAgICAgICAgcmVjdCA9IG5vZGUuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgfVxuICAgIGlmIChpZSAmJiBpZV92ZXJzaW9uIDwgOSAmJiAhc3RhcnQgJiYgKCFyZWN0IHx8ICFyZWN0LmxlZnQgJiYgIXJlY3QucmlnaHQpKSB7XG4gICAgICB2YXIgclNwYW4gPSBub2RlLnBhcmVudE5vZGUuZ2V0Q2xpZW50UmVjdHMoKVswXTtcbiAgICAgIGlmIChyU3BhbilcbiAgICAgICAgcmVjdCA9IHtsZWZ0OiByU3Bhbi5sZWZ0LCByaWdodDogclNwYW4ubGVmdCArIGNoYXJXaWR0aChjbS5kaXNwbGF5KSwgdG9wOiByU3Bhbi50b3AsIGJvdHRvbTogclNwYW4uYm90dG9tfTtcbiAgICAgIGVsc2VcbiAgICAgICAgcmVjdCA9IG51bGxSZWN0O1xuICAgIH1cblxuICAgIHZhciBydG9wID0gcmVjdC50b3AgLSBwcmVwYXJlZC5yZWN0LnRvcCwgcmJvdCA9IHJlY3QuYm90dG9tIC0gcHJlcGFyZWQucmVjdC50b3A7XG4gICAgdmFyIG1pZCA9IChydG9wICsgcmJvdCkgLyAyO1xuICAgIHZhciBoZWlnaHRzID0gcHJlcGFyZWQudmlldy5tZWFzdXJlLmhlaWdodHM7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBoZWlnaHRzLmxlbmd0aCAtIDE7IGkrKylcbiAgICAgIGlmIChtaWQgPCBoZWlnaHRzW2ldKSBicmVhaztcbiAgICB2YXIgdG9wID0gaSA/IGhlaWdodHNbaSAtIDFdIDogMCwgYm90ID0gaGVpZ2h0c1tpXTtcbiAgICB2YXIgcmVzdWx0ID0ge2xlZnQ6IChjb2xsYXBzZSA9PSBcInJpZ2h0XCIgPyByZWN0LnJpZ2h0IDogcmVjdC5sZWZ0KSAtIHByZXBhcmVkLnJlY3QubGVmdCxcbiAgICAgICAgICAgICAgICAgIHJpZ2h0OiAoY29sbGFwc2UgPT0gXCJsZWZ0XCIgPyByZWN0LmxlZnQgOiByZWN0LnJpZ2h0KSAtIHByZXBhcmVkLnJlY3QubGVmdCxcbiAgICAgICAgICAgICAgICAgIHRvcDogdG9wLCBib3R0b206IGJvdH07XG4gICAgaWYgKCFyZWN0LmxlZnQgJiYgIXJlY3QucmlnaHQpIHJlc3VsdC5ib2d1cyA9IHRydWU7XG4gICAgaWYgKCFjbS5vcHRpb25zLnNpbmdsZUN1cnNvckhlaWdodFBlckxpbmUpIHsgcmVzdWx0LnJ0b3AgPSBydG9wOyByZXN1bHQucmJvdHRvbSA9IHJib3Q7IH1cblxuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICAvLyBXb3JrIGFyb3VuZCBwcm9ibGVtIHdpdGggYm91bmRpbmcgY2xpZW50IHJlY3RzIG9uIHJhbmdlcyBiZWluZ1xuICAvLyByZXR1cm5lZCBpbmNvcnJlY3RseSB3aGVuIHpvb21lZCBvbiBJRTEwIGFuZCBiZWxvdy5cbiAgZnVuY3Rpb24gbWF5YmVVcGRhdGVSZWN0Rm9yWm9vbWluZyhtZWFzdXJlLCByZWN0KSB7XG4gICAgaWYgKCF3aW5kb3cuc2NyZWVuIHx8IHNjcmVlbi5sb2dpY2FsWERQSSA9PSBudWxsIHx8XG4gICAgICAgIHNjcmVlbi5sb2dpY2FsWERQSSA9PSBzY3JlZW4uZGV2aWNlWERQSSB8fCAhaGFzQmFkWm9vbWVkUmVjdHMobWVhc3VyZSkpXG4gICAgICByZXR1cm4gcmVjdDtcbiAgICB2YXIgc2NhbGVYID0gc2NyZWVuLmxvZ2ljYWxYRFBJIC8gc2NyZWVuLmRldmljZVhEUEk7XG4gICAgdmFyIHNjYWxlWSA9IHNjcmVlbi5sb2dpY2FsWURQSSAvIHNjcmVlbi5kZXZpY2VZRFBJO1xuICAgIHJldHVybiB7bGVmdDogcmVjdC5sZWZ0ICogc2NhbGVYLCByaWdodDogcmVjdC5yaWdodCAqIHNjYWxlWCxcbiAgICAgICAgICAgIHRvcDogcmVjdC50b3AgKiBzY2FsZVksIGJvdHRvbTogcmVjdC5ib3R0b20gKiBzY2FsZVl9O1xuICB9XG5cbiAgZnVuY3Rpb24gY2xlYXJMaW5lTWVhc3VyZW1lbnRDYWNoZUZvcihsaW5lVmlldykge1xuICAgIGlmIChsaW5lVmlldy5tZWFzdXJlKSB7XG4gICAgICBsaW5lVmlldy5tZWFzdXJlLmNhY2hlID0ge307XG4gICAgICBsaW5lVmlldy5tZWFzdXJlLmhlaWdodHMgPSBudWxsO1xuICAgICAgaWYgKGxpbmVWaWV3LnJlc3QpIGZvciAodmFyIGkgPSAwOyBpIDwgbGluZVZpZXcucmVzdC5sZW5ndGg7IGkrKylcbiAgICAgICAgbGluZVZpZXcubWVhc3VyZS5jYWNoZXNbaV0gPSB7fTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBjbGVhckxpbmVNZWFzdXJlbWVudENhY2hlKGNtKSB7XG4gICAgY20uZGlzcGxheS5leHRlcm5hbE1lYXN1cmUgPSBudWxsO1xuICAgIHJlbW92ZUNoaWxkcmVuKGNtLmRpc3BsYXkubGluZU1lYXN1cmUpO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY20uZGlzcGxheS52aWV3Lmxlbmd0aDsgaSsrKVxuICAgICAgY2xlYXJMaW5lTWVhc3VyZW1lbnRDYWNoZUZvcihjbS5kaXNwbGF5LnZpZXdbaV0pO1xuICB9XG5cbiAgZnVuY3Rpb24gY2xlYXJDYWNoZXMoY20pIHtcbiAgICBjbGVhckxpbmVNZWFzdXJlbWVudENhY2hlKGNtKTtcbiAgICBjbS5kaXNwbGF5LmNhY2hlZENoYXJXaWR0aCA9IGNtLmRpc3BsYXkuY2FjaGVkVGV4dEhlaWdodCA9IGNtLmRpc3BsYXkuY2FjaGVkUGFkZGluZ0ggPSBudWxsO1xuICAgIGlmICghY20ub3B0aW9ucy5saW5lV3JhcHBpbmcpIGNtLmRpc3BsYXkubWF4TGluZUNoYW5nZWQgPSB0cnVlO1xuICAgIGNtLmRpc3BsYXkubGluZU51bUNoYXJzID0gbnVsbDtcbiAgfVxuXG4gIGZ1bmN0aW9uIHBhZ2VTY3JvbGxYKCkgeyByZXR1cm4gd2luZG93LnBhZ2VYT2Zmc2V0IHx8IChkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQgfHwgZG9jdW1lbnQuYm9keSkuc2Nyb2xsTGVmdDsgfVxuICBmdW5jdGlvbiBwYWdlU2Nyb2xsWSgpIHsgcmV0dXJuIHdpbmRvdy5wYWdlWU9mZnNldCB8fCAoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50IHx8IGRvY3VtZW50LmJvZHkpLnNjcm9sbFRvcDsgfVxuXG4gIC8vIENvbnZlcnRzIGEge3RvcCwgYm90dG9tLCBsZWZ0LCByaWdodH0gYm94IGZyb20gbGluZS1sb2NhbFxuICAvLyBjb29yZGluYXRlcyBpbnRvIGFub3RoZXIgY29vcmRpbmF0ZSBzeXN0ZW0uIENvbnRleHQgbWF5IGJlIG9uZSBvZlxuICAvLyBcImxpbmVcIiwgXCJkaXZcIiAoZGlzcGxheS5saW5lRGl2KSwgXCJsb2NhbFwiL251bGwgKGVkaXRvciksIFwid2luZG93XCIsXG4gIC8vIG9yIFwicGFnZVwiLlxuICBmdW5jdGlvbiBpbnRvQ29vcmRTeXN0ZW0oY20sIGxpbmVPYmosIHJlY3QsIGNvbnRleHQpIHtcbiAgICBpZiAobGluZU9iai53aWRnZXRzKSBmb3IgKHZhciBpID0gMDsgaSA8IGxpbmVPYmoud2lkZ2V0cy5sZW5ndGg7ICsraSkgaWYgKGxpbmVPYmoud2lkZ2V0c1tpXS5hYm92ZSkge1xuICAgICAgdmFyIHNpemUgPSB3aWRnZXRIZWlnaHQobGluZU9iai53aWRnZXRzW2ldKTtcbiAgICAgIHJlY3QudG9wICs9IHNpemU7IHJlY3QuYm90dG9tICs9IHNpemU7XG4gICAgfVxuICAgIGlmIChjb250ZXh0ID09IFwibGluZVwiKSByZXR1cm4gcmVjdDtcbiAgICBpZiAoIWNvbnRleHQpIGNvbnRleHQgPSBcImxvY2FsXCI7XG4gICAgdmFyIHlPZmYgPSBoZWlnaHRBdExpbmUobGluZU9iaik7XG4gICAgaWYgKGNvbnRleHQgPT0gXCJsb2NhbFwiKSB5T2ZmICs9IHBhZGRpbmdUb3AoY20uZGlzcGxheSk7XG4gICAgZWxzZSB5T2ZmIC09IGNtLmRpc3BsYXkudmlld09mZnNldDtcbiAgICBpZiAoY29udGV4dCA9PSBcInBhZ2VcIiB8fCBjb250ZXh0ID09IFwid2luZG93XCIpIHtcbiAgICAgIHZhciBsT2ZmID0gY20uZGlzcGxheS5saW5lU3BhY2UuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgICB5T2ZmICs9IGxPZmYudG9wICsgKGNvbnRleHQgPT0gXCJ3aW5kb3dcIiA/IDAgOiBwYWdlU2Nyb2xsWSgpKTtcbiAgICAgIHZhciB4T2ZmID0gbE9mZi5sZWZ0ICsgKGNvbnRleHQgPT0gXCJ3aW5kb3dcIiA/IDAgOiBwYWdlU2Nyb2xsWCgpKTtcbiAgICAgIHJlY3QubGVmdCArPSB4T2ZmOyByZWN0LnJpZ2h0ICs9IHhPZmY7XG4gICAgfVxuICAgIHJlY3QudG9wICs9IHlPZmY7IHJlY3QuYm90dG9tICs9IHlPZmY7XG4gICAgcmV0dXJuIHJlY3Q7XG4gIH1cblxuICAvLyBDb3ZlcnRzIGEgYm94IGZyb20gXCJkaXZcIiBjb29yZHMgdG8gYW5vdGhlciBjb29yZGluYXRlIHN5c3RlbS5cbiAgLy8gQ29udGV4dCBtYXkgYmUgXCJ3aW5kb3dcIiwgXCJwYWdlXCIsIFwiZGl2XCIsIG9yIFwibG9jYWxcIi9udWxsLlxuICBmdW5jdGlvbiBmcm9tQ29vcmRTeXN0ZW0oY20sIGNvb3JkcywgY29udGV4dCkge1xuICAgIGlmIChjb250ZXh0ID09IFwiZGl2XCIpIHJldHVybiBjb29yZHM7XG4gICAgdmFyIGxlZnQgPSBjb29yZHMubGVmdCwgdG9wID0gY29vcmRzLnRvcDtcbiAgICAvLyBGaXJzdCBtb3ZlIGludG8gXCJwYWdlXCIgY29vcmRpbmF0ZSBzeXN0ZW1cbiAgICBpZiAoY29udGV4dCA9PSBcInBhZ2VcIikge1xuICAgICAgbGVmdCAtPSBwYWdlU2Nyb2xsWCgpO1xuICAgICAgdG9wIC09IHBhZ2VTY3JvbGxZKCk7XG4gICAgfSBlbHNlIGlmIChjb250ZXh0ID09IFwibG9jYWxcIiB8fCAhY29udGV4dCkge1xuICAgICAgdmFyIGxvY2FsQm94ID0gY20uZGlzcGxheS5zaXplci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgIGxlZnQgKz0gbG9jYWxCb3gubGVmdDtcbiAgICAgIHRvcCArPSBsb2NhbEJveC50b3A7XG4gICAgfVxuXG4gICAgdmFyIGxpbmVTcGFjZUJveCA9IGNtLmRpc3BsYXkubGluZVNwYWNlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgIHJldHVybiB7bGVmdDogbGVmdCAtIGxpbmVTcGFjZUJveC5sZWZ0LCB0b3A6IHRvcCAtIGxpbmVTcGFjZUJveC50b3B9O1xuICB9XG5cbiAgZnVuY3Rpb24gY2hhckNvb3JkcyhjbSwgcG9zLCBjb250ZXh0LCBsaW5lT2JqLCBiaWFzKSB7XG4gICAgaWYgKCFsaW5lT2JqKSBsaW5lT2JqID0gZ2V0TGluZShjbS5kb2MsIHBvcy5saW5lKTtcbiAgICByZXR1cm4gaW50b0Nvb3JkU3lzdGVtKGNtLCBsaW5lT2JqLCBtZWFzdXJlQ2hhcihjbSwgbGluZU9iaiwgcG9zLmNoLCBiaWFzKSwgY29udGV4dCk7XG4gIH1cblxuICAvLyBSZXR1cm5zIGEgYm94IGZvciBhIGdpdmVuIGN1cnNvciBwb3NpdGlvbiwgd2hpY2ggbWF5IGhhdmUgYW5cbiAgLy8gJ290aGVyJyBwcm9wZXJ0eSBjb250YWluaW5nIHRoZSBwb3NpdGlvbiBvZiB0aGUgc2Vjb25kYXJ5IGN1cnNvclxuICAvLyBvbiBhIGJpZGkgYm91bmRhcnkuXG4gIGZ1bmN0aW9uIGN1cnNvckNvb3JkcyhjbSwgcG9zLCBjb250ZXh0LCBsaW5lT2JqLCBwcmVwYXJlZE1lYXN1cmUsIHZhckhlaWdodCkge1xuICAgIGxpbmVPYmogPSBsaW5lT2JqIHx8IGdldExpbmUoY20uZG9jLCBwb3MubGluZSk7XG4gICAgaWYgKCFwcmVwYXJlZE1lYXN1cmUpIHByZXBhcmVkTWVhc3VyZSA9IHByZXBhcmVNZWFzdXJlRm9yTGluZShjbSwgbGluZU9iaik7XG4gICAgZnVuY3Rpb24gZ2V0KGNoLCByaWdodCkge1xuICAgICAgdmFyIG0gPSBtZWFzdXJlQ2hhclByZXBhcmVkKGNtLCBwcmVwYXJlZE1lYXN1cmUsIGNoLCByaWdodCA/IFwicmlnaHRcIiA6IFwibGVmdFwiLCB2YXJIZWlnaHQpO1xuICAgICAgaWYgKHJpZ2h0KSBtLmxlZnQgPSBtLnJpZ2h0OyBlbHNlIG0ucmlnaHQgPSBtLmxlZnQ7XG4gICAgICByZXR1cm4gaW50b0Nvb3JkU3lzdGVtKGNtLCBsaW5lT2JqLCBtLCBjb250ZXh0KTtcbiAgICB9XG4gICAgZnVuY3Rpb24gZ2V0QmlkaShjaCwgcGFydFBvcykge1xuICAgICAgdmFyIHBhcnQgPSBvcmRlcltwYXJ0UG9zXSwgcmlnaHQgPSBwYXJ0LmxldmVsICUgMjtcbiAgICAgIGlmIChjaCA9PSBiaWRpTGVmdChwYXJ0KSAmJiBwYXJ0UG9zICYmIHBhcnQubGV2ZWwgPCBvcmRlcltwYXJ0UG9zIC0gMV0ubGV2ZWwpIHtcbiAgICAgICAgcGFydCA9IG9yZGVyWy0tcGFydFBvc107XG4gICAgICAgIGNoID0gYmlkaVJpZ2h0KHBhcnQpIC0gKHBhcnQubGV2ZWwgJSAyID8gMCA6IDEpO1xuICAgICAgICByaWdodCA9IHRydWU7XG4gICAgICB9IGVsc2UgaWYgKGNoID09IGJpZGlSaWdodChwYXJ0KSAmJiBwYXJ0UG9zIDwgb3JkZXIubGVuZ3RoIC0gMSAmJiBwYXJ0LmxldmVsIDwgb3JkZXJbcGFydFBvcyArIDFdLmxldmVsKSB7XG4gICAgICAgIHBhcnQgPSBvcmRlclsrK3BhcnRQb3NdO1xuICAgICAgICBjaCA9IGJpZGlMZWZ0KHBhcnQpIC0gcGFydC5sZXZlbCAlIDI7XG4gICAgICAgIHJpZ2h0ID0gZmFsc2U7XG4gICAgICB9XG4gICAgICBpZiAocmlnaHQgJiYgY2ggPT0gcGFydC50byAmJiBjaCA+IHBhcnQuZnJvbSkgcmV0dXJuIGdldChjaCAtIDEpO1xuICAgICAgcmV0dXJuIGdldChjaCwgcmlnaHQpO1xuICAgIH1cbiAgICB2YXIgb3JkZXIgPSBnZXRPcmRlcihsaW5lT2JqKSwgY2ggPSBwb3MuY2g7XG4gICAgaWYgKCFvcmRlcikgcmV0dXJuIGdldChjaCk7XG4gICAgdmFyIHBhcnRQb3MgPSBnZXRCaWRpUGFydEF0KG9yZGVyLCBjaCk7XG4gICAgdmFyIHZhbCA9IGdldEJpZGkoY2gsIHBhcnRQb3MpO1xuICAgIGlmIChiaWRpT3RoZXIgIT0gbnVsbCkgdmFsLm90aGVyID0gZ2V0QmlkaShjaCwgYmlkaU90aGVyKTtcbiAgICByZXR1cm4gdmFsO1xuICB9XG5cbiAgLy8gVXNlZCB0byBjaGVhcGx5IGVzdGltYXRlIHRoZSBjb29yZGluYXRlcyBmb3IgYSBwb3NpdGlvbi4gVXNlZCBmb3JcbiAgLy8gaW50ZXJtZWRpYXRlIHNjcm9sbCB1cGRhdGVzLlxuICBmdW5jdGlvbiBlc3RpbWF0ZUNvb3JkcyhjbSwgcG9zKSB7XG4gICAgdmFyIGxlZnQgPSAwLCBwb3MgPSBjbGlwUG9zKGNtLmRvYywgcG9zKTtcbiAgICBpZiAoIWNtLm9wdGlvbnMubGluZVdyYXBwaW5nKSBsZWZ0ID0gY2hhcldpZHRoKGNtLmRpc3BsYXkpICogcG9zLmNoO1xuICAgIHZhciBsaW5lT2JqID0gZ2V0TGluZShjbS5kb2MsIHBvcy5saW5lKTtcbiAgICB2YXIgdG9wID0gaGVpZ2h0QXRMaW5lKGxpbmVPYmopICsgcGFkZGluZ1RvcChjbS5kaXNwbGF5KTtcbiAgICByZXR1cm4ge2xlZnQ6IGxlZnQsIHJpZ2h0OiBsZWZ0LCB0b3A6IHRvcCwgYm90dG9tOiB0b3AgKyBsaW5lT2JqLmhlaWdodH07XG4gIH1cblxuICAvLyBQb3NpdGlvbnMgcmV0dXJuZWQgYnkgY29vcmRzQ2hhciBjb250YWluIHNvbWUgZXh0cmEgaW5mb3JtYXRpb24uXG4gIC8vIHhSZWwgaXMgdGhlIHJlbGF0aXZlIHggcG9zaXRpb24gb2YgdGhlIGlucHV0IGNvb3JkaW5hdGVzIGNvbXBhcmVkXG4gIC8vIHRvIHRoZSBmb3VuZCBwb3NpdGlvbiAoc28geFJlbCA+IDAgbWVhbnMgdGhlIGNvb3JkaW5hdGVzIGFyZSB0b1xuICAvLyB0aGUgcmlnaHQgb2YgdGhlIGNoYXJhY3RlciBwb3NpdGlvbiwgZm9yIGV4YW1wbGUpLiBXaGVuIG91dHNpZGVcbiAgLy8gaXMgdHJ1ZSwgdGhhdCBtZWFucyB0aGUgY29vcmRpbmF0ZXMgbGllIG91dHNpZGUgdGhlIGxpbmUnc1xuICAvLyB2ZXJ0aWNhbCByYW5nZS5cbiAgZnVuY3Rpb24gUG9zV2l0aEluZm8obGluZSwgY2gsIG91dHNpZGUsIHhSZWwpIHtcbiAgICB2YXIgcG9zID0gUG9zKGxpbmUsIGNoKTtcbiAgICBwb3MueFJlbCA9IHhSZWw7XG4gICAgaWYgKG91dHNpZGUpIHBvcy5vdXRzaWRlID0gdHJ1ZTtcbiAgICByZXR1cm4gcG9zO1xuICB9XG5cbiAgLy8gQ29tcHV0ZSB0aGUgY2hhcmFjdGVyIHBvc2l0aW9uIGNsb3Nlc3QgdG8gdGhlIGdpdmVuIGNvb3JkaW5hdGVzLlxuICAvLyBJbnB1dCBtdXN0IGJlIGxpbmVTcGFjZS1sb2NhbCAoXCJkaXZcIiBjb29yZGluYXRlIHN5c3RlbSkuXG4gIGZ1bmN0aW9uIGNvb3Jkc0NoYXIoY20sIHgsIHkpIHtcbiAgICB2YXIgZG9jID0gY20uZG9jO1xuICAgIHkgKz0gY20uZGlzcGxheS52aWV3T2Zmc2V0O1xuICAgIGlmICh5IDwgMCkgcmV0dXJuIFBvc1dpdGhJbmZvKGRvYy5maXJzdCwgMCwgdHJ1ZSwgLTEpO1xuICAgIHZhciBsaW5lTiA9IGxpbmVBdEhlaWdodChkb2MsIHkpLCBsYXN0ID0gZG9jLmZpcnN0ICsgZG9jLnNpemUgLSAxO1xuICAgIGlmIChsaW5lTiA+IGxhc3QpXG4gICAgICByZXR1cm4gUG9zV2l0aEluZm8oZG9jLmZpcnN0ICsgZG9jLnNpemUgLSAxLCBnZXRMaW5lKGRvYywgbGFzdCkudGV4dC5sZW5ndGgsIHRydWUsIDEpO1xuICAgIGlmICh4IDwgMCkgeCA9IDA7XG5cbiAgICB2YXIgbGluZU9iaiA9IGdldExpbmUoZG9jLCBsaW5lTik7XG4gICAgZm9yICg7Oykge1xuICAgICAgdmFyIGZvdW5kID0gY29vcmRzQ2hhcklubmVyKGNtLCBsaW5lT2JqLCBsaW5lTiwgeCwgeSk7XG4gICAgICB2YXIgbWVyZ2VkID0gY29sbGFwc2VkU3BhbkF0RW5kKGxpbmVPYmopO1xuICAgICAgdmFyIG1lcmdlZFBvcyA9IG1lcmdlZCAmJiBtZXJnZWQuZmluZCgwLCB0cnVlKTtcbiAgICAgIGlmIChtZXJnZWQgJiYgKGZvdW5kLmNoID4gbWVyZ2VkUG9zLmZyb20uY2ggfHwgZm91bmQuY2ggPT0gbWVyZ2VkUG9zLmZyb20uY2ggJiYgZm91bmQueFJlbCA+IDApKVxuICAgICAgICBsaW5lTiA9IGxpbmVObyhsaW5lT2JqID0gbWVyZ2VkUG9zLnRvLmxpbmUpO1xuICAgICAgZWxzZVxuICAgICAgICByZXR1cm4gZm91bmQ7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gY29vcmRzQ2hhcklubmVyKGNtLCBsaW5lT2JqLCBsaW5lTm8sIHgsIHkpIHtcbiAgICB2YXIgaW5uZXJPZmYgPSB5IC0gaGVpZ2h0QXRMaW5lKGxpbmVPYmopO1xuICAgIHZhciB3cm9uZ0xpbmUgPSBmYWxzZSwgYWRqdXN0ID0gMiAqIGNtLmRpc3BsYXkud3JhcHBlci5jbGllbnRXaWR0aDtcbiAgICB2YXIgcHJlcGFyZWRNZWFzdXJlID0gcHJlcGFyZU1lYXN1cmVGb3JMaW5lKGNtLCBsaW5lT2JqKTtcblxuICAgIGZ1bmN0aW9uIGdldFgoY2gpIHtcbiAgICAgIHZhciBzcCA9IGN1cnNvckNvb3JkcyhjbSwgUG9zKGxpbmVObywgY2gpLCBcImxpbmVcIiwgbGluZU9iaiwgcHJlcGFyZWRNZWFzdXJlKTtcbiAgICAgIHdyb25nTGluZSA9IHRydWU7XG4gICAgICBpZiAoaW5uZXJPZmYgPiBzcC5ib3R0b20pIHJldHVybiBzcC5sZWZ0IC0gYWRqdXN0O1xuICAgICAgZWxzZSBpZiAoaW5uZXJPZmYgPCBzcC50b3ApIHJldHVybiBzcC5sZWZ0ICsgYWRqdXN0O1xuICAgICAgZWxzZSB3cm9uZ0xpbmUgPSBmYWxzZTtcbiAgICAgIHJldHVybiBzcC5sZWZ0O1xuICAgIH1cblxuICAgIHZhciBiaWRpID0gZ2V0T3JkZXIobGluZU9iaiksIGRpc3QgPSBsaW5lT2JqLnRleHQubGVuZ3RoO1xuICAgIHZhciBmcm9tID0gbGluZUxlZnQobGluZU9iaiksIHRvID0gbGluZVJpZ2h0KGxpbmVPYmopO1xuICAgIHZhciBmcm9tWCA9IGdldFgoZnJvbSksIGZyb21PdXRzaWRlID0gd3JvbmdMaW5lLCB0b1ggPSBnZXRYKHRvKSwgdG9PdXRzaWRlID0gd3JvbmdMaW5lO1xuXG4gICAgaWYgKHggPiB0b1gpIHJldHVybiBQb3NXaXRoSW5mbyhsaW5lTm8sIHRvLCB0b091dHNpZGUsIDEpO1xuICAgIC8vIERvIGEgYmluYXJ5IHNlYXJjaCBiZXR3ZWVuIHRoZXNlIGJvdW5kcy5cbiAgICBmb3IgKDs7KSB7XG4gICAgICBpZiAoYmlkaSA/IHRvID09IGZyb20gfHwgdG8gPT0gbW92ZVZpc3VhbGx5KGxpbmVPYmosIGZyb20sIDEpIDogdG8gLSBmcm9tIDw9IDEpIHtcbiAgICAgICAgdmFyIGNoID0geCA8IGZyb21YIHx8IHggLSBmcm9tWCA8PSB0b1ggLSB4ID8gZnJvbSA6IHRvO1xuICAgICAgICB2YXIgeERpZmYgPSB4IC0gKGNoID09IGZyb20gPyBmcm9tWCA6IHRvWCk7XG4gICAgICAgIHdoaWxlIChpc0V4dGVuZGluZ0NoYXIobGluZU9iai50ZXh0LmNoYXJBdChjaCkpKSArK2NoO1xuICAgICAgICB2YXIgcG9zID0gUG9zV2l0aEluZm8obGluZU5vLCBjaCwgY2ggPT0gZnJvbSA/IGZyb21PdXRzaWRlIDogdG9PdXRzaWRlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeERpZmYgPCAtMSA/IC0xIDogeERpZmYgPiAxID8gMSA6IDApO1xuICAgICAgICByZXR1cm4gcG9zO1xuICAgICAgfVxuICAgICAgdmFyIHN0ZXAgPSBNYXRoLmNlaWwoZGlzdCAvIDIpLCBtaWRkbGUgPSBmcm9tICsgc3RlcDtcbiAgICAgIGlmIChiaWRpKSB7XG4gICAgICAgIG1pZGRsZSA9IGZyb207XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc3RlcDsgKytpKSBtaWRkbGUgPSBtb3ZlVmlzdWFsbHkobGluZU9iaiwgbWlkZGxlLCAxKTtcbiAgICAgIH1cbiAgICAgIHZhciBtaWRkbGVYID0gZ2V0WChtaWRkbGUpO1xuICAgICAgaWYgKG1pZGRsZVggPiB4KSB7dG8gPSBtaWRkbGU7IHRvWCA9IG1pZGRsZVg7IGlmICh0b091dHNpZGUgPSB3cm9uZ0xpbmUpIHRvWCArPSAxMDAwOyBkaXN0ID0gc3RlcDt9XG4gICAgICBlbHNlIHtmcm9tID0gbWlkZGxlOyBmcm9tWCA9IG1pZGRsZVg7IGZyb21PdXRzaWRlID0gd3JvbmdMaW5lOyBkaXN0IC09IHN0ZXA7fVxuICAgIH1cbiAgfVxuXG4gIHZhciBtZWFzdXJlVGV4dDtcbiAgLy8gQ29tcHV0ZSB0aGUgZGVmYXVsdCB0ZXh0IGhlaWdodC5cbiAgZnVuY3Rpb24gdGV4dEhlaWdodChkaXNwbGF5KSB7XG4gICAgaWYgKGRpc3BsYXkuY2FjaGVkVGV4dEhlaWdodCAhPSBudWxsKSByZXR1cm4gZGlzcGxheS5jYWNoZWRUZXh0SGVpZ2h0O1xuICAgIGlmIChtZWFzdXJlVGV4dCA9PSBudWxsKSB7XG4gICAgICBtZWFzdXJlVGV4dCA9IGVsdChcInByZVwiKTtcbiAgICAgIC8vIE1lYXN1cmUgYSBidW5jaCBvZiBsaW5lcywgZm9yIGJyb3dzZXJzIHRoYXQgY29tcHV0ZVxuICAgICAgLy8gZnJhY3Rpb25hbCBoZWlnaHRzLlxuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCA0OTsgKytpKSB7XG4gICAgICAgIG1lYXN1cmVUZXh0LmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKFwieFwiKSk7XG4gICAgICAgIG1lYXN1cmVUZXh0LmFwcGVuZENoaWxkKGVsdChcImJyXCIpKTtcbiAgICAgIH1cbiAgICAgIG1lYXN1cmVUZXh0LmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKFwieFwiKSk7XG4gICAgfVxuICAgIHJlbW92ZUNoaWxkcmVuQW5kQWRkKGRpc3BsYXkubWVhc3VyZSwgbWVhc3VyZVRleHQpO1xuICAgIHZhciBoZWlnaHQgPSBtZWFzdXJlVGV4dC5vZmZzZXRIZWlnaHQgLyA1MDtcbiAgICBpZiAoaGVpZ2h0ID4gMykgZGlzcGxheS5jYWNoZWRUZXh0SGVpZ2h0ID0gaGVpZ2h0O1xuICAgIHJlbW92ZUNoaWxkcmVuKGRpc3BsYXkubWVhc3VyZSk7XG4gICAgcmV0dXJuIGhlaWdodCB8fCAxO1xuICB9XG5cbiAgLy8gQ29tcHV0ZSB0aGUgZGVmYXVsdCBjaGFyYWN0ZXIgd2lkdGguXG4gIGZ1bmN0aW9uIGNoYXJXaWR0aChkaXNwbGF5KSB7XG4gICAgaWYgKGRpc3BsYXkuY2FjaGVkQ2hhcldpZHRoICE9IG51bGwpIHJldHVybiBkaXNwbGF5LmNhY2hlZENoYXJXaWR0aDtcbiAgICB2YXIgYW5jaG9yID0gZWx0KFwic3BhblwiLCBcInh4eHh4eHh4eHhcIik7XG4gICAgdmFyIHByZSA9IGVsdChcInByZVwiLCBbYW5jaG9yXSk7XG4gICAgcmVtb3ZlQ2hpbGRyZW5BbmRBZGQoZGlzcGxheS5tZWFzdXJlLCBwcmUpO1xuICAgIHZhciByZWN0ID0gYW5jaG9yLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLCB3aWR0aCA9IChyZWN0LnJpZ2h0IC0gcmVjdC5sZWZ0KSAvIDEwO1xuICAgIGlmICh3aWR0aCA+IDIpIGRpc3BsYXkuY2FjaGVkQ2hhcldpZHRoID0gd2lkdGg7XG4gICAgcmV0dXJuIHdpZHRoIHx8IDEwO1xuICB9XG5cbiAgLy8gT1BFUkFUSU9OU1xuXG4gIC8vIE9wZXJhdGlvbnMgYXJlIHVzZWQgdG8gd3JhcCBhIHNlcmllcyBvZiBjaGFuZ2VzIHRvIHRoZSBlZGl0b3JcbiAgLy8gc3RhdGUgaW4gc3VjaCBhIHdheSB0aGF0IGVhY2ggY2hhbmdlIHdvbid0IGhhdmUgdG8gdXBkYXRlIHRoZVxuICAvLyBjdXJzb3IgYW5kIGRpc3BsYXkgKHdoaWNoIHdvdWxkIGJlIGF3a3dhcmQsIHNsb3csIGFuZFxuICAvLyBlcnJvci1wcm9uZSkuIEluc3RlYWQsIGRpc3BsYXkgdXBkYXRlcyBhcmUgYmF0Y2hlZCBhbmQgdGhlbiBhbGxcbiAgLy8gY29tYmluZWQgYW5kIGV4ZWN1dGVkIGF0IG9uY2UuXG5cbiAgdmFyIG9wZXJhdGlvbkdyb3VwID0gbnVsbDtcblxuICB2YXIgbmV4dE9wSWQgPSAwO1xuICAvLyBTdGFydCBhIG5ldyBvcGVyYXRpb24uXG4gIGZ1bmN0aW9uIHN0YXJ0T3BlcmF0aW9uKGNtKSB7XG4gICAgY20uY3VyT3AgPSB7XG4gICAgICBjbTogY20sXG4gICAgICB2aWV3Q2hhbmdlZDogZmFsc2UsICAgICAgLy8gRmxhZyB0aGF0IGluZGljYXRlcyB0aGF0IGxpbmVzIG1pZ2h0IG5lZWQgdG8gYmUgcmVkcmF3blxuICAgICAgc3RhcnRIZWlnaHQ6IGNtLmRvYy5oZWlnaHQsIC8vIFVzZWQgdG8gZGV0ZWN0IG5lZWQgdG8gdXBkYXRlIHNjcm9sbGJhclxuICAgICAgZm9yY2VVcGRhdGU6IGZhbHNlLCAgICAgIC8vIFVzZWQgdG8gZm9yY2UgYSByZWRyYXdcbiAgICAgIHVwZGF0ZUlucHV0OiBudWxsLCAgICAgICAvLyBXaGV0aGVyIHRvIHJlc2V0IHRoZSBpbnB1dCB0ZXh0YXJlYVxuICAgICAgdHlwaW5nOiBmYWxzZSwgICAgICAgICAgIC8vIFdoZXRoZXIgdGhpcyByZXNldCBzaG91bGQgYmUgY2FyZWZ1bCB0byBsZWF2ZSBleGlzdGluZyB0ZXh0IChmb3IgY29tcG9zaXRpbmcpXG4gICAgICBjaGFuZ2VPYmpzOiBudWxsLCAgICAgICAgLy8gQWNjdW11bGF0ZWQgY2hhbmdlcywgZm9yIGZpcmluZyBjaGFuZ2UgZXZlbnRzXG4gICAgICBjdXJzb3JBY3Rpdml0eUhhbmRsZXJzOiBudWxsLCAvLyBTZXQgb2YgaGFuZGxlcnMgdG8gZmlyZSBjdXJzb3JBY3Rpdml0eSBvblxuICAgICAgY3Vyc29yQWN0aXZpdHlDYWxsZWQ6IDAsIC8vIFRyYWNrcyB3aGljaCBjdXJzb3JBY3Rpdml0eSBoYW5kbGVycyBoYXZlIGJlZW4gY2FsbGVkIGFscmVhZHlcbiAgICAgIHNlbGVjdGlvbkNoYW5nZWQ6IGZhbHNlLCAvLyBXaGV0aGVyIHRoZSBzZWxlY3Rpb24gbmVlZHMgdG8gYmUgcmVkcmF3blxuICAgICAgdXBkYXRlTWF4TGluZTogZmFsc2UsICAgIC8vIFNldCB3aGVuIHRoZSB3aWRlc3QgbGluZSBuZWVkcyB0byBiZSBkZXRlcm1pbmVkIGFuZXdcbiAgICAgIHNjcm9sbExlZnQ6IG51bGwsIHNjcm9sbFRvcDogbnVsbCwgLy8gSW50ZXJtZWRpYXRlIHNjcm9sbCBwb3NpdGlvbiwgbm90IHB1c2hlZCB0byBET00geWV0XG4gICAgICBzY3JvbGxUb1BvczogbnVsbCwgICAgICAgLy8gVXNlZCB0byBzY3JvbGwgdG8gYSBzcGVjaWZpYyBwb3NpdGlvblxuICAgICAgZm9jdXM6IGZhbHNlLFxuICAgICAgaWQ6ICsrbmV4dE9wSWQgICAgICAgICAgIC8vIFVuaXF1ZSBJRFxuICAgIH07XG4gICAgaWYgKG9wZXJhdGlvbkdyb3VwKSB7XG4gICAgICBvcGVyYXRpb25Hcm91cC5vcHMucHVzaChjbS5jdXJPcCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNtLmN1ck9wLm93bnNHcm91cCA9IG9wZXJhdGlvbkdyb3VwID0ge1xuICAgICAgICBvcHM6IFtjbS5jdXJPcF0sXG4gICAgICAgIGRlbGF5ZWRDYWxsYmFja3M6IFtdXG4gICAgICB9O1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIGZpcmVDYWxsYmFja3NGb3JPcHMoZ3JvdXApIHtcbiAgICAvLyBDYWxscyBkZWxheWVkIGNhbGxiYWNrcyBhbmQgY3Vyc29yQWN0aXZpdHkgaGFuZGxlcnMgdW50aWwgbm9cbiAgICAvLyBuZXcgb25lcyBhcHBlYXJcbiAgICB2YXIgY2FsbGJhY2tzID0gZ3JvdXAuZGVsYXllZENhbGxiYWNrcywgaSA9IDA7XG4gICAgZG8ge1xuICAgICAgZm9yICg7IGkgPCBjYWxsYmFja3MubGVuZ3RoOyBpKyspXG4gICAgICAgIGNhbGxiYWNrc1tpXS5jYWxsKG51bGwpO1xuICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBncm91cC5vcHMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgdmFyIG9wID0gZ3JvdXAub3BzW2pdO1xuICAgICAgICBpZiAob3AuY3Vyc29yQWN0aXZpdHlIYW5kbGVycylcbiAgICAgICAgICB3aGlsZSAob3AuY3Vyc29yQWN0aXZpdHlDYWxsZWQgPCBvcC5jdXJzb3JBY3Rpdml0eUhhbmRsZXJzLmxlbmd0aClcbiAgICAgICAgICAgIG9wLmN1cnNvckFjdGl2aXR5SGFuZGxlcnNbb3AuY3Vyc29yQWN0aXZpdHlDYWxsZWQrK10uY2FsbChudWxsLCBvcC5jbSk7XG4gICAgICB9XG4gICAgfSB3aGlsZSAoaSA8IGNhbGxiYWNrcy5sZW5ndGgpO1xuICB9XG5cbiAgLy8gRmluaXNoIGFuIG9wZXJhdGlvbiwgdXBkYXRpbmcgdGhlIGRpc3BsYXkgYW5kIHNpZ25hbGxpbmcgZGVsYXllZCBldmVudHNcbiAgZnVuY3Rpb24gZW5kT3BlcmF0aW9uKGNtKSB7XG4gICAgdmFyIG9wID0gY20uY3VyT3AsIGdyb3VwID0gb3Aub3duc0dyb3VwO1xuICAgIGlmICghZ3JvdXApIHJldHVybjtcblxuICAgIHRyeSB7IGZpcmVDYWxsYmFja3NGb3JPcHMoZ3JvdXApOyB9XG4gICAgZmluYWxseSB7XG4gICAgICBvcGVyYXRpb25Hcm91cCA9IG51bGw7XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGdyb3VwLm9wcy5sZW5ndGg7IGkrKylcbiAgICAgICAgZ3JvdXAub3BzW2ldLmNtLmN1ck9wID0gbnVsbDtcbiAgICAgIGVuZE9wZXJhdGlvbnMoZ3JvdXApO1xuICAgIH1cbiAgfVxuXG4gIC8vIFRoZSBET00gdXBkYXRlcyBkb25lIHdoZW4gYW4gb3BlcmF0aW9uIGZpbmlzaGVzIGFyZSBiYXRjaGVkIHNvXG4gIC8vIHRoYXQgdGhlIG1pbmltdW0gbnVtYmVyIG9mIHJlbGF5b3V0cyBhcmUgcmVxdWlyZWQuXG4gIGZ1bmN0aW9uIGVuZE9wZXJhdGlvbnMoZ3JvdXApIHtcbiAgICB2YXIgb3BzID0gZ3JvdXAub3BzO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb3BzLmxlbmd0aDsgaSsrKSAvLyBSZWFkIERPTVxuICAgICAgZW5kT3BlcmF0aW9uX1IxKG9wc1tpXSk7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBvcHMubGVuZ3RoOyBpKyspIC8vIFdyaXRlIERPTSAobWF5YmUpXG4gICAgICBlbmRPcGVyYXRpb25fVzEob3BzW2ldKTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IG9wcy5sZW5ndGg7IGkrKykgLy8gUmVhZCBET01cbiAgICAgIGVuZE9wZXJhdGlvbl9SMihvcHNbaV0pO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb3BzLmxlbmd0aDsgaSsrKSAvLyBXcml0ZSBET00gKG1heWJlKVxuICAgICAgZW5kT3BlcmF0aW9uX1cyKG9wc1tpXSk7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBvcHMubGVuZ3RoOyBpKyspIC8vIFJlYWQgRE9NXG4gICAgICBlbmRPcGVyYXRpb25fZmluaXNoKG9wc1tpXSk7XG4gIH1cblxuICBmdW5jdGlvbiBlbmRPcGVyYXRpb25fUjEob3ApIHtcbiAgICB2YXIgY20gPSBvcC5jbSwgZGlzcGxheSA9IGNtLmRpc3BsYXk7XG4gICAgbWF5YmVDbGlwU2Nyb2xsYmFycyhjbSk7XG4gICAgaWYgKG9wLnVwZGF0ZU1heExpbmUpIGZpbmRNYXhMaW5lKGNtKTtcblxuICAgIG9wLm11c3RVcGRhdGUgPSBvcC52aWV3Q2hhbmdlZCB8fCBvcC5mb3JjZVVwZGF0ZSB8fCBvcC5zY3JvbGxUb3AgIT0gbnVsbCB8fFxuICAgICAgb3Auc2Nyb2xsVG9Qb3MgJiYgKG9wLnNjcm9sbFRvUG9zLmZyb20ubGluZSA8IGRpc3BsYXkudmlld0Zyb20gfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICBvcC5zY3JvbGxUb1Bvcy50by5saW5lID49IGRpc3BsYXkudmlld1RvKSB8fFxuICAgICAgZGlzcGxheS5tYXhMaW5lQ2hhbmdlZCAmJiBjbS5vcHRpb25zLmxpbmVXcmFwcGluZztcbiAgICBvcC51cGRhdGUgPSBvcC5tdXN0VXBkYXRlICYmXG4gICAgICBuZXcgRGlzcGxheVVwZGF0ZShjbSwgb3AubXVzdFVwZGF0ZSAmJiB7dG9wOiBvcC5zY3JvbGxUb3AsIGVuc3VyZTogb3Auc2Nyb2xsVG9Qb3N9LCBvcC5mb3JjZVVwZGF0ZSk7XG4gIH1cblxuICBmdW5jdGlvbiBlbmRPcGVyYXRpb25fVzEob3ApIHtcbiAgICBvcC51cGRhdGVkRGlzcGxheSA9IG9wLm11c3RVcGRhdGUgJiYgdXBkYXRlRGlzcGxheUlmTmVlZGVkKG9wLmNtLCBvcC51cGRhdGUpO1xuICB9XG5cbiAgZnVuY3Rpb24gZW5kT3BlcmF0aW9uX1IyKG9wKSB7XG4gICAgdmFyIGNtID0gb3AuY20sIGRpc3BsYXkgPSBjbS5kaXNwbGF5O1xuICAgIGlmIChvcC51cGRhdGVkRGlzcGxheSkgdXBkYXRlSGVpZ2h0c0luVmlld3BvcnQoY20pO1xuXG4gICAgb3AuYmFyTWVhc3VyZSA9IG1lYXN1cmVGb3JTY3JvbGxiYXJzKGNtKTtcblxuICAgIC8vIElmIHRoZSBtYXggbGluZSBjaGFuZ2VkIHNpbmNlIGl0IHdhcyBsYXN0IG1lYXN1cmVkLCBtZWFzdXJlIGl0LFxuICAgIC8vIGFuZCBlbnN1cmUgdGhlIGRvY3VtZW50J3Mgd2lkdGggbWF0Y2hlcyBpdC5cbiAgICAvLyB1cGRhdGVEaXNwbGF5X1cyIHdpbGwgdXNlIHRoZXNlIHByb3BlcnRpZXMgdG8gZG8gdGhlIGFjdHVhbCByZXNpemluZ1xuICAgIGlmIChkaXNwbGF5Lm1heExpbmVDaGFuZ2VkICYmICFjbS5vcHRpb25zLmxpbmVXcmFwcGluZykge1xuICAgICAgb3AuYWRqdXN0V2lkdGhUbyA9IG1lYXN1cmVDaGFyKGNtLCBkaXNwbGF5Lm1heExpbmUsIGRpc3BsYXkubWF4TGluZS50ZXh0Lmxlbmd0aCkubGVmdCArIDM7XG4gICAgICBjbS5kaXNwbGF5LnNpemVyV2lkdGggPSBvcC5hZGp1c3RXaWR0aFRvO1xuICAgICAgb3AuYmFyTWVhc3VyZS5zY3JvbGxXaWR0aCA9XG4gICAgICAgIE1hdGgubWF4KGRpc3BsYXkuc2Nyb2xsZXIuY2xpZW50V2lkdGgsIGRpc3BsYXkuc2l6ZXIub2Zmc2V0TGVmdCArIG9wLmFkanVzdFdpZHRoVG8gKyBzY3JvbGxHYXAoY20pICsgY20uZGlzcGxheS5iYXJXaWR0aCk7XG4gICAgICBvcC5tYXhTY3JvbGxMZWZ0ID0gTWF0aC5tYXgoMCwgZGlzcGxheS5zaXplci5vZmZzZXRMZWZ0ICsgb3AuYWRqdXN0V2lkdGhUbyAtIGRpc3BsYXlXaWR0aChjbSkpO1xuICAgIH1cblxuICAgIGlmIChvcC51cGRhdGVkRGlzcGxheSB8fCBvcC5zZWxlY3Rpb25DaGFuZ2VkKVxuICAgICAgb3AucHJlcGFyZWRTZWxlY3Rpb24gPSBkaXNwbGF5LmlucHV0LnByZXBhcmVTZWxlY3Rpb24oKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGVuZE9wZXJhdGlvbl9XMihvcCkge1xuICAgIHZhciBjbSA9IG9wLmNtO1xuXG4gICAgaWYgKG9wLmFkanVzdFdpZHRoVG8gIT0gbnVsbCkge1xuICAgICAgY20uZGlzcGxheS5zaXplci5zdHlsZS5taW5XaWR0aCA9IG9wLmFkanVzdFdpZHRoVG8gKyBcInB4XCI7XG4gICAgICBpZiAob3AubWF4U2Nyb2xsTGVmdCA8IGNtLmRvYy5zY3JvbGxMZWZ0KVxuICAgICAgICBzZXRTY3JvbGxMZWZ0KGNtLCBNYXRoLm1pbihjbS5kaXNwbGF5LnNjcm9sbGVyLnNjcm9sbExlZnQsIG9wLm1heFNjcm9sbExlZnQpLCB0cnVlKTtcbiAgICAgIGNtLmRpc3BsYXkubWF4TGluZUNoYW5nZWQgPSBmYWxzZTtcbiAgICB9XG5cbiAgICBpZiAob3AucHJlcGFyZWRTZWxlY3Rpb24pXG4gICAgICBjbS5kaXNwbGF5LmlucHV0LnNob3dTZWxlY3Rpb24ob3AucHJlcGFyZWRTZWxlY3Rpb24pO1xuICAgIGlmIChvcC51cGRhdGVkRGlzcGxheSlcbiAgICAgIHNldERvY3VtZW50SGVpZ2h0KGNtLCBvcC5iYXJNZWFzdXJlKTtcbiAgICBpZiAob3AudXBkYXRlZERpc3BsYXkgfHwgb3Auc3RhcnRIZWlnaHQgIT0gY20uZG9jLmhlaWdodClcbiAgICAgIHVwZGF0ZVNjcm9sbGJhcnMoY20sIG9wLmJhck1lYXN1cmUpO1xuXG4gICAgaWYgKG9wLnNlbGVjdGlvbkNoYW5nZWQpIHJlc3RhcnRCbGluayhjbSk7XG5cbiAgICBpZiAoY20uc3RhdGUuZm9jdXNlZCAmJiBvcC51cGRhdGVJbnB1dClcbiAgICAgIGNtLmRpc3BsYXkuaW5wdXQucmVzZXQob3AudHlwaW5nKTtcbiAgICBpZiAob3AuZm9jdXMgJiYgb3AuZm9jdXMgPT0gYWN0aXZlRWx0KCkgJiYgKCFkb2N1bWVudC5oYXNGb2N1cyB8fCBkb2N1bWVudC5oYXNGb2N1cygpKSlcbiAgICAgIGVuc3VyZUZvY3VzKG9wLmNtKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGVuZE9wZXJhdGlvbl9maW5pc2gob3ApIHtcbiAgICB2YXIgY20gPSBvcC5jbSwgZGlzcGxheSA9IGNtLmRpc3BsYXksIGRvYyA9IGNtLmRvYztcblxuICAgIGlmIChvcC51cGRhdGVkRGlzcGxheSkgcG9zdFVwZGF0ZURpc3BsYXkoY20sIG9wLnVwZGF0ZSk7XG5cbiAgICAvLyBBYm9ydCBtb3VzZSB3aGVlbCBkZWx0YSBtZWFzdXJlbWVudCwgd2hlbiBzY3JvbGxpbmcgZXhwbGljaXRseVxuICAgIGlmIChkaXNwbGF5LndoZWVsU3RhcnRYICE9IG51bGwgJiYgKG9wLnNjcm9sbFRvcCAhPSBudWxsIHx8IG9wLnNjcm9sbExlZnQgIT0gbnVsbCB8fCBvcC5zY3JvbGxUb1BvcykpXG4gICAgICBkaXNwbGF5LndoZWVsU3RhcnRYID0gZGlzcGxheS53aGVlbFN0YXJ0WSA9IG51bGw7XG5cbiAgICAvLyBQcm9wYWdhdGUgdGhlIHNjcm9sbCBwb3NpdGlvbiB0byB0aGUgYWN0dWFsIERPTSBzY3JvbGxlclxuICAgIGlmIChvcC5zY3JvbGxUb3AgIT0gbnVsbCAmJiAoZGlzcGxheS5zY3JvbGxlci5zY3JvbGxUb3AgIT0gb3Auc2Nyb2xsVG9wIHx8IG9wLmZvcmNlU2Nyb2xsKSkge1xuICAgICAgZG9jLnNjcm9sbFRvcCA9IE1hdGgubWF4KDAsIE1hdGgubWluKGRpc3BsYXkuc2Nyb2xsZXIuc2Nyb2xsSGVpZ2h0IC0gZGlzcGxheS5zY3JvbGxlci5jbGllbnRIZWlnaHQsIG9wLnNjcm9sbFRvcCkpO1xuICAgICAgZGlzcGxheS5zY3JvbGxiYXJzLnNldFNjcm9sbFRvcChkb2Muc2Nyb2xsVG9wKTtcbiAgICAgIGRpc3BsYXkuc2Nyb2xsZXIuc2Nyb2xsVG9wID0gZG9jLnNjcm9sbFRvcDtcbiAgICB9XG4gICAgaWYgKG9wLnNjcm9sbExlZnQgIT0gbnVsbCAmJiAoZGlzcGxheS5zY3JvbGxlci5zY3JvbGxMZWZ0ICE9IG9wLnNjcm9sbExlZnQgfHwgb3AuZm9yY2VTY3JvbGwpKSB7XG4gICAgICBkb2Muc2Nyb2xsTGVmdCA9IE1hdGgubWF4KDAsIE1hdGgubWluKGRpc3BsYXkuc2Nyb2xsZXIuc2Nyb2xsV2lkdGggLSBkaXNwbGF5V2lkdGgoY20pLCBvcC5zY3JvbGxMZWZ0KSk7XG4gICAgICBkaXNwbGF5LnNjcm9sbGJhcnMuc2V0U2Nyb2xsTGVmdChkb2Muc2Nyb2xsTGVmdCk7XG4gICAgICBkaXNwbGF5LnNjcm9sbGVyLnNjcm9sbExlZnQgPSBkb2Muc2Nyb2xsTGVmdDtcbiAgICAgIGFsaWduSG9yaXpvbnRhbGx5KGNtKTtcbiAgICB9XG4gICAgLy8gSWYgd2UgbmVlZCB0byBzY3JvbGwgYSBzcGVjaWZpYyBwb3NpdGlvbiBpbnRvIHZpZXcsIGRvIHNvLlxuICAgIGlmIChvcC5zY3JvbGxUb1Bvcykge1xuICAgICAgdmFyIGNvb3JkcyA9IHNjcm9sbFBvc0ludG9WaWV3KGNtLCBjbGlwUG9zKGRvYywgb3Auc2Nyb2xsVG9Qb3MuZnJvbSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xpcFBvcyhkb2MsIG9wLnNjcm9sbFRvUG9zLnRvKSwgb3Auc2Nyb2xsVG9Qb3MubWFyZ2luKTtcbiAgICAgIGlmIChvcC5zY3JvbGxUb1Bvcy5pc0N1cnNvciAmJiBjbS5zdGF0ZS5mb2N1c2VkKSBtYXliZVNjcm9sbFdpbmRvdyhjbSwgY29vcmRzKTtcbiAgICB9XG5cbiAgICAvLyBGaXJlIGV2ZW50cyBmb3IgbWFya2VycyB0aGF0IGFyZSBoaWRkZW4vdW5pZGRlbiBieSBlZGl0aW5nIG9yXG4gICAgLy8gdW5kb2luZ1xuICAgIHZhciBoaWRkZW4gPSBvcC5tYXliZUhpZGRlbk1hcmtlcnMsIHVuaGlkZGVuID0gb3AubWF5YmVVbmhpZGRlbk1hcmtlcnM7XG4gICAgaWYgKGhpZGRlbikgZm9yICh2YXIgaSA9IDA7IGkgPCBoaWRkZW4ubGVuZ3RoOyArK2kpXG4gICAgICBpZiAoIWhpZGRlbltpXS5saW5lcy5sZW5ndGgpIHNpZ25hbChoaWRkZW5baV0sIFwiaGlkZVwiKTtcbiAgICBpZiAodW5oaWRkZW4pIGZvciAodmFyIGkgPSAwOyBpIDwgdW5oaWRkZW4ubGVuZ3RoOyArK2kpXG4gICAgICBpZiAodW5oaWRkZW5baV0ubGluZXMubGVuZ3RoKSBzaWduYWwodW5oaWRkZW5baV0sIFwidW5oaWRlXCIpO1xuXG4gICAgaWYgKGRpc3BsYXkud3JhcHBlci5vZmZzZXRIZWlnaHQpXG4gICAgICBkb2Muc2Nyb2xsVG9wID0gY20uZGlzcGxheS5zY3JvbGxlci5zY3JvbGxUb3A7XG5cbiAgICAvLyBGaXJlIGNoYW5nZSBldmVudHMsIGFuZCBkZWxheWVkIGV2ZW50IGhhbmRsZXJzXG4gICAgaWYgKG9wLmNoYW5nZU9ianMpXG4gICAgICBzaWduYWwoY20sIFwiY2hhbmdlc1wiLCBjbSwgb3AuY2hhbmdlT2Jqcyk7XG4gICAgaWYgKG9wLnVwZGF0ZSlcbiAgICAgIG9wLnVwZGF0ZS5maW5pc2goKTtcbiAgfVxuXG4gIC8vIFJ1biB0aGUgZ2l2ZW4gZnVuY3Rpb24gaW4gYW4gb3BlcmF0aW9uXG4gIGZ1bmN0aW9uIHJ1bkluT3AoY20sIGYpIHtcbiAgICBpZiAoY20uY3VyT3ApIHJldHVybiBmKCk7XG4gICAgc3RhcnRPcGVyYXRpb24oY20pO1xuICAgIHRyeSB7IHJldHVybiBmKCk7IH1cbiAgICBmaW5hbGx5IHsgZW5kT3BlcmF0aW9uKGNtKTsgfVxuICB9XG4gIC8vIFdyYXBzIGEgZnVuY3Rpb24gaW4gYW4gb3BlcmF0aW9uLiBSZXR1cm5zIHRoZSB3cmFwcGVkIGZ1bmN0aW9uLlxuICBmdW5jdGlvbiBvcGVyYXRpb24oY20sIGYpIHtcbiAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICBpZiAoY20uY3VyT3ApIHJldHVybiBmLmFwcGx5KGNtLCBhcmd1bWVudHMpO1xuICAgICAgc3RhcnRPcGVyYXRpb24oY20pO1xuICAgICAgdHJ5IHsgcmV0dXJuIGYuYXBwbHkoY20sIGFyZ3VtZW50cyk7IH1cbiAgICAgIGZpbmFsbHkgeyBlbmRPcGVyYXRpb24oY20pOyB9XG4gICAgfTtcbiAgfVxuICAvLyBVc2VkIHRvIGFkZCBtZXRob2RzIHRvIGVkaXRvciBhbmQgZG9jIGluc3RhbmNlcywgd3JhcHBpbmcgdGhlbSBpblxuICAvLyBvcGVyYXRpb25zLlxuICBmdW5jdGlvbiBtZXRob2RPcChmKSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgaWYgKHRoaXMuY3VyT3ApIHJldHVybiBmLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICBzdGFydE9wZXJhdGlvbih0aGlzKTtcbiAgICAgIHRyeSB7IHJldHVybiBmLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7IH1cbiAgICAgIGZpbmFsbHkgeyBlbmRPcGVyYXRpb24odGhpcyk7IH1cbiAgICB9O1xuICB9XG4gIGZ1bmN0aW9uIGRvY01ldGhvZE9wKGYpIHtcbiAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgY20gPSB0aGlzLmNtO1xuICAgICAgaWYgKCFjbSB8fCBjbS5jdXJPcCkgcmV0dXJuIGYuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgIHN0YXJ0T3BlcmF0aW9uKGNtKTtcbiAgICAgIHRyeSB7IHJldHVybiBmLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7IH1cbiAgICAgIGZpbmFsbHkgeyBlbmRPcGVyYXRpb24oY20pOyB9XG4gICAgfTtcbiAgfVxuXG4gIC8vIFZJRVcgVFJBQ0tJTkdcblxuICAvLyBUaGVzZSBvYmplY3RzIGFyZSB1c2VkIHRvIHJlcHJlc2VudCB0aGUgdmlzaWJsZSAoY3VycmVudGx5IGRyYXduKVxuICAvLyBwYXJ0IG9mIHRoZSBkb2N1bWVudC4gQSBMaW5lVmlldyBtYXkgY29ycmVzcG9uZCB0byBtdWx0aXBsZVxuICAvLyBsb2dpY2FsIGxpbmVzLCBpZiB0aG9zZSBhcmUgY29ubmVjdGVkIGJ5IGNvbGxhcHNlZCByYW5nZXMuXG4gIGZ1bmN0aW9uIExpbmVWaWV3KGRvYywgbGluZSwgbGluZU4pIHtcbiAgICAvLyBUaGUgc3RhcnRpbmcgbGluZVxuICAgIHRoaXMubGluZSA9IGxpbmU7XG4gICAgLy8gQ29udGludWluZyBsaW5lcywgaWYgYW55XG4gICAgdGhpcy5yZXN0ID0gdmlzdWFsTGluZUNvbnRpbnVlZChsaW5lKTtcbiAgICAvLyBOdW1iZXIgb2YgbG9naWNhbCBsaW5lcyBpbiB0aGlzIHZpc3VhbCBsaW5lXG4gICAgdGhpcy5zaXplID0gdGhpcy5yZXN0ID8gbGluZU5vKGxzdCh0aGlzLnJlc3QpKSAtIGxpbmVOICsgMSA6IDE7XG4gICAgdGhpcy5ub2RlID0gdGhpcy50ZXh0ID0gbnVsbDtcbiAgICB0aGlzLmhpZGRlbiA9IGxpbmVJc0hpZGRlbihkb2MsIGxpbmUpO1xuICB9XG5cbiAgLy8gQ3JlYXRlIGEgcmFuZ2Ugb2YgTGluZVZpZXcgb2JqZWN0cyBmb3IgdGhlIGdpdmVuIGxpbmVzLlxuICBmdW5jdGlvbiBidWlsZFZpZXdBcnJheShjbSwgZnJvbSwgdG8pIHtcbiAgICB2YXIgYXJyYXkgPSBbXSwgbmV4dFBvcztcbiAgICBmb3IgKHZhciBwb3MgPSBmcm9tOyBwb3MgPCB0bzsgcG9zID0gbmV4dFBvcykge1xuICAgICAgdmFyIHZpZXcgPSBuZXcgTGluZVZpZXcoY20uZG9jLCBnZXRMaW5lKGNtLmRvYywgcG9zKSwgcG9zKTtcbiAgICAgIG5leHRQb3MgPSBwb3MgKyB2aWV3LnNpemU7XG4gICAgICBhcnJheS5wdXNoKHZpZXcpO1xuICAgIH1cbiAgICByZXR1cm4gYXJyYXk7XG4gIH1cblxuICAvLyBVcGRhdGVzIHRoZSBkaXNwbGF5LnZpZXcgZGF0YSBzdHJ1Y3R1cmUgZm9yIGEgZ2l2ZW4gY2hhbmdlIHRvIHRoZVxuICAvLyBkb2N1bWVudC4gRnJvbSBhbmQgdG8gYXJlIGluIHByZS1jaGFuZ2UgY29vcmRpbmF0ZXMuIExlbmRpZmYgaXNcbiAgLy8gdGhlIGFtb3VudCBvZiBsaW5lcyBhZGRlZCBvciBzdWJ0cmFjdGVkIGJ5IHRoZSBjaGFuZ2UuIFRoaXMgaXNcbiAgLy8gdXNlZCBmb3IgY2hhbmdlcyB0aGF0IHNwYW4gbXVsdGlwbGUgbGluZXMsIG9yIGNoYW5nZSB0aGUgd2F5XG4gIC8vIGxpbmVzIGFyZSBkaXZpZGVkIGludG8gdmlzdWFsIGxpbmVzLiByZWdMaW5lQ2hhbmdlIChiZWxvdylcbiAgLy8gcmVnaXN0ZXJzIHNpbmdsZS1saW5lIGNoYW5nZXMuXG4gIGZ1bmN0aW9uIHJlZ0NoYW5nZShjbSwgZnJvbSwgdG8sIGxlbmRpZmYpIHtcbiAgICBpZiAoZnJvbSA9PSBudWxsKSBmcm9tID0gY20uZG9jLmZpcnN0O1xuICAgIGlmICh0byA9PSBudWxsKSB0byA9IGNtLmRvYy5maXJzdCArIGNtLmRvYy5zaXplO1xuICAgIGlmICghbGVuZGlmZikgbGVuZGlmZiA9IDA7XG5cbiAgICB2YXIgZGlzcGxheSA9IGNtLmRpc3BsYXk7XG4gICAgaWYgKGxlbmRpZmYgJiYgdG8gPCBkaXNwbGF5LnZpZXdUbyAmJlxuICAgICAgICAoZGlzcGxheS51cGRhdGVMaW5lTnVtYmVycyA9PSBudWxsIHx8IGRpc3BsYXkudXBkYXRlTGluZU51bWJlcnMgPiBmcm9tKSlcbiAgICAgIGRpc3BsYXkudXBkYXRlTGluZU51bWJlcnMgPSBmcm9tO1xuXG4gICAgY20uY3VyT3Audmlld0NoYW5nZWQgPSB0cnVlO1xuXG4gICAgaWYgKGZyb20gPj0gZGlzcGxheS52aWV3VG8pIHsgLy8gQ2hhbmdlIGFmdGVyXG4gICAgICBpZiAoc2F3Q29sbGFwc2VkU3BhbnMgJiYgdmlzdWFsTGluZU5vKGNtLmRvYywgZnJvbSkgPCBkaXNwbGF5LnZpZXdUbylcbiAgICAgICAgcmVzZXRWaWV3KGNtKTtcbiAgICB9IGVsc2UgaWYgKHRvIDw9IGRpc3BsYXkudmlld0Zyb20pIHsgLy8gQ2hhbmdlIGJlZm9yZVxuICAgICAgaWYgKHNhd0NvbGxhcHNlZFNwYW5zICYmIHZpc3VhbExpbmVFbmRObyhjbS5kb2MsIHRvICsgbGVuZGlmZikgPiBkaXNwbGF5LnZpZXdGcm9tKSB7XG4gICAgICAgIHJlc2V0VmlldyhjbSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBkaXNwbGF5LnZpZXdGcm9tICs9IGxlbmRpZmY7XG4gICAgICAgIGRpc3BsYXkudmlld1RvICs9IGxlbmRpZmY7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChmcm9tIDw9IGRpc3BsYXkudmlld0Zyb20gJiYgdG8gPj0gZGlzcGxheS52aWV3VG8pIHsgLy8gRnVsbCBvdmVybGFwXG4gICAgICByZXNldFZpZXcoY20pO1xuICAgIH0gZWxzZSBpZiAoZnJvbSA8PSBkaXNwbGF5LnZpZXdGcm9tKSB7IC8vIFRvcCBvdmVybGFwXG4gICAgICB2YXIgY3V0ID0gdmlld0N1dHRpbmdQb2ludChjbSwgdG8sIHRvICsgbGVuZGlmZiwgMSk7XG4gICAgICBpZiAoY3V0KSB7XG4gICAgICAgIGRpc3BsYXkudmlldyA9IGRpc3BsYXkudmlldy5zbGljZShjdXQuaW5kZXgpO1xuICAgICAgICBkaXNwbGF5LnZpZXdGcm9tID0gY3V0LmxpbmVOO1xuICAgICAgICBkaXNwbGF5LnZpZXdUbyArPSBsZW5kaWZmO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmVzZXRWaWV3KGNtKTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKHRvID49IGRpc3BsYXkudmlld1RvKSB7IC8vIEJvdHRvbSBvdmVybGFwXG4gICAgICB2YXIgY3V0ID0gdmlld0N1dHRpbmdQb2ludChjbSwgZnJvbSwgZnJvbSwgLTEpO1xuICAgICAgaWYgKGN1dCkge1xuICAgICAgICBkaXNwbGF5LnZpZXcgPSBkaXNwbGF5LnZpZXcuc2xpY2UoMCwgY3V0LmluZGV4KTtcbiAgICAgICAgZGlzcGxheS52aWV3VG8gPSBjdXQubGluZU47XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXNldFZpZXcoY20pO1xuICAgICAgfVxuICAgIH0gZWxzZSB7IC8vIEdhcCBpbiB0aGUgbWlkZGxlXG4gICAgICB2YXIgY3V0VG9wID0gdmlld0N1dHRpbmdQb2ludChjbSwgZnJvbSwgZnJvbSwgLTEpO1xuICAgICAgdmFyIGN1dEJvdCA9IHZpZXdDdXR0aW5nUG9pbnQoY20sIHRvLCB0byArIGxlbmRpZmYsIDEpO1xuICAgICAgaWYgKGN1dFRvcCAmJiBjdXRCb3QpIHtcbiAgICAgICAgZGlzcGxheS52aWV3ID0gZGlzcGxheS52aWV3LnNsaWNlKDAsIGN1dFRvcC5pbmRleClcbiAgICAgICAgICAuY29uY2F0KGJ1aWxkVmlld0FycmF5KGNtLCBjdXRUb3AubGluZU4sIGN1dEJvdC5saW5lTikpXG4gICAgICAgICAgLmNvbmNhdChkaXNwbGF5LnZpZXcuc2xpY2UoY3V0Qm90LmluZGV4KSk7XG4gICAgICAgIGRpc3BsYXkudmlld1RvICs9IGxlbmRpZmY7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXNldFZpZXcoY20pO1xuICAgICAgfVxuICAgIH1cblxuICAgIHZhciBleHQgPSBkaXNwbGF5LmV4dGVybmFsTWVhc3VyZWQ7XG4gICAgaWYgKGV4dCkge1xuICAgICAgaWYgKHRvIDwgZXh0LmxpbmVOKVxuICAgICAgICBleHQubGluZU4gKz0gbGVuZGlmZjtcbiAgICAgIGVsc2UgaWYgKGZyb20gPCBleHQubGluZU4gKyBleHQuc2l6ZSlcbiAgICAgICAgZGlzcGxheS5leHRlcm5hbE1lYXN1cmVkID0gbnVsbDtcbiAgICB9XG4gIH1cblxuICAvLyBSZWdpc3RlciBhIGNoYW5nZSB0byBhIHNpbmdsZSBsaW5lLiBUeXBlIG11c3QgYmUgb25lIG9mIFwidGV4dFwiLFxuICAvLyBcImd1dHRlclwiLCBcImNsYXNzXCIsIFwid2lkZ2V0XCJcbiAgZnVuY3Rpb24gcmVnTGluZUNoYW5nZShjbSwgbGluZSwgdHlwZSkge1xuICAgIGNtLmN1ck9wLnZpZXdDaGFuZ2VkID0gdHJ1ZTtcbiAgICB2YXIgZGlzcGxheSA9IGNtLmRpc3BsYXksIGV4dCA9IGNtLmRpc3BsYXkuZXh0ZXJuYWxNZWFzdXJlZDtcbiAgICBpZiAoZXh0ICYmIGxpbmUgPj0gZXh0LmxpbmVOICYmIGxpbmUgPCBleHQubGluZU4gKyBleHQuc2l6ZSlcbiAgICAgIGRpc3BsYXkuZXh0ZXJuYWxNZWFzdXJlZCA9IG51bGw7XG5cbiAgICBpZiAobGluZSA8IGRpc3BsYXkudmlld0Zyb20gfHwgbGluZSA+PSBkaXNwbGF5LnZpZXdUbykgcmV0dXJuO1xuICAgIHZhciBsaW5lVmlldyA9IGRpc3BsYXkudmlld1tmaW5kVmlld0luZGV4KGNtLCBsaW5lKV07XG4gICAgaWYgKGxpbmVWaWV3Lm5vZGUgPT0gbnVsbCkgcmV0dXJuO1xuICAgIHZhciBhcnIgPSBsaW5lVmlldy5jaGFuZ2VzIHx8IChsaW5lVmlldy5jaGFuZ2VzID0gW10pO1xuICAgIGlmIChpbmRleE9mKGFyciwgdHlwZSkgPT0gLTEpIGFyci5wdXNoKHR5cGUpO1xuICB9XG5cbiAgLy8gQ2xlYXIgdGhlIHZpZXcuXG4gIGZ1bmN0aW9uIHJlc2V0VmlldyhjbSkge1xuICAgIGNtLmRpc3BsYXkudmlld0Zyb20gPSBjbS5kaXNwbGF5LnZpZXdUbyA9IGNtLmRvYy5maXJzdDtcbiAgICBjbS5kaXNwbGF5LnZpZXcgPSBbXTtcbiAgICBjbS5kaXNwbGF5LnZpZXdPZmZzZXQgPSAwO1xuICB9XG5cbiAgLy8gRmluZCB0aGUgdmlldyBlbGVtZW50IGNvcnJlc3BvbmRpbmcgdG8gYSBnaXZlbiBsaW5lLiBSZXR1cm4gbnVsbFxuICAvLyB3aGVuIHRoZSBsaW5lIGlzbid0IHZpc2libGUuXG4gIGZ1bmN0aW9uIGZpbmRWaWV3SW5kZXgoY20sIG4pIHtcbiAgICBpZiAobiA+PSBjbS5kaXNwbGF5LnZpZXdUbykgcmV0dXJuIG51bGw7XG4gICAgbiAtPSBjbS5kaXNwbGF5LnZpZXdGcm9tO1xuICAgIGlmIChuIDwgMCkgcmV0dXJuIG51bGw7XG4gICAgdmFyIHZpZXcgPSBjbS5kaXNwbGF5LnZpZXc7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCB2aWV3Lmxlbmd0aDsgaSsrKSB7XG4gICAgICBuIC09IHZpZXdbaV0uc2l6ZTtcbiAgICAgIGlmIChuIDwgMCkgcmV0dXJuIGk7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gdmlld0N1dHRpbmdQb2ludChjbSwgb2xkTiwgbmV3TiwgZGlyKSB7XG4gICAgdmFyIGluZGV4ID0gZmluZFZpZXdJbmRleChjbSwgb2xkTiksIGRpZmYsIHZpZXcgPSBjbS5kaXNwbGF5LnZpZXc7XG4gICAgaWYgKCFzYXdDb2xsYXBzZWRTcGFucyB8fCBuZXdOID09IGNtLmRvYy5maXJzdCArIGNtLmRvYy5zaXplKVxuICAgICAgcmV0dXJuIHtpbmRleDogaW5kZXgsIGxpbmVOOiBuZXdOfTtcbiAgICBmb3IgKHZhciBpID0gMCwgbiA9IGNtLmRpc3BsYXkudmlld0Zyb207IGkgPCBpbmRleDsgaSsrKVxuICAgICAgbiArPSB2aWV3W2ldLnNpemU7XG4gICAgaWYgKG4gIT0gb2xkTikge1xuICAgICAgaWYgKGRpciA+IDApIHtcbiAgICAgICAgaWYgKGluZGV4ID09IHZpZXcubGVuZ3RoIC0gMSkgcmV0dXJuIG51bGw7XG4gICAgICAgIGRpZmYgPSAobiArIHZpZXdbaW5kZXhdLnNpemUpIC0gb2xkTjtcbiAgICAgICAgaW5kZXgrKztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGRpZmYgPSBuIC0gb2xkTjtcbiAgICAgIH1cbiAgICAgIG9sZE4gKz0gZGlmZjsgbmV3TiArPSBkaWZmO1xuICAgIH1cbiAgICB3aGlsZSAodmlzdWFsTGluZU5vKGNtLmRvYywgbmV3TikgIT0gbmV3Tikge1xuICAgICAgaWYgKGluZGV4ID09IChkaXIgPCAwID8gMCA6IHZpZXcubGVuZ3RoIC0gMSkpIHJldHVybiBudWxsO1xuICAgICAgbmV3TiArPSBkaXIgKiB2aWV3W2luZGV4IC0gKGRpciA8IDAgPyAxIDogMCldLnNpemU7XG4gICAgICBpbmRleCArPSBkaXI7XG4gICAgfVxuICAgIHJldHVybiB7aW5kZXg6IGluZGV4LCBsaW5lTjogbmV3Tn07XG4gIH1cblxuICAvLyBGb3JjZSB0aGUgdmlldyB0byBjb3ZlciBhIGdpdmVuIHJhbmdlLCBhZGRpbmcgZW1wdHkgdmlldyBlbGVtZW50XG4gIC8vIG9yIGNsaXBwaW5nIG9mZiBleGlzdGluZyBvbmVzIGFzIG5lZWRlZC5cbiAgZnVuY3Rpb24gYWRqdXN0VmlldyhjbSwgZnJvbSwgdG8pIHtcbiAgICB2YXIgZGlzcGxheSA9IGNtLmRpc3BsYXksIHZpZXcgPSBkaXNwbGF5LnZpZXc7XG4gICAgaWYgKHZpZXcubGVuZ3RoID09IDAgfHwgZnJvbSA+PSBkaXNwbGF5LnZpZXdUbyB8fCB0byA8PSBkaXNwbGF5LnZpZXdGcm9tKSB7XG4gICAgICBkaXNwbGF5LnZpZXcgPSBidWlsZFZpZXdBcnJheShjbSwgZnJvbSwgdG8pO1xuICAgICAgZGlzcGxheS52aWV3RnJvbSA9IGZyb207XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChkaXNwbGF5LnZpZXdGcm9tID4gZnJvbSlcbiAgICAgICAgZGlzcGxheS52aWV3ID0gYnVpbGRWaWV3QXJyYXkoY20sIGZyb20sIGRpc3BsYXkudmlld0Zyb20pLmNvbmNhdChkaXNwbGF5LnZpZXcpO1xuICAgICAgZWxzZSBpZiAoZGlzcGxheS52aWV3RnJvbSA8IGZyb20pXG4gICAgICAgIGRpc3BsYXkudmlldyA9IGRpc3BsYXkudmlldy5zbGljZShmaW5kVmlld0luZGV4KGNtLCBmcm9tKSk7XG4gICAgICBkaXNwbGF5LnZpZXdGcm9tID0gZnJvbTtcbiAgICAgIGlmIChkaXNwbGF5LnZpZXdUbyA8IHRvKVxuICAgICAgICBkaXNwbGF5LnZpZXcgPSBkaXNwbGF5LnZpZXcuY29uY2F0KGJ1aWxkVmlld0FycmF5KGNtLCBkaXNwbGF5LnZpZXdUbywgdG8pKTtcbiAgICAgIGVsc2UgaWYgKGRpc3BsYXkudmlld1RvID4gdG8pXG4gICAgICAgIGRpc3BsYXkudmlldyA9IGRpc3BsYXkudmlldy5zbGljZSgwLCBmaW5kVmlld0luZGV4KGNtLCB0bykpO1xuICAgIH1cbiAgICBkaXNwbGF5LnZpZXdUbyA9IHRvO1xuICB9XG5cbiAgLy8gQ291bnQgdGhlIG51bWJlciBvZiBsaW5lcyBpbiB0aGUgdmlldyB3aG9zZSBET00gcmVwcmVzZW50YXRpb24gaXNcbiAgLy8gb3V0IG9mIGRhdGUgKG9yIG5vbmV4aXN0ZW50KS5cbiAgZnVuY3Rpb24gY291bnREaXJ0eVZpZXcoY20pIHtcbiAgICB2YXIgdmlldyA9IGNtLmRpc3BsYXkudmlldywgZGlydHkgPSAwO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdmlldy5sZW5ndGg7IGkrKykge1xuICAgICAgdmFyIGxpbmVWaWV3ID0gdmlld1tpXTtcbiAgICAgIGlmICghbGluZVZpZXcuaGlkZGVuICYmICghbGluZVZpZXcubm9kZSB8fCBsaW5lVmlldy5jaGFuZ2VzKSkgKytkaXJ0eTtcbiAgICB9XG4gICAgcmV0dXJuIGRpcnR5O1xuICB9XG5cbiAgLy8gRVZFTlQgSEFORExFUlNcblxuICAvLyBBdHRhY2ggdGhlIG5lY2Vzc2FyeSBldmVudCBoYW5kbGVycyB3aGVuIGluaXRpYWxpemluZyB0aGUgZWRpdG9yXG4gIGZ1bmN0aW9uIHJlZ2lzdGVyRXZlbnRIYW5kbGVycyhjbSkge1xuICAgIHZhciBkID0gY20uZGlzcGxheTtcbiAgICBvbihkLnNjcm9sbGVyLCBcIm1vdXNlZG93blwiLCBvcGVyYXRpb24oY20sIG9uTW91c2VEb3duKSk7XG4gICAgLy8gT2xkZXIgSUUncyB3aWxsIG5vdCBmaXJlIGEgc2Vjb25kIG1vdXNlZG93biBmb3IgYSBkb3VibGUgY2xpY2tcbiAgICBpZiAoaWUgJiYgaWVfdmVyc2lvbiA8IDExKVxuICAgICAgb24oZC5zY3JvbGxlciwgXCJkYmxjbGlja1wiLCBvcGVyYXRpb24oY20sIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgaWYgKHNpZ25hbERPTUV2ZW50KGNtLCBlKSkgcmV0dXJuO1xuICAgICAgICB2YXIgcG9zID0gcG9zRnJvbU1vdXNlKGNtLCBlKTtcbiAgICAgICAgaWYgKCFwb3MgfHwgY2xpY2tJbkd1dHRlcihjbSwgZSkgfHwgZXZlbnRJbldpZGdldChjbS5kaXNwbGF5LCBlKSkgcmV0dXJuO1xuICAgICAgICBlX3ByZXZlbnREZWZhdWx0KGUpO1xuICAgICAgICB2YXIgd29yZCA9IGNtLmZpbmRXb3JkQXQocG9zKTtcbiAgICAgICAgZXh0ZW5kU2VsZWN0aW9uKGNtLmRvYywgd29yZC5hbmNob3IsIHdvcmQuaGVhZCk7XG4gICAgICB9KSk7XG4gICAgZWxzZVxuICAgICAgb24oZC5zY3JvbGxlciwgXCJkYmxjbGlja1wiLCBmdW5jdGlvbihlKSB7IHNpZ25hbERPTUV2ZW50KGNtLCBlKSB8fCBlX3ByZXZlbnREZWZhdWx0KGUpOyB9KTtcbiAgICAvLyBTb21lIGJyb3dzZXJzIGZpcmUgY29udGV4dG1lbnUgKmFmdGVyKiBvcGVuaW5nIHRoZSBtZW51LCBhdFxuICAgIC8vIHdoaWNoIHBvaW50IHdlIGNhbid0IG1lc3Mgd2l0aCBpdCBhbnltb3JlLiBDb250ZXh0IG1lbnUgaXNcbiAgICAvLyBoYW5kbGVkIGluIG9uTW91c2VEb3duIGZvciB0aGVzZSBicm93c2Vycy5cbiAgICBpZiAoIWNhcHR1cmVSaWdodENsaWNrKSBvbihkLnNjcm9sbGVyLCBcImNvbnRleHRtZW51XCIsIGZ1bmN0aW9uKGUpIHtvbkNvbnRleHRNZW51KGNtLCBlKTt9KTtcblxuICAgIC8vIFVzZWQgdG8gc3VwcHJlc3MgbW91c2UgZXZlbnQgaGFuZGxpbmcgd2hlbiBhIHRvdWNoIGhhcHBlbnNcbiAgICB2YXIgdG91Y2hGaW5pc2hlZCwgcHJldlRvdWNoID0ge2VuZDogMH07XG4gICAgZnVuY3Rpb24gZmluaXNoVG91Y2goKSB7XG4gICAgICBpZiAoZC5hY3RpdmVUb3VjaCkge1xuICAgICAgICB0b3VjaEZpbmlzaGVkID0gc2V0VGltZW91dChmdW5jdGlvbigpIHtkLmFjdGl2ZVRvdWNoID0gbnVsbDt9LCAxMDAwKTtcbiAgICAgICAgcHJldlRvdWNoID0gZC5hY3RpdmVUb3VjaDtcbiAgICAgICAgcHJldlRvdWNoLmVuZCA9ICtuZXcgRGF0ZTtcbiAgICAgIH1cbiAgICB9O1xuICAgIGZ1bmN0aW9uIGlzTW91c2VMaWtlVG91Y2hFdmVudChlKSB7XG4gICAgICBpZiAoZS50b3VjaGVzLmxlbmd0aCAhPSAxKSByZXR1cm4gZmFsc2U7XG4gICAgICB2YXIgdG91Y2ggPSBlLnRvdWNoZXNbMF07XG4gICAgICByZXR1cm4gdG91Y2gucmFkaXVzWCA8PSAxICYmIHRvdWNoLnJhZGl1c1kgPD0gMTtcbiAgICB9XG4gICAgZnVuY3Rpb24gZmFyQXdheSh0b3VjaCwgb3RoZXIpIHtcbiAgICAgIGlmIChvdGhlci5sZWZ0ID09IG51bGwpIHJldHVybiB0cnVlO1xuICAgICAgdmFyIGR4ID0gb3RoZXIubGVmdCAtIHRvdWNoLmxlZnQsIGR5ID0gb3RoZXIudG9wIC0gdG91Y2gudG9wO1xuICAgICAgcmV0dXJuIGR4ICogZHggKyBkeSAqIGR5ID4gMjAgKiAyMDtcbiAgICB9XG4gICAgb24oZC5zY3JvbGxlciwgXCJ0b3VjaHN0YXJ0XCIsIGZ1bmN0aW9uKGUpIHtcbiAgICAgIGlmICghc2lnbmFsRE9NRXZlbnQoY20sIGUpICYmICFpc01vdXNlTGlrZVRvdWNoRXZlbnQoZSkpIHtcbiAgICAgICAgY2xlYXJUaW1lb3V0KHRvdWNoRmluaXNoZWQpO1xuICAgICAgICB2YXIgbm93ID0gK25ldyBEYXRlO1xuICAgICAgICBkLmFjdGl2ZVRvdWNoID0ge3N0YXJ0OiBub3csIG1vdmVkOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICBwcmV2OiBub3cgLSBwcmV2VG91Y2guZW5kIDw9IDMwMCA/IHByZXZUb3VjaCA6IG51bGx9O1xuICAgICAgICBpZiAoZS50b3VjaGVzLmxlbmd0aCA9PSAxKSB7XG4gICAgICAgICAgZC5hY3RpdmVUb3VjaC5sZWZ0ID0gZS50b3VjaGVzWzBdLnBhZ2VYO1xuICAgICAgICAgIGQuYWN0aXZlVG91Y2gudG9wID0gZS50b3VjaGVzWzBdLnBhZ2VZO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gICAgb24oZC5zY3JvbGxlciwgXCJ0b3VjaG1vdmVcIiwgZnVuY3Rpb24oKSB7XG4gICAgICBpZiAoZC5hY3RpdmVUb3VjaCkgZC5hY3RpdmVUb3VjaC5tb3ZlZCA9IHRydWU7XG4gICAgfSk7XG4gICAgb24oZC5zY3JvbGxlciwgXCJ0b3VjaGVuZFwiLCBmdW5jdGlvbihlKSB7XG4gICAgICB2YXIgdG91Y2ggPSBkLmFjdGl2ZVRvdWNoO1xuICAgICAgaWYgKHRvdWNoICYmICFldmVudEluV2lkZ2V0KGQsIGUpICYmIHRvdWNoLmxlZnQgIT0gbnVsbCAmJlxuICAgICAgICAgICF0b3VjaC5tb3ZlZCAmJiBuZXcgRGF0ZSAtIHRvdWNoLnN0YXJ0IDwgMzAwKSB7XG4gICAgICAgIHZhciBwb3MgPSBjbS5jb29yZHNDaGFyKGQuYWN0aXZlVG91Y2gsIFwicGFnZVwiKSwgcmFuZ2U7XG4gICAgICAgIGlmICghdG91Y2gucHJldiB8fCBmYXJBd2F5KHRvdWNoLCB0b3VjaC5wcmV2KSkgLy8gU2luZ2xlIHRhcFxuICAgICAgICAgIHJhbmdlID0gbmV3IFJhbmdlKHBvcywgcG9zKTtcbiAgICAgICAgZWxzZSBpZiAoIXRvdWNoLnByZXYucHJldiB8fCBmYXJBd2F5KHRvdWNoLCB0b3VjaC5wcmV2LnByZXYpKSAvLyBEb3VibGUgdGFwXG4gICAgICAgICAgcmFuZ2UgPSBjbS5maW5kV29yZEF0KHBvcyk7XG4gICAgICAgIGVsc2UgLy8gVHJpcGxlIHRhcFxuICAgICAgICAgIHJhbmdlID0gbmV3IFJhbmdlKFBvcyhwb3MubGluZSwgMCksIGNsaXBQb3MoY20uZG9jLCBQb3MocG9zLmxpbmUgKyAxLCAwKSkpO1xuICAgICAgICBjbS5zZXRTZWxlY3Rpb24ocmFuZ2UuYW5jaG9yLCByYW5nZS5oZWFkKTtcbiAgICAgICAgY20uZm9jdXMoKTtcbiAgICAgICAgZV9wcmV2ZW50RGVmYXVsdChlKTtcbiAgICAgIH1cbiAgICAgIGZpbmlzaFRvdWNoKCk7XG4gICAgfSk7XG4gICAgb24oZC5zY3JvbGxlciwgXCJ0b3VjaGNhbmNlbFwiLCBmaW5pc2hUb3VjaCk7XG5cbiAgICAvLyBTeW5jIHNjcm9sbGluZyBiZXR3ZWVuIGZha2Ugc2Nyb2xsYmFycyBhbmQgcmVhbCBzY3JvbGxhYmxlXG4gICAgLy8gYXJlYSwgZW5zdXJlIHZpZXdwb3J0IGlzIHVwZGF0ZWQgd2hlbiBzY3JvbGxpbmcuXG4gICAgb24oZC5zY3JvbGxlciwgXCJzY3JvbGxcIiwgZnVuY3Rpb24oKSB7XG4gICAgICBpZiAoZC5zY3JvbGxlci5jbGllbnRIZWlnaHQpIHtcbiAgICAgICAgc2V0U2Nyb2xsVG9wKGNtLCBkLnNjcm9sbGVyLnNjcm9sbFRvcCk7XG4gICAgICAgIHNldFNjcm9sbExlZnQoY20sIGQuc2Nyb2xsZXIuc2Nyb2xsTGVmdCwgdHJ1ZSk7XG4gICAgICAgIHNpZ25hbChjbSwgXCJzY3JvbGxcIiwgY20pO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gTGlzdGVuIHRvIHdoZWVsIGV2ZW50cyBpbiBvcmRlciB0byB0cnkgYW5kIHVwZGF0ZSB0aGUgdmlld3BvcnQgb24gdGltZS5cbiAgICBvbihkLnNjcm9sbGVyLCBcIm1vdXNld2hlZWxcIiwgZnVuY3Rpb24oZSl7b25TY3JvbGxXaGVlbChjbSwgZSk7fSk7XG4gICAgb24oZC5zY3JvbGxlciwgXCJET01Nb3VzZVNjcm9sbFwiLCBmdW5jdGlvbihlKXtvblNjcm9sbFdoZWVsKGNtLCBlKTt9KTtcblxuICAgIC8vIFByZXZlbnQgd3JhcHBlciBmcm9tIGV2ZXIgc2Nyb2xsaW5nXG4gICAgb24oZC53cmFwcGVyLCBcInNjcm9sbFwiLCBmdW5jdGlvbigpIHsgZC53cmFwcGVyLnNjcm9sbFRvcCA9IGQud3JhcHBlci5zY3JvbGxMZWZ0ID0gMDsgfSk7XG5cbiAgICBkLmRyYWdGdW5jdGlvbnMgPSB7XG4gICAgICBlbnRlcjogZnVuY3Rpb24oZSkge2lmICghc2lnbmFsRE9NRXZlbnQoY20sIGUpKSBlX3N0b3AoZSk7fSxcbiAgICAgIG92ZXI6IGZ1bmN0aW9uKGUpIHtpZiAoIXNpZ25hbERPTUV2ZW50KGNtLCBlKSkgeyBvbkRyYWdPdmVyKGNtLCBlKTsgZV9zdG9wKGUpOyB9fSxcbiAgICAgIHN0YXJ0OiBmdW5jdGlvbihlKXtvbkRyYWdTdGFydChjbSwgZSk7fSxcbiAgICAgIGRyb3A6IG9wZXJhdGlvbihjbSwgb25Ecm9wKSxcbiAgICAgIGxlYXZlOiBmdW5jdGlvbigpIHtjbGVhckRyYWdDdXJzb3IoY20pO31cbiAgICB9O1xuXG4gICAgdmFyIGlucCA9IGQuaW5wdXQuZ2V0RmllbGQoKTtcbiAgICBvbihpbnAsIFwia2V5dXBcIiwgZnVuY3Rpb24oZSkgeyBvbktleVVwLmNhbGwoY20sIGUpOyB9KTtcbiAgICBvbihpbnAsIFwia2V5ZG93blwiLCBvcGVyYXRpb24oY20sIG9uS2V5RG93bikpO1xuICAgIG9uKGlucCwgXCJrZXlwcmVzc1wiLCBvcGVyYXRpb24oY20sIG9uS2V5UHJlc3MpKTtcbiAgICBvbihpbnAsIFwiZm9jdXNcIiwgYmluZChvbkZvY3VzLCBjbSkpO1xuICAgIG9uKGlucCwgXCJibHVyXCIsIGJpbmQob25CbHVyLCBjbSkpO1xuICB9XG5cbiAgZnVuY3Rpb24gZHJhZ0Ryb3BDaGFuZ2VkKGNtLCB2YWx1ZSwgb2xkKSB7XG4gICAgdmFyIHdhc09uID0gb2xkICYmIG9sZCAhPSBDb2RlTWlycm9yLkluaXQ7XG4gICAgaWYgKCF2YWx1ZSAhPSAhd2FzT24pIHtcbiAgICAgIHZhciBmdW5jcyA9IGNtLmRpc3BsYXkuZHJhZ0Z1bmN0aW9ucztcbiAgICAgIHZhciB0b2dnbGUgPSB2YWx1ZSA/IG9uIDogb2ZmO1xuICAgICAgdG9nZ2xlKGNtLmRpc3BsYXkuc2Nyb2xsZXIsIFwiZHJhZ3N0YXJ0XCIsIGZ1bmNzLnN0YXJ0KTtcbiAgICAgIHRvZ2dsZShjbS5kaXNwbGF5LnNjcm9sbGVyLCBcImRyYWdlbnRlclwiLCBmdW5jcy5lbnRlcik7XG4gICAgICB0b2dnbGUoY20uZGlzcGxheS5zY3JvbGxlciwgXCJkcmFnb3ZlclwiLCBmdW5jcy5vdmVyKTtcbiAgICAgIHRvZ2dsZShjbS5kaXNwbGF5LnNjcm9sbGVyLCBcImRyYWdsZWF2ZVwiLCBmdW5jcy5sZWF2ZSk7XG4gICAgICB0b2dnbGUoY20uZGlzcGxheS5zY3JvbGxlciwgXCJkcm9wXCIsIGZ1bmNzLmRyb3ApO1xuICAgIH1cbiAgfVxuXG4gIC8vIENhbGxlZCB3aGVuIHRoZSB3aW5kb3cgcmVzaXplc1xuICBmdW5jdGlvbiBvblJlc2l6ZShjbSkge1xuICAgIHZhciBkID0gY20uZGlzcGxheTtcbiAgICBpZiAoZC5sYXN0V3JhcEhlaWdodCA9PSBkLndyYXBwZXIuY2xpZW50SGVpZ2h0ICYmIGQubGFzdFdyYXBXaWR0aCA9PSBkLndyYXBwZXIuY2xpZW50V2lkdGgpXG4gICAgICByZXR1cm47XG4gICAgLy8gTWlnaHQgYmUgYSB0ZXh0IHNjYWxpbmcgb3BlcmF0aW9uLCBjbGVhciBzaXplIGNhY2hlcy5cbiAgICBkLmNhY2hlZENoYXJXaWR0aCA9IGQuY2FjaGVkVGV4dEhlaWdodCA9IGQuY2FjaGVkUGFkZGluZ0ggPSBudWxsO1xuICAgIGQuc2Nyb2xsYmFyc0NsaXBwZWQgPSBmYWxzZTtcbiAgICBjbS5zZXRTaXplKCk7XG4gIH1cblxuICAvLyBNT1VTRSBFVkVOVFNcblxuICAvLyBSZXR1cm4gdHJ1ZSB3aGVuIHRoZSBnaXZlbiBtb3VzZSBldmVudCBoYXBwZW5lZCBpbiBhIHdpZGdldFxuICBmdW5jdGlvbiBldmVudEluV2lkZ2V0KGRpc3BsYXksIGUpIHtcbiAgICBmb3IgKHZhciBuID0gZV90YXJnZXQoZSk7IG4gIT0gZGlzcGxheS53cmFwcGVyOyBuID0gbi5wYXJlbnROb2RlKSB7XG4gICAgICBpZiAoIW4gfHwgKG4ubm9kZVR5cGUgPT0gMSAmJiBuLmdldEF0dHJpYnV0ZShcImNtLWlnbm9yZS1ldmVudHNcIikgPT0gXCJ0cnVlXCIpIHx8XG4gICAgICAgICAgKG4ucGFyZW50Tm9kZSA9PSBkaXNwbGF5LnNpemVyICYmIG4gIT0gZGlzcGxheS5tb3ZlcikpXG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgfVxuXG4gIC8vIEdpdmVuIGEgbW91c2UgZXZlbnQsIGZpbmQgdGhlIGNvcnJlc3BvbmRpbmcgcG9zaXRpb24uIElmIGxpYmVyYWxcbiAgLy8gaXMgZmFsc2UsIGl0IGNoZWNrcyB3aGV0aGVyIGEgZ3V0dGVyIG9yIHNjcm9sbGJhciB3YXMgY2xpY2tlZCxcbiAgLy8gYW5kIHJldHVybnMgbnVsbCBpZiBpdCB3YXMuIGZvclJlY3QgaXMgdXNlZCBieSByZWN0YW5ndWxhclxuICAvLyBzZWxlY3Rpb25zLCBhbmQgdHJpZXMgdG8gZXN0aW1hdGUgYSBjaGFyYWN0ZXIgcG9zaXRpb24gZXZlbiBmb3JcbiAgLy8gY29vcmRpbmF0ZXMgYmV5b25kIHRoZSByaWdodCBvZiB0aGUgdGV4dC5cbiAgZnVuY3Rpb24gcG9zRnJvbU1vdXNlKGNtLCBlLCBsaWJlcmFsLCBmb3JSZWN0KSB7XG4gICAgdmFyIGRpc3BsYXkgPSBjbS5kaXNwbGF5O1xuICAgIGlmICghbGliZXJhbCAmJiBlX3RhcmdldChlKS5nZXRBdHRyaWJ1dGUoXCJjbS1ub3QtY29udGVudFwiKSA9PSBcInRydWVcIikgcmV0dXJuIG51bGw7XG5cbiAgICB2YXIgeCwgeSwgc3BhY2UgPSBkaXNwbGF5LmxpbmVTcGFjZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAvLyBGYWlscyB1bnByZWRpY3RhYmx5IG9uIElFWzY3XSB3aGVuIG1vdXNlIGlzIGRyYWdnZWQgYXJvdW5kIHF1aWNrbHkuXG4gICAgdHJ5IHsgeCA9IGUuY2xpZW50WCAtIHNwYWNlLmxlZnQ7IHkgPSBlLmNsaWVudFkgLSBzcGFjZS50b3A7IH1cbiAgICBjYXRjaCAoZSkgeyByZXR1cm4gbnVsbDsgfVxuICAgIHZhciBjb29yZHMgPSBjb29yZHNDaGFyKGNtLCB4LCB5KSwgbGluZTtcbiAgICBpZiAoZm9yUmVjdCAmJiBjb29yZHMueFJlbCA9PSAxICYmIChsaW5lID0gZ2V0TGluZShjbS5kb2MsIGNvb3Jkcy5saW5lKS50ZXh0KS5sZW5ndGggPT0gY29vcmRzLmNoKSB7XG4gICAgICB2YXIgY29sRGlmZiA9IGNvdW50Q29sdW1uKGxpbmUsIGxpbmUubGVuZ3RoLCBjbS5vcHRpb25zLnRhYlNpemUpIC0gbGluZS5sZW5ndGg7XG4gICAgICBjb29yZHMgPSBQb3MoY29vcmRzLmxpbmUsIE1hdGgubWF4KDAsIE1hdGgucm91bmQoKHggLSBwYWRkaW5nSChjbS5kaXNwbGF5KS5sZWZ0KSAvIGNoYXJXaWR0aChjbS5kaXNwbGF5KSkgLSBjb2xEaWZmKSk7XG4gICAgfVxuICAgIHJldHVybiBjb29yZHM7XG4gIH1cblxuICAvLyBBIG1vdXNlIGRvd24gY2FuIGJlIGEgc2luZ2xlIGNsaWNrLCBkb3VibGUgY2xpY2ssIHRyaXBsZSBjbGljayxcbiAgLy8gc3RhcnQgb2Ygc2VsZWN0aW9uIGRyYWcsIHN0YXJ0IG9mIHRleHQgZHJhZywgbmV3IGN1cnNvclxuICAvLyAoY3RybC1jbGljayksIHJlY3RhbmdsZSBkcmFnIChhbHQtZHJhZyksIG9yIHh3aW5cbiAgLy8gbWlkZGxlLWNsaWNrLXBhc3RlLiBPciBpdCBtaWdodCBiZSBhIGNsaWNrIG9uIHNvbWV0aGluZyB3ZSBzaG91bGRcbiAgLy8gbm90IGludGVyZmVyZSB3aXRoLCBzdWNoIGFzIGEgc2Nyb2xsYmFyIG9yIHdpZGdldC5cbiAgZnVuY3Rpb24gb25Nb3VzZURvd24oZSkge1xuICAgIHZhciBjbSA9IHRoaXMsIGRpc3BsYXkgPSBjbS5kaXNwbGF5O1xuICAgIGlmIChzaWduYWxET01FdmVudChjbSwgZSkgfHwgZGlzcGxheS5hY3RpdmVUb3VjaCAmJiBkaXNwbGF5LmlucHV0LnN1cHBvcnRzVG91Y2goKSkgcmV0dXJuO1xuICAgIGRpc3BsYXkuc2hpZnQgPSBlLnNoaWZ0S2V5O1xuXG4gICAgaWYgKGV2ZW50SW5XaWRnZXQoZGlzcGxheSwgZSkpIHtcbiAgICAgIGlmICghd2Via2l0KSB7XG4gICAgICAgIC8vIEJyaWVmbHkgdHVybiBvZmYgZHJhZ2dhYmlsaXR5LCB0byBhbGxvdyB3aWRnZXRzIHRvIGRvXG4gICAgICAgIC8vIG5vcm1hbCBkcmFnZ2luZyB0aGluZ3MuXG4gICAgICAgIGRpc3BsYXkuc2Nyb2xsZXIuZHJhZ2dhYmxlID0gZmFsc2U7XG4gICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtkaXNwbGF5LnNjcm9sbGVyLmRyYWdnYWJsZSA9IHRydWU7fSwgMTAwKTtcbiAgICAgIH1cbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKGNsaWNrSW5HdXR0ZXIoY20sIGUpKSByZXR1cm47XG4gICAgdmFyIHN0YXJ0ID0gcG9zRnJvbU1vdXNlKGNtLCBlKTtcbiAgICB3aW5kb3cuZm9jdXMoKTtcblxuICAgIHN3aXRjaCAoZV9idXR0b24oZSkpIHtcbiAgICBjYXNlIDE6XG4gICAgICAvLyAjMzI2MTogbWFrZSBzdXJlLCB0aGF0IHdlJ3JlIG5vdCBzdGFydGluZyBhIHNlY29uZCBzZWxlY3Rpb25cbiAgICAgIGlmIChjbS5zdGF0ZS5zZWxlY3RpbmdUZXh0KVxuICAgICAgICBjbS5zdGF0ZS5zZWxlY3RpbmdUZXh0KGUpO1xuICAgICAgZWxzZSBpZiAoc3RhcnQpXG4gICAgICAgIGxlZnRCdXR0b25Eb3duKGNtLCBlLCBzdGFydCk7XG4gICAgICBlbHNlIGlmIChlX3RhcmdldChlKSA9PSBkaXNwbGF5LnNjcm9sbGVyKVxuICAgICAgICBlX3ByZXZlbnREZWZhdWx0KGUpO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAyOlxuICAgICAgaWYgKHdlYmtpdCkgY20uc3RhdGUubGFzdE1pZGRsZURvd24gPSArbmV3IERhdGU7XG4gICAgICBpZiAoc3RhcnQpIGV4dGVuZFNlbGVjdGlvbihjbS5kb2MsIHN0YXJ0KTtcbiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7ZGlzcGxheS5pbnB1dC5mb2N1cygpO30sIDIwKTtcbiAgICAgIGVfcHJldmVudERlZmF1bHQoZSk7XG4gICAgICBicmVhaztcbiAgICBjYXNlIDM6XG4gICAgICBpZiAoY2FwdHVyZVJpZ2h0Q2xpY2spIG9uQ29udGV4dE1lbnUoY20sIGUpO1xuICAgICAgZWxzZSBkZWxheUJsdXJFdmVudChjbSk7XG4gICAgICBicmVhaztcbiAgICB9XG4gIH1cblxuICB2YXIgbGFzdENsaWNrLCBsYXN0RG91YmxlQ2xpY2s7XG4gIGZ1bmN0aW9uIGxlZnRCdXR0b25Eb3duKGNtLCBlLCBzdGFydCkge1xuICAgIGlmIChpZSkgc2V0VGltZW91dChiaW5kKGVuc3VyZUZvY3VzLCBjbSksIDApO1xuICAgIGVsc2UgY20uY3VyT3AuZm9jdXMgPSBhY3RpdmVFbHQoKTtcblxuICAgIHZhciBub3cgPSArbmV3IERhdGUsIHR5cGU7XG4gICAgaWYgKGxhc3REb3VibGVDbGljayAmJiBsYXN0RG91YmxlQ2xpY2sudGltZSA+IG5vdyAtIDQwMCAmJiBjbXAobGFzdERvdWJsZUNsaWNrLnBvcywgc3RhcnQpID09IDApIHtcbiAgICAgIHR5cGUgPSBcInRyaXBsZVwiO1xuICAgIH0gZWxzZSBpZiAobGFzdENsaWNrICYmIGxhc3RDbGljay50aW1lID4gbm93IC0gNDAwICYmIGNtcChsYXN0Q2xpY2sucG9zLCBzdGFydCkgPT0gMCkge1xuICAgICAgdHlwZSA9IFwiZG91YmxlXCI7XG4gICAgICBsYXN0RG91YmxlQ2xpY2sgPSB7dGltZTogbm93LCBwb3M6IHN0YXJ0fTtcbiAgICB9IGVsc2Uge1xuICAgICAgdHlwZSA9IFwic2luZ2xlXCI7XG4gICAgICBsYXN0Q2xpY2sgPSB7dGltZTogbm93LCBwb3M6IHN0YXJ0fTtcbiAgICB9XG5cbiAgICB2YXIgc2VsID0gY20uZG9jLnNlbCwgbW9kaWZpZXIgPSBtYWMgPyBlLm1ldGFLZXkgOiBlLmN0cmxLZXksIGNvbnRhaW5lZDtcbiAgICBpZiAoY20ub3B0aW9ucy5kcmFnRHJvcCAmJiBkcmFnQW5kRHJvcCAmJiAhY20uaXNSZWFkT25seSgpICYmXG4gICAgICAgIHR5cGUgPT0gXCJzaW5nbGVcIiAmJiAoY29udGFpbmVkID0gc2VsLmNvbnRhaW5zKHN0YXJ0KSkgPiAtMSAmJlxuICAgICAgICAoY21wKChjb250YWluZWQgPSBzZWwucmFuZ2VzW2NvbnRhaW5lZF0pLmZyb20oKSwgc3RhcnQpIDwgMCB8fCBzdGFydC54UmVsID4gMCkgJiZcbiAgICAgICAgKGNtcChjb250YWluZWQudG8oKSwgc3RhcnQpID4gMCB8fCBzdGFydC54UmVsIDwgMCkpXG4gICAgICBsZWZ0QnV0dG9uU3RhcnREcmFnKGNtLCBlLCBzdGFydCwgbW9kaWZpZXIpO1xuICAgIGVsc2VcbiAgICAgIGxlZnRCdXR0b25TZWxlY3QoY20sIGUsIHN0YXJ0LCB0eXBlLCBtb2RpZmllcik7XG4gIH1cblxuICAvLyBTdGFydCBhIHRleHQgZHJhZy4gV2hlbiBpdCBlbmRzLCBzZWUgaWYgYW55IGRyYWdnaW5nIGFjdHVhbGx5XG4gIC8vIGhhcHBlbiwgYW5kIHRyZWF0IGFzIGEgY2xpY2sgaWYgaXQgZGlkbid0LlxuICBmdW5jdGlvbiBsZWZ0QnV0dG9uU3RhcnREcmFnKGNtLCBlLCBzdGFydCwgbW9kaWZpZXIpIHtcbiAgICB2YXIgZGlzcGxheSA9IGNtLmRpc3BsYXksIHN0YXJ0VGltZSA9ICtuZXcgRGF0ZTtcbiAgICB2YXIgZHJhZ0VuZCA9IG9wZXJhdGlvbihjbSwgZnVuY3Rpb24oZTIpIHtcbiAgICAgIGlmICh3ZWJraXQpIGRpc3BsYXkuc2Nyb2xsZXIuZHJhZ2dhYmxlID0gZmFsc2U7XG4gICAgICBjbS5zdGF0ZS5kcmFnZ2luZ1RleHQgPSBmYWxzZTtcbiAgICAgIG9mZihkb2N1bWVudCwgXCJtb3VzZXVwXCIsIGRyYWdFbmQpO1xuICAgICAgb2ZmKGRpc3BsYXkuc2Nyb2xsZXIsIFwiZHJvcFwiLCBkcmFnRW5kKTtcbiAgICAgIGlmIChNYXRoLmFicyhlLmNsaWVudFggLSBlMi5jbGllbnRYKSArIE1hdGguYWJzKGUuY2xpZW50WSAtIGUyLmNsaWVudFkpIDwgMTApIHtcbiAgICAgICAgZV9wcmV2ZW50RGVmYXVsdChlMik7XG4gICAgICAgIGlmICghbW9kaWZpZXIgJiYgK25ldyBEYXRlIC0gMjAwIDwgc3RhcnRUaW1lKVxuICAgICAgICAgIGV4dGVuZFNlbGVjdGlvbihjbS5kb2MsIHN0YXJ0KTtcbiAgICAgICAgLy8gV29yayBhcm91bmQgdW5leHBsYWluYWJsZSBmb2N1cyBwcm9ibGVtIGluIElFOSAoIzIxMjcpIGFuZCBDaHJvbWUgKCMzMDgxKVxuICAgICAgICBpZiAod2Via2l0IHx8IGllICYmIGllX3ZlcnNpb24gPT0gOSlcbiAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge2RvY3VtZW50LmJvZHkuZm9jdXMoKTsgZGlzcGxheS5pbnB1dC5mb2N1cygpO30sIDIwKTtcbiAgICAgICAgZWxzZVxuICAgICAgICAgIGRpc3BsYXkuaW5wdXQuZm9jdXMoKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICAvLyBMZXQgdGhlIGRyYWcgaGFuZGxlciBoYW5kbGUgdGhpcy5cbiAgICBpZiAod2Via2l0KSBkaXNwbGF5LnNjcm9sbGVyLmRyYWdnYWJsZSA9IHRydWU7XG4gICAgY20uc3RhdGUuZHJhZ2dpbmdUZXh0ID0gZHJhZ0VuZDtcbiAgICAvLyBJRSdzIGFwcHJvYWNoIHRvIGRyYWdnYWJsZVxuICAgIGlmIChkaXNwbGF5LnNjcm9sbGVyLmRyYWdEcm9wKSBkaXNwbGF5LnNjcm9sbGVyLmRyYWdEcm9wKCk7XG4gICAgb24oZG9jdW1lbnQsIFwibW91c2V1cFwiLCBkcmFnRW5kKTtcbiAgICBvbihkaXNwbGF5LnNjcm9sbGVyLCBcImRyb3BcIiwgZHJhZ0VuZCk7XG4gIH1cblxuICAvLyBOb3JtYWwgc2VsZWN0aW9uLCBhcyBvcHBvc2VkIHRvIHRleHQgZHJhZ2dpbmcuXG4gIGZ1bmN0aW9uIGxlZnRCdXR0b25TZWxlY3QoY20sIGUsIHN0YXJ0LCB0eXBlLCBhZGROZXcpIHtcbiAgICB2YXIgZGlzcGxheSA9IGNtLmRpc3BsYXksIGRvYyA9IGNtLmRvYztcbiAgICBlX3ByZXZlbnREZWZhdWx0KGUpO1xuXG4gICAgdmFyIG91clJhbmdlLCBvdXJJbmRleCwgc3RhcnRTZWwgPSBkb2Muc2VsLCByYW5nZXMgPSBzdGFydFNlbC5yYW5nZXM7XG4gICAgaWYgKGFkZE5ldyAmJiAhZS5zaGlmdEtleSkge1xuICAgICAgb3VySW5kZXggPSBkb2Muc2VsLmNvbnRhaW5zKHN0YXJ0KTtcbiAgICAgIGlmIChvdXJJbmRleCA+IC0xKVxuICAgICAgICBvdXJSYW5nZSA9IHJhbmdlc1tvdXJJbmRleF07XG4gICAgICBlbHNlXG4gICAgICAgIG91clJhbmdlID0gbmV3IFJhbmdlKHN0YXJ0LCBzdGFydCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIG91clJhbmdlID0gZG9jLnNlbC5wcmltYXJ5KCk7XG4gICAgICBvdXJJbmRleCA9IGRvYy5zZWwucHJpbUluZGV4O1xuICAgIH1cblxuICAgIGlmIChlLmFsdEtleSkge1xuICAgICAgdHlwZSA9IFwicmVjdFwiO1xuICAgICAgaWYgKCFhZGROZXcpIG91clJhbmdlID0gbmV3IFJhbmdlKHN0YXJ0LCBzdGFydCk7XG4gICAgICBzdGFydCA9IHBvc0Zyb21Nb3VzZShjbSwgZSwgdHJ1ZSwgdHJ1ZSk7XG4gICAgICBvdXJJbmRleCA9IC0xO1xuICAgIH0gZWxzZSBpZiAodHlwZSA9PSBcImRvdWJsZVwiKSB7XG4gICAgICB2YXIgd29yZCA9IGNtLmZpbmRXb3JkQXQoc3RhcnQpO1xuICAgICAgaWYgKGNtLmRpc3BsYXkuc2hpZnQgfHwgZG9jLmV4dGVuZClcbiAgICAgICAgb3VyUmFuZ2UgPSBleHRlbmRSYW5nZShkb2MsIG91clJhbmdlLCB3b3JkLmFuY2hvciwgd29yZC5oZWFkKTtcbiAgICAgIGVsc2VcbiAgICAgICAgb3VyUmFuZ2UgPSB3b3JkO1xuICAgIH0gZWxzZSBpZiAodHlwZSA9PSBcInRyaXBsZVwiKSB7XG4gICAgICB2YXIgbGluZSA9IG5ldyBSYW5nZShQb3Moc3RhcnQubGluZSwgMCksIGNsaXBQb3MoZG9jLCBQb3Moc3RhcnQubGluZSArIDEsIDApKSk7XG4gICAgICBpZiAoY20uZGlzcGxheS5zaGlmdCB8fCBkb2MuZXh0ZW5kKVxuICAgICAgICBvdXJSYW5nZSA9IGV4dGVuZFJhbmdlKGRvYywgb3VyUmFuZ2UsIGxpbmUuYW5jaG9yLCBsaW5lLmhlYWQpO1xuICAgICAgZWxzZVxuICAgICAgICBvdXJSYW5nZSA9IGxpbmU7XG4gICAgfSBlbHNlIHtcbiAgICAgIG91clJhbmdlID0gZXh0ZW5kUmFuZ2UoZG9jLCBvdXJSYW5nZSwgc3RhcnQpO1xuICAgIH1cblxuICAgIGlmICghYWRkTmV3KSB7XG4gICAgICBvdXJJbmRleCA9IDA7XG4gICAgICBzZXRTZWxlY3Rpb24oZG9jLCBuZXcgU2VsZWN0aW9uKFtvdXJSYW5nZV0sIDApLCBzZWxfbW91c2UpO1xuICAgICAgc3RhcnRTZWwgPSBkb2Muc2VsO1xuICAgIH0gZWxzZSBpZiAob3VySW5kZXggPT0gLTEpIHtcbiAgICAgIG91ckluZGV4ID0gcmFuZ2VzLmxlbmd0aDtcbiAgICAgIHNldFNlbGVjdGlvbihkb2MsIG5vcm1hbGl6ZVNlbGVjdGlvbihyYW5nZXMuY29uY2F0KFtvdXJSYW5nZV0pLCBvdXJJbmRleCksXG4gICAgICAgICAgICAgICAgICAge3Njcm9sbDogZmFsc2UsIG9yaWdpbjogXCIqbW91c2VcIn0pO1xuICAgIH0gZWxzZSBpZiAocmFuZ2VzLmxlbmd0aCA+IDEgJiYgcmFuZ2VzW291ckluZGV4XS5lbXB0eSgpICYmIHR5cGUgPT0gXCJzaW5nbGVcIiAmJiAhZS5zaGlmdEtleSkge1xuICAgICAgc2V0U2VsZWN0aW9uKGRvYywgbm9ybWFsaXplU2VsZWN0aW9uKHJhbmdlcy5zbGljZSgwLCBvdXJJbmRleCkuY29uY2F0KHJhbmdlcy5zbGljZShvdXJJbmRleCArIDEpKSwgMCksXG4gICAgICAgICAgICAgICAgICAge3Njcm9sbDogZmFsc2UsIG9yaWdpbjogXCIqbW91c2VcIn0pO1xuICAgICAgc3RhcnRTZWwgPSBkb2Muc2VsO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXBsYWNlT25lU2VsZWN0aW9uKGRvYywgb3VySW5kZXgsIG91clJhbmdlLCBzZWxfbW91c2UpO1xuICAgIH1cblxuICAgIHZhciBsYXN0UG9zID0gc3RhcnQ7XG4gICAgZnVuY3Rpb24gZXh0ZW5kVG8ocG9zKSB7XG4gICAgICBpZiAoY21wKGxhc3RQb3MsIHBvcykgPT0gMCkgcmV0dXJuO1xuICAgICAgbGFzdFBvcyA9IHBvcztcblxuICAgICAgaWYgKHR5cGUgPT0gXCJyZWN0XCIpIHtcbiAgICAgICAgdmFyIHJhbmdlcyA9IFtdLCB0YWJTaXplID0gY20ub3B0aW9ucy50YWJTaXplO1xuICAgICAgICB2YXIgc3RhcnRDb2wgPSBjb3VudENvbHVtbihnZXRMaW5lKGRvYywgc3RhcnQubGluZSkudGV4dCwgc3RhcnQuY2gsIHRhYlNpemUpO1xuICAgICAgICB2YXIgcG9zQ29sID0gY291bnRDb2x1bW4oZ2V0TGluZShkb2MsIHBvcy5saW5lKS50ZXh0LCBwb3MuY2gsIHRhYlNpemUpO1xuICAgICAgICB2YXIgbGVmdCA9IE1hdGgubWluKHN0YXJ0Q29sLCBwb3NDb2wpLCByaWdodCA9IE1hdGgubWF4KHN0YXJ0Q29sLCBwb3NDb2wpO1xuICAgICAgICBmb3IgKHZhciBsaW5lID0gTWF0aC5taW4oc3RhcnQubGluZSwgcG9zLmxpbmUpLCBlbmQgPSBNYXRoLm1pbihjbS5sYXN0TGluZSgpLCBNYXRoLm1heChzdGFydC5saW5lLCBwb3MubGluZSkpO1xuICAgICAgICAgICAgIGxpbmUgPD0gZW5kOyBsaW5lKyspIHtcbiAgICAgICAgICB2YXIgdGV4dCA9IGdldExpbmUoZG9jLCBsaW5lKS50ZXh0LCBsZWZ0UG9zID0gZmluZENvbHVtbih0ZXh0LCBsZWZ0LCB0YWJTaXplKTtcbiAgICAgICAgICBpZiAobGVmdCA9PSByaWdodClcbiAgICAgICAgICAgIHJhbmdlcy5wdXNoKG5ldyBSYW5nZShQb3MobGluZSwgbGVmdFBvcyksIFBvcyhsaW5lLCBsZWZ0UG9zKSkpO1xuICAgICAgICAgIGVsc2UgaWYgKHRleHQubGVuZ3RoID4gbGVmdFBvcylcbiAgICAgICAgICAgIHJhbmdlcy5wdXNoKG5ldyBSYW5nZShQb3MobGluZSwgbGVmdFBvcyksIFBvcyhsaW5lLCBmaW5kQ29sdW1uKHRleHQsIHJpZ2h0LCB0YWJTaXplKSkpKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXJhbmdlcy5sZW5ndGgpIHJhbmdlcy5wdXNoKG5ldyBSYW5nZShzdGFydCwgc3RhcnQpKTtcbiAgICAgICAgc2V0U2VsZWN0aW9uKGRvYywgbm9ybWFsaXplU2VsZWN0aW9uKHN0YXJ0U2VsLnJhbmdlcy5zbGljZSgwLCBvdXJJbmRleCkuY29uY2F0KHJhbmdlcyksIG91ckluZGV4KSxcbiAgICAgICAgICAgICAgICAgICAgIHtvcmlnaW46IFwiKm1vdXNlXCIsIHNjcm9sbDogZmFsc2V9KTtcbiAgICAgICAgY20uc2Nyb2xsSW50b1ZpZXcocG9zKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciBvbGRSYW5nZSA9IG91clJhbmdlO1xuICAgICAgICB2YXIgYW5jaG9yID0gb2xkUmFuZ2UuYW5jaG9yLCBoZWFkID0gcG9zO1xuICAgICAgICBpZiAodHlwZSAhPSBcInNpbmdsZVwiKSB7XG4gICAgICAgICAgaWYgKHR5cGUgPT0gXCJkb3VibGVcIilcbiAgICAgICAgICAgIHZhciByYW5nZSA9IGNtLmZpbmRXb3JkQXQocG9zKTtcbiAgICAgICAgICBlbHNlXG4gICAgICAgICAgICB2YXIgcmFuZ2UgPSBuZXcgUmFuZ2UoUG9zKHBvcy5saW5lLCAwKSwgY2xpcFBvcyhkb2MsIFBvcyhwb3MubGluZSArIDEsIDApKSk7XG4gICAgICAgICAgaWYgKGNtcChyYW5nZS5hbmNob3IsIGFuY2hvcikgPiAwKSB7XG4gICAgICAgICAgICBoZWFkID0gcmFuZ2UuaGVhZDtcbiAgICAgICAgICAgIGFuY2hvciA9IG1pblBvcyhvbGRSYW5nZS5mcm9tKCksIHJhbmdlLmFuY2hvcik7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGhlYWQgPSByYW5nZS5hbmNob3I7XG4gICAgICAgICAgICBhbmNob3IgPSBtYXhQb3Mob2xkUmFuZ2UudG8oKSwgcmFuZ2UuaGVhZCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHZhciByYW5nZXMgPSBzdGFydFNlbC5yYW5nZXMuc2xpY2UoMCk7XG4gICAgICAgIHJhbmdlc1tvdXJJbmRleF0gPSBuZXcgUmFuZ2UoY2xpcFBvcyhkb2MsIGFuY2hvciksIGhlYWQpO1xuICAgICAgICBzZXRTZWxlY3Rpb24oZG9jLCBub3JtYWxpemVTZWxlY3Rpb24ocmFuZ2VzLCBvdXJJbmRleCksIHNlbF9tb3VzZSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgdmFyIGVkaXRvclNpemUgPSBkaXNwbGF5LndyYXBwZXIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgLy8gVXNlZCB0byBlbnN1cmUgdGltZW91dCByZS10cmllcyBkb24ndCBmaXJlIHdoZW4gYW5vdGhlciBleHRlbmRcbiAgICAvLyBoYXBwZW5lZCBpbiB0aGUgbWVhbnRpbWUgKGNsZWFyVGltZW91dCBpc24ndCByZWxpYWJsZSAtLSBhdFxuICAgIC8vIGxlYXN0IG9uIENocm9tZSwgdGhlIHRpbWVvdXRzIHN0aWxsIGhhcHBlbiBldmVuIHdoZW4gY2xlYXJlZCxcbiAgICAvLyBpZiB0aGUgY2xlYXIgaGFwcGVucyBhZnRlciB0aGVpciBzY2hlZHVsZWQgZmlyaW5nIHRpbWUpLlxuICAgIHZhciBjb3VudGVyID0gMDtcblxuICAgIGZ1bmN0aW9uIGV4dGVuZChlKSB7XG4gICAgICB2YXIgY3VyQ291bnQgPSArK2NvdW50ZXI7XG4gICAgICB2YXIgY3VyID0gcG9zRnJvbU1vdXNlKGNtLCBlLCB0cnVlLCB0eXBlID09IFwicmVjdFwiKTtcbiAgICAgIGlmICghY3VyKSByZXR1cm47XG4gICAgICBpZiAoY21wKGN1ciwgbGFzdFBvcykgIT0gMCkge1xuICAgICAgICBjbS5jdXJPcC5mb2N1cyA9IGFjdGl2ZUVsdCgpO1xuICAgICAgICBleHRlbmRUbyhjdXIpO1xuICAgICAgICB2YXIgdmlzaWJsZSA9IHZpc2libGVMaW5lcyhkaXNwbGF5LCBkb2MpO1xuICAgICAgICBpZiAoY3VyLmxpbmUgPj0gdmlzaWJsZS50byB8fCBjdXIubGluZSA8IHZpc2libGUuZnJvbSlcbiAgICAgICAgICBzZXRUaW1lb3V0KG9wZXJhdGlvbihjbSwgZnVuY3Rpb24oKXtpZiAoY291bnRlciA9PSBjdXJDb3VudCkgZXh0ZW5kKGUpO30pLCAxNTApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIG91dHNpZGUgPSBlLmNsaWVudFkgPCBlZGl0b3JTaXplLnRvcCA/IC0yMCA6IGUuY2xpZW50WSA+IGVkaXRvclNpemUuYm90dG9tID8gMjAgOiAwO1xuICAgICAgICBpZiAob3V0c2lkZSkgc2V0VGltZW91dChvcGVyYXRpb24oY20sIGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGlmIChjb3VudGVyICE9IGN1ckNvdW50KSByZXR1cm47XG4gICAgICAgICAgZGlzcGxheS5zY3JvbGxlci5zY3JvbGxUb3AgKz0gb3V0c2lkZTtcbiAgICAgICAgICBleHRlbmQoZSk7XG4gICAgICAgIH0pLCA1MCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZG9uZShlKSB7XG4gICAgICBjbS5zdGF0ZS5zZWxlY3RpbmdUZXh0ID0gZmFsc2U7XG4gICAgICBjb3VudGVyID0gSW5maW5pdHk7XG4gICAgICBlX3ByZXZlbnREZWZhdWx0KGUpO1xuICAgICAgZGlzcGxheS5pbnB1dC5mb2N1cygpO1xuICAgICAgb2ZmKGRvY3VtZW50LCBcIm1vdXNlbW92ZVwiLCBtb3ZlKTtcbiAgICAgIG9mZihkb2N1bWVudCwgXCJtb3VzZXVwXCIsIHVwKTtcbiAgICAgIGRvYy5oaXN0b3J5Lmxhc3RTZWxPcmlnaW4gPSBudWxsO1xuICAgIH1cblxuICAgIHZhciBtb3ZlID0gb3BlcmF0aW9uKGNtLCBmdW5jdGlvbihlKSB7XG4gICAgICBpZiAoIWVfYnV0dG9uKGUpKSBkb25lKGUpO1xuICAgICAgZWxzZSBleHRlbmQoZSk7XG4gICAgfSk7XG4gICAgdmFyIHVwID0gb3BlcmF0aW9uKGNtLCBkb25lKTtcbiAgICBjbS5zdGF0ZS5zZWxlY3RpbmdUZXh0ID0gdXA7XG4gICAgb24oZG9jdW1lbnQsIFwibW91c2Vtb3ZlXCIsIG1vdmUpO1xuICAgIG9uKGRvY3VtZW50LCBcIm1vdXNldXBcIiwgdXApO1xuICB9XG5cbiAgLy8gRGV0ZXJtaW5lcyB3aGV0aGVyIGFuIGV2ZW50IGhhcHBlbmVkIGluIHRoZSBndXR0ZXIsIGFuZCBmaXJlcyB0aGVcbiAgLy8gaGFuZGxlcnMgZm9yIHRoZSBjb3JyZXNwb25kaW5nIGV2ZW50LlxuICBmdW5jdGlvbiBndXR0ZXJFdmVudChjbSwgZSwgdHlwZSwgcHJldmVudCkge1xuICAgIHRyeSB7IHZhciBtWCA9IGUuY2xpZW50WCwgbVkgPSBlLmNsaWVudFk7IH1cbiAgICBjYXRjaChlKSB7IHJldHVybiBmYWxzZTsgfVxuICAgIGlmIChtWCA+PSBNYXRoLmZsb29yKGNtLmRpc3BsYXkuZ3V0dGVycy5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5yaWdodCkpIHJldHVybiBmYWxzZTtcbiAgICBpZiAocHJldmVudCkgZV9wcmV2ZW50RGVmYXVsdChlKTtcblxuICAgIHZhciBkaXNwbGF5ID0gY20uZGlzcGxheTtcbiAgICB2YXIgbGluZUJveCA9IGRpc3BsYXkubGluZURpdi5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcblxuICAgIGlmIChtWSA+IGxpbmVCb3guYm90dG9tIHx8ICFoYXNIYW5kbGVyKGNtLCB0eXBlKSkgcmV0dXJuIGVfZGVmYXVsdFByZXZlbnRlZChlKTtcbiAgICBtWSAtPSBsaW5lQm94LnRvcCAtIGRpc3BsYXkudmlld09mZnNldDtcblxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY20ub3B0aW9ucy5ndXR0ZXJzLmxlbmd0aDsgKytpKSB7XG4gICAgICB2YXIgZyA9IGRpc3BsYXkuZ3V0dGVycy5jaGlsZE5vZGVzW2ldO1xuICAgICAgaWYgKGcgJiYgZy5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5yaWdodCA+PSBtWCkge1xuICAgICAgICB2YXIgbGluZSA9IGxpbmVBdEhlaWdodChjbS5kb2MsIG1ZKTtcbiAgICAgICAgdmFyIGd1dHRlciA9IGNtLm9wdGlvbnMuZ3V0dGVyc1tpXTtcbiAgICAgICAgc2lnbmFsKGNtLCB0eXBlLCBjbSwgbGluZSwgZ3V0dGVyLCBlKTtcbiAgICAgICAgcmV0dXJuIGVfZGVmYXVsdFByZXZlbnRlZChlKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBjbGlja0luR3V0dGVyKGNtLCBlKSB7XG4gICAgcmV0dXJuIGd1dHRlckV2ZW50KGNtLCBlLCBcImd1dHRlckNsaWNrXCIsIHRydWUpO1xuICB9XG5cbiAgLy8gS2x1ZGdlIHRvIHdvcmsgYXJvdW5kIHN0cmFuZ2UgSUUgYmVoYXZpb3Igd2hlcmUgaXQnbGwgc29tZXRpbWVzXG4gIC8vIHJlLWZpcmUgYSBzZXJpZXMgb2YgZHJhZy1yZWxhdGVkIGV2ZW50cyByaWdodCBhZnRlciB0aGUgZHJvcCAoIzE1NTEpXG4gIHZhciBsYXN0RHJvcCA9IDA7XG5cbiAgZnVuY3Rpb24gb25Ecm9wKGUpIHtcbiAgICB2YXIgY20gPSB0aGlzO1xuICAgIGNsZWFyRHJhZ0N1cnNvcihjbSk7XG4gICAgaWYgKHNpZ25hbERPTUV2ZW50KGNtLCBlKSB8fCBldmVudEluV2lkZ2V0KGNtLmRpc3BsYXksIGUpKVxuICAgICAgcmV0dXJuO1xuICAgIGVfcHJldmVudERlZmF1bHQoZSk7XG4gICAgaWYgKGllKSBsYXN0RHJvcCA9ICtuZXcgRGF0ZTtcbiAgICB2YXIgcG9zID0gcG9zRnJvbU1vdXNlKGNtLCBlLCB0cnVlKSwgZmlsZXMgPSBlLmRhdGFUcmFuc2Zlci5maWxlcztcbiAgICBpZiAoIXBvcyB8fCBjbS5pc1JlYWRPbmx5KCkpIHJldHVybjtcbiAgICAvLyBNaWdodCBiZSBhIGZpbGUgZHJvcCwgaW4gd2hpY2ggY2FzZSB3ZSBzaW1wbHkgZXh0cmFjdCB0aGUgdGV4dFxuICAgIC8vIGFuZCBpbnNlcnQgaXQuXG4gICAgaWYgKGZpbGVzICYmIGZpbGVzLmxlbmd0aCAmJiB3aW5kb3cuRmlsZVJlYWRlciAmJiB3aW5kb3cuRmlsZSkge1xuICAgICAgdmFyIG4gPSBmaWxlcy5sZW5ndGgsIHRleHQgPSBBcnJheShuKSwgcmVhZCA9IDA7XG4gICAgICB2YXIgbG9hZEZpbGUgPSBmdW5jdGlvbihmaWxlLCBpKSB7XG4gICAgICAgIGlmIChjbS5vcHRpb25zLmFsbG93RHJvcEZpbGVUeXBlcyAmJlxuICAgICAgICAgICAgaW5kZXhPZihjbS5vcHRpb25zLmFsbG93RHJvcEZpbGVUeXBlcywgZmlsZS50eXBlKSA9PSAtMSlcbiAgICAgICAgICByZXR1cm47XG5cbiAgICAgICAgdmFyIHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyO1xuICAgICAgICByZWFkZXIub25sb2FkID0gb3BlcmF0aW9uKGNtLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICB2YXIgY29udGVudCA9IHJlYWRlci5yZXN1bHQ7XG4gICAgICAgICAgaWYgKC9bXFx4MDAtXFx4MDhcXHgwZS1cXHgxZl17Mn0vLnRlc3QoY29udGVudCkpIGNvbnRlbnQgPSBcIlwiO1xuICAgICAgICAgIHRleHRbaV0gPSBjb250ZW50O1xuICAgICAgICAgIGlmICgrK3JlYWQgPT0gbikge1xuICAgICAgICAgICAgcG9zID0gY2xpcFBvcyhjbS5kb2MsIHBvcyk7XG4gICAgICAgICAgICB2YXIgY2hhbmdlID0ge2Zyb206IHBvcywgdG86IHBvcyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogY20uZG9jLnNwbGl0TGluZXModGV4dC5qb2luKGNtLmRvYy5saW5lU2VwYXJhdG9yKCkpKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgb3JpZ2luOiBcInBhc3RlXCJ9O1xuICAgICAgICAgICAgbWFrZUNoYW5nZShjbS5kb2MsIGNoYW5nZSk7XG4gICAgICAgICAgICBzZXRTZWxlY3Rpb25SZXBsYWNlSGlzdG9yeShjbS5kb2MsIHNpbXBsZVNlbGVjdGlvbihwb3MsIGNoYW5nZUVuZChjaGFuZ2UpKSk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmVhZGVyLnJlYWRBc1RleHQoZmlsZSk7XG4gICAgICB9O1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBuOyArK2kpIGxvYWRGaWxlKGZpbGVzW2ldLCBpKTtcbiAgICB9IGVsc2UgeyAvLyBOb3JtYWwgZHJvcFxuICAgICAgLy8gRG9uJ3QgZG8gYSByZXBsYWNlIGlmIHRoZSBkcm9wIGhhcHBlbmVkIGluc2lkZSBvZiB0aGUgc2VsZWN0ZWQgdGV4dC5cbiAgICAgIGlmIChjbS5zdGF0ZS5kcmFnZ2luZ1RleHQgJiYgY20uZG9jLnNlbC5jb250YWlucyhwb3MpID4gLTEpIHtcbiAgICAgICAgY20uc3RhdGUuZHJhZ2dpbmdUZXh0KGUpO1xuICAgICAgICAvLyBFbnN1cmUgdGhlIGVkaXRvciBpcyByZS1mb2N1c2VkXG4gICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7Y20uZGlzcGxheS5pbnB1dC5mb2N1cygpO30sIDIwKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgdHJ5IHtcbiAgICAgICAgdmFyIHRleHQgPSBlLmRhdGFUcmFuc2Zlci5nZXREYXRhKFwiVGV4dFwiKTtcbiAgICAgICAgaWYgKHRleHQpIHtcbiAgICAgICAgICBpZiAoY20uc3RhdGUuZHJhZ2dpbmdUZXh0ICYmICEobWFjID8gZS5hbHRLZXkgOiBlLmN0cmxLZXkpKVxuICAgICAgICAgICAgdmFyIHNlbGVjdGVkID0gY20ubGlzdFNlbGVjdGlvbnMoKTtcbiAgICAgICAgICBzZXRTZWxlY3Rpb25Ob1VuZG8oY20uZG9jLCBzaW1wbGVTZWxlY3Rpb24ocG9zLCBwb3MpKTtcbiAgICAgICAgICBpZiAoc2VsZWN0ZWQpIGZvciAodmFyIGkgPSAwOyBpIDwgc2VsZWN0ZWQubGVuZ3RoOyArK2kpXG4gICAgICAgICAgICByZXBsYWNlUmFuZ2UoY20uZG9jLCBcIlwiLCBzZWxlY3RlZFtpXS5hbmNob3IsIHNlbGVjdGVkW2ldLmhlYWQsIFwiZHJhZ1wiKTtcbiAgICAgICAgICBjbS5yZXBsYWNlU2VsZWN0aW9uKHRleHQsIFwiYXJvdW5kXCIsIFwicGFzdGVcIik7XG4gICAgICAgICAgY20uZGlzcGxheS5pbnB1dC5mb2N1cygpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBjYXRjaChlKXt9XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gb25EcmFnU3RhcnQoY20sIGUpIHtcbiAgICBpZiAoaWUgJiYgKCFjbS5zdGF0ZS5kcmFnZ2luZ1RleHQgfHwgK25ldyBEYXRlIC0gbGFzdERyb3AgPCAxMDApKSB7IGVfc3RvcChlKTsgcmV0dXJuOyB9XG4gICAgaWYgKHNpZ25hbERPTUV2ZW50KGNtLCBlKSB8fCBldmVudEluV2lkZ2V0KGNtLmRpc3BsYXksIGUpKSByZXR1cm47XG5cbiAgICBlLmRhdGFUcmFuc2Zlci5zZXREYXRhKFwiVGV4dFwiLCBjbS5nZXRTZWxlY3Rpb24oKSk7XG5cbiAgICAvLyBVc2UgZHVtbXkgaW1hZ2UgaW5zdGVhZCBvZiBkZWZhdWx0IGJyb3dzZXJzIGltYWdlLlxuICAgIC8vIFJlY2VudCBTYWZhcmkgKH42LjAuMikgaGF2ZSBhIHRlbmRlbmN5IHRvIHNlZ2ZhdWx0IHdoZW4gdGhpcyBoYXBwZW5zLCBzbyB3ZSBkb24ndCBkbyBpdCB0aGVyZS5cbiAgICBpZiAoZS5kYXRhVHJhbnNmZXIuc2V0RHJhZ0ltYWdlICYmICFzYWZhcmkpIHtcbiAgICAgIHZhciBpbWcgPSBlbHQoXCJpbWdcIiwgbnVsbCwgbnVsbCwgXCJwb3NpdGlvbjogZml4ZWQ7IGxlZnQ6IDA7IHRvcDogMDtcIik7XG4gICAgICBpbWcuc3JjID0gXCJkYXRhOmltYWdlL2dpZjtiYXNlNjQsUjBsR09EbGhBUUFCQUFBQUFDSDVCQUVLQUFFQUxBQUFBQUFCQUFFQUFBSUNUQUVBT3c9PVwiO1xuICAgICAgaWYgKHByZXN0bykge1xuICAgICAgICBpbWcud2lkdGggPSBpbWcuaGVpZ2h0ID0gMTtcbiAgICAgICAgY20uZGlzcGxheS53cmFwcGVyLmFwcGVuZENoaWxkKGltZyk7XG4gICAgICAgIC8vIEZvcmNlIGEgcmVsYXlvdXQsIG9yIE9wZXJhIHdvbid0IHVzZSBvdXIgaW1hZ2UgZm9yIHNvbWUgb2JzY3VyZSByZWFzb25cbiAgICAgICAgaW1nLl90b3AgPSBpbWcub2Zmc2V0VG9wO1xuICAgICAgfVxuICAgICAgZS5kYXRhVHJhbnNmZXIuc2V0RHJhZ0ltYWdlKGltZywgMCwgMCk7XG4gICAgICBpZiAocHJlc3RvKSBpbWcucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChpbWcpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIG9uRHJhZ092ZXIoY20sIGUpIHtcbiAgICB2YXIgcG9zID0gcG9zRnJvbU1vdXNlKGNtLCBlKTtcbiAgICBpZiAoIXBvcykgcmV0dXJuO1xuICAgIHZhciBmcmFnID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpO1xuICAgIGRyYXdTZWxlY3Rpb25DdXJzb3IoY20sIHBvcywgZnJhZyk7XG4gICAgaWYgKCFjbS5kaXNwbGF5LmRyYWdDdXJzb3IpIHtcbiAgICAgIGNtLmRpc3BsYXkuZHJhZ0N1cnNvciA9IGVsdChcImRpdlwiLCBudWxsLCBcIkNvZGVNaXJyb3ItY3Vyc29ycyBDb2RlTWlycm9yLWRyYWdjdXJzb3JzXCIpO1xuICAgICAgY20uZGlzcGxheS5saW5lU3BhY2UuaW5zZXJ0QmVmb3JlKGNtLmRpc3BsYXkuZHJhZ0N1cnNvciwgY20uZGlzcGxheS5jdXJzb3JEaXYpO1xuICAgIH1cbiAgICByZW1vdmVDaGlsZHJlbkFuZEFkZChjbS5kaXNwbGF5LmRyYWdDdXJzb3IsIGZyYWcpO1xuICB9XG5cbiAgZnVuY3Rpb24gY2xlYXJEcmFnQ3Vyc29yKGNtKSB7XG4gICAgaWYgKGNtLmRpc3BsYXkuZHJhZ0N1cnNvcikge1xuICAgICAgY20uZGlzcGxheS5saW5lU3BhY2UucmVtb3ZlQ2hpbGQoY20uZGlzcGxheS5kcmFnQ3Vyc29yKTtcbiAgICAgIGNtLmRpc3BsYXkuZHJhZ0N1cnNvciA9IG51bGw7XG4gICAgfVxuICB9XG5cbiAgLy8gU0NST0xMIEVWRU5UU1xuXG4gIC8vIFN5bmMgdGhlIHNjcm9sbGFibGUgYXJlYSBhbmQgc2Nyb2xsYmFycywgZW5zdXJlIHRoZSB2aWV3cG9ydFxuICAvLyBjb3ZlcnMgdGhlIHZpc2libGUgYXJlYS5cbiAgZnVuY3Rpb24gc2V0U2Nyb2xsVG9wKGNtLCB2YWwpIHtcbiAgICBpZiAoTWF0aC5hYnMoY20uZG9jLnNjcm9sbFRvcCAtIHZhbCkgPCAyKSByZXR1cm47XG4gICAgY20uZG9jLnNjcm9sbFRvcCA9IHZhbDtcbiAgICBpZiAoIWdlY2tvKSB1cGRhdGVEaXNwbGF5U2ltcGxlKGNtLCB7dG9wOiB2YWx9KTtcbiAgICBpZiAoY20uZGlzcGxheS5zY3JvbGxlci5zY3JvbGxUb3AgIT0gdmFsKSBjbS5kaXNwbGF5LnNjcm9sbGVyLnNjcm9sbFRvcCA9IHZhbDtcbiAgICBjbS5kaXNwbGF5LnNjcm9sbGJhcnMuc2V0U2Nyb2xsVG9wKHZhbCk7XG4gICAgaWYgKGdlY2tvKSB1cGRhdGVEaXNwbGF5U2ltcGxlKGNtKTtcbiAgICBzdGFydFdvcmtlcihjbSwgMTAwKTtcbiAgfVxuICAvLyBTeW5jIHNjcm9sbGVyIGFuZCBzY3JvbGxiYXIsIGVuc3VyZSB0aGUgZ3V0dGVyIGVsZW1lbnRzIGFyZVxuICAvLyBhbGlnbmVkLlxuICBmdW5jdGlvbiBzZXRTY3JvbGxMZWZ0KGNtLCB2YWwsIGlzU2Nyb2xsZXIpIHtcbiAgICBpZiAoaXNTY3JvbGxlciA/IHZhbCA9PSBjbS5kb2Muc2Nyb2xsTGVmdCA6IE1hdGguYWJzKGNtLmRvYy5zY3JvbGxMZWZ0IC0gdmFsKSA8IDIpIHJldHVybjtcbiAgICB2YWwgPSBNYXRoLm1pbih2YWwsIGNtLmRpc3BsYXkuc2Nyb2xsZXIuc2Nyb2xsV2lkdGggLSBjbS5kaXNwbGF5LnNjcm9sbGVyLmNsaWVudFdpZHRoKTtcbiAgICBjbS5kb2Muc2Nyb2xsTGVmdCA9IHZhbDtcbiAgICBhbGlnbkhvcml6b250YWxseShjbSk7XG4gICAgaWYgKGNtLmRpc3BsYXkuc2Nyb2xsZXIuc2Nyb2xsTGVmdCAhPSB2YWwpIGNtLmRpc3BsYXkuc2Nyb2xsZXIuc2Nyb2xsTGVmdCA9IHZhbDtcbiAgICBjbS5kaXNwbGF5LnNjcm9sbGJhcnMuc2V0U2Nyb2xsTGVmdCh2YWwpO1xuICB9XG5cbiAgLy8gU2luY2UgdGhlIGRlbHRhIHZhbHVlcyByZXBvcnRlZCBvbiBtb3VzZSB3aGVlbCBldmVudHMgYXJlXG4gIC8vIHVuc3RhbmRhcmRpemVkIGJldHdlZW4gYnJvd3NlcnMgYW5kIGV2ZW4gYnJvd3NlciB2ZXJzaW9ucywgYW5kXG4gIC8vIGdlbmVyYWxseSBob3JyaWJseSB1bnByZWRpY3RhYmxlLCB0aGlzIGNvZGUgc3RhcnRzIGJ5IG1lYXN1cmluZ1xuICAvLyB0aGUgc2Nyb2xsIGVmZmVjdCB0aGF0IHRoZSBmaXJzdCBmZXcgbW91c2Ugd2hlZWwgZXZlbnRzIGhhdmUsXG4gIC8vIGFuZCwgZnJvbSB0aGF0LCBkZXRlY3RzIHRoZSB3YXkgaXQgY2FuIGNvbnZlcnQgZGVsdGFzIHRvIHBpeGVsXG4gIC8vIG9mZnNldHMgYWZ0ZXJ3YXJkcy5cbiAgLy9cbiAgLy8gVGhlIHJlYXNvbiB3ZSB3YW50IHRvIGtub3cgdGhlIGFtb3VudCBhIHdoZWVsIGV2ZW50IHdpbGwgc2Nyb2xsXG4gIC8vIGlzIHRoYXQgaXQgZ2l2ZXMgdXMgYSBjaGFuY2UgdG8gdXBkYXRlIHRoZSBkaXNwbGF5IGJlZm9yZSB0aGVcbiAgLy8gYWN0dWFsIHNjcm9sbGluZyBoYXBwZW5zLCByZWR1Y2luZyBmbGlja2VyaW5nLlxuXG4gIHZhciB3aGVlbFNhbXBsZXMgPSAwLCB3aGVlbFBpeGVsc1BlclVuaXQgPSBudWxsO1xuICAvLyBGaWxsIGluIGEgYnJvd3Nlci1kZXRlY3RlZCBzdGFydGluZyB2YWx1ZSBvbiBicm93c2VycyB3aGVyZSB3ZVxuICAvLyBrbm93IG9uZS4gVGhlc2UgZG9uJ3QgaGF2ZSB0byBiZSBhY2N1cmF0ZSAtLSB0aGUgcmVzdWx0IG9mIHRoZW1cbiAgLy8gYmVpbmcgd3Jvbmcgd291bGQganVzdCBiZSBhIHNsaWdodCBmbGlja2VyIG9uIHRoZSBmaXJzdCB3aGVlbFxuICAvLyBzY3JvbGwgKGlmIGl0IGlzIGxhcmdlIGVub3VnaCkuXG4gIGlmIChpZSkgd2hlZWxQaXhlbHNQZXJVbml0ID0gLS41MztcbiAgZWxzZSBpZiAoZ2Vja28pIHdoZWVsUGl4ZWxzUGVyVW5pdCA9IDE1O1xuICBlbHNlIGlmIChjaHJvbWUpIHdoZWVsUGl4ZWxzUGVyVW5pdCA9IC0uNztcbiAgZWxzZSBpZiAoc2FmYXJpKSB3aGVlbFBpeGVsc1BlclVuaXQgPSAtMS8zO1xuXG4gIHZhciB3aGVlbEV2ZW50RGVsdGEgPSBmdW5jdGlvbihlKSB7XG4gICAgdmFyIGR4ID0gZS53aGVlbERlbHRhWCwgZHkgPSBlLndoZWVsRGVsdGFZO1xuICAgIGlmIChkeCA9PSBudWxsICYmIGUuZGV0YWlsICYmIGUuYXhpcyA9PSBlLkhPUklaT05UQUxfQVhJUykgZHggPSBlLmRldGFpbDtcbiAgICBpZiAoZHkgPT0gbnVsbCAmJiBlLmRldGFpbCAmJiBlLmF4aXMgPT0gZS5WRVJUSUNBTF9BWElTKSBkeSA9IGUuZGV0YWlsO1xuICAgIGVsc2UgaWYgKGR5ID09IG51bGwpIGR5ID0gZS53aGVlbERlbHRhO1xuICAgIHJldHVybiB7eDogZHgsIHk6IGR5fTtcbiAgfTtcbiAgQ29kZU1pcnJvci53aGVlbEV2ZW50UGl4ZWxzID0gZnVuY3Rpb24oZSkge1xuICAgIHZhciBkZWx0YSA9IHdoZWVsRXZlbnREZWx0YShlKTtcbiAgICBkZWx0YS54ICo9IHdoZWVsUGl4ZWxzUGVyVW5pdDtcbiAgICBkZWx0YS55ICo9IHdoZWVsUGl4ZWxzUGVyVW5pdDtcbiAgICByZXR1cm4gZGVsdGE7XG4gIH07XG5cbiAgZnVuY3Rpb24gb25TY3JvbGxXaGVlbChjbSwgZSkge1xuICAgIHZhciBkZWx0YSA9IHdoZWVsRXZlbnREZWx0YShlKSwgZHggPSBkZWx0YS54LCBkeSA9IGRlbHRhLnk7XG5cbiAgICB2YXIgZGlzcGxheSA9IGNtLmRpc3BsYXksIHNjcm9sbCA9IGRpc3BsYXkuc2Nyb2xsZXI7XG4gICAgLy8gUXVpdCBpZiB0aGVyZSdzIG5vdGhpbmcgdG8gc2Nyb2xsIGhlcmVcbiAgICB2YXIgY2FuU2Nyb2xsWCA9IHNjcm9sbC5zY3JvbGxXaWR0aCA+IHNjcm9sbC5jbGllbnRXaWR0aDtcbiAgICB2YXIgY2FuU2Nyb2xsWSA9IHNjcm9sbC5zY3JvbGxIZWlnaHQgPiBzY3JvbGwuY2xpZW50SGVpZ2h0O1xuICAgIGlmICghKGR4ICYmIGNhblNjcm9sbFggfHwgZHkgJiYgY2FuU2Nyb2xsWSkpIHJldHVybjtcblxuICAgIC8vIFdlYmtpdCBicm93c2VycyBvbiBPUyBYIGFib3J0IG1vbWVudHVtIHNjcm9sbHMgd2hlbiB0aGUgdGFyZ2V0XG4gICAgLy8gb2YgdGhlIHNjcm9sbCBldmVudCBpcyByZW1vdmVkIGZyb20gdGhlIHNjcm9sbGFibGUgZWxlbWVudC5cbiAgICAvLyBUaGlzIGhhY2sgKHNlZSByZWxhdGVkIGNvZGUgaW4gcGF0Y2hEaXNwbGF5KSBtYWtlcyBzdXJlIHRoZVxuICAgIC8vIGVsZW1lbnQgaXMga2VwdCBhcm91bmQuXG4gICAgaWYgKGR5ICYmIG1hYyAmJiB3ZWJraXQpIHtcbiAgICAgIG91dGVyOiBmb3IgKHZhciBjdXIgPSBlLnRhcmdldCwgdmlldyA9IGRpc3BsYXkudmlldzsgY3VyICE9IHNjcm9sbDsgY3VyID0gY3VyLnBhcmVudE5vZGUpIHtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB2aWV3Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgaWYgKHZpZXdbaV0ubm9kZSA9PSBjdXIpIHtcbiAgICAgICAgICAgIGNtLmRpc3BsYXkuY3VycmVudFdoZWVsVGFyZ2V0ID0gY3VyO1xuICAgICAgICAgICAgYnJlYWsgb3V0ZXI7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gT24gc29tZSBicm93c2VycywgaG9yaXpvbnRhbCBzY3JvbGxpbmcgd2lsbCBjYXVzZSByZWRyYXdzIHRvXG4gICAgLy8gaGFwcGVuIGJlZm9yZSB0aGUgZ3V0dGVyIGhhcyBiZWVuIHJlYWxpZ25lZCwgY2F1c2luZyBpdCB0b1xuICAgIC8vIHdyaWdnbGUgYXJvdW5kIGluIGEgbW9zdCB1bnNlZW1seSB3YXkuIFdoZW4gd2UgaGF2ZSBhblxuICAgIC8vIGVzdGltYXRlZCBwaXhlbHMvZGVsdGEgdmFsdWUsIHdlIGp1c3QgaGFuZGxlIGhvcml6b250YWxcbiAgICAvLyBzY3JvbGxpbmcgZW50aXJlbHkgaGVyZS4gSXQnbGwgYmUgc2xpZ2h0bHkgb2ZmIGZyb20gbmF0aXZlLCBidXRcbiAgICAvLyBiZXR0ZXIgdGhhbiBnbGl0Y2hpbmcgb3V0LlxuICAgIGlmIChkeCAmJiAhZ2Vja28gJiYgIXByZXN0byAmJiB3aGVlbFBpeGVsc1BlclVuaXQgIT0gbnVsbCkge1xuICAgICAgaWYgKGR5ICYmIGNhblNjcm9sbFkpXG4gICAgICAgIHNldFNjcm9sbFRvcChjbSwgTWF0aC5tYXgoMCwgTWF0aC5taW4oc2Nyb2xsLnNjcm9sbFRvcCArIGR5ICogd2hlZWxQaXhlbHNQZXJVbml0LCBzY3JvbGwuc2Nyb2xsSGVpZ2h0IC0gc2Nyb2xsLmNsaWVudEhlaWdodCkpKTtcbiAgICAgIHNldFNjcm9sbExlZnQoY20sIE1hdGgubWF4KDAsIE1hdGgubWluKHNjcm9sbC5zY3JvbGxMZWZ0ICsgZHggKiB3aGVlbFBpeGVsc1BlclVuaXQsIHNjcm9sbC5zY3JvbGxXaWR0aCAtIHNjcm9sbC5jbGllbnRXaWR0aCkpKTtcbiAgICAgIC8vIE9ubHkgcHJldmVudCBkZWZhdWx0IHNjcm9sbGluZyBpZiB2ZXJ0aWNhbCBzY3JvbGxpbmcgaXNcbiAgICAgIC8vIGFjdHVhbGx5IHBvc3NpYmxlLiBPdGhlcndpc2UsIGl0IGNhdXNlcyB2ZXJ0aWNhbCBzY3JvbGxcbiAgICAgIC8vIGppdHRlciBvbiBPU1ggdHJhY2twYWRzIHdoZW4gZGVsdGFYIGlzIHNtYWxsIGFuZCBkZWx0YVlcbiAgICAgIC8vIGlzIGxhcmdlIChpc3N1ZSAjMzU3OSlcbiAgICAgIGlmICghZHkgfHwgKGR5ICYmIGNhblNjcm9sbFkpKVxuICAgICAgICBlX3ByZXZlbnREZWZhdWx0KGUpO1xuICAgICAgZGlzcGxheS53aGVlbFN0YXJ0WCA9IG51bGw7IC8vIEFib3J0IG1lYXN1cmVtZW50LCBpZiBpbiBwcm9ncmVzc1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vICdQcm9qZWN0JyB0aGUgdmlzaWJsZSB2aWV3cG9ydCB0byBjb3ZlciB0aGUgYXJlYSB0aGF0IGlzIGJlaW5nXG4gICAgLy8gc2Nyb2xsZWQgaW50byB2aWV3IChpZiB3ZSBrbm93IGVub3VnaCB0byBlc3RpbWF0ZSBpdCkuXG4gICAgaWYgKGR5ICYmIHdoZWVsUGl4ZWxzUGVyVW5pdCAhPSBudWxsKSB7XG4gICAgICB2YXIgcGl4ZWxzID0gZHkgKiB3aGVlbFBpeGVsc1BlclVuaXQ7XG4gICAgICB2YXIgdG9wID0gY20uZG9jLnNjcm9sbFRvcCwgYm90ID0gdG9wICsgZGlzcGxheS53cmFwcGVyLmNsaWVudEhlaWdodDtcbiAgICAgIGlmIChwaXhlbHMgPCAwKSB0b3AgPSBNYXRoLm1heCgwLCB0b3AgKyBwaXhlbHMgLSA1MCk7XG4gICAgICBlbHNlIGJvdCA9IE1hdGgubWluKGNtLmRvYy5oZWlnaHQsIGJvdCArIHBpeGVscyArIDUwKTtcbiAgICAgIHVwZGF0ZURpc3BsYXlTaW1wbGUoY20sIHt0b3A6IHRvcCwgYm90dG9tOiBib3R9KTtcbiAgICB9XG5cbiAgICBpZiAod2hlZWxTYW1wbGVzIDwgMjApIHtcbiAgICAgIGlmIChkaXNwbGF5LndoZWVsU3RhcnRYID09IG51bGwpIHtcbiAgICAgICAgZGlzcGxheS53aGVlbFN0YXJ0WCA9IHNjcm9sbC5zY3JvbGxMZWZ0OyBkaXNwbGF5LndoZWVsU3RhcnRZID0gc2Nyb2xsLnNjcm9sbFRvcDtcbiAgICAgICAgZGlzcGxheS53aGVlbERYID0gZHg7IGRpc3BsYXkud2hlZWxEWSA9IGR5O1xuICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGlmIChkaXNwbGF5LndoZWVsU3RhcnRYID09IG51bGwpIHJldHVybjtcbiAgICAgICAgICB2YXIgbW92ZWRYID0gc2Nyb2xsLnNjcm9sbExlZnQgLSBkaXNwbGF5LndoZWVsU3RhcnRYO1xuICAgICAgICAgIHZhciBtb3ZlZFkgPSBzY3JvbGwuc2Nyb2xsVG9wIC0gZGlzcGxheS53aGVlbFN0YXJ0WTtcbiAgICAgICAgICB2YXIgc2FtcGxlID0gKG1vdmVkWSAmJiBkaXNwbGF5LndoZWVsRFkgJiYgbW92ZWRZIC8gZGlzcGxheS53aGVlbERZKSB8fFxuICAgICAgICAgICAgKG1vdmVkWCAmJiBkaXNwbGF5LndoZWVsRFggJiYgbW92ZWRYIC8gZGlzcGxheS53aGVlbERYKTtcbiAgICAgICAgICBkaXNwbGF5LndoZWVsU3RhcnRYID0gZGlzcGxheS53aGVlbFN0YXJ0WSA9IG51bGw7XG4gICAgICAgICAgaWYgKCFzYW1wbGUpIHJldHVybjtcbiAgICAgICAgICB3aGVlbFBpeGVsc1BlclVuaXQgPSAod2hlZWxQaXhlbHNQZXJVbml0ICogd2hlZWxTYW1wbGVzICsgc2FtcGxlKSAvICh3aGVlbFNhbXBsZXMgKyAxKTtcbiAgICAgICAgICArK3doZWVsU2FtcGxlcztcbiAgICAgICAgfSwgMjAwKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGRpc3BsYXkud2hlZWxEWCArPSBkeDsgZGlzcGxheS53aGVlbERZICs9IGR5O1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8vIEtFWSBFVkVOVFNcblxuICAvLyBSdW4gYSBoYW5kbGVyIHRoYXQgd2FzIGJvdW5kIHRvIGEga2V5LlxuICBmdW5jdGlvbiBkb0hhbmRsZUJpbmRpbmcoY20sIGJvdW5kLCBkcm9wU2hpZnQpIHtcbiAgICBpZiAodHlwZW9mIGJvdW5kID09IFwic3RyaW5nXCIpIHtcbiAgICAgIGJvdW5kID0gY29tbWFuZHNbYm91bmRdO1xuICAgICAgaWYgKCFib3VuZCkgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICAvLyBFbnN1cmUgcHJldmlvdXMgaW5wdXQgaGFzIGJlZW4gcmVhZCwgc28gdGhhdCB0aGUgaGFuZGxlciBzZWVzIGFcbiAgICAvLyBjb25zaXN0ZW50IHZpZXcgb2YgdGhlIGRvY3VtZW50XG4gICAgY20uZGlzcGxheS5pbnB1dC5lbnN1cmVQb2xsZWQoKTtcbiAgICB2YXIgcHJldlNoaWZ0ID0gY20uZGlzcGxheS5zaGlmdCwgZG9uZSA9IGZhbHNlO1xuICAgIHRyeSB7XG4gICAgICBpZiAoY20uaXNSZWFkT25seSgpKSBjbS5zdGF0ZS5zdXBwcmVzc0VkaXRzID0gdHJ1ZTtcbiAgICAgIGlmIChkcm9wU2hpZnQpIGNtLmRpc3BsYXkuc2hpZnQgPSBmYWxzZTtcbiAgICAgIGRvbmUgPSBib3VuZChjbSkgIT0gUGFzcztcbiAgICB9IGZpbmFsbHkge1xuICAgICAgY20uZGlzcGxheS5zaGlmdCA9IHByZXZTaGlmdDtcbiAgICAgIGNtLnN0YXRlLnN1cHByZXNzRWRpdHMgPSBmYWxzZTtcbiAgICB9XG4gICAgcmV0dXJuIGRvbmU7XG4gIH1cblxuICBmdW5jdGlvbiBsb29rdXBLZXlGb3JFZGl0b3IoY20sIG5hbWUsIGhhbmRsZSkge1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY20uc3RhdGUua2V5TWFwcy5sZW5ndGg7IGkrKykge1xuICAgICAgdmFyIHJlc3VsdCA9IGxvb2t1cEtleShuYW1lLCBjbS5zdGF0ZS5rZXlNYXBzW2ldLCBoYW5kbGUsIGNtKTtcbiAgICAgIGlmIChyZXN1bHQpIHJldHVybiByZXN1bHQ7XG4gICAgfVxuICAgIHJldHVybiAoY20ub3B0aW9ucy5leHRyYUtleXMgJiYgbG9va3VwS2V5KG5hbWUsIGNtLm9wdGlvbnMuZXh0cmFLZXlzLCBoYW5kbGUsIGNtKSlcbiAgICAgIHx8IGxvb2t1cEtleShuYW1lLCBjbS5vcHRpb25zLmtleU1hcCwgaGFuZGxlLCBjbSk7XG4gIH1cblxuICB2YXIgc3RvcFNlcSA9IG5ldyBEZWxheWVkO1xuICBmdW5jdGlvbiBkaXNwYXRjaEtleShjbSwgbmFtZSwgZSwgaGFuZGxlKSB7XG4gICAgdmFyIHNlcSA9IGNtLnN0YXRlLmtleVNlcTtcbiAgICBpZiAoc2VxKSB7XG4gICAgICBpZiAoaXNNb2RpZmllcktleShuYW1lKSkgcmV0dXJuIFwiaGFuZGxlZFwiO1xuICAgICAgc3RvcFNlcS5zZXQoNTAsIGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAoY20uc3RhdGUua2V5U2VxID09IHNlcSkge1xuICAgICAgICAgIGNtLnN0YXRlLmtleVNlcSA9IG51bGw7XG4gICAgICAgICAgY20uZGlzcGxheS5pbnB1dC5yZXNldCgpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIG5hbWUgPSBzZXEgKyBcIiBcIiArIG5hbWU7XG4gICAgfVxuICAgIHZhciByZXN1bHQgPSBsb29rdXBLZXlGb3JFZGl0b3IoY20sIG5hbWUsIGhhbmRsZSk7XG5cbiAgICBpZiAocmVzdWx0ID09IFwibXVsdGlcIilcbiAgICAgIGNtLnN0YXRlLmtleVNlcSA9IG5hbWU7XG4gICAgaWYgKHJlc3VsdCA9PSBcImhhbmRsZWRcIilcbiAgICAgIHNpZ25hbExhdGVyKGNtLCBcImtleUhhbmRsZWRcIiwgY20sIG5hbWUsIGUpO1xuXG4gICAgaWYgKHJlc3VsdCA9PSBcImhhbmRsZWRcIiB8fCByZXN1bHQgPT0gXCJtdWx0aVwiKSB7XG4gICAgICBlX3ByZXZlbnREZWZhdWx0KGUpO1xuICAgICAgcmVzdGFydEJsaW5rKGNtKTtcbiAgICB9XG5cbiAgICBpZiAoc2VxICYmICFyZXN1bHQgJiYgL1xcJyQvLnRlc3QobmFtZSkpIHtcbiAgICAgIGVfcHJldmVudERlZmF1bHQoZSk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuICEhcmVzdWx0O1xuICB9XG5cbiAgLy8gSGFuZGxlIGEga2V5IGZyb20gdGhlIGtleWRvd24gZXZlbnQuXG4gIGZ1bmN0aW9uIGhhbmRsZUtleUJpbmRpbmcoY20sIGUpIHtcbiAgICB2YXIgbmFtZSA9IGtleU5hbWUoZSwgdHJ1ZSk7XG4gICAgaWYgKCFuYW1lKSByZXR1cm4gZmFsc2U7XG5cbiAgICBpZiAoZS5zaGlmdEtleSAmJiAhY20uc3RhdGUua2V5U2VxKSB7XG4gICAgICAvLyBGaXJzdCB0cnkgdG8gcmVzb2x2ZSBmdWxsIG5hbWUgKGluY2x1ZGluZyAnU2hpZnQtJykuIEZhaWxpbmdcbiAgICAgIC8vIHRoYXQsIHNlZSBpZiB0aGVyZSBpcyBhIGN1cnNvci1tb3Rpb24gY29tbWFuZCAoc3RhcnRpbmcgd2l0aFxuICAgICAgLy8gJ2dvJykgYm91bmQgdG8gdGhlIGtleW5hbWUgd2l0aG91dCAnU2hpZnQtJy5cbiAgICAgIHJldHVybiBkaXNwYXRjaEtleShjbSwgXCJTaGlmdC1cIiArIG5hbWUsIGUsIGZ1bmN0aW9uKGIpIHtyZXR1cm4gZG9IYW5kbGVCaW5kaW5nKGNtLCBiLCB0cnVlKTt9KVxuICAgICAgICAgIHx8IGRpc3BhdGNoS2V5KGNtLCBuYW1lLCBlLCBmdW5jdGlvbihiKSB7XG4gICAgICAgICAgICAgICBpZiAodHlwZW9mIGIgPT0gXCJzdHJpbmdcIiA/IC9eZ29bQS1aXS8udGVzdChiKSA6IGIubW90aW9uKVxuICAgICAgICAgICAgICAgICByZXR1cm4gZG9IYW5kbGVCaW5kaW5nKGNtLCBiKTtcbiAgICAgICAgICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIGRpc3BhdGNoS2V5KGNtLCBuYW1lLCBlLCBmdW5jdGlvbihiKSB7IHJldHVybiBkb0hhbmRsZUJpbmRpbmcoY20sIGIpOyB9KTtcbiAgICB9XG4gIH1cblxuICAvLyBIYW5kbGUgYSBrZXkgZnJvbSB0aGUga2V5cHJlc3MgZXZlbnRcbiAgZnVuY3Rpb24gaGFuZGxlQ2hhckJpbmRpbmcoY20sIGUsIGNoKSB7XG4gICAgcmV0dXJuIGRpc3BhdGNoS2V5KGNtLCBcIidcIiArIGNoICsgXCInXCIsIGUsXG4gICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uKGIpIHsgcmV0dXJuIGRvSGFuZGxlQmluZGluZyhjbSwgYiwgdHJ1ZSk7IH0pO1xuICB9XG5cbiAgdmFyIGxhc3RTdG9wcGVkS2V5ID0gbnVsbDtcbiAgZnVuY3Rpb24gb25LZXlEb3duKGUpIHtcbiAgICB2YXIgY20gPSB0aGlzO1xuICAgIGNtLmN1ck9wLmZvY3VzID0gYWN0aXZlRWx0KCk7XG4gICAgaWYgKHNpZ25hbERPTUV2ZW50KGNtLCBlKSkgcmV0dXJuO1xuICAgIC8vIElFIGRvZXMgc3RyYW5nZSB0aGluZ3Mgd2l0aCBlc2NhcGUuXG4gICAgaWYgKGllICYmIGllX3ZlcnNpb24gPCAxMSAmJiBlLmtleUNvZGUgPT0gMjcpIGUucmV0dXJuVmFsdWUgPSBmYWxzZTtcbiAgICB2YXIgY29kZSA9IGUua2V5Q29kZTtcbiAgICBjbS5kaXNwbGF5LnNoaWZ0ID0gY29kZSA9PSAxNiB8fCBlLnNoaWZ0S2V5O1xuICAgIHZhciBoYW5kbGVkID0gaGFuZGxlS2V5QmluZGluZyhjbSwgZSk7XG4gICAgaWYgKHByZXN0bykge1xuICAgICAgbGFzdFN0b3BwZWRLZXkgPSBoYW5kbGVkID8gY29kZSA6IG51bGw7XG4gICAgICAvLyBPcGVyYSBoYXMgbm8gY3V0IGV2ZW50Li4uIHdlIHRyeSB0byBhdCBsZWFzdCBjYXRjaCB0aGUga2V5IGNvbWJvXG4gICAgICBpZiAoIWhhbmRsZWQgJiYgY29kZSA9PSA4OCAmJiAhaGFzQ29weUV2ZW50ICYmIChtYWMgPyBlLm1ldGFLZXkgOiBlLmN0cmxLZXkpKVxuICAgICAgICBjbS5yZXBsYWNlU2VsZWN0aW9uKFwiXCIsIG51bGwsIFwiY3V0XCIpO1xuICAgIH1cblxuICAgIC8vIFR1cm4gbW91c2UgaW50byBjcm9zc2hhaXIgd2hlbiBBbHQgaXMgaGVsZCBvbiBNYWMuXG4gICAgaWYgKGNvZGUgPT0gMTggJiYgIS9cXGJDb2RlTWlycm9yLWNyb3NzaGFpclxcYi8udGVzdChjbS5kaXNwbGF5LmxpbmVEaXYuY2xhc3NOYW1lKSlcbiAgICAgIHNob3dDcm9zc0hhaXIoY20pO1xuICB9XG5cbiAgZnVuY3Rpb24gc2hvd0Nyb3NzSGFpcihjbSkge1xuICAgIHZhciBsaW5lRGl2ID0gY20uZGlzcGxheS5saW5lRGl2O1xuICAgIGFkZENsYXNzKGxpbmVEaXYsIFwiQ29kZU1pcnJvci1jcm9zc2hhaXJcIik7XG5cbiAgICBmdW5jdGlvbiB1cChlKSB7XG4gICAgICBpZiAoZS5rZXlDb2RlID09IDE4IHx8ICFlLmFsdEtleSkge1xuICAgICAgICBybUNsYXNzKGxpbmVEaXYsIFwiQ29kZU1pcnJvci1jcm9zc2hhaXJcIik7XG4gICAgICAgIG9mZihkb2N1bWVudCwgXCJrZXl1cFwiLCB1cCk7XG4gICAgICAgIG9mZihkb2N1bWVudCwgXCJtb3VzZW92ZXJcIiwgdXApO1xuICAgICAgfVxuICAgIH1cbiAgICBvbihkb2N1bWVudCwgXCJrZXl1cFwiLCB1cCk7XG4gICAgb24oZG9jdW1lbnQsIFwibW91c2VvdmVyXCIsIHVwKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIG9uS2V5VXAoZSkge1xuICAgIGlmIChlLmtleUNvZGUgPT0gMTYpIHRoaXMuZG9jLnNlbC5zaGlmdCA9IGZhbHNlO1xuICAgIHNpZ25hbERPTUV2ZW50KHRoaXMsIGUpO1xuICB9XG5cbiAgZnVuY3Rpb24gb25LZXlQcmVzcyhlKSB7XG4gICAgdmFyIGNtID0gdGhpcztcbiAgICBpZiAoZXZlbnRJbldpZGdldChjbS5kaXNwbGF5LCBlKSB8fCBzaWduYWxET01FdmVudChjbSwgZSkgfHwgZS5jdHJsS2V5ICYmICFlLmFsdEtleSB8fCBtYWMgJiYgZS5tZXRhS2V5KSByZXR1cm47XG4gICAgdmFyIGtleUNvZGUgPSBlLmtleUNvZGUsIGNoYXJDb2RlID0gZS5jaGFyQ29kZTtcbiAgICBpZiAocHJlc3RvICYmIGtleUNvZGUgPT0gbGFzdFN0b3BwZWRLZXkpIHtsYXN0U3RvcHBlZEtleSA9IG51bGw7IGVfcHJldmVudERlZmF1bHQoZSk7IHJldHVybjt9XG4gICAgaWYgKChwcmVzdG8gJiYgKCFlLndoaWNoIHx8IGUud2hpY2ggPCAxMCkpICYmIGhhbmRsZUtleUJpbmRpbmcoY20sIGUpKSByZXR1cm47XG4gICAgdmFyIGNoID0gU3RyaW5nLmZyb21DaGFyQ29kZShjaGFyQ29kZSA9PSBudWxsID8ga2V5Q29kZSA6IGNoYXJDb2RlKTtcbiAgICBpZiAoaGFuZGxlQ2hhckJpbmRpbmcoY20sIGUsIGNoKSkgcmV0dXJuO1xuICAgIGNtLmRpc3BsYXkuaW5wdXQub25LZXlQcmVzcyhlKTtcbiAgfVxuXG4gIC8vIEZPQ1VTL0JMVVIgRVZFTlRTXG5cbiAgZnVuY3Rpb24gZGVsYXlCbHVyRXZlbnQoY20pIHtcbiAgICBjbS5zdGF0ZS5kZWxheWluZ0JsdXJFdmVudCA9IHRydWU7XG4gICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgIGlmIChjbS5zdGF0ZS5kZWxheWluZ0JsdXJFdmVudCkge1xuICAgICAgICBjbS5zdGF0ZS5kZWxheWluZ0JsdXJFdmVudCA9IGZhbHNlO1xuICAgICAgICBvbkJsdXIoY20pO1xuICAgICAgfVxuICAgIH0sIDEwMCk7XG4gIH1cblxuICBmdW5jdGlvbiBvbkZvY3VzKGNtKSB7XG4gICAgaWYgKGNtLnN0YXRlLmRlbGF5aW5nQmx1ckV2ZW50KSBjbS5zdGF0ZS5kZWxheWluZ0JsdXJFdmVudCA9IGZhbHNlO1xuXG4gICAgaWYgKGNtLm9wdGlvbnMucmVhZE9ubHkgPT0gXCJub2N1cnNvclwiKSByZXR1cm47XG4gICAgaWYgKCFjbS5zdGF0ZS5mb2N1c2VkKSB7XG4gICAgICBzaWduYWwoY20sIFwiZm9jdXNcIiwgY20pO1xuICAgICAgY20uc3RhdGUuZm9jdXNlZCA9IHRydWU7XG4gICAgICBhZGRDbGFzcyhjbS5kaXNwbGF5LndyYXBwZXIsIFwiQ29kZU1pcnJvci1mb2N1c2VkXCIpO1xuICAgICAgLy8gVGhpcyB0ZXN0IHByZXZlbnRzIHRoaXMgZnJvbSBmaXJpbmcgd2hlbiBhIGNvbnRleHRcbiAgICAgIC8vIG1lbnUgaXMgY2xvc2VkIChzaW5jZSB0aGUgaW5wdXQgcmVzZXQgd291bGQga2lsbCB0aGVcbiAgICAgIC8vIHNlbGVjdC1hbGwgZGV0ZWN0aW9uIGhhY2spXG4gICAgICBpZiAoIWNtLmN1ck9wICYmIGNtLmRpc3BsYXkuc2VsRm9yQ29udGV4dE1lbnUgIT0gY20uZG9jLnNlbCkge1xuICAgICAgICBjbS5kaXNwbGF5LmlucHV0LnJlc2V0KCk7XG4gICAgICAgIGlmICh3ZWJraXQpIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7IGNtLmRpc3BsYXkuaW5wdXQucmVzZXQodHJ1ZSk7IH0sIDIwKTsgLy8gSXNzdWUgIzE3MzBcbiAgICAgIH1cbiAgICAgIGNtLmRpc3BsYXkuaW5wdXQucmVjZWl2ZWRGb2N1cygpO1xuICAgIH1cbiAgICByZXN0YXJ0QmxpbmsoY20pO1xuICB9XG4gIGZ1bmN0aW9uIG9uQmx1cihjbSkge1xuICAgIGlmIChjbS5zdGF0ZS5kZWxheWluZ0JsdXJFdmVudCkgcmV0dXJuO1xuXG4gICAgaWYgKGNtLnN0YXRlLmZvY3VzZWQpIHtcbiAgICAgIHNpZ25hbChjbSwgXCJibHVyXCIsIGNtKTtcbiAgICAgIGNtLnN0YXRlLmZvY3VzZWQgPSBmYWxzZTtcbiAgICAgIHJtQ2xhc3MoY20uZGlzcGxheS53cmFwcGVyLCBcIkNvZGVNaXJyb3ItZm9jdXNlZFwiKTtcbiAgICB9XG4gICAgY2xlYXJJbnRlcnZhbChjbS5kaXNwbGF5LmJsaW5rZXIpO1xuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7aWYgKCFjbS5zdGF0ZS5mb2N1c2VkKSBjbS5kaXNwbGF5LnNoaWZ0ID0gZmFsc2U7fSwgMTUwKTtcbiAgfVxuXG4gIC8vIENPTlRFWFQgTUVOVSBIQU5ETElOR1xuXG4gIC8vIFRvIG1ha2UgdGhlIGNvbnRleHQgbWVudSB3b3JrLCB3ZSBuZWVkIHRvIGJyaWVmbHkgdW5oaWRlIHRoZVxuICAvLyB0ZXh0YXJlYSAobWFraW5nIGl0IGFzIHVub2J0cnVzaXZlIGFzIHBvc3NpYmxlKSB0byBsZXQgdGhlXG4gIC8vIHJpZ2h0LWNsaWNrIHRha2UgZWZmZWN0IG9uIGl0LlxuICBmdW5jdGlvbiBvbkNvbnRleHRNZW51KGNtLCBlKSB7XG4gICAgaWYgKGV2ZW50SW5XaWRnZXQoY20uZGlzcGxheSwgZSkgfHwgY29udGV4dE1lbnVJbkd1dHRlcihjbSwgZSkpIHJldHVybjtcbiAgICBpZiAoc2lnbmFsRE9NRXZlbnQoY20sIGUsIFwiY29udGV4dG1lbnVcIikpIHJldHVybjtcbiAgICBjbS5kaXNwbGF5LmlucHV0Lm9uQ29udGV4dE1lbnUoZSk7XG4gIH1cblxuICBmdW5jdGlvbiBjb250ZXh0TWVudUluR3V0dGVyKGNtLCBlKSB7XG4gICAgaWYgKCFoYXNIYW5kbGVyKGNtLCBcImd1dHRlckNvbnRleHRNZW51XCIpKSByZXR1cm4gZmFsc2U7XG4gICAgcmV0dXJuIGd1dHRlckV2ZW50KGNtLCBlLCBcImd1dHRlckNvbnRleHRNZW51XCIsIGZhbHNlKTtcbiAgfVxuXG4gIC8vIFVQREFUSU5HXG5cbiAgLy8gQ29tcHV0ZSB0aGUgcG9zaXRpb24gb2YgdGhlIGVuZCBvZiBhIGNoYW5nZSAoaXRzICd0bycgcHJvcGVydHlcbiAgLy8gcmVmZXJzIHRvIHRoZSBwcmUtY2hhbmdlIGVuZCkuXG4gIHZhciBjaGFuZ2VFbmQgPSBDb2RlTWlycm9yLmNoYW5nZUVuZCA9IGZ1bmN0aW9uKGNoYW5nZSkge1xuICAgIGlmICghY2hhbmdlLnRleHQpIHJldHVybiBjaGFuZ2UudG87XG4gICAgcmV0dXJuIFBvcyhjaGFuZ2UuZnJvbS5saW5lICsgY2hhbmdlLnRleHQubGVuZ3RoIC0gMSxcbiAgICAgICAgICAgICAgIGxzdChjaGFuZ2UudGV4dCkubGVuZ3RoICsgKGNoYW5nZS50ZXh0Lmxlbmd0aCA9PSAxID8gY2hhbmdlLmZyb20uY2ggOiAwKSk7XG4gIH07XG5cbiAgLy8gQWRqdXN0IGEgcG9zaXRpb24gdG8gcmVmZXIgdG8gdGhlIHBvc3QtY2hhbmdlIHBvc2l0aW9uIG9mIHRoZVxuICAvLyBzYW1lIHRleHQsIG9yIHRoZSBlbmQgb2YgdGhlIGNoYW5nZSBpZiB0aGUgY2hhbmdlIGNvdmVycyBpdC5cbiAgZnVuY3Rpb24gYWRqdXN0Rm9yQ2hhbmdlKHBvcywgY2hhbmdlKSB7XG4gICAgaWYgKGNtcChwb3MsIGNoYW5nZS5mcm9tKSA8IDApIHJldHVybiBwb3M7XG4gICAgaWYgKGNtcChwb3MsIGNoYW5nZS50bykgPD0gMCkgcmV0dXJuIGNoYW5nZUVuZChjaGFuZ2UpO1xuXG4gICAgdmFyIGxpbmUgPSBwb3MubGluZSArIGNoYW5nZS50ZXh0Lmxlbmd0aCAtIChjaGFuZ2UudG8ubGluZSAtIGNoYW5nZS5mcm9tLmxpbmUpIC0gMSwgY2ggPSBwb3MuY2g7XG4gICAgaWYgKHBvcy5saW5lID09IGNoYW5nZS50by5saW5lKSBjaCArPSBjaGFuZ2VFbmQoY2hhbmdlKS5jaCAtIGNoYW5nZS50by5jaDtcbiAgICByZXR1cm4gUG9zKGxpbmUsIGNoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGNvbXB1dGVTZWxBZnRlckNoYW5nZShkb2MsIGNoYW5nZSkge1xuICAgIHZhciBvdXQgPSBbXTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGRvYy5zZWwucmFuZ2VzLmxlbmd0aDsgaSsrKSB7XG4gICAgICB2YXIgcmFuZ2UgPSBkb2Muc2VsLnJhbmdlc1tpXTtcbiAgICAgIG91dC5wdXNoKG5ldyBSYW5nZShhZGp1c3RGb3JDaGFuZ2UocmFuZ2UuYW5jaG9yLCBjaGFuZ2UpLFxuICAgICAgICAgICAgICAgICAgICAgICAgIGFkanVzdEZvckNoYW5nZShyYW5nZS5oZWFkLCBjaGFuZ2UpKSk7XG4gICAgfVxuICAgIHJldHVybiBub3JtYWxpemVTZWxlY3Rpb24ob3V0LCBkb2Muc2VsLnByaW1JbmRleCk7XG4gIH1cblxuICBmdW5jdGlvbiBvZmZzZXRQb3MocG9zLCBvbGQsIG53KSB7XG4gICAgaWYgKHBvcy5saW5lID09IG9sZC5saW5lKVxuICAgICAgcmV0dXJuIFBvcyhudy5saW5lLCBwb3MuY2ggLSBvbGQuY2ggKyBudy5jaCk7XG4gICAgZWxzZVxuICAgICAgcmV0dXJuIFBvcyhudy5saW5lICsgKHBvcy5saW5lIC0gb2xkLmxpbmUpLCBwb3MuY2gpO1xuICB9XG5cbiAgLy8gVXNlZCBieSByZXBsYWNlU2VsZWN0aW9ucyB0byBhbGxvdyBtb3ZpbmcgdGhlIHNlbGVjdGlvbiB0byB0aGVcbiAgLy8gc3RhcnQgb3IgYXJvdW5kIHRoZSByZXBsYWNlZCB0ZXN0LiBIaW50IG1heSBiZSBcInN0YXJ0XCIgb3IgXCJhcm91bmRcIi5cbiAgZnVuY3Rpb24gY29tcHV0ZVJlcGxhY2VkU2VsKGRvYywgY2hhbmdlcywgaGludCkge1xuICAgIHZhciBvdXQgPSBbXTtcbiAgICB2YXIgb2xkUHJldiA9IFBvcyhkb2MuZmlyc3QsIDApLCBuZXdQcmV2ID0gb2xkUHJldjtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNoYW5nZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgIHZhciBjaGFuZ2UgPSBjaGFuZ2VzW2ldO1xuICAgICAgdmFyIGZyb20gPSBvZmZzZXRQb3MoY2hhbmdlLmZyb20sIG9sZFByZXYsIG5ld1ByZXYpO1xuICAgICAgdmFyIHRvID0gb2Zmc2V0UG9zKGNoYW5nZUVuZChjaGFuZ2UpLCBvbGRQcmV2LCBuZXdQcmV2KTtcbiAgICAgIG9sZFByZXYgPSBjaGFuZ2UudG87XG4gICAgICBuZXdQcmV2ID0gdG87XG4gICAgICBpZiAoaGludCA9PSBcImFyb3VuZFwiKSB7XG4gICAgICAgIHZhciByYW5nZSA9IGRvYy5zZWwucmFuZ2VzW2ldLCBpbnYgPSBjbXAocmFuZ2UuaGVhZCwgcmFuZ2UuYW5jaG9yKSA8IDA7XG4gICAgICAgIG91dFtpXSA9IG5ldyBSYW5nZShpbnYgPyB0byA6IGZyb20sIGludiA/IGZyb20gOiB0byk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBvdXRbaV0gPSBuZXcgUmFuZ2UoZnJvbSwgZnJvbSk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBuZXcgU2VsZWN0aW9uKG91dCwgZG9jLnNlbC5wcmltSW5kZXgpO1xuICB9XG5cbiAgLy8gQWxsb3cgXCJiZWZvcmVDaGFuZ2VcIiBldmVudCBoYW5kbGVycyB0byBpbmZsdWVuY2UgYSBjaGFuZ2VcbiAgZnVuY3Rpb24gZmlsdGVyQ2hhbmdlKGRvYywgY2hhbmdlLCB1cGRhdGUpIHtcbiAgICB2YXIgb2JqID0ge1xuICAgICAgY2FuY2VsZWQ6IGZhbHNlLFxuICAgICAgZnJvbTogY2hhbmdlLmZyb20sXG4gICAgICB0bzogY2hhbmdlLnRvLFxuICAgICAgdGV4dDogY2hhbmdlLnRleHQsXG4gICAgICBvcmlnaW46IGNoYW5nZS5vcmlnaW4sXG4gICAgICBjYW5jZWw6IGZ1bmN0aW9uKCkgeyB0aGlzLmNhbmNlbGVkID0gdHJ1ZTsgfVxuICAgIH07XG4gICAgaWYgKHVwZGF0ZSkgb2JqLnVwZGF0ZSA9IGZ1bmN0aW9uKGZyb20sIHRvLCB0ZXh0LCBvcmlnaW4pIHtcbiAgICAgIGlmIChmcm9tKSB0aGlzLmZyb20gPSBjbGlwUG9zKGRvYywgZnJvbSk7XG4gICAgICBpZiAodG8pIHRoaXMudG8gPSBjbGlwUG9zKGRvYywgdG8pO1xuICAgICAgaWYgKHRleHQpIHRoaXMudGV4dCA9IHRleHQ7XG4gICAgICBpZiAob3JpZ2luICE9PSB1bmRlZmluZWQpIHRoaXMub3JpZ2luID0gb3JpZ2luO1xuICAgIH07XG4gICAgc2lnbmFsKGRvYywgXCJiZWZvcmVDaGFuZ2VcIiwgZG9jLCBvYmopO1xuICAgIGlmIChkb2MuY20pIHNpZ25hbChkb2MuY20sIFwiYmVmb3JlQ2hhbmdlXCIsIGRvYy5jbSwgb2JqKTtcblxuICAgIGlmIChvYmouY2FuY2VsZWQpIHJldHVybiBudWxsO1xuICAgIHJldHVybiB7ZnJvbTogb2JqLmZyb20sIHRvOiBvYmoudG8sIHRleHQ6IG9iai50ZXh0LCBvcmlnaW46IG9iai5vcmlnaW59O1xuICB9XG5cbiAgLy8gQXBwbHkgYSBjaGFuZ2UgdG8gYSBkb2N1bWVudCwgYW5kIGFkZCBpdCB0byB0aGUgZG9jdW1lbnQnc1xuICAvLyBoaXN0b3J5LCBhbmQgcHJvcGFnYXRpbmcgaXQgdG8gYWxsIGxpbmtlZCBkb2N1bWVudHMuXG4gIGZ1bmN0aW9uIG1ha2VDaGFuZ2UoZG9jLCBjaGFuZ2UsIGlnbm9yZVJlYWRPbmx5KSB7XG4gICAgaWYgKGRvYy5jbSkge1xuICAgICAgaWYgKCFkb2MuY20uY3VyT3ApIHJldHVybiBvcGVyYXRpb24oZG9jLmNtLCBtYWtlQ2hhbmdlKShkb2MsIGNoYW5nZSwgaWdub3JlUmVhZE9ubHkpO1xuICAgICAgaWYgKGRvYy5jbS5zdGF0ZS5zdXBwcmVzc0VkaXRzKSByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKGhhc0hhbmRsZXIoZG9jLCBcImJlZm9yZUNoYW5nZVwiKSB8fCBkb2MuY20gJiYgaGFzSGFuZGxlcihkb2MuY20sIFwiYmVmb3JlQ2hhbmdlXCIpKSB7XG4gICAgICBjaGFuZ2UgPSBmaWx0ZXJDaGFuZ2UoZG9jLCBjaGFuZ2UsIHRydWUpO1xuICAgICAgaWYgKCFjaGFuZ2UpIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBQb3NzaWJseSBzcGxpdCBvciBzdXBwcmVzcyB0aGUgdXBkYXRlIGJhc2VkIG9uIHRoZSBwcmVzZW5jZVxuICAgIC8vIG9mIHJlYWQtb25seSBzcGFucyBpbiBpdHMgcmFuZ2UuXG4gICAgdmFyIHNwbGl0ID0gc2F3UmVhZE9ubHlTcGFucyAmJiAhaWdub3JlUmVhZE9ubHkgJiYgcmVtb3ZlUmVhZE9ubHlSYW5nZXMoZG9jLCBjaGFuZ2UuZnJvbSwgY2hhbmdlLnRvKTtcbiAgICBpZiAoc3BsaXQpIHtcbiAgICAgIGZvciAodmFyIGkgPSBzcGxpdC5sZW5ndGggLSAxOyBpID49IDA7IC0taSlcbiAgICAgICAgbWFrZUNoYW5nZUlubmVyKGRvYywge2Zyb206IHNwbGl0W2ldLmZyb20sIHRvOiBzcGxpdFtpXS50bywgdGV4dDogaSA/IFtcIlwiXSA6IGNoYW5nZS50ZXh0fSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIG1ha2VDaGFuZ2VJbm5lcihkb2MsIGNoYW5nZSk7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gbWFrZUNoYW5nZUlubmVyKGRvYywgY2hhbmdlKSB7XG4gICAgaWYgKGNoYW5nZS50ZXh0Lmxlbmd0aCA9PSAxICYmIGNoYW5nZS50ZXh0WzBdID09IFwiXCIgJiYgY21wKGNoYW5nZS5mcm9tLCBjaGFuZ2UudG8pID09IDApIHJldHVybjtcbiAgICB2YXIgc2VsQWZ0ZXIgPSBjb21wdXRlU2VsQWZ0ZXJDaGFuZ2UoZG9jLCBjaGFuZ2UpO1xuICAgIGFkZENoYW5nZVRvSGlzdG9yeShkb2MsIGNoYW5nZSwgc2VsQWZ0ZXIsIGRvYy5jbSA/IGRvYy5jbS5jdXJPcC5pZCA6IE5hTik7XG5cbiAgICBtYWtlQ2hhbmdlU2luZ2xlRG9jKGRvYywgY2hhbmdlLCBzZWxBZnRlciwgc3RyZXRjaFNwYW5zT3ZlckNoYW5nZShkb2MsIGNoYW5nZSkpO1xuICAgIHZhciByZWJhc2VkID0gW107XG5cbiAgICBsaW5rZWREb2NzKGRvYywgZnVuY3Rpb24oZG9jLCBzaGFyZWRIaXN0KSB7XG4gICAgICBpZiAoIXNoYXJlZEhpc3QgJiYgaW5kZXhPZihyZWJhc2VkLCBkb2MuaGlzdG9yeSkgPT0gLTEpIHtcbiAgICAgICAgcmViYXNlSGlzdChkb2MuaGlzdG9yeSwgY2hhbmdlKTtcbiAgICAgICAgcmViYXNlZC5wdXNoKGRvYy5oaXN0b3J5KTtcbiAgICAgIH1cbiAgICAgIG1ha2VDaGFuZ2VTaW5nbGVEb2MoZG9jLCBjaGFuZ2UsIG51bGwsIHN0cmV0Y2hTcGFuc092ZXJDaGFuZ2UoZG9jLCBjaGFuZ2UpKTtcbiAgICB9KTtcbiAgfVxuXG4gIC8vIFJldmVydCBhIGNoYW5nZSBzdG9yZWQgaW4gYSBkb2N1bWVudCdzIGhpc3RvcnkuXG4gIGZ1bmN0aW9uIG1ha2VDaGFuZ2VGcm9tSGlzdG9yeShkb2MsIHR5cGUsIGFsbG93U2VsZWN0aW9uT25seSkge1xuICAgIGlmIChkb2MuY20gJiYgZG9jLmNtLnN0YXRlLnN1cHByZXNzRWRpdHMpIHJldHVybjtcblxuICAgIHZhciBoaXN0ID0gZG9jLmhpc3RvcnksIGV2ZW50LCBzZWxBZnRlciA9IGRvYy5zZWw7XG4gICAgdmFyIHNvdXJjZSA9IHR5cGUgPT0gXCJ1bmRvXCIgPyBoaXN0LmRvbmUgOiBoaXN0LnVuZG9uZSwgZGVzdCA9IHR5cGUgPT0gXCJ1bmRvXCIgPyBoaXN0LnVuZG9uZSA6IGhpc3QuZG9uZTtcblxuICAgIC8vIFZlcmlmeSB0aGF0IHRoZXJlIGlzIGEgdXNlYWJsZSBldmVudCAoc28gdGhhdCBjdHJsLXogd29uJ3RcbiAgICAvLyBuZWVkbGVzc2x5IGNsZWFyIHNlbGVjdGlvbiBldmVudHMpXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzb3VyY2UubGVuZ3RoOyBpKyspIHtcbiAgICAgIGV2ZW50ID0gc291cmNlW2ldO1xuICAgICAgaWYgKGFsbG93U2VsZWN0aW9uT25seSA/IGV2ZW50LnJhbmdlcyAmJiAhZXZlbnQuZXF1YWxzKGRvYy5zZWwpIDogIWV2ZW50LnJhbmdlcylcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICAgIGlmIChpID09IHNvdXJjZS5sZW5ndGgpIHJldHVybjtcbiAgICBoaXN0Lmxhc3RPcmlnaW4gPSBoaXN0Lmxhc3RTZWxPcmlnaW4gPSBudWxsO1xuXG4gICAgZm9yICg7Oykge1xuICAgICAgZXZlbnQgPSBzb3VyY2UucG9wKCk7XG4gICAgICBpZiAoZXZlbnQucmFuZ2VzKSB7XG4gICAgICAgIHB1c2hTZWxlY3Rpb25Ub0hpc3RvcnkoZXZlbnQsIGRlc3QpO1xuICAgICAgICBpZiAoYWxsb3dTZWxlY3Rpb25Pbmx5ICYmICFldmVudC5lcXVhbHMoZG9jLnNlbCkpIHtcbiAgICAgICAgICBzZXRTZWxlY3Rpb24oZG9jLCBldmVudCwge2NsZWFyUmVkbzogZmFsc2V9KTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgc2VsQWZ0ZXIgPSBldmVudDtcbiAgICAgIH1cbiAgICAgIGVsc2UgYnJlYWs7XG4gICAgfVxuXG4gICAgLy8gQnVpbGQgdXAgYSByZXZlcnNlIGNoYW5nZSBvYmplY3QgdG8gYWRkIHRvIHRoZSBvcHBvc2l0ZSBoaXN0b3J5XG4gICAgLy8gc3RhY2sgKHJlZG8gd2hlbiB1bmRvaW5nLCBhbmQgdmljZSB2ZXJzYSkuXG4gICAgdmFyIGFudGlDaGFuZ2VzID0gW107XG4gICAgcHVzaFNlbGVjdGlvblRvSGlzdG9yeShzZWxBZnRlciwgZGVzdCk7XG4gICAgZGVzdC5wdXNoKHtjaGFuZ2VzOiBhbnRpQ2hhbmdlcywgZ2VuZXJhdGlvbjogaGlzdC5nZW5lcmF0aW9ufSk7XG4gICAgaGlzdC5nZW5lcmF0aW9uID0gZXZlbnQuZ2VuZXJhdGlvbiB8fCArK2hpc3QubWF4R2VuZXJhdGlvbjtcblxuICAgIHZhciBmaWx0ZXIgPSBoYXNIYW5kbGVyKGRvYywgXCJiZWZvcmVDaGFuZ2VcIikgfHwgZG9jLmNtICYmIGhhc0hhbmRsZXIoZG9jLmNtLCBcImJlZm9yZUNoYW5nZVwiKTtcblxuICAgIGZvciAodmFyIGkgPSBldmVudC5jaGFuZ2VzLmxlbmd0aCAtIDE7IGkgPj0gMDsgLS1pKSB7XG4gICAgICB2YXIgY2hhbmdlID0gZXZlbnQuY2hhbmdlc1tpXTtcbiAgICAgIGNoYW5nZS5vcmlnaW4gPSB0eXBlO1xuICAgICAgaWYgKGZpbHRlciAmJiAhZmlsdGVyQ2hhbmdlKGRvYywgY2hhbmdlLCBmYWxzZSkpIHtcbiAgICAgICAgc291cmNlLmxlbmd0aCA9IDA7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgYW50aUNoYW5nZXMucHVzaChoaXN0b3J5Q2hhbmdlRnJvbUNoYW5nZShkb2MsIGNoYW5nZSkpO1xuXG4gICAgICB2YXIgYWZ0ZXIgPSBpID8gY29tcHV0ZVNlbEFmdGVyQ2hhbmdlKGRvYywgY2hhbmdlKSA6IGxzdChzb3VyY2UpO1xuICAgICAgbWFrZUNoYW5nZVNpbmdsZURvYyhkb2MsIGNoYW5nZSwgYWZ0ZXIsIG1lcmdlT2xkU3BhbnMoZG9jLCBjaGFuZ2UpKTtcbiAgICAgIGlmICghaSAmJiBkb2MuY20pIGRvYy5jbS5zY3JvbGxJbnRvVmlldyh7ZnJvbTogY2hhbmdlLmZyb20sIHRvOiBjaGFuZ2VFbmQoY2hhbmdlKX0pO1xuICAgICAgdmFyIHJlYmFzZWQgPSBbXTtcblxuICAgICAgLy8gUHJvcGFnYXRlIHRvIHRoZSBsaW5rZWQgZG9jdW1lbnRzXG4gICAgICBsaW5rZWREb2NzKGRvYywgZnVuY3Rpb24oZG9jLCBzaGFyZWRIaXN0KSB7XG4gICAgICAgIGlmICghc2hhcmVkSGlzdCAmJiBpbmRleE9mKHJlYmFzZWQsIGRvYy5oaXN0b3J5KSA9PSAtMSkge1xuICAgICAgICAgIHJlYmFzZUhpc3QoZG9jLmhpc3RvcnksIGNoYW5nZSk7XG4gICAgICAgICAgcmViYXNlZC5wdXNoKGRvYy5oaXN0b3J5KTtcbiAgICAgICAgfVxuICAgICAgICBtYWtlQ2hhbmdlU2luZ2xlRG9jKGRvYywgY2hhbmdlLCBudWxsLCBtZXJnZU9sZFNwYW5zKGRvYywgY2hhbmdlKSk7XG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICAvLyBTdWItdmlld3MgbmVlZCB0aGVpciBsaW5lIG51bWJlcnMgc2hpZnRlZCB3aGVuIHRleHQgaXMgYWRkZWRcbiAgLy8gYWJvdmUgb3IgYmVsb3cgdGhlbSBpbiB0aGUgcGFyZW50IGRvY3VtZW50LlxuICBmdW5jdGlvbiBzaGlmdERvYyhkb2MsIGRpc3RhbmNlKSB7XG4gICAgaWYgKGRpc3RhbmNlID09IDApIHJldHVybjtcbiAgICBkb2MuZmlyc3QgKz0gZGlzdGFuY2U7XG4gICAgZG9jLnNlbCA9IG5ldyBTZWxlY3Rpb24obWFwKGRvYy5zZWwucmFuZ2VzLCBmdW5jdGlvbihyYW5nZSkge1xuICAgICAgcmV0dXJuIG5ldyBSYW5nZShQb3MocmFuZ2UuYW5jaG9yLmxpbmUgKyBkaXN0YW5jZSwgcmFuZ2UuYW5jaG9yLmNoKSxcbiAgICAgICAgICAgICAgICAgICAgICAgUG9zKHJhbmdlLmhlYWQubGluZSArIGRpc3RhbmNlLCByYW5nZS5oZWFkLmNoKSk7XG4gICAgfSksIGRvYy5zZWwucHJpbUluZGV4KTtcbiAgICBpZiAoZG9jLmNtKSB7XG4gICAgICByZWdDaGFuZ2UoZG9jLmNtLCBkb2MuZmlyc3QsIGRvYy5maXJzdCAtIGRpc3RhbmNlLCBkaXN0YW5jZSk7XG4gICAgICBmb3IgKHZhciBkID0gZG9jLmNtLmRpc3BsYXksIGwgPSBkLnZpZXdGcm9tOyBsIDwgZC52aWV3VG87IGwrKylcbiAgICAgICAgcmVnTGluZUNoYW5nZShkb2MuY20sIGwsIFwiZ3V0dGVyXCIpO1xuICAgIH1cbiAgfVxuXG4gIC8vIE1vcmUgbG93ZXItbGV2ZWwgY2hhbmdlIGZ1bmN0aW9uLCBoYW5kbGluZyBvbmx5IGEgc2luZ2xlIGRvY3VtZW50XG4gIC8vIChub3QgbGlua2VkIG9uZXMpLlxuICBmdW5jdGlvbiBtYWtlQ2hhbmdlU2luZ2xlRG9jKGRvYywgY2hhbmdlLCBzZWxBZnRlciwgc3BhbnMpIHtcbiAgICBpZiAoZG9jLmNtICYmICFkb2MuY20uY3VyT3ApXG4gICAgICByZXR1cm4gb3BlcmF0aW9uKGRvYy5jbSwgbWFrZUNoYW5nZVNpbmdsZURvYykoZG9jLCBjaGFuZ2UsIHNlbEFmdGVyLCBzcGFucyk7XG5cbiAgICBpZiAoY2hhbmdlLnRvLmxpbmUgPCBkb2MuZmlyc3QpIHtcbiAgICAgIHNoaWZ0RG9jKGRvYywgY2hhbmdlLnRleHQubGVuZ3RoIC0gMSAtIChjaGFuZ2UudG8ubGluZSAtIGNoYW5nZS5mcm9tLmxpbmUpKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKGNoYW5nZS5mcm9tLmxpbmUgPiBkb2MubGFzdExpbmUoKSkgcmV0dXJuO1xuXG4gICAgLy8gQ2xpcCB0aGUgY2hhbmdlIHRvIHRoZSBzaXplIG9mIHRoaXMgZG9jXG4gICAgaWYgKGNoYW5nZS5mcm9tLmxpbmUgPCBkb2MuZmlyc3QpIHtcbiAgICAgIHZhciBzaGlmdCA9IGNoYW5nZS50ZXh0Lmxlbmd0aCAtIDEgLSAoZG9jLmZpcnN0IC0gY2hhbmdlLmZyb20ubGluZSk7XG4gICAgICBzaGlmdERvYyhkb2MsIHNoaWZ0KTtcbiAgICAgIGNoYW5nZSA9IHtmcm9tOiBQb3MoZG9jLmZpcnN0LCAwKSwgdG86IFBvcyhjaGFuZ2UudG8ubGluZSArIHNoaWZ0LCBjaGFuZ2UudG8uY2gpLFxuICAgICAgICAgICAgICAgIHRleHQ6IFtsc3QoY2hhbmdlLnRleHQpXSwgb3JpZ2luOiBjaGFuZ2Uub3JpZ2lufTtcbiAgICB9XG4gICAgdmFyIGxhc3QgPSBkb2MubGFzdExpbmUoKTtcbiAgICBpZiAoY2hhbmdlLnRvLmxpbmUgPiBsYXN0KSB7XG4gICAgICBjaGFuZ2UgPSB7ZnJvbTogY2hhbmdlLmZyb20sIHRvOiBQb3MobGFzdCwgZ2V0TGluZShkb2MsIGxhc3QpLnRleHQubGVuZ3RoKSxcbiAgICAgICAgICAgICAgICB0ZXh0OiBbY2hhbmdlLnRleHRbMF1dLCBvcmlnaW46IGNoYW5nZS5vcmlnaW59O1xuICAgIH1cblxuICAgIGNoYW5nZS5yZW1vdmVkID0gZ2V0QmV0d2Vlbihkb2MsIGNoYW5nZS5mcm9tLCBjaGFuZ2UudG8pO1xuXG4gICAgaWYgKCFzZWxBZnRlcikgc2VsQWZ0ZXIgPSBjb21wdXRlU2VsQWZ0ZXJDaGFuZ2UoZG9jLCBjaGFuZ2UpO1xuICAgIGlmIChkb2MuY20pIG1ha2VDaGFuZ2VTaW5nbGVEb2NJbkVkaXRvcihkb2MuY20sIGNoYW5nZSwgc3BhbnMpO1xuICAgIGVsc2UgdXBkYXRlRG9jKGRvYywgY2hhbmdlLCBzcGFucyk7XG4gICAgc2V0U2VsZWN0aW9uTm9VbmRvKGRvYywgc2VsQWZ0ZXIsIHNlbF9kb250U2Nyb2xsKTtcbiAgfVxuXG4gIC8vIEhhbmRsZSB0aGUgaW50ZXJhY3Rpb24gb2YgYSBjaGFuZ2UgdG8gYSBkb2N1bWVudCB3aXRoIHRoZSBlZGl0b3JcbiAgLy8gdGhhdCB0aGlzIGRvY3VtZW50IGlzIHBhcnQgb2YuXG4gIGZ1bmN0aW9uIG1ha2VDaGFuZ2VTaW5nbGVEb2NJbkVkaXRvcihjbSwgY2hhbmdlLCBzcGFucykge1xuICAgIHZhciBkb2MgPSBjbS5kb2MsIGRpc3BsYXkgPSBjbS5kaXNwbGF5LCBmcm9tID0gY2hhbmdlLmZyb20sIHRvID0gY2hhbmdlLnRvO1xuXG4gICAgdmFyIHJlY29tcHV0ZU1heExlbmd0aCA9IGZhbHNlLCBjaGVja1dpZHRoU3RhcnQgPSBmcm9tLmxpbmU7XG4gICAgaWYgKCFjbS5vcHRpb25zLmxpbmVXcmFwcGluZykge1xuICAgICAgY2hlY2tXaWR0aFN0YXJ0ID0gbGluZU5vKHZpc3VhbExpbmUoZ2V0TGluZShkb2MsIGZyb20ubGluZSkpKTtcbiAgICAgIGRvYy5pdGVyKGNoZWNrV2lkdGhTdGFydCwgdG8ubGluZSArIDEsIGZ1bmN0aW9uKGxpbmUpIHtcbiAgICAgICAgaWYgKGxpbmUgPT0gZGlzcGxheS5tYXhMaW5lKSB7XG4gICAgICAgICAgcmVjb21wdXRlTWF4TGVuZ3RoID0gdHJ1ZTtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgaWYgKGRvYy5zZWwuY29udGFpbnMoY2hhbmdlLmZyb20sIGNoYW5nZS50bykgPiAtMSlcbiAgICAgIHNpZ25hbEN1cnNvckFjdGl2aXR5KGNtKTtcblxuICAgIHVwZGF0ZURvYyhkb2MsIGNoYW5nZSwgc3BhbnMsIGVzdGltYXRlSGVpZ2h0KGNtKSk7XG5cbiAgICBpZiAoIWNtLm9wdGlvbnMubGluZVdyYXBwaW5nKSB7XG4gICAgICBkb2MuaXRlcihjaGVja1dpZHRoU3RhcnQsIGZyb20ubGluZSArIGNoYW5nZS50ZXh0Lmxlbmd0aCwgZnVuY3Rpb24obGluZSkge1xuICAgICAgICB2YXIgbGVuID0gbGluZUxlbmd0aChsaW5lKTtcbiAgICAgICAgaWYgKGxlbiA+IGRpc3BsYXkubWF4TGluZUxlbmd0aCkge1xuICAgICAgICAgIGRpc3BsYXkubWF4TGluZSA9IGxpbmU7XG4gICAgICAgICAgZGlzcGxheS5tYXhMaW5lTGVuZ3RoID0gbGVuO1xuICAgICAgICAgIGRpc3BsYXkubWF4TGluZUNoYW5nZWQgPSB0cnVlO1xuICAgICAgICAgIHJlY29tcHV0ZU1heExlbmd0aCA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIGlmIChyZWNvbXB1dGVNYXhMZW5ndGgpIGNtLmN1ck9wLnVwZGF0ZU1heExpbmUgPSB0cnVlO1xuICAgIH1cblxuICAgIC8vIEFkanVzdCBmcm9udGllciwgc2NoZWR1bGUgd29ya2VyXG4gICAgZG9jLmZyb250aWVyID0gTWF0aC5taW4oZG9jLmZyb250aWVyLCBmcm9tLmxpbmUpO1xuICAgIHN0YXJ0V29ya2VyKGNtLCA0MDApO1xuXG4gICAgdmFyIGxlbmRpZmYgPSBjaGFuZ2UudGV4dC5sZW5ndGggLSAodG8ubGluZSAtIGZyb20ubGluZSkgLSAxO1xuICAgIC8vIFJlbWVtYmVyIHRoYXQgdGhlc2UgbGluZXMgY2hhbmdlZCwgZm9yIHVwZGF0aW5nIHRoZSBkaXNwbGF5XG4gICAgaWYgKGNoYW5nZS5mdWxsKVxuICAgICAgcmVnQ2hhbmdlKGNtKTtcbiAgICBlbHNlIGlmIChmcm9tLmxpbmUgPT0gdG8ubGluZSAmJiBjaGFuZ2UudGV4dC5sZW5ndGggPT0gMSAmJiAhaXNXaG9sZUxpbmVVcGRhdGUoY20uZG9jLCBjaGFuZ2UpKVxuICAgICAgcmVnTGluZUNoYW5nZShjbSwgZnJvbS5saW5lLCBcInRleHRcIik7XG4gICAgZWxzZVxuICAgICAgcmVnQ2hhbmdlKGNtLCBmcm9tLmxpbmUsIHRvLmxpbmUgKyAxLCBsZW5kaWZmKTtcblxuICAgIHZhciBjaGFuZ2VzSGFuZGxlciA9IGhhc0hhbmRsZXIoY20sIFwiY2hhbmdlc1wiKSwgY2hhbmdlSGFuZGxlciA9IGhhc0hhbmRsZXIoY20sIFwiY2hhbmdlXCIpO1xuICAgIGlmIChjaGFuZ2VIYW5kbGVyIHx8IGNoYW5nZXNIYW5kbGVyKSB7XG4gICAgICB2YXIgb2JqID0ge1xuICAgICAgICBmcm9tOiBmcm9tLCB0bzogdG8sXG4gICAgICAgIHRleHQ6IGNoYW5nZS50ZXh0LFxuICAgICAgICByZW1vdmVkOiBjaGFuZ2UucmVtb3ZlZCxcbiAgICAgICAgb3JpZ2luOiBjaGFuZ2Uub3JpZ2luXG4gICAgICB9O1xuICAgICAgaWYgKGNoYW5nZUhhbmRsZXIpIHNpZ25hbExhdGVyKGNtLCBcImNoYW5nZVwiLCBjbSwgb2JqKTtcbiAgICAgIGlmIChjaGFuZ2VzSGFuZGxlcikgKGNtLmN1ck9wLmNoYW5nZU9ianMgfHwgKGNtLmN1ck9wLmNoYW5nZU9ianMgPSBbXSkpLnB1c2gob2JqKTtcbiAgICB9XG4gICAgY20uZGlzcGxheS5zZWxGb3JDb250ZXh0TWVudSA9IG51bGw7XG4gIH1cblxuICBmdW5jdGlvbiByZXBsYWNlUmFuZ2UoZG9jLCBjb2RlLCBmcm9tLCB0bywgb3JpZ2luKSB7XG4gICAgaWYgKCF0bykgdG8gPSBmcm9tO1xuICAgIGlmIChjbXAodG8sIGZyb20pIDwgMCkgeyB2YXIgdG1wID0gdG87IHRvID0gZnJvbTsgZnJvbSA9IHRtcDsgfVxuICAgIGlmICh0eXBlb2YgY29kZSA9PSBcInN0cmluZ1wiKSBjb2RlID0gZG9jLnNwbGl0TGluZXMoY29kZSk7XG4gICAgbWFrZUNoYW5nZShkb2MsIHtmcm9tOiBmcm9tLCB0bzogdG8sIHRleHQ6IGNvZGUsIG9yaWdpbjogb3JpZ2lufSk7XG4gIH1cblxuICAvLyBTQ1JPTExJTkcgVEhJTkdTIElOVE8gVklFV1xuXG4gIC8vIElmIGFuIGVkaXRvciBzaXRzIG9uIHRoZSB0b3Agb3IgYm90dG9tIG9mIHRoZSB3aW5kb3csIHBhcnRpYWxseVxuICAvLyBzY3JvbGxlZCBvdXQgb2YgdmlldywgdGhpcyBlbnN1cmVzIHRoYXQgdGhlIGN1cnNvciBpcyB2aXNpYmxlLlxuICBmdW5jdGlvbiBtYXliZVNjcm9sbFdpbmRvdyhjbSwgY29vcmRzKSB7XG4gICAgaWYgKHNpZ25hbERPTUV2ZW50KGNtLCBcInNjcm9sbEN1cnNvckludG9WaWV3XCIpKSByZXR1cm47XG5cbiAgICB2YXIgZGlzcGxheSA9IGNtLmRpc3BsYXksIGJveCA9IGRpc3BsYXkuc2l6ZXIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCksIGRvU2Nyb2xsID0gbnVsbDtcbiAgICBpZiAoY29vcmRzLnRvcCArIGJveC50b3AgPCAwKSBkb1Njcm9sbCA9IHRydWU7XG4gICAgZWxzZSBpZiAoY29vcmRzLmJvdHRvbSArIGJveC50b3AgPiAod2luZG93LmlubmVySGVpZ2h0IHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQpKSBkb1Njcm9sbCA9IGZhbHNlO1xuICAgIGlmIChkb1Njcm9sbCAhPSBudWxsICYmICFwaGFudG9tKSB7XG4gICAgICB2YXIgc2Nyb2xsTm9kZSA9IGVsdChcImRpdlwiLCBcIlxcdTIwMGJcIiwgbnVsbCwgXCJwb3NpdGlvbjogYWJzb2x1dGU7IHRvcDogXCIgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgKGNvb3Jkcy50b3AgLSBkaXNwbGF5LnZpZXdPZmZzZXQgLSBwYWRkaW5nVG9wKGNtLmRpc3BsYXkpKSArIFwicHg7IGhlaWdodDogXCIgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgKGNvb3Jkcy5ib3R0b20gLSBjb29yZHMudG9wICsgc2Nyb2xsR2FwKGNtKSArIGRpc3BsYXkuYmFySGVpZ2h0KSArIFwicHg7IGxlZnQ6IFwiICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvb3Jkcy5sZWZ0ICsgXCJweDsgd2lkdGg6IDJweDtcIik7XG4gICAgICBjbS5kaXNwbGF5LmxpbmVTcGFjZS5hcHBlbmRDaGlsZChzY3JvbGxOb2RlKTtcbiAgICAgIHNjcm9sbE5vZGUuc2Nyb2xsSW50b1ZpZXcoZG9TY3JvbGwpO1xuICAgICAgY20uZGlzcGxheS5saW5lU3BhY2UucmVtb3ZlQ2hpbGQoc2Nyb2xsTm9kZSk7XG4gICAgfVxuICB9XG5cbiAgLy8gU2Nyb2xsIGEgZ2l2ZW4gcG9zaXRpb24gaW50byB2aWV3IChpbW1lZGlhdGVseSksIHZlcmlmeWluZyB0aGF0XG4gIC8vIGl0IGFjdHVhbGx5IGJlY2FtZSB2aXNpYmxlIChhcyBsaW5lIGhlaWdodHMgYXJlIGFjY3VyYXRlbHlcbiAgLy8gbWVhc3VyZWQsIHRoZSBwb3NpdGlvbiBvZiBzb21ldGhpbmcgbWF5ICdkcmlmdCcgZHVyaW5nIGRyYXdpbmcpLlxuICBmdW5jdGlvbiBzY3JvbGxQb3NJbnRvVmlldyhjbSwgcG9zLCBlbmQsIG1hcmdpbikge1xuICAgIGlmIChtYXJnaW4gPT0gbnVsbCkgbWFyZ2luID0gMDtcbiAgICBmb3IgKHZhciBsaW1pdCA9IDA7IGxpbWl0IDwgNTsgbGltaXQrKykge1xuICAgICAgdmFyIGNoYW5nZWQgPSBmYWxzZSwgY29vcmRzID0gY3Vyc29yQ29vcmRzKGNtLCBwb3MpO1xuICAgICAgdmFyIGVuZENvb3JkcyA9ICFlbmQgfHwgZW5kID09IHBvcyA/IGNvb3JkcyA6IGN1cnNvckNvb3JkcyhjbSwgZW5kKTtcbiAgICAgIHZhciBzY3JvbGxQb3MgPSBjYWxjdWxhdGVTY3JvbGxQb3MoY20sIE1hdGgubWluKGNvb3Jkcy5sZWZ0LCBlbmRDb29yZHMubGVmdCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1hdGgubWluKGNvb3Jkcy50b3AsIGVuZENvb3Jkcy50b3ApIC0gbWFyZ2luLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBNYXRoLm1heChjb29yZHMubGVmdCwgZW5kQ29vcmRzLmxlZnQpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBNYXRoLm1heChjb29yZHMuYm90dG9tLCBlbmRDb29yZHMuYm90dG9tKSArIG1hcmdpbik7XG4gICAgICB2YXIgc3RhcnRUb3AgPSBjbS5kb2Muc2Nyb2xsVG9wLCBzdGFydExlZnQgPSBjbS5kb2Muc2Nyb2xsTGVmdDtcbiAgICAgIGlmIChzY3JvbGxQb3Muc2Nyb2xsVG9wICE9IG51bGwpIHtcbiAgICAgICAgc2V0U2Nyb2xsVG9wKGNtLCBzY3JvbGxQb3Muc2Nyb2xsVG9wKTtcbiAgICAgICAgaWYgKE1hdGguYWJzKGNtLmRvYy5zY3JvbGxUb3AgLSBzdGFydFRvcCkgPiAxKSBjaGFuZ2VkID0gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIGlmIChzY3JvbGxQb3Muc2Nyb2xsTGVmdCAhPSBudWxsKSB7XG4gICAgICAgIHNldFNjcm9sbExlZnQoY20sIHNjcm9sbFBvcy5zY3JvbGxMZWZ0KTtcbiAgICAgICAgaWYgKE1hdGguYWJzKGNtLmRvYy5zY3JvbGxMZWZ0IC0gc3RhcnRMZWZ0KSA+IDEpIGNoYW5nZWQgPSB0cnVlO1xuICAgICAgfVxuICAgICAgaWYgKCFjaGFuZ2VkKSBicmVhaztcbiAgICB9XG4gICAgcmV0dXJuIGNvb3JkcztcbiAgfVxuXG4gIC8vIFNjcm9sbCBhIGdpdmVuIHNldCBvZiBjb29yZGluYXRlcyBpbnRvIHZpZXcgKGltbWVkaWF0ZWx5KS5cbiAgZnVuY3Rpb24gc2Nyb2xsSW50b1ZpZXcoY20sIHgxLCB5MSwgeDIsIHkyKSB7XG4gICAgdmFyIHNjcm9sbFBvcyA9IGNhbGN1bGF0ZVNjcm9sbFBvcyhjbSwgeDEsIHkxLCB4MiwgeTIpO1xuICAgIGlmIChzY3JvbGxQb3Muc2Nyb2xsVG9wICE9IG51bGwpIHNldFNjcm9sbFRvcChjbSwgc2Nyb2xsUG9zLnNjcm9sbFRvcCk7XG4gICAgaWYgKHNjcm9sbFBvcy5zY3JvbGxMZWZ0ICE9IG51bGwpIHNldFNjcm9sbExlZnQoY20sIHNjcm9sbFBvcy5zY3JvbGxMZWZ0KTtcbiAgfVxuXG4gIC8vIENhbGN1bGF0ZSBhIG5ldyBzY3JvbGwgcG9zaXRpb24gbmVlZGVkIHRvIHNjcm9sbCB0aGUgZ2l2ZW5cbiAgLy8gcmVjdGFuZ2xlIGludG8gdmlldy4gUmV0dXJucyBhbiBvYmplY3Qgd2l0aCBzY3JvbGxUb3AgYW5kXG4gIC8vIHNjcm9sbExlZnQgcHJvcGVydGllcy4gV2hlbiB0aGVzZSBhcmUgdW5kZWZpbmVkLCB0aGVcbiAgLy8gdmVydGljYWwvaG9yaXpvbnRhbCBwb3NpdGlvbiBkb2VzIG5vdCBuZWVkIHRvIGJlIGFkanVzdGVkLlxuICBmdW5jdGlvbiBjYWxjdWxhdGVTY3JvbGxQb3MoY20sIHgxLCB5MSwgeDIsIHkyKSB7XG4gICAgdmFyIGRpc3BsYXkgPSBjbS5kaXNwbGF5LCBzbmFwTWFyZ2luID0gdGV4dEhlaWdodChjbS5kaXNwbGF5KTtcbiAgICBpZiAoeTEgPCAwKSB5MSA9IDA7XG4gICAgdmFyIHNjcmVlbnRvcCA9IGNtLmN1ck9wICYmIGNtLmN1ck9wLnNjcm9sbFRvcCAhPSBudWxsID8gY20uY3VyT3Auc2Nyb2xsVG9wIDogZGlzcGxheS5zY3JvbGxlci5zY3JvbGxUb3A7XG4gICAgdmFyIHNjcmVlbiA9IGRpc3BsYXlIZWlnaHQoY20pLCByZXN1bHQgPSB7fTtcbiAgICBpZiAoeTIgLSB5MSA+IHNjcmVlbikgeTIgPSB5MSArIHNjcmVlbjtcbiAgICB2YXIgZG9jQm90dG9tID0gY20uZG9jLmhlaWdodCArIHBhZGRpbmdWZXJ0KGRpc3BsYXkpO1xuICAgIHZhciBhdFRvcCA9IHkxIDwgc25hcE1hcmdpbiwgYXRCb3R0b20gPSB5MiA+IGRvY0JvdHRvbSAtIHNuYXBNYXJnaW47XG4gICAgaWYgKHkxIDwgc2NyZWVudG9wKSB7XG4gICAgICByZXN1bHQuc2Nyb2xsVG9wID0gYXRUb3AgPyAwIDogeTE7XG4gICAgfSBlbHNlIGlmICh5MiA+IHNjcmVlbnRvcCArIHNjcmVlbikge1xuICAgICAgdmFyIG5ld1RvcCA9IE1hdGgubWluKHkxLCAoYXRCb3R0b20gPyBkb2NCb3R0b20gOiB5MikgLSBzY3JlZW4pO1xuICAgICAgaWYgKG5ld1RvcCAhPSBzY3JlZW50b3ApIHJlc3VsdC5zY3JvbGxUb3AgPSBuZXdUb3A7XG4gICAgfVxuXG4gICAgdmFyIHNjcmVlbmxlZnQgPSBjbS5jdXJPcCAmJiBjbS5jdXJPcC5zY3JvbGxMZWZ0ICE9IG51bGwgPyBjbS5jdXJPcC5zY3JvbGxMZWZ0IDogZGlzcGxheS5zY3JvbGxlci5zY3JvbGxMZWZ0O1xuICAgIHZhciBzY3JlZW53ID0gZGlzcGxheVdpZHRoKGNtKSAtIChjbS5vcHRpb25zLmZpeGVkR3V0dGVyID8gZGlzcGxheS5ndXR0ZXJzLm9mZnNldFdpZHRoIDogMCk7XG4gICAgdmFyIHRvb1dpZGUgPSB4MiAtIHgxID4gc2NyZWVudztcbiAgICBpZiAodG9vV2lkZSkgeDIgPSB4MSArIHNjcmVlbnc7XG4gICAgaWYgKHgxIDwgMTApXG4gICAgICByZXN1bHQuc2Nyb2xsTGVmdCA9IDA7XG4gICAgZWxzZSBpZiAoeDEgPCBzY3JlZW5sZWZ0KVxuICAgICAgcmVzdWx0LnNjcm9sbExlZnQgPSBNYXRoLm1heCgwLCB4MSAtICh0b29XaWRlID8gMCA6IDEwKSk7XG4gICAgZWxzZSBpZiAoeDIgPiBzY3JlZW53ICsgc2NyZWVubGVmdCAtIDMpXG4gICAgICByZXN1bHQuc2Nyb2xsTGVmdCA9IHgyICsgKHRvb1dpZGUgPyAwIDogMTApIC0gc2NyZWVudztcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgLy8gU3RvcmUgYSByZWxhdGl2ZSBhZGp1c3RtZW50IHRvIHRoZSBzY3JvbGwgcG9zaXRpb24gaW4gdGhlIGN1cnJlbnRcbiAgLy8gb3BlcmF0aW9uICh0byBiZSBhcHBsaWVkIHdoZW4gdGhlIG9wZXJhdGlvbiBmaW5pc2hlcykuXG4gIGZ1bmN0aW9uIGFkZFRvU2Nyb2xsUG9zKGNtLCBsZWZ0LCB0b3ApIHtcbiAgICBpZiAobGVmdCAhPSBudWxsIHx8IHRvcCAhPSBudWxsKSByZXNvbHZlU2Nyb2xsVG9Qb3MoY20pO1xuICAgIGlmIChsZWZ0ICE9IG51bGwpXG4gICAgICBjbS5jdXJPcC5zY3JvbGxMZWZ0ID0gKGNtLmN1ck9wLnNjcm9sbExlZnQgPT0gbnVsbCA/IGNtLmRvYy5zY3JvbGxMZWZ0IDogY20uY3VyT3Auc2Nyb2xsTGVmdCkgKyBsZWZ0O1xuICAgIGlmICh0b3AgIT0gbnVsbClcbiAgICAgIGNtLmN1ck9wLnNjcm9sbFRvcCA9IChjbS5jdXJPcC5zY3JvbGxUb3AgPT0gbnVsbCA/IGNtLmRvYy5zY3JvbGxUb3AgOiBjbS5jdXJPcC5zY3JvbGxUb3ApICsgdG9wO1xuICB9XG5cbiAgLy8gTWFrZSBzdXJlIHRoYXQgYXQgdGhlIGVuZCBvZiB0aGUgb3BlcmF0aW9uIHRoZSBjdXJyZW50IGN1cnNvciBpc1xuICAvLyBzaG93bi5cbiAgZnVuY3Rpb24gZW5zdXJlQ3Vyc29yVmlzaWJsZShjbSkge1xuICAgIHJlc29sdmVTY3JvbGxUb1BvcyhjbSk7XG4gICAgdmFyIGN1ciA9IGNtLmdldEN1cnNvcigpLCBmcm9tID0gY3VyLCB0byA9IGN1cjtcbiAgICBpZiAoIWNtLm9wdGlvbnMubGluZVdyYXBwaW5nKSB7XG4gICAgICBmcm9tID0gY3VyLmNoID8gUG9zKGN1ci5saW5lLCBjdXIuY2ggLSAxKSA6IGN1cjtcbiAgICAgIHRvID0gUG9zKGN1ci5saW5lLCBjdXIuY2ggKyAxKTtcbiAgICB9XG4gICAgY20uY3VyT3Auc2Nyb2xsVG9Qb3MgPSB7ZnJvbTogZnJvbSwgdG86IHRvLCBtYXJnaW46IGNtLm9wdGlvbnMuY3Vyc29yU2Nyb2xsTWFyZ2luLCBpc0N1cnNvcjogdHJ1ZX07XG4gIH1cblxuICAvLyBXaGVuIGFuIG9wZXJhdGlvbiBoYXMgaXRzIHNjcm9sbFRvUG9zIHByb3BlcnR5IHNldCwgYW5kIGFub3RoZXJcbiAgLy8gc2Nyb2xsIGFjdGlvbiBpcyBhcHBsaWVkIGJlZm9yZSB0aGUgZW5kIG9mIHRoZSBvcGVyYXRpb24sIHRoaXNcbiAgLy8gJ3NpbXVsYXRlcycgc2Nyb2xsaW5nIHRoYXQgcG9zaXRpb24gaW50byB2aWV3IGluIGEgY2hlYXAgd2F5LCBzb1xuICAvLyB0aGF0IHRoZSBlZmZlY3Qgb2YgaW50ZXJtZWRpYXRlIHNjcm9sbCBjb21tYW5kcyBpcyBub3QgaWdub3JlZC5cbiAgZnVuY3Rpb24gcmVzb2x2ZVNjcm9sbFRvUG9zKGNtKSB7XG4gICAgdmFyIHJhbmdlID0gY20uY3VyT3Auc2Nyb2xsVG9Qb3M7XG4gICAgaWYgKHJhbmdlKSB7XG4gICAgICBjbS5jdXJPcC5zY3JvbGxUb1BvcyA9IG51bGw7XG4gICAgICB2YXIgZnJvbSA9IGVzdGltYXRlQ29vcmRzKGNtLCByYW5nZS5mcm9tKSwgdG8gPSBlc3RpbWF0ZUNvb3JkcyhjbSwgcmFuZ2UudG8pO1xuICAgICAgdmFyIHNQb3MgPSBjYWxjdWxhdGVTY3JvbGxQb3MoY20sIE1hdGgubWluKGZyb20ubGVmdCwgdG8ubGVmdCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBNYXRoLm1pbihmcm9tLnRvcCwgdG8udG9wKSAtIHJhbmdlLm1hcmdpbixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1hdGgubWF4KGZyb20ucmlnaHQsIHRvLnJpZ2h0KSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1hdGgubWF4KGZyb20uYm90dG9tLCB0by5ib3R0b20pICsgcmFuZ2UubWFyZ2luKTtcbiAgICAgIGNtLnNjcm9sbFRvKHNQb3Muc2Nyb2xsTGVmdCwgc1Bvcy5zY3JvbGxUb3ApO1xuICAgIH1cbiAgfVxuXG4gIC8vIEFQSSBVVElMSVRJRVNcblxuICAvLyBJbmRlbnQgdGhlIGdpdmVuIGxpbmUuIFRoZSBob3cgcGFyYW1ldGVyIGNhbiBiZSBcInNtYXJ0XCIsXG4gIC8vIFwiYWRkXCIvbnVsbCwgXCJzdWJ0cmFjdFwiLCBvciBcInByZXZcIi4gV2hlbiBhZ2dyZXNzaXZlIGlzIGZhbHNlXG4gIC8vICh0eXBpY2FsbHkgc2V0IHRvIHRydWUgZm9yIGZvcmNlZCBzaW5nbGUtbGluZSBpbmRlbnRzKSwgZW1wdHlcbiAgLy8gbGluZXMgYXJlIG5vdCBpbmRlbnRlZCwgYW5kIHBsYWNlcyB3aGVyZSB0aGUgbW9kZSByZXR1cm5zIFBhc3NcbiAgLy8gYXJlIGxlZnQgYWxvbmUuXG4gIGZ1bmN0aW9uIGluZGVudExpbmUoY20sIG4sIGhvdywgYWdncmVzc2l2ZSkge1xuICAgIHZhciBkb2MgPSBjbS5kb2MsIHN0YXRlO1xuICAgIGlmIChob3cgPT0gbnVsbCkgaG93ID0gXCJhZGRcIjtcbiAgICBpZiAoaG93ID09IFwic21hcnRcIikge1xuICAgICAgLy8gRmFsbCBiYWNrIHRvIFwicHJldlwiIHdoZW4gdGhlIG1vZGUgZG9lc24ndCBoYXZlIGFuIGluZGVudGF0aW9uXG4gICAgICAvLyBtZXRob2QuXG4gICAgICBpZiAoIWRvYy5tb2RlLmluZGVudCkgaG93ID0gXCJwcmV2XCI7XG4gICAgICBlbHNlIHN0YXRlID0gZ2V0U3RhdGVCZWZvcmUoY20sIG4pO1xuICAgIH1cblxuICAgIHZhciB0YWJTaXplID0gY20ub3B0aW9ucy50YWJTaXplO1xuICAgIHZhciBsaW5lID0gZ2V0TGluZShkb2MsIG4pLCBjdXJTcGFjZSA9IGNvdW50Q29sdW1uKGxpbmUudGV4dCwgbnVsbCwgdGFiU2l6ZSk7XG4gICAgaWYgKGxpbmUuc3RhdGVBZnRlcikgbGluZS5zdGF0ZUFmdGVyID0gbnVsbDtcbiAgICB2YXIgY3VyU3BhY2VTdHJpbmcgPSBsaW5lLnRleHQubWF0Y2goL15cXHMqLylbMF0sIGluZGVudGF0aW9uO1xuICAgIGlmICghYWdncmVzc2l2ZSAmJiAhL1xcUy8udGVzdChsaW5lLnRleHQpKSB7XG4gICAgICBpbmRlbnRhdGlvbiA9IDA7XG4gICAgICBob3cgPSBcIm5vdFwiO1xuICAgIH0gZWxzZSBpZiAoaG93ID09IFwic21hcnRcIikge1xuICAgICAgaW5kZW50YXRpb24gPSBkb2MubW9kZS5pbmRlbnQoc3RhdGUsIGxpbmUudGV4dC5zbGljZShjdXJTcGFjZVN0cmluZy5sZW5ndGgpLCBsaW5lLnRleHQpO1xuICAgICAgaWYgKGluZGVudGF0aW9uID09IFBhc3MgfHwgaW5kZW50YXRpb24gPiAxNTApIHtcbiAgICAgICAgaWYgKCFhZ2dyZXNzaXZlKSByZXR1cm47XG4gICAgICAgIGhvdyA9IFwicHJldlwiO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoaG93ID09IFwicHJldlwiKSB7XG4gICAgICBpZiAobiA+IGRvYy5maXJzdCkgaW5kZW50YXRpb24gPSBjb3VudENvbHVtbihnZXRMaW5lKGRvYywgbi0xKS50ZXh0LCBudWxsLCB0YWJTaXplKTtcbiAgICAgIGVsc2UgaW5kZW50YXRpb24gPSAwO1xuICAgIH0gZWxzZSBpZiAoaG93ID09IFwiYWRkXCIpIHtcbiAgICAgIGluZGVudGF0aW9uID0gY3VyU3BhY2UgKyBjbS5vcHRpb25zLmluZGVudFVuaXQ7XG4gICAgfSBlbHNlIGlmIChob3cgPT0gXCJzdWJ0cmFjdFwiKSB7XG4gICAgICBpbmRlbnRhdGlvbiA9IGN1clNwYWNlIC0gY20ub3B0aW9ucy5pbmRlbnRVbml0O1xuICAgIH0gZWxzZSBpZiAodHlwZW9mIGhvdyA9PSBcIm51bWJlclwiKSB7XG4gICAgICBpbmRlbnRhdGlvbiA9IGN1clNwYWNlICsgaG93O1xuICAgIH1cbiAgICBpbmRlbnRhdGlvbiA9IE1hdGgubWF4KDAsIGluZGVudGF0aW9uKTtcblxuICAgIHZhciBpbmRlbnRTdHJpbmcgPSBcIlwiLCBwb3MgPSAwO1xuICAgIGlmIChjbS5vcHRpb25zLmluZGVudFdpdGhUYWJzKVxuICAgICAgZm9yICh2YXIgaSA9IE1hdGguZmxvb3IoaW5kZW50YXRpb24gLyB0YWJTaXplKTsgaTsgLS1pKSB7cG9zICs9IHRhYlNpemU7IGluZGVudFN0cmluZyArPSBcIlxcdFwiO31cbiAgICBpZiAocG9zIDwgaW5kZW50YXRpb24pIGluZGVudFN0cmluZyArPSBzcGFjZVN0cihpbmRlbnRhdGlvbiAtIHBvcyk7XG5cbiAgICBpZiAoaW5kZW50U3RyaW5nICE9IGN1clNwYWNlU3RyaW5nKSB7XG4gICAgICByZXBsYWNlUmFuZ2UoZG9jLCBpbmRlbnRTdHJpbmcsIFBvcyhuLCAwKSwgUG9zKG4sIGN1clNwYWNlU3RyaW5nLmxlbmd0aCksIFwiK2lucHV0XCIpO1xuICAgICAgbGluZS5zdGF0ZUFmdGVyID0gbnVsbDtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBFbnN1cmUgdGhhdCwgaWYgdGhlIGN1cnNvciB3YXMgaW4gdGhlIHdoaXRlc3BhY2UgYXQgdGhlIHN0YXJ0XG4gICAgICAvLyBvZiB0aGUgbGluZSwgaXQgaXMgbW92ZWQgdG8gdGhlIGVuZCBvZiB0aGF0IHNwYWNlLlxuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkb2Muc2VsLnJhbmdlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICB2YXIgcmFuZ2UgPSBkb2Muc2VsLnJhbmdlc1tpXTtcbiAgICAgICAgaWYgKHJhbmdlLmhlYWQubGluZSA9PSBuICYmIHJhbmdlLmhlYWQuY2ggPCBjdXJTcGFjZVN0cmluZy5sZW5ndGgpIHtcbiAgICAgICAgICB2YXIgcG9zID0gUG9zKG4sIGN1clNwYWNlU3RyaW5nLmxlbmd0aCk7XG4gICAgICAgICAgcmVwbGFjZU9uZVNlbGVjdGlvbihkb2MsIGksIG5ldyBSYW5nZShwb3MsIHBvcykpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLy8gVXRpbGl0eSBmb3IgYXBwbHlpbmcgYSBjaGFuZ2UgdG8gYSBsaW5lIGJ5IGhhbmRsZSBvciBudW1iZXIsXG4gIC8vIHJldHVybmluZyB0aGUgbnVtYmVyIGFuZCBvcHRpb25hbGx5IHJlZ2lzdGVyaW5nIHRoZSBsaW5lIGFzXG4gIC8vIGNoYW5nZWQuXG4gIGZ1bmN0aW9uIGNoYW5nZUxpbmUoZG9jLCBoYW5kbGUsIGNoYW5nZVR5cGUsIG9wKSB7XG4gICAgdmFyIG5vID0gaGFuZGxlLCBsaW5lID0gaGFuZGxlO1xuICAgIGlmICh0eXBlb2YgaGFuZGxlID09IFwibnVtYmVyXCIpIGxpbmUgPSBnZXRMaW5lKGRvYywgY2xpcExpbmUoZG9jLCBoYW5kbGUpKTtcbiAgICBlbHNlIG5vID0gbGluZU5vKGhhbmRsZSk7XG4gICAgaWYgKG5vID09IG51bGwpIHJldHVybiBudWxsO1xuICAgIGlmIChvcChsaW5lLCBubykgJiYgZG9jLmNtKSByZWdMaW5lQ2hhbmdlKGRvYy5jbSwgbm8sIGNoYW5nZVR5cGUpO1xuICAgIHJldHVybiBsaW5lO1xuICB9XG5cbiAgLy8gSGVscGVyIGZvciBkZWxldGluZyB0ZXh0IG5lYXIgdGhlIHNlbGVjdGlvbihzKSwgdXNlZCB0byBpbXBsZW1lbnRcbiAgLy8gYmFja3NwYWNlLCBkZWxldGUsIGFuZCBzaW1pbGFyIGZ1bmN0aW9uYWxpdHkuXG4gIGZ1bmN0aW9uIGRlbGV0ZU5lYXJTZWxlY3Rpb24oY20sIGNvbXB1dGUpIHtcbiAgICB2YXIgcmFuZ2VzID0gY20uZG9jLnNlbC5yYW5nZXMsIGtpbGwgPSBbXTtcbiAgICAvLyBCdWlsZCB1cCBhIHNldCBvZiByYW5nZXMgdG8ga2lsbCBmaXJzdCwgbWVyZ2luZyBvdmVybGFwcGluZ1xuICAgIC8vIHJhbmdlcy5cbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJhbmdlcy5sZW5ndGg7IGkrKykge1xuICAgICAgdmFyIHRvS2lsbCA9IGNvbXB1dGUocmFuZ2VzW2ldKTtcbiAgICAgIHdoaWxlIChraWxsLmxlbmd0aCAmJiBjbXAodG9LaWxsLmZyb20sIGxzdChraWxsKS50bykgPD0gMCkge1xuICAgICAgICB2YXIgcmVwbGFjZWQgPSBraWxsLnBvcCgpO1xuICAgICAgICBpZiAoY21wKHJlcGxhY2VkLmZyb20sIHRvS2lsbC5mcm9tKSA8IDApIHtcbiAgICAgICAgICB0b0tpbGwuZnJvbSA9IHJlcGxhY2VkLmZyb207XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGtpbGwucHVzaCh0b0tpbGwpO1xuICAgIH1cbiAgICAvLyBOZXh0LCByZW1vdmUgdGhvc2UgYWN0dWFsIHJhbmdlcy5cbiAgICBydW5Jbk9wKGNtLCBmdW5jdGlvbigpIHtcbiAgICAgIGZvciAodmFyIGkgPSBraWxsLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKVxuICAgICAgICByZXBsYWNlUmFuZ2UoY20uZG9jLCBcIlwiLCBraWxsW2ldLmZyb20sIGtpbGxbaV0udG8sIFwiK2RlbGV0ZVwiKTtcbiAgICAgIGVuc3VyZUN1cnNvclZpc2libGUoY20pO1xuICAgIH0pO1xuICB9XG5cbiAgLy8gVXNlZCBmb3IgaG9yaXpvbnRhbCByZWxhdGl2ZSBtb3Rpb24uIERpciBpcyAtMSBvciAxIChsZWZ0IG9yXG4gIC8vIHJpZ2h0KSwgdW5pdCBjYW4gYmUgXCJjaGFyXCIsIFwiY29sdW1uXCIgKGxpa2UgY2hhciwgYnV0IGRvZXNuJ3RcbiAgLy8gY3Jvc3MgbGluZSBib3VuZGFyaWVzKSwgXCJ3b3JkXCIgKGFjcm9zcyBuZXh0IHdvcmQpLCBvciBcImdyb3VwXCIgKHRvXG4gIC8vIHRoZSBzdGFydCBvZiBuZXh0IGdyb3VwIG9mIHdvcmQgb3Igbm9uLXdvcmQtbm9uLXdoaXRlc3BhY2VcbiAgLy8gY2hhcnMpLiBUaGUgdmlzdWFsbHkgcGFyYW0gY29udHJvbHMgd2hldGhlciwgaW4gcmlnaHQtdG8tbGVmdFxuICAvLyB0ZXh0LCBkaXJlY3Rpb24gMSBtZWFucyB0byBtb3ZlIHRvd2FyZHMgdGhlIG5leHQgaW5kZXggaW4gdGhlXG4gIC8vIHN0cmluZywgb3IgdG93YXJkcyB0aGUgY2hhcmFjdGVyIHRvIHRoZSByaWdodCBvZiB0aGUgY3VycmVudFxuICAvLyBwb3NpdGlvbi4gVGhlIHJlc3VsdGluZyBwb3NpdGlvbiB3aWxsIGhhdmUgYSBoaXRTaWRlPXRydWVcbiAgLy8gcHJvcGVydHkgaWYgaXQgcmVhY2hlZCB0aGUgZW5kIG9mIHRoZSBkb2N1bWVudC5cbiAgZnVuY3Rpb24gZmluZFBvc0goZG9jLCBwb3MsIGRpciwgdW5pdCwgdmlzdWFsbHkpIHtcbiAgICB2YXIgbGluZSA9IHBvcy5saW5lLCBjaCA9IHBvcy5jaCwgb3JpZ0RpciA9IGRpcjtcbiAgICB2YXIgbGluZU9iaiA9IGdldExpbmUoZG9jLCBsaW5lKTtcbiAgICBmdW5jdGlvbiBmaW5kTmV4dExpbmUoKSB7XG4gICAgICB2YXIgbCA9IGxpbmUgKyBkaXI7XG4gICAgICBpZiAobCA8IGRvYy5maXJzdCB8fCBsID49IGRvYy5maXJzdCArIGRvYy5zaXplKSByZXR1cm4gZmFsc2VcbiAgICAgIGxpbmUgPSBsO1xuICAgICAgcmV0dXJuIGxpbmVPYmogPSBnZXRMaW5lKGRvYywgbCk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIG1vdmVPbmNlKGJvdW5kVG9MaW5lKSB7XG4gICAgICB2YXIgbmV4dCA9ICh2aXN1YWxseSA/IG1vdmVWaXN1YWxseSA6IG1vdmVMb2dpY2FsbHkpKGxpbmVPYmosIGNoLCBkaXIsIHRydWUpO1xuICAgICAgaWYgKG5leHQgPT0gbnVsbCkge1xuICAgICAgICBpZiAoIWJvdW5kVG9MaW5lICYmIGZpbmROZXh0TGluZSgpKSB7XG4gICAgICAgICAgaWYgKHZpc3VhbGx5KSBjaCA9IChkaXIgPCAwID8gbGluZVJpZ2h0IDogbGluZUxlZnQpKGxpbmVPYmopO1xuICAgICAgICAgIGVsc2UgY2ggPSBkaXIgPCAwID8gbGluZU9iai50ZXh0Lmxlbmd0aCA6IDA7XG4gICAgICAgIH0gZWxzZSByZXR1cm4gZmFsc2VcbiAgICAgIH0gZWxzZSBjaCA9IG5leHQ7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICBpZiAodW5pdCA9PSBcImNoYXJcIikge1xuICAgICAgbW92ZU9uY2UoKVxuICAgIH0gZWxzZSBpZiAodW5pdCA9PSBcImNvbHVtblwiKSB7XG4gICAgICBtb3ZlT25jZSh0cnVlKVxuICAgIH0gZWxzZSBpZiAodW5pdCA9PSBcIndvcmRcIiB8fCB1bml0ID09IFwiZ3JvdXBcIikge1xuICAgICAgdmFyIHNhd1R5cGUgPSBudWxsLCBncm91cCA9IHVuaXQgPT0gXCJncm91cFwiO1xuICAgICAgdmFyIGhlbHBlciA9IGRvYy5jbSAmJiBkb2MuY20uZ2V0SGVscGVyKHBvcywgXCJ3b3JkQ2hhcnNcIik7XG4gICAgICBmb3IgKHZhciBmaXJzdCA9IHRydWU7OyBmaXJzdCA9IGZhbHNlKSB7XG4gICAgICAgIGlmIChkaXIgPCAwICYmICFtb3ZlT25jZSghZmlyc3QpKSBicmVhaztcbiAgICAgICAgdmFyIGN1ciA9IGxpbmVPYmoudGV4dC5jaGFyQXQoY2gpIHx8IFwiXFxuXCI7XG4gICAgICAgIHZhciB0eXBlID0gaXNXb3JkQ2hhcihjdXIsIGhlbHBlcikgPyBcIndcIlxuICAgICAgICAgIDogZ3JvdXAgJiYgY3VyID09IFwiXFxuXCIgPyBcIm5cIlxuICAgICAgICAgIDogIWdyb3VwIHx8IC9cXHMvLnRlc3QoY3VyKSA/IG51bGxcbiAgICAgICAgICA6IFwicFwiO1xuICAgICAgICBpZiAoZ3JvdXAgJiYgIWZpcnN0ICYmICF0eXBlKSB0eXBlID0gXCJzXCI7XG4gICAgICAgIGlmIChzYXdUeXBlICYmIHNhd1R5cGUgIT0gdHlwZSkge1xuICAgICAgICAgIGlmIChkaXIgPCAwKSB7ZGlyID0gMTsgbW92ZU9uY2UoKTt9XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodHlwZSkgc2F3VHlwZSA9IHR5cGU7XG4gICAgICAgIGlmIChkaXIgPiAwICYmICFtb3ZlT25jZSghZmlyc3QpKSBicmVhaztcbiAgICAgIH1cbiAgICB9XG4gICAgdmFyIHJlc3VsdCA9IHNraXBBdG9taWMoZG9jLCBQb3MobGluZSwgY2gpLCBwb3MsIG9yaWdEaXIsIHRydWUpO1xuICAgIGlmICghY21wKHBvcywgcmVzdWx0KSkgcmVzdWx0LmhpdFNpZGUgPSB0cnVlO1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICAvLyBGb3IgcmVsYXRpdmUgdmVydGljYWwgbW92ZW1lbnQuIERpciBtYXkgYmUgLTEgb3IgMS4gVW5pdCBjYW4gYmVcbiAgLy8gXCJwYWdlXCIgb3IgXCJsaW5lXCIuIFRoZSByZXN1bHRpbmcgcG9zaXRpb24gd2lsbCBoYXZlIGEgaGl0U2lkZT10cnVlXG4gIC8vIHByb3BlcnR5IGlmIGl0IHJlYWNoZWQgdGhlIGVuZCBvZiB0aGUgZG9jdW1lbnQuXG4gIGZ1bmN0aW9uIGZpbmRQb3NWKGNtLCBwb3MsIGRpciwgdW5pdCkge1xuICAgIHZhciBkb2MgPSBjbS5kb2MsIHggPSBwb3MubGVmdCwgeTtcbiAgICBpZiAodW5pdCA9PSBcInBhZ2VcIikge1xuICAgICAgdmFyIHBhZ2VTaXplID0gTWF0aC5taW4oY20uZGlzcGxheS53cmFwcGVyLmNsaWVudEhlaWdodCwgd2luZG93LmlubmVySGVpZ2h0IHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQpO1xuICAgICAgeSA9IHBvcy50b3AgKyBkaXIgKiAocGFnZVNpemUgLSAoZGlyIDwgMCA/IDEuNSA6IC41KSAqIHRleHRIZWlnaHQoY20uZGlzcGxheSkpO1xuICAgIH0gZWxzZSBpZiAodW5pdCA9PSBcImxpbmVcIikge1xuICAgICAgeSA9IGRpciA+IDAgPyBwb3MuYm90dG9tICsgMyA6IHBvcy50b3AgLSAzO1xuICAgIH1cbiAgICBmb3IgKDs7KSB7XG4gICAgICB2YXIgdGFyZ2V0ID0gY29vcmRzQ2hhcihjbSwgeCwgeSk7XG4gICAgICBpZiAoIXRhcmdldC5vdXRzaWRlKSBicmVhaztcbiAgICAgIGlmIChkaXIgPCAwID8geSA8PSAwIDogeSA+PSBkb2MuaGVpZ2h0KSB7IHRhcmdldC5oaXRTaWRlID0gdHJ1ZTsgYnJlYWs7IH1cbiAgICAgIHkgKz0gZGlyICogNTtcbiAgICB9XG4gICAgcmV0dXJuIHRhcmdldDtcbiAgfVxuXG4gIC8vIEVESVRPUiBNRVRIT0RTXG5cbiAgLy8gVGhlIHB1YmxpY2x5IHZpc2libGUgQVBJLiBOb3RlIHRoYXQgbWV0aG9kT3AoZikgbWVhbnNcbiAgLy8gJ3dyYXAgZiBpbiBhbiBvcGVyYXRpb24sIHBlcmZvcm1lZCBvbiBpdHMgYHRoaXNgIHBhcmFtZXRlcicuXG5cbiAgLy8gVGhpcyBpcyBub3QgdGhlIGNvbXBsZXRlIHNldCBvZiBlZGl0b3IgbWV0aG9kcy4gTW9zdCBvZiB0aGVcbiAgLy8gbWV0aG9kcyBkZWZpbmVkIG9uIHRoZSBEb2MgdHlwZSBhcmUgYWxzbyBpbmplY3RlZCBpbnRvXG4gIC8vIENvZGVNaXJyb3IucHJvdG90eXBlLCBmb3IgYmFja3dhcmRzIGNvbXBhdGliaWxpdHkgYW5kXG4gIC8vIGNvbnZlbmllbmNlLlxuXG4gIENvZGVNaXJyb3IucHJvdG90eXBlID0ge1xuICAgIGNvbnN0cnVjdG9yOiBDb2RlTWlycm9yLFxuICAgIGZvY3VzOiBmdW5jdGlvbigpe3dpbmRvdy5mb2N1cygpOyB0aGlzLmRpc3BsYXkuaW5wdXQuZm9jdXMoKTt9LFxuXG4gICAgc2V0T3B0aW9uOiBmdW5jdGlvbihvcHRpb24sIHZhbHVlKSB7XG4gICAgICB2YXIgb3B0aW9ucyA9IHRoaXMub3B0aW9ucywgb2xkID0gb3B0aW9uc1tvcHRpb25dO1xuICAgICAgaWYgKG9wdGlvbnNbb3B0aW9uXSA9PSB2YWx1ZSAmJiBvcHRpb24gIT0gXCJtb2RlXCIpIHJldHVybjtcbiAgICAgIG9wdGlvbnNbb3B0aW9uXSA9IHZhbHVlO1xuICAgICAgaWYgKG9wdGlvbkhhbmRsZXJzLmhhc093blByb3BlcnR5KG9wdGlvbikpXG4gICAgICAgIG9wZXJhdGlvbih0aGlzLCBvcHRpb25IYW5kbGVyc1tvcHRpb25dKSh0aGlzLCB2YWx1ZSwgb2xkKTtcbiAgICB9LFxuXG4gICAgZ2V0T3B0aW9uOiBmdW5jdGlvbihvcHRpb24pIHtyZXR1cm4gdGhpcy5vcHRpb25zW29wdGlvbl07fSxcbiAgICBnZXREb2M6IGZ1bmN0aW9uKCkge3JldHVybiB0aGlzLmRvYzt9LFxuXG4gICAgYWRkS2V5TWFwOiBmdW5jdGlvbihtYXAsIGJvdHRvbSkge1xuICAgICAgdGhpcy5zdGF0ZS5rZXlNYXBzW2JvdHRvbSA/IFwicHVzaFwiIDogXCJ1bnNoaWZ0XCJdKGdldEtleU1hcChtYXApKTtcbiAgICB9LFxuICAgIHJlbW92ZUtleU1hcDogZnVuY3Rpb24obWFwKSB7XG4gICAgICB2YXIgbWFwcyA9IHRoaXMuc3RhdGUua2V5TWFwcztcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbWFwcy5sZW5ndGg7ICsraSlcbiAgICAgICAgaWYgKG1hcHNbaV0gPT0gbWFwIHx8IG1hcHNbaV0ubmFtZSA9PSBtYXApIHtcbiAgICAgICAgICBtYXBzLnNwbGljZShpLCAxKTtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBhZGRPdmVybGF5OiBtZXRob2RPcChmdW5jdGlvbihzcGVjLCBvcHRpb25zKSB7XG4gICAgICB2YXIgbW9kZSA9IHNwZWMudG9rZW4gPyBzcGVjIDogQ29kZU1pcnJvci5nZXRNb2RlKHRoaXMub3B0aW9ucywgc3BlYyk7XG4gICAgICBpZiAobW9kZS5zdGFydFN0YXRlKSB0aHJvdyBuZXcgRXJyb3IoXCJPdmVybGF5cyBtYXkgbm90IGJlIHN0YXRlZnVsLlwiKTtcbiAgICAgIHRoaXMuc3RhdGUub3ZlcmxheXMucHVzaCh7bW9kZTogbW9kZSwgbW9kZVNwZWM6IHNwZWMsIG9wYXF1ZTogb3B0aW9ucyAmJiBvcHRpb25zLm9wYXF1ZX0pO1xuICAgICAgdGhpcy5zdGF0ZS5tb2RlR2VuKys7XG4gICAgICByZWdDaGFuZ2UodGhpcyk7XG4gICAgfSksXG4gICAgcmVtb3ZlT3ZlcmxheTogbWV0aG9kT3AoZnVuY3Rpb24oc3BlYykge1xuICAgICAgdmFyIG92ZXJsYXlzID0gdGhpcy5zdGF0ZS5vdmVybGF5cztcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb3ZlcmxheXMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgdmFyIGN1ciA9IG92ZXJsYXlzW2ldLm1vZGVTcGVjO1xuICAgICAgICBpZiAoY3VyID09IHNwZWMgfHwgdHlwZW9mIHNwZWMgPT0gXCJzdHJpbmdcIiAmJiBjdXIubmFtZSA9PSBzcGVjKSB7XG4gICAgICAgICAgb3ZlcmxheXMuc3BsaWNlKGksIDEpO1xuICAgICAgICAgIHRoaXMuc3RhdGUubW9kZUdlbisrO1xuICAgICAgICAgIHJlZ0NoYW5nZSh0aGlzKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KSxcblxuICAgIGluZGVudExpbmU6IG1ldGhvZE9wKGZ1bmN0aW9uKG4sIGRpciwgYWdncmVzc2l2ZSkge1xuICAgICAgaWYgKHR5cGVvZiBkaXIgIT0gXCJzdHJpbmdcIiAmJiB0eXBlb2YgZGlyICE9IFwibnVtYmVyXCIpIHtcbiAgICAgICAgaWYgKGRpciA9PSBudWxsKSBkaXIgPSB0aGlzLm9wdGlvbnMuc21hcnRJbmRlbnQgPyBcInNtYXJ0XCIgOiBcInByZXZcIjtcbiAgICAgICAgZWxzZSBkaXIgPSBkaXIgPyBcImFkZFwiIDogXCJzdWJ0cmFjdFwiO1xuICAgICAgfVxuICAgICAgaWYgKGlzTGluZSh0aGlzLmRvYywgbikpIGluZGVudExpbmUodGhpcywgbiwgZGlyLCBhZ2dyZXNzaXZlKTtcbiAgICB9KSxcbiAgICBpbmRlbnRTZWxlY3Rpb246IG1ldGhvZE9wKGZ1bmN0aW9uKGhvdykge1xuICAgICAgdmFyIHJhbmdlcyA9IHRoaXMuZG9jLnNlbC5yYW5nZXMsIGVuZCA9IC0xO1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCByYW5nZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgdmFyIHJhbmdlID0gcmFuZ2VzW2ldO1xuICAgICAgICBpZiAoIXJhbmdlLmVtcHR5KCkpIHtcbiAgICAgICAgICB2YXIgZnJvbSA9IHJhbmdlLmZyb20oKSwgdG8gPSByYW5nZS50bygpO1xuICAgICAgICAgIHZhciBzdGFydCA9IE1hdGgubWF4KGVuZCwgZnJvbS5saW5lKTtcbiAgICAgICAgICBlbmQgPSBNYXRoLm1pbih0aGlzLmxhc3RMaW5lKCksIHRvLmxpbmUgLSAodG8uY2ggPyAwIDogMSkpICsgMTtcbiAgICAgICAgICBmb3IgKHZhciBqID0gc3RhcnQ7IGogPCBlbmQ7ICsrailcbiAgICAgICAgICAgIGluZGVudExpbmUodGhpcywgaiwgaG93KTtcbiAgICAgICAgICB2YXIgbmV3UmFuZ2VzID0gdGhpcy5kb2Muc2VsLnJhbmdlcztcbiAgICAgICAgICBpZiAoZnJvbS5jaCA9PSAwICYmIHJhbmdlcy5sZW5ndGggPT0gbmV3UmFuZ2VzLmxlbmd0aCAmJiBuZXdSYW5nZXNbaV0uZnJvbSgpLmNoID4gMClcbiAgICAgICAgICAgIHJlcGxhY2VPbmVTZWxlY3Rpb24odGhpcy5kb2MsIGksIG5ldyBSYW5nZShmcm9tLCBuZXdSYW5nZXNbaV0udG8oKSksIHNlbF9kb250U2Nyb2xsKTtcbiAgICAgICAgfSBlbHNlIGlmIChyYW5nZS5oZWFkLmxpbmUgPiBlbmQpIHtcbiAgICAgICAgICBpbmRlbnRMaW5lKHRoaXMsIHJhbmdlLmhlYWQubGluZSwgaG93LCB0cnVlKTtcbiAgICAgICAgICBlbmQgPSByYW5nZS5oZWFkLmxpbmU7XG4gICAgICAgICAgaWYgKGkgPT0gdGhpcy5kb2Muc2VsLnByaW1JbmRleCkgZW5zdXJlQ3Vyc29yVmlzaWJsZSh0aGlzKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pLFxuXG4gICAgLy8gRmV0Y2ggdGhlIHBhcnNlciB0b2tlbiBmb3IgYSBnaXZlbiBjaGFyYWN0ZXIuIFVzZWZ1bCBmb3IgaGFja3NcbiAgICAvLyB0aGF0IHdhbnQgdG8gaW5zcGVjdCB0aGUgbW9kZSBzdGF0ZSAoc2F5LCBmb3IgY29tcGxldGlvbikuXG4gICAgZ2V0VG9rZW5BdDogZnVuY3Rpb24ocG9zLCBwcmVjaXNlKSB7XG4gICAgICByZXR1cm4gdGFrZVRva2VuKHRoaXMsIHBvcywgcHJlY2lzZSk7XG4gICAgfSxcblxuICAgIGdldExpbmVUb2tlbnM6IGZ1bmN0aW9uKGxpbmUsIHByZWNpc2UpIHtcbiAgICAgIHJldHVybiB0YWtlVG9rZW4odGhpcywgUG9zKGxpbmUpLCBwcmVjaXNlLCB0cnVlKTtcbiAgICB9LFxuXG4gICAgZ2V0VG9rZW5UeXBlQXQ6IGZ1bmN0aW9uKHBvcykge1xuICAgICAgcG9zID0gY2xpcFBvcyh0aGlzLmRvYywgcG9zKTtcbiAgICAgIHZhciBzdHlsZXMgPSBnZXRMaW5lU3R5bGVzKHRoaXMsIGdldExpbmUodGhpcy5kb2MsIHBvcy5saW5lKSk7XG4gICAgICB2YXIgYmVmb3JlID0gMCwgYWZ0ZXIgPSAoc3R5bGVzLmxlbmd0aCAtIDEpIC8gMiwgY2ggPSBwb3MuY2g7XG4gICAgICB2YXIgdHlwZTtcbiAgICAgIGlmIChjaCA9PSAwKSB0eXBlID0gc3R5bGVzWzJdO1xuICAgICAgZWxzZSBmb3IgKDs7KSB7XG4gICAgICAgIHZhciBtaWQgPSAoYmVmb3JlICsgYWZ0ZXIpID4+IDE7XG4gICAgICAgIGlmICgobWlkID8gc3R5bGVzW21pZCAqIDIgLSAxXSA6IDApID49IGNoKSBhZnRlciA9IG1pZDtcbiAgICAgICAgZWxzZSBpZiAoc3R5bGVzW21pZCAqIDIgKyAxXSA8IGNoKSBiZWZvcmUgPSBtaWQgKyAxO1xuICAgICAgICBlbHNlIHsgdHlwZSA9IHN0eWxlc1ttaWQgKiAyICsgMl07IGJyZWFrOyB9XG4gICAgICB9XG4gICAgICB2YXIgY3V0ID0gdHlwZSA/IHR5cGUuaW5kZXhPZihcImNtLW92ZXJsYXkgXCIpIDogLTE7XG4gICAgICByZXR1cm4gY3V0IDwgMCA/IHR5cGUgOiBjdXQgPT0gMCA/IG51bGwgOiB0eXBlLnNsaWNlKDAsIGN1dCAtIDEpO1xuICAgIH0sXG5cbiAgICBnZXRNb2RlQXQ6IGZ1bmN0aW9uKHBvcykge1xuICAgICAgdmFyIG1vZGUgPSB0aGlzLmRvYy5tb2RlO1xuICAgICAgaWYgKCFtb2RlLmlubmVyTW9kZSkgcmV0dXJuIG1vZGU7XG4gICAgICByZXR1cm4gQ29kZU1pcnJvci5pbm5lck1vZGUobW9kZSwgdGhpcy5nZXRUb2tlbkF0KHBvcykuc3RhdGUpLm1vZGU7XG4gICAgfSxcblxuICAgIGdldEhlbHBlcjogZnVuY3Rpb24ocG9zLCB0eXBlKSB7XG4gICAgICByZXR1cm4gdGhpcy5nZXRIZWxwZXJzKHBvcywgdHlwZSlbMF07XG4gICAgfSxcblxuICAgIGdldEhlbHBlcnM6IGZ1bmN0aW9uKHBvcywgdHlwZSkge1xuICAgICAgdmFyIGZvdW5kID0gW107XG4gICAgICBpZiAoIWhlbHBlcnMuaGFzT3duUHJvcGVydHkodHlwZSkpIHJldHVybiBmb3VuZDtcbiAgICAgIHZhciBoZWxwID0gaGVscGVyc1t0eXBlXSwgbW9kZSA9IHRoaXMuZ2V0TW9kZUF0KHBvcyk7XG4gICAgICBpZiAodHlwZW9mIG1vZGVbdHlwZV0gPT0gXCJzdHJpbmdcIikge1xuICAgICAgICBpZiAoaGVscFttb2RlW3R5cGVdXSkgZm91bmQucHVzaChoZWxwW21vZGVbdHlwZV1dKTtcbiAgICAgIH0gZWxzZSBpZiAobW9kZVt0eXBlXSkge1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG1vZGVbdHlwZV0ubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICB2YXIgdmFsID0gaGVscFttb2RlW3R5cGVdW2ldXTtcbiAgICAgICAgICBpZiAodmFsKSBmb3VuZC5wdXNoKHZhbCk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAobW9kZS5oZWxwZXJUeXBlICYmIGhlbHBbbW9kZS5oZWxwZXJUeXBlXSkge1xuICAgICAgICBmb3VuZC5wdXNoKGhlbHBbbW9kZS5oZWxwZXJUeXBlXSk7XG4gICAgICB9IGVsc2UgaWYgKGhlbHBbbW9kZS5uYW1lXSkge1xuICAgICAgICBmb3VuZC5wdXNoKGhlbHBbbW9kZS5uYW1lXSk7XG4gICAgICB9XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGhlbHAuX2dsb2JhbC5sZW5ndGg7IGkrKykge1xuICAgICAgICB2YXIgY3VyID0gaGVscC5fZ2xvYmFsW2ldO1xuICAgICAgICBpZiAoY3VyLnByZWQobW9kZSwgdGhpcykgJiYgaW5kZXhPZihmb3VuZCwgY3VyLnZhbCkgPT0gLTEpXG4gICAgICAgICAgZm91bmQucHVzaChjdXIudmFsKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBmb3VuZDtcbiAgICB9LFxuXG4gICAgZ2V0U3RhdGVBZnRlcjogZnVuY3Rpb24obGluZSwgcHJlY2lzZSkge1xuICAgICAgdmFyIGRvYyA9IHRoaXMuZG9jO1xuICAgICAgbGluZSA9IGNsaXBMaW5lKGRvYywgbGluZSA9PSBudWxsID8gZG9jLmZpcnN0ICsgZG9jLnNpemUgLSAxOiBsaW5lKTtcbiAgICAgIHJldHVybiBnZXRTdGF0ZUJlZm9yZSh0aGlzLCBsaW5lICsgMSwgcHJlY2lzZSk7XG4gICAgfSxcblxuICAgIGN1cnNvckNvb3JkczogZnVuY3Rpb24oc3RhcnQsIG1vZGUpIHtcbiAgICAgIHZhciBwb3MsIHJhbmdlID0gdGhpcy5kb2Muc2VsLnByaW1hcnkoKTtcbiAgICAgIGlmIChzdGFydCA9PSBudWxsKSBwb3MgPSByYW5nZS5oZWFkO1xuICAgICAgZWxzZSBpZiAodHlwZW9mIHN0YXJ0ID09IFwib2JqZWN0XCIpIHBvcyA9IGNsaXBQb3ModGhpcy5kb2MsIHN0YXJ0KTtcbiAgICAgIGVsc2UgcG9zID0gc3RhcnQgPyByYW5nZS5mcm9tKCkgOiByYW5nZS50bygpO1xuICAgICAgcmV0dXJuIGN1cnNvckNvb3Jkcyh0aGlzLCBwb3MsIG1vZGUgfHwgXCJwYWdlXCIpO1xuICAgIH0sXG5cbiAgICBjaGFyQ29vcmRzOiBmdW5jdGlvbihwb3MsIG1vZGUpIHtcbiAgICAgIHJldHVybiBjaGFyQ29vcmRzKHRoaXMsIGNsaXBQb3ModGhpcy5kb2MsIHBvcyksIG1vZGUgfHwgXCJwYWdlXCIpO1xuICAgIH0sXG5cbiAgICBjb29yZHNDaGFyOiBmdW5jdGlvbihjb29yZHMsIG1vZGUpIHtcbiAgICAgIGNvb3JkcyA9IGZyb21Db29yZFN5c3RlbSh0aGlzLCBjb29yZHMsIG1vZGUgfHwgXCJwYWdlXCIpO1xuICAgICAgcmV0dXJuIGNvb3Jkc0NoYXIodGhpcywgY29vcmRzLmxlZnQsIGNvb3Jkcy50b3ApO1xuICAgIH0sXG5cbiAgICBsaW5lQXRIZWlnaHQ6IGZ1bmN0aW9uKGhlaWdodCwgbW9kZSkge1xuICAgICAgaGVpZ2h0ID0gZnJvbUNvb3JkU3lzdGVtKHRoaXMsIHt0b3A6IGhlaWdodCwgbGVmdDogMH0sIG1vZGUgfHwgXCJwYWdlXCIpLnRvcDtcbiAgICAgIHJldHVybiBsaW5lQXRIZWlnaHQodGhpcy5kb2MsIGhlaWdodCArIHRoaXMuZGlzcGxheS52aWV3T2Zmc2V0KTtcbiAgICB9LFxuICAgIGhlaWdodEF0TGluZTogZnVuY3Rpb24obGluZSwgbW9kZSkge1xuICAgICAgdmFyIGVuZCA9IGZhbHNlLCBsaW5lT2JqO1xuICAgICAgaWYgKHR5cGVvZiBsaW5lID09IFwibnVtYmVyXCIpIHtcbiAgICAgICAgdmFyIGxhc3QgPSB0aGlzLmRvYy5maXJzdCArIHRoaXMuZG9jLnNpemUgLSAxO1xuICAgICAgICBpZiAobGluZSA8IHRoaXMuZG9jLmZpcnN0KSBsaW5lID0gdGhpcy5kb2MuZmlyc3Q7XG4gICAgICAgIGVsc2UgaWYgKGxpbmUgPiBsYXN0KSB7IGxpbmUgPSBsYXN0OyBlbmQgPSB0cnVlOyB9XG4gICAgICAgIGxpbmVPYmogPSBnZXRMaW5lKHRoaXMuZG9jLCBsaW5lKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGxpbmVPYmogPSBsaW5lO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGludG9Db29yZFN5c3RlbSh0aGlzLCBsaW5lT2JqLCB7dG9wOiAwLCBsZWZ0OiAwfSwgbW9kZSB8fCBcInBhZ2VcIikudG9wICtcbiAgICAgICAgKGVuZCA/IHRoaXMuZG9jLmhlaWdodCAtIGhlaWdodEF0TGluZShsaW5lT2JqKSA6IDApO1xuICAgIH0sXG5cbiAgICBkZWZhdWx0VGV4dEhlaWdodDogZnVuY3Rpb24oKSB7IHJldHVybiB0ZXh0SGVpZ2h0KHRoaXMuZGlzcGxheSk7IH0sXG4gICAgZGVmYXVsdENoYXJXaWR0aDogZnVuY3Rpb24oKSB7IHJldHVybiBjaGFyV2lkdGgodGhpcy5kaXNwbGF5KTsgfSxcblxuICAgIHNldEd1dHRlck1hcmtlcjogbWV0aG9kT3AoZnVuY3Rpb24obGluZSwgZ3V0dGVySUQsIHZhbHVlKSB7XG4gICAgICByZXR1cm4gY2hhbmdlTGluZSh0aGlzLmRvYywgbGluZSwgXCJndXR0ZXJcIiwgZnVuY3Rpb24obGluZSkge1xuICAgICAgICB2YXIgbWFya2VycyA9IGxpbmUuZ3V0dGVyTWFya2VycyB8fCAobGluZS5ndXR0ZXJNYXJrZXJzID0ge30pO1xuICAgICAgICBtYXJrZXJzW2d1dHRlcklEXSA9IHZhbHVlO1xuICAgICAgICBpZiAoIXZhbHVlICYmIGlzRW1wdHkobWFya2VycykpIGxpbmUuZ3V0dGVyTWFya2VycyA9IG51bGw7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfSk7XG4gICAgfSksXG5cbiAgICBjbGVhckd1dHRlcjogbWV0aG9kT3AoZnVuY3Rpb24oZ3V0dGVySUQpIHtcbiAgICAgIHZhciBjbSA9IHRoaXMsIGRvYyA9IGNtLmRvYywgaSA9IGRvYy5maXJzdDtcbiAgICAgIGRvYy5pdGVyKGZ1bmN0aW9uKGxpbmUpIHtcbiAgICAgICAgaWYgKGxpbmUuZ3V0dGVyTWFya2VycyAmJiBsaW5lLmd1dHRlck1hcmtlcnNbZ3V0dGVySURdKSB7XG4gICAgICAgICAgbGluZS5ndXR0ZXJNYXJrZXJzW2d1dHRlcklEXSA9IG51bGw7XG4gICAgICAgICAgcmVnTGluZUNoYW5nZShjbSwgaSwgXCJndXR0ZXJcIik7XG4gICAgICAgICAgaWYgKGlzRW1wdHkobGluZS5ndXR0ZXJNYXJrZXJzKSkgbGluZS5ndXR0ZXJNYXJrZXJzID0gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICArK2k7XG4gICAgICB9KTtcbiAgICB9KSxcblxuICAgIGxpbmVJbmZvOiBmdW5jdGlvbihsaW5lKSB7XG4gICAgICBpZiAodHlwZW9mIGxpbmUgPT0gXCJudW1iZXJcIikge1xuICAgICAgICBpZiAoIWlzTGluZSh0aGlzLmRvYywgbGluZSkpIHJldHVybiBudWxsO1xuICAgICAgICB2YXIgbiA9IGxpbmU7XG4gICAgICAgIGxpbmUgPSBnZXRMaW5lKHRoaXMuZG9jLCBsaW5lKTtcbiAgICAgICAgaWYgKCFsaW5lKSByZXR1cm4gbnVsbDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciBuID0gbGluZU5vKGxpbmUpO1xuICAgICAgICBpZiAobiA9PSBudWxsKSByZXR1cm4gbnVsbDtcbiAgICAgIH1cbiAgICAgIHJldHVybiB7bGluZTogbiwgaGFuZGxlOiBsaW5lLCB0ZXh0OiBsaW5lLnRleHQsIGd1dHRlck1hcmtlcnM6IGxpbmUuZ3V0dGVyTWFya2VycyxcbiAgICAgICAgICAgICAgdGV4dENsYXNzOiBsaW5lLnRleHRDbGFzcywgYmdDbGFzczogbGluZS5iZ0NsYXNzLCB3cmFwQ2xhc3M6IGxpbmUud3JhcENsYXNzLFxuICAgICAgICAgICAgICB3aWRnZXRzOiBsaW5lLndpZGdldHN9O1xuICAgIH0sXG5cbiAgICBnZXRWaWV3cG9ydDogZnVuY3Rpb24oKSB7IHJldHVybiB7ZnJvbTogdGhpcy5kaXNwbGF5LnZpZXdGcm9tLCB0bzogdGhpcy5kaXNwbGF5LnZpZXdUb307fSxcblxuICAgIGFkZFdpZGdldDogZnVuY3Rpb24ocG9zLCBub2RlLCBzY3JvbGwsIHZlcnQsIGhvcml6KSB7XG4gICAgICB2YXIgZGlzcGxheSA9IHRoaXMuZGlzcGxheTtcbiAgICAgIHBvcyA9IGN1cnNvckNvb3Jkcyh0aGlzLCBjbGlwUG9zKHRoaXMuZG9jLCBwb3MpKTtcbiAgICAgIHZhciB0b3AgPSBwb3MuYm90dG9tLCBsZWZ0ID0gcG9zLmxlZnQ7XG4gICAgICBub2RlLnN0eWxlLnBvc2l0aW9uID0gXCJhYnNvbHV0ZVwiO1xuICAgICAgbm9kZS5zZXRBdHRyaWJ1dGUoXCJjbS1pZ25vcmUtZXZlbnRzXCIsIFwidHJ1ZVwiKTtcbiAgICAgIHRoaXMuZGlzcGxheS5pbnB1dC5zZXRVbmVkaXRhYmxlKG5vZGUpO1xuICAgICAgZGlzcGxheS5zaXplci5hcHBlbmRDaGlsZChub2RlKTtcbiAgICAgIGlmICh2ZXJ0ID09IFwib3ZlclwiKSB7XG4gICAgICAgIHRvcCA9IHBvcy50b3A7XG4gICAgICB9IGVsc2UgaWYgKHZlcnQgPT0gXCJhYm92ZVwiIHx8IHZlcnQgPT0gXCJuZWFyXCIpIHtcbiAgICAgICAgdmFyIHZzcGFjZSA9IE1hdGgubWF4KGRpc3BsYXkud3JhcHBlci5jbGllbnRIZWlnaHQsIHRoaXMuZG9jLmhlaWdodCksXG4gICAgICAgIGhzcGFjZSA9IE1hdGgubWF4KGRpc3BsYXkuc2l6ZXIuY2xpZW50V2lkdGgsIGRpc3BsYXkubGluZVNwYWNlLmNsaWVudFdpZHRoKTtcbiAgICAgICAgLy8gRGVmYXVsdCB0byBwb3NpdGlvbmluZyBhYm92ZSAoaWYgc3BlY2lmaWVkIGFuZCBwb3NzaWJsZSk7IG90aGVyd2lzZSBkZWZhdWx0IHRvIHBvc2l0aW9uaW5nIGJlbG93XG4gICAgICAgIGlmICgodmVydCA9PSAnYWJvdmUnIHx8IHBvcy5ib3R0b20gKyBub2RlLm9mZnNldEhlaWdodCA+IHZzcGFjZSkgJiYgcG9zLnRvcCA+IG5vZGUub2Zmc2V0SGVpZ2h0KVxuICAgICAgICAgIHRvcCA9IHBvcy50b3AgLSBub2RlLm9mZnNldEhlaWdodDtcbiAgICAgICAgZWxzZSBpZiAocG9zLmJvdHRvbSArIG5vZGUub2Zmc2V0SGVpZ2h0IDw9IHZzcGFjZSlcbiAgICAgICAgICB0b3AgPSBwb3MuYm90dG9tO1xuICAgICAgICBpZiAobGVmdCArIG5vZGUub2Zmc2V0V2lkdGggPiBoc3BhY2UpXG4gICAgICAgICAgbGVmdCA9IGhzcGFjZSAtIG5vZGUub2Zmc2V0V2lkdGg7XG4gICAgICB9XG4gICAgICBub2RlLnN0eWxlLnRvcCA9IHRvcCArIFwicHhcIjtcbiAgICAgIG5vZGUuc3R5bGUubGVmdCA9IG5vZGUuc3R5bGUucmlnaHQgPSBcIlwiO1xuICAgICAgaWYgKGhvcml6ID09IFwicmlnaHRcIikge1xuICAgICAgICBsZWZ0ID0gZGlzcGxheS5zaXplci5jbGllbnRXaWR0aCAtIG5vZGUub2Zmc2V0V2lkdGg7XG4gICAgICAgIG5vZGUuc3R5bGUucmlnaHQgPSBcIjBweFwiO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKGhvcml6ID09IFwibGVmdFwiKSBsZWZ0ID0gMDtcbiAgICAgICAgZWxzZSBpZiAoaG9yaXogPT0gXCJtaWRkbGVcIikgbGVmdCA9IChkaXNwbGF5LnNpemVyLmNsaWVudFdpZHRoIC0gbm9kZS5vZmZzZXRXaWR0aCkgLyAyO1xuICAgICAgICBub2RlLnN0eWxlLmxlZnQgPSBsZWZ0ICsgXCJweFwiO1xuICAgICAgfVxuICAgICAgaWYgKHNjcm9sbClcbiAgICAgICAgc2Nyb2xsSW50b1ZpZXcodGhpcywgbGVmdCwgdG9wLCBsZWZ0ICsgbm9kZS5vZmZzZXRXaWR0aCwgdG9wICsgbm9kZS5vZmZzZXRIZWlnaHQpO1xuICAgIH0sXG5cbiAgICB0cmlnZ2VyT25LZXlEb3duOiBtZXRob2RPcChvbktleURvd24pLFxuICAgIHRyaWdnZXJPbktleVByZXNzOiBtZXRob2RPcChvbktleVByZXNzKSxcbiAgICB0cmlnZ2VyT25LZXlVcDogb25LZXlVcCxcblxuICAgIGV4ZWNDb21tYW5kOiBmdW5jdGlvbihjbWQpIHtcbiAgICAgIGlmIChjb21tYW5kcy5oYXNPd25Qcm9wZXJ0eShjbWQpKVxuICAgICAgICByZXR1cm4gY29tbWFuZHNbY21kXS5jYWxsKG51bGwsIHRoaXMpO1xuICAgIH0sXG5cbiAgICB0cmlnZ2VyRWxlY3RyaWM6IG1ldGhvZE9wKGZ1bmN0aW9uKHRleHQpIHsgdHJpZ2dlckVsZWN0cmljKHRoaXMsIHRleHQpOyB9KSxcblxuICAgIGZpbmRQb3NIOiBmdW5jdGlvbihmcm9tLCBhbW91bnQsIHVuaXQsIHZpc3VhbGx5KSB7XG4gICAgICB2YXIgZGlyID0gMTtcbiAgICAgIGlmIChhbW91bnQgPCAwKSB7IGRpciA9IC0xOyBhbW91bnQgPSAtYW1vdW50OyB9XG4gICAgICBmb3IgKHZhciBpID0gMCwgY3VyID0gY2xpcFBvcyh0aGlzLmRvYywgZnJvbSk7IGkgPCBhbW91bnQ7ICsraSkge1xuICAgICAgICBjdXIgPSBmaW5kUG9zSCh0aGlzLmRvYywgY3VyLCBkaXIsIHVuaXQsIHZpc3VhbGx5KTtcbiAgICAgICAgaWYgKGN1ci5oaXRTaWRlKSBicmVhaztcbiAgICAgIH1cbiAgICAgIHJldHVybiBjdXI7XG4gICAgfSxcblxuICAgIG1vdmVIOiBtZXRob2RPcChmdW5jdGlvbihkaXIsIHVuaXQpIHtcbiAgICAgIHZhciBjbSA9IHRoaXM7XG4gICAgICBjbS5leHRlbmRTZWxlY3Rpb25zQnkoZnVuY3Rpb24ocmFuZ2UpIHtcbiAgICAgICAgaWYgKGNtLmRpc3BsYXkuc2hpZnQgfHwgY20uZG9jLmV4dGVuZCB8fCByYW5nZS5lbXB0eSgpKVxuICAgICAgICAgIHJldHVybiBmaW5kUG9zSChjbS5kb2MsIHJhbmdlLmhlYWQsIGRpciwgdW5pdCwgY20ub3B0aW9ucy5ydGxNb3ZlVmlzdWFsbHkpO1xuICAgICAgICBlbHNlXG4gICAgICAgICAgcmV0dXJuIGRpciA8IDAgPyByYW5nZS5mcm9tKCkgOiByYW5nZS50bygpO1xuICAgICAgfSwgc2VsX21vdmUpO1xuICAgIH0pLFxuXG4gICAgZGVsZXRlSDogbWV0aG9kT3AoZnVuY3Rpb24oZGlyLCB1bml0KSB7XG4gICAgICB2YXIgc2VsID0gdGhpcy5kb2Muc2VsLCBkb2MgPSB0aGlzLmRvYztcbiAgICAgIGlmIChzZWwuc29tZXRoaW5nU2VsZWN0ZWQoKSlcbiAgICAgICAgZG9jLnJlcGxhY2VTZWxlY3Rpb24oXCJcIiwgbnVsbCwgXCIrZGVsZXRlXCIpO1xuICAgICAgZWxzZVxuICAgICAgICBkZWxldGVOZWFyU2VsZWN0aW9uKHRoaXMsIGZ1bmN0aW9uKHJhbmdlKSB7XG4gICAgICAgICAgdmFyIG90aGVyID0gZmluZFBvc0goZG9jLCByYW5nZS5oZWFkLCBkaXIsIHVuaXQsIGZhbHNlKTtcbiAgICAgICAgICByZXR1cm4gZGlyIDwgMCA/IHtmcm9tOiBvdGhlciwgdG86IHJhbmdlLmhlYWR9IDoge2Zyb206IHJhbmdlLmhlYWQsIHRvOiBvdGhlcn07XG4gICAgICAgIH0pO1xuICAgIH0pLFxuXG4gICAgZmluZFBvc1Y6IGZ1bmN0aW9uKGZyb20sIGFtb3VudCwgdW5pdCwgZ29hbENvbHVtbikge1xuICAgICAgdmFyIGRpciA9IDEsIHggPSBnb2FsQ29sdW1uO1xuICAgICAgaWYgKGFtb3VudCA8IDApIHsgZGlyID0gLTE7IGFtb3VudCA9IC1hbW91bnQ7IH1cbiAgICAgIGZvciAodmFyIGkgPSAwLCBjdXIgPSBjbGlwUG9zKHRoaXMuZG9jLCBmcm9tKTsgaSA8IGFtb3VudDsgKytpKSB7XG4gICAgICAgIHZhciBjb29yZHMgPSBjdXJzb3JDb29yZHModGhpcywgY3VyLCBcImRpdlwiKTtcbiAgICAgICAgaWYgKHggPT0gbnVsbCkgeCA9IGNvb3Jkcy5sZWZ0O1xuICAgICAgICBlbHNlIGNvb3Jkcy5sZWZ0ID0geDtcbiAgICAgICAgY3VyID0gZmluZFBvc1YodGhpcywgY29vcmRzLCBkaXIsIHVuaXQpO1xuICAgICAgICBpZiAoY3VyLmhpdFNpZGUpIGJyZWFrO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGN1cjtcbiAgICB9LFxuXG4gICAgbW92ZVY6IG1ldGhvZE9wKGZ1bmN0aW9uKGRpciwgdW5pdCkge1xuICAgICAgdmFyIGNtID0gdGhpcywgZG9jID0gdGhpcy5kb2MsIGdvYWxzID0gW107XG4gICAgICB2YXIgY29sbGFwc2UgPSAhY20uZGlzcGxheS5zaGlmdCAmJiAhZG9jLmV4dGVuZCAmJiBkb2Muc2VsLnNvbWV0aGluZ1NlbGVjdGVkKCk7XG4gICAgICBkb2MuZXh0ZW5kU2VsZWN0aW9uc0J5KGZ1bmN0aW9uKHJhbmdlKSB7XG4gICAgICAgIGlmIChjb2xsYXBzZSlcbiAgICAgICAgICByZXR1cm4gZGlyIDwgMCA/IHJhbmdlLmZyb20oKSA6IHJhbmdlLnRvKCk7XG4gICAgICAgIHZhciBoZWFkUG9zID0gY3Vyc29yQ29vcmRzKGNtLCByYW5nZS5oZWFkLCBcImRpdlwiKTtcbiAgICAgICAgaWYgKHJhbmdlLmdvYWxDb2x1bW4gIT0gbnVsbCkgaGVhZFBvcy5sZWZ0ID0gcmFuZ2UuZ29hbENvbHVtbjtcbiAgICAgICAgZ29hbHMucHVzaChoZWFkUG9zLmxlZnQpO1xuICAgICAgICB2YXIgcG9zID0gZmluZFBvc1YoY20sIGhlYWRQb3MsIGRpciwgdW5pdCk7XG4gICAgICAgIGlmICh1bml0ID09IFwicGFnZVwiICYmIHJhbmdlID09IGRvYy5zZWwucHJpbWFyeSgpKVxuICAgICAgICAgIGFkZFRvU2Nyb2xsUG9zKGNtLCBudWxsLCBjaGFyQ29vcmRzKGNtLCBwb3MsIFwiZGl2XCIpLnRvcCAtIGhlYWRQb3MudG9wKTtcbiAgICAgICAgcmV0dXJuIHBvcztcbiAgICAgIH0sIHNlbF9tb3ZlKTtcbiAgICAgIGlmIChnb2Fscy5sZW5ndGgpIGZvciAodmFyIGkgPSAwOyBpIDwgZG9jLnNlbC5yYW5nZXMubGVuZ3RoOyBpKyspXG4gICAgICAgIGRvYy5zZWwucmFuZ2VzW2ldLmdvYWxDb2x1bW4gPSBnb2Fsc1tpXTtcbiAgICB9KSxcblxuICAgIC8vIEZpbmQgdGhlIHdvcmQgYXQgdGhlIGdpdmVuIHBvc2l0aW9uIChhcyByZXR1cm5lZCBieSBjb29yZHNDaGFyKS5cbiAgICBmaW5kV29yZEF0OiBmdW5jdGlvbihwb3MpIHtcbiAgICAgIHZhciBkb2MgPSB0aGlzLmRvYywgbGluZSA9IGdldExpbmUoZG9jLCBwb3MubGluZSkudGV4dDtcbiAgICAgIHZhciBzdGFydCA9IHBvcy5jaCwgZW5kID0gcG9zLmNoO1xuICAgICAgaWYgKGxpbmUpIHtcbiAgICAgICAgdmFyIGhlbHBlciA9IHRoaXMuZ2V0SGVscGVyKHBvcywgXCJ3b3JkQ2hhcnNcIik7XG4gICAgICAgIGlmICgocG9zLnhSZWwgPCAwIHx8IGVuZCA9PSBsaW5lLmxlbmd0aCkgJiYgc3RhcnQpIC0tc3RhcnQ7IGVsc2UgKytlbmQ7XG4gICAgICAgIHZhciBzdGFydENoYXIgPSBsaW5lLmNoYXJBdChzdGFydCk7XG4gICAgICAgIHZhciBjaGVjayA9IGlzV29yZENoYXIoc3RhcnRDaGFyLCBoZWxwZXIpXG4gICAgICAgICAgPyBmdW5jdGlvbihjaCkgeyByZXR1cm4gaXNXb3JkQ2hhcihjaCwgaGVscGVyKTsgfVxuICAgICAgICAgIDogL1xccy8udGVzdChzdGFydENoYXIpID8gZnVuY3Rpb24oY2gpIHtyZXR1cm4gL1xccy8udGVzdChjaCk7fVxuICAgICAgICAgIDogZnVuY3Rpb24oY2gpIHtyZXR1cm4gIS9cXHMvLnRlc3QoY2gpICYmICFpc1dvcmRDaGFyKGNoKTt9O1xuICAgICAgICB3aGlsZSAoc3RhcnQgPiAwICYmIGNoZWNrKGxpbmUuY2hhckF0KHN0YXJ0IC0gMSkpKSAtLXN0YXJ0O1xuICAgICAgICB3aGlsZSAoZW5kIDwgbGluZS5sZW5ndGggJiYgY2hlY2sobGluZS5jaGFyQXQoZW5kKSkpICsrZW5kO1xuICAgICAgfVxuICAgICAgcmV0dXJuIG5ldyBSYW5nZShQb3MocG9zLmxpbmUsIHN0YXJ0KSwgUG9zKHBvcy5saW5lLCBlbmQpKTtcbiAgICB9LFxuXG4gICAgdG9nZ2xlT3ZlcndyaXRlOiBmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgaWYgKHZhbHVlICE9IG51bGwgJiYgdmFsdWUgPT0gdGhpcy5zdGF0ZS5vdmVyd3JpdGUpIHJldHVybjtcbiAgICAgIGlmICh0aGlzLnN0YXRlLm92ZXJ3cml0ZSA9ICF0aGlzLnN0YXRlLm92ZXJ3cml0ZSlcbiAgICAgICAgYWRkQ2xhc3ModGhpcy5kaXNwbGF5LmN1cnNvckRpdiwgXCJDb2RlTWlycm9yLW92ZXJ3cml0ZVwiKTtcbiAgICAgIGVsc2VcbiAgICAgICAgcm1DbGFzcyh0aGlzLmRpc3BsYXkuY3Vyc29yRGl2LCBcIkNvZGVNaXJyb3Itb3ZlcndyaXRlXCIpO1xuXG4gICAgICBzaWduYWwodGhpcywgXCJvdmVyd3JpdGVUb2dnbGVcIiwgdGhpcywgdGhpcy5zdGF0ZS5vdmVyd3JpdGUpO1xuICAgIH0sXG4gICAgaGFzRm9jdXM6IGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpcy5kaXNwbGF5LmlucHV0LmdldEZpZWxkKCkgPT0gYWN0aXZlRWx0KCk7IH0sXG4gICAgaXNSZWFkT25seTogZnVuY3Rpb24oKSB7IHJldHVybiAhISh0aGlzLm9wdGlvbnMucmVhZE9ubHkgfHwgdGhpcy5kb2MuY2FudEVkaXQpOyB9LFxuXG4gICAgc2Nyb2xsVG86IG1ldGhvZE9wKGZ1bmN0aW9uKHgsIHkpIHtcbiAgICAgIGlmICh4ICE9IG51bGwgfHwgeSAhPSBudWxsKSByZXNvbHZlU2Nyb2xsVG9Qb3ModGhpcyk7XG4gICAgICBpZiAoeCAhPSBudWxsKSB0aGlzLmN1ck9wLnNjcm9sbExlZnQgPSB4O1xuICAgICAgaWYgKHkgIT0gbnVsbCkgdGhpcy5jdXJPcC5zY3JvbGxUb3AgPSB5O1xuICAgIH0pLFxuICAgIGdldFNjcm9sbEluZm86IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIHNjcm9sbGVyID0gdGhpcy5kaXNwbGF5LnNjcm9sbGVyO1xuICAgICAgcmV0dXJuIHtsZWZ0OiBzY3JvbGxlci5zY3JvbGxMZWZ0LCB0b3A6IHNjcm9sbGVyLnNjcm9sbFRvcCxcbiAgICAgICAgICAgICAgaGVpZ2h0OiBzY3JvbGxlci5zY3JvbGxIZWlnaHQgLSBzY3JvbGxHYXAodGhpcykgLSB0aGlzLmRpc3BsYXkuYmFySGVpZ2h0LFxuICAgICAgICAgICAgICB3aWR0aDogc2Nyb2xsZXIuc2Nyb2xsV2lkdGggLSBzY3JvbGxHYXAodGhpcykgLSB0aGlzLmRpc3BsYXkuYmFyV2lkdGgsXG4gICAgICAgICAgICAgIGNsaWVudEhlaWdodDogZGlzcGxheUhlaWdodCh0aGlzKSwgY2xpZW50V2lkdGg6IGRpc3BsYXlXaWR0aCh0aGlzKX07XG4gICAgfSxcblxuICAgIHNjcm9sbEludG9WaWV3OiBtZXRob2RPcChmdW5jdGlvbihyYW5nZSwgbWFyZ2luKSB7XG4gICAgICBpZiAocmFuZ2UgPT0gbnVsbCkge1xuICAgICAgICByYW5nZSA9IHtmcm9tOiB0aGlzLmRvYy5zZWwucHJpbWFyeSgpLmhlYWQsIHRvOiBudWxsfTtcbiAgICAgICAgaWYgKG1hcmdpbiA9PSBudWxsKSBtYXJnaW4gPSB0aGlzLm9wdGlvbnMuY3Vyc29yU2Nyb2xsTWFyZ2luO1xuICAgICAgfSBlbHNlIGlmICh0eXBlb2YgcmFuZ2UgPT0gXCJudW1iZXJcIikge1xuICAgICAgICByYW5nZSA9IHtmcm9tOiBQb3MocmFuZ2UsIDApLCB0bzogbnVsbH07XG4gICAgICB9IGVsc2UgaWYgKHJhbmdlLmZyb20gPT0gbnVsbCkge1xuICAgICAgICByYW5nZSA9IHtmcm9tOiByYW5nZSwgdG86IG51bGx9O1xuICAgICAgfVxuICAgICAgaWYgKCFyYW5nZS50bykgcmFuZ2UudG8gPSByYW5nZS5mcm9tO1xuICAgICAgcmFuZ2UubWFyZ2luID0gbWFyZ2luIHx8IDA7XG5cbiAgICAgIGlmIChyYW5nZS5mcm9tLmxpbmUgIT0gbnVsbCkge1xuICAgICAgICByZXNvbHZlU2Nyb2xsVG9Qb3ModGhpcyk7XG4gICAgICAgIHRoaXMuY3VyT3Auc2Nyb2xsVG9Qb3MgPSByYW5nZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciBzUG9zID0gY2FsY3VsYXRlU2Nyb2xsUG9zKHRoaXMsIE1hdGgubWluKHJhbmdlLmZyb20ubGVmdCwgcmFuZ2UudG8ubGVmdCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1hdGgubWluKHJhbmdlLmZyb20udG9wLCByYW5nZS50by50b3ApIC0gcmFuZ2UubWFyZ2luLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBNYXRoLm1heChyYW5nZS5mcm9tLnJpZ2h0LCByYW5nZS50by5yaWdodCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1hdGgubWF4KHJhbmdlLmZyb20uYm90dG9tLCByYW5nZS50by5ib3R0b20pICsgcmFuZ2UubWFyZ2luKTtcbiAgICAgICAgdGhpcy5zY3JvbGxUbyhzUG9zLnNjcm9sbExlZnQsIHNQb3Muc2Nyb2xsVG9wKTtcbiAgICAgIH1cbiAgICB9KSxcblxuICAgIHNldFNpemU6IG1ldGhvZE9wKGZ1bmN0aW9uKHdpZHRoLCBoZWlnaHQpIHtcbiAgICAgIHZhciBjbSA9IHRoaXM7XG4gICAgICBmdW5jdGlvbiBpbnRlcnByZXQodmFsKSB7XG4gICAgICAgIHJldHVybiB0eXBlb2YgdmFsID09IFwibnVtYmVyXCIgfHwgL15cXGQrJC8udGVzdChTdHJpbmcodmFsKSkgPyB2YWwgKyBcInB4XCIgOiB2YWw7XG4gICAgICB9XG4gICAgICBpZiAod2lkdGggIT0gbnVsbCkgY20uZGlzcGxheS53cmFwcGVyLnN0eWxlLndpZHRoID0gaW50ZXJwcmV0KHdpZHRoKTtcbiAgICAgIGlmIChoZWlnaHQgIT0gbnVsbCkgY20uZGlzcGxheS53cmFwcGVyLnN0eWxlLmhlaWdodCA9IGludGVycHJldChoZWlnaHQpO1xuICAgICAgaWYgKGNtLm9wdGlvbnMubGluZVdyYXBwaW5nKSBjbGVhckxpbmVNZWFzdXJlbWVudENhY2hlKHRoaXMpO1xuICAgICAgdmFyIGxpbmVObyA9IGNtLmRpc3BsYXkudmlld0Zyb207XG4gICAgICBjbS5kb2MuaXRlcihsaW5lTm8sIGNtLmRpc3BsYXkudmlld1RvLCBmdW5jdGlvbihsaW5lKSB7XG4gICAgICAgIGlmIChsaW5lLndpZGdldHMpIGZvciAodmFyIGkgPSAwOyBpIDwgbGluZS53aWRnZXRzLmxlbmd0aDsgaSsrKVxuICAgICAgICAgIGlmIChsaW5lLndpZGdldHNbaV0ubm9IU2Nyb2xsKSB7IHJlZ0xpbmVDaGFuZ2UoY20sIGxpbmVObywgXCJ3aWRnZXRcIik7IGJyZWFrOyB9XG4gICAgICAgICsrbGluZU5vO1xuICAgICAgfSk7XG4gICAgICBjbS5jdXJPcC5mb3JjZVVwZGF0ZSA9IHRydWU7XG4gICAgICBzaWduYWwoY20sIFwicmVmcmVzaFwiLCB0aGlzKTtcbiAgICB9KSxcblxuICAgIG9wZXJhdGlvbjogZnVuY3Rpb24oZil7cmV0dXJuIHJ1bkluT3AodGhpcywgZik7fSxcblxuICAgIHJlZnJlc2g6IG1ldGhvZE9wKGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIG9sZEhlaWdodCA9IHRoaXMuZGlzcGxheS5jYWNoZWRUZXh0SGVpZ2h0O1xuICAgICAgcmVnQ2hhbmdlKHRoaXMpO1xuICAgICAgdGhpcy5jdXJPcC5mb3JjZVVwZGF0ZSA9IHRydWU7XG4gICAgICBjbGVhckNhY2hlcyh0aGlzKTtcbiAgICAgIHRoaXMuc2Nyb2xsVG8odGhpcy5kb2Muc2Nyb2xsTGVmdCwgdGhpcy5kb2Muc2Nyb2xsVG9wKTtcbiAgICAgIHVwZGF0ZUd1dHRlclNwYWNlKHRoaXMpO1xuICAgICAgaWYgKG9sZEhlaWdodCA9PSBudWxsIHx8IE1hdGguYWJzKG9sZEhlaWdodCAtIHRleHRIZWlnaHQodGhpcy5kaXNwbGF5KSkgPiAuNSlcbiAgICAgICAgZXN0aW1hdGVMaW5lSGVpZ2h0cyh0aGlzKTtcbiAgICAgIHNpZ25hbCh0aGlzLCBcInJlZnJlc2hcIiwgdGhpcyk7XG4gICAgfSksXG5cbiAgICBzd2FwRG9jOiBtZXRob2RPcChmdW5jdGlvbihkb2MpIHtcbiAgICAgIHZhciBvbGQgPSB0aGlzLmRvYztcbiAgICAgIG9sZC5jbSA9IG51bGw7XG4gICAgICBhdHRhY2hEb2ModGhpcywgZG9jKTtcbiAgICAgIGNsZWFyQ2FjaGVzKHRoaXMpO1xuICAgICAgdGhpcy5kaXNwbGF5LmlucHV0LnJlc2V0KCk7XG4gICAgICB0aGlzLnNjcm9sbFRvKGRvYy5zY3JvbGxMZWZ0LCBkb2Muc2Nyb2xsVG9wKTtcbiAgICAgIHRoaXMuY3VyT3AuZm9yY2VTY3JvbGwgPSB0cnVlO1xuICAgICAgc2lnbmFsTGF0ZXIodGhpcywgXCJzd2FwRG9jXCIsIHRoaXMsIG9sZCk7XG4gICAgICByZXR1cm4gb2xkO1xuICAgIH0pLFxuXG4gICAgZ2V0SW5wdXRGaWVsZDogZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5kaXNwbGF5LmlucHV0LmdldEZpZWxkKCk7fSxcbiAgICBnZXRXcmFwcGVyRWxlbWVudDogZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5kaXNwbGF5LndyYXBwZXI7fSxcbiAgICBnZXRTY3JvbGxlckVsZW1lbnQ6IGZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZGlzcGxheS5zY3JvbGxlcjt9LFxuICAgIGdldEd1dHRlckVsZW1lbnQ6IGZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZGlzcGxheS5ndXR0ZXJzO31cbiAgfTtcbiAgZXZlbnRNaXhpbihDb2RlTWlycm9yKTtcblxuICAvLyBPUFRJT04gREVGQVVMVFNcblxuICAvLyBUaGUgZGVmYXVsdCBjb25maWd1cmF0aW9uIG9wdGlvbnMuXG4gIHZhciBkZWZhdWx0cyA9IENvZGVNaXJyb3IuZGVmYXVsdHMgPSB7fTtcbiAgLy8gRnVuY3Rpb25zIHRvIHJ1biB3aGVuIG9wdGlvbnMgYXJlIGNoYW5nZWQuXG4gIHZhciBvcHRpb25IYW5kbGVycyA9IENvZGVNaXJyb3Iub3B0aW9uSGFuZGxlcnMgPSB7fTtcblxuICBmdW5jdGlvbiBvcHRpb24obmFtZSwgZGVmbHQsIGhhbmRsZSwgbm90T25Jbml0KSB7XG4gICAgQ29kZU1pcnJvci5kZWZhdWx0c1tuYW1lXSA9IGRlZmx0O1xuICAgIGlmIChoYW5kbGUpIG9wdGlvbkhhbmRsZXJzW25hbWVdID1cbiAgICAgIG5vdE9uSW5pdCA/IGZ1bmN0aW9uKGNtLCB2YWwsIG9sZCkge2lmIChvbGQgIT0gSW5pdCkgaGFuZGxlKGNtLCB2YWwsIG9sZCk7fSA6IGhhbmRsZTtcbiAgfVxuXG4gIC8vIFBhc3NlZCB0byBvcHRpb24gaGFuZGxlcnMgd2hlbiB0aGVyZSBpcyBubyBvbGQgdmFsdWUuXG4gIHZhciBJbml0ID0gQ29kZU1pcnJvci5Jbml0ID0ge3RvU3RyaW5nOiBmdW5jdGlvbigpe3JldHVybiBcIkNvZGVNaXJyb3IuSW5pdFwiO319O1xuXG4gIC8vIFRoZXNlIHR3byBhcmUsIG9uIGluaXQsIGNhbGxlZCBmcm9tIHRoZSBjb25zdHJ1Y3RvciBiZWNhdXNlIHRoZXlcbiAgLy8gaGF2ZSB0byBiZSBpbml0aWFsaXplZCBiZWZvcmUgdGhlIGVkaXRvciBjYW4gc3RhcnQgYXQgYWxsLlxuICBvcHRpb24oXCJ2YWx1ZVwiLCBcIlwiLCBmdW5jdGlvbihjbSwgdmFsKSB7XG4gICAgY20uc2V0VmFsdWUodmFsKTtcbiAgfSwgdHJ1ZSk7XG4gIG9wdGlvbihcIm1vZGVcIiwgbnVsbCwgZnVuY3Rpb24oY20sIHZhbCkge1xuICAgIGNtLmRvYy5tb2RlT3B0aW9uID0gdmFsO1xuICAgIGxvYWRNb2RlKGNtKTtcbiAgfSwgdHJ1ZSk7XG5cbiAgb3B0aW9uKFwiaW5kZW50VW5pdFwiLCAyLCBsb2FkTW9kZSwgdHJ1ZSk7XG4gIG9wdGlvbihcImluZGVudFdpdGhUYWJzXCIsIGZhbHNlKTtcbiAgb3B0aW9uKFwic21hcnRJbmRlbnRcIiwgdHJ1ZSk7XG4gIG9wdGlvbihcInRhYlNpemVcIiwgNCwgZnVuY3Rpb24oY20pIHtcbiAgICByZXNldE1vZGVTdGF0ZShjbSk7XG4gICAgY2xlYXJDYWNoZXMoY20pO1xuICAgIHJlZ0NoYW5nZShjbSk7XG4gIH0sIHRydWUpO1xuICBvcHRpb24oXCJsaW5lU2VwYXJhdG9yXCIsIG51bGwsIGZ1bmN0aW9uKGNtLCB2YWwpIHtcbiAgICBjbS5kb2MubGluZVNlcCA9IHZhbDtcbiAgICBpZiAoIXZhbCkgcmV0dXJuO1xuICAgIHZhciBuZXdCcmVha3MgPSBbXSwgbGluZU5vID0gY20uZG9jLmZpcnN0O1xuICAgIGNtLmRvYy5pdGVyKGZ1bmN0aW9uKGxpbmUpIHtcbiAgICAgIGZvciAodmFyIHBvcyA9IDA7Oykge1xuICAgICAgICB2YXIgZm91bmQgPSBsaW5lLnRleHQuaW5kZXhPZih2YWwsIHBvcyk7XG4gICAgICAgIGlmIChmb3VuZCA9PSAtMSkgYnJlYWs7XG4gICAgICAgIHBvcyA9IGZvdW5kICsgdmFsLmxlbmd0aDtcbiAgICAgICAgbmV3QnJlYWtzLnB1c2goUG9zKGxpbmVObywgZm91bmQpKTtcbiAgICAgIH1cbiAgICAgIGxpbmVObysrO1xuICAgIH0pO1xuICAgIGZvciAodmFyIGkgPSBuZXdCcmVha3MubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pXG4gICAgICByZXBsYWNlUmFuZ2UoY20uZG9jLCB2YWwsIG5ld0JyZWFrc1tpXSwgUG9zKG5ld0JyZWFrc1tpXS5saW5lLCBuZXdCcmVha3NbaV0uY2ggKyB2YWwubGVuZ3RoKSlcbiAgfSk7XG4gIG9wdGlvbihcInNwZWNpYWxDaGFyc1wiLCAvW1xcdFxcdTAwMDAtXFx1MDAxOVxcdTAwYWRcXHUyMDBiLVxcdTIwMGZcXHUyMDI4XFx1MjAyOVxcdWZlZmZdL2csIGZ1bmN0aW9uKGNtLCB2YWwsIG9sZCkge1xuICAgIGNtLnN0YXRlLnNwZWNpYWxDaGFycyA9IG5ldyBSZWdFeHAodmFsLnNvdXJjZSArICh2YWwudGVzdChcIlxcdFwiKSA/IFwiXCIgOiBcInxcXHRcIiksIFwiZ1wiKTtcbiAgICBpZiAob2xkICE9IENvZGVNaXJyb3IuSW5pdCkgY20ucmVmcmVzaCgpO1xuICB9KTtcbiAgb3B0aW9uKFwic3BlY2lhbENoYXJQbGFjZWhvbGRlclwiLCBkZWZhdWx0U3BlY2lhbENoYXJQbGFjZWhvbGRlciwgZnVuY3Rpb24oY20pIHtjbS5yZWZyZXNoKCk7fSwgdHJ1ZSk7XG4gIG9wdGlvbihcImVsZWN0cmljQ2hhcnNcIiwgdHJ1ZSk7XG4gIG9wdGlvbihcImlucHV0U3R5bGVcIiwgbW9iaWxlID8gXCJjb250ZW50ZWRpdGFibGVcIiA6IFwidGV4dGFyZWFcIiwgZnVuY3Rpb24oKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiaW5wdXRTdHlsZSBjYW4gbm90ICh5ZXQpIGJlIGNoYW5nZWQgaW4gYSBydW5uaW5nIGVkaXRvclwiKTsgLy8gRklYTUVcbiAgfSwgdHJ1ZSk7XG4gIG9wdGlvbihcInJ0bE1vdmVWaXN1YWxseVwiLCAhd2luZG93cyk7XG4gIG9wdGlvbihcIndob2xlTGluZVVwZGF0ZUJlZm9yZVwiLCB0cnVlKTtcblxuICBvcHRpb24oXCJ0aGVtZVwiLCBcImRlZmF1bHRcIiwgZnVuY3Rpb24oY20pIHtcbiAgICB0aGVtZUNoYW5nZWQoY20pO1xuICAgIGd1dHRlcnNDaGFuZ2VkKGNtKTtcbiAgfSwgdHJ1ZSk7XG4gIG9wdGlvbihcImtleU1hcFwiLCBcImRlZmF1bHRcIiwgZnVuY3Rpb24oY20sIHZhbCwgb2xkKSB7XG4gICAgdmFyIG5leHQgPSBnZXRLZXlNYXAodmFsKTtcbiAgICB2YXIgcHJldiA9IG9sZCAhPSBDb2RlTWlycm9yLkluaXQgJiYgZ2V0S2V5TWFwKG9sZCk7XG4gICAgaWYgKHByZXYgJiYgcHJldi5kZXRhY2gpIHByZXYuZGV0YWNoKGNtLCBuZXh0KTtcbiAgICBpZiAobmV4dC5hdHRhY2gpIG5leHQuYXR0YWNoKGNtLCBwcmV2IHx8IG51bGwpO1xuICB9KTtcbiAgb3B0aW9uKFwiZXh0cmFLZXlzXCIsIG51bGwpO1xuXG4gIG9wdGlvbihcImxpbmVXcmFwcGluZ1wiLCBmYWxzZSwgd3JhcHBpbmdDaGFuZ2VkLCB0cnVlKTtcbiAgb3B0aW9uKFwiZ3V0dGVyc1wiLCBbXSwgZnVuY3Rpb24oY20pIHtcbiAgICBzZXRHdXR0ZXJzRm9yTGluZU51bWJlcnMoY20ub3B0aW9ucyk7XG4gICAgZ3V0dGVyc0NoYW5nZWQoY20pO1xuICB9LCB0cnVlKTtcbiAgb3B0aW9uKFwiZml4ZWRHdXR0ZXJcIiwgdHJ1ZSwgZnVuY3Rpb24oY20sIHZhbCkge1xuICAgIGNtLmRpc3BsYXkuZ3V0dGVycy5zdHlsZS5sZWZ0ID0gdmFsID8gY29tcGVuc2F0ZUZvckhTY3JvbGwoY20uZGlzcGxheSkgKyBcInB4XCIgOiBcIjBcIjtcbiAgICBjbS5yZWZyZXNoKCk7XG4gIH0sIHRydWUpO1xuICBvcHRpb24oXCJjb3Zlckd1dHRlck5leHRUb1Njcm9sbGJhclwiLCBmYWxzZSwgZnVuY3Rpb24oY20pIHt1cGRhdGVTY3JvbGxiYXJzKGNtKTt9LCB0cnVlKTtcbiAgb3B0aW9uKFwic2Nyb2xsYmFyU3R5bGVcIiwgXCJuYXRpdmVcIiwgZnVuY3Rpb24oY20pIHtcbiAgICBpbml0U2Nyb2xsYmFycyhjbSk7XG4gICAgdXBkYXRlU2Nyb2xsYmFycyhjbSk7XG4gICAgY20uZGlzcGxheS5zY3JvbGxiYXJzLnNldFNjcm9sbFRvcChjbS5kb2Muc2Nyb2xsVG9wKTtcbiAgICBjbS5kaXNwbGF5LnNjcm9sbGJhcnMuc2V0U2Nyb2xsTGVmdChjbS5kb2Muc2Nyb2xsTGVmdCk7XG4gIH0sIHRydWUpO1xuICBvcHRpb24oXCJsaW5lTnVtYmVyc1wiLCBmYWxzZSwgZnVuY3Rpb24oY20pIHtcbiAgICBzZXRHdXR0ZXJzRm9yTGluZU51bWJlcnMoY20ub3B0aW9ucyk7XG4gICAgZ3V0dGVyc0NoYW5nZWQoY20pO1xuICB9LCB0cnVlKTtcbiAgb3B0aW9uKFwiZmlyc3RMaW5lTnVtYmVyXCIsIDEsIGd1dHRlcnNDaGFuZ2VkLCB0cnVlKTtcbiAgb3B0aW9uKFwibGluZU51bWJlckZvcm1hdHRlclwiLCBmdW5jdGlvbihpbnRlZ2VyKSB7cmV0dXJuIGludGVnZXI7fSwgZ3V0dGVyc0NoYW5nZWQsIHRydWUpO1xuICBvcHRpb24oXCJzaG93Q3Vyc29yV2hlblNlbGVjdGluZ1wiLCBmYWxzZSwgdXBkYXRlU2VsZWN0aW9uLCB0cnVlKTtcblxuICBvcHRpb24oXCJyZXNldFNlbGVjdGlvbk9uQ29udGV4dE1lbnVcIiwgdHJ1ZSk7XG4gIG9wdGlvbihcImxpbmVXaXNlQ29weUN1dFwiLCB0cnVlKTtcblxuICBvcHRpb24oXCJyZWFkT25seVwiLCBmYWxzZSwgZnVuY3Rpb24oY20sIHZhbCkge1xuICAgIGlmICh2YWwgPT0gXCJub2N1cnNvclwiKSB7XG4gICAgICBvbkJsdXIoY20pO1xuICAgICAgY20uZGlzcGxheS5pbnB1dC5ibHVyKCk7XG4gICAgICBjbS5kaXNwbGF5LmRpc2FibGVkID0gdHJ1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgY20uZGlzcGxheS5kaXNhYmxlZCA9IGZhbHNlO1xuICAgIH1cbiAgICBjbS5kaXNwbGF5LmlucHV0LnJlYWRPbmx5Q2hhbmdlZCh2YWwpXG4gIH0pO1xuICBvcHRpb24oXCJkaXNhYmxlSW5wdXRcIiwgZmFsc2UsIGZ1bmN0aW9uKGNtLCB2YWwpIHtpZiAoIXZhbCkgY20uZGlzcGxheS5pbnB1dC5yZXNldCgpO30sIHRydWUpO1xuICBvcHRpb24oXCJkcmFnRHJvcFwiLCB0cnVlLCBkcmFnRHJvcENoYW5nZWQpO1xuICBvcHRpb24oXCJhbGxvd0Ryb3BGaWxlVHlwZXNcIiwgbnVsbCk7XG5cbiAgb3B0aW9uKFwiY3Vyc29yQmxpbmtSYXRlXCIsIDUzMCk7XG4gIG9wdGlvbihcImN1cnNvclNjcm9sbE1hcmdpblwiLCAwKTtcbiAgb3B0aW9uKFwiY3Vyc29ySGVpZ2h0XCIsIDEsIHVwZGF0ZVNlbGVjdGlvbiwgdHJ1ZSk7XG4gIG9wdGlvbihcInNpbmdsZUN1cnNvckhlaWdodFBlckxpbmVcIiwgdHJ1ZSwgdXBkYXRlU2VsZWN0aW9uLCB0cnVlKTtcbiAgb3B0aW9uKFwid29ya1RpbWVcIiwgMTAwKTtcbiAgb3B0aW9uKFwid29ya0RlbGF5XCIsIDEwMCk7XG4gIG9wdGlvbihcImZsYXR0ZW5TcGFuc1wiLCB0cnVlLCByZXNldE1vZGVTdGF0ZSwgdHJ1ZSk7XG4gIG9wdGlvbihcImFkZE1vZGVDbGFzc1wiLCBmYWxzZSwgcmVzZXRNb2RlU3RhdGUsIHRydWUpO1xuICBvcHRpb24oXCJwb2xsSW50ZXJ2YWxcIiwgMTAwKTtcbiAgb3B0aW9uKFwidW5kb0RlcHRoXCIsIDIwMCwgZnVuY3Rpb24oY20sIHZhbCl7Y20uZG9jLmhpc3RvcnkudW5kb0RlcHRoID0gdmFsO30pO1xuICBvcHRpb24oXCJoaXN0b3J5RXZlbnREZWxheVwiLCAxMjUwKTtcbiAgb3B0aW9uKFwidmlld3BvcnRNYXJnaW5cIiwgMTAsIGZ1bmN0aW9uKGNtKXtjbS5yZWZyZXNoKCk7fSwgdHJ1ZSk7XG4gIG9wdGlvbihcIm1heEhpZ2hsaWdodExlbmd0aFwiLCAxMDAwMCwgcmVzZXRNb2RlU3RhdGUsIHRydWUpO1xuICBvcHRpb24oXCJtb3ZlSW5wdXRXaXRoQ3Vyc29yXCIsIHRydWUsIGZ1bmN0aW9uKGNtLCB2YWwpIHtcbiAgICBpZiAoIXZhbCkgY20uZGlzcGxheS5pbnB1dC5yZXNldFBvc2l0aW9uKCk7XG4gIH0pO1xuXG4gIG9wdGlvbihcInRhYmluZGV4XCIsIG51bGwsIGZ1bmN0aW9uKGNtLCB2YWwpIHtcbiAgICBjbS5kaXNwbGF5LmlucHV0LmdldEZpZWxkKCkudGFiSW5kZXggPSB2YWwgfHwgXCJcIjtcbiAgfSk7XG4gIG9wdGlvbihcImF1dG9mb2N1c1wiLCBudWxsKTtcblxuICAvLyBNT0RFIERFRklOSVRJT04gQU5EIFFVRVJZSU5HXG5cbiAgLy8gS25vd24gbW9kZXMsIGJ5IG5hbWUgYW5kIGJ5IE1JTUVcbiAgdmFyIG1vZGVzID0gQ29kZU1pcnJvci5tb2RlcyA9IHt9LCBtaW1lTW9kZXMgPSBDb2RlTWlycm9yLm1pbWVNb2RlcyA9IHt9O1xuXG4gIC8vIEV4dHJhIGFyZ3VtZW50cyBhcmUgc3RvcmVkIGFzIHRoZSBtb2RlJ3MgZGVwZW5kZW5jaWVzLCB3aGljaCBpc1xuICAvLyB1c2VkIGJ5IChsZWdhY3kpIG1lY2hhbmlzbXMgbGlrZSBsb2FkbW9kZS5qcyB0byBhdXRvbWF0aWNhbGx5XG4gIC8vIGxvYWQgYSBtb2RlLiAoUHJlZmVycmVkIG1lY2hhbmlzbSBpcyB0aGUgcmVxdWlyZS9kZWZpbmUgY2FsbHMuKVxuICBDb2RlTWlycm9yLmRlZmluZU1vZGUgPSBmdW5jdGlvbihuYW1lLCBtb2RlKSB7XG4gICAgaWYgKCFDb2RlTWlycm9yLmRlZmF1bHRzLm1vZGUgJiYgbmFtZSAhPSBcIm51bGxcIikgQ29kZU1pcnJvci5kZWZhdWx0cy5tb2RlID0gbmFtZTtcbiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA+IDIpXG4gICAgICBtb2RlLmRlcGVuZGVuY2llcyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMik7XG4gICAgbW9kZXNbbmFtZV0gPSBtb2RlO1xuICB9O1xuXG4gIENvZGVNaXJyb3IuZGVmaW5lTUlNRSA9IGZ1bmN0aW9uKG1pbWUsIHNwZWMpIHtcbiAgICBtaW1lTW9kZXNbbWltZV0gPSBzcGVjO1xuICB9O1xuXG4gIC8vIEdpdmVuIGEgTUlNRSB0eXBlLCBhIHtuYW1lLCAuLi5vcHRpb25zfSBjb25maWcgb2JqZWN0LCBvciBhIG5hbWVcbiAgLy8gc3RyaW5nLCByZXR1cm4gYSBtb2RlIGNvbmZpZyBvYmplY3QuXG4gIENvZGVNaXJyb3IucmVzb2x2ZU1vZGUgPSBmdW5jdGlvbihzcGVjKSB7XG4gICAgaWYgKHR5cGVvZiBzcGVjID09IFwic3RyaW5nXCIgJiYgbWltZU1vZGVzLmhhc093blByb3BlcnR5KHNwZWMpKSB7XG4gICAgICBzcGVjID0gbWltZU1vZGVzW3NwZWNdO1xuICAgIH0gZWxzZSBpZiAoc3BlYyAmJiB0eXBlb2Ygc3BlYy5uYW1lID09IFwic3RyaW5nXCIgJiYgbWltZU1vZGVzLmhhc093blByb3BlcnR5KHNwZWMubmFtZSkpIHtcbiAgICAgIHZhciBmb3VuZCA9IG1pbWVNb2Rlc1tzcGVjLm5hbWVdO1xuICAgICAgaWYgKHR5cGVvZiBmb3VuZCA9PSBcInN0cmluZ1wiKSBmb3VuZCA9IHtuYW1lOiBmb3VuZH07XG4gICAgICBzcGVjID0gY3JlYXRlT2JqKGZvdW5kLCBzcGVjKTtcbiAgICAgIHNwZWMubmFtZSA9IGZvdW5kLm5hbWU7XG4gICAgfSBlbHNlIGlmICh0eXBlb2Ygc3BlYyA9PSBcInN0cmluZ1wiICYmIC9eW1xcd1xcLV0rXFwvW1xcd1xcLV0rXFwreG1sJC8udGVzdChzcGVjKSkge1xuICAgICAgcmV0dXJuIENvZGVNaXJyb3IucmVzb2x2ZU1vZGUoXCJhcHBsaWNhdGlvbi94bWxcIik7XG4gICAgfVxuICAgIGlmICh0eXBlb2Ygc3BlYyA9PSBcInN0cmluZ1wiKSByZXR1cm4ge25hbWU6IHNwZWN9O1xuICAgIGVsc2UgcmV0dXJuIHNwZWMgfHwge25hbWU6IFwibnVsbFwifTtcbiAgfTtcblxuICAvLyBHaXZlbiBhIG1vZGUgc3BlYyAoYW55dGhpbmcgdGhhdCByZXNvbHZlTW9kZSBhY2NlcHRzKSwgZmluZCBhbmRcbiAgLy8gaW5pdGlhbGl6ZSBhbiBhY3R1YWwgbW9kZSBvYmplY3QuXG4gIENvZGVNaXJyb3IuZ2V0TW9kZSA9IGZ1bmN0aW9uKG9wdGlvbnMsIHNwZWMpIHtcbiAgICB2YXIgc3BlYyA9IENvZGVNaXJyb3IucmVzb2x2ZU1vZGUoc3BlYyk7XG4gICAgdmFyIG1mYWN0b3J5ID0gbW9kZXNbc3BlYy5uYW1lXTtcbiAgICBpZiAoIW1mYWN0b3J5KSByZXR1cm4gQ29kZU1pcnJvci5nZXRNb2RlKG9wdGlvbnMsIFwidGV4dC9wbGFpblwiKTtcbiAgICB2YXIgbW9kZU9iaiA9IG1mYWN0b3J5KG9wdGlvbnMsIHNwZWMpO1xuICAgIGlmIChtb2RlRXh0ZW5zaW9ucy5oYXNPd25Qcm9wZXJ0eShzcGVjLm5hbWUpKSB7XG4gICAgICB2YXIgZXh0cyA9IG1vZGVFeHRlbnNpb25zW3NwZWMubmFtZV07XG4gICAgICBmb3IgKHZhciBwcm9wIGluIGV4dHMpIHtcbiAgICAgICAgaWYgKCFleHRzLmhhc093blByb3BlcnR5KHByb3ApKSBjb250aW51ZTtcbiAgICAgICAgaWYgKG1vZGVPYmouaGFzT3duUHJvcGVydHkocHJvcCkpIG1vZGVPYmpbXCJfXCIgKyBwcm9wXSA9IG1vZGVPYmpbcHJvcF07XG4gICAgICAgIG1vZGVPYmpbcHJvcF0gPSBleHRzW3Byb3BdO1xuICAgICAgfVxuICAgIH1cbiAgICBtb2RlT2JqLm5hbWUgPSBzcGVjLm5hbWU7XG4gICAgaWYgKHNwZWMuaGVscGVyVHlwZSkgbW9kZU9iai5oZWxwZXJUeXBlID0gc3BlYy5oZWxwZXJUeXBlO1xuICAgIGlmIChzcGVjLm1vZGVQcm9wcykgZm9yICh2YXIgcHJvcCBpbiBzcGVjLm1vZGVQcm9wcylcbiAgICAgIG1vZGVPYmpbcHJvcF0gPSBzcGVjLm1vZGVQcm9wc1twcm9wXTtcblxuICAgIHJldHVybiBtb2RlT2JqO1xuICB9O1xuXG4gIC8vIE1pbmltYWwgZGVmYXVsdCBtb2RlLlxuICBDb2RlTWlycm9yLmRlZmluZU1vZGUoXCJudWxsXCIsIGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB7dG9rZW46IGZ1bmN0aW9uKHN0cmVhbSkge3N0cmVhbS5za2lwVG9FbmQoKTt9fTtcbiAgfSk7XG4gIENvZGVNaXJyb3IuZGVmaW5lTUlNRShcInRleHQvcGxhaW5cIiwgXCJudWxsXCIpO1xuXG4gIC8vIFRoaXMgY2FuIGJlIHVzZWQgdG8gYXR0YWNoIHByb3BlcnRpZXMgdG8gbW9kZSBvYmplY3RzIGZyb21cbiAgLy8gb3V0c2lkZSB0aGUgYWN0dWFsIG1vZGUgZGVmaW5pdGlvbi5cbiAgdmFyIG1vZGVFeHRlbnNpb25zID0gQ29kZU1pcnJvci5tb2RlRXh0ZW5zaW9ucyA9IHt9O1xuICBDb2RlTWlycm9yLmV4dGVuZE1vZGUgPSBmdW5jdGlvbihtb2RlLCBwcm9wZXJ0aWVzKSB7XG4gICAgdmFyIGV4dHMgPSBtb2RlRXh0ZW5zaW9ucy5oYXNPd25Qcm9wZXJ0eShtb2RlKSA/IG1vZGVFeHRlbnNpb25zW21vZGVdIDogKG1vZGVFeHRlbnNpb25zW21vZGVdID0ge30pO1xuICAgIGNvcHlPYmoocHJvcGVydGllcywgZXh0cyk7XG4gIH07XG5cbiAgLy8gRVhURU5TSU9OU1xuXG4gIENvZGVNaXJyb3IuZGVmaW5lRXh0ZW5zaW9uID0gZnVuY3Rpb24obmFtZSwgZnVuYykge1xuICAgIENvZGVNaXJyb3IucHJvdG90eXBlW25hbWVdID0gZnVuYztcbiAgfTtcbiAgQ29kZU1pcnJvci5kZWZpbmVEb2NFeHRlbnNpb24gPSBmdW5jdGlvbihuYW1lLCBmdW5jKSB7XG4gICAgRG9jLnByb3RvdHlwZVtuYW1lXSA9IGZ1bmM7XG4gIH07XG4gIENvZGVNaXJyb3IuZGVmaW5lT3B0aW9uID0gb3B0aW9uO1xuXG4gIHZhciBpbml0SG9va3MgPSBbXTtcbiAgQ29kZU1pcnJvci5kZWZpbmVJbml0SG9vayA9IGZ1bmN0aW9uKGYpIHtpbml0SG9va3MucHVzaChmKTt9O1xuXG4gIHZhciBoZWxwZXJzID0gQ29kZU1pcnJvci5oZWxwZXJzID0ge307XG4gIENvZGVNaXJyb3IucmVnaXN0ZXJIZWxwZXIgPSBmdW5jdGlvbih0eXBlLCBuYW1lLCB2YWx1ZSkge1xuICAgIGlmICghaGVscGVycy5oYXNPd25Qcm9wZXJ0eSh0eXBlKSkgaGVscGVyc1t0eXBlXSA9IENvZGVNaXJyb3JbdHlwZV0gPSB7X2dsb2JhbDogW119O1xuICAgIGhlbHBlcnNbdHlwZV1bbmFtZV0gPSB2YWx1ZTtcbiAgfTtcbiAgQ29kZU1pcnJvci5yZWdpc3Rlckdsb2JhbEhlbHBlciA9IGZ1bmN0aW9uKHR5cGUsIG5hbWUsIHByZWRpY2F0ZSwgdmFsdWUpIHtcbiAgICBDb2RlTWlycm9yLnJlZ2lzdGVySGVscGVyKHR5cGUsIG5hbWUsIHZhbHVlKTtcbiAgICBoZWxwZXJzW3R5cGVdLl9nbG9iYWwucHVzaCh7cHJlZDogcHJlZGljYXRlLCB2YWw6IHZhbHVlfSk7XG4gIH07XG5cbiAgLy8gTU9ERSBTVEFURSBIQU5ETElOR1xuXG4gIC8vIFV0aWxpdHkgZnVuY3Rpb25zIGZvciB3b3JraW5nIHdpdGggc3RhdGUuIEV4cG9ydGVkIGJlY2F1c2UgbmVzdGVkXG4gIC8vIG1vZGVzIG5lZWQgdG8gZG8gdGhpcyBmb3IgdGhlaXIgaW5uZXIgbW9kZXMuXG5cbiAgdmFyIGNvcHlTdGF0ZSA9IENvZGVNaXJyb3IuY29weVN0YXRlID0gZnVuY3Rpb24obW9kZSwgc3RhdGUpIHtcbiAgICBpZiAoc3RhdGUgPT09IHRydWUpIHJldHVybiBzdGF0ZTtcbiAgICBpZiAobW9kZS5jb3B5U3RhdGUpIHJldHVybiBtb2RlLmNvcHlTdGF0ZShzdGF0ZSk7XG4gICAgdmFyIG5zdGF0ZSA9IHt9O1xuICAgIGZvciAodmFyIG4gaW4gc3RhdGUpIHtcbiAgICAgIHZhciB2YWwgPSBzdGF0ZVtuXTtcbiAgICAgIGlmICh2YWwgaW5zdGFuY2VvZiBBcnJheSkgdmFsID0gdmFsLmNvbmNhdChbXSk7XG4gICAgICBuc3RhdGVbbl0gPSB2YWw7XG4gICAgfVxuICAgIHJldHVybiBuc3RhdGU7XG4gIH07XG5cbiAgdmFyIHN0YXJ0U3RhdGUgPSBDb2RlTWlycm9yLnN0YXJ0U3RhdGUgPSBmdW5jdGlvbihtb2RlLCBhMSwgYTIpIHtcbiAgICByZXR1cm4gbW9kZS5zdGFydFN0YXRlID8gbW9kZS5zdGFydFN0YXRlKGExLCBhMikgOiB0cnVlO1xuICB9O1xuXG4gIC8vIEdpdmVuIGEgbW9kZSBhbmQgYSBzdGF0ZSAoZm9yIHRoYXQgbW9kZSksIGZpbmQgdGhlIGlubmVyIG1vZGUgYW5kXG4gIC8vIHN0YXRlIGF0IHRoZSBwb3NpdGlvbiB0aGF0IHRoZSBzdGF0ZSByZWZlcnMgdG8uXG4gIENvZGVNaXJyb3IuaW5uZXJNb2RlID0gZnVuY3Rpb24obW9kZSwgc3RhdGUpIHtcbiAgICB3aGlsZSAobW9kZS5pbm5lck1vZGUpIHtcbiAgICAgIHZhciBpbmZvID0gbW9kZS5pbm5lck1vZGUoc3RhdGUpO1xuICAgICAgaWYgKCFpbmZvIHx8IGluZm8ubW9kZSA9PSBtb2RlKSBicmVhaztcbiAgICAgIHN0YXRlID0gaW5mby5zdGF0ZTtcbiAgICAgIG1vZGUgPSBpbmZvLm1vZGU7XG4gICAgfVxuICAgIHJldHVybiBpbmZvIHx8IHttb2RlOiBtb2RlLCBzdGF0ZTogc3RhdGV9O1xuICB9O1xuXG4gIC8vIFNUQU5EQVJEIENPTU1BTkRTXG5cbiAgLy8gQ29tbWFuZHMgYXJlIHBhcmFtZXRlci1sZXNzIGFjdGlvbnMgdGhhdCBjYW4gYmUgcGVyZm9ybWVkIG9uIGFuXG4gIC8vIGVkaXRvciwgbW9zdGx5IHVzZWQgZm9yIGtleWJpbmRpbmdzLlxuICB2YXIgY29tbWFuZHMgPSBDb2RlTWlycm9yLmNvbW1hbmRzID0ge1xuICAgIHNlbGVjdEFsbDogZnVuY3Rpb24oY20pIHtjbS5zZXRTZWxlY3Rpb24oUG9zKGNtLmZpcnN0TGluZSgpLCAwKSwgUG9zKGNtLmxhc3RMaW5lKCkpLCBzZWxfZG9udFNjcm9sbCk7fSxcbiAgICBzaW5nbGVTZWxlY3Rpb246IGZ1bmN0aW9uKGNtKSB7XG4gICAgICBjbS5zZXRTZWxlY3Rpb24oY20uZ2V0Q3Vyc29yKFwiYW5jaG9yXCIpLCBjbS5nZXRDdXJzb3IoXCJoZWFkXCIpLCBzZWxfZG9udFNjcm9sbCk7XG4gICAgfSxcbiAgICBraWxsTGluZTogZnVuY3Rpb24oY20pIHtcbiAgICAgIGRlbGV0ZU5lYXJTZWxlY3Rpb24oY20sIGZ1bmN0aW9uKHJhbmdlKSB7XG4gICAgICAgIGlmIChyYW5nZS5lbXB0eSgpKSB7XG4gICAgICAgICAgdmFyIGxlbiA9IGdldExpbmUoY20uZG9jLCByYW5nZS5oZWFkLmxpbmUpLnRleHQubGVuZ3RoO1xuICAgICAgICAgIGlmIChyYW5nZS5oZWFkLmNoID09IGxlbiAmJiByYW5nZS5oZWFkLmxpbmUgPCBjbS5sYXN0TGluZSgpKVxuICAgICAgICAgICAgcmV0dXJuIHtmcm9tOiByYW5nZS5oZWFkLCB0bzogUG9zKHJhbmdlLmhlYWQubGluZSArIDEsIDApfTtcbiAgICAgICAgICBlbHNlXG4gICAgICAgICAgICByZXR1cm4ge2Zyb206IHJhbmdlLmhlYWQsIHRvOiBQb3MocmFuZ2UuaGVhZC5saW5lLCBsZW4pfTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4ge2Zyb206IHJhbmdlLmZyb20oKSwgdG86IHJhbmdlLnRvKCl9O1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9LFxuICAgIGRlbGV0ZUxpbmU6IGZ1bmN0aW9uKGNtKSB7XG4gICAgICBkZWxldGVOZWFyU2VsZWN0aW9uKGNtLCBmdW5jdGlvbihyYW5nZSkge1xuICAgICAgICByZXR1cm4ge2Zyb206IFBvcyhyYW5nZS5mcm9tKCkubGluZSwgMCksXG4gICAgICAgICAgICAgICAgdG86IGNsaXBQb3MoY20uZG9jLCBQb3MocmFuZ2UudG8oKS5saW5lICsgMSwgMCkpfTtcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgZGVsTGluZUxlZnQ6IGZ1bmN0aW9uKGNtKSB7XG4gICAgICBkZWxldGVOZWFyU2VsZWN0aW9uKGNtLCBmdW5jdGlvbihyYW5nZSkge1xuICAgICAgICByZXR1cm4ge2Zyb206IFBvcyhyYW5nZS5mcm9tKCkubGluZSwgMCksIHRvOiByYW5nZS5mcm9tKCl9O1xuICAgICAgfSk7XG4gICAgfSxcbiAgICBkZWxXcmFwcGVkTGluZUxlZnQ6IGZ1bmN0aW9uKGNtKSB7XG4gICAgICBkZWxldGVOZWFyU2VsZWN0aW9uKGNtLCBmdW5jdGlvbihyYW5nZSkge1xuICAgICAgICB2YXIgdG9wID0gY20uY2hhckNvb3JkcyhyYW5nZS5oZWFkLCBcImRpdlwiKS50b3AgKyA1O1xuICAgICAgICB2YXIgbGVmdFBvcyA9IGNtLmNvb3Jkc0NoYXIoe2xlZnQ6IDAsIHRvcDogdG9wfSwgXCJkaXZcIik7XG4gICAgICAgIHJldHVybiB7ZnJvbTogbGVmdFBvcywgdG86IHJhbmdlLmZyb20oKX07XG4gICAgICB9KTtcbiAgICB9LFxuICAgIGRlbFdyYXBwZWRMaW5lUmlnaHQ6IGZ1bmN0aW9uKGNtKSB7XG4gICAgICBkZWxldGVOZWFyU2VsZWN0aW9uKGNtLCBmdW5jdGlvbihyYW5nZSkge1xuICAgICAgICB2YXIgdG9wID0gY20uY2hhckNvb3JkcyhyYW5nZS5oZWFkLCBcImRpdlwiKS50b3AgKyA1O1xuICAgICAgICB2YXIgcmlnaHRQb3MgPSBjbS5jb29yZHNDaGFyKHtsZWZ0OiBjbS5kaXNwbGF5LmxpbmVEaXYub2Zmc2V0V2lkdGggKyAxMDAsIHRvcDogdG9wfSwgXCJkaXZcIik7XG4gICAgICAgIHJldHVybiB7ZnJvbTogcmFuZ2UuZnJvbSgpLCB0bzogcmlnaHRQb3MgfTtcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgdW5kbzogZnVuY3Rpb24oY20pIHtjbS51bmRvKCk7fSxcbiAgICByZWRvOiBmdW5jdGlvbihjbSkge2NtLnJlZG8oKTt9LFxuICAgIHVuZG9TZWxlY3Rpb246IGZ1bmN0aW9uKGNtKSB7Y20udW5kb1NlbGVjdGlvbigpO30sXG4gICAgcmVkb1NlbGVjdGlvbjogZnVuY3Rpb24oY20pIHtjbS5yZWRvU2VsZWN0aW9uKCk7fSxcbiAgICBnb0RvY1N0YXJ0OiBmdW5jdGlvbihjbSkge2NtLmV4dGVuZFNlbGVjdGlvbihQb3MoY20uZmlyc3RMaW5lKCksIDApKTt9LFxuICAgIGdvRG9jRW5kOiBmdW5jdGlvbihjbSkge2NtLmV4dGVuZFNlbGVjdGlvbihQb3MoY20ubGFzdExpbmUoKSkpO30sXG4gICAgZ29MaW5lU3RhcnQ6IGZ1bmN0aW9uKGNtKSB7XG4gICAgICBjbS5leHRlbmRTZWxlY3Rpb25zQnkoZnVuY3Rpb24ocmFuZ2UpIHsgcmV0dXJuIGxpbmVTdGFydChjbSwgcmFuZ2UuaGVhZC5saW5lKTsgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7b3JpZ2luOiBcIittb3ZlXCIsIGJpYXM6IDF9KTtcbiAgICB9LFxuICAgIGdvTGluZVN0YXJ0U21hcnQ6IGZ1bmN0aW9uKGNtKSB7XG4gICAgICBjbS5leHRlbmRTZWxlY3Rpb25zQnkoZnVuY3Rpb24ocmFuZ2UpIHtcbiAgICAgICAgcmV0dXJuIGxpbmVTdGFydFNtYXJ0KGNtLCByYW5nZS5oZWFkKTtcbiAgICAgIH0sIHtvcmlnaW46IFwiK21vdmVcIiwgYmlhczogMX0pO1xuICAgIH0sXG4gICAgZ29MaW5lRW5kOiBmdW5jdGlvbihjbSkge1xuICAgICAgY20uZXh0ZW5kU2VsZWN0aW9uc0J5KGZ1bmN0aW9uKHJhbmdlKSB7IHJldHVybiBsaW5lRW5kKGNtLCByYW5nZS5oZWFkLmxpbmUpOyB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtvcmlnaW46IFwiK21vdmVcIiwgYmlhczogLTF9KTtcbiAgICB9LFxuICAgIGdvTGluZVJpZ2h0OiBmdW5jdGlvbihjbSkge1xuICAgICAgY20uZXh0ZW5kU2VsZWN0aW9uc0J5KGZ1bmN0aW9uKHJhbmdlKSB7XG4gICAgICAgIHZhciB0b3AgPSBjbS5jaGFyQ29vcmRzKHJhbmdlLmhlYWQsIFwiZGl2XCIpLnRvcCArIDU7XG4gICAgICAgIHJldHVybiBjbS5jb29yZHNDaGFyKHtsZWZ0OiBjbS5kaXNwbGF5LmxpbmVEaXYub2Zmc2V0V2lkdGggKyAxMDAsIHRvcDogdG9wfSwgXCJkaXZcIik7XG4gICAgICB9LCBzZWxfbW92ZSk7XG4gICAgfSxcbiAgICBnb0xpbmVMZWZ0OiBmdW5jdGlvbihjbSkge1xuICAgICAgY20uZXh0ZW5kU2VsZWN0aW9uc0J5KGZ1bmN0aW9uKHJhbmdlKSB7XG4gICAgICAgIHZhciB0b3AgPSBjbS5jaGFyQ29vcmRzKHJhbmdlLmhlYWQsIFwiZGl2XCIpLnRvcCArIDU7XG4gICAgICAgIHJldHVybiBjbS5jb29yZHNDaGFyKHtsZWZ0OiAwLCB0b3A6IHRvcH0sIFwiZGl2XCIpO1xuICAgICAgfSwgc2VsX21vdmUpO1xuICAgIH0sXG4gICAgZ29MaW5lTGVmdFNtYXJ0OiBmdW5jdGlvbihjbSkge1xuICAgICAgY20uZXh0ZW5kU2VsZWN0aW9uc0J5KGZ1bmN0aW9uKHJhbmdlKSB7XG4gICAgICAgIHZhciB0b3AgPSBjbS5jaGFyQ29vcmRzKHJhbmdlLmhlYWQsIFwiZGl2XCIpLnRvcCArIDU7XG4gICAgICAgIHZhciBwb3MgPSBjbS5jb29yZHNDaGFyKHtsZWZ0OiAwLCB0b3A6IHRvcH0sIFwiZGl2XCIpO1xuICAgICAgICBpZiAocG9zLmNoIDwgY20uZ2V0TGluZShwb3MubGluZSkuc2VhcmNoKC9cXFMvKSkgcmV0dXJuIGxpbmVTdGFydFNtYXJ0KGNtLCByYW5nZS5oZWFkKTtcbiAgICAgICAgcmV0dXJuIHBvcztcbiAgICAgIH0sIHNlbF9tb3ZlKTtcbiAgICB9LFxuICAgIGdvTGluZVVwOiBmdW5jdGlvbihjbSkge2NtLm1vdmVWKC0xLCBcImxpbmVcIik7fSxcbiAgICBnb0xpbmVEb3duOiBmdW5jdGlvbihjbSkge2NtLm1vdmVWKDEsIFwibGluZVwiKTt9LFxuICAgIGdvUGFnZVVwOiBmdW5jdGlvbihjbSkge2NtLm1vdmVWKC0xLCBcInBhZ2VcIik7fSxcbiAgICBnb1BhZ2VEb3duOiBmdW5jdGlvbihjbSkge2NtLm1vdmVWKDEsIFwicGFnZVwiKTt9LFxuICAgIGdvQ2hhckxlZnQ6IGZ1bmN0aW9uKGNtKSB7Y20ubW92ZUgoLTEsIFwiY2hhclwiKTt9LFxuICAgIGdvQ2hhclJpZ2h0OiBmdW5jdGlvbihjbSkge2NtLm1vdmVIKDEsIFwiY2hhclwiKTt9LFxuICAgIGdvQ29sdW1uTGVmdDogZnVuY3Rpb24oY20pIHtjbS5tb3ZlSCgtMSwgXCJjb2x1bW5cIik7fSxcbiAgICBnb0NvbHVtblJpZ2h0OiBmdW5jdGlvbihjbSkge2NtLm1vdmVIKDEsIFwiY29sdW1uXCIpO30sXG4gICAgZ29Xb3JkTGVmdDogZnVuY3Rpb24oY20pIHtjbS5tb3ZlSCgtMSwgXCJ3b3JkXCIpO30sXG4gICAgZ29Hcm91cFJpZ2h0OiBmdW5jdGlvbihjbSkge2NtLm1vdmVIKDEsIFwiZ3JvdXBcIik7fSxcbiAgICBnb0dyb3VwTGVmdDogZnVuY3Rpb24oY20pIHtjbS5tb3ZlSCgtMSwgXCJncm91cFwiKTt9LFxuICAgIGdvV29yZFJpZ2h0OiBmdW5jdGlvbihjbSkge2NtLm1vdmVIKDEsIFwid29yZFwiKTt9LFxuICAgIGRlbENoYXJCZWZvcmU6IGZ1bmN0aW9uKGNtKSB7Y20uZGVsZXRlSCgtMSwgXCJjaGFyXCIpO30sXG4gICAgZGVsQ2hhckFmdGVyOiBmdW5jdGlvbihjbSkge2NtLmRlbGV0ZUgoMSwgXCJjaGFyXCIpO30sXG4gICAgZGVsV29yZEJlZm9yZTogZnVuY3Rpb24oY20pIHtjbS5kZWxldGVIKC0xLCBcIndvcmRcIik7fSxcbiAgICBkZWxXb3JkQWZ0ZXI6IGZ1bmN0aW9uKGNtKSB7Y20uZGVsZXRlSCgxLCBcIndvcmRcIik7fSxcbiAgICBkZWxHcm91cEJlZm9yZTogZnVuY3Rpb24oY20pIHtjbS5kZWxldGVIKC0xLCBcImdyb3VwXCIpO30sXG4gICAgZGVsR3JvdXBBZnRlcjogZnVuY3Rpb24oY20pIHtjbS5kZWxldGVIKDEsIFwiZ3JvdXBcIik7fSxcbiAgICBpbmRlbnRBdXRvOiBmdW5jdGlvbihjbSkge2NtLmluZGVudFNlbGVjdGlvbihcInNtYXJ0XCIpO30sXG4gICAgaW5kZW50TW9yZTogZnVuY3Rpb24oY20pIHtjbS5pbmRlbnRTZWxlY3Rpb24oXCJhZGRcIik7fSxcbiAgICBpbmRlbnRMZXNzOiBmdW5jdGlvbihjbSkge2NtLmluZGVudFNlbGVjdGlvbihcInN1YnRyYWN0XCIpO30sXG4gICAgaW5zZXJ0VGFiOiBmdW5jdGlvbihjbSkge2NtLnJlcGxhY2VTZWxlY3Rpb24oXCJcXHRcIik7fSxcbiAgICBpbnNlcnRTb2Z0VGFiOiBmdW5jdGlvbihjbSkge1xuICAgICAgdmFyIHNwYWNlcyA9IFtdLCByYW5nZXMgPSBjbS5saXN0U2VsZWN0aW9ucygpLCB0YWJTaXplID0gY20ub3B0aW9ucy50YWJTaXplO1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCByYW5nZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgdmFyIHBvcyA9IHJhbmdlc1tpXS5mcm9tKCk7XG4gICAgICAgIHZhciBjb2wgPSBjb3VudENvbHVtbihjbS5nZXRMaW5lKHBvcy5saW5lKSwgcG9zLmNoLCB0YWJTaXplKTtcbiAgICAgICAgc3BhY2VzLnB1c2gobmV3IEFycmF5KHRhYlNpemUgLSBjb2wgJSB0YWJTaXplICsgMSkuam9pbihcIiBcIikpO1xuICAgICAgfVxuICAgICAgY20ucmVwbGFjZVNlbGVjdGlvbnMoc3BhY2VzKTtcbiAgICB9LFxuICAgIGRlZmF1bHRUYWI6IGZ1bmN0aW9uKGNtKSB7XG4gICAgICBpZiAoY20uc29tZXRoaW5nU2VsZWN0ZWQoKSkgY20uaW5kZW50U2VsZWN0aW9uKFwiYWRkXCIpO1xuICAgICAgZWxzZSBjbS5leGVjQ29tbWFuZChcImluc2VydFRhYlwiKTtcbiAgICB9LFxuICAgIHRyYW5zcG9zZUNoYXJzOiBmdW5jdGlvbihjbSkge1xuICAgICAgcnVuSW5PcChjbSwgZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciByYW5nZXMgPSBjbS5saXN0U2VsZWN0aW9ucygpLCBuZXdTZWwgPSBbXTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCByYW5nZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICB2YXIgY3VyID0gcmFuZ2VzW2ldLmhlYWQsIGxpbmUgPSBnZXRMaW5lKGNtLmRvYywgY3VyLmxpbmUpLnRleHQ7XG4gICAgICAgICAgaWYgKGxpbmUpIHtcbiAgICAgICAgICAgIGlmIChjdXIuY2ggPT0gbGluZS5sZW5ndGgpIGN1ciA9IG5ldyBQb3MoY3VyLmxpbmUsIGN1ci5jaCAtIDEpO1xuICAgICAgICAgICAgaWYgKGN1ci5jaCA+IDApIHtcbiAgICAgICAgICAgICAgY3VyID0gbmV3IFBvcyhjdXIubGluZSwgY3VyLmNoICsgMSk7XG4gICAgICAgICAgICAgIGNtLnJlcGxhY2VSYW5nZShsaW5lLmNoYXJBdChjdXIuY2ggLSAxKSArIGxpbmUuY2hhckF0KGN1ci5jaCAtIDIpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUG9zKGN1ci5saW5lLCBjdXIuY2ggLSAyKSwgY3VyLCBcIit0cmFuc3Bvc2VcIik7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGN1ci5saW5lID4gY20uZG9jLmZpcnN0KSB7XG4gICAgICAgICAgICAgIHZhciBwcmV2ID0gZ2V0TGluZShjbS5kb2MsIGN1ci5saW5lIC0gMSkudGV4dDtcbiAgICAgICAgICAgICAgaWYgKHByZXYpXG4gICAgICAgICAgICAgICAgY20ucmVwbGFjZVJhbmdlKGxpbmUuY2hhckF0KDApICsgY20uZG9jLmxpbmVTZXBhcmF0b3IoKSArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByZXYuY2hhckF0KHByZXYubGVuZ3RoIC0gMSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBvcyhjdXIubGluZSAtIDEsIHByZXYubGVuZ3RoIC0gMSksIFBvcyhjdXIubGluZSwgMSksIFwiK3RyYW5zcG9zZVwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgbmV3U2VsLnB1c2gobmV3IFJhbmdlKGN1ciwgY3VyKSk7XG4gICAgICAgIH1cbiAgICAgICAgY20uc2V0U2VsZWN0aW9ucyhuZXdTZWwpO1xuICAgICAgfSk7XG4gICAgfSxcbiAgICBuZXdsaW5lQW5kSW5kZW50OiBmdW5jdGlvbihjbSkge1xuICAgICAgcnVuSW5PcChjbSwgZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBsZW4gPSBjbS5saXN0U2VsZWN0aW9ucygpLmxlbmd0aDtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW47IGkrKykge1xuICAgICAgICAgIHZhciByYW5nZSA9IGNtLmxpc3RTZWxlY3Rpb25zKClbaV07XG4gICAgICAgICAgY20ucmVwbGFjZVJhbmdlKGNtLmRvYy5saW5lU2VwYXJhdG9yKCksIHJhbmdlLmFuY2hvciwgcmFuZ2UuaGVhZCwgXCIraW5wdXRcIik7XG4gICAgICAgICAgY20uaW5kZW50TGluZShyYW5nZS5mcm9tKCkubGluZSArIDEsIG51bGwsIHRydWUpO1xuICAgICAgICB9XG4gICAgICAgIGVuc3VyZUN1cnNvclZpc2libGUoY20pO1xuICAgICAgfSk7XG4gICAgfSxcbiAgICB0b2dnbGVPdmVyd3JpdGU6IGZ1bmN0aW9uKGNtKSB7Y20udG9nZ2xlT3ZlcndyaXRlKCk7fVxuICB9O1xuXG5cbiAgLy8gU1RBTkRBUkQgS0VZTUFQU1xuXG4gIHZhciBrZXlNYXAgPSBDb2RlTWlycm9yLmtleU1hcCA9IHt9O1xuXG4gIGtleU1hcC5iYXNpYyA9IHtcbiAgICBcIkxlZnRcIjogXCJnb0NoYXJMZWZ0XCIsIFwiUmlnaHRcIjogXCJnb0NoYXJSaWdodFwiLCBcIlVwXCI6IFwiZ29MaW5lVXBcIiwgXCJEb3duXCI6IFwiZ29MaW5lRG93blwiLFxuICAgIFwiRW5kXCI6IFwiZ29MaW5lRW5kXCIsIFwiSG9tZVwiOiBcImdvTGluZVN0YXJ0U21hcnRcIiwgXCJQYWdlVXBcIjogXCJnb1BhZ2VVcFwiLCBcIlBhZ2VEb3duXCI6IFwiZ29QYWdlRG93blwiLFxuICAgIFwiRGVsZXRlXCI6IFwiZGVsQ2hhckFmdGVyXCIsIFwiQmFja3NwYWNlXCI6IFwiZGVsQ2hhckJlZm9yZVwiLCBcIlNoaWZ0LUJhY2tzcGFjZVwiOiBcImRlbENoYXJCZWZvcmVcIixcbiAgICBcIlRhYlwiOiBcImRlZmF1bHRUYWJcIiwgXCJTaGlmdC1UYWJcIjogXCJpbmRlbnRBdXRvXCIsXG4gICAgXCJFbnRlclwiOiBcIm5ld2xpbmVBbmRJbmRlbnRcIiwgXCJJbnNlcnRcIjogXCJ0b2dnbGVPdmVyd3JpdGVcIixcbiAgICBcIkVzY1wiOiBcInNpbmdsZVNlbGVjdGlvblwiXG4gIH07XG4gIC8vIE5vdGUgdGhhdCB0aGUgc2F2ZSBhbmQgZmluZC1yZWxhdGVkIGNvbW1hbmRzIGFyZW4ndCBkZWZpbmVkIGJ5XG4gIC8vIGRlZmF1bHQuIFVzZXIgY29kZSBvciBhZGRvbnMgY2FuIGRlZmluZSB0aGVtLiBVbmtub3duIGNvbW1hbmRzXG4gIC8vIGFyZSBzaW1wbHkgaWdub3JlZC5cbiAga2V5TWFwLnBjRGVmYXVsdCA9IHtcbiAgICBcIkN0cmwtQVwiOiBcInNlbGVjdEFsbFwiLCBcIkN0cmwtRFwiOiBcImRlbGV0ZUxpbmVcIiwgXCJDdHJsLVpcIjogXCJ1bmRvXCIsIFwiU2hpZnQtQ3RybC1aXCI6IFwicmVkb1wiLCBcIkN0cmwtWVwiOiBcInJlZG9cIixcbiAgICBcIkN0cmwtSG9tZVwiOiBcImdvRG9jU3RhcnRcIiwgXCJDdHJsLUVuZFwiOiBcImdvRG9jRW5kXCIsIFwiQ3RybC1VcFwiOiBcImdvTGluZVVwXCIsIFwiQ3RybC1Eb3duXCI6IFwiZ29MaW5lRG93blwiLFxuICAgIFwiQ3RybC1MZWZ0XCI6IFwiZ29Hcm91cExlZnRcIiwgXCJDdHJsLVJpZ2h0XCI6IFwiZ29Hcm91cFJpZ2h0XCIsIFwiQWx0LUxlZnRcIjogXCJnb0xpbmVTdGFydFwiLCBcIkFsdC1SaWdodFwiOiBcImdvTGluZUVuZFwiLFxuICAgIFwiQ3RybC1CYWNrc3BhY2VcIjogXCJkZWxHcm91cEJlZm9yZVwiLCBcIkN0cmwtRGVsZXRlXCI6IFwiZGVsR3JvdXBBZnRlclwiLCBcIkN0cmwtU1wiOiBcInNhdmVcIiwgXCJDdHJsLUZcIjogXCJmaW5kXCIsXG4gICAgXCJDdHJsLUdcIjogXCJmaW5kTmV4dFwiLCBcIlNoaWZ0LUN0cmwtR1wiOiBcImZpbmRQcmV2XCIsIFwiU2hpZnQtQ3RybC1GXCI6IFwicmVwbGFjZVwiLCBcIlNoaWZ0LUN0cmwtUlwiOiBcInJlcGxhY2VBbGxcIixcbiAgICBcIkN0cmwtW1wiOiBcImluZGVudExlc3NcIiwgXCJDdHJsLV1cIjogXCJpbmRlbnRNb3JlXCIsXG4gICAgXCJDdHJsLVVcIjogXCJ1bmRvU2VsZWN0aW9uXCIsIFwiU2hpZnQtQ3RybC1VXCI6IFwicmVkb1NlbGVjdGlvblwiLCBcIkFsdC1VXCI6IFwicmVkb1NlbGVjdGlvblwiLFxuICAgIGZhbGx0aHJvdWdoOiBcImJhc2ljXCJcbiAgfTtcbiAgLy8gVmVyeSBiYXNpYyByZWFkbGluZS9lbWFjcy1zdHlsZSBiaW5kaW5ncywgd2hpY2ggYXJlIHN0YW5kYXJkIG9uIE1hYy5cbiAga2V5TWFwLmVtYWNzeSA9IHtcbiAgICBcIkN0cmwtRlwiOiBcImdvQ2hhclJpZ2h0XCIsIFwiQ3RybC1CXCI6IFwiZ29DaGFyTGVmdFwiLCBcIkN0cmwtUFwiOiBcImdvTGluZVVwXCIsIFwiQ3RybC1OXCI6IFwiZ29MaW5lRG93blwiLFxuICAgIFwiQWx0LUZcIjogXCJnb1dvcmRSaWdodFwiLCBcIkFsdC1CXCI6IFwiZ29Xb3JkTGVmdFwiLCBcIkN0cmwtQVwiOiBcImdvTGluZVN0YXJ0XCIsIFwiQ3RybC1FXCI6IFwiZ29MaW5lRW5kXCIsXG4gICAgXCJDdHJsLVZcIjogXCJnb1BhZ2VEb3duXCIsIFwiU2hpZnQtQ3RybC1WXCI6IFwiZ29QYWdlVXBcIiwgXCJDdHJsLURcIjogXCJkZWxDaGFyQWZ0ZXJcIiwgXCJDdHJsLUhcIjogXCJkZWxDaGFyQmVmb3JlXCIsXG4gICAgXCJBbHQtRFwiOiBcImRlbFdvcmRBZnRlclwiLCBcIkFsdC1CYWNrc3BhY2VcIjogXCJkZWxXb3JkQmVmb3JlXCIsIFwiQ3RybC1LXCI6IFwia2lsbExpbmVcIiwgXCJDdHJsLVRcIjogXCJ0cmFuc3Bvc2VDaGFyc1wiXG4gIH07XG4gIGtleU1hcC5tYWNEZWZhdWx0ID0ge1xuICAgIFwiQ21kLUFcIjogXCJzZWxlY3RBbGxcIiwgXCJDbWQtRFwiOiBcImRlbGV0ZUxpbmVcIiwgXCJDbWQtWlwiOiBcInVuZG9cIiwgXCJTaGlmdC1DbWQtWlwiOiBcInJlZG9cIiwgXCJDbWQtWVwiOiBcInJlZG9cIixcbiAgICBcIkNtZC1Ib21lXCI6IFwiZ29Eb2NTdGFydFwiLCBcIkNtZC1VcFwiOiBcImdvRG9jU3RhcnRcIiwgXCJDbWQtRW5kXCI6IFwiZ29Eb2NFbmRcIiwgXCJDbWQtRG93blwiOiBcImdvRG9jRW5kXCIsIFwiQWx0LUxlZnRcIjogXCJnb0dyb3VwTGVmdFwiLFxuICAgIFwiQWx0LVJpZ2h0XCI6IFwiZ29Hcm91cFJpZ2h0XCIsIFwiQ21kLUxlZnRcIjogXCJnb0xpbmVMZWZ0XCIsIFwiQ21kLVJpZ2h0XCI6IFwiZ29MaW5lUmlnaHRcIiwgXCJBbHQtQmFja3NwYWNlXCI6IFwiZGVsR3JvdXBCZWZvcmVcIixcbiAgICBcIkN0cmwtQWx0LUJhY2tzcGFjZVwiOiBcImRlbEdyb3VwQWZ0ZXJcIiwgXCJBbHQtRGVsZXRlXCI6IFwiZGVsR3JvdXBBZnRlclwiLCBcIkNtZC1TXCI6IFwic2F2ZVwiLCBcIkNtZC1GXCI6IFwiZmluZFwiLFxuICAgIFwiQ21kLUdcIjogXCJmaW5kTmV4dFwiLCBcIlNoaWZ0LUNtZC1HXCI6IFwiZmluZFByZXZcIiwgXCJDbWQtQWx0LUZcIjogXCJyZXBsYWNlXCIsIFwiU2hpZnQtQ21kLUFsdC1GXCI6IFwicmVwbGFjZUFsbFwiLFxuICAgIFwiQ21kLVtcIjogXCJpbmRlbnRMZXNzXCIsIFwiQ21kLV1cIjogXCJpbmRlbnRNb3JlXCIsIFwiQ21kLUJhY2tzcGFjZVwiOiBcImRlbFdyYXBwZWRMaW5lTGVmdFwiLCBcIkNtZC1EZWxldGVcIjogXCJkZWxXcmFwcGVkTGluZVJpZ2h0XCIsXG4gICAgXCJDbWQtVVwiOiBcInVuZG9TZWxlY3Rpb25cIiwgXCJTaGlmdC1DbWQtVVwiOiBcInJlZG9TZWxlY3Rpb25cIiwgXCJDdHJsLVVwXCI6IFwiZ29Eb2NTdGFydFwiLCBcIkN0cmwtRG93blwiOiBcImdvRG9jRW5kXCIsXG4gICAgZmFsbHRocm91Z2g6IFtcImJhc2ljXCIsIFwiZW1hY3N5XCJdXG4gIH07XG4gIGtleU1hcFtcImRlZmF1bHRcIl0gPSBtYWMgPyBrZXlNYXAubWFjRGVmYXVsdCA6IGtleU1hcC5wY0RlZmF1bHQ7XG5cbiAgLy8gS0VZTUFQIERJU1BBVENIXG5cbiAgZnVuY3Rpb24gbm9ybWFsaXplS2V5TmFtZShuYW1lKSB7XG4gICAgdmFyIHBhcnRzID0gbmFtZS5zcGxpdCgvLSg/ISQpLyksIG5hbWUgPSBwYXJ0c1twYXJ0cy5sZW5ndGggLSAxXTtcbiAgICB2YXIgYWx0LCBjdHJsLCBzaGlmdCwgY21kO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcGFydHMubGVuZ3RoIC0gMTsgaSsrKSB7XG4gICAgICB2YXIgbW9kID0gcGFydHNbaV07XG4gICAgICBpZiAoL14oY21kfG1ldGF8bSkkL2kudGVzdChtb2QpKSBjbWQgPSB0cnVlO1xuICAgICAgZWxzZSBpZiAoL15hKGx0KT8kL2kudGVzdChtb2QpKSBhbHQgPSB0cnVlO1xuICAgICAgZWxzZSBpZiAoL14oY3xjdHJsfGNvbnRyb2wpJC9pLnRlc3QobW9kKSkgY3RybCA9IHRydWU7XG4gICAgICBlbHNlIGlmICgvXnMoaGlmdCkkL2kudGVzdChtb2QpKSBzaGlmdCA9IHRydWU7XG4gICAgICBlbHNlIHRocm93IG5ldyBFcnJvcihcIlVucmVjb2duaXplZCBtb2RpZmllciBuYW1lOiBcIiArIG1vZCk7XG4gICAgfVxuICAgIGlmIChhbHQpIG5hbWUgPSBcIkFsdC1cIiArIG5hbWU7XG4gICAgaWYgKGN0cmwpIG5hbWUgPSBcIkN0cmwtXCIgKyBuYW1lO1xuICAgIGlmIChjbWQpIG5hbWUgPSBcIkNtZC1cIiArIG5hbWU7XG4gICAgaWYgKHNoaWZ0KSBuYW1lID0gXCJTaGlmdC1cIiArIG5hbWU7XG4gICAgcmV0dXJuIG5hbWU7XG4gIH1cblxuICAvLyBUaGlzIGlzIGEga2x1ZGdlIHRvIGtlZXAga2V5bWFwcyBtb3N0bHkgd29ya2luZyBhcyByYXcgb2JqZWN0c1xuICAvLyAoYmFja3dhcmRzIGNvbXBhdGliaWxpdHkpIHdoaWxlIGF0IHRoZSBzYW1lIHRpbWUgc3VwcG9ydCBmZWF0dXJlc1xuICAvLyBsaWtlIG5vcm1hbGl6YXRpb24gYW5kIG11bHRpLXN0cm9rZSBrZXkgYmluZGluZ3MuIEl0IGNvbXBpbGVzIGFcbiAgLy8gbmV3IG5vcm1hbGl6ZWQga2V5bWFwLCBhbmQgdGhlbiB1cGRhdGVzIHRoZSBvbGQgb2JqZWN0IHRvIHJlZmxlY3RcbiAgLy8gdGhpcy5cbiAgQ29kZU1pcnJvci5ub3JtYWxpemVLZXlNYXAgPSBmdW5jdGlvbihrZXltYXApIHtcbiAgICB2YXIgY29weSA9IHt9O1xuICAgIGZvciAodmFyIGtleW5hbWUgaW4ga2V5bWFwKSBpZiAoa2V5bWFwLmhhc093blByb3BlcnR5KGtleW5hbWUpKSB7XG4gICAgICB2YXIgdmFsdWUgPSBrZXltYXBba2V5bmFtZV07XG4gICAgICBpZiAoL14obmFtZXxmYWxsdGhyb3VnaHwoZGV8YXQpdGFjaCkkLy50ZXN0KGtleW5hbWUpKSBjb250aW51ZTtcbiAgICAgIGlmICh2YWx1ZSA9PSBcIi4uLlwiKSB7IGRlbGV0ZSBrZXltYXBba2V5bmFtZV07IGNvbnRpbnVlOyB9XG5cbiAgICAgIHZhciBrZXlzID0gbWFwKGtleW5hbWUuc3BsaXQoXCIgXCIpLCBub3JtYWxpemVLZXlOYW1lKTtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7IGkrKykge1xuICAgICAgICB2YXIgdmFsLCBuYW1lO1xuICAgICAgICBpZiAoaSA9PSBrZXlzLmxlbmd0aCAtIDEpIHtcbiAgICAgICAgICBuYW1lID0ga2V5cy5qb2luKFwiIFwiKTtcbiAgICAgICAgICB2YWwgPSB2YWx1ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBuYW1lID0ga2V5cy5zbGljZSgwLCBpICsgMSkuam9pbihcIiBcIik7XG4gICAgICAgICAgdmFsID0gXCIuLi5cIjtcbiAgICAgICAgfVxuICAgICAgICB2YXIgcHJldiA9IGNvcHlbbmFtZV07XG4gICAgICAgIGlmICghcHJldikgY29weVtuYW1lXSA9IHZhbDtcbiAgICAgICAgZWxzZSBpZiAocHJldiAhPSB2YWwpIHRocm93IG5ldyBFcnJvcihcIkluY29uc2lzdGVudCBiaW5kaW5ncyBmb3IgXCIgKyBuYW1lKTtcbiAgICAgIH1cbiAgICAgIGRlbGV0ZSBrZXltYXBba2V5bmFtZV07XG4gICAgfVxuICAgIGZvciAodmFyIHByb3AgaW4gY29weSkga2V5bWFwW3Byb3BdID0gY29weVtwcm9wXTtcbiAgICByZXR1cm4ga2V5bWFwO1xuICB9O1xuXG4gIHZhciBsb29rdXBLZXkgPSBDb2RlTWlycm9yLmxvb2t1cEtleSA9IGZ1bmN0aW9uKGtleSwgbWFwLCBoYW5kbGUsIGNvbnRleHQpIHtcbiAgICBtYXAgPSBnZXRLZXlNYXAobWFwKTtcbiAgICB2YXIgZm91bmQgPSBtYXAuY2FsbCA/IG1hcC5jYWxsKGtleSwgY29udGV4dCkgOiBtYXBba2V5XTtcbiAgICBpZiAoZm91bmQgPT09IGZhbHNlKSByZXR1cm4gXCJub3RoaW5nXCI7XG4gICAgaWYgKGZvdW5kID09PSBcIi4uLlwiKSByZXR1cm4gXCJtdWx0aVwiO1xuICAgIGlmIChmb3VuZCAhPSBudWxsICYmIGhhbmRsZShmb3VuZCkpIHJldHVybiBcImhhbmRsZWRcIjtcblxuICAgIGlmIChtYXAuZmFsbHRocm91Z2gpIHtcbiAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwobWFwLmZhbGx0aHJvdWdoKSAhPSBcIltvYmplY3QgQXJyYXldXCIpXG4gICAgICAgIHJldHVybiBsb29rdXBLZXkoa2V5LCBtYXAuZmFsbHRocm91Z2gsIGhhbmRsZSwgY29udGV4dCk7XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG1hcC5mYWxsdGhyb3VnaC5sZW5ndGg7IGkrKykge1xuICAgICAgICB2YXIgcmVzdWx0ID0gbG9va3VwS2V5KGtleSwgbWFwLmZhbGx0aHJvdWdoW2ldLCBoYW5kbGUsIGNvbnRleHQpO1xuICAgICAgICBpZiAocmVzdWx0KSByZXR1cm4gcmVzdWx0O1xuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICAvLyBNb2RpZmllciBrZXkgcHJlc3NlcyBkb24ndCBjb3VudCBhcyAncmVhbCcga2V5IHByZXNzZXMgZm9yIHRoZVxuICAvLyBwdXJwb3NlIG9mIGtleW1hcCBmYWxsdGhyb3VnaC5cbiAgdmFyIGlzTW9kaWZpZXJLZXkgPSBDb2RlTWlycm9yLmlzTW9kaWZpZXJLZXkgPSBmdW5jdGlvbih2YWx1ZSkge1xuICAgIHZhciBuYW1lID0gdHlwZW9mIHZhbHVlID09IFwic3RyaW5nXCIgPyB2YWx1ZSA6IGtleU5hbWVzW3ZhbHVlLmtleUNvZGVdO1xuICAgIHJldHVybiBuYW1lID09IFwiQ3RybFwiIHx8IG5hbWUgPT0gXCJBbHRcIiB8fCBuYW1lID09IFwiU2hpZnRcIiB8fCBuYW1lID09IFwiTW9kXCI7XG4gIH07XG5cbiAgLy8gTG9vayB1cCB0aGUgbmFtZSBvZiBhIGtleSBhcyBpbmRpY2F0ZWQgYnkgYW4gZXZlbnQgb2JqZWN0LlxuICB2YXIga2V5TmFtZSA9IENvZGVNaXJyb3Iua2V5TmFtZSA9IGZ1bmN0aW9uKGV2ZW50LCBub1NoaWZ0KSB7XG4gICAgaWYgKHByZXN0byAmJiBldmVudC5rZXlDb2RlID09IDM0ICYmIGV2ZW50W1wiY2hhclwiXSkgcmV0dXJuIGZhbHNlO1xuICAgIHZhciBiYXNlID0ga2V5TmFtZXNbZXZlbnQua2V5Q29kZV0sIG5hbWUgPSBiYXNlO1xuICAgIGlmIChuYW1lID09IG51bGwgfHwgZXZlbnQuYWx0R3JhcGhLZXkpIHJldHVybiBmYWxzZTtcbiAgICBpZiAoZXZlbnQuYWx0S2V5ICYmIGJhc2UgIT0gXCJBbHRcIikgbmFtZSA9IFwiQWx0LVwiICsgbmFtZTtcbiAgICBpZiAoKGZsaXBDdHJsQ21kID8gZXZlbnQubWV0YUtleSA6IGV2ZW50LmN0cmxLZXkpICYmIGJhc2UgIT0gXCJDdHJsXCIpIG5hbWUgPSBcIkN0cmwtXCIgKyBuYW1lO1xuICAgIGlmICgoZmxpcEN0cmxDbWQgPyBldmVudC5jdHJsS2V5IDogZXZlbnQubWV0YUtleSkgJiYgYmFzZSAhPSBcIkNtZFwiKSBuYW1lID0gXCJDbWQtXCIgKyBuYW1lO1xuICAgIGlmICghbm9TaGlmdCAmJiBldmVudC5zaGlmdEtleSAmJiBiYXNlICE9IFwiU2hpZnRcIikgbmFtZSA9IFwiU2hpZnQtXCIgKyBuYW1lO1xuICAgIHJldHVybiBuYW1lO1xuICB9O1xuXG4gIGZ1bmN0aW9uIGdldEtleU1hcCh2YWwpIHtcbiAgICByZXR1cm4gdHlwZW9mIHZhbCA9PSBcInN0cmluZ1wiID8ga2V5TWFwW3ZhbF0gOiB2YWw7XG4gIH1cblxuICAvLyBGUk9NVEVYVEFSRUFcblxuICBDb2RlTWlycm9yLmZyb21UZXh0QXJlYSA9IGZ1bmN0aW9uKHRleHRhcmVhLCBvcHRpb25zKSB7XG4gICAgb3B0aW9ucyA9IG9wdGlvbnMgPyBjb3B5T2JqKG9wdGlvbnMpIDoge307XG4gICAgb3B0aW9ucy52YWx1ZSA9IHRleHRhcmVhLnZhbHVlO1xuICAgIGlmICghb3B0aW9ucy50YWJpbmRleCAmJiB0ZXh0YXJlYS50YWJJbmRleClcbiAgICAgIG9wdGlvbnMudGFiaW5kZXggPSB0ZXh0YXJlYS50YWJJbmRleDtcbiAgICBpZiAoIW9wdGlvbnMucGxhY2Vob2xkZXIgJiYgdGV4dGFyZWEucGxhY2Vob2xkZXIpXG4gICAgICBvcHRpb25zLnBsYWNlaG9sZGVyID0gdGV4dGFyZWEucGxhY2Vob2xkZXI7XG4gICAgLy8gU2V0IGF1dG9mb2N1cyB0byB0cnVlIGlmIHRoaXMgdGV4dGFyZWEgaXMgZm9jdXNlZCwgb3IgaWYgaXQgaGFzXG4gICAgLy8gYXV0b2ZvY3VzIGFuZCBubyBvdGhlciBlbGVtZW50IGlzIGZvY3VzZWQuXG4gICAgaWYgKG9wdGlvbnMuYXV0b2ZvY3VzID09IG51bGwpIHtcbiAgICAgIHZhciBoYXNGb2N1cyA9IGFjdGl2ZUVsdCgpO1xuICAgICAgb3B0aW9ucy5hdXRvZm9jdXMgPSBoYXNGb2N1cyA9PSB0ZXh0YXJlYSB8fFxuICAgICAgICB0ZXh0YXJlYS5nZXRBdHRyaWJ1dGUoXCJhdXRvZm9jdXNcIikgIT0gbnVsbCAmJiBoYXNGb2N1cyA9PSBkb2N1bWVudC5ib2R5O1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHNhdmUoKSB7dGV4dGFyZWEudmFsdWUgPSBjbS5nZXRWYWx1ZSgpO31cbiAgICBpZiAodGV4dGFyZWEuZm9ybSkge1xuICAgICAgb24odGV4dGFyZWEuZm9ybSwgXCJzdWJtaXRcIiwgc2F2ZSk7XG4gICAgICAvLyBEZXBsb3JhYmxlIGhhY2sgdG8gbWFrZSB0aGUgc3VibWl0IG1ldGhvZCBkbyB0aGUgcmlnaHQgdGhpbmcuXG4gICAgICBpZiAoIW9wdGlvbnMubGVhdmVTdWJtaXRNZXRob2RBbG9uZSkge1xuICAgICAgICB2YXIgZm9ybSA9IHRleHRhcmVhLmZvcm0sIHJlYWxTdWJtaXQgPSBmb3JtLnN1Ym1pdDtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICB2YXIgd3JhcHBlZFN1Ym1pdCA9IGZvcm0uc3VibWl0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBzYXZlKCk7XG4gICAgICAgICAgICBmb3JtLnN1Ym1pdCA9IHJlYWxTdWJtaXQ7XG4gICAgICAgICAgICBmb3JtLnN1Ym1pdCgpO1xuICAgICAgICAgICAgZm9ybS5zdWJtaXQgPSB3cmFwcGVkU3VibWl0O1xuICAgICAgICAgIH07XG4gICAgICAgIH0gY2F0Y2goZSkge31cbiAgICAgIH1cbiAgICB9XG5cbiAgICBvcHRpb25zLmZpbmlzaEluaXQgPSBmdW5jdGlvbihjbSkge1xuICAgICAgY20uc2F2ZSA9IHNhdmU7XG4gICAgICBjbS5nZXRUZXh0QXJlYSA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gdGV4dGFyZWE7IH07XG4gICAgICBjbS50b1RleHRBcmVhID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIGNtLnRvVGV4dEFyZWEgPSBpc05hTjsgLy8gUHJldmVudCB0aGlzIGZyb20gYmVpbmcgcmFuIHR3aWNlXG4gICAgICAgIHNhdmUoKTtcbiAgICAgICAgdGV4dGFyZWEucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChjbS5nZXRXcmFwcGVyRWxlbWVudCgpKTtcbiAgICAgICAgdGV4dGFyZWEuc3R5bGUuZGlzcGxheSA9IFwiXCI7XG4gICAgICAgIGlmICh0ZXh0YXJlYS5mb3JtKSB7XG4gICAgICAgICAgb2ZmKHRleHRhcmVhLmZvcm0sIFwic3VibWl0XCIsIHNhdmUpO1xuICAgICAgICAgIGlmICh0eXBlb2YgdGV4dGFyZWEuZm9ybS5zdWJtaXQgPT0gXCJmdW5jdGlvblwiKVxuICAgICAgICAgICAgdGV4dGFyZWEuZm9ybS5zdWJtaXQgPSByZWFsU3VibWl0O1xuICAgICAgICB9XG4gICAgICB9O1xuICAgIH07XG5cbiAgICB0ZXh0YXJlYS5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgdmFyIGNtID0gQ29kZU1pcnJvcihmdW5jdGlvbihub2RlKSB7XG4gICAgICB0ZXh0YXJlYS5wYXJlbnROb2RlLmluc2VydEJlZm9yZShub2RlLCB0ZXh0YXJlYS5uZXh0U2libGluZyk7XG4gICAgfSwgb3B0aW9ucyk7XG4gICAgcmV0dXJuIGNtO1xuICB9O1xuXG4gIC8vIFNUUklORyBTVFJFQU1cblxuICAvLyBGZWQgdG8gdGhlIG1vZGUgcGFyc2VycywgcHJvdmlkZXMgaGVscGVyIGZ1bmN0aW9ucyB0byBtYWtlXG4gIC8vIHBhcnNlcnMgbW9yZSBzdWNjaW5jdC5cblxuICB2YXIgU3RyaW5nU3RyZWFtID0gQ29kZU1pcnJvci5TdHJpbmdTdHJlYW0gPSBmdW5jdGlvbihzdHJpbmcsIHRhYlNpemUpIHtcbiAgICB0aGlzLnBvcyA9IHRoaXMuc3RhcnQgPSAwO1xuICAgIHRoaXMuc3RyaW5nID0gc3RyaW5nO1xuICAgIHRoaXMudGFiU2l6ZSA9IHRhYlNpemUgfHwgODtcbiAgICB0aGlzLmxhc3RDb2x1bW5Qb3MgPSB0aGlzLmxhc3RDb2x1bW5WYWx1ZSA9IDA7XG4gICAgdGhpcy5saW5lU3RhcnQgPSAwO1xuICB9O1xuXG4gIFN0cmluZ1N0cmVhbS5wcm90b3R5cGUgPSB7XG4gICAgZW9sOiBmdW5jdGlvbigpIHtyZXR1cm4gdGhpcy5wb3MgPj0gdGhpcy5zdHJpbmcubGVuZ3RoO30sXG4gICAgc29sOiBmdW5jdGlvbigpIHtyZXR1cm4gdGhpcy5wb3MgPT0gdGhpcy5saW5lU3RhcnQ7fSxcbiAgICBwZWVrOiBmdW5jdGlvbigpIHtyZXR1cm4gdGhpcy5zdHJpbmcuY2hhckF0KHRoaXMucG9zKSB8fCB1bmRlZmluZWQ7fSxcbiAgICBuZXh0OiBmdW5jdGlvbigpIHtcbiAgICAgIGlmICh0aGlzLnBvcyA8IHRoaXMuc3RyaW5nLmxlbmd0aClcbiAgICAgICAgcmV0dXJuIHRoaXMuc3RyaW5nLmNoYXJBdCh0aGlzLnBvcysrKTtcbiAgICB9LFxuICAgIGVhdDogZnVuY3Rpb24obWF0Y2gpIHtcbiAgICAgIHZhciBjaCA9IHRoaXMuc3RyaW5nLmNoYXJBdCh0aGlzLnBvcyk7XG4gICAgICBpZiAodHlwZW9mIG1hdGNoID09IFwic3RyaW5nXCIpIHZhciBvayA9IGNoID09IG1hdGNoO1xuICAgICAgZWxzZSB2YXIgb2sgPSBjaCAmJiAobWF0Y2gudGVzdCA/IG1hdGNoLnRlc3QoY2gpIDogbWF0Y2goY2gpKTtcbiAgICAgIGlmIChvaykgeysrdGhpcy5wb3M7IHJldHVybiBjaDt9XG4gICAgfSxcbiAgICBlYXRXaGlsZTogZnVuY3Rpb24obWF0Y2gpIHtcbiAgICAgIHZhciBzdGFydCA9IHRoaXMucG9zO1xuICAgICAgd2hpbGUgKHRoaXMuZWF0KG1hdGNoKSl7fVxuICAgICAgcmV0dXJuIHRoaXMucG9zID4gc3RhcnQ7XG4gICAgfSxcbiAgICBlYXRTcGFjZTogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgc3RhcnQgPSB0aGlzLnBvcztcbiAgICAgIHdoaWxlICgvW1xcc1xcdTAwYTBdLy50ZXN0KHRoaXMuc3RyaW5nLmNoYXJBdCh0aGlzLnBvcykpKSArK3RoaXMucG9zO1xuICAgICAgcmV0dXJuIHRoaXMucG9zID4gc3RhcnQ7XG4gICAgfSxcbiAgICBza2lwVG9FbmQ6IGZ1bmN0aW9uKCkge3RoaXMucG9zID0gdGhpcy5zdHJpbmcubGVuZ3RoO30sXG4gICAgc2tpcFRvOiBmdW5jdGlvbihjaCkge1xuICAgICAgdmFyIGZvdW5kID0gdGhpcy5zdHJpbmcuaW5kZXhPZihjaCwgdGhpcy5wb3MpO1xuICAgICAgaWYgKGZvdW5kID4gLTEpIHt0aGlzLnBvcyA9IGZvdW5kOyByZXR1cm4gdHJ1ZTt9XG4gICAgfSxcbiAgICBiYWNrVXA6IGZ1bmN0aW9uKG4pIHt0aGlzLnBvcyAtPSBuO30sXG4gICAgY29sdW1uOiBmdW5jdGlvbigpIHtcbiAgICAgIGlmICh0aGlzLmxhc3RDb2x1bW5Qb3MgPCB0aGlzLnN0YXJ0KSB7XG4gICAgICAgIHRoaXMubGFzdENvbHVtblZhbHVlID0gY291bnRDb2x1bW4odGhpcy5zdHJpbmcsIHRoaXMuc3RhcnQsIHRoaXMudGFiU2l6ZSwgdGhpcy5sYXN0Q29sdW1uUG9zLCB0aGlzLmxhc3RDb2x1bW5WYWx1ZSk7XG4gICAgICAgIHRoaXMubGFzdENvbHVtblBvcyA9IHRoaXMuc3RhcnQ7XG4gICAgICB9XG4gICAgICByZXR1cm4gdGhpcy5sYXN0Q29sdW1uVmFsdWUgLSAodGhpcy5saW5lU3RhcnQgPyBjb3VudENvbHVtbih0aGlzLnN0cmluZywgdGhpcy5saW5lU3RhcnQsIHRoaXMudGFiU2l6ZSkgOiAwKTtcbiAgICB9LFxuICAgIGluZGVudGF0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiBjb3VudENvbHVtbih0aGlzLnN0cmluZywgbnVsbCwgdGhpcy50YWJTaXplKSAtXG4gICAgICAgICh0aGlzLmxpbmVTdGFydCA/IGNvdW50Q29sdW1uKHRoaXMuc3RyaW5nLCB0aGlzLmxpbmVTdGFydCwgdGhpcy50YWJTaXplKSA6IDApO1xuICAgIH0sXG4gICAgbWF0Y2g6IGZ1bmN0aW9uKHBhdHRlcm4sIGNvbnN1bWUsIGNhc2VJbnNlbnNpdGl2ZSkge1xuICAgICAgaWYgKHR5cGVvZiBwYXR0ZXJuID09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgdmFyIGNhc2VkID0gZnVuY3Rpb24oc3RyKSB7cmV0dXJuIGNhc2VJbnNlbnNpdGl2ZSA/IHN0ci50b0xvd2VyQ2FzZSgpIDogc3RyO307XG4gICAgICAgIHZhciBzdWJzdHIgPSB0aGlzLnN0cmluZy5zdWJzdHIodGhpcy5wb3MsIHBhdHRlcm4ubGVuZ3RoKTtcbiAgICAgICAgaWYgKGNhc2VkKHN1YnN0cikgPT0gY2FzZWQocGF0dGVybikpIHtcbiAgICAgICAgICBpZiAoY29uc3VtZSAhPT0gZmFsc2UpIHRoaXMucG9zICs9IHBhdHRlcm4ubGVuZ3RoO1xuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgbWF0Y2ggPSB0aGlzLnN0cmluZy5zbGljZSh0aGlzLnBvcykubWF0Y2gocGF0dGVybik7XG4gICAgICAgIGlmIChtYXRjaCAmJiBtYXRjaC5pbmRleCA+IDApIHJldHVybiBudWxsO1xuICAgICAgICBpZiAobWF0Y2ggJiYgY29uc3VtZSAhPT0gZmFsc2UpIHRoaXMucG9zICs9IG1hdGNoWzBdLmxlbmd0aDtcbiAgICAgICAgcmV0dXJuIG1hdGNoO1xuICAgICAgfVxuICAgIH0sXG4gICAgY3VycmVudDogZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5zdHJpbmcuc2xpY2UodGhpcy5zdGFydCwgdGhpcy5wb3MpO30sXG4gICAgaGlkZUZpcnN0Q2hhcnM6IGZ1bmN0aW9uKG4sIGlubmVyKSB7XG4gICAgICB0aGlzLmxpbmVTdGFydCArPSBuO1xuICAgICAgdHJ5IHsgcmV0dXJuIGlubmVyKCk7IH1cbiAgICAgIGZpbmFsbHkgeyB0aGlzLmxpbmVTdGFydCAtPSBuOyB9XG4gICAgfVxuICB9O1xuXG4gIC8vIFRFWFRNQVJLRVJTXG5cbiAgLy8gQ3JlYXRlZCB3aXRoIG1hcmtUZXh0IGFuZCBzZXRCb29rbWFyayBtZXRob2RzLiBBIFRleHRNYXJrZXIgaXMgYVxuICAvLyBoYW5kbGUgdGhhdCBjYW4gYmUgdXNlZCB0byBjbGVhciBvciBmaW5kIGEgbWFya2VkIHBvc2l0aW9uIGluIHRoZVxuICAvLyBkb2N1bWVudC4gTGluZSBvYmplY3RzIGhvbGQgYXJyYXlzIChtYXJrZWRTcGFucykgY29udGFpbmluZ1xuICAvLyB7ZnJvbSwgdG8sIG1hcmtlcn0gb2JqZWN0IHBvaW50aW5nIHRvIHN1Y2ggbWFya2VyIG9iamVjdHMsIGFuZFxuICAvLyBpbmRpY2F0aW5nIHRoYXQgc3VjaCBhIG1hcmtlciBpcyBwcmVzZW50IG9uIHRoYXQgbGluZS4gTXVsdGlwbGVcbiAgLy8gbGluZXMgbWF5IHBvaW50IHRvIHRoZSBzYW1lIG1hcmtlciB3aGVuIGl0IHNwYW5zIGFjcm9zcyBsaW5lcy5cbiAgLy8gVGhlIHNwYW5zIHdpbGwgaGF2ZSBudWxsIGZvciB0aGVpciBmcm9tL3RvIHByb3BlcnRpZXMgd2hlbiB0aGVcbiAgLy8gbWFya2VyIGNvbnRpbnVlcyBiZXlvbmQgdGhlIHN0YXJ0L2VuZCBvZiB0aGUgbGluZS4gTWFya2VycyBoYXZlXG4gIC8vIGxpbmtzIGJhY2sgdG8gdGhlIGxpbmVzIHRoZXkgY3VycmVudGx5IHRvdWNoLlxuXG4gIHZhciBuZXh0TWFya2VySWQgPSAwO1xuXG4gIHZhciBUZXh0TWFya2VyID0gQ29kZU1pcnJvci5UZXh0TWFya2VyID0gZnVuY3Rpb24oZG9jLCB0eXBlKSB7XG4gICAgdGhpcy5saW5lcyA9IFtdO1xuICAgIHRoaXMudHlwZSA9IHR5cGU7XG4gICAgdGhpcy5kb2MgPSBkb2M7XG4gICAgdGhpcy5pZCA9ICsrbmV4dE1hcmtlcklkO1xuICB9O1xuICBldmVudE1peGluKFRleHRNYXJrZXIpO1xuXG4gIC8vIENsZWFyIHRoZSBtYXJrZXIuXG4gIFRleHRNYXJrZXIucHJvdG90eXBlLmNsZWFyID0gZnVuY3Rpb24oKSB7XG4gICAgaWYgKHRoaXMuZXhwbGljaXRseUNsZWFyZWQpIHJldHVybjtcbiAgICB2YXIgY20gPSB0aGlzLmRvYy5jbSwgd2l0aE9wID0gY20gJiYgIWNtLmN1ck9wO1xuICAgIGlmICh3aXRoT3ApIHN0YXJ0T3BlcmF0aW9uKGNtKTtcbiAgICBpZiAoaGFzSGFuZGxlcih0aGlzLCBcImNsZWFyXCIpKSB7XG4gICAgICB2YXIgZm91bmQgPSB0aGlzLmZpbmQoKTtcbiAgICAgIGlmIChmb3VuZCkgc2lnbmFsTGF0ZXIodGhpcywgXCJjbGVhclwiLCBmb3VuZC5mcm9tLCBmb3VuZC50byk7XG4gICAgfVxuICAgIHZhciBtaW4gPSBudWxsLCBtYXggPSBudWxsO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5saW5lcy5sZW5ndGg7ICsraSkge1xuICAgICAgdmFyIGxpbmUgPSB0aGlzLmxpbmVzW2ldO1xuICAgICAgdmFyIHNwYW4gPSBnZXRNYXJrZWRTcGFuRm9yKGxpbmUubWFya2VkU3BhbnMsIHRoaXMpO1xuICAgICAgaWYgKGNtICYmICF0aGlzLmNvbGxhcHNlZCkgcmVnTGluZUNoYW5nZShjbSwgbGluZU5vKGxpbmUpLCBcInRleHRcIik7XG4gICAgICBlbHNlIGlmIChjbSkge1xuICAgICAgICBpZiAoc3Bhbi50byAhPSBudWxsKSBtYXggPSBsaW5lTm8obGluZSk7XG4gICAgICAgIGlmIChzcGFuLmZyb20gIT0gbnVsbCkgbWluID0gbGluZU5vKGxpbmUpO1xuICAgICAgfVxuICAgICAgbGluZS5tYXJrZWRTcGFucyA9IHJlbW92ZU1hcmtlZFNwYW4obGluZS5tYXJrZWRTcGFucywgc3Bhbik7XG4gICAgICBpZiAoc3Bhbi5mcm9tID09IG51bGwgJiYgdGhpcy5jb2xsYXBzZWQgJiYgIWxpbmVJc0hpZGRlbih0aGlzLmRvYywgbGluZSkgJiYgY20pXG4gICAgICAgIHVwZGF0ZUxpbmVIZWlnaHQobGluZSwgdGV4dEhlaWdodChjbS5kaXNwbGF5KSk7XG4gICAgfVxuICAgIGlmIChjbSAmJiB0aGlzLmNvbGxhcHNlZCAmJiAhY20ub3B0aW9ucy5saW5lV3JhcHBpbmcpIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5saW5lcy5sZW5ndGg7ICsraSkge1xuICAgICAgdmFyIHZpc3VhbCA9IHZpc3VhbExpbmUodGhpcy5saW5lc1tpXSksIGxlbiA9IGxpbmVMZW5ndGgodmlzdWFsKTtcbiAgICAgIGlmIChsZW4gPiBjbS5kaXNwbGF5Lm1heExpbmVMZW5ndGgpIHtcbiAgICAgICAgY20uZGlzcGxheS5tYXhMaW5lID0gdmlzdWFsO1xuICAgICAgICBjbS5kaXNwbGF5Lm1heExpbmVMZW5ndGggPSBsZW47XG4gICAgICAgIGNtLmRpc3BsYXkubWF4TGluZUNoYW5nZWQgPSB0cnVlO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChtaW4gIT0gbnVsbCAmJiBjbSAmJiB0aGlzLmNvbGxhcHNlZCkgcmVnQ2hhbmdlKGNtLCBtaW4sIG1heCArIDEpO1xuICAgIHRoaXMubGluZXMubGVuZ3RoID0gMDtcbiAgICB0aGlzLmV4cGxpY2l0bHlDbGVhcmVkID0gdHJ1ZTtcbiAgICBpZiAodGhpcy5hdG9taWMgJiYgdGhpcy5kb2MuY2FudEVkaXQpIHtcbiAgICAgIHRoaXMuZG9jLmNhbnRFZGl0ID0gZmFsc2U7XG4gICAgICBpZiAoY20pIHJlQ2hlY2tTZWxlY3Rpb24oY20uZG9jKTtcbiAgICB9XG4gICAgaWYgKGNtKSBzaWduYWxMYXRlcihjbSwgXCJtYXJrZXJDbGVhcmVkXCIsIGNtLCB0aGlzKTtcbiAgICBpZiAod2l0aE9wKSBlbmRPcGVyYXRpb24oY20pO1xuICAgIGlmICh0aGlzLnBhcmVudCkgdGhpcy5wYXJlbnQuY2xlYXIoKTtcbiAgfTtcblxuICAvLyBGaW5kIHRoZSBwb3NpdGlvbiBvZiB0aGUgbWFya2VyIGluIHRoZSBkb2N1bWVudC4gUmV0dXJucyBhIHtmcm9tLFxuICAvLyB0b30gb2JqZWN0IGJ5IGRlZmF1bHQuIFNpZGUgY2FuIGJlIHBhc3NlZCB0byBnZXQgYSBzcGVjaWZpYyBzaWRlXG4gIC8vIC0tIDAgKGJvdGgpLCAtMSAobGVmdCksIG9yIDEgKHJpZ2h0KS4gV2hlbiBsaW5lT2JqIGlzIHRydWUsIHRoZVxuICAvLyBQb3Mgb2JqZWN0cyByZXR1cm5lZCBjb250YWluIGEgbGluZSBvYmplY3QsIHJhdGhlciB0aGFuIGEgbGluZVxuICAvLyBudW1iZXIgKHVzZWQgdG8gcHJldmVudCBsb29raW5nIHVwIHRoZSBzYW1lIGxpbmUgdHdpY2UpLlxuICBUZXh0TWFya2VyLnByb3RvdHlwZS5maW5kID0gZnVuY3Rpb24oc2lkZSwgbGluZU9iaikge1xuICAgIGlmIChzaWRlID09IG51bGwgJiYgdGhpcy50eXBlID09IFwiYm9va21hcmtcIikgc2lkZSA9IDE7XG4gICAgdmFyIGZyb20sIHRvO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5saW5lcy5sZW5ndGg7ICsraSkge1xuICAgICAgdmFyIGxpbmUgPSB0aGlzLmxpbmVzW2ldO1xuICAgICAgdmFyIHNwYW4gPSBnZXRNYXJrZWRTcGFuRm9yKGxpbmUubWFya2VkU3BhbnMsIHRoaXMpO1xuICAgICAgaWYgKHNwYW4uZnJvbSAhPSBudWxsKSB7XG4gICAgICAgIGZyb20gPSBQb3MobGluZU9iaiA/IGxpbmUgOiBsaW5lTm8obGluZSksIHNwYW4uZnJvbSk7XG4gICAgICAgIGlmIChzaWRlID09IC0xKSByZXR1cm4gZnJvbTtcbiAgICAgIH1cbiAgICAgIGlmIChzcGFuLnRvICE9IG51bGwpIHtcbiAgICAgICAgdG8gPSBQb3MobGluZU9iaiA/IGxpbmUgOiBsaW5lTm8obGluZSksIHNwYW4udG8pO1xuICAgICAgICBpZiAoc2lkZSA9PSAxKSByZXR1cm4gdG87XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBmcm9tICYmIHtmcm9tOiBmcm9tLCB0bzogdG99O1xuICB9O1xuXG4gIC8vIFNpZ25hbHMgdGhhdCB0aGUgbWFya2VyJ3Mgd2lkZ2V0IGNoYW5nZWQsIGFuZCBzdXJyb3VuZGluZyBsYXlvdXRcbiAgLy8gc2hvdWxkIGJlIHJlY29tcHV0ZWQuXG4gIFRleHRNYXJrZXIucHJvdG90eXBlLmNoYW5nZWQgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgcG9zID0gdGhpcy5maW5kKC0xLCB0cnVlKSwgd2lkZ2V0ID0gdGhpcywgY20gPSB0aGlzLmRvYy5jbTtcbiAgICBpZiAoIXBvcyB8fCAhY20pIHJldHVybjtcbiAgICBydW5Jbk9wKGNtLCBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBsaW5lID0gcG9zLmxpbmUsIGxpbmVOID0gbGluZU5vKHBvcy5saW5lKTtcbiAgICAgIHZhciB2aWV3ID0gZmluZFZpZXdGb3JMaW5lKGNtLCBsaW5lTik7XG4gICAgICBpZiAodmlldykge1xuICAgICAgICBjbGVhckxpbmVNZWFzdXJlbWVudENhY2hlRm9yKHZpZXcpO1xuICAgICAgICBjbS5jdXJPcC5zZWxlY3Rpb25DaGFuZ2VkID0gY20uY3VyT3AuZm9yY2VVcGRhdGUgPSB0cnVlO1xuICAgICAgfVxuICAgICAgY20uY3VyT3AudXBkYXRlTWF4TGluZSA9IHRydWU7XG4gICAgICBpZiAoIWxpbmVJc0hpZGRlbih3aWRnZXQuZG9jLCBsaW5lKSAmJiB3aWRnZXQuaGVpZ2h0ICE9IG51bGwpIHtcbiAgICAgICAgdmFyIG9sZEhlaWdodCA9IHdpZGdldC5oZWlnaHQ7XG4gICAgICAgIHdpZGdldC5oZWlnaHQgPSBudWxsO1xuICAgICAgICB2YXIgZEhlaWdodCA9IHdpZGdldEhlaWdodCh3aWRnZXQpIC0gb2xkSGVpZ2h0O1xuICAgICAgICBpZiAoZEhlaWdodClcbiAgICAgICAgICB1cGRhdGVMaW5lSGVpZ2h0KGxpbmUsIGxpbmUuaGVpZ2h0ICsgZEhlaWdodCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH07XG5cbiAgVGV4dE1hcmtlci5wcm90b3R5cGUuYXR0YWNoTGluZSA9IGZ1bmN0aW9uKGxpbmUpIHtcbiAgICBpZiAoIXRoaXMubGluZXMubGVuZ3RoICYmIHRoaXMuZG9jLmNtKSB7XG4gICAgICB2YXIgb3AgPSB0aGlzLmRvYy5jbS5jdXJPcDtcbiAgICAgIGlmICghb3AubWF5YmVIaWRkZW5NYXJrZXJzIHx8IGluZGV4T2Yob3AubWF5YmVIaWRkZW5NYXJrZXJzLCB0aGlzKSA9PSAtMSlcbiAgICAgICAgKG9wLm1heWJlVW5oaWRkZW5NYXJrZXJzIHx8IChvcC5tYXliZVVuaGlkZGVuTWFya2VycyA9IFtdKSkucHVzaCh0aGlzKTtcbiAgICB9XG4gICAgdGhpcy5saW5lcy5wdXNoKGxpbmUpO1xuICB9O1xuICBUZXh0TWFya2VyLnByb3RvdHlwZS5kZXRhY2hMaW5lID0gZnVuY3Rpb24obGluZSkge1xuICAgIHRoaXMubGluZXMuc3BsaWNlKGluZGV4T2YodGhpcy5saW5lcywgbGluZSksIDEpO1xuICAgIGlmICghdGhpcy5saW5lcy5sZW5ndGggJiYgdGhpcy5kb2MuY20pIHtcbiAgICAgIHZhciBvcCA9IHRoaXMuZG9jLmNtLmN1ck9wO1xuICAgICAgKG9wLm1heWJlSGlkZGVuTWFya2VycyB8fCAob3AubWF5YmVIaWRkZW5NYXJrZXJzID0gW10pKS5wdXNoKHRoaXMpO1xuICAgIH1cbiAgfTtcblxuICAvLyBDb2xsYXBzZWQgbWFya2VycyBoYXZlIHVuaXF1ZSBpZHMsIGluIG9yZGVyIHRvIGJlIGFibGUgdG8gb3JkZXJcbiAgLy8gdGhlbSwgd2hpY2ggaXMgbmVlZGVkIGZvciB1bmlxdWVseSBkZXRlcm1pbmluZyBhbiBvdXRlciBtYXJrZXJcbiAgLy8gd2hlbiB0aGV5IG92ZXJsYXAgKHRoZXkgbWF5IG5lc3QsIGJ1dCBub3QgcGFydGlhbGx5IG92ZXJsYXApLlxuICB2YXIgbmV4dE1hcmtlcklkID0gMDtcblxuICAvLyBDcmVhdGUgYSBtYXJrZXIsIHdpcmUgaXQgdXAgdG8gdGhlIHJpZ2h0IGxpbmVzLCBhbmRcbiAgZnVuY3Rpb24gbWFya1RleHQoZG9jLCBmcm9tLCB0bywgb3B0aW9ucywgdHlwZSkge1xuICAgIC8vIFNoYXJlZCBtYXJrZXJzIChhY3Jvc3MgbGlua2VkIGRvY3VtZW50cykgYXJlIGhhbmRsZWQgc2VwYXJhdGVseVxuICAgIC8vIChtYXJrVGV4dFNoYXJlZCB3aWxsIGNhbGwgb3V0IHRvIHRoaXMgYWdhaW4sIG9uY2UgcGVyXG4gICAgLy8gZG9jdW1lbnQpLlxuICAgIGlmIChvcHRpb25zICYmIG9wdGlvbnMuc2hhcmVkKSByZXR1cm4gbWFya1RleHRTaGFyZWQoZG9jLCBmcm9tLCB0bywgb3B0aW9ucywgdHlwZSk7XG4gICAgLy8gRW5zdXJlIHdlIGFyZSBpbiBhbiBvcGVyYXRpb24uXG4gICAgaWYgKGRvYy5jbSAmJiAhZG9jLmNtLmN1ck9wKSByZXR1cm4gb3BlcmF0aW9uKGRvYy5jbSwgbWFya1RleHQpKGRvYywgZnJvbSwgdG8sIG9wdGlvbnMsIHR5cGUpO1xuXG4gICAgdmFyIG1hcmtlciA9IG5ldyBUZXh0TWFya2VyKGRvYywgdHlwZSksIGRpZmYgPSBjbXAoZnJvbSwgdG8pO1xuICAgIGlmIChvcHRpb25zKSBjb3B5T2JqKG9wdGlvbnMsIG1hcmtlciwgZmFsc2UpO1xuICAgIC8vIERvbid0IGNvbm5lY3QgZW1wdHkgbWFya2VycyB1bmxlc3MgY2xlYXJXaGVuRW1wdHkgaXMgZmFsc2VcbiAgICBpZiAoZGlmZiA+IDAgfHwgZGlmZiA9PSAwICYmIG1hcmtlci5jbGVhcldoZW5FbXB0eSAhPT0gZmFsc2UpXG4gICAgICByZXR1cm4gbWFya2VyO1xuICAgIGlmIChtYXJrZXIucmVwbGFjZWRXaXRoKSB7XG4gICAgICAvLyBTaG93aW5nIHVwIGFzIGEgd2lkZ2V0IGltcGxpZXMgY29sbGFwc2VkICh3aWRnZXQgcmVwbGFjZXMgdGV4dClcbiAgICAgIG1hcmtlci5jb2xsYXBzZWQgPSB0cnVlO1xuICAgICAgbWFya2VyLndpZGdldE5vZGUgPSBlbHQoXCJzcGFuXCIsIFttYXJrZXIucmVwbGFjZWRXaXRoXSwgXCJDb2RlTWlycm9yLXdpZGdldFwiKTtcbiAgICAgIGlmICghb3B0aW9ucy5oYW5kbGVNb3VzZUV2ZW50cykgbWFya2VyLndpZGdldE5vZGUuc2V0QXR0cmlidXRlKFwiY20taWdub3JlLWV2ZW50c1wiLCBcInRydWVcIik7XG4gICAgICBpZiAob3B0aW9ucy5pbnNlcnRMZWZ0KSBtYXJrZXIud2lkZ2V0Tm9kZS5pbnNlcnRMZWZ0ID0gdHJ1ZTtcbiAgICB9XG4gICAgaWYgKG1hcmtlci5jb2xsYXBzZWQpIHtcbiAgICAgIGlmIChjb25mbGljdGluZ0NvbGxhcHNlZFJhbmdlKGRvYywgZnJvbS5saW5lLCBmcm9tLCB0bywgbWFya2VyKSB8fFxuICAgICAgICAgIGZyb20ubGluZSAhPSB0by5saW5lICYmIGNvbmZsaWN0aW5nQ29sbGFwc2VkUmFuZ2UoZG9jLCB0by5saW5lLCBmcm9tLCB0bywgbWFya2VyKSlcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW5zZXJ0aW5nIGNvbGxhcHNlZCBtYXJrZXIgcGFydGlhbGx5IG92ZXJsYXBwaW5nIGFuIGV4aXN0aW5nIG9uZVwiKTtcbiAgICAgIHNhd0NvbGxhcHNlZFNwYW5zID0gdHJ1ZTtcbiAgICB9XG5cbiAgICBpZiAobWFya2VyLmFkZFRvSGlzdG9yeSlcbiAgICAgIGFkZENoYW5nZVRvSGlzdG9yeShkb2MsIHtmcm9tOiBmcm9tLCB0bzogdG8sIG9yaWdpbjogXCJtYXJrVGV4dFwifSwgZG9jLnNlbCwgTmFOKTtcblxuICAgIHZhciBjdXJMaW5lID0gZnJvbS5saW5lLCBjbSA9IGRvYy5jbSwgdXBkYXRlTWF4TGluZTtcbiAgICBkb2MuaXRlcihjdXJMaW5lLCB0by5saW5lICsgMSwgZnVuY3Rpb24obGluZSkge1xuICAgICAgaWYgKGNtICYmIG1hcmtlci5jb2xsYXBzZWQgJiYgIWNtLm9wdGlvbnMubGluZVdyYXBwaW5nICYmIHZpc3VhbExpbmUobGluZSkgPT0gY20uZGlzcGxheS5tYXhMaW5lKVxuICAgICAgICB1cGRhdGVNYXhMaW5lID0gdHJ1ZTtcbiAgICAgIGlmIChtYXJrZXIuY29sbGFwc2VkICYmIGN1ckxpbmUgIT0gZnJvbS5saW5lKSB1cGRhdGVMaW5lSGVpZ2h0KGxpbmUsIDApO1xuICAgICAgYWRkTWFya2VkU3BhbihsaW5lLCBuZXcgTWFya2VkU3BhbihtYXJrZXIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1ckxpbmUgPT0gZnJvbS5saW5lID8gZnJvbS5jaCA6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1ckxpbmUgPT0gdG8ubGluZSA/IHRvLmNoIDogbnVsbCkpO1xuICAgICAgKytjdXJMaW5lO1xuICAgIH0pO1xuICAgIC8vIGxpbmVJc0hpZGRlbiBkZXBlbmRzIG9uIHRoZSBwcmVzZW5jZSBvZiB0aGUgc3BhbnMsIHNvIG5lZWRzIGEgc2Vjb25kIHBhc3NcbiAgICBpZiAobWFya2VyLmNvbGxhcHNlZCkgZG9jLml0ZXIoZnJvbS5saW5lLCB0by5saW5lICsgMSwgZnVuY3Rpb24obGluZSkge1xuICAgICAgaWYgKGxpbmVJc0hpZGRlbihkb2MsIGxpbmUpKSB1cGRhdGVMaW5lSGVpZ2h0KGxpbmUsIDApO1xuICAgIH0pO1xuXG4gICAgaWYgKG1hcmtlci5jbGVhck9uRW50ZXIpIG9uKG1hcmtlciwgXCJiZWZvcmVDdXJzb3JFbnRlclwiLCBmdW5jdGlvbigpIHsgbWFya2VyLmNsZWFyKCk7IH0pO1xuXG4gICAgaWYgKG1hcmtlci5yZWFkT25seSkge1xuICAgICAgc2F3UmVhZE9ubHlTcGFucyA9IHRydWU7XG4gICAgICBpZiAoZG9jLmhpc3RvcnkuZG9uZS5sZW5ndGggfHwgZG9jLmhpc3RvcnkudW5kb25lLmxlbmd0aClcbiAgICAgICAgZG9jLmNsZWFySGlzdG9yeSgpO1xuICAgIH1cbiAgICBpZiAobWFya2VyLmNvbGxhcHNlZCkge1xuICAgICAgbWFya2VyLmlkID0gKytuZXh0TWFya2VySWQ7XG4gICAgICBtYXJrZXIuYXRvbWljID0gdHJ1ZTtcbiAgICB9XG4gICAgaWYgKGNtKSB7XG4gICAgICAvLyBTeW5jIGVkaXRvciBzdGF0ZVxuICAgICAgaWYgKHVwZGF0ZU1heExpbmUpIGNtLmN1ck9wLnVwZGF0ZU1heExpbmUgPSB0cnVlO1xuICAgICAgaWYgKG1hcmtlci5jb2xsYXBzZWQpXG4gICAgICAgIHJlZ0NoYW5nZShjbSwgZnJvbS5saW5lLCB0by5saW5lICsgMSk7XG4gICAgICBlbHNlIGlmIChtYXJrZXIuY2xhc3NOYW1lIHx8IG1hcmtlci50aXRsZSB8fCBtYXJrZXIuc3RhcnRTdHlsZSB8fCBtYXJrZXIuZW5kU3R5bGUgfHwgbWFya2VyLmNzcylcbiAgICAgICAgZm9yICh2YXIgaSA9IGZyb20ubGluZTsgaSA8PSB0by5saW5lOyBpKyspIHJlZ0xpbmVDaGFuZ2UoY20sIGksIFwidGV4dFwiKTtcbiAgICAgIGlmIChtYXJrZXIuYXRvbWljKSByZUNoZWNrU2VsZWN0aW9uKGNtLmRvYyk7XG4gICAgICBzaWduYWxMYXRlcihjbSwgXCJtYXJrZXJBZGRlZFwiLCBjbSwgbWFya2VyKTtcbiAgICB9XG4gICAgcmV0dXJuIG1hcmtlcjtcbiAgfVxuXG4gIC8vIFNIQVJFRCBURVhUTUFSS0VSU1xuXG4gIC8vIEEgc2hhcmVkIG1hcmtlciBzcGFucyBtdWx0aXBsZSBsaW5rZWQgZG9jdW1lbnRzLiBJdCBpc1xuICAvLyBpbXBsZW1lbnRlZCBhcyBhIG1ldGEtbWFya2VyLW9iamVjdCBjb250cm9sbGluZyBtdWx0aXBsZSBub3JtYWxcbiAgLy8gbWFya2Vycy5cbiAgdmFyIFNoYXJlZFRleHRNYXJrZXIgPSBDb2RlTWlycm9yLlNoYXJlZFRleHRNYXJrZXIgPSBmdW5jdGlvbihtYXJrZXJzLCBwcmltYXJ5KSB7XG4gICAgdGhpcy5tYXJrZXJzID0gbWFya2VycztcbiAgICB0aGlzLnByaW1hcnkgPSBwcmltYXJ5O1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbWFya2Vycy5sZW5ndGg7ICsraSlcbiAgICAgIG1hcmtlcnNbaV0ucGFyZW50ID0gdGhpcztcbiAgfTtcbiAgZXZlbnRNaXhpbihTaGFyZWRUZXh0TWFya2VyKTtcblxuICBTaGFyZWRUZXh0TWFya2VyLnByb3RvdHlwZS5jbGVhciA9IGZ1bmN0aW9uKCkge1xuICAgIGlmICh0aGlzLmV4cGxpY2l0bHlDbGVhcmVkKSByZXR1cm47XG4gICAgdGhpcy5leHBsaWNpdGx5Q2xlYXJlZCA9IHRydWU7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLm1hcmtlcnMubGVuZ3RoOyArK2kpXG4gICAgICB0aGlzLm1hcmtlcnNbaV0uY2xlYXIoKTtcbiAgICBzaWduYWxMYXRlcih0aGlzLCBcImNsZWFyXCIpO1xuICB9O1xuICBTaGFyZWRUZXh0TWFya2VyLnByb3RvdHlwZS5maW5kID0gZnVuY3Rpb24oc2lkZSwgbGluZU9iaikge1xuICAgIHJldHVybiB0aGlzLnByaW1hcnkuZmluZChzaWRlLCBsaW5lT2JqKTtcbiAgfTtcblxuICBmdW5jdGlvbiBtYXJrVGV4dFNoYXJlZChkb2MsIGZyb20sIHRvLCBvcHRpb25zLCB0eXBlKSB7XG4gICAgb3B0aW9ucyA9IGNvcHlPYmoob3B0aW9ucyk7XG4gICAgb3B0aW9ucy5zaGFyZWQgPSBmYWxzZTtcbiAgICB2YXIgbWFya2VycyA9IFttYXJrVGV4dChkb2MsIGZyb20sIHRvLCBvcHRpb25zLCB0eXBlKV0sIHByaW1hcnkgPSBtYXJrZXJzWzBdO1xuICAgIHZhciB3aWRnZXQgPSBvcHRpb25zLndpZGdldE5vZGU7XG4gICAgbGlua2VkRG9jcyhkb2MsIGZ1bmN0aW9uKGRvYykge1xuICAgICAgaWYgKHdpZGdldCkgb3B0aW9ucy53aWRnZXROb2RlID0gd2lkZ2V0LmNsb25lTm9kZSh0cnVlKTtcbiAgICAgIG1hcmtlcnMucHVzaChtYXJrVGV4dChkb2MsIGNsaXBQb3MoZG9jLCBmcm9tKSwgY2xpcFBvcyhkb2MsIHRvKSwgb3B0aW9ucywgdHlwZSkpO1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkb2MubGlua2VkLmxlbmd0aDsgKytpKVxuICAgICAgICBpZiAoZG9jLmxpbmtlZFtpXS5pc1BhcmVudCkgcmV0dXJuO1xuICAgICAgcHJpbWFyeSA9IGxzdChtYXJrZXJzKTtcbiAgICB9KTtcbiAgICByZXR1cm4gbmV3IFNoYXJlZFRleHRNYXJrZXIobWFya2VycywgcHJpbWFyeSk7XG4gIH1cblxuICBmdW5jdGlvbiBmaW5kU2hhcmVkTWFya2Vycyhkb2MpIHtcbiAgICByZXR1cm4gZG9jLmZpbmRNYXJrcyhQb3MoZG9jLmZpcnN0LCAwKSwgZG9jLmNsaXBQb3MoUG9zKGRvYy5sYXN0TGluZSgpKSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24obSkgeyByZXR1cm4gbS5wYXJlbnQ7IH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gY29weVNoYXJlZE1hcmtlcnMoZG9jLCBtYXJrZXJzKSB7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtYXJrZXJzLmxlbmd0aDsgaSsrKSB7XG4gICAgICB2YXIgbWFya2VyID0gbWFya2Vyc1tpXSwgcG9zID0gbWFya2VyLmZpbmQoKTtcbiAgICAgIHZhciBtRnJvbSA9IGRvYy5jbGlwUG9zKHBvcy5mcm9tKSwgbVRvID0gZG9jLmNsaXBQb3MocG9zLnRvKTtcbiAgICAgIGlmIChjbXAobUZyb20sIG1UbykpIHtcbiAgICAgICAgdmFyIHN1Yk1hcmsgPSBtYXJrVGV4dChkb2MsIG1Gcm9tLCBtVG8sIG1hcmtlci5wcmltYXJ5LCBtYXJrZXIucHJpbWFyeS50eXBlKTtcbiAgICAgICAgbWFya2VyLm1hcmtlcnMucHVzaChzdWJNYXJrKTtcbiAgICAgICAgc3ViTWFyay5wYXJlbnQgPSBtYXJrZXI7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gZGV0YWNoU2hhcmVkTWFya2VycyhtYXJrZXJzKSB7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtYXJrZXJzLmxlbmd0aDsgaSsrKSB7XG4gICAgICB2YXIgbWFya2VyID0gbWFya2Vyc1tpXSwgbGlua2VkID0gW21hcmtlci5wcmltYXJ5LmRvY107O1xuICAgICAgbGlua2VkRG9jcyhtYXJrZXIucHJpbWFyeS5kb2MsIGZ1bmN0aW9uKGQpIHsgbGlua2VkLnB1c2goZCk7IH0pO1xuICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBtYXJrZXIubWFya2Vycy5sZW5ndGg7IGorKykge1xuICAgICAgICB2YXIgc3ViTWFya2VyID0gbWFya2VyLm1hcmtlcnNbal07XG4gICAgICAgIGlmIChpbmRleE9mKGxpbmtlZCwgc3ViTWFya2VyLmRvYykgPT0gLTEpIHtcbiAgICAgICAgICBzdWJNYXJrZXIucGFyZW50ID0gbnVsbDtcbiAgICAgICAgICBtYXJrZXIubWFya2Vycy5zcGxpY2Uoai0tLCAxKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8vIFRFWFRNQVJLRVIgU1BBTlNcblxuICBmdW5jdGlvbiBNYXJrZWRTcGFuKG1hcmtlciwgZnJvbSwgdG8pIHtcbiAgICB0aGlzLm1hcmtlciA9IG1hcmtlcjtcbiAgICB0aGlzLmZyb20gPSBmcm9tOyB0aGlzLnRvID0gdG87XG4gIH1cblxuICAvLyBTZWFyY2ggYW4gYXJyYXkgb2Ygc3BhbnMgZm9yIGEgc3BhbiBtYXRjaGluZyB0aGUgZ2l2ZW4gbWFya2VyLlxuICBmdW5jdGlvbiBnZXRNYXJrZWRTcGFuRm9yKHNwYW5zLCBtYXJrZXIpIHtcbiAgICBpZiAoc3BhbnMpIGZvciAodmFyIGkgPSAwOyBpIDwgc3BhbnMubGVuZ3RoOyArK2kpIHtcbiAgICAgIHZhciBzcGFuID0gc3BhbnNbaV07XG4gICAgICBpZiAoc3Bhbi5tYXJrZXIgPT0gbWFya2VyKSByZXR1cm4gc3BhbjtcbiAgICB9XG4gIH1cbiAgLy8gUmVtb3ZlIGEgc3BhbiBmcm9tIGFuIGFycmF5LCByZXR1cm5pbmcgdW5kZWZpbmVkIGlmIG5vIHNwYW5zIGFyZVxuICAvLyBsZWZ0ICh3ZSBkb24ndCBzdG9yZSBhcnJheXMgZm9yIGxpbmVzIHdpdGhvdXQgc3BhbnMpLlxuICBmdW5jdGlvbiByZW1vdmVNYXJrZWRTcGFuKHNwYW5zLCBzcGFuKSB7XG4gICAgZm9yICh2YXIgciwgaSA9IDA7IGkgPCBzcGFucy5sZW5ndGg7ICsraSlcbiAgICAgIGlmIChzcGFuc1tpXSAhPSBzcGFuKSAociB8fCAociA9IFtdKSkucHVzaChzcGFuc1tpXSk7XG4gICAgcmV0dXJuIHI7XG4gIH1cbiAgLy8gQWRkIGEgc3BhbiB0byBhIGxpbmUuXG4gIGZ1bmN0aW9uIGFkZE1hcmtlZFNwYW4obGluZSwgc3Bhbikge1xuICAgIGxpbmUubWFya2VkU3BhbnMgPSBsaW5lLm1hcmtlZFNwYW5zID8gbGluZS5tYXJrZWRTcGFucy5jb25jYXQoW3NwYW5dKSA6IFtzcGFuXTtcbiAgICBzcGFuLm1hcmtlci5hdHRhY2hMaW5lKGxpbmUpO1xuICB9XG5cbiAgLy8gVXNlZCBmb3IgdGhlIGFsZ29yaXRobSB0aGF0IGFkanVzdHMgbWFya2VycyBmb3IgYSBjaGFuZ2UgaW4gdGhlXG4gIC8vIGRvY3VtZW50LiBUaGVzZSBmdW5jdGlvbnMgY3V0IGFuIGFycmF5IG9mIHNwYW5zIGF0IGEgZ2l2ZW5cbiAgLy8gY2hhcmFjdGVyIHBvc2l0aW9uLCByZXR1cm5pbmcgYW4gYXJyYXkgb2YgcmVtYWluaW5nIGNodW5rcyAob3JcbiAgLy8gdW5kZWZpbmVkIGlmIG5vdGhpbmcgcmVtYWlucykuXG4gIGZ1bmN0aW9uIG1hcmtlZFNwYW5zQmVmb3JlKG9sZCwgc3RhcnRDaCwgaXNJbnNlcnQpIHtcbiAgICBpZiAob2xkKSBmb3IgKHZhciBpID0gMCwgbnc7IGkgPCBvbGQubGVuZ3RoOyArK2kpIHtcbiAgICAgIHZhciBzcGFuID0gb2xkW2ldLCBtYXJrZXIgPSBzcGFuLm1hcmtlcjtcbiAgICAgIHZhciBzdGFydHNCZWZvcmUgPSBzcGFuLmZyb20gPT0gbnVsbCB8fCAobWFya2VyLmluY2x1c2l2ZUxlZnQgPyBzcGFuLmZyb20gPD0gc3RhcnRDaCA6IHNwYW4uZnJvbSA8IHN0YXJ0Q2gpO1xuICAgICAgaWYgKHN0YXJ0c0JlZm9yZSB8fCBzcGFuLmZyb20gPT0gc3RhcnRDaCAmJiBtYXJrZXIudHlwZSA9PSBcImJvb2ttYXJrXCIgJiYgKCFpc0luc2VydCB8fCAhc3Bhbi5tYXJrZXIuaW5zZXJ0TGVmdCkpIHtcbiAgICAgICAgdmFyIGVuZHNBZnRlciA9IHNwYW4udG8gPT0gbnVsbCB8fCAobWFya2VyLmluY2x1c2l2ZVJpZ2h0ID8gc3Bhbi50byA+PSBzdGFydENoIDogc3Bhbi50byA+IHN0YXJ0Q2gpO1xuICAgICAgICAobncgfHwgKG53ID0gW10pKS5wdXNoKG5ldyBNYXJrZWRTcGFuKG1hcmtlciwgc3Bhbi5mcm9tLCBlbmRzQWZ0ZXIgPyBudWxsIDogc3Bhbi50bykpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbnc7XG4gIH1cbiAgZnVuY3Rpb24gbWFya2VkU3BhbnNBZnRlcihvbGQsIGVuZENoLCBpc0luc2VydCkge1xuICAgIGlmIChvbGQpIGZvciAodmFyIGkgPSAwLCBudzsgaSA8IG9sZC5sZW5ndGg7ICsraSkge1xuICAgICAgdmFyIHNwYW4gPSBvbGRbaV0sIG1hcmtlciA9IHNwYW4ubWFya2VyO1xuICAgICAgdmFyIGVuZHNBZnRlciA9IHNwYW4udG8gPT0gbnVsbCB8fCAobWFya2VyLmluY2x1c2l2ZVJpZ2h0ID8gc3Bhbi50byA+PSBlbmRDaCA6IHNwYW4udG8gPiBlbmRDaCk7XG4gICAgICBpZiAoZW5kc0FmdGVyIHx8IHNwYW4uZnJvbSA9PSBlbmRDaCAmJiBtYXJrZXIudHlwZSA9PSBcImJvb2ttYXJrXCIgJiYgKCFpc0luc2VydCB8fCBzcGFuLm1hcmtlci5pbnNlcnRMZWZ0KSkge1xuICAgICAgICB2YXIgc3RhcnRzQmVmb3JlID0gc3Bhbi5mcm9tID09IG51bGwgfHwgKG1hcmtlci5pbmNsdXNpdmVMZWZ0ID8gc3Bhbi5mcm9tIDw9IGVuZENoIDogc3Bhbi5mcm9tIDwgZW5kQ2gpO1xuICAgICAgICAobncgfHwgKG53ID0gW10pKS5wdXNoKG5ldyBNYXJrZWRTcGFuKG1hcmtlciwgc3RhcnRzQmVmb3JlID8gbnVsbCA6IHNwYW4uZnJvbSAtIGVuZENoLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNwYW4udG8gPT0gbnVsbCA/IG51bGwgOiBzcGFuLnRvIC0gZW5kQ2gpKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG53O1xuICB9XG5cbiAgLy8gR2l2ZW4gYSBjaGFuZ2Ugb2JqZWN0LCBjb21wdXRlIHRoZSBuZXcgc2V0IG9mIG1hcmtlciBzcGFucyB0aGF0XG4gIC8vIGNvdmVyIHRoZSBsaW5lIGluIHdoaWNoIHRoZSBjaGFuZ2UgdG9vayBwbGFjZS4gUmVtb3ZlcyBzcGFuc1xuICAvLyBlbnRpcmVseSB3aXRoaW4gdGhlIGNoYW5nZSwgcmVjb25uZWN0cyBzcGFucyBiZWxvbmdpbmcgdG8gdGhlXG4gIC8vIHNhbWUgbWFya2VyIHRoYXQgYXBwZWFyIG9uIGJvdGggc2lkZXMgb2YgdGhlIGNoYW5nZSwgYW5kIGN1dHMgb2ZmXG4gIC8vIHNwYW5zIHBhcnRpYWxseSB3aXRoaW4gdGhlIGNoYW5nZS4gUmV0dXJucyBhbiBhcnJheSBvZiBzcGFuXG4gIC8vIGFycmF5cyB3aXRoIG9uZSBlbGVtZW50IGZvciBlYWNoIGxpbmUgaW4gKGFmdGVyKSB0aGUgY2hhbmdlLlxuICBmdW5jdGlvbiBzdHJldGNoU3BhbnNPdmVyQ2hhbmdlKGRvYywgY2hhbmdlKSB7XG4gICAgaWYgKGNoYW5nZS5mdWxsKSByZXR1cm4gbnVsbDtcbiAgICB2YXIgb2xkRmlyc3QgPSBpc0xpbmUoZG9jLCBjaGFuZ2UuZnJvbS5saW5lKSAmJiBnZXRMaW5lKGRvYywgY2hhbmdlLmZyb20ubGluZSkubWFya2VkU3BhbnM7XG4gICAgdmFyIG9sZExhc3QgPSBpc0xpbmUoZG9jLCBjaGFuZ2UudG8ubGluZSkgJiYgZ2V0TGluZShkb2MsIGNoYW5nZS50by5saW5lKS5tYXJrZWRTcGFucztcbiAgICBpZiAoIW9sZEZpcnN0ICYmICFvbGRMYXN0KSByZXR1cm4gbnVsbDtcblxuICAgIHZhciBzdGFydENoID0gY2hhbmdlLmZyb20uY2gsIGVuZENoID0gY2hhbmdlLnRvLmNoLCBpc0luc2VydCA9IGNtcChjaGFuZ2UuZnJvbSwgY2hhbmdlLnRvKSA9PSAwO1xuICAgIC8vIEdldCB0aGUgc3BhbnMgdGhhdCAnc3RpY2sgb3V0JyBvbiBib3RoIHNpZGVzXG4gICAgdmFyIGZpcnN0ID0gbWFya2VkU3BhbnNCZWZvcmUob2xkRmlyc3QsIHN0YXJ0Q2gsIGlzSW5zZXJ0KTtcbiAgICB2YXIgbGFzdCA9IG1hcmtlZFNwYW5zQWZ0ZXIob2xkTGFzdCwgZW5kQ2gsIGlzSW5zZXJ0KTtcblxuICAgIC8vIE5leHQsIG1lcmdlIHRob3NlIHR3byBlbmRzXG4gICAgdmFyIHNhbWVMaW5lID0gY2hhbmdlLnRleHQubGVuZ3RoID09IDEsIG9mZnNldCA9IGxzdChjaGFuZ2UudGV4dCkubGVuZ3RoICsgKHNhbWVMaW5lID8gc3RhcnRDaCA6IDApO1xuICAgIGlmIChmaXJzdCkge1xuICAgICAgLy8gRml4IHVwIC50byBwcm9wZXJ0aWVzIG9mIGZpcnN0XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGZpcnN0Lmxlbmd0aDsgKytpKSB7XG4gICAgICAgIHZhciBzcGFuID0gZmlyc3RbaV07XG4gICAgICAgIGlmIChzcGFuLnRvID09IG51bGwpIHtcbiAgICAgICAgICB2YXIgZm91bmQgPSBnZXRNYXJrZWRTcGFuRm9yKGxhc3QsIHNwYW4ubWFya2VyKTtcbiAgICAgICAgICBpZiAoIWZvdW5kKSBzcGFuLnRvID0gc3RhcnRDaDtcbiAgICAgICAgICBlbHNlIGlmIChzYW1lTGluZSkgc3Bhbi50byA9IGZvdW5kLnRvID09IG51bGwgPyBudWxsIDogZm91bmQudG8gKyBvZmZzZXQ7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKGxhc3QpIHtcbiAgICAgIC8vIEZpeCB1cCAuZnJvbSBpbiBsYXN0IChvciBtb3ZlIHRoZW0gaW50byBmaXJzdCBpbiBjYXNlIG9mIHNhbWVMaW5lKVxuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsYXN0Lmxlbmd0aDsgKytpKSB7XG4gICAgICAgIHZhciBzcGFuID0gbGFzdFtpXTtcbiAgICAgICAgaWYgKHNwYW4udG8gIT0gbnVsbCkgc3Bhbi50byArPSBvZmZzZXQ7XG4gICAgICAgIGlmIChzcGFuLmZyb20gPT0gbnVsbCkge1xuICAgICAgICAgIHZhciBmb3VuZCA9IGdldE1hcmtlZFNwYW5Gb3IoZmlyc3QsIHNwYW4ubWFya2VyKTtcbiAgICAgICAgICBpZiAoIWZvdW5kKSB7XG4gICAgICAgICAgICBzcGFuLmZyb20gPSBvZmZzZXQ7XG4gICAgICAgICAgICBpZiAoc2FtZUxpbmUpIChmaXJzdCB8fCAoZmlyc3QgPSBbXSkpLnB1c2goc3Bhbik7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHNwYW4uZnJvbSArPSBvZmZzZXQ7XG4gICAgICAgICAgaWYgKHNhbWVMaW5lKSAoZmlyc3QgfHwgKGZpcnN0ID0gW10pKS5wdXNoKHNwYW4pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIC8vIE1ha2Ugc3VyZSB3ZSBkaWRuJ3QgY3JlYXRlIGFueSB6ZXJvLWxlbmd0aCBzcGFuc1xuICAgIGlmIChmaXJzdCkgZmlyc3QgPSBjbGVhckVtcHR5U3BhbnMoZmlyc3QpO1xuICAgIGlmIChsYXN0ICYmIGxhc3QgIT0gZmlyc3QpIGxhc3QgPSBjbGVhckVtcHR5U3BhbnMobGFzdCk7XG5cbiAgICB2YXIgbmV3TWFya2VycyA9IFtmaXJzdF07XG4gICAgaWYgKCFzYW1lTGluZSkge1xuICAgICAgLy8gRmlsbCBnYXAgd2l0aCB3aG9sZS1saW5lLXNwYW5zXG4gICAgICB2YXIgZ2FwID0gY2hhbmdlLnRleHQubGVuZ3RoIC0gMiwgZ2FwTWFya2VycztcbiAgICAgIGlmIChnYXAgPiAwICYmIGZpcnN0KVxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGZpcnN0Lmxlbmd0aDsgKytpKVxuICAgICAgICAgIGlmIChmaXJzdFtpXS50byA9PSBudWxsKVxuICAgICAgICAgICAgKGdhcE1hcmtlcnMgfHwgKGdhcE1hcmtlcnMgPSBbXSkpLnB1c2gobmV3IE1hcmtlZFNwYW4oZmlyc3RbaV0ubWFya2VyLCBudWxsLCBudWxsKSk7XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGdhcDsgKytpKVxuICAgICAgICBuZXdNYXJrZXJzLnB1c2goZ2FwTWFya2Vycyk7XG4gICAgICBuZXdNYXJrZXJzLnB1c2gobGFzdCk7XG4gICAgfVxuICAgIHJldHVybiBuZXdNYXJrZXJzO1xuICB9XG5cbiAgLy8gUmVtb3ZlIHNwYW5zIHRoYXQgYXJlIGVtcHR5IGFuZCBkb24ndCBoYXZlIGEgY2xlYXJXaGVuRW1wdHlcbiAgLy8gb3B0aW9uIG9mIGZhbHNlLlxuICBmdW5jdGlvbiBjbGVhckVtcHR5U3BhbnMoc3BhbnMpIHtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNwYW5zLmxlbmd0aDsgKytpKSB7XG4gICAgICB2YXIgc3BhbiA9IHNwYW5zW2ldO1xuICAgICAgaWYgKHNwYW4uZnJvbSAhPSBudWxsICYmIHNwYW4uZnJvbSA9PSBzcGFuLnRvICYmIHNwYW4ubWFya2VyLmNsZWFyV2hlbkVtcHR5ICE9PSBmYWxzZSlcbiAgICAgICAgc3BhbnMuc3BsaWNlKGktLSwgMSk7XG4gICAgfVxuICAgIGlmICghc3BhbnMubGVuZ3RoKSByZXR1cm4gbnVsbDtcbiAgICByZXR1cm4gc3BhbnM7XG4gIH1cblxuICAvLyBVc2VkIGZvciB1bi9yZS1kb2luZyBjaGFuZ2VzIGZyb20gdGhlIGhpc3RvcnkuIENvbWJpbmVzIHRoZVxuICAvLyByZXN1bHQgb2YgY29tcHV0aW5nIHRoZSBleGlzdGluZyBzcGFucyB3aXRoIHRoZSBzZXQgb2Ygc3BhbnMgdGhhdFxuICAvLyBleGlzdGVkIGluIHRoZSBoaXN0b3J5IChzbyB0aGF0IGRlbGV0aW5nIGFyb3VuZCBhIHNwYW4gYW5kIHRoZW5cbiAgLy8gdW5kb2luZyBicmluZ3MgYmFjayB0aGUgc3BhbikuXG4gIGZ1bmN0aW9uIG1lcmdlT2xkU3BhbnMoZG9jLCBjaGFuZ2UpIHtcbiAgICB2YXIgb2xkID0gZ2V0T2xkU3BhbnMoZG9jLCBjaGFuZ2UpO1xuICAgIHZhciBzdHJldGNoZWQgPSBzdHJldGNoU3BhbnNPdmVyQ2hhbmdlKGRvYywgY2hhbmdlKTtcbiAgICBpZiAoIW9sZCkgcmV0dXJuIHN0cmV0Y2hlZDtcbiAgICBpZiAoIXN0cmV0Y2hlZCkgcmV0dXJuIG9sZDtcblxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb2xkLmxlbmd0aDsgKytpKSB7XG4gICAgICB2YXIgb2xkQ3VyID0gb2xkW2ldLCBzdHJldGNoQ3VyID0gc3RyZXRjaGVkW2ldO1xuICAgICAgaWYgKG9sZEN1ciAmJiBzdHJldGNoQ3VyKSB7XG4gICAgICAgIHNwYW5zOiBmb3IgKHZhciBqID0gMDsgaiA8IHN0cmV0Y2hDdXIubGVuZ3RoOyArK2opIHtcbiAgICAgICAgICB2YXIgc3BhbiA9IHN0cmV0Y2hDdXJbal07XG4gICAgICAgICAgZm9yICh2YXIgayA9IDA7IGsgPCBvbGRDdXIubGVuZ3RoOyArK2spXG4gICAgICAgICAgICBpZiAob2xkQ3VyW2tdLm1hcmtlciA9PSBzcGFuLm1hcmtlcikgY29udGludWUgc3BhbnM7XG4gICAgICAgICAgb2xkQ3VyLnB1c2goc3Bhbik7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAoc3RyZXRjaEN1cikge1xuICAgICAgICBvbGRbaV0gPSBzdHJldGNoQ3VyO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gb2xkO1xuICB9XG5cbiAgLy8gVXNlZCB0byAnY2xpcCcgb3V0IHJlYWRPbmx5IHJhbmdlcyB3aGVuIG1ha2luZyBhIGNoYW5nZS5cbiAgZnVuY3Rpb24gcmVtb3ZlUmVhZE9ubHlSYW5nZXMoZG9jLCBmcm9tLCB0bykge1xuICAgIHZhciBtYXJrZXJzID0gbnVsbDtcbiAgICBkb2MuaXRlcihmcm9tLmxpbmUsIHRvLmxpbmUgKyAxLCBmdW5jdGlvbihsaW5lKSB7XG4gICAgICBpZiAobGluZS5tYXJrZWRTcGFucykgZm9yICh2YXIgaSA9IDA7IGkgPCBsaW5lLm1hcmtlZFNwYW5zLmxlbmd0aDsgKytpKSB7XG4gICAgICAgIHZhciBtYXJrID0gbGluZS5tYXJrZWRTcGFuc1tpXS5tYXJrZXI7XG4gICAgICAgIGlmIChtYXJrLnJlYWRPbmx5ICYmICghbWFya2VycyB8fCBpbmRleE9mKG1hcmtlcnMsIG1hcmspID09IC0xKSlcbiAgICAgICAgICAobWFya2VycyB8fCAobWFya2VycyA9IFtdKSkucHVzaChtYXJrKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICBpZiAoIW1hcmtlcnMpIHJldHVybiBudWxsO1xuICAgIHZhciBwYXJ0cyA9IFt7ZnJvbTogZnJvbSwgdG86IHRvfV07XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtYXJrZXJzLmxlbmd0aDsgKytpKSB7XG4gICAgICB2YXIgbWsgPSBtYXJrZXJzW2ldLCBtID0gbWsuZmluZCgwKTtcbiAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgcGFydHMubGVuZ3RoOyArK2opIHtcbiAgICAgICAgdmFyIHAgPSBwYXJ0c1tqXTtcbiAgICAgICAgaWYgKGNtcChwLnRvLCBtLmZyb20pIDwgMCB8fCBjbXAocC5mcm9tLCBtLnRvKSA+IDApIGNvbnRpbnVlO1xuICAgICAgICB2YXIgbmV3UGFydHMgPSBbaiwgMV0sIGRmcm9tID0gY21wKHAuZnJvbSwgbS5mcm9tKSwgZHRvID0gY21wKHAudG8sIG0udG8pO1xuICAgICAgICBpZiAoZGZyb20gPCAwIHx8ICFtay5pbmNsdXNpdmVMZWZ0ICYmICFkZnJvbSlcbiAgICAgICAgICBuZXdQYXJ0cy5wdXNoKHtmcm9tOiBwLmZyb20sIHRvOiBtLmZyb219KTtcbiAgICAgICAgaWYgKGR0byA+IDAgfHwgIW1rLmluY2x1c2l2ZVJpZ2h0ICYmICFkdG8pXG4gICAgICAgICAgbmV3UGFydHMucHVzaCh7ZnJvbTogbS50bywgdG86IHAudG99KTtcbiAgICAgICAgcGFydHMuc3BsaWNlLmFwcGx5KHBhcnRzLCBuZXdQYXJ0cyk7XG4gICAgICAgIGogKz0gbmV3UGFydHMubGVuZ3RoIC0gMTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHBhcnRzO1xuICB9XG5cbiAgLy8gQ29ubmVjdCBvciBkaXNjb25uZWN0IHNwYW5zIGZyb20gYSBsaW5lLlxuICBmdW5jdGlvbiBkZXRhY2hNYXJrZWRTcGFucyhsaW5lKSB7XG4gICAgdmFyIHNwYW5zID0gbGluZS5tYXJrZWRTcGFucztcbiAgICBpZiAoIXNwYW5zKSByZXR1cm47XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzcGFucy5sZW5ndGg7ICsraSlcbiAgICAgIHNwYW5zW2ldLm1hcmtlci5kZXRhY2hMaW5lKGxpbmUpO1xuICAgIGxpbmUubWFya2VkU3BhbnMgPSBudWxsO1xuICB9XG4gIGZ1bmN0aW9uIGF0dGFjaE1hcmtlZFNwYW5zKGxpbmUsIHNwYW5zKSB7XG4gICAgaWYgKCFzcGFucykgcmV0dXJuO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc3BhbnMubGVuZ3RoOyArK2kpXG4gICAgICBzcGFuc1tpXS5tYXJrZXIuYXR0YWNoTGluZShsaW5lKTtcbiAgICBsaW5lLm1hcmtlZFNwYW5zID0gc3BhbnM7XG4gIH1cblxuICAvLyBIZWxwZXJzIHVzZWQgd2hlbiBjb21wdXRpbmcgd2hpY2ggb3ZlcmxhcHBpbmcgY29sbGFwc2VkIHNwYW5cbiAgLy8gY291bnRzIGFzIHRoZSBsYXJnZXIgb25lLlxuICBmdW5jdGlvbiBleHRyYUxlZnQobWFya2VyKSB7IHJldHVybiBtYXJrZXIuaW5jbHVzaXZlTGVmdCA/IC0xIDogMDsgfVxuICBmdW5jdGlvbiBleHRyYVJpZ2h0KG1hcmtlcikgeyByZXR1cm4gbWFya2VyLmluY2x1c2l2ZVJpZ2h0ID8gMSA6IDA7IH1cblxuICAvLyBSZXR1cm5zIGEgbnVtYmVyIGluZGljYXRpbmcgd2hpY2ggb2YgdHdvIG92ZXJsYXBwaW5nIGNvbGxhcHNlZFxuICAvLyBzcGFucyBpcyBsYXJnZXIgKGFuZCB0aHVzIGluY2x1ZGVzIHRoZSBvdGhlcikuIEZhbGxzIGJhY2sgdG9cbiAgLy8gY29tcGFyaW5nIGlkcyB3aGVuIHRoZSBzcGFucyBjb3ZlciBleGFjdGx5IHRoZSBzYW1lIHJhbmdlLlxuICBmdW5jdGlvbiBjb21wYXJlQ29sbGFwc2VkTWFya2VycyhhLCBiKSB7XG4gICAgdmFyIGxlbkRpZmYgPSBhLmxpbmVzLmxlbmd0aCAtIGIubGluZXMubGVuZ3RoO1xuICAgIGlmIChsZW5EaWZmICE9IDApIHJldHVybiBsZW5EaWZmO1xuICAgIHZhciBhUG9zID0gYS5maW5kKCksIGJQb3MgPSBiLmZpbmQoKTtcbiAgICB2YXIgZnJvbUNtcCA9IGNtcChhUG9zLmZyb20sIGJQb3MuZnJvbSkgfHwgZXh0cmFMZWZ0KGEpIC0gZXh0cmFMZWZ0KGIpO1xuICAgIGlmIChmcm9tQ21wKSByZXR1cm4gLWZyb21DbXA7XG4gICAgdmFyIHRvQ21wID0gY21wKGFQb3MudG8sIGJQb3MudG8pIHx8IGV4dHJhUmlnaHQoYSkgLSBleHRyYVJpZ2h0KGIpO1xuICAgIGlmICh0b0NtcCkgcmV0dXJuIHRvQ21wO1xuICAgIHJldHVybiBiLmlkIC0gYS5pZDtcbiAgfVxuXG4gIC8vIEZpbmQgb3V0IHdoZXRoZXIgYSBsaW5lIGVuZHMgb3Igc3RhcnRzIGluIGEgY29sbGFwc2VkIHNwYW4uIElmXG4gIC8vIHNvLCByZXR1cm4gdGhlIG1hcmtlciBmb3IgdGhhdCBzcGFuLlxuICBmdW5jdGlvbiBjb2xsYXBzZWRTcGFuQXRTaWRlKGxpbmUsIHN0YXJ0KSB7XG4gICAgdmFyIHNwcyA9IHNhd0NvbGxhcHNlZFNwYW5zICYmIGxpbmUubWFya2VkU3BhbnMsIGZvdW5kO1xuICAgIGlmIChzcHMpIGZvciAodmFyIHNwLCBpID0gMDsgaSA8IHNwcy5sZW5ndGg7ICsraSkge1xuICAgICAgc3AgPSBzcHNbaV07XG4gICAgICBpZiAoc3AubWFya2VyLmNvbGxhcHNlZCAmJiAoc3RhcnQgPyBzcC5mcm9tIDogc3AudG8pID09IG51bGwgJiZcbiAgICAgICAgICAoIWZvdW5kIHx8IGNvbXBhcmVDb2xsYXBzZWRNYXJrZXJzKGZvdW5kLCBzcC5tYXJrZXIpIDwgMCkpXG4gICAgICAgIGZvdW5kID0gc3AubWFya2VyO1xuICAgIH1cbiAgICByZXR1cm4gZm91bmQ7XG4gIH1cbiAgZnVuY3Rpb24gY29sbGFwc2VkU3BhbkF0U3RhcnQobGluZSkgeyByZXR1cm4gY29sbGFwc2VkU3BhbkF0U2lkZShsaW5lLCB0cnVlKTsgfVxuICBmdW5jdGlvbiBjb2xsYXBzZWRTcGFuQXRFbmQobGluZSkgeyByZXR1cm4gY29sbGFwc2VkU3BhbkF0U2lkZShsaW5lLCBmYWxzZSk7IH1cblxuICAvLyBUZXN0IHdoZXRoZXIgdGhlcmUgZXhpc3RzIGEgY29sbGFwc2VkIHNwYW4gdGhhdCBwYXJ0aWFsbHlcbiAgLy8gb3ZlcmxhcHMgKGNvdmVycyB0aGUgc3RhcnQgb3IgZW5kLCBidXQgbm90IGJvdGgpIG9mIGEgbmV3IHNwYW4uXG4gIC8vIFN1Y2ggb3ZlcmxhcCBpcyBub3QgYWxsb3dlZC5cbiAgZnVuY3Rpb24gY29uZmxpY3RpbmdDb2xsYXBzZWRSYW5nZShkb2MsIGxpbmVObywgZnJvbSwgdG8sIG1hcmtlcikge1xuICAgIHZhciBsaW5lID0gZ2V0TGluZShkb2MsIGxpbmVObyk7XG4gICAgdmFyIHNwcyA9IHNhd0NvbGxhcHNlZFNwYW5zICYmIGxpbmUubWFya2VkU3BhbnM7XG4gICAgaWYgKHNwcykgZm9yICh2YXIgaSA9IDA7IGkgPCBzcHMubGVuZ3RoOyArK2kpIHtcbiAgICAgIHZhciBzcCA9IHNwc1tpXTtcbiAgICAgIGlmICghc3AubWFya2VyLmNvbGxhcHNlZCkgY29udGludWU7XG4gICAgICB2YXIgZm91bmQgPSBzcC5tYXJrZXIuZmluZCgwKTtcbiAgICAgIHZhciBmcm9tQ21wID0gY21wKGZvdW5kLmZyb20sIGZyb20pIHx8IGV4dHJhTGVmdChzcC5tYXJrZXIpIC0gZXh0cmFMZWZ0KG1hcmtlcik7XG4gICAgICB2YXIgdG9DbXAgPSBjbXAoZm91bmQudG8sIHRvKSB8fCBleHRyYVJpZ2h0KHNwLm1hcmtlcikgLSBleHRyYVJpZ2h0KG1hcmtlcik7XG4gICAgICBpZiAoZnJvbUNtcCA+PSAwICYmIHRvQ21wIDw9IDAgfHwgZnJvbUNtcCA8PSAwICYmIHRvQ21wID49IDApIGNvbnRpbnVlO1xuICAgICAgaWYgKGZyb21DbXAgPD0gMCAmJiAoY21wKGZvdW5kLnRvLCBmcm9tKSA+IDAgfHwgKHNwLm1hcmtlci5pbmNsdXNpdmVSaWdodCAmJiBtYXJrZXIuaW5jbHVzaXZlTGVmdCkpIHx8XG4gICAgICAgICAgZnJvbUNtcCA+PSAwICYmIChjbXAoZm91bmQuZnJvbSwgdG8pIDwgMCB8fCAoc3AubWFya2VyLmluY2x1c2l2ZUxlZnQgJiYgbWFya2VyLmluY2x1c2l2ZVJpZ2h0KSkpXG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgfVxuXG4gIC8vIEEgdmlzdWFsIGxpbmUgaXMgYSBsaW5lIGFzIGRyYXduIG9uIHRoZSBzY3JlZW4uIEZvbGRpbmcsIGZvclxuICAvLyBleGFtcGxlLCBjYW4gY2F1c2UgbXVsdGlwbGUgbG9naWNhbCBsaW5lcyB0byBhcHBlYXIgb24gdGhlIHNhbWVcbiAgLy8gdmlzdWFsIGxpbmUuIFRoaXMgZmluZHMgdGhlIHN0YXJ0IG9mIHRoZSB2aXN1YWwgbGluZSB0aGF0IHRoZVxuICAvLyBnaXZlbiBsaW5lIGlzIHBhcnQgb2YgKHVzdWFsbHkgdGhhdCBpcyB0aGUgbGluZSBpdHNlbGYpLlxuICBmdW5jdGlvbiB2aXN1YWxMaW5lKGxpbmUpIHtcbiAgICB2YXIgbWVyZ2VkO1xuICAgIHdoaWxlIChtZXJnZWQgPSBjb2xsYXBzZWRTcGFuQXRTdGFydChsaW5lKSlcbiAgICAgIGxpbmUgPSBtZXJnZWQuZmluZCgtMSwgdHJ1ZSkubGluZTtcbiAgICByZXR1cm4gbGluZTtcbiAgfVxuXG4gIC8vIFJldHVybnMgYW4gYXJyYXkgb2YgbG9naWNhbCBsaW5lcyB0aGF0IGNvbnRpbnVlIHRoZSB2aXN1YWwgbGluZVxuICAvLyBzdGFydGVkIGJ5IHRoZSBhcmd1bWVudCwgb3IgdW5kZWZpbmVkIGlmIHRoZXJlIGFyZSBubyBzdWNoIGxpbmVzLlxuICBmdW5jdGlvbiB2aXN1YWxMaW5lQ29udGludWVkKGxpbmUpIHtcbiAgICB2YXIgbWVyZ2VkLCBsaW5lcztcbiAgICB3aGlsZSAobWVyZ2VkID0gY29sbGFwc2VkU3BhbkF0RW5kKGxpbmUpKSB7XG4gICAgICBsaW5lID0gbWVyZ2VkLmZpbmQoMSwgdHJ1ZSkubGluZTtcbiAgICAgIChsaW5lcyB8fCAobGluZXMgPSBbXSkpLnB1c2gobGluZSk7XG4gICAgfVxuICAgIHJldHVybiBsaW5lcztcbiAgfVxuXG4gIC8vIEdldCB0aGUgbGluZSBudW1iZXIgb2YgdGhlIHN0YXJ0IG9mIHRoZSB2aXN1YWwgbGluZSB0aGF0IHRoZVxuICAvLyBnaXZlbiBsaW5lIG51bWJlciBpcyBwYXJ0IG9mLlxuICBmdW5jdGlvbiB2aXN1YWxMaW5lTm8oZG9jLCBsaW5lTikge1xuICAgIHZhciBsaW5lID0gZ2V0TGluZShkb2MsIGxpbmVOKSwgdmlzID0gdmlzdWFsTGluZShsaW5lKTtcbiAgICBpZiAobGluZSA9PSB2aXMpIHJldHVybiBsaW5lTjtcbiAgICByZXR1cm4gbGluZU5vKHZpcyk7XG4gIH1cbiAgLy8gR2V0IHRoZSBsaW5lIG51bWJlciBvZiB0aGUgc3RhcnQgb2YgdGhlIG5leHQgdmlzdWFsIGxpbmUgYWZ0ZXJcbiAgLy8gdGhlIGdpdmVuIGxpbmUuXG4gIGZ1bmN0aW9uIHZpc3VhbExpbmVFbmRObyhkb2MsIGxpbmVOKSB7XG4gICAgaWYgKGxpbmVOID4gZG9jLmxhc3RMaW5lKCkpIHJldHVybiBsaW5lTjtcbiAgICB2YXIgbGluZSA9IGdldExpbmUoZG9jLCBsaW5lTiksIG1lcmdlZDtcbiAgICBpZiAoIWxpbmVJc0hpZGRlbihkb2MsIGxpbmUpKSByZXR1cm4gbGluZU47XG4gICAgd2hpbGUgKG1lcmdlZCA9IGNvbGxhcHNlZFNwYW5BdEVuZChsaW5lKSlcbiAgICAgIGxpbmUgPSBtZXJnZWQuZmluZCgxLCB0cnVlKS5saW5lO1xuICAgIHJldHVybiBsaW5lTm8obGluZSkgKyAxO1xuICB9XG5cbiAgLy8gQ29tcHV0ZSB3aGV0aGVyIGEgbGluZSBpcyBoaWRkZW4uIExpbmVzIGNvdW50IGFzIGhpZGRlbiB3aGVuIHRoZXlcbiAgLy8gYXJlIHBhcnQgb2YgYSB2aXN1YWwgbGluZSB0aGF0IHN0YXJ0cyB3aXRoIGFub3RoZXIgbGluZSwgb3Igd2hlblxuICAvLyB0aGV5IGFyZSBlbnRpcmVseSBjb3ZlcmVkIGJ5IGNvbGxhcHNlZCwgbm9uLXdpZGdldCBzcGFuLlxuICBmdW5jdGlvbiBsaW5lSXNIaWRkZW4oZG9jLCBsaW5lKSB7XG4gICAgdmFyIHNwcyA9IHNhd0NvbGxhcHNlZFNwYW5zICYmIGxpbmUubWFya2VkU3BhbnM7XG4gICAgaWYgKHNwcykgZm9yICh2YXIgc3AsIGkgPSAwOyBpIDwgc3BzLmxlbmd0aDsgKytpKSB7XG4gICAgICBzcCA9IHNwc1tpXTtcbiAgICAgIGlmICghc3AubWFya2VyLmNvbGxhcHNlZCkgY29udGludWU7XG4gICAgICBpZiAoc3AuZnJvbSA9PSBudWxsKSByZXR1cm4gdHJ1ZTtcbiAgICAgIGlmIChzcC5tYXJrZXIud2lkZ2V0Tm9kZSkgY29udGludWU7XG4gICAgICBpZiAoc3AuZnJvbSA9PSAwICYmIHNwLm1hcmtlci5pbmNsdXNpdmVMZWZ0ICYmIGxpbmVJc0hpZGRlbklubmVyKGRvYywgbGluZSwgc3ApKVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gIH1cbiAgZnVuY3Rpb24gbGluZUlzSGlkZGVuSW5uZXIoZG9jLCBsaW5lLCBzcGFuKSB7XG4gICAgaWYgKHNwYW4udG8gPT0gbnVsbCkge1xuICAgICAgdmFyIGVuZCA9IHNwYW4ubWFya2VyLmZpbmQoMSwgdHJ1ZSk7XG4gICAgICByZXR1cm4gbGluZUlzSGlkZGVuSW5uZXIoZG9jLCBlbmQubGluZSwgZ2V0TWFya2VkU3BhbkZvcihlbmQubGluZS5tYXJrZWRTcGFucywgc3Bhbi5tYXJrZXIpKTtcbiAgICB9XG4gICAgaWYgKHNwYW4ubWFya2VyLmluY2x1c2l2ZVJpZ2h0ICYmIHNwYW4udG8gPT0gbGluZS50ZXh0Lmxlbmd0aClcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIGZvciAodmFyIHNwLCBpID0gMDsgaSA8IGxpbmUubWFya2VkU3BhbnMubGVuZ3RoOyArK2kpIHtcbiAgICAgIHNwID0gbGluZS5tYXJrZWRTcGFuc1tpXTtcbiAgICAgIGlmIChzcC5tYXJrZXIuY29sbGFwc2VkICYmICFzcC5tYXJrZXIud2lkZ2V0Tm9kZSAmJiBzcC5mcm9tID09IHNwYW4udG8gJiZcbiAgICAgICAgICAoc3AudG8gPT0gbnVsbCB8fCBzcC50byAhPSBzcGFuLmZyb20pICYmXG4gICAgICAgICAgKHNwLm1hcmtlci5pbmNsdXNpdmVMZWZ0IHx8IHNwYW4ubWFya2VyLmluY2x1c2l2ZVJpZ2h0KSAmJlxuICAgICAgICAgIGxpbmVJc0hpZGRlbklubmVyKGRvYywgbGluZSwgc3ApKSByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gIH1cblxuICAvLyBMSU5FIFdJREdFVFNcblxuICAvLyBMaW5lIHdpZGdldHMgYXJlIGJsb2NrIGVsZW1lbnRzIGRpc3BsYXllZCBhYm92ZSBvciBiZWxvdyBhIGxpbmUuXG5cbiAgdmFyIExpbmVXaWRnZXQgPSBDb2RlTWlycm9yLkxpbmVXaWRnZXQgPSBmdW5jdGlvbihkb2MsIG5vZGUsIG9wdGlvbnMpIHtcbiAgICBpZiAob3B0aW9ucykgZm9yICh2YXIgb3B0IGluIG9wdGlvbnMpIGlmIChvcHRpb25zLmhhc093blByb3BlcnR5KG9wdCkpXG4gICAgICB0aGlzW29wdF0gPSBvcHRpb25zW29wdF07XG4gICAgdGhpcy5kb2MgPSBkb2M7XG4gICAgdGhpcy5ub2RlID0gbm9kZTtcbiAgfTtcbiAgZXZlbnRNaXhpbihMaW5lV2lkZ2V0KTtcblxuICBmdW5jdGlvbiBhZGp1c3RTY3JvbGxXaGVuQWJvdmVWaXNpYmxlKGNtLCBsaW5lLCBkaWZmKSB7XG4gICAgaWYgKGhlaWdodEF0TGluZShsaW5lKSA8ICgoY20uY3VyT3AgJiYgY20uY3VyT3Auc2Nyb2xsVG9wKSB8fCBjbS5kb2Muc2Nyb2xsVG9wKSlcbiAgICAgIGFkZFRvU2Nyb2xsUG9zKGNtLCBudWxsLCBkaWZmKTtcbiAgfVxuXG4gIExpbmVXaWRnZXQucHJvdG90eXBlLmNsZWFyID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIGNtID0gdGhpcy5kb2MuY20sIHdzID0gdGhpcy5saW5lLndpZGdldHMsIGxpbmUgPSB0aGlzLmxpbmUsIG5vID0gbGluZU5vKGxpbmUpO1xuICAgIGlmIChubyA9PSBudWxsIHx8ICF3cykgcmV0dXJuO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgd3MubGVuZ3RoOyArK2kpIGlmICh3c1tpXSA9PSB0aGlzKSB3cy5zcGxpY2UoaS0tLCAxKTtcbiAgICBpZiAoIXdzLmxlbmd0aCkgbGluZS53aWRnZXRzID0gbnVsbDtcbiAgICB2YXIgaGVpZ2h0ID0gd2lkZ2V0SGVpZ2h0KHRoaXMpO1xuICAgIHVwZGF0ZUxpbmVIZWlnaHQobGluZSwgTWF0aC5tYXgoMCwgbGluZS5oZWlnaHQgLSBoZWlnaHQpKTtcbiAgICBpZiAoY20pIHJ1bkluT3AoY20sIGZ1bmN0aW9uKCkge1xuICAgICAgYWRqdXN0U2Nyb2xsV2hlbkFib3ZlVmlzaWJsZShjbSwgbGluZSwgLWhlaWdodCk7XG4gICAgICByZWdMaW5lQ2hhbmdlKGNtLCBubywgXCJ3aWRnZXRcIik7XG4gICAgfSk7XG4gIH07XG4gIExpbmVXaWRnZXQucHJvdG90eXBlLmNoYW5nZWQgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgb2xkSCA9IHRoaXMuaGVpZ2h0LCBjbSA9IHRoaXMuZG9jLmNtLCBsaW5lID0gdGhpcy5saW5lO1xuICAgIHRoaXMuaGVpZ2h0ID0gbnVsbDtcbiAgICB2YXIgZGlmZiA9IHdpZGdldEhlaWdodCh0aGlzKSAtIG9sZEg7XG4gICAgaWYgKCFkaWZmKSByZXR1cm47XG4gICAgdXBkYXRlTGluZUhlaWdodChsaW5lLCBsaW5lLmhlaWdodCArIGRpZmYpO1xuICAgIGlmIChjbSkgcnVuSW5PcChjbSwgZnVuY3Rpb24oKSB7XG4gICAgICBjbS5jdXJPcC5mb3JjZVVwZGF0ZSA9IHRydWU7XG4gICAgICBhZGp1c3RTY3JvbGxXaGVuQWJvdmVWaXNpYmxlKGNtLCBsaW5lLCBkaWZmKTtcbiAgICB9KTtcbiAgfTtcblxuICBmdW5jdGlvbiB3aWRnZXRIZWlnaHQod2lkZ2V0KSB7XG4gICAgaWYgKHdpZGdldC5oZWlnaHQgIT0gbnVsbCkgcmV0dXJuIHdpZGdldC5oZWlnaHQ7XG4gICAgdmFyIGNtID0gd2lkZ2V0LmRvYy5jbTtcbiAgICBpZiAoIWNtKSByZXR1cm4gMDtcbiAgICBpZiAoIWNvbnRhaW5zKGRvY3VtZW50LmJvZHksIHdpZGdldC5ub2RlKSkge1xuICAgICAgdmFyIHBhcmVudFN0eWxlID0gXCJwb3NpdGlvbjogcmVsYXRpdmU7XCI7XG4gICAgICBpZiAod2lkZ2V0LmNvdmVyR3V0dGVyKVxuICAgICAgICBwYXJlbnRTdHlsZSArPSBcIm1hcmdpbi1sZWZ0OiAtXCIgKyBjbS5kaXNwbGF5Lmd1dHRlcnMub2Zmc2V0V2lkdGggKyBcInB4O1wiO1xuICAgICAgaWYgKHdpZGdldC5ub0hTY3JvbGwpXG4gICAgICAgIHBhcmVudFN0eWxlICs9IFwid2lkdGg6IFwiICsgY20uZGlzcGxheS53cmFwcGVyLmNsaWVudFdpZHRoICsgXCJweDtcIjtcbiAgICAgIHJlbW92ZUNoaWxkcmVuQW5kQWRkKGNtLmRpc3BsYXkubWVhc3VyZSwgZWx0KFwiZGl2XCIsIFt3aWRnZXQubm9kZV0sIG51bGwsIHBhcmVudFN0eWxlKSk7XG4gICAgfVxuICAgIHJldHVybiB3aWRnZXQuaGVpZ2h0ID0gd2lkZ2V0Lm5vZGUucGFyZW50Tm9kZS5vZmZzZXRIZWlnaHQ7XG4gIH1cblxuICBmdW5jdGlvbiBhZGRMaW5lV2lkZ2V0KGRvYywgaGFuZGxlLCBub2RlLCBvcHRpb25zKSB7XG4gICAgdmFyIHdpZGdldCA9IG5ldyBMaW5lV2lkZ2V0KGRvYywgbm9kZSwgb3B0aW9ucyk7XG4gICAgdmFyIGNtID0gZG9jLmNtO1xuICAgIGlmIChjbSAmJiB3aWRnZXQubm9IU2Nyb2xsKSBjbS5kaXNwbGF5LmFsaWduV2lkZ2V0cyA9IHRydWU7XG4gICAgY2hhbmdlTGluZShkb2MsIGhhbmRsZSwgXCJ3aWRnZXRcIiwgZnVuY3Rpb24obGluZSkge1xuICAgICAgdmFyIHdpZGdldHMgPSBsaW5lLndpZGdldHMgfHwgKGxpbmUud2lkZ2V0cyA9IFtdKTtcbiAgICAgIGlmICh3aWRnZXQuaW5zZXJ0QXQgPT0gbnVsbCkgd2lkZ2V0cy5wdXNoKHdpZGdldCk7XG4gICAgICBlbHNlIHdpZGdldHMuc3BsaWNlKE1hdGgubWluKHdpZGdldHMubGVuZ3RoIC0gMSwgTWF0aC5tYXgoMCwgd2lkZ2V0Lmluc2VydEF0KSksIDAsIHdpZGdldCk7XG4gICAgICB3aWRnZXQubGluZSA9IGxpbmU7XG4gICAgICBpZiAoY20gJiYgIWxpbmVJc0hpZGRlbihkb2MsIGxpbmUpKSB7XG4gICAgICAgIHZhciBhYm92ZVZpc2libGUgPSBoZWlnaHRBdExpbmUobGluZSkgPCBkb2Muc2Nyb2xsVG9wO1xuICAgICAgICB1cGRhdGVMaW5lSGVpZ2h0KGxpbmUsIGxpbmUuaGVpZ2h0ICsgd2lkZ2V0SGVpZ2h0KHdpZGdldCkpO1xuICAgICAgICBpZiAoYWJvdmVWaXNpYmxlKSBhZGRUb1Njcm9sbFBvcyhjbSwgbnVsbCwgd2lkZ2V0LmhlaWdodCk7XG4gICAgICAgIGNtLmN1ck9wLmZvcmNlVXBkYXRlID0gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0pO1xuICAgIHJldHVybiB3aWRnZXQ7XG4gIH1cblxuICAvLyBMSU5FIERBVEEgU1RSVUNUVVJFXG5cbiAgLy8gTGluZSBvYmplY3RzLiBUaGVzZSBob2xkIHN0YXRlIHJlbGF0ZWQgdG8gYSBsaW5lLCBpbmNsdWRpbmdcbiAgLy8gaGlnaGxpZ2h0aW5nIGluZm8gKHRoZSBzdHlsZXMgYXJyYXkpLlxuICB2YXIgTGluZSA9IENvZGVNaXJyb3IuTGluZSA9IGZ1bmN0aW9uKHRleHQsIG1hcmtlZFNwYW5zLCBlc3RpbWF0ZUhlaWdodCkge1xuICAgIHRoaXMudGV4dCA9IHRleHQ7XG4gICAgYXR0YWNoTWFya2VkU3BhbnModGhpcywgbWFya2VkU3BhbnMpO1xuICAgIHRoaXMuaGVpZ2h0ID0gZXN0aW1hdGVIZWlnaHQgPyBlc3RpbWF0ZUhlaWdodCh0aGlzKSA6IDE7XG4gIH07XG4gIGV2ZW50TWl4aW4oTGluZSk7XG4gIExpbmUucHJvdG90eXBlLmxpbmVObyA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gbGluZU5vKHRoaXMpOyB9O1xuXG4gIC8vIENoYW5nZSB0aGUgY29udGVudCAodGV4dCwgbWFya2Vycykgb2YgYSBsaW5lLiBBdXRvbWF0aWNhbGx5XG4gIC8vIGludmFsaWRhdGVzIGNhY2hlZCBpbmZvcm1hdGlvbiBhbmQgdHJpZXMgdG8gcmUtZXN0aW1hdGUgdGhlXG4gIC8vIGxpbmUncyBoZWlnaHQuXG4gIGZ1bmN0aW9uIHVwZGF0ZUxpbmUobGluZSwgdGV4dCwgbWFya2VkU3BhbnMsIGVzdGltYXRlSGVpZ2h0KSB7XG4gICAgbGluZS50ZXh0ID0gdGV4dDtcbiAgICBpZiAobGluZS5zdGF0ZUFmdGVyKSBsaW5lLnN0YXRlQWZ0ZXIgPSBudWxsO1xuICAgIGlmIChsaW5lLnN0eWxlcykgbGluZS5zdHlsZXMgPSBudWxsO1xuICAgIGlmIChsaW5lLm9yZGVyICE9IG51bGwpIGxpbmUub3JkZXIgPSBudWxsO1xuICAgIGRldGFjaE1hcmtlZFNwYW5zKGxpbmUpO1xuICAgIGF0dGFjaE1hcmtlZFNwYW5zKGxpbmUsIG1hcmtlZFNwYW5zKTtcbiAgICB2YXIgZXN0SGVpZ2h0ID0gZXN0aW1hdGVIZWlnaHQgPyBlc3RpbWF0ZUhlaWdodChsaW5lKSA6IDE7XG4gICAgaWYgKGVzdEhlaWdodCAhPSBsaW5lLmhlaWdodCkgdXBkYXRlTGluZUhlaWdodChsaW5lLCBlc3RIZWlnaHQpO1xuICB9XG5cbiAgLy8gRGV0YWNoIGEgbGluZSBmcm9tIHRoZSBkb2N1bWVudCB0cmVlIGFuZCBpdHMgbWFya2Vycy5cbiAgZnVuY3Rpb24gY2xlYW5VcExpbmUobGluZSkge1xuICAgIGxpbmUucGFyZW50ID0gbnVsbDtcbiAgICBkZXRhY2hNYXJrZWRTcGFucyhsaW5lKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGV4dHJhY3RMaW5lQ2xhc3Nlcyh0eXBlLCBvdXRwdXQpIHtcbiAgICBpZiAodHlwZSkgZm9yICg7Oykge1xuICAgICAgdmFyIGxpbmVDbGFzcyA9IHR5cGUubWF0Y2goLyg/Ol58XFxzKylsaW5lLShiYWNrZ3JvdW5kLSk/KFxcUyspLyk7XG4gICAgICBpZiAoIWxpbmVDbGFzcykgYnJlYWs7XG4gICAgICB0eXBlID0gdHlwZS5zbGljZSgwLCBsaW5lQ2xhc3MuaW5kZXgpICsgdHlwZS5zbGljZShsaW5lQ2xhc3MuaW5kZXggKyBsaW5lQ2xhc3NbMF0ubGVuZ3RoKTtcbiAgICAgIHZhciBwcm9wID0gbGluZUNsYXNzWzFdID8gXCJiZ0NsYXNzXCIgOiBcInRleHRDbGFzc1wiO1xuICAgICAgaWYgKG91dHB1dFtwcm9wXSA9PSBudWxsKVxuICAgICAgICBvdXRwdXRbcHJvcF0gPSBsaW5lQ2xhc3NbMl07XG4gICAgICBlbHNlIGlmICghKG5ldyBSZWdFeHAoXCIoPzpefFxccylcIiArIGxpbmVDbGFzc1syXSArIFwiKD86JHxcXHMpXCIpKS50ZXN0KG91dHB1dFtwcm9wXSkpXG4gICAgICAgIG91dHB1dFtwcm9wXSArPSBcIiBcIiArIGxpbmVDbGFzc1syXTtcbiAgICB9XG4gICAgcmV0dXJuIHR5cGU7XG4gIH1cblxuICBmdW5jdGlvbiBjYWxsQmxhbmtMaW5lKG1vZGUsIHN0YXRlKSB7XG4gICAgaWYgKG1vZGUuYmxhbmtMaW5lKSByZXR1cm4gbW9kZS5ibGFua0xpbmUoc3RhdGUpO1xuICAgIGlmICghbW9kZS5pbm5lck1vZGUpIHJldHVybjtcbiAgICB2YXIgaW5uZXIgPSBDb2RlTWlycm9yLmlubmVyTW9kZShtb2RlLCBzdGF0ZSk7XG4gICAgaWYgKGlubmVyLm1vZGUuYmxhbmtMaW5lKSByZXR1cm4gaW5uZXIubW9kZS5ibGFua0xpbmUoaW5uZXIuc3RhdGUpO1xuICB9XG5cbiAgZnVuY3Rpb24gcmVhZFRva2VuKG1vZGUsIHN0cmVhbSwgc3RhdGUsIGlubmVyKSB7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCAxMDsgaSsrKSB7XG4gICAgICBpZiAoaW5uZXIpIGlubmVyWzBdID0gQ29kZU1pcnJvci5pbm5lck1vZGUobW9kZSwgc3RhdGUpLm1vZGU7XG4gICAgICB2YXIgc3R5bGUgPSBtb2RlLnRva2VuKHN0cmVhbSwgc3RhdGUpO1xuICAgICAgaWYgKHN0cmVhbS5wb3MgPiBzdHJlYW0uc3RhcnQpIHJldHVybiBzdHlsZTtcbiAgICB9XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiTW9kZSBcIiArIG1vZGUubmFtZSArIFwiIGZhaWxlZCB0byBhZHZhbmNlIHN0cmVhbS5cIik7XG4gIH1cblxuICAvLyBVdGlsaXR5IGZvciBnZXRUb2tlbkF0IGFuZCBnZXRMaW5lVG9rZW5zXG4gIGZ1bmN0aW9uIHRha2VUb2tlbihjbSwgcG9zLCBwcmVjaXNlLCBhc0FycmF5KSB7XG4gICAgZnVuY3Rpb24gZ2V0T2JqKGNvcHkpIHtcbiAgICAgIHJldHVybiB7c3RhcnQ6IHN0cmVhbS5zdGFydCwgZW5kOiBzdHJlYW0ucG9zLFxuICAgICAgICAgICAgICBzdHJpbmc6IHN0cmVhbS5jdXJyZW50KCksXG4gICAgICAgICAgICAgIHR5cGU6IHN0eWxlIHx8IG51bGwsXG4gICAgICAgICAgICAgIHN0YXRlOiBjb3B5ID8gY29weVN0YXRlKGRvYy5tb2RlLCBzdGF0ZSkgOiBzdGF0ZX07XG4gICAgfVxuXG4gICAgdmFyIGRvYyA9IGNtLmRvYywgbW9kZSA9IGRvYy5tb2RlLCBzdHlsZTtcbiAgICBwb3MgPSBjbGlwUG9zKGRvYywgcG9zKTtcbiAgICB2YXIgbGluZSA9IGdldExpbmUoZG9jLCBwb3MubGluZSksIHN0YXRlID0gZ2V0U3RhdGVCZWZvcmUoY20sIHBvcy5saW5lLCBwcmVjaXNlKTtcbiAgICB2YXIgc3RyZWFtID0gbmV3IFN0cmluZ1N0cmVhbShsaW5lLnRleHQsIGNtLm9wdGlvbnMudGFiU2l6ZSksIHRva2VucztcbiAgICBpZiAoYXNBcnJheSkgdG9rZW5zID0gW107XG4gICAgd2hpbGUgKChhc0FycmF5IHx8IHN0cmVhbS5wb3MgPCBwb3MuY2gpICYmICFzdHJlYW0uZW9sKCkpIHtcbiAgICAgIHN0cmVhbS5zdGFydCA9IHN0cmVhbS5wb3M7XG4gICAgICBzdHlsZSA9IHJlYWRUb2tlbihtb2RlLCBzdHJlYW0sIHN0YXRlKTtcbiAgICAgIGlmIChhc0FycmF5KSB0b2tlbnMucHVzaChnZXRPYmoodHJ1ZSkpO1xuICAgIH1cbiAgICByZXR1cm4gYXNBcnJheSA/IHRva2VucyA6IGdldE9iaigpO1xuICB9XG5cbiAgLy8gUnVuIHRoZSBnaXZlbiBtb2RlJ3MgcGFyc2VyIG92ZXIgYSBsaW5lLCBjYWxsaW5nIGYgZm9yIGVhY2ggdG9rZW4uXG4gIGZ1bmN0aW9uIHJ1bk1vZGUoY20sIHRleHQsIG1vZGUsIHN0YXRlLCBmLCBsaW5lQ2xhc3NlcywgZm9yY2VUb0VuZCkge1xuICAgIHZhciBmbGF0dGVuU3BhbnMgPSBtb2RlLmZsYXR0ZW5TcGFucztcbiAgICBpZiAoZmxhdHRlblNwYW5zID09IG51bGwpIGZsYXR0ZW5TcGFucyA9IGNtLm9wdGlvbnMuZmxhdHRlblNwYW5zO1xuICAgIHZhciBjdXJTdGFydCA9IDAsIGN1clN0eWxlID0gbnVsbDtcbiAgICB2YXIgc3RyZWFtID0gbmV3IFN0cmluZ1N0cmVhbSh0ZXh0LCBjbS5vcHRpb25zLnRhYlNpemUpLCBzdHlsZTtcbiAgICB2YXIgaW5uZXIgPSBjbS5vcHRpb25zLmFkZE1vZGVDbGFzcyAmJiBbbnVsbF07XG4gICAgaWYgKHRleHQgPT0gXCJcIikgZXh0cmFjdExpbmVDbGFzc2VzKGNhbGxCbGFua0xpbmUobW9kZSwgc3RhdGUpLCBsaW5lQ2xhc3Nlcyk7XG4gICAgd2hpbGUgKCFzdHJlYW0uZW9sKCkpIHtcbiAgICAgIGlmIChzdHJlYW0ucG9zID4gY20ub3B0aW9ucy5tYXhIaWdobGlnaHRMZW5ndGgpIHtcbiAgICAgICAgZmxhdHRlblNwYW5zID0gZmFsc2U7XG4gICAgICAgIGlmIChmb3JjZVRvRW5kKSBwcm9jZXNzTGluZShjbSwgdGV4dCwgc3RhdGUsIHN0cmVhbS5wb3MpO1xuICAgICAgICBzdHJlYW0ucG9zID0gdGV4dC5sZW5ndGg7XG4gICAgICAgIHN0eWxlID0gbnVsbDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHN0eWxlID0gZXh0cmFjdExpbmVDbGFzc2VzKHJlYWRUb2tlbihtb2RlLCBzdHJlYW0sIHN0YXRlLCBpbm5lciksIGxpbmVDbGFzc2VzKTtcbiAgICAgIH1cbiAgICAgIGlmIChpbm5lcikge1xuICAgICAgICB2YXIgbU5hbWUgPSBpbm5lclswXS5uYW1lO1xuICAgICAgICBpZiAobU5hbWUpIHN0eWxlID0gXCJtLVwiICsgKHN0eWxlID8gbU5hbWUgKyBcIiBcIiArIHN0eWxlIDogbU5hbWUpO1xuICAgICAgfVxuICAgICAgaWYgKCFmbGF0dGVuU3BhbnMgfHwgY3VyU3R5bGUgIT0gc3R5bGUpIHtcbiAgICAgICAgd2hpbGUgKGN1clN0YXJ0IDwgc3RyZWFtLnN0YXJ0KSB7XG4gICAgICAgICAgY3VyU3RhcnQgPSBNYXRoLm1pbihzdHJlYW0uc3RhcnQsIGN1clN0YXJ0ICsgNTAwMDApO1xuICAgICAgICAgIGYoY3VyU3RhcnQsIGN1clN0eWxlKTtcbiAgICAgICAgfVxuICAgICAgICBjdXJTdHlsZSA9IHN0eWxlO1xuICAgICAgfVxuICAgICAgc3RyZWFtLnN0YXJ0ID0gc3RyZWFtLnBvcztcbiAgICB9XG4gICAgd2hpbGUgKGN1clN0YXJ0IDwgc3RyZWFtLnBvcykge1xuICAgICAgLy8gV2Via2l0IHNlZW1zIHRvIHJlZnVzZSB0byByZW5kZXIgdGV4dCBub2RlcyBsb25nZXIgdGhhbiA1NzQ0NCBjaGFyYWN0ZXJzXG4gICAgICB2YXIgcG9zID0gTWF0aC5taW4oc3RyZWFtLnBvcywgY3VyU3RhcnQgKyA1MDAwMCk7XG4gICAgICBmKHBvcywgY3VyU3R5bGUpO1xuICAgICAgY3VyU3RhcnQgPSBwb3M7XG4gICAgfVxuICB9XG5cbiAgLy8gQ29tcHV0ZSBhIHN0eWxlIGFycmF5IChhbiBhcnJheSBzdGFydGluZyB3aXRoIGEgbW9kZSBnZW5lcmF0aW9uXG4gIC8vIC0tIGZvciBpbnZhbGlkYXRpb24gLS0gZm9sbG93ZWQgYnkgcGFpcnMgb2YgZW5kIHBvc2l0aW9ucyBhbmRcbiAgLy8gc3R5bGUgc3RyaW5ncyksIHdoaWNoIGlzIHVzZWQgdG8gaGlnaGxpZ2h0IHRoZSB0b2tlbnMgb24gdGhlXG4gIC8vIGxpbmUuXG4gIGZ1bmN0aW9uIGhpZ2hsaWdodExpbmUoY20sIGxpbmUsIHN0YXRlLCBmb3JjZVRvRW5kKSB7XG4gICAgLy8gQSBzdHlsZXMgYXJyYXkgYWx3YXlzIHN0YXJ0cyB3aXRoIGEgbnVtYmVyIGlkZW50aWZ5aW5nIHRoZVxuICAgIC8vIG1vZGUvb3ZlcmxheXMgdGhhdCBpdCBpcyBiYXNlZCBvbiAoZm9yIGVhc3kgaW52YWxpZGF0aW9uKS5cbiAgICB2YXIgc3QgPSBbY20uc3RhdGUubW9kZUdlbl0sIGxpbmVDbGFzc2VzID0ge307XG4gICAgLy8gQ29tcHV0ZSB0aGUgYmFzZSBhcnJheSBvZiBzdHlsZXNcbiAgICBydW5Nb2RlKGNtLCBsaW5lLnRleHQsIGNtLmRvYy5tb2RlLCBzdGF0ZSwgZnVuY3Rpb24oZW5kLCBzdHlsZSkge1xuICAgICAgc3QucHVzaChlbmQsIHN0eWxlKTtcbiAgICB9LCBsaW5lQ2xhc3NlcywgZm9yY2VUb0VuZCk7XG5cbiAgICAvLyBSdW4gb3ZlcmxheXMsIGFkanVzdCBzdHlsZSBhcnJheS5cbiAgICBmb3IgKHZhciBvID0gMDsgbyA8IGNtLnN0YXRlLm92ZXJsYXlzLmxlbmd0aDsgKytvKSB7XG4gICAgICB2YXIgb3ZlcmxheSA9IGNtLnN0YXRlLm92ZXJsYXlzW29dLCBpID0gMSwgYXQgPSAwO1xuICAgICAgcnVuTW9kZShjbSwgbGluZS50ZXh0LCBvdmVybGF5Lm1vZGUsIHRydWUsIGZ1bmN0aW9uKGVuZCwgc3R5bGUpIHtcbiAgICAgICAgdmFyIHN0YXJ0ID0gaTtcbiAgICAgICAgLy8gRW5zdXJlIHRoZXJlJ3MgYSB0b2tlbiBlbmQgYXQgdGhlIGN1cnJlbnQgcG9zaXRpb24sIGFuZCB0aGF0IGkgcG9pbnRzIGF0IGl0XG4gICAgICAgIHdoaWxlIChhdCA8IGVuZCkge1xuICAgICAgICAgIHZhciBpX2VuZCA9IHN0W2ldO1xuICAgICAgICAgIGlmIChpX2VuZCA+IGVuZClcbiAgICAgICAgICAgIHN0LnNwbGljZShpLCAxLCBlbmQsIHN0W2krMV0sIGlfZW5kKTtcbiAgICAgICAgICBpICs9IDI7XG4gICAgICAgICAgYXQgPSBNYXRoLm1pbihlbmQsIGlfZW5kKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXN0eWxlKSByZXR1cm47XG4gICAgICAgIGlmIChvdmVybGF5Lm9wYXF1ZSkge1xuICAgICAgICAgIHN0LnNwbGljZShzdGFydCwgaSAtIHN0YXJ0LCBlbmQsIFwiY20tb3ZlcmxheSBcIiArIHN0eWxlKTtcbiAgICAgICAgICBpID0gc3RhcnQgKyAyO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGZvciAoOyBzdGFydCA8IGk7IHN0YXJ0ICs9IDIpIHtcbiAgICAgICAgICAgIHZhciBjdXIgPSBzdFtzdGFydCsxXTtcbiAgICAgICAgICAgIHN0W3N0YXJ0KzFdID0gKGN1ciA/IGN1ciArIFwiIFwiIDogXCJcIikgKyBcImNtLW92ZXJsYXkgXCIgKyBzdHlsZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0sIGxpbmVDbGFzc2VzKTtcbiAgICB9XG5cbiAgICByZXR1cm4ge3N0eWxlczogc3QsIGNsYXNzZXM6IGxpbmVDbGFzc2VzLmJnQ2xhc3MgfHwgbGluZUNsYXNzZXMudGV4dENsYXNzID8gbGluZUNsYXNzZXMgOiBudWxsfTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGdldExpbmVTdHlsZXMoY20sIGxpbmUsIHVwZGF0ZUZyb250aWVyKSB7XG4gICAgaWYgKCFsaW5lLnN0eWxlcyB8fCBsaW5lLnN0eWxlc1swXSAhPSBjbS5zdGF0ZS5tb2RlR2VuKSB7XG4gICAgICB2YXIgc3RhdGUgPSBnZXRTdGF0ZUJlZm9yZShjbSwgbGluZU5vKGxpbmUpKTtcbiAgICAgIHZhciByZXN1bHQgPSBoaWdobGlnaHRMaW5lKGNtLCBsaW5lLCBsaW5lLnRleHQubGVuZ3RoID4gY20ub3B0aW9ucy5tYXhIaWdobGlnaHRMZW5ndGggPyBjb3B5U3RhdGUoY20uZG9jLm1vZGUsIHN0YXRlKSA6IHN0YXRlKTtcbiAgICAgIGxpbmUuc3RhdGVBZnRlciA9IHN0YXRlO1xuICAgICAgbGluZS5zdHlsZXMgPSByZXN1bHQuc3R5bGVzO1xuICAgICAgaWYgKHJlc3VsdC5jbGFzc2VzKSBsaW5lLnN0eWxlQ2xhc3NlcyA9IHJlc3VsdC5jbGFzc2VzO1xuICAgICAgZWxzZSBpZiAobGluZS5zdHlsZUNsYXNzZXMpIGxpbmUuc3R5bGVDbGFzc2VzID0gbnVsbDtcbiAgICAgIGlmICh1cGRhdGVGcm9udGllciA9PT0gY20uZG9jLmZyb250aWVyKSBjbS5kb2MuZnJvbnRpZXIrKztcbiAgICB9XG4gICAgcmV0dXJuIGxpbmUuc3R5bGVzO1xuICB9XG5cbiAgLy8gTGlnaHR3ZWlnaHQgZm9ybSBvZiBoaWdobGlnaHQgLS0gcHJvY2VlZCBvdmVyIHRoaXMgbGluZSBhbmRcbiAgLy8gdXBkYXRlIHN0YXRlLCBidXQgZG9uJ3Qgc2F2ZSBhIHN0eWxlIGFycmF5LiBVc2VkIGZvciBsaW5lcyB0aGF0XG4gIC8vIGFyZW4ndCBjdXJyZW50bHkgdmlzaWJsZS5cbiAgZnVuY3Rpb24gcHJvY2Vzc0xpbmUoY20sIHRleHQsIHN0YXRlLCBzdGFydEF0KSB7XG4gICAgdmFyIG1vZGUgPSBjbS5kb2MubW9kZTtcbiAgICB2YXIgc3RyZWFtID0gbmV3IFN0cmluZ1N0cmVhbSh0ZXh0LCBjbS5vcHRpb25zLnRhYlNpemUpO1xuICAgIHN0cmVhbS5zdGFydCA9IHN0cmVhbS5wb3MgPSBzdGFydEF0IHx8IDA7XG4gICAgaWYgKHRleHQgPT0gXCJcIikgY2FsbEJsYW5rTGluZShtb2RlLCBzdGF0ZSk7XG4gICAgd2hpbGUgKCFzdHJlYW0uZW9sKCkpIHtcbiAgICAgIHJlYWRUb2tlbihtb2RlLCBzdHJlYW0sIHN0YXRlKTtcbiAgICAgIHN0cmVhbS5zdGFydCA9IHN0cmVhbS5wb3M7XG4gICAgfVxuICB9XG5cbiAgLy8gQ29udmVydCBhIHN0eWxlIGFzIHJldHVybmVkIGJ5IGEgbW9kZSAoZWl0aGVyIG51bGwsIG9yIGEgc3RyaW5nXG4gIC8vIGNvbnRhaW5pbmcgb25lIG9yIG1vcmUgc3R5bGVzKSB0byBhIENTUyBzdHlsZS4gVGhpcyBpcyBjYWNoZWQsXG4gIC8vIGFuZCBhbHNvIGxvb2tzIGZvciBsaW5lLXdpZGUgc3R5bGVzLlxuICB2YXIgc3R5bGVUb0NsYXNzQ2FjaGUgPSB7fSwgc3R5bGVUb0NsYXNzQ2FjaGVXaXRoTW9kZSA9IHt9O1xuICBmdW5jdGlvbiBpbnRlcnByZXRUb2tlblN0eWxlKHN0eWxlLCBvcHRpb25zKSB7XG4gICAgaWYgKCFzdHlsZSB8fCAvXlxccyokLy50ZXN0KHN0eWxlKSkgcmV0dXJuIG51bGw7XG4gICAgdmFyIGNhY2hlID0gb3B0aW9ucy5hZGRNb2RlQ2xhc3MgPyBzdHlsZVRvQ2xhc3NDYWNoZVdpdGhNb2RlIDogc3R5bGVUb0NsYXNzQ2FjaGU7XG4gICAgcmV0dXJuIGNhY2hlW3N0eWxlXSB8fFxuICAgICAgKGNhY2hlW3N0eWxlXSA9IHN0eWxlLnJlcGxhY2UoL1xcUysvZywgXCJjbS0kJlwiKSk7XG4gIH1cblxuICAvLyBSZW5kZXIgdGhlIERPTSByZXByZXNlbnRhdGlvbiBvZiB0aGUgdGV4dCBvZiBhIGxpbmUuIEFsc28gYnVpbGRzXG4gIC8vIHVwIGEgJ2xpbmUgbWFwJywgd2hpY2ggcG9pbnRzIGF0IHRoZSBET00gbm9kZXMgdGhhdCByZXByZXNlbnRcbiAgLy8gc3BlY2lmaWMgc3RyZXRjaGVzIG9mIHRleHQsIGFuZCBpcyB1c2VkIGJ5IHRoZSBtZWFzdXJpbmcgY29kZS5cbiAgLy8gVGhlIHJldHVybmVkIG9iamVjdCBjb250YWlucyB0aGUgRE9NIG5vZGUsIHRoaXMgbWFwLCBhbmRcbiAgLy8gaW5mb3JtYXRpb24gYWJvdXQgbGluZS13aWRlIHN0eWxlcyB0aGF0IHdlcmUgc2V0IGJ5IHRoZSBtb2RlLlxuICBmdW5jdGlvbiBidWlsZExpbmVDb250ZW50KGNtLCBsaW5lVmlldykge1xuICAgIC8vIFRoZSBwYWRkaW5nLXJpZ2h0IGZvcmNlcyB0aGUgZWxlbWVudCB0byBoYXZlIGEgJ2JvcmRlcicsIHdoaWNoXG4gICAgLy8gaXMgbmVlZGVkIG9uIFdlYmtpdCB0byBiZSBhYmxlIHRvIGdldCBsaW5lLWxldmVsIGJvdW5kaW5nXG4gICAgLy8gcmVjdGFuZ2xlcyBmb3IgaXQgKGluIG1lYXN1cmVDaGFyKS5cbiAgICB2YXIgY29udGVudCA9IGVsdChcInNwYW5cIiwgbnVsbCwgbnVsbCwgd2Via2l0ID8gXCJwYWRkaW5nLXJpZ2h0OiAuMXB4XCIgOiBudWxsKTtcbiAgICB2YXIgYnVpbGRlciA9IHtwcmU6IGVsdChcInByZVwiLCBbY29udGVudF0sIFwiQ29kZU1pcnJvci1saW5lXCIpLCBjb250ZW50OiBjb250ZW50LFxuICAgICAgICAgICAgICAgICAgIGNvbDogMCwgcG9zOiAwLCBjbTogY20sXG4gICAgICAgICAgICAgICAgICAgc3BsaXRTcGFjZXM6IChpZSB8fCB3ZWJraXQpICYmIGNtLmdldE9wdGlvbihcImxpbmVXcmFwcGluZ1wiKX07XG4gICAgbGluZVZpZXcubWVhc3VyZSA9IHt9O1xuXG4gICAgLy8gSXRlcmF0ZSBvdmVyIHRoZSBsb2dpY2FsIGxpbmVzIHRoYXQgbWFrZSB1cCB0aGlzIHZpc3VhbCBsaW5lLlxuICAgIGZvciAodmFyIGkgPSAwOyBpIDw9IChsaW5lVmlldy5yZXN0ID8gbGluZVZpZXcucmVzdC5sZW5ndGggOiAwKTsgaSsrKSB7XG4gICAgICB2YXIgbGluZSA9IGkgPyBsaW5lVmlldy5yZXN0W2kgLSAxXSA6IGxpbmVWaWV3LmxpbmUsIG9yZGVyO1xuICAgICAgYnVpbGRlci5wb3MgPSAwO1xuICAgICAgYnVpbGRlci5hZGRUb2tlbiA9IGJ1aWxkVG9rZW47XG4gICAgICAvLyBPcHRpb25hbGx5IHdpcmUgaW4gc29tZSBoYWNrcyBpbnRvIHRoZSB0b2tlbi1yZW5kZXJpbmdcbiAgICAgIC8vIGFsZ29yaXRobSwgdG8gZGVhbCB3aXRoIGJyb3dzZXIgcXVpcmtzLlxuICAgICAgaWYgKGhhc0JhZEJpZGlSZWN0cyhjbS5kaXNwbGF5Lm1lYXN1cmUpICYmIChvcmRlciA9IGdldE9yZGVyKGxpbmUpKSlcbiAgICAgICAgYnVpbGRlci5hZGRUb2tlbiA9IGJ1aWxkVG9rZW5CYWRCaWRpKGJ1aWxkZXIuYWRkVG9rZW4sIG9yZGVyKTtcbiAgICAgIGJ1aWxkZXIubWFwID0gW107XG4gICAgICB2YXIgYWxsb3dGcm9udGllclVwZGF0ZSA9IGxpbmVWaWV3ICE9IGNtLmRpc3BsYXkuZXh0ZXJuYWxNZWFzdXJlZCAmJiBsaW5lTm8obGluZSk7XG4gICAgICBpbnNlcnRMaW5lQ29udGVudChsaW5lLCBidWlsZGVyLCBnZXRMaW5lU3R5bGVzKGNtLCBsaW5lLCBhbGxvd0Zyb250aWVyVXBkYXRlKSk7XG4gICAgICBpZiAobGluZS5zdHlsZUNsYXNzZXMpIHtcbiAgICAgICAgaWYgKGxpbmUuc3R5bGVDbGFzc2VzLmJnQ2xhc3MpXG4gICAgICAgICAgYnVpbGRlci5iZ0NsYXNzID0gam9pbkNsYXNzZXMobGluZS5zdHlsZUNsYXNzZXMuYmdDbGFzcywgYnVpbGRlci5iZ0NsYXNzIHx8IFwiXCIpO1xuICAgICAgICBpZiAobGluZS5zdHlsZUNsYXNzZXMudGV4dENsYXNzKVxuICAgICAgICAgIGJ1aWxkZXIudGV4dENsYXNzID0gam9pbkNsYXNzZXMobGluZS5zdHlsZUNsYXNzZXMudGV4dENsYXNzLCBidWlsZGVyLnRleHRDbGFzcyB8fCBcIlwiKTtcbiAgICAgIH1cblxuICAgICAgLy8gRW5zdXJlIGF0IGxlYXN0IGEgc2luZ2xlIG5vZGUgaXMgcHJlc2VudCwgZm9yIG1lYXN1cmluZy5cbiAgICAgIGlmIChidWlsZGVyLm1hcC5sZW5ndGggPT0gMClcbiAgICAgICAgYnVpbGRlci5tYXAucHVzaCgwLCAwLCBidWlsZGVyLmNvbnRlbnQuYXBwZW5kQ2hpbGQoemVyb1dpZHRoRWxlbWVudChjbS5kaXNwbGF5Lm1lYXN1cmUpKSk7XG5cbiAgICAgIC8vIFN0b3JlIHRoZSBtYXAgYW5kIGEgY2FjaGUgb2JqZWN0IGZvciB0aGUgY3VycmVudCBsb2dpY2FsIGxpbmVcbiAgICAgIGlmIChpID09IDApIHtcbiAgICAgICAgbGluZVZpZXcubWVhc3VyZS5tYXAgPSBidWlsZGVyLm1hcDtcbiAgICAgICAgbGluZVZpZXcubWVhc3VyZS5jYWNoZSA9IHt9O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgKGxpbmVWaWV3Lm1lYXN1cmUubWFwcyB8fCAobGluZVZpZXcubWVhc3VyZS5tYXBzID0gW10pKS5wdXNoKGJ1aWxkZXIubWFwKTtcbiAgICAgICAgKGxpbmVWaWV3Lm1lYXN1cmUuY2FjaGVzIHx8IChsaW5lVmlldy5tZWFzdXJlLmNhY2hlcyA9IFtdKSkucHVzaCh7fSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gU2VlIGlzc3VlICMyOTAxXG4gICAgaWYgKHdlYmtpdCAmJiAvXFxiY20tdGFiXFxiLy50ZXN0KGJ1aWxkZXIuY29udGVudC5sYXN0Q2hpbGQuY2xhc3NOYW1lKSlcbiAgICAgIGJ1aWxkZXIuY29udGVudC5jbGFzc05hbWUgPSBcImNtLXRhYi13cmFwLWhhY2tcIjtcblxuICAgIHNpZ25hbChjbSwgXCJyZW5kZXJMaW5lXCIsIGNtLCBsaW5lVmlldy5saW5lLCBidWlsZGVyLnByZSk7XG4gICAgaWYgKGJ1aWxkZXIucHJlLmNsYXNzTmFtZSlcbiAgICAgIGJ1aWxkZXIudGV4dENsYXNzID0gam9pbkNsYXNzZXMoYnVpbGRlci5wcmUuY2xhc3NOYW1lLCBidWlsZGVyLnRleHRDbGFzcyB8fCBcIlwiKTtcblxuICAgIHJldHVybiBidWlsZGVyO1xuICB9XG5cbiAgZnVuY3Rpb24gZGVmYXVsdFNwZWNpYWxDaGFyUGxhY2Vob2xkZXIoY2gpIHtcbiAgICB2YXIgdG9rZW4gPSBlbHQoXCJzcGFuXCIsIFwiXFx1MjAyMlwiLCBcImNtLWludmFsaWRjaGFyXCIpO1xuICAgIHRva2VuLnRpdGxlID0gXCJcXFxcdVwiICsgY2guY2hhckNvZGVBdCgwKS50b1N0cmluZygxNik7XG4gICAgdG9rZW4uc2V0QXR0cmlidXRlKFwiYXJpYS1sYWJlbFwiLCB0b2tlbi50aXRsZSk7XG4gICAgcmV0dXJuIHRva2VuO1xuICB9XG5cbiAgLy8gQnVpbGQgdXAgdGhlIERPTSByZXByZXNlbnRhdGlvbiBmb3IgYSBzaW5nbGUgdG9rZW4sIGFuZCBhZGQgaXQgdG9cbiAgLy8gdGhlIGxpbmUgbWFwLiBUYWtlcyBjYXJlIHRvIHJlbmRlciBzcGVjaWFsIGNoYXJhY3RlcnMgc2VwYXJhdGVseS5cbiAgZnVuY3Rpb24gYnVpbGRUb2tlbihidWlsZGVyLCB0ZXh0LCBzdHlsZSwgc3RhcnRTdHlsZSwgZW5kU3R5bGUsIHRpdGxlLCBjc3MpIHtcbiAgICBpZiAoIXRleHQpIHJldHVybjtcbiAgICB2YXIgZGlzcGxheVRleHQgPSBidWlsZGVyLnNwbGl0U3BhY2VzID8gdGV4dC5yZXBsYWNlKC8gezMsfS9nLCBzcGxpdFNwYWNlcykgOiB0ZXh0O1xuICAgIHZhciBzcGVjaWFsID0gYnVpbGRlci5jbS5zdGF0ZS5zcGVjaWFsQ2hhcnMsIG11c3RXcmFwID0gZmFsc2U7XG4gICAgaWYgKCFzcGVjaWFsLnRlc3QodGV4dCkpIHtcbiAgICAgIGJ1aWxkZXIuY29sICs9IHRleHQubGVuZ3RoO1xuICAgICAgdmFyIGNvbnRlbnQgPSBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShkaXNwbGF5VGV4dCk7XG4gICAgICBidWlsZGVyLm1hcC5wdXNoKGJ1aWxkZXIucG9zLCBidWlsZGVyLnBvcyArIHRleHQubGVuZ3RoLCBjb250ZW50KTtcbiAgICAgIGlmIChpZSAmJiBpZV92ZXJzaW9uIDwgOSkgbXVzdFdyYXAgPSB0cnVlO1xuICAgICAgYnVpbGRlci5wb3MgKz0gdGV4dC5sZW5ndGg7XG4gICAgfSBlbHNlIHtcbiAgICAgIHZhciBjb250ZW50ID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpLCBwb3MgPSAwO1xuICAgICAgd2hpbGUgKHRydWUpIHtcbiAgICAgICAgc3BlY2lhbC5sYXN0SW5kZXggPSBwb3M7XG4gICAgICAgIHZhciBtID0gc3BlY2lhbC5leGVjKHRleHQpO1xuICAgICAgICB2YXIgc2tpcHBlZCA9IG0gPyBtLmluZGV4IC0gcG9zIDogdGV4dC5sZW5ndGggLSBwb3M7XG4gICAgICAgIGlmIChza2lwcGVkKSB7XG4gICAgICAgICAgdmFyIHR4dCA9IGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGRpc3BsYXlUZXh0LnNsaWNlKHBvcywgcG9zICsgc2tpcHBlZCkpO1xuICAgICAgICAgIGlmIChpZSAmJiBpZV92ZXJzaW9uIDwgOSkgY29udGVudC5hcHBlbmRDaGlsZChlbHQoXCJzcGFuXCIsIFt0eHRdKSk7XG4gICAgICAgICAgZWxzZSBjb250ZW50LmFwcGVuZENoaWxkKHR4dCk7XG4gICAgICAgICAgYnVpbGRlci5tYXAucHVzaChidWlsZGVyLnBvcywgYnVpbGRlci5wb3MgKyBza2lwcGVkLCB0eHQpO1xuICAgICAgICAgIGJ1aWxkZXIuY29sICs9IHNraXBwZWQ7XG4gICAgICAgICAgYnVpbGRlci5wb3MgKz0gc2tpcHBlZDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIW0pIGJyZWFrO1xuICAgICAgICBwb3MgKz0gc2tpcHBlZCArIDE7XG4gICAgICAgIGlmIChtWzBdID09IFwiXFx0XCIpIHtcbiAgICAgICAgICB2YXIgdGFiU2l6ZSA9IGJ1aWxkZXIuY20ub3B0aW9ucy50YWJTaXplLCB0YWJXaWR0aCA9IHRhYlNpemUgLSBidWlsZGVyLmNvbCAlIHRhYlNpemU7XG4gICAgICAgICAgdmFyIHR4dCA9IGNvbnRlbnQuYXBwZW5kQ2hpbGQoZWx0KFwic3BhblwiLCBzcGFjZVN0cih0YWJXaWR0aCksIFwiY20tdGFiXCIpKTtcbiAgICAgICAgICB0eHQuc2V0QXR0cmlidXRlKFwicm9sZVwiLCBcInByZXNlbnRhdGlvblwiKTtcbiAgICAgICAgICB0eHQuc2V0QXR0cmlidXRlKFwiY20tdGV4dFwiLCBcIlxcdFwiKTtcbiAgICAgICAgICBidWlsZGVyLmNvbCArPSB0YWJXaWR0aDtcbiAgICAgICAgfSBlbHNlIGlmIChtWzBdID09IFwiXFxyXCIgfHwgbVswXSA9PSBcIlxcblwiKSB7XG4gICAgICAgICAgdmFyIHR4dCA9IGNvbnRlbnQuYXBwZW5kQ2hpbGQoZWx0KFwic3BhblwiLCBtWzBdID09IFwiXFxyXCIgPyBcIlxcdTI0MGRcIiA6IFwiXFx1MjQyNFwiLCBcImNtLWludmFsaWRjaGFyXCIpKTtcbiAgICAgICAgICB0eHQuc2V0QXR0cmlidXRlKFwiY20tdGV4dFwiLCBtWzBdKTtcbiAgICAgICAgICBidWlsZGVyLmNvbCArPSAxO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHZhciB0eHQgPSBidWlsZGVyLmNtLm9wdGlvbnMuc3BlY2lhbENoYXJQbGFjZWhvbGRlcihtWzBdKTtcbiAgICAgICAgICB0eHQuc2V0QXR0cmlidXRlKFwiY20tdGV4dFwiLCBtWzBdKTtcbiAgICAgICAgICBpZiAoaWUgJiYgaWVfdmVyc2lvbiA8IDkpIGNvbnRlbnQuYXBwZW5kQ2hpbGQoZWx0KFwic3BhblwiLCBbdHh0XSkpO1xuICAgICAgICAgIGVsc2UgY29udGVudC5hcHBlbmRDaGlsZCh0eHQpO1xuICAgICAgICAgIGJ1aWxkZXIuY29sICs9IDE7XG4gICAgICAgIH1cbiAgICAgICAgYnVpbGRlci5tYXAucHVzaChidWlsZGVyLnBvcywgYnVpbGRlci5wb3MgKyAxLCB0eHQpO1xuICAgICAgICBidWlsZGVyLnBvcysrO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoc3R5bGUgfHwgc3RhcnRTdHlsZSB8fCBlbmRTdHlsZSB8fCBtdXN0V3JhcCB8fCBjc3MpIHtcbiAgICAgIHZhciBmdWxsU3R5bGUgPSBzdHlsZSB8fCBcIlwiO1xuICAgICAgaWYgKHN0YXJ0U3R5bGUpIGZ1bGxTdHlsZSArPSBzdGFydFN0eWxlO1xuICAgICAgaWYgKGVuZFN0eWxlKSBmdWxsU3R5bGUgKz0gZW5kU3R5bGU7XG4gICAgICB2YXIgdG9rZW4gPSBlbHQoXCJzcGFuXCIsIFtjb250ZW50XSwgZnVsbFN0eWxlLCBjc3MpO1xuICAgICAgaWYgKHRpdGxlKSB0b2tlbi50aXRsZSA9IHRpdGxlO1xuICAgICAgcmV0dXJuIGJ1aWxkZXIuY29udGVudC5hcHBlbmRDaGlsZCh0b2tlbik7XG4gICAgfVxuICAgIGJ1aWxkZXIuY29udGVudC5hcHBlbmRDaGlsZChjb250ZW50KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHNwbGl0U3BhY2VzKG9sZCkge1xuICAgIHZhciBvdXQgPSBcIiBcIjtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IG9sZC5sZW5ndGggLSAyOyArK2kpIG91dCArPSBpICUgMiA/IFwiIFwiIDogXCJcXHUwMGEwXCI7XG4gICAgb3V0ICs9IFwiIFwiO1xuICAgIHJldHVybiBvdXQ7XG4gIH1cblxuICAvLyBXb3JrIGFyb3VuZCBub25zZW5zZSBkaW1lbnNpb25zIGJlaW5nIHJlcG9ydGVkIGZvciBzdHJldGNoZXMgb2ZcbiAgLy8gcmlnaHQtdG8tbGVmdCB0ZXh0LlxuICBmdW5jdGlvbiBidWlsZFRva2VuQmFkQmlkaShpbm5lciwgb3JkZXIpIHtcbiAgICByZXR1cm4gZnVuY3Rpb24oYnVpbGRlciwgdGV4dCwgc3R5bGUsIHN0YXJ0U3R5bGUsIGVuZFN0eWxlLCB0aXRsZSwgY3NzKSB7XG4gICAgICBzdHlsZSA9IHN0eWxlID8gc3R5bGUgKyBcIiBjbS1mb3JjZS1ib3JkZXJcIiA6IFwiY20tZm9yY2UtYm9yZGVyXCI7XG4gICAgICB2YXIgc3RhcnQgPSBidWlsZGVyLnBvcywgZW5kID0gc3RhcnQgKyB0ZXh0Lmxlbmd0aDtcbiAgICAgIGZvciAoOzspIHtcbiAgICAgICAgLy8gRmluZCB0aGUgcGFydCB0aGF0IG92ZXJsYXBzIHdpdGggdGhlIHN0YXJ0IG9mIHRoaXMgdGV4dFxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG9yZGVyLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgdmFyIHBhcnQgPSBvcmRlcltpXTtcbiAgICAgICAgICBpZiAocGFydC50byA+IHN0YXJ0ICYmIHBhcnQuZnJvbSA8PSBzdGFydCkgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHBhcnQudG8gPj0gZW5kKSByZXR1cm4gaW5uZXIoYnVpbGRlciwgdGV4dCwgc3R5bGUsIHN0YXJ0U3R5bGUsIGVuZFN0eWxlLCB0aXRsZSwgY3NzKTtcbiAgICAgICAgaW5uZXIoYnVpbGRlciwgdGV4dC5zbGljZSgwLCBwYXJ0LnRvIC0gc3RhcnQpLCBzdHlsZSwgc3RhcnRTdHlsZSwgbnVsbCwgdGl0bGUsIGNzcyk7XG4gICAgICAgIHN0YXJ0U3R5bGUgPSBudWxsO1xuICAgICAgICB0ZXh0ID0gdGV4dC5zbGljZShwYXJ0LnRvIC0gc3RhcnQpO1xuICAgICAgICBzdGFydCA9IHBhcnQudG87XG4gICAgICB9XG4gICAgfTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGJ1aWxkQ29sbGFwc2VkU3BhbihidWlsZGVyLCBzaXplLCBtYXJrZXIsIGlnbm9yZVdpZGdldCkge1xuICAgIHZhciB3aWRnZXQgPSAhaWdub3JlV2lkZ2V0ICYmIG1hcmtlci53aWRnZXROb2RlO1xuICAgIGlmICh3aWRnZXQpIGJ1aWxkZXIubWFwLnB1c2goYnVpbGRlci5wb3MsIGJ1aWxkZXIucG9zICsgc2l6ZSwgd2lkZ2V0KTtcbiAgICBpZiAoIWlnbm9yZVdpZGdldCAmJiBidWlsZGVyLmNtLmRpc3BsYXkuaW5wdXQubmVlZHNDb250ZW50QXR0cmlidXRlKSB7XG4gICAgICBpZiAoIXdpZGdldClcbiAgICAgICAgd2lkZ2V0ID0gYnVpbGRlci5jb250ZW50LmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpKTtcbiAgICAgIHdpZGdldC5zZXRBdHRyaWJ1dGUoXCJjbS1tYXJrZXJcIiwgbWFya2VyLmlkKTtcbiAgICB9XG4gICAgaWYgKHdpZGdldCkge1xuICAgICAgYnVpbGRlci5jbS5kaXNwbGF5LmlucHV0LnNldFVuZWRpdGFibGUod2lkZ2V0KTtcbiAgICAgIGJ1aWxkZXIuY29udGVudC5hcHBlbmRDaGlsZCh3aWRnZXQpO1xuICAgIH1cbiAgICBidWlsZGVyLnBvcyArPSBzaXplO1xuICB9XG5cbiAgLy8gT3V0cHV0cyBhIG51bWJlciBvZiBzcGFucyB0byBtYWtlIHVwIGEgbGluZSwgdGFraW5nIGhpZ2hsaWdodGluZ1xuICAvLyBhbmQgbWFya2VkIHRleHQgaW50byBhY2NvdW50LlxuICBmdW5jdGlvbiBpbnNlcnRMaW5lQ29udGVudChsaW5lLCBidWlsZGVyLCBzdHlsZXMpIHtcbiAgICB2YXIgc3BhbnMgPSBsaW5lLm1hcmtlZFNwYW5zLCBhbGxUZXh0ID0gbGluZS50ZXh0LCBhdCA9IDA7XG4gICAgaWYgKCFzcGFucykge1xuICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPCBzdHlsZXMubGVuZ3RoOyBpKz0yKVxuICAgICAgICBidWlsZGVyLmFkZFRva2VuKGJ1aWxkZXIsIGFsbFRleHQuc2xpY2UoYXQsIGF0ID0gc3R5bGVzW2ldKSwgaW50ZXJwcmV0VG9rZW5TdHlsZShzdHlsZXNbaSsxXSwgYnVpbGRlci5jbS5vcHRpb25zKSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdmFyIGxlbiA9IGFsbFRleHQubGVuZ3RoLCBwb3MgPSAwLCBpID0gMSwgdGV4dCA9IFwiXCIsIHN0eWxlLCBjc3M7XG4gICAgdmFyIG5leHRDaGFuZ2UgPSAwLCBzcGFuU3R5bGUsIHNwYW5FbmRTdHlsZSwgc3BhblN0YXJ0U3R5bGUsIHRpdGxlLCBjb2xsYXBzZWQ7XG4gICAgZm9yICg7Oykge1xuICAgICAgaWYgKG5leHRDaGFuZ2UgPT0gcG9zKSB7IC8vIFVwZGF0ZSBjdXJyZW50IG1hcmtlciBzZXRcbiAgICAgICAgc3BhblN0eWxlID0gc3BhbkVuZFN0eWxlID0gc3BhblN0YXJ0U3R5bGUgPSB0aXRsZSA9IGNzcyA9IFwiXCI7XG4gICAgICAgIGNvbGxhcHNlZCA9IG51bGw7IG5leHRDaGFuZ2UgPSBJbmZpbml0eTtcbiAgICAgICAgdmFyIGZvdW5kQm9va21hcmtzID0gW10sIGVuZFN0eWxlc1xuICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHNwYW5zLmxlbmd0aDsgKytqKSB7XG4gICAgICAgICAgdmFyIHNwID0gc3BhbnNbal0sIG0gPSBzcC5tYXJrZXI7XG4gICAgICAgICAgaWYgKG0udHlwZSA9PSBcImJvb2ttYXJrXCIgJiYgc3AuZnJvbSA9PSBwb3MgJiYgbS53aWRnZXROb2RlKSB7XG4gICAgICAgICAgICBmb3VuZEJvb2ttYXJrcy5wdXNoKG0pO1xuICAgICAgICAgIH0gZWxzZSBpZiAoc3AuZnJvbSA8PSBwb3MgJiYgKHNwLnRvID09IG51bGwgfHwgc3AudG8gPiBwb3MgfHwgbS5jb2xsYXBzZWQgJiYgc3AudG8gPT0gcG9zICYmIHNwLmZyb20gPT0gcG9zKSkge1xuICAgICAgICAgICAgaWYgKHNwLnRvICE9IG51bGwgJiYgc3AudG8gIT0gcG9zICYmIG5leHRDaGFuZ2UgPiBzcC50bykge1xuICAgICAgICAgICAgICBuZXh0Q2hhbmdlID0gc3AudG87XG4gICAgICAgICAgICAgIHNwYW5FbmRTdHlsZSA9IFwiXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAobS5jbGFzc05hbWUpIHNwYW5TdHlsZSArPSBcIiBcIiArIG0uY2xhc3NOYW1lO1xuICAgICAgICAgICAgaWYgKG0uY3NzKSBjc3MgPSAoY3NzID8gY3NzICsgXCI7XCIgOiBcIlwiKSArIG0uY3NzO1xuICAgICAgICAgICAgaWYgKG0uc3RhcnRTdHlsZSAmJiBzcC5mcm9tID09IHBvcykgc3BhblN0YXJ0U3R5bGUgKz0gXCIgXCIgKyBtLnN0YXJ0U3R5bGU7XG4gICAgICAgICAgICBpZiAobS5lbmRTdHlsZSAmJiBzcC50byA9PSBuZXh0Q2hhbmdlKSAoZW5kU3R5bGVzIHx8IChlbmRTdHlsZXMgPSBbXSkpLnB1c2gobS5lbmRTdHlsZSwgc3AudG8pXG4gICAgICAgICAgICBpZiAobS50aXRsZSAmJiAhdGl0bGUpIHRpdGxlID0gbS50aXRsZTtcbiAgICAgICAgICAgIGlmIChtLmNvbGxhcHNlZCAmJiAoIWNvbGxhcHNlZCB8fCBjb21wYXJlQ29sbGFwc2VkTWFya2Vycyhjb2xsYXBzZWQubWFya2VyLCBtKSA8IDApKVxuICAgICAgICAgICAgICBjb2xsYXBzZWQgPSBzcDtcbiAgICAgICAgICB9IGVsc2UgaWYgKHNwLmZyb20gPiBwb3MgJiYgbmV4dENoYW5nZSA+IHNwLmZyb20pIHtcbiAgICAgICAgICAgIG5leHRDaGFuZ2UgPSBzcC5mcm9tO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoZW5kU3R5bGVzKSBmb3IgKHZhciBqID0gMDsgaiA8IGVuZFN0eWxlcy5sZW5ndGg7IGogKz0gMilcbiAgICAgICAgICBpZiAoZW5kU3R5bGVzW2ogKyAxXSA9PSBuZXh0Q2hhbmdlKSBzcGFuRW5kU3R5bGUgKz0gXCIgXCIgKyBlbmRTdHlsZXNbal1cblxuICAgICAgICBpZiAoIWNvbGxhcHNlZCB8fCBjb2xsYXBzZWQuZnJvbSA9PSBwb3MpIGZvciAodmFyIGogPSAwOyBqIDwgZm91bmRCb29rbWFya3MubGVuZ3RoOyArK2opXG4gICAgICAgICAgYnVpbGRDb2xsYXBzZWRTcGFuKGJ1aWxkZXIsIDAsIGZvdW5kQm9va21hcmtzW2pdKTtcbiAgICAgICAgaWYgKGNvbGxhcHNlZCAmJiAoY29sbGFwc2VkLmZyb20gfHwgMCkgPT0gcG9zKSB7XG4gICAgICAgICAgYnVpbGRDb2xsYXBzZWRTcGFuKGJ1aWxkZXIsIChjb2xsYXBzZWQudG8gPT0gbnVsbCA/IGxlbiArIDEgOiBjb2xsYXBzZWQudG8pIC0gcG9zLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xsYXBzZWQubWFya2VyLCBjb2xsYXBzZWQuZnJvbSA9PSBudWxsKTtcbiAgICAgICAgICBpZiAoY29sbGFwc2VkLnRvID09IG51bGwpIHJldHVybjtcbiAgICAgICAgICBpZiAoY29sbGFwc2VkLnRvID09IHBvcykgY29sbGFwc2VkID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmIChwb3MgPj0gbGVuKSBicmVhaztcblxuICAgICAgdmFyIHVwdG8gPSBNYXRoLm1pbihsZW4sIG5leHRDaGFuZ2UpO1xuICAgICAgd2hpbGUgKHRydWUpIHtcbiAgICAgICAgaWYgKHRleHQpIHtcbiAgICAgICAgICB2YXIgZW5kID0gcG9zICsgdGV4dC5sZW5ndGg7XG4gICAgICAgICAgaWYgKCFjb2xsYXBzZWQpIHtcbiAgICAgICAgICAgIHZhciB0b2tlblRleHQgPSBlbmQgPiB1cHRvID8gdGV4dC5zbGljZSgwLCB1cHRvIC0gcG9zKSA6IHRleHQ7XG4gICAgICAgICAgICBidWlsZGVyLmFkZFRva2VuKGJ1aWxkZXIsIHRva2VuVGV4dCwgc3R5bGUgPyBzdHlsZSArIHNwYW5TdHlsZSA6IHNwYW5TdHlsZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3BhblN0YXJ0U3R5bGUsIHBvcyArIHRva2VuVGV4dC5sZW5ndGggPT0gbmV4dENoYW5nZSA/IHNwYW5FbmRTdHlsZSA6IFwiXCIsIHRpdGxlLCBjc3MpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoZW5kID49IHVwdG8pIHt0ZXh0ID0gdGV4dC5zbGljZSh1cHRvIC0gcG9zKTsgcG9zID0gdXB0bzsgYnJlYWs7fVxuICAgICAgICAgIHBvcyA9IGVuZDtcbiAgICAgICAgICBzcGFuU3RhcnRTdHlsZSA9IFwiXCI7XG4gICAgICAgIH1cbiAgICAgICAgdGV4dCA9IGFsbFRleHQuc2xpY2UoYXQsIGF0ID0gc3R5bGVzW2krK10pO1xuICAgICAgICBzdHlsZSA9IGludGVycHJldFRva2VuU3R5bGUoc3R5bGVzW2krK10sIGJ1aWxkZXIuY20ub3B0aW9ucyk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLy8gRE9DVU1FTlQgREFUQSBTVFJVQ1RVUkVcblxuICAvLyBCeSBkZWZhdWx0LCB1cGRhdGVzIHRoYXQgc3RhcnQgYW5kIGVuZCBhdCB0aGUgYmVnaW5uaW5nIG9mIGEgbGluZVxuICAvLyBhcmUgdHJlYXRlZCBzcGVjaWFsbHksIGluIG9yZGVyIHRvIG1ha2UgdGhlIGFzc29jaWF0aW9uIG9mIGxpbmVcbiAgLy8gd2lkZ2V0cyBhbmQgbWFya2VyIGVsZW1lbnRzIHdpdGggdGhlIHRleHQgYmVoYXZlIG1vcmUgaW50dWl0aXZlLlxuICBmdW5jdGlvbiBpc1dob2xlTGluZVVwZGF0ZShkb2MsIGNoYW5nZSkge1xuICAgIHJldHVybiBjaGFuZ2UuZnJvbS5jaCA9PSAwICYmIGNoYW5nZS50by5jaCA9PSAwICYmIGxzdChjaGFuZ2UudGV4dCkgPT0gXCJcIiAmJlxuICAgICAgKCFkb2MuY20gfHwgZG9jLmNtLm9wdGlvbnMud2hvbGVMaW5lVXBkYXRlQmVmb3JlKTtcbiAgfVxuXG4gIC8vIFBlcmZvcm0gYSBjaGFuZ2Ugb24gdGhlIGRvY3VtZW50IGRhdGEgc3RydWN0dXJlLlxuICBmdW5jdGlvbiB1cGRhdGVEb2MoZG9jLCBjaGFuZ2UsIG1hcmtlZFNwYW5zLCBlc3RpbWF0ZUhlaWdodCkge1xuICAgIGZ1bmN0aW9uIHNwYW5zRm9yKG4pIHtyZXR1cm4gbWFya2VkU3BhbnMgPyBtYXJrZWRTcGFuc1tuXSA6IG51bGw7fVxuICAgIGZ1bmN0aW9uIHVwZGF0ZShsaW5lLCB0ZXh0LCBzcGFucykge1xuICAgICAgdXBkYXRlTGluZShsaW5lLCB0ZXh0LCBzcGFucywgZXN0aW1hdGVIZWlnaHQpO1xuICAgICAgc2lnbmFsTGF0ZXIobGluZSwgXCJjaGFuZ2VcIiwgbGluZSwgY2hhbmdlKTtcbiAgICB9XG4gICAgZnVuY3Rpb24gbGluZXNGb3Ioc3RhcnQsIGVuZCkge1xuICAgICAgZm9yICh2YXIgaSA9IHN0YXJ0LCByZXN1bHQgPSBbXTsgaSA8IGVuZDsgKytpKVxuICAgICAgICByZXN1bHQucHVzaChuZXcgTGluZSh0ZXh0W2ldLCBzcGFuc0ZvcihpKSwgZXN0aW1hdGVIZWlnaHQpKTtcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuXG4gICAgdmFyIGZyb20gPSBjaGFuZ2UuZnJvbSwgdG8gPSBjaGFuZ2UudG8sIHRleHQgPSBjaGFuZ2UudGV4dDtcbiAgICB2YXIgZmlyc3RMaW5lID0gZ2V0TGluZShkb2MsIGZyb20ubGluZSksIGxhc3RMaW5lID0gZ2V0TGluZShkb2MsIHRvLmxpbmUpO1xuICAgIHZhciBsYXN0VGV4dCA9IGxzdCh0ZXh0KSwgbGFzdFNwYW5zID0gc3BhbnNGb3IodGV4dC5sZW5ndGggLSAxKSwgbmxpbmVzID0gdG8ubGluZSAtIGZyb20ubGluZTtcblxuICAgIC8vIEFkanVzdCB0aGUgbGluZSBzdHJ1Y3R1cmVcbiAgICBpZiAoY2hhbmdlLmZ1bGwpIHtcbiAgICAgIGRvYy5pbnNlcnQoMCwgbGluZXNGb3IoMCwgdGV4dC5sZW5ndGgpKTtcbiAgICAgIGRvYy5yZW1vdmUodGV4dC5sZW5ndGgsIGRvYy5zaXplIC0gdGV4dC5sZW5ndGgpO1xuICAgIH0gZWxzZSBpZiAoaXNXaG9sZUxpbmVVcGRhdGUoZG9jLCBjaGFuZ2UpKSB7XG4gICAgICAvLyBUaGlzIGlzIGEgd2hvbGUtbGluZSByZXBsYWNlLiBUcmVhdGVkIHNwZWNpYWxseSB0byBtYWtlXG4gICAgICAvLyBzdXJlIGxpbmUgb2JqZWN0cyBtb3ZlIHRoZSB3YXkgdGhleSBhcmUgc3VwcG9zZWQgdG8uXG4gICAgICB2YXIgYWRkZWQgPSBsaW5lc0ZvcigwLCB0ZXh0Lmxlbmd0aCAtIDEpO1xuICAgICAgdXBkYXRlKGxhc3RMaW5lLCBsYXN0TGluZS50ZXh0LCBsYXN0U3BhbnMpO1xuICAgICAgaWYgKG5saW5lcykgZG9jLnJlbW92ZShmcm9tLmxpbmUsIG5saW5lcyk7XG4gICAgICBpZiAoYWRkZWQubGVuZ3RoKSBkb2MuaW5zZXJ0KGZyb20ubGluZSwgYWRkZWQpO1xuICAgIH0gZWxzZSBpZiAoZmlyc3RMaW5lID09IGxhc3RMaW5lKSB7XG4gICAgICBpZiAodGV4dC5sZW5ndGggPT0gMSkge1xuICAgICAgICB1cGRhdGUoZmlyc3RMaW5lLCBmaXJzdExpbmUudGV4dC5zbGljZSgwLCBmcm9tLmNoKSArIGxhc3RUZXh0ICsgZmlyc3RMaW5lLnRleHQuc2xpY2UodG8uY2gpLCBsYXN0U3BhbnMpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIGFkZGVkID0gbGluZXNGb3IoMSwgdGV4dC5sZW5ndGggLSAxKTtcbiAgICAgICAgYWRkZWQucHVzaChuZXcgTGluZShsYXN0VGV4dCArIGZpcnN0TGluZS50ZXh0LnNsaWNlKHRvLmNoKSwgbGFzdFNwYW5zLCBlc3RpbWF0ZUhlaWdodCkpO1xuICAgICAgICB1cGRhdGUoZmlyc3RMaW5lLCBmaXJzdExpbmUudGV4dC5zbGljZSgwLCBmcm9tLmNoKSArIHRleHRbMF0sIHNwYW5zRm9yKDApKTtcbiAgICAgICAgZG9jLmluc2VydChmcm9tLmxpbmUgKyAxLCBhZGRlZCk7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmICh0ZXh0Lmxlbmd0aCA9PSAxKSB7XG4gICAgICB1cGRhdGUoZmlyc3RMaW5lLCBmaXJzdExpbmUudGV4dC5zbGljZSgwLCBmcm9tLmNoKSArIHRleHRbMF0gKyBsYXN0TGluZS50ZXh0LnNsaWNlKHRvLmNoKSwgc3BhbnNGb3IoMCkpO1xuICAgICAgZG9jLnJlbW92ZShmcm9tLmxpbmUgKyAxLCBubGluZXMpO1xuICAgIH0gZWxzZSB7XG4gICAgICB1cGRhdGUoZmlyc3RMaW5lLCBmaXJzdExpbmUudGV4dC5zbGljZSgwLCBmcm9tLmNoKSArIHRleHRbMF0sIHNwYW5zRm9yKDApKTtcbiAgICAgIHVwZGF0ZShsYXN0TGluZSwgbGFzdFRleHQgKyBsYXN0TGluZS50ZXh0LnNsaWNlKHRvLmNoKSwgbGFzdFNwYW5zKTtcbiAgICAgIHZhciBhZGRlZCA9IGxpbmVzRm9yKDEsIHRleHQubGVuZ3RoIC0gMSk7XG4gICAgICBpZiAobmxpbmVzID4gMSkgZG9jLnJlbW92ZShmcm9tLmxpbmUgKyAxLCBubGluZXMgLSAxKTtcbiAgICAgIGRvYy5pbnNlcnQoZnJvbS5saW5lICsgMSwgYWRkZWQpO1xuICAgIH1cblxuICAgIHNpZ25hbExhdGVyKGRvYywgXCJjaGFuZ2VcIiwgZG9jLCBjaGFuZ2UpO1xuICB9XG5cbiAgLy8gVGhlIGRvY3VtZW50IGlzIHJlcHJlc2VudGVkIGFzIGEgQlRyZWUgY29uc2lzdGluZyBvZiBsZWF2ZXMsIHdpdGhcbiAgLy8gY2h1bmsgb2YgbGluZXMgaW4gdGhlbSwgYW5kIGJyYW5jaGVzLCB3aXRoIHVwIHRvIHRlbiBsZWF2ZXMgb3JcbiAgLy8gb3RoZXIgYnJhbmNoIG5vZGVzIGJlbG93IHRoZW0uIFRoZSB0b3Agbm9kZSBpcyBhbHdheXMgYSBicmFuY2hcbiAgLy8gbm9kZSwgYW5kIGlzIHRoZSBkb2N1bWVudCBvYmplY3QgaXRzZWxmIChtZWFuaW5nIGl0IGhhc1xuICAvLyBhZGRpdGlvbmFsIG1ldGhvZHMgYW5kIHByb3BlcnRpZXMpLlxuICAvL1xuICAvLyBBbGwgbm9kZXMgaGF2ZSBwYXJlbnQgbGlua3MuIFRoZSB0cmVlIGlzIHVzZWQgYm90aCB0byBnbyBmcm9tXG4gIC8vIGxpbmUgbnVtYmVycyB0byBsaW5lIG9iamVjdHMsIGFuZCB0byBnbyBmcm9tIG9iamVjdHMgdG8gbnVtYmVycy5cbiAgLy8gSXQgYWxzbyBpbmRleGVzIGJ5IGhlaWdodCwgYW5kIGlzIHVzZWQgdG8gY29udmVydCBiZXR3ZWVuIGhlaWdodFxuICAvLyBhbmQgbGluZSBvYmplY3QsIGFuZCB0byBmaW5kIHRoZSB0b3RhbCBoZWlnaHQgb2YgdGhlIGRvY3VtZW50LlxuICAvL1xuICAvLyBTZWUgYWxzbyBodHRwOi8vbWFyaWpuaGF2ZXJiZWtlLm5sL2Jsb2cvY29kZW1pcnJvci1saW5lLXRyZWUuaHRtbFxuXG4gIGZ1bmN0aW9uIExlYWZDaHVuayhsaW5lcykge1xuICAgIHRoaXMubGluZXMgPSBsaW5lcztcbiAgICB0aGlzLnBhcmVudCA9IG51bGw7XG4gICAgZm9yICh2YXIgaSA9IDAsIGhlaWdodCA9IDA7IGkgPCBsaW5lcy5sZW5ndGg7ICsraSkge1xuICAgICAgbGluZXNbaV0ucGFyZW50ID0gdGhpcztcbiAgICAgIGhlaWdodCArPSBsaW5lc1tpXS5oZWlnaHQ7XG4gICAgfVxuICAgIHRoaXMuaGVpZ2h0ID0gaGVpZ2h0O1xuICB9XG5cbiAgTGVhZkNodW5rLnByb3RvdHlwZSA9IHtcbiAgICBjaHVua1NpemU6IGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpcy5saW5lcy5sZW5ndGg7IH0sXG4gICAgLy8gUmVtb3ZlIHRoZSBuIGxpbmVzIGF0IG9mZnNldCAnYXQnLlxuICAgIHJlbW92ZUlubmVyOiBmdW5jdGlvbihhdCwgbikge1xuICAgICAgZm9yICh2YXIgaSA9IGF0LCBlID0gYXQgKyBuOyBpIDwgZTsgKytpKSB7XG4gICAgICAgIHZhciBsaW5lID0gdGhpcy5saW5lc1tpXTtcbiAgICAgICAgdGhpcy5oZWlnaHQgLT0gbGluZS5oZWlnaHQ7XG4gICAgICAgIGNsZWFuVXBMaW5lKGxpbmUpO1xuICAgICAgICBzaWduYWxMYXRlcihsaW5lLCBcImRlbGV0ZVwiKTtcbiAgICAgIH1cbiAgICAgIHRoaXMubGluZXMuc3BsaWNlKGF0LCBuKTtcbiAgICB9LFxuICAgIC8vIEhlbHBlciB1c2VkIHRvIGNvbGxhcHNlIGEgc21hbGwgYnJhbmNoIGludG8gYSBzaW5nbGUgbGVhZi5cbiAgICBjb2xsYXBzZTogZnVuY3Rpb24obGluZXMpIHtcbiAgICAgIGxpbmVzLnB1c2guYXBwbHkobGluZXMsIHRoaXMubGluZXMpO1xuICAgIH0sXG4gICAgLy8gSW5zZXJ0IHRoZSBnaXZlbiBhcnJheSBvZiBsaW5lcyBhdCBvZmZzZXQgJ2F0JywgY291bnQgdGhlbSBhc1xuICAgIC8vIGhhdmluZyB0aGUgZ2l2ZW4gaGVpZ2h0LlxuICAgIGluc2VydElubmVyOiBmdW5jdGlvbihhdCwgbGluZXMsIGhlaWdodCkge1xuICAgICAgdGhpcy5oZWlnaHQgKz0gaGVpZ2h0O1xuICAgICAgdGhpcy5saW5lcyA9IHRoaXMubGluZXMuc2xpY2UoMCwgYXQpLmNvbmNhdChsaW5lcykuY29uY2F0KHRoaXMubGluZXMuc2xpY2UoYXQpKTtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGluZXMubGVuZ3RoOyArK2kpIGxpbmVzW2ldLnBhcmVudCA9IHRoaXM7XG4gICAgfSxcbiAgICAvLyBVc2VkIHRvIGl0ZXJhdGUgb3ZlciBhIHBhcnQgb2YgdGhlIHRyZWUuXG4gICAgaXRlck46IGZ1bmN0aW9uKGF0LCBuLCBvcCkge1xuICAgICAgZm9yICh2YXIgZSA9IGF0ICsgbjsgYXQgPCBlOyArK2F0KVxuICAgICAgICBpZiAob3AodGhpcy5saW5lc1thdF0pKSByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gIH07XG5cbiAgZnVuY3Rpb24gQnJhbmNoQ2h1bmsoY2hpbGRyZW4pIHtcbiAgICB0aGlzLmNoaWxkcmVuID0gY2hpbGRyZW47XG4gICAgdmFyIHNpemUgPSAwLCBoZWlnaHQgPSAwO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY2hpbGRyZW4ubGVuZ3RoOyArK2kpIHtcbiAgICAgIHZhciBjaCA9IGNoaWxkcmVuW2ldO1xuICAgICAgc2l6ZSArPSBjaC5jaHVua1NpemUoKTsgaGVpZ2h0ICs9IGNoLmhlaWdodDtcbiAgICAgIGNoLnBhcmVudCA9IHRoaXM7XG4gICAgfVxuICAgIHRoaXMuc2l6ZSA9IHNpemU7XG4gICAgdGhpcy5oZWlnaHQgPSBoZWlnaHQ7XG4gICAgdGhpcy5wYXJlbnQgPSBudWxsO1xuICB9XG5cbiAgQnJhbmNoQ2h1bmsucHJvdG90eXBlID0ge1xuICAgIGNodW5rU2l6ZTogZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzLnNpemU7IH0sXG4gICAgcmVtb3ZlSW5uZXI6IGZ1bmN0aW9uKGF0LCBuKSB7XG4gICAgICB0aGlzLnNpemUgLT0gbjtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5jaGlsZHJlbi5sZW5ndGg7ICsraSkge1xuICAgICAgICB2YXIgY2hpbGQgPSB0aGlzLmNoaWxkcmVuW2ldLCBzeiA9IGNoaWxkLmNodW5rU2l6ZSgpO1xuICAgICAgICBpZiAoYXQgPCBzeikge1xuICAgICAgICAgIHZhciBybSA9IE1hdGgubWluKG4sIHN6IC0gYXQpLCBvbGRIZWlnaHQgPSBjaGlsZC5oZWlnaHQ7XG4gICAgICAgICAgY2hpbGQucmVtb3ZlSW5uZXIoYXQsIHJtKTtcbiAgICAgICAgICB0aGlzLmhlaWdodCAtPSBvbGRIZWlnaHQgLSBjaGlsZC5oZWlnaHQ7XG4gICAgICAgICAgaWYgKHN6ID09IHJtKSB7IHRoaXMuY2hpbGRyZW4uc3BsaWNlKGktLSwgMSk7IGNoaWxkLnBhcmVudCA9IG51bGw7IH1cbiAgICAgICAgICBpZiAoKG4gLT0gcm0pID09IDApIGJyZWFrO1xuICAgICAgICAgIGF0ID0gMDtcbiAgICAgICAgfSBlbHNlIGF0IC09IHN6O1xuICAgICAgfVxuICAgICAgLy8gSWYgdGhlIHJlc3VsdCBpcyBzbWFsbGVyIHRoYW4gMjUgbGluZXMsIGVuc3VyZSB0aGF0IGl0IGlzIGFcbiAgICAgIC8vIHNpbmdsZSBsZWFmIG5vZGUuXG4gICAgICBpZiAodGhpcy5zaXplIC0gbiA8IDI1ICYmXG4gICAgICAgICAgKHRoaXMuY2hpbGRyZW4ubGVuZ3RoID4gMSB8fCAhKHRoaXMuY2hpbGRyZW5bMF0gaW5zdGFuY2VvZiBMZWFmQ2h1bmspKSkge1xuICAgICAgICB2YXIgbGluZXMgPSBbXTtcbiAgICAgICAgdGhpcy5jb2xsYXBzZShsaW5lcyk7XG4gICAgICAgIHRoaXMuY2hpbGRyZW4gPSBbbmV3IExlYWZDaHVuayhsaW5lcyldO1xuICAgICAgICB0aGlzLmNoaWxkcmVuWzBdLnBhcmVudCA9IHRoaXM7XG4gICAgICB9XG4gICAgfSxcbiAgICBjb2xsYXBzZTogZnVuY3Rpb24obGluZXMpIHtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5jaGlsZHJlbi5sZW5ndGg7ICsraSkgdGhpcy5jaGlsZHJlbltpXS5jb2xsYXBzZShsaW5lcyk7XG4gICAgfSxcbiAgICBpbnNlcnRJbm5lcjogZnVuY3Rpb24oYXQsIGxpbmVzLCBoZWlnaHQpIHtcbiAgICAgIHRoaXMuc2l6ZSArPSBsaW5lcy5sZW5ndGg7XG4gICAgICB0aGlzLmhlaWdodCArPSBoZWlnaHQ7XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuY2hpbGRyZW4ubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgdmFyIGNoaWxkID0gdGhpcy5jaGlsZHJlbltpXSwgc3ogPSBjaGlsZC5jaHVua1NpemUoKTtcbiAgICAgICAgaWYgKGF0IDw9IHN6KSB7XG4gICAgICAgICAgY2hpbGQuaW5zZXJ0SW5uZXIoYXQsIGxpbmVzLCBoZWlnaHQpO1xuICAgICAgICAgIGlmIChjaGlsZC5saW5lcyAmJiBjaGlsZC5saW5lcy5sZW5ndGggPiA1MCkge1xuICAgICAgICAgICAgd2hpbGUgKGNoaWxkLmxpbmVzLmxlbmd0aCA+IDUwKSB7XG4gICAgICAgICAgICAgIHZhciBzcGlsbGVkID0gY2hpbGQubGluZXMuc3BsaWNlKGNoaWxkLmxpbmVzLmxlbmd0aCAtIDI1LCAyNSk7XG4gICAgICAgICAgICAgIHZhciBuZXdsZWFmID0gbmV3IExlYWZDaHVuayhzcGlsbGVkKTtcbiAgICAgICAgICAgICAgY2hpbGQuaGVpZ2h0IC09IG5ld2xlYWYuaGVpZ2h0O1xuICAgICAgICAgICAgICB0aGlzLmNoaWxkcmVuLnNwbGljZShpICsgMSwgMCwgbmV3bGVhZik7XG4gICAgICAgICAgICAgIG5ld2xlYWYucGFyZW50ID0gdGhpcztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMubWF5YmVTcGlsbCgpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBhdCAtPSBzejtcbiAgICAgIH1cbiAgICB9LFxuICAgIC8vIFdoZW4gYSBub2RlIGhhcyBncm93biwgY2hlY2sgd2hldGhlciBpdCBzaG91bGQgYmUgc3BsaXQuXG4gICAgbWF5YmVTcGlsbDogZnVuY3Rpb24oKSB7XG4gICAgICBpZiAodGhpcy5jaGlsZHJlbi5sZW5ndGggPD0gMTApIHJldHVybjtcbiAgICAgIHZhciBtZSA9IHRoaXM7XG4gICAgICBkbyB7XG4gICAgICAgIHZhciBzcGlsbGVkID0gbWUuY2hpbGRyZW4uc3BsaWNlKG1lLmNoaWxkcmVuLmxlbmd0aCAtIDUsIDUpO1xuICAgICAgICB2YXIgc2libGluZyA9IG5ldyBCcmFuY2hDaHVuayhzcGlsbGVkKTtcbiAgICAgICAgaWYgKCFtZS5wYXJlbnQpIHsgLy8gQmVjb21lIHRoZSBwYXJlbnQgbm9kZVxuICAgICAgICAgIHZhciBjb3B5ID0gbmV3IEJyYW5jaENodW5rKG1lLmNoaWxkcmVuKTtcbiAgICAgICAgICBjb3B5LnBhcmVudCA9IG1lO1xuICAgICAgICAgIG1lLmNoaWxkcmVuID0gW2NvcHksIHNpYmxpbmddO1xuICAgICAgICAgIG1lID0gY29weTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBtZS5zaXplIC09IHNpYmxpbmcuc2l6ZTtcbiAgICAgICAgICBtZS5oZWlnaHQgLT0gc2libGluZy5oZWlnaHQ7XG4gICAgICAgICAgdmFyIG15SW5kZXggPSBpbmRleE9mKG1lLnBhcmVudC5jaGlsZHJlbiwgbWUpO1xuICAgICAgICAgIG1lLnBhcmVudC5jaGlsZHJlbi5zcGxpY2UobXlJbmRleCArIDEsIDAsIHNpYmxpbmcpO1xuICAgICAgICB9XG4gICAgICAgIHNpYmxpbmcucGFyZW50ID0gbWUucGFyZW50O1xuICAgICAgfSB3aGlsZSAobWUuY2hpbGRyZW4ubGVuZ3RoID4gMTApO1xuICAgICAgbWUucGFyZW50Lm1heWJlU3BpbGwoKTtcbiAgICB9LFxuICAgIGl0ZXJOOiBmdW5jdGlvbihhdCwgbiwgb3ApIHtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5jaGlsZHJlbi5sZW5ndGg7ICsraSkge1xuICAgICAgICB2YXIgY2hpbGQgPSB0aGlzLmNoaWxkcmVuW2ldLCBzeiA9IGNoaWxkLmNodW5rU2l6ZSgpO1xuICAgICAgICBpZiAoYXQgPCBzeikge1xuICAgICAgICAgIHZhciB1c2VkID0gTWF0aC5taW4obiwgc3ogLSBhdCk7XG4gICAgICAgICAgaWYgKGNoaWxkLml0ZXJOKGF0LCB1c2VkLCBvcCkpIHJldHVybiB0cnVlO1xuICAgICAgICAgIGlmICgobiAtPSB1c2VkKSA9PSAwKSBicmVhaztcbiAgICAgICAgICBhdCA9IDA7XG4gICAgICAgIH0gZWxzZSBhdCAtPSBzejtcbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgdmFyIG5leHREb2NJZCA9IDA7XG4gIHZhciBEb2MgPSBDb2RlTWlycm9yLkRvYyA9IGZ1bmN0aW9uKHRleHQsIG1vZGUsIGZpcnN0TGluZSwgbGluZVNlcCkge1xuICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBEb2MpKSByZXR1cm4gbmV3IERvYyh0ZXh0LCBtb2RlLCBmaXJzdExpbmUsIGxpbmVTZXApO1xuICAgIGlmIChmaXJzdExpbmUgPT0gbnVsbCkgZmlyc3RMaW5lID0gMDtcblxuICAgIEJyYW5jaENodW5rLmNhbGwodGhpcywgW25ldyBMZWFmQ2h1bmsoW25ldyBMaW5lKFwiXCIsIG51bGwpXSldKTtcbiAgICB0aGlzLmZpcnN0ID0gZmlyc3RMaW5lO1xuICAgIHRoaXMuc2Nyb2xsVG9wID0gdGhpcy5zY3JvbGxMZWZ0ID0gMDtcbiAgICB0aGlzLmNhbnRFZGl0ID0gZmFsc2U7XG4gICAgdGhpcy5jbGVhbkdlbmVyYXRpb24gPSAxO1xuICAgIHRoaXMuZnJvbnRpZXIgPSBmaXJzdExpbmU7XG4gICAgdmFyIHN0YXJ0ID0gUG9zKGZpcnN0TGluZSwgMCk7XG4gICAgdGhpcy5zZWwgPSBzaW1wbGVTZWxlY3Rpb24oc3RhcnQpO1xuICAgIHRoaXMuaGlzdG9yeSA9IG5ldyBIaXN0b3J5KG51bGwpO1xuICAgIHRoaXMuaWQgPSArK25leHREb2NJZDtcbiAgICB0aGlzLm1vZGVPcHRpb24gPSBtb2RlO1xuICAgIHRoaXMubGluZVNlcCA9IGxpbmVTZXA7XG4gICAgdGhpcy5leHRlbmQgPSBmYWxzZTtcblxuICAgIGlmICh0eXBlb2YgdGV4dCA9PSBcInN0cmluZ1wiKSB0ZXh0ID0gdGhpcy5zcGxpdExpbmVzKHRleHQpO1xuICAgIHVwZGF0ZURvYyh0aGlzLCB7ZnJvbTogc3RhcnQsIHRvOiBzdGFydCwgdGV4dDogdGV4dH0pO1xuICAgIHNldFNlbGVjdGlvbih0aGlzLCBzaW1wbGVTZWxlY3Rpb24oc3RhcnQpLCBzZWxfZG9udFNjcm9sbCk7XG4gIH07XG5cbiAgRG9jLnByb3RvdHlwZSA9IGNyZWF0ZU9iaihCcmFuY2hDaHVuay5wcm90b3R5cGUsIHtcbiAgICBjb25zdHJ1Y3RvcjogRG9jLFxuICAgIC8vIEl0ZXJhdGUgb3ZlciB0aGUgZG9jdW1lbnQuIFN1cHBvcnRzIHR3byBmb3JtcyAtLSB3aXRoIG9ubHkgb25lXG4gICAgLy8gYXJndW1lbnQsIGl0IGNhbGxzIHRoYXQgZm9yIGVhY2ggbGluZSBpbiB0aGUgZG9jdW1lbnQuIFdpdGhcbiAgICAvLyB0aHJlZSwgaXQgaXRlcmF0ZXMgb3ZlciB0aGUgcmFuZ2UgZ2l2ZW4gYnkgdGhlIGZpcnN0IHR3byAod2l0aFxuICAgIC8vIHRoZSBzZWNvbmQgYmVpbmcgbm9uLWluY2x1c2l2ZSkuXG4gICAgaXRlcjogZnVuY3Rpb24oZnJvbSwgdG8sIG9wKSB7XG4gICAgICBpZiAob3ApIHRoaXMuaXRlck4oZnJvbSAtIHRoaXMuZmlyc3QsIHRvIC0gZnJvbSwgb3ApO1xuICAgICAgZWxzZSB0aGlzLml0ZXJOKHRoaXMuZmlyc3QsIHRoaXMuZmlyc3QgKyB0aGlzLnNpemUsIGZyb20pO1xuICAgIH0sXG5cbiAgICAvLyBOb24tcHVibGljIGludGVyZmFjZSBmb3IgYWRkaW5nIGFuZCByZW1vdmluZyBsaW5lcy5cbiAgICBpbnNlcnQ6IGZ1bmN0aW9uKGF0LCBsaW5lcykge1xuICAgICAgdmFyIGhlaWdodCA9IDA7XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpbmVzLmxlbmd0aDsgKytpKSBoZWlnaHQgKz0gbGluZXNbaV0uaGVpZ2h0O1xuICAgICAgdGhpcy5pbnNlcnRJbm5lcihhdCAtIHRoaXMuZmlyc3QsIGxpbmVzLCBoZWlnaHQpO1xuICAgIH0sXG4gICAgcmVtb3ZlOiBmdW5jdGlvbihhdCwgbikgeyB0aGlzLnJlbW92ZUlubmVyKGF0IC0gdGhpcy5maXJzdCwgbik7IH0sXG5cbiAgICAvLyBGcm9tIGhlcmUsIHRoZSBtZXRob2RzIGFyZSBwYXJ0IG9mIHRoZSBwdWJsaWMgaW50ZXJmYWNlLiBNb3N0XG4gICAgLy8gYXJlIGFsc28gYXZhaWxhYmxlIGZyb20gQ29kZU1pcnJvciAoZWRpdG9yKSBpbnN0YW5jZXMuXG5cbiAgICBnZXRWYWx1ZTogZnVuY3Rpb24obGluZVNlcCkge1xuICAgICAgdmFyIGxpbmVzID0gZ2V0TGluZXModGhpcywgdGhpcy5maXJzdCwgdGhpcy5maXJzdCArIHRoaXMuc2l6ZSk7XG4gICAgICBpZiAobGluZVNlcCA9PT0gZmFsc2UpIHJldHVybiBsaW5lcztcbiAgICAgIHJldHVybiBsaW5lcy5qb2luKGxpbmVTZXAgfHwgdGhpcy5saW5lU2VwYXJhdG9yKCkpO1xuICAgIH0sXG4gICAgc2V0VmFsdWU6IGRvY01ldGhvZE9wKGZ1bmN0aW9uKGNvZGUpIHtcbiAgICAgIHZhciB0b3AgPSBQb3ModGhpcy5maXJzdCwgMCksIGxhc3QgPSB0aGlzLmZpcnN0ICsgdGhpcy5zaXplIC0gMTtcbiAgICAgIG1ha2VDaGFuZ2UodGhpcywge2Zyb206IHRvcCwgdG86IFBvcyhsYXN0LCBnZXRMaW5lKHRoaXMsIGxhc3QpLnRleHQubGVuZ3RoKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IHRoaXMuc3BsaXRMaW5lcyhjb2RlKSwgb3JpZ2luOiBcInNldFZhbHVlXCIsIGZ1bGw6IHRydWV9LCB0cnVlKTtcbiAgICAgIHNldFNlbGVjdGlvbih0aGlzLCBzaW1wbGVTZWxlY3Rpb24odG9wKSk7XG4gICAgfSksXG4gICAgcmVwbGFjZVJhbmdlOiBmdW5jdGlvbihjb2RlLCBmcm9tLCB0bywgb3JpZ2luKSB7XG4gICAgICBmcm9tID0gY2xpcFBvcyh0aGlzLCBmcm9tKTtcbiAgICAgIHRvID0gdG8gPyBjbGlwUG9zKHRoaXMsIHRvKSA6IGZyb207XG4gICAgICByZXBsYWNlUmFuZ2UodGhpcywgY29kZSwgZnJvbSwgdG8sIG9yaWdpbik7XG4gICAgfSxcbiAgICBnZXRSYW5nZTogZnVuY3Rpb24oZnJvbSwgdG8sIGxpbmVTZXApIHtcbiAgICAgIHZhciBsaW5lcyA9IGdldEJldHdlZW4odGhpcywgY2xpcFBvcyh0aGlzLCBmcm9tKSwgY2xpcFBvcyh0aGlzLCB0bykpO1xuICAgICAgaWYgKGxpbmVTZXAgPT09IGZhbHNlKSByZXR1cm4gbGluZXM7XG4gICAgICByZXR1cm4gbGluZXMuam9pbihsaW5lU2VwIHx8IHRoaXMubGluZVNlcGFyYXRvcigpKTtcbiAgICB9LFxuXG4gICAgZ2V0TGluZTogZnVuY3Rpb24obGluZSkge3ZhciBsID0gdGhpcy5nZXRMaW5lSGFuZGxlKGxpbmUpOyByZXR1cm4gbCAmJiBsLnRleHQ7fSxcblxuICAgIGdldExpbmVIYW5kbGU6IGZ1bmN0aW9uKGxpbmUpIHtpZiAoaXNMaW5lKHRoaXMsIGxpbmUpKSByZXR1cm4gZ2V0TGluZSh0aGlzLCBsaW5lKTt9LFxuICAgIGdldExpbmVOdW1iZXI6IGZ1bmN0aW9uKGxpbmUpIHtyZXR1cm4gbGluZU5vKGxpbmUpO30sXG5cbiAgICBnZXRMaW5lSGFuZGxlVmlzdWFsU3RhcnQ6IGZ1bmN0aW9uKGxpbmUpIHtcbiAgICAgIGlmICh0eXBlb2YgbGluZSA9PSBcIm51bWJlclwiKSBsaW5lID0gZ2V0TGluZSh0aGlzLCBsaW5lKTtcbiAgICAgIHJldHVybiB2aXN1YWxMaW5lKGxpbmUpO1xuICAgIH0sXG5cbiAgICBsaW5lQ291bnQ6IGZ1bmN0aW9uKCkge3JldHVybiB0aGlzLnNpemU7fSxcbiAgICBmaXJzdExpbmU6IGZ1bmN0aW9uKCkge3JldHVybiB0aGlzLmZpcnN0O30sXG4gICAgbGFzdExpbmU6IGZ1bmN0aW9uKCkge3JldHVybiB0aGlzLmZpcnN0ICsgdGhpcy5zaXplIC0gMTt9LFxuXG4gICAgY2xpcFBvczogZnVuY3Rpb24ocG9zKSB7cmV0dXJuIGNsaXBQb3ModGhpcywgcG9zKTt9LFxuXG4gICAgZ2V0Q3Vyc29yOiBmdW5jdGlvbihzdGFydCkge1xuICAgICAgdmFyIHJhbmdlID0gdGhpcy5zZWwucHJpbWFyeSgpLCBwb3M7XG4gICAgICBpZiAoc3RhcnQgPT0gbnVsbCB8fCBzdGFydCA9PSBcImhlYWRcIikgcG9zID0gcmFuZ2UuaGVhZDtcbiAgICAgIGVsc2UgaWYgKHN0YXJ0ID09IFwiYW5jaG9yXCIpIHBvcyA9IHJhbmdlLmFuY2hvcjtcbiAgICAgIGVsc2UgaWYgKHN0YXJ0ID09IFwiZW5kXCIgfHwgc3RhcnQgPT0gXCJ0b1wiIHx8IHN0YXJ0ID09PSBmYWxzZSkgcG9zID0gcmFuZ2UudG8oKTtcbiAgICAgIGVsc2UgcG9zID0gcmFuZ2UuZnJvbSgpO1xuICAgICAgcmV0dXJuIHBvcztcbiAgICB9LFxuICAgIGxpc3RTZWxlY3Rpb25zOiBmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXMuc2VsLnJhbmdlczsgfSxcbiAgICBzb21ldGhpbmdTZWxlY3RlZDogZnVuY3Rpb24oKSB7cmV0dXJuIHRoaXMuc2VsLnNvbWV0aGluZ1NlbGVjdGVkKCk7fSxcblxuICAgIHNldEN1cnNvcjogZG9jTWV0aG9kT3AoZnVuY3Rpb24obGluZSwgY2gsIG9wdGlvbnMpIHtcbiAgICAgIHNldFNpbXBsZVNlbGVjdGlvbih0aGlzLCBjbGlwUG9zKHRoaXMsIHR5cGVvZiBsaW5lID09IFwibnVtYmVyXCIgPyBQb3MobGluZSwgY2ggfHwgMCkgOiBsaW5lKSwgbnVsbCwgb3B0aW9ucyk7XG4gICAgfSksXG4gICAgc2V0U2VsZWN0aW9uOiBkb2NNZXRob2RPcChmdW5jdGlvbihhbmNob3IsIGhlYWQsIG9wdGlvbnMpIHtcbiAgICAgIHNldFNpbXBsZVNlbGVjdGlvbih0aGlzLCBjbGlwUG9zKHRoaXMsIGFuY2hvciksIGNsaXBQb3ModGhpcywgaGVhZCB8fCBhbmNob3IpLCBvcHRpb25zKTtcbiAgICB9KSxcbiAgICBleHRlbmRTZWxlY3Rpb246IGRvY01ldGhvZE9wKGZ1bmN0aW9uKGhlYWQsIG90aGVyLCBvcHRpb25zKSB7XG4gICAgICBleHRlbmRTZWxlY3Rpb24odGhpcywgY2xpcFBvcyh0aGlzLCBoZWFkKSwgb3RoZXIgJiYgY2xpcFBvcyh0aGlzLCBvdGhlciksIG9wdGlvbnMpO1xuICAgIH0pLFxuICAgIGV4dGVuZFNlbGVjdGlvbnM6IGRvY01ldGhvZE9wKGZ1bmN0aW9uKGhlYWRzLCBvcHRpb25zKSB7XG4gICAgICBleHRlbmRTZWxlY3Rpb25zKHRoaXMsIGNsaXBQb3NBcnJheSh0aGlzLCBoZWFkcyksIG9wdGlvbnMpO1xuICAgIH0pLFxuICAgIGV4dGVuZFNlbGVjdGlvbnNCeTogZG9jTWV0aG9kT3AoZnVuY3Rpb24oZiwgb3B0aW9ucykge1xuICAgICAgdmFyIGhlYWRzID0gbWFwKHRoaXMuc2VsLnJhbmdlcywgZik7XG4gICAgICBleHRlbmRTZWxlY3Rpb25zKHRoaXMsIGNsaXBQb3NBcnJheSh0aGlzLCBoZWFkcyksIG9wdGlvbnMpO1xuICAgIH0pLFxuICAgIHNldFNlbGVjdGlvbnM6IGRvY01ldGhvZE9wKGZ1bmN0aW9uKHJhbmdlcywgcHJpbWFyeSwgb3B0aW9ucykge1xuICAgICAgaWYgKCFyYW5nZXMubGVuZ3RoKSByZXR1cm47XG4gICAgICBmb3IgKHZhciBpID0gMCwgb3V0ID0gW107IGkgPCByYW5nZXMubGVuZ3RoOyBpKyspXG4gICAgICAgIG91dFtpXSA9IG5ldyBSYW5nZShjbGlwUG9zKHRoaXMsIHJhbmdlc1tpXS5hbmNob3IpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xpcFBvcyh0aGlzLCByYW5nZXNbaV0uaGVhZCkpO1xuICAgICAgaWYgKHByaW1hcnkgPT0gbnVsbCkgcHJpbWFyeSA9IE1hdGgubWluKHJhbmdlcy5sZW5ndGggLSAxLCB0aGlzLnNlbC5wcmltSW5kZXgpO1xuICAgICAgc2V0U2VsZWN0aW9uKHRoaXMsIG5vcm1hbGl6ZVNlbGVjdGlvbihvdXQsIHByaW1hcnkpLCBvcHRpb25zKTtcbiAgICB9KSxcbiAgICBhZGRTZWxlY3Rpb246IGRvY01ldGhvZE9wKGZ1bmN0aW9uKGFuY2hvciwgaGVhZCwgb3B0aW9ucykge1xuICAgICAgdmFyIHJhbmdlcyA9IHRoaXMuc2VsLnJhbmdlcy5zbGljZSgwKTtcbiAgICAgIHJhbmdlcy5wdXNoKG5ldyBSYW5nZShjbGlwUG9zKHRoaXMsIGFuY2hvciksIGNsaXBQb3ModGhpcywgaGVhZCB8fCBhbmNob3IpKSk7XG4gICAgICBzZXRTZWxlY3Rpb24odGhpcywgbm9ybWFsaXplU2VsZWN0aW9uKHJhbmdlcywgcmFuZ2VzLmxlbmd0aCAtIDEpLCBvcHRpb25zKTtcbiAgICB9KSxcblxuICAgIGdldFNlbGVjdGlvbjogZnVuY3Rpb24obGluZVNlcCkge1xuICAgICAgdmFyIHJhbmdlcyA9IHRoaXMuc2VsLnJhbmdlcywgbGluZXM7XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJhbmdlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICB2YXIgc2VsID0gZ2V0QmV0d2Vlbih0aGlzLCByYW5nZXNbaV0uZnJvbSgpLCByYW5nZXNbaV0udG8oKSk7XG4gICAgICAgIGxpbmVzID0gbGluZXMgPyBsaW5lcy5jb25jYXQoc2VsKSA6IHNlbDtcbiAgICAgIH1cbiAgICAgIGlmIChsaW5lU2VwID09PSBmYWxzZSkgcmV0dXJuIGxpbmVzO1xuICAgICAgZWxzZSByZXR1cm4gbGluZXMuam9pbihsaW5lU2VwIHx8IHRoaXMubGluZVNlcGFyYXRvcigpKTtcbiAgICB9LFxuICAgIGdldFNlbGVjdGlvbnM6IGZ1bmN0aW9uKGxpbmVTZXApIHtcbiAgICAgIHZhciBwYXJ0cyA9IFtdLCByYW5nZXMgPSB0aGlzLnNlbC5yYW5nZXM7XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJhbmdlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICB2YXIgc2VsID0gZ2V0QmV0d2Vlbih0aGlzLCByYW5nZXNbaV0uZnJvbSgpLCByYW5nZXNbaV0udG8oKSk7XG4gICAgICAgIGlmIChsaW5lU2VwICE9PSBmYWxzZSkgc2VsID0gc2VsLmpvaW4obGluZVNlcCB8fCB0aGlzLmxpbmVTZXBhcmF0b3IoKSk7XG4gICAgICAgIHBhcnRzW2ldID0gc2VsO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHBhcnRzO1xuICAgIH0sXG4gICAgcmVwbGFjZVNlbGVjdGlvbjogZnVuY3Rpb24oY29kZSwgY29sbGFwc2UsIG9yaWdpbikge1xuICAgICAgdmFyIGR1cCA9IFtdO1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnNlbC5yYW5nZXMubGVuZ3RoOyBpKyspXG4gICAgICAgIGR1cFtpXSA9IGNvZGU7XG4gICAgICB0aGlzLnJlcGxhY2VTZWxlY3Rpb25zKGR1cCwgY29sbGFwc2UsIG9yaWdpbiB8fCBcIitpbnB1dFwiKTtcbiAgICB9LFxuICAgIHJlcGxhY2VTZWxlY3Rpb25zOiBkb2NNZXRob2RPcChmdW5jdGlvbihjb2RlLCBjb2xsYXBzZSwgb3JpZ2luKSB7XG4gICAgICB2YXIgY2hhbmdlcyA9IFtdLCBzZWwgPSB0aGlzLnNlbDtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2VsLnJhbmdlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICB2YXIgcmFuZ2UgPSBzZWwucmFuZ2VzW2ldO1xuICAgICAgICBjaGFuZ2VzW2ldID0ge2Zyb206IHJhbmdlLmZyb20oKSwgdG86IHJhbmdlLnRvKCksIHRleHQ6IHRoaXMuc3BsaXRMaW5lcyhjb2RlW2ldKSwgb3JpZ2luOiBvcmlnaW59O1xuICAgICAgfVxuICAgICAgdmFyIG5ld1NlbCA9IGNvbGxhcHNlICYmIGNvbGxhcHNlICE9IFwiZW5kXCIgJiYgY29tcHV0ZVJlcGxhY2VkU2VsKHRoaXMsIGNoYW5nZXMsIGNvbGxhcHNlKTtcbiAgICAgIGZvciAodmFyIGkgPSBjaGFuZ2VzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKVxuICAgICAgICBtYWtlQ2hhbmdlKHRoaXMsIGNoYW5nZXNbaV0pO1xuICAgICAgaWYgKG5ld1NlbCkgc2V0U2VsZWN0aW9uUmVwbGFjZUhpc3RvcnkodGhpcywgbmV3U2VsKTtcbiAgICAgIGVsc2UgaWYgKHRoaXMuY20pIGVuc3VyZUN1cnNvclZpc2libGUodGhpcy5jbSk7XG4gICAgfSksXG4gICAgdW5kbzogZG9jTWV0aG9kT3AoZnVuY3Rpb24oKSB7bWFrZUNoYW5nZUZyb21IaXN0b3J5KHRoaXMsIFwidW5kb1wiKTt9KSxcbiAgICByZWRvOiBkb2NNZXRob2RPcChmdW5jdGlvbigpIHttYWtlQ2hhbmdlRnJvbUhpc3RvcnkodGhpcywgXCJyZWRvXCIpO30pLFxuICAgIHVuZG9TZWxlY3Rpb246IGRvY01ldGhvZE9wKGZ1bmN0aW9uKCkge21ha2VDaGFuZ2VGcm9tSGlzdG9yeSh0aGlzLCBcInVuZG9cIiwgdHJ1ZSk7fSksXG4gICAgcmVkb1NlbGVjdGlvbjogZG9jTWV0aG9kT3AoZnVuY3Rpb24oKSB7bWFrZUNoYW5nZUZyb21IaXN0b3J5KHRoaXMsIFwicmVkb1wiLCB0cnVlKTt9KSxcblxuICAgIHNldEV4dGVuZGluZzogZnVuY3Rpb24odmFsKSB7dGhpcy5leHRlbmQgPSB2YWw7fSxcbiAgICBnZXRFeHRlbmRpbmc6IGZ1bmN0aW9uKCkge3JldHVybiB0aGlzLmV4dGVuZDt9LFxuXG4gICAgaGlzdG9yeVNpemU6IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGhpc3QgPSB0aGlzLmhpc3RvcnksIGRvbmUgPSAwLCB1bmRvbmUgPSAwO1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBoaXN0LmRvbmUubGVuZ3RoOyBpKyspIGlmICghaGlzdC5kb25lW2ldLnJhbmdlcykgKytkb25lO1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBoaXN0LnVuZG9uZS5sZW5ndGg7IGkrKykgaWYgKCFoaXN0LnVuZG9uZVtpXS5yYW5nZXMpICsrdW5kb25lO1xuICAgICAgcmV0dXJuIHt1bmRvOiBkb25lLCByZWRvOiB1bmRvbmV9O1xuICAgIH0sXG4gICAgY2xlYXJIaXN0b3J5OiBmdW5jdGlvbigpIHt0aGlzLmhpc3RvcnkgPSBuZXcgSGlzdG9yeSh0aGlzLmhpc3RvcnkubWF4R2VuZXJhdGlvbik7fSxcblxuICAgIG1hcmtDbGVhbjogZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLmNsZWFuR2VuZXJhdGlvbiA9IHRoaXMuY2hhbmdlR2VuZXJhdGlvbih0cnVlKTtcbiAgICB9LFxuICAgIGNoYW5nZUdlbmVyYXRpb246IGZ1bmN0aW9uKGZvcmNlU3BsaXQpIHtcbiAgICAgIGlmIChmb3JjZVNwbGl0KVxuICAgICAgICB0aGlzLmhpc3RvcnkubGFzdE9wID0gdGhpcy5oaXN0b3J5Lmxhc3RTZWxPcCA9IHRoaXMuaGlzdG9yeS5sYXN0T3JpZ2luID0gbnVsbDtcbiAgICAgIHJldHVybiB0aGlzLmhpc3RvcnkuZ2VuZXJhdGlvbjtcbiAgICB9LFxuICAgIGlzQ2xlYW46IGZ1bmN0aW9uIChnZW4pIHtcbiAgICAgIHJldHVybiB0aGlzLmhpc3RvcnkuZ2VuZXJhdGlvbiA9PSAoZ2VuIHx8IHRoaXMuY2xlYW5HZW5lcmF0aW9uKTtcbiAgICB9LFxuXG4gICAgZ2V0SGlzdG9yeTogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4ge2RvbmU6IGNvcHlIaXN0b3J5QXJyYXkodGhpcy5oaXN0b3J5LmRvbmUpLFxuICAgICAgICAgICAgICB1bmRvbmU6IGNvcHlIaXN0b3J5QXJyYXkodGhpcy5oaXN0b3J5LnVuZG9uZSl9O1xuICAgIH0sXG4gICAgc2V0SGlzdG9yeTogZnVuY3Rpb24oaGlzdERhdGEpIHtcbiAgICAgIHZhciBoaXN0ID0gdGhpcy5oaXN0b3J5ID0gbmV3IEhpc3RvcnkodGhpcy5oaXN0b3J5Lm1heEdlbmVyYXRpb24pO1xuICAgICAgaGlzdC5kb25lID0gY29weUhpc3RvcnlBcnJheShoaXN0RGF0YS5kb25lLnNsaWNlKDApLCBudWxsLCB0cnVlKTtcbiAgICAgIGhpc3QudW5kb25lID0gY29weUhpc3RvcnlBcnJheShoaXN0RGF0YS51bmRvbmUuc2xpY2UoMCksIG51bGwsIHRydWUpO1xuICAgIH0sXG5cbiAgICBhZGRMaW5lQ2xhc3M6IGRvY01ldGhvZE9wKGZ1bmN0aW9uKGhhbmRsZSwgd2hlcmUsIGNscykge1xuICAgICAgcmV0dXJuIGNoYW5nZUxpbmUodGhpcywgaGFuZGxlLCB3aGVyZSA9PSBcImd1dHRlclwiID8gXCJndXR0ZXJcIiA6IFwiY2xhc3NcIiwgZnVuY3Rpb24obGluZSkge1xuICAgICAgICB2YXIgcHJvcCA9IHdoZXJlID09IFwidGV4dFwiID8gXCJ0ZXh0Q2xhc3NcIlxuICAgICAgICAgICAgICAgICA6IHdoZXJlID09IFwiYmFja2dyb3VuZFwiID8gXCJiZ0NsYXNzXCJcbiAgICAgICAgICAgICAgICAgOiB3aGVyZSA9PSBcImd1dHRlclwiID8gXCJndXR0ZXJDbGFzc1wiIDogXCJ3cmFwQ2xhc3NcIjtcbiAgICAgICAgaWYgKCFsaW5lW3Byb3BdKSBsaW5lW3Byb3BdID0gY2xzO1xuICAgICAgICBlbHNlIGlmIChjbGFzc1Rlc3QoY2xzKS50ZXN0KGxpbmVbcHJvcF0pKSByZXR1cm4gZmFsc2U7XG4gICAgICAgIGVsc2UgbGluZVtwcm9wXSArPSBcIiBcIiArIGNscztcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9KTtcbiAgICB9KSxcbiAgICByZW1vdmVMaW5lQ2xhc3M6IGRvY01ldGhvZE9wKGZ1bmN0aW9uKGhhbmRsZSwgd2hlcmUsIGNscykge1xuICAgICAgcmV0dXJuIGNoYW5nZUxpbmUodGhpcywgaGFuZGxlLCB3aGVyZSA9PSBcImd1dHRlclwiID8gXCJndXR0ZXJcIiA6IFwiY2xhc3NcIiwgZnVuY3Rpb24obGluZSkge1xuICAgICAgICB2YXIgcHJvcCA9IHdoZXJlID09IFwidGV4dFwiID8gXCJ0ZXh0Q2xhc3NcIlxuICAgICAgICAgICAgICAgICA6IHdoZXJlID09IFwiYmFja2dyb3VuZFwiID8gXCJiZ0NsYXNzXCJcbiAgICAgICAgICAgICAgICAgOiB3aGVyZSA9PSBcImd1dHRlclwiID8gXCJndXR0ZXJDbGFzc1wiIDogXCJ3cmFwQ2xhc3NcIjtcbiAgICAgICAgdmFyIGN1ciA9IGxpbmVbcHJvcF07XG4gICAgICAgIGlmICghY3VyKSByZXR1cm4gZmFsc2U7XG4gICAgICAgIGVsc2UgaWYgKGNscyA9PSBudWxsKSBsaW5lW3Byb3BdID0gbnVsbDtcbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgdmFyIGZvdW5kID0gY3VyLm1hdGNoKGNsYXNzVGVzdChjbHMpKTtcbiAgICAgICAgICBpZiAoIWZvdW5kKSByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgdmFyIGVuZCA9IGZvdW5kLmluZGV4ICsgZm91bmRbMF0ubGVuZ3RoO1xuICAgICAgICAgIGxpbmVbcHJvcF0gPSBjdXIuc2xpY2UoMCwgZm91bmQuaW5kZXgpICsgKCFmb3VuZC5pbmRleCB8fCBlbmQgPT0gY3VyLmxlbmd0aCA/IFwiXCIgOiBcIiBcIikgKyBjdXIuc2xpY2UoZW5kKSB8fCBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfSk7XG4gICAgfSksXG5cbiAgICBhZGRMaW5lV2lkZ2V0OiBkb2NNZXRob2RPcChmdW5jdGlvbihoYW5kbGUsIG5vZGUsIG9wdGlvbnMpIHtcbiAgICAgIHJldHVybiBhZGRMaW5lV2lkZ2V0KHRoaXMsIGhhbmRsZSwgbm9kZSwgb3B0aW9ucyk7XG4gICAgfSksXG4gICAgcmVtb3ZlTGluZVdpZGdldDogZnVuY3Rpb24od2lkZ2V0KSB7IHdpZGdldC5jbGVhcigpOyB9LFxuXG4gICAgbWFya1RleHQ6IGZ1bmN0aW9uKGZyb20sIHRvLCBvcHRpb25zKSB7XG4gICAgICByZXR1cm4gbWFya1RleHQodGhpcywgY2xpcFBvcyh0aGlzLCBmcm9tKSwgY2xpcFBvcyh0aGlzLCB0byksIG9wdGlvbnMsIG9wdGlvbnMgJiYgb3B0aW9ucy50eXBlIHx8IFwicmFuZ2VcIik7XG4gICAgfSxcbiAgICBzZXRCb29rbWFyazogZnVuY3Rpb24ocG9zLCBvcHRpb25zKSB7XG4gICAgICB2YXIgcmVhbE9wdHMgPSB7cmVwbGFjZWRXaXRoOiBvcHRpb25zICYmIChvcHRpb25zLm5vZGVUeXBlID09IG51bGwgPyBvcHRpb25zLndpZGdldCA6IG9wdGlvbnMpLFxuICAgICAgICAgICAgICAgICAgICAgIGluc2VydExlZnQ6IG9wdGlvbnMgJiYgb3B0aW9ucy5pbnNlcnRMZWZ0LFxuICAgICAgICAgICAgICAgICAgICAgIGNsZWFyV2hlbkVtcHR5OiBmYWxzZSwgc2hhcmVkOiBvcHRpb25zICYmIG9wdGlvbnMuc2hhcmVkLFxuICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZU1vdXNlRXZlbnRzOiBvcHRpb25zICYmIG9wdGlvbnMuaGFuZGxlTW91c2VFdmVudHN9O1xuICAgICAgcG9zID0gY2xpcFBvcyh0aGlzLCBwb3MpO1xuICAgICAgcmV0dXJuIG1hcmtUZXh0KHRoaXMsIHBvcywgcG9zLCByZWFsT3B0cywgXCJib29rbWFya1wiKTtcbiAgICB9LFxuICAgIGZpbmRNYXJrc0F0OiBmdW5jdGlvbihwb3MpIHtcbiAgICAgIHBvcyA9IGNsaXBQb3ModGhpcywgcG9zKTtcbiAgICAgIHZhciBtYXJrZXJzID0gW10sIHNwYW5zID0gZ2V0TGluZSh0aGlzLCBwb3MubGluZSkubWFya2VkU3BhbnM7XG4gICAgICBpZiAoc3BhbnMpIGZvciAodmFyIGkgPSAwOyBpIDwgc3BhbnMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgdmFyIHNwYW4gPSBzcGFuc1tpXTtcbiAgICAgICAgaWYgKChzcGFuLmZyb20gPT0gbnVsbCB8fCBzcGFuLmZyb20gPD0gcG9zLmNoKSAmJlxuICAgICAgICAgICAgKHNwYW4udG8gPT0gbnVsbCB8fCBzcGFuLnRvID49IHBvcy5jaCkpXG4gICAgICAgICAgbWFya2Vycy5wdXNoKHNwYW4ubWFya2VyLnBhcmVudCB8fCBzcGFuLm1hcmtlcik7XG4gICAgICB9XG4gICAgICByZXR1cm4gbWFya2VycztcbiAgICB9LFxuICAgIGZpbmRNYXJrczogZnVuY3Rpb24oZnJvbSwgdG8sIGZpbHRlcikge1xuICAgICAgZnJvbSA9IGNsaXBQb3ModGhpcywgZnJvbSk7IHRvID0gY2xpcFBvcyh0aGlzLCB0byk7XG4gICAgICB2YXIgZm91bmQgPSBbXSwgbGluZU5vID0gZnJvbS5saW5lO1xuICAgICAgdGhpcy5pdGVyKGZyb20ubGluZSwgdG8ubGluZSArIDEsIGZ1bmN0aW9uKGxpbmUpIHtcbiAgICAgICAgdmFyIHNwYW5zID0gbGluZS5tYXJrZWRTcGFucztcbiAgICAgICAgaWYgKHNwYW5zKSBmb3IgKHZhciBpID0gMDsgaSA8IHNwYW5zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgdmFyIHNwYW4gPSBzcGFuc1tpXTtcbiAgICAgICAgICBpZiAoIShsaW5lTm8gPT0gZnJvbS5saW5lICYmIGZyb20uY2ggPiBzcGFuLnRvIHx8XG4gICAgICAgICAgICAgICAgc3Bhbi5mcm9tID09IG51bGwgJiYgbGluZU5vICE9IGZyb20ubGluZXx8XG4gICAgICAgICAgICAgICAgbGluZU5vID09IHRvLmxpbmUgJiYgc3Bhbi5mcm9tID4gdG8uY2gpICYmXG4gICAgICAgICAgICAgICghZmlsdGVyIHx8IGZpbHRlcihzcGFuLm1hcmtlcikpKVxuICAgICAgICAgICAgZm91bmQucHVzaChzcGFuLm1hcmtlci5wYXJlbnQgfHwgc3Bhbi5tYXJrZXIpO1xuICAgICAgICB9XG4gICAgICAgICsrbGluZU5vO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gZm91bmQ7XG4gICAgfSxcbiAgICBnZXRBbGxNYXJrczogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgbWFya2VycyA9IFtdO1xuICAgICAgdGhpcy5pdGVyKGZ1bmN0aW9uKGxpbmUpIHtcbiAgICAgICAgdmFyIHNwcyA9IGxpbmUubWFya2VkU3BhbnM7XG4gICAgICAgIGlmIChzcHMpIGZvciAodmFyIGkgPSAwOyBpIDwgc3BzLmxlbmd0aDsgKytpKVxuICAgICAgICAgIGlmIChzcHNbaV0uZnJvbSAhPSBudWxsKSBtYXJrZXJzLnB1c2goc3BzW2ldLm1hcmtlcik7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBtYXJrZXJzO1xuICAgIH0sXG5cbiAgICBwb3NGcm9tSW5kZXg6IGZ1bmN0aW9uKG9mZikge1xuICAgICAgdmFyIGNoLCBsaW5lTm8gPSB0aGlzLmZpcnN0O1xuICAgICAgdGhpcy5pdGVyKGZ1bmN0aW9uKGxpbmUpIHtcbiAgICAgICAgdmFyIHN6ID0gbGluZS50ZXh0Lmxlbmd0aCArIDE7XG4gICAgICAgIGlmIChzeiA+IG9mZikgeyBjaCA9IG9mZjsgcmV0dXJuIHRydWU7IH1cbiAgICAgICAgb2ZmIC09IHN6O1xuICAgICAgICArK2xpbmVObztcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGNsaXBQb3ModGhpcywgUG9zKGxpbmVObywgY2gpKTtcbiAgICB9LFxuICAgIGluZGV4RnJvbVBvczogZnVuY3Rpb24gKGNvb3Jkcykge1xuICAgICAgY29vcmRzID0gY2xpcFBvcyh0aGlzLCBjb29yZHMpO1xuICAgICAgdmFyIGluZGV4ID0gY29vcmRzLmNoO1xuICAgICAgaWYgKGNvb3Jkcy5saW5lIDwgdGhpcy5maXJzdCB8fCBjb29yZHMuY2ggPCAwKSByZXR1cm4gMDtcbiAgICAgIHRoaXMuaXRlcih0aGlzLmZpcnN0LCBjb29yZHMubGluZSwgZnVuY3Rpb24gKGxpbmUpIHtcbiAgICAgICAgaW5kZXggKz0gbGluZS50ZXh0Lmxlbmd0aCArIDE7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBpbmRleDtcbiAgICB9LFxuXG4gICAgY29weTogZnVuY3Rpb24oY29weUhpc3RvcnkpIHtcbiAgICAgIHZhciBkb2MgPSBuZXcgRG9jKGdldExpbmVzKHRoaXMsIHRoaXMuZmlyc3QsIHRoaXMuZmlyc3QgKyB0aGlzLnNpemUpLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tb2RlT3B0aW9uLCB0aGlzLmZpcnN0LCB0aGlzLmxpbmVTZXApO1xuICAgICAgZG9jLnNjcm9sbFRvcCA9IHRoaXMuc2Nyb2xsVG9wOyBkb2Muc2Nyb2xsTGVmdCA9IHRoaXMuc2Nyb2xsTGVmdDtcbiAgICAgIGRvYy5zZWwgPSB0aGlzLnNlbDtcbiAgICAgIGRvYy5leHRlbmQgPSBmYWxzZTtcbiAgICAgIGlmIChjb3B5SGlzdG9yeSkge1xuICAgICAgICBkb2MuaGlzdG9yeS51bmRvRGVwdGggPSB0aGlzLmhpc3RvcnkudW5kb0RlcHRoO1xuICAgICAgICBkb2Muc2V0SGlzdG9yeSh0aGlzLmdldEhpc3RvcnkoKSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gZG9jO1xuICAgIH0sXG5cbiAgICBsaW5rZWREb2M6IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICAgIGlmICghb3B0aW9ucykgb3B0aW9ucyA9IHt9O1xuICAgICAgdmFyIGZyb20gPSB0aGlzLmZpcnN0LCB0byA9IHRoaXMuZmlyc3QgKyB0aGlzLnNpemU7XG4gICAgICBpZiAob3B0aW9ucy5mcm9tICE9IG51bGwgJiYgb3B0aW9ucy5mcm9tID4gZnJvbSkgZnJvbSA9IG9wdGlvbnMuZnJvbTtcbiAgICAgIGlmIChvcHRpb25zLnRvICE9IG51bGwgJiYgb3B0aW9ucy50byA8IHRvKSB0byA9IG9wdGlvbnMudG87XG4gICAgICB2YXIgY29weSA9IG5ldyBEb2MoZ2V0TGluZXModGhpcywgZnJvbSwgdG8pLCBvcHRpb25zLm1vZGUgfHwgdGhpcy5tb2RlT3B0aW9uLCBmcm9tLCB0aGlzLmxpbmVTZXApO1xuICAgICAgaWYgKG9wdGlvbnMuc2hhcmVkSGlzdCkgY29weS5oaXN0b3J5ID0gdGhpcy5oaXN0b3J5O1xuICAgICAgKHRoaXMubGlua2VkIHx8ICh0aGlzLmxpbmtlZCA9IFtdKSkucHVzaCh7ZG9jOiBjb3B5LCBzaGFyZWRIaXN0OiBvcHRpb25zLnNoYXJlZEhpc3R9KTtcbiAgICAgIGNvcHkubGlua2VkID0gW3tkb2M6IHRoaXMsIGlzUGFyZW50OiB0cnVlLCBzaGFyZWRIaXN0OiBvcHRpb25zLnNoYXJlZEhpc3R9XTtcbiAgICAgIGNvcHlTaGFyZWRNYXJrZXJzKGNvcHksIGZpbmRTaGFyZWRNYXJrZXJzKHRoaXMpKTtcbiAgICAgIHJldHVybiBjb3B5O1xuICAgIH0sXG4gICAgdW5saW5rRG9jOiBmdW5jdGlvbihvdGhlcikge1xuICAgICAgaWYgKG90aGVyIGluc3RhbmNlb2YgQ29kZU1pcnJvcikgb3RoZXIgPSBvdGhlci5kb2M7XG4gICAgICBpZiAodGhpcy5saW5rZWQpIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5saW5rZWQubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgdmFyIGxpbmsgPSB0aGlzLmxpbmtlZFtpXTtcbiAgICAgICAgaWYgKGxpbmsuZG9jICE9IG90aGVyKSBjb250aW51ZTtcbiAgICAgICAgdGhpcy5saW5rZWQuc3BsaWNlKGksIDEpO1xuICAgICAgICBvdGhlci51bmxpbmtEb2ModGhpcyk7XG4gICAgICAgIGRldGFjaFNoYXJlZE1hcmtlcnMoZmluZFNoYXJlZE1hcmtlcnModGhpcykpO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIC8vIElmIHRoZSBoaXN0b3JpZXMgd2VyZSBzaGFyZWQsIHNwbGl0IHRoZW0gYWdhaW5cbiAgICAgIGlmIChvdGhlci5oaXN0b3J5ID09IHRoaXMuaGlzdG9yeSkge1xuICAgICAgICB2YXIgc3BsaXRJZHMgPSBbb3RoZXIuaWRdO1xuICAgICAgICBsaW5rZWREb2NzKG90aGVyLCBmdW5jdGlvbihkb2MpIHtzcGxpdElkcy5wdXNoKGRvYy5pZCk7fSwgdHJ1ZSk7XG4gICAgICAgIG90aGVyLmhpc3RvcnkgPSBuZXcgSGlzdG9yeShudWxsKTtcbiAgICAgICAgb3RoZXIuaGlzdG9yeS5kb25lID0gY29weUhpc3RvcnlBcnJheSh0aGlzLmhpc3RvcnkuZG9uZSwgc3BsaXRJZHMpO1xuICAgICAgICBvdGhlci5oaXN0b3J5LnVuZG9uZSA9IGNvcHlIaXN0b3J5QXJyYXkodGhpcy5oaXN0b3J5LnVuZG9uZSwgc3BsaXRJZHMpO1xuICAgICAgfVxuICAgIH0sXG4gICAgaXRlckxpbmtlZERvY3M6IGZ1bmN0aW9uKGYpIHtsaW5rZWREb2NzKHRoaXMsIGYpO30sXG5cbiAgICBnZXRNb2RlOiBmdW5jdGlvbigpIHtyZXR1cm4gdGhpcy5tb2RlO30sXG4gICAgZ2V0RWRpdG9yOiBmdW5jdGlvbigpIHtyZXR1cm4gdGhpcy5jbTt9LFxuXG4gICAgc3BsaXRMaW5lczogZnVuY3Rpb24oc3RyKSB7XG4gICAgICBpZiAodGhpcy5saW5lU2VwKSByZXR1cm4gc3RyLnNwbGl0KHRoaXMubGluZVNlcCk7XG4gICAgICByZXR1cm4gc3BsaXRMaW5lc0F1dG8oc3RyKTtcbiAgICB9LFxuICAgIGxpbmVTZXBhcmF0b3I6IGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpcy5saW5lU2VwIHx8IFwiXFxuXCI7IH1cbiAgfSk7XG5cbiAgLy8gUHVibGljIGFsaWFzLlxuICBEb2MucHJvdG90eXBlLmVhY2hMaW5lID0gRG9jLnByb3RvdHlwZS5pdGVyO1xuXG4gIC8vIFNldCB1cCBtZXRob2RzIG9uIENvZGVNaXJyb3IncyBwcm90b3R5cGUgdG8gcmVkaXJlY3QgdG8gdGhlIGVkaXRvcidzIGRvY3VtZW50LlxuICB2YXIgZG9udERlbGVnYXRlID0gXCJpdGVyIGluc2VydCByZW1vdmUgY29weSBnZXRFZGl0b3IgY29uc3RydWN0b3JcIi5zcGxpdChcIiBcIik7XG4gIGZvciAodmFyIHByb3AgaW4gRG9jLnByb3RvdHlwZSkgaWYgKERvYy5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkocHJvcCkgJiYgaW5kZXhPZihkb250RGVsZWdhdGUsIHByb3ApIDwgMClcbiAgICBDb2RlTWlycm9yLnByb3RvdHlwZVtwcm9wXSA9IChmdW5jdGlvbihtZXRob2QpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbigpIHtyZXR1cm4gbWV0aG9kLmFwcGx5KHRoaXMuZG9jLCBhcmd1bWVudHMpO307XG4gICAgfSkoRG9jLnByb3RvdHlwZVtwcm9wXSk7XG5cbiAgZXZlbnRNaXhpbihEb2MpO1xuXG4gIC8vIENhbGwgZiBmb3IgYWxsIGxpbmtlZCBkb2N1bWVudHMuXG4gIGZ1bmN0aW9uIGxpbmtlZERvY3MoZG9jLCBmLCBzaGFyZWRIaXN0T25seSkge1xuICAgIGZ1bmN0aW9uIHByb3BhZ2F0ZShkb2MsIHNraXAsIHNoYXJlZEhpc3QpIHtcbiAgICAgIGlmIChkb2MubGlua2VkKSBmb3IgKHZhciBpID0gMDsgaSA8IGRvYy5saW5rZWQubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgdmFyIHJlbCA9IGRvYy5saW5rZWRbaV07XG4gICAgICAgIGlmIChyZWwuZG9jID09IHNraXApIGNvbnRpbnVlO1xuICAgICAgICB2YXIgc2hhcmVkID0gc2hhcmVkSGlzdCAmJiByZWwuc2hhcmVkSGlzdDtcbiAgICAgICAgaWYgKHNoYXJlZEhpc3RPbmx5ICYmICFzaGFyZWQpIGNvbnRpbnVlO1xuICAgICAgICBmKHJlbC5kb2MsIHNoYXJlZCk7XG4gICAgICAgIHByb3BhZ2F0ZShyZWwuZG9jLCBkb2MsIHNoYXJlZCk7XG4gICAgICB9XG4gICAgfVxuICAgIHByb3BhZ2F0ZShkb2MsIG51bGwsIHRydWUpO1xuICB9XG5cbiAgLy8gQXR0YWNoIGEgZG9jdW1lbnQgdG8gYW4gZWRpdG9yLlxuICBmdW5jdGlvbiBhdHRhY2hEb2MoY20sIGRvYykge1xuICAgIGlmIChkb2MuY20pIHRocm93IG5ldyBFcnJvcihcIlRoaXMgZG9jdW1lbnQgaXMgYWxyZWFkeSBpbiB1c2UuXCIpO1xuICAgIGNtLmRvYyA9IGRvYztcbiAgICBkb2MuY20gPSBjbTtcbiAgICBlc3RpbWF0ZUxpbmVIZWlnaHRzKGNtKTtcbiAgICBsb2FkTW9kZShjbSk7XG4gICAgaWYgKCFjbS5vcHRpb25zLmxpbmVXcmFwcGluZykgZmluZE1heExpbmUoY20pO1xuICAgIGNtLm9wdGlvbnMubW9kZSA9IGRvYy5tb2RlT3B0aW9uO1xuICAgIHJlZ0NoYW5nZShjbSk7XG4gIH1cblxuICAvLyBMSU5FIFVUSUxJVElFU1xuXG4gIC8vIEZpbmQgdGhlIGxpbmUgb2JqZWN0IGNvcnJlc3BvbmRpbmcgdG8gdGhlIGdpdmVuIGxpbmUgbnVtYmVyLlxuICBmdW5jdGlvbiBnZXRMaW5lKGRvYywgbikge1xuICAgIG4gLT0gZG9jLmZpcnN0O1xuICAgIGlmIChuIDwgMCB8fCBuID49IGRvYy5zaXplKSB0aHJvdyBuZXcgRXJyb3IoXCJUaGVyZSBpcyBubyBsaW5lIFwiICsgKG4gKyBkb2MuZmlyc3QpICsgXCIgaW4gdGhlIGRvY3VtZW50LlwiKTtcbiAgICBmb3IgKHZhciBjaHVuayA9IGRvYzsgIWNodW5rLmxpbmVzOykge1xuICAgICAgZm9yICh2YXIgaSA9IDA7OyArK2kpIHtcbiAgICAgICAgdmFyIGNoaWxkID0gY2h1bmsuY2hpbGRyZW5baV0sIHN6ID0gY2hpbGQuY2h1bmtTaXplKCk7XG4gICAgICAgIGlmIChuIDwgc3opIHsgY2h1bmsgPSBjaGlsZDsgYnJlYWs7IH1cbiAgICAgICAgbiAtPSBzejtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGNodW5rLmxpbmVzW25dO1xuICB9XG5cbiAgLy8gR2V0IHRoZSBwYXJ0IG9mIGEgZG9jdW1lbnQgYmV0d2VlbiB0d28gcG9zaXRpb25zLCBhcyBhbiBhcnJheSBvZlxuICAvLyBzdHJpbmdzLlxuICBmdW5jdGlvbiBnZXRCZXR3ZWVuKGRvYywgc3RhcnQsIGVuZCkge1xuICAgIHZhciBvdXQgPSBbXSwgbiA9IHN0YXJ0LmxpbmU7XG4gICAgZG9jLml0ZXIoc3RhcnQubGluZSwgZW5kLmxpbmUgKyAxLCBmdW5jdGlvbihsaW5lKSB7XG4gICAgICB2YXIgdGV4dCA9IGxpbmUudGV4dDtcbiAgICAgIGlmIChuID09IGVuZC5saW5lKSB0ZXh0ID0gdGV4dC5zbGljZSgwLCBlbmQuY2gpO1xuICAgICAgaWYgKG4gPT0gc3RhcnQubGluZSkgdGV4dCA9IHRleHQuc2xpY2Uoc3RhcnQuY2gpO1xuICAgICAgb3V0LnB1c2godGV4dCk7XG4gICAgICArK247XG4gICAgfSk7XG4gICAgcmV0dXJuIG91dDtcbiAgfVxuICAvLyBHZXQgdGhlIGxpbmVzIGJldHdlZW4gZnJvbSBhbmQgdG8sIGFzIGFycmF5IG9mIHN0cmluZ3MuXG4gIGZ1bmN0aW9uIGdldExpbmVzKGRvYywgZnJvbSwgdG8pIHtcbiAgICB2YXIgb3V0ID0gW107XG4gICAgZG9jLml0ZXIoZnJvbSwgdG8sIGZ1bmN0aW9uKGxpbmUpIHsgb3V0LnB1c2gobGluZS50ZXh0KTsgfSk7XG4gICAgcmV0dXJuIG91dDtcbiAgfVxuXG4gIC8vIFVwZGF0ZSB0aGUgaGVpZ2h0IG9mIGEgbGluZSwgcHJvcGFnYXRpbmcgdGhlIGhlaWdodCBjaGFuZ2VcbiAgLy8gdXB3YXJkcyB0byBwYXJlbnQgbm9kZXMuXG4gIGZ1bmN0aW9uIHVwZGF0ZUxpbmVIZWlnaHQobGluZSwgaGVpZ2h0KSB7XG4gICAgdmFyIGRpZmYgPSBoZWlnaHQgLSBsaW5lLmhlaWdodDtcbiAgICBpZiAoZGlmZikgZm9yICh2YXIgbiA9IGxpbmU7IG47IG4gPSBuLnBhcmVudCkgbi5oZWlnaHQgKz0gZGlmZjtcbiAgfVxuXG4gIC8vIEdpdmVuIGEgbGluZSBvYmplY3QsIGZpbmQgaXRzIGxpbmUgbnVtYmVyIGJ5IHdhbGtpbmcgdXAgdGhyb3VnaFxuICAvLyBpdHMgcGFyZW50IGxpbmtzLlxuICBmdW5jdGlvbiBsaW5lTm8obGluZSkge1xuICAgIGlmIChsaW5lLnBhcmVudCA9PSBudWxsKSByZXR1cm4gbnVsbDtcbiAgICB2YXIgY3VyID0gbGluZS5wYXJlbnQsIG5vID0gaW5kZXhPZihjdXIubGluZXMsIGxpbmUpO1xuICAgIGZvciAodmFyIGNodW5rID0gY3VyLnBhcmVudDsgY2h1bms7IGN1ciA9IGNodW5rLCBjaHVuayA9IGNodW5rLnBhcmVudCkge1xuICAgICAgZm9yICh2YXIgaSA9IDA7OyArK2kpIHtcbiAgICAgICAgaWYgKGNodW5rLmNoaWxkcmVuW2ldID09IGN1cikgYnJlYWs7XG4gICAgICAgIG5vICs9IGNodW5rLmNoaWxkcmVuW2ldLmNodW5rU2l6ZSgpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbm8gKyBjdXIuZmlyc3Q7XG4gIH1cblxuICAvLyBGaW5kIHRoZSBsaW5lIGF0IHRoZSBnaXZlbiB2ZXJ0aWNhbCBwb3NpdGlvbiwgdXNpbmcgdGhlIGhlaWdodFxuICAvLyBpbmZvcm1hdGlvbiBpbiB0aGUgZG9jdW1lbnQgdHJlZS5cbiAgZnVuY3Rpb24gbGluZUF0SGVpZ2h0KGNodW5rLCBoKSB7XG4gICAgdmFyIG4gPSBjaHVuay5maXJzdDtcbiAgICBvdXRlcjogZG8ge1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjaHVuay5jaGlsZHJlbi5sZW5ndGg7ICsraSkge1xuICAgICAgICB2YXIgY2hpbGQgPSBjaHVuay5jaGlsZHJlbltpXSwgY2ggPSBjaGlsZC5oZWlnaHQ7XG4gICAgICAgIGlmIChoIDwgY2gpIHsgY2h1bmsgPSBjaGlsZDsgY29udGludWUgb3V0ZXI7IH1cbiAgICAgICAgaCAtPSBjaDtcbiAgICAgICAgbiArPSBjaGlsZC5jaHVua1NpemUoKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBuO1xuICAgIH0gd2hpbGUgKCFjaHVuay5saW5lcyk7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjaHVuay5saW5lcy5sZW5ndGg7ICsraSkge1xuICAgICAgdmFyIGxpbmUgPSBjaHVuay5saW5lc1tpXSwgbGggPSBsaW5lLmhlaWdodDtcbiAgICAgIGlmIChoIDwgbGgpIGJyZWFrO1xuICAgICAgaCAtPSBsaDtcbiAgICB9XG4gICAgcmV0dXJuIG4gKyBpO1xuICB9XG5cblxuICAvLyBGaW5kIHRoZSBoZWlnaHQgYWJvdmUgdGhlIGdpdmVuIGxpbmUuXG4gIGZ1bmN0aW9uIGhlaWdodEF0TGluZShsaW5lT2JqKSB7XG4gICAgbGluZU9iaiA9IHZpc3VhbExpbmUobGluZU9iaik7XG5cbiAgICB2YXIgaCA9IDAsIGNodW5rID0gbGluZU9iai5wYXJlbnQ7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjaHVuay5saW5lcy5sZW5ndGg7ICsraSkge1xuICAgICAgdmFyIGxpbmUgPSBjaHVuay5saW5lc1tpXTtcbiAgICAgIGlmIChsaW5lID09IGxpbmVPYmopIGJyZWFrO1xuICAgICAgZWxzZSBoICs9IGxpbmUuaGVpZ2h0O1xuICAgIH1cbiAgICBmb3IgKHZhciBwID0gY2h1bmsucGFyZW50OyBwOyBjaHVuayA9IHAsIHAgPSBjaHVuay5wYXJlbnQpIHtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcC5jaGlsZHJlbi5sZW5ndGg7ICsraSkge1xuICAgICAgICB2YXIgY3VyID0gcC5jaGlsZHJlbltpXTtcbiAgICAgICAgaWYgKGN1ciA9PSBjaHVuaykgYnJlYWs7XG4gICAgICAgIGVsc2UgaCArPSBjdXIuaGVpZ2h0O1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gaDtcbiAgfVxuXG4gIC8vIEdldCB0aGUgYmlkaSBvcmRlcmluZyBmb3IgdGhlIGdpdmVuIGxpbmUgKGFuZCBjYWNoZSBpdCkuIFJldHVybnNcbiAgLy8gZmFsc2UgZm9yIGxpbmVzIHRoYXQgYXJlIGZ1bGx5IGxlZnQtdG8tcmlnaHQsIGFuZCBhbiBhcnJheSBvZlxuICAvLyBCaWRpU3BhbiBvYmplY3RzIG90aGVyd2lzZS5cbiAgZnVuY3Rpb24gZ2V0T3JkZXIobGluZSkge1xuICAgIHZhciBvcmRlciA9IGxpbmUub3JkZXI7XG4gICAgaWYgKG9yZGVyID09IG51bGwpIG9yZGVyID0gbGluZS5vcmRlciA9IGJpZGlPcmRlcmluZyhsaW5lLnRleHQpO1xuICAgIHJldHVybiBvcmRlcjtcbiAgfVxuXG4gIC8vIEhJU1RPUllcblxuICBmdW5jdGlvbiBIaXN0b3J5KHN0YXJ0R2VuKSB7XG4gICAgLy8gQXJyYXlzIG9mIGNoYW5nZSBldmVudHMgYW5kIHNlbGVjdGlvbnMuIERvaW5nIHNvbWV0aGluZyBhZGRzIGFuXG4gICAgLy8gZXZlbnQgdG8gZG9uZSBhbmQgY2xlYXJzIHVuZG8uIFVuZG9pbmcgbW92ZXMgZXZlbnRzIGZyb20gZG9uZVxuICAgIC8vIHRvIHVuZG9uZSwgcmVkb2luZyBtb3ZlcyB0aGVtIGluIHRoZSBvdGhlciBkaXJlY3Rpb24uXG4gICAgdGhpcy5kb25lID0gW107IHRoaXMudW5kb25lID0gW107XG4gICAgdGhpcy51bmRvRGVwdGggPSBJbmZpbml0eTtcbiAgICAvLyBVc2VkIHRvIHRyYWNrIHdoZW4gY2hhbmdlcyBjYW4gYmUgbWVyZ2VkIGludG8gYSBzaW5nbGUgdW5kb1xuICAgIC8vIGV2ZW50XG4gICAgdGhpcy5sYXN0TW9kVGltZSA9IHRoaXMubGFzdFNlbFRpbWUgPSAwO1xuICAgIHRoaXMubGFzdE9wID0gdGhpcy5sYXN0U2VsT3AgPSBudWxsO1xuICAgIHRoaXMubGFzdE9yaWdpbiA9IHRoaXMubGFzdFNlbE9yaWdpbiA9IG51bGw7XG4gICAgLy8gVXNlZCBieSB0aGUgaXNDbGVhbigpIG1ldGhvZFxuICAgIHRoaXMuZ2VuZXJhdGlvbiA9IHRoaXMubWF4R2VuZXJhdGlvbiA9IHN0YXJ0R2VuIHx8IDE7XG4gIH1cblxuICAvLyBDcmVhdGUgYSBoaXN0b3J5IGNoYW5nZSBldmVudCBmcm9tIGFuIHVwZGF0ZURvYy1zdHlsZSBjaGFuZ2VcbiAgLy8gb2JqZWN0LlxuICBmdW5jdGlvbiBoaXN0b3J5Q2hhbmdlRnJvbUNoYW5nZShkb2MsIGNoYW5nZSkge1xuICAgIHZhciBoaXN0Q2hhbmdlID0ge2Zyb206IGNvcHlQb3MoY2hhbmdlLmZyb20pLCB0bzogY2hhbmdlRW5kKGNoYW5nZSksIHRleHQ6IGdldEJldHdlZW4oZG9jLCBjaGFuZ2UuZnJvbSwgY2hhbmdlLnRvKX07XG4gICAgYXR0YWNoTG9jYWxTcGFucyhkb2MsIGhpc3RDaGFuZ2UsIGNoYW5nZS5mcm9tLmxpbmUsIGNoYW5nZS50by5saW5lICsgMSk7XG4gICAgbGlua2VkRG9jcyhkb2MsIGZ1bmN0aW9uKGRvYykge2F0dGFjaExvY2FsU3BhbnMoZG9jLCBoaXN0Q2hhbmdlLCBjaGFuZ2UuZnJvbS5saW5lLCBjaGFuZ2UudG8ubGluZSArIDEpO30sIHRydWUpO1xuICAgIHJldHVybiBoaXN0Q2hhbmdlO1xuICB9XG5cbiAgLy8gUG9wIGFsbCBzZWxlY3Rpb24gZXZlbnRzIG9mZiB0aGUgZW5kIG9mIGEgaGlzdG9yeSBhcnJheS4gU3RvcCBhdFxuICAvLyBhIGNoYW5nZSBldmVudC5cbiAgZnVuY3Rpb24gY2xlYXJTZWxlY3Rpb25FdmVudHMoYXJyYXkpIHtcbiAgICB3aGlsZSAoYXJyYXkubGVuZ3RoKSB7XG4gICAgICB2YXIgbGFzdCA9IGxzdChhcnJheSk7XG4gICAgICBpZiAobGFzdC5yYW5nZXMpIGFycmF5LnBvcCgpO1xuICAgICAgZWxzZSBicmVhaztcbiAgICB9XG4gIH1cblxuICAvLyBGaW5kIHRoZSB0b3AgY2hhbmdlIGV2ZW50IGluIHRoZSBoaXN0b3J5LiBQb3Agb2ZmIHNlbGVjdGlvblxuICAvLyBldmVudHMgdGhhdCBhcmUgaW4gdGhlIHdheS5cbiAgZnVuY3Rpb24gbGFzdENoYW5nZUV2ZW50KGhpc3QsIGZvcmNlKSB7XG4gICAgaWYgKGZvcmNlKSB7XG4gICAgICBjbGVhclNlbGVjdGlvbkV2ZW50cyhoaXN0LmRvbmUpO1xuICAgICAgcmV0dXJuIGxzdChoaXN0LmRvbmUpO1xuICAgIH0gZWxzZSBpZiAoaGlzdC5kb25lLmxlbmd0aCAmJiAhbHN0KGhpc3QuZG9uZSkucmFuZ2VzKSB7XG4gICAgICByZXR1cm4gbHN0KGhpc3QuZG9uZSk7XG4gICAgfSBlbHNlIGlmIChoaXN0LmRvbmUubGVuZ3RoID4gMSAmJiAhaGlzdC5kb25lW2hpc3QuZG9uZS5sZW5ndGggLSAyXS5yYW5nZXMpIHtcbiAgICAgIGhpc3QuZG9uZS5wb3AoKTtcbiAgICAgIHJldHVybiBsc3QoaGlzdC5kb25lKTtcbiAgICB9XG4gIH1cblxuICAvLyBSZWdpc3RlciBhIGNoYW5nZSBpbiB0aGUgaGlzdG9yeS4gTWVyZ2VzIGNoYW5nZXMgdGhhdCBhcmUgd2l0aGluXG4gIC8vIGEgc2luZ2xlIG9wZXJhdGlvbiwgb3JlIGFyZSBjbG9zZSB0b2dldGhlciB3aXRoIGFuIG9yaWdpbiB0aGF0XG4gIC8vIGFsbG93cyBtZXJnaW5nIChzdGFydGluZyB3aXRoIFwiK1wiKSBpbnRvIGEgc2luZ2xlIGV2ZW50LlxuICBmdW5jdGlvbiBhZGRDaGFuZ2VUb0hpc3RvcnkoZG9jLCBjaGFuZ2UsIHNlbEFmdGVyLCBvcElkKSB7XG4gICAgdmFyIGhpc3QgPSBkb2MuaGlzdG9yeTtcbiAgICBoaXN0LnVuZG9uZS5sZW5ndGggPSAwO1xuICAgIHZhciB0aW1lID0gK25ldyBEYXRlLCBjdXI7XG5cbiAgICBpZiAoKGhpc3QubGFzdE9wID09IG9wSWQgfHxcbiAgICAgICAgIGhpc3QubGFzdE9yaWdpbiA9PSBjaGFuZ2Uub3JpZ2luICYmIGNoYW5nZS5vcmlnaW4gJiZcbiAgICAgICAgICgoY2hhbmdlLm9yaWdpbi5jaGFyQXQoMCkgPT0gXCIrXCIgJiYgZG9jLmNtICYmIGhpc3QubGFzdE1vZFRpbWUgPiB0aW1lIC0gZG9jLmNtLm9wdGlvbnMuaGlzdG9yeUV2ZW50RGVsYXkpIHx8XG4gICAgICAgICAgY2hhbmdlLm9yaWdpbi5jaGFyQXQoMCkgPT0gXCIqXCIpKSAmJlxuICAgICAgICAoY3VyID0gbGFzdENoYW5nZUV2ZW50KGhpc3QsIGhpc3QubGFzdE9wID09IG9wSWQpKSkge1xuICAgICAgLy8gTWVyZ2UgdGhpcyBjaGFuZ2UgaW50byB0aGUgbGFzdCBldmVudFxuICAgICAgdmFyIGxhc3QgPSBsc3QoY3VyLmNoYW5nZXMpO1xuICAgICAgaWYgKGNtcChjaGFuZ2UuZnJvbSwgY2hhbmdlLnRvKSA9PSAwICYmIGNtcChjaGFuZ2UuZnJvbSwgbGFzdC50bykgPT0gMCkge1xuICAgICAgICAvLyBPcHRpbWl6ZWQgY2FzZSBmb3Igc2ltcGxlIGluc2VydGlvbiAtLSBkb24ndCB3YW50IHRvIGFkZFxuICAgICAgICAvLyBuZXcgY2hhbmdlc2V0cyBmb3IgZXZlcnkgY2hhcmFjdGVyIHR5cGVkXG4gICAgICAgIGxhc3QudG8gPSBjaGFuZ2VFbmQoY2hhbmdlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIEFkZCBuZXcgc3ViLWV2ZW50XG4gICAgICAgIGN1ci5jaGFuZ2VzLnB1c2goaGlzdG9yeUNoYW5nZUZyb21DaGFuZ2UoZG9jLCBjaGFuZ2UpKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgLy8gQ2FuIG5vdCBiZSBtZXJnZWQsIHN0YXJ0IGEgbmV3IGV2ZW50LlxuICAgICAgdmFyIGJlZm9yZSA9IGxzdChoaXN0LmRvbmUpO1xuICAgICAgaWYgKCFiZWZvcmUgfHwgIWJlZm9yZS5yYW5nZXMpXG4gICAgICAgIHB1c2hTZWxlY3Rpb25Ub0hpc3RvcnkoZG9jLnNlbCwgaGlzdC5kb25lKTtcbiAgICAgIGN1ciA9IHtjaGFuZ2VzOiBbaGlzdG9yeUNoYW5nZUZyb21DaGFuZ2UoZG9jLCBjaGFuZ2UpXSxcbiAgICAgICAgICAgICBnZW5lcmF0aW9uOiBoaXN0LmdlbmVyYXRpb259O1xuICAgICAgaGlzdC5kb25lLnB1c2goY3VyKTtcbiAgICAgIHdoaWxlIChoaXN0LmRvbmUubGVuZ3RoID4gaGlzdC51bmRvRGVwdGgpIHtcbiAgICAgICAgaGlzdC5kb25lLnNoaWZ0KCk7XG4gICAgICAgIGlmICghaGlzdC5kb25lWzBdLnJhbmdlcykgaGlzdC5kb25lLnNoaWZ0KCk7XG4gICAgICB9XG4gICAgfVxuICAgIGhpc3QuZG9uZS5wdXNoKHNlbEFmdGVyKTtcbiAgICBoaXN0LmdlbmVyYXRpb24gPSArK2hpc3QubWF4R2VuZXJhdGlvbjtcbiAgICBoaXN0Lmxhc3RNb2RUaW1lID0gaGlzdC5sYXN0U2VsVGltZSA9IHRpbWU7XG4gICAgaGlzdC5sYXN0T3AgPSBoaXN0Lmxhc3RTZWxPcCA9IG9wSWQ7XG4gICAgaGlzdC5sYXN0T3JpZ2luID0gaGlzdC5sYXN0U2VsT3JpZ2luID0gY2hhbmdlLm9yaWdpbjtcblxuICAgIGlmICghbGFzdCkgc2lnbmFsKGRvYywgXCJoaXN0b3J5QWRkZWRcIik7XG4gIH1cblxuICBmdW5jdGlvbiBzZWxlY3Rpb25FdmVudENhbkJlTWVyZ2VkKGRvYywgb3JpZ2luLCBwcmV2LCBzZWwpIHtcbiAgICB2YXIgY2ggPSBvcmlnaW4uY2hhckF0KDApO1xuICAgIHJldHVybiBjaCA9PSBcIipcIiB8fFxuICAgICAgY2ggPT0gXCIrXCIgJiZcbiAgICAgIHByZXYucmFuZ2VzLmxlbmd0aCA9PSBzZWwucmFuZ2VzLmxlbmd0aCAmJlxuICAgICAgcHJldi5zb21ldGhpbmdTZWxlY3RlZCgpID09IHNlbC5zb21ldGhpbmdTZWxlY3RlZCgpICYmXG4gICAgICBuZXcgRGF0ZSAtIGRvYy5oaXN0b3J5Lmxhc3RTZWxUaW1lIDw9IChkb2MuY20gPyBkb2MuY20ub3B0aW9ucy5oaXN0b3J5RXZlbnREZWxheSA6IDUwMCk7XG4gIH1cblxuICAvLyBDYWxsZWQgd2hlbmV2ZXIgdGhlIHNlbGVjdGlvbiBjaGFuZ2VzLCBzZXRzIHRoZSBuZXcgc2VsZWN0aW9uIGFzXG4gIC8vIHRoZSBwZW5kaW5nIHNlbGVjdGlvbiBpbiB0aGUgaGlzdG9yeSwgYW5kIHB1c2hlcyB0aGUgb2xkIHBlbmRpbmdcbiAgLy8gc2VsZWN0aW9uIGludG8gdGhlICdkb25lJyBhcnJheSB3aGVuIGl0IHdhcyBzaWduaWZpY2FudGx5XG4gIC8vIGRpZmZlcmVudCAoaW4gbnVtYmVyIG9mIHNlbGVjdGVkIHJhbmdlcywgZW1wdGluZXNzLCBvciB0aW1lKS5cbiAgZnVuY3Rpb24gYWRkU2VsZWN0aW9uVG9IaXN0b3J5KGRvYywgc2VsLCBvcElkLCBvcHRpb25zKSB7XG4gICAgdmFyIGhpc3QgPSBkb2MuaGlzdG9yeSwgb3JpZ2luID0gb3B0aW9ucyAmJiBvcHRpb25zLm9yaWdpbjtcblxuICAgIC8vIEEgbmV3IGV2ZW50IGlzIHN0YXJ0ZWQgd2hlbiB0aGUgcHJldmlvdXMgb3JpZ2luIGRvZXMgbm90IG1hdGNoXG4gICAgLy8gdGhlIGN1cnJlbnQsIG9yIHRoZSBvcmlnaW5zIGRvbid0IGFsbG93IG1hdGNoaW5nLiBPcmlnaW5zXG4gICAgLy8gc3RhcnRpbmcgd2l0aCAqIGFyZSBhbHdheXMgbWVyZ2VkLCB0aG9zZSBzdGFydGluZyB3aXRoICsgYXJlXG4gICAgLy8gbWVyZ2VkIHdoZW4gc2ltaWxhciBhbmQgY2xvc2UgdG9nZXRoZXIgaW4gdGltZS5cbiAgICBpZiAob3BJZCA9PSBoaXN0Lmxhc3RTZWxPcCB8fFxuICAgICAgICAob3JpZ2luICYmIGhpc3QubGFzdFNlbE9yaWdpbiA9PSBvcmlnaW4gJiZcbiAgICAgICAgIChoaXN0Lmxhc3RNb2RUaW1lID09IGhpc3QubGFzdFNlbFRpbWUgJiYgaGlzdC5sYXN0T3JpZ2luID09IG9yaWdpbiB8fFxuICAgICAgICAgIHNlbGVjdGlvbkV2ZW50Q2FuQmVNZXJnZWQoZG9jLCBvcmlnaW4sIGxzdChoaXN0LmRvbmUpLCBzZWwpKSkpXG4gICAgICBoaXN0LmRvbmVbaGlzdC5kb25lLmxlbmd0aCAtIDFdID0gc2VsO1xuICAgIGVsc2VcbiAgICAgIHB1c2hTZWxlY3Rpb25Ub0hpc3Rvcnkoc2VsLCBoaXN0LmRvbmUpO1xuXG4gICAgaGlzdC5sYXN0U2VsVGltZSA9ICtuZXcgRGF0ZTtcbiAgICBoaXN0Lmxhc3RTZWxPcmlnaW4gPSBvcmlnaW47XG4gICAgaGlzdC5sYXN0U2VsT3AgPSBvcElkO1xuICAgIGlmIChvcHRpb25zICYmIG9wdGlvbnMuY2xlYXJSZWRvICE9PSBmYWxzZSlcbiAgICAgIGNsZWFyU2VsZWN0aW9uRXZlbnRzKGhpc3QudW5kb25lKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHB1c2hTZWxlY3Rpb25Ub0hpc3Rvcnkoc2VsLCBkZXN0KSB7XG4gICAgdmFyIHRvcCA9IGxzdChkZXN0KTtcbiAgICBpZiAoISh0b3AgJiYgdG9wLnJhbmdlcyAmJiB0b3AuZXF1YWxzKHNlbCkpKVxuICAgICAgZGVzdC5wdXNoKHNlbCk7XG4gIH1cblxuICAvLyBVc2VkIHRvIHN0b3JlIG1hcmtlZCBzcGFuIGluZm9ybWF0aW9uIGluIHRoZSBoaXN0b3J5LlxuICBmdW5jdGlvbiBhdHRhY2hMb2NhbFNwYW5zKGRvYywgY2hhbmdlLCBmcm9tLCB0bykge1xuICAgIHZhciBleGlzdGluZyA9IGNoYW5nZVtcInNwYW5zX1wiICsgZG9jLmlkXSwgbiA9IDA7XG4gICAgZG9jLml0ZXIoTWF0aC5tYXgoZG9jLmZpcnN0LCBmcm9tKSwgTWF0aC5taW4oZG9jLmZpcnN0ICsgZG9jLnNpemUsIHRvKSwgZnVuY3Rpb24obGluZSkge1xuICAgICAgaWYgKGxpbmUubWFya2VkU3BhbnMpXG4gICAgICAgIChleGlzdGluZyB8fCAoZXhpc3RpbmcgPSBjaGFuZ2VbXCJzcGFuc19cIiArIGRvYy5pZF0gPSB7fSkpW25dID0gbGluZS5tYXJrZWRTcGFucztcbiAgICAgICsrbjtcbiAgICB9KTtcbiAgfVxuXG4gIC8vIFdoZW4gdW4vcmUtZG9pbmcgcmVzdG9yZXMgdGV4dCBjb250YWluaW5nIG1hcmtlZCBzcGFucywgdGhvc2VcbiAgLy8gdGhhdCBoYXZlIGJlZW4gZXhwbGljaXRseSBjbGVhcmVkIHNob3VsZCBub3QgYmUgcmVzdG9yZWQuXG4gIGZ1bmN0aW9uIHJlbW92ZUNsZWFyZWRTcGFucyhzcGFucykge1xuICAgIGlmICghc3BhbnMpIHJldHVybiBudWxsO1xuICAgIGZvciAodmFyIGkgPSAwLCBvdXQ7IGkgPCBzcGFucy5sZW5ndGg7ICsraSkge1xuICAgICAgaWYgKHNwYW5zW2ldLm1hcmtlci5leHBsaWNpdGx5Q2xlYXJlZCkgeyBpZiAoIW91dCkgb3V0ID0gc3BhbnMuc2xpY2UoMCwgaSk7IH1cbiAgICAgIGVsc2UgaWYgKG91dCkgb3V0LnB1c2goc3BhbnNbaV0pO1xuICAgIH1cbiAgICByZXR1cm4gIW91dCA/IHNwYW5zIDogb3V0Lmxlbmd0aCA/IG91dCA6IG51bGw7XG4gIH1cblxuICAvLyBSZXRyaWV2ZSBhbmQgZmlsdGVyIHRoZSBvbGQgbWFya2VkIHNwYW5zIHN0b3JlZCBpbiBhIGNoYW5nZSBldmVudC5cbiAgZnVuY3Rpb24gZ2V0T2xkU3BhbnMoZG9jLCBjaGFuZ2UpIHtcbiAgICB2YXIgZm91bmQgPSBjaGFuZ2VbXCJzcGFuc19cIiArIGRvYy5pZF07XG4gICAgaWYgKCFmb3VuZCkgcmV0dXJuIG51bGw7XG4gICAgZm9yICh2YXIgaSA9IDAsIG53ID0gW107IGkgPCBjaGFuZ2UudGV4dC5sZW5ndGg7ICsraSlcbiAgICAgIG53LnB1c2gocmVtb3ZlQ2xlYXJlZFNwYW5zKGZvdW5kW2ldKSk7XG4gICAgcmV0dXJuIG53O1xuICB9XG5cbiAgLy8gVXNlZCBib3RoIHRvIHByb3ZpZGUgYSBKU09OLXNhZmUgb2JqZWN0IGluIC5nZXRIaXN0b3J5LCBhbmQsIHdoZW5cbiAgLy8gZGV0YWNoaW5nIGEgZG9jdW1lbnQsIHRvIHNwbGl0IHRoZSBoaXN0b3J5IGluIHR3b1xuICBmdW5jdGlvbiBjb3B5SGlzdG9yeUFycmF5KGV2ZW50cywgbmV3R3JvdXAsIGluc3RhbnRpYXRlU2VsKSB7XG4gICAgZm9yICh2YXIgaSA9IDAsIGNvcHkgPSBbXTsgaSA8IGV2ZW50cy5sZW5ndGg7ICsraSkge1xuICAgICAgdmFyIGV2ZW50ID0gZXZlbnRzW2ldO1xuICAgICAgaWYgKGV2ZW50LnJhbmdlcykge1xuICAgICAgICBjb3B5LnB1c2goaW5zdGFudGlhdGVTZWwgPyBTZWxlY3Rpb24ucHJvdG90eXBlLmRlZXBDb3B5LmNhbGwoZXZlbnQpIDogZXZlbnQpO1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICAgIHZhciBjaGFuZ2VzID0gZXZlbnQuY2hhbmdlcywgbmV3Q2hhbmdlcyA9IFtdO1xuICAgICAgY29weS5wdXNoKHtjaGFuZ2VzOiBuZXdDaGFuZ2VzfSk7XG4gICAgICBmb3IgKHZhciBqID0gMDsgaiA8IGNoYW5nZXMubGVuZ3RoOyArK2opIHtcbiAgICAgICAgdmFyIGNoYW5nZSA9IGNoYW5nZXNbal0sIG07XG4gICAgICAgIG5ld0NoYW5nZXMucHVzaCh7ZnJvbTogY2hhbmdlLmZyb20sIHRvOiBjaGFuZ2UudG8sIHRleHQ6IGNoYW5nZS50ZXh0fSk7XG4gICAgICAgIGlmIChuZXdHcm91cCkgZm9yICh2YXIgcHJvcCBpbiBjaGFuZ2UpIGlmIChtID0gcHJvcC5tYXRjaCgvXnNwYW5zXyhcXGQrKSQvKSkge1xuICAgICAgICAgIGlmIChpbmRleE9mKG5ld0dyb3VwLCBOdW1iZXIobVsxXSkpID4gLTEpIHtcbiAgICAgICAgICAgIGxzdChuZXdDaGFuZ2VzKVtwcm9wXSA9IGNoYW5nZVtwcm9wXTtcbiAgICAgICAgICAgIGRlbGV0ZSBjaGFuZ2VbcHJvcF07XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBjb3B5O1xuICB9XG5cbiAgLy8gUmViYXNpbmcvcmVzZXR0aW5nIGhpc3RvcnkgdG8gZGVhbCB3aXRoIGV4dGVybmFsbHktc291cmNlZCBjaGFuZ2VzXG5cbiAgZnVuY3Rpb24gcmViYXNlSGlzdFNlbFNpbmdsZShwb3MsIGZyb20sIHRvLCBkaWZmKSB7XG4gICAgaWYgKHRvIDwgcG9zLmxpbmUpIHtcbiAgICAgIHBvcy5saW5lICs9IGRpZmY7XG4gICAgfSBlbHNlIGlmIChmcm9tIDwgcG9zLmxpbmUpIHtcbiAgICAgIHBvcy5saW5lID0gZnJvbTtcbiAgICAgIHBvcy5jaCA9IDA7XG4gICAgfVxuICB9XG5cbiAgLy8gVHJpZXMgdG8gcmViYXNlIGFuIGFycmF5IG9mIGhpc3RvcnkgZXZlbnRzIGdpdmVuIGEgY2hhbmdlIGluIHRoZVxuICAvLyBkb2N1bWVudC4gSWYgdGhlIGNoYW5nZSB0b3VjaGVzIHRoZSBzYW1lIGxpbmVzIGFzIHRoZSBldmVudCwgdGhlXG4gIC8vIGV2ZW50LCBhbmQgZXZlcnl0aGluZyAnYmVoaW5kJyBpdCwgaXMgZGlzY2FyZGVkLiBJZiB0aGUgY2hhbmdlIGlzXG4gIC8vIGJlZm9yZSB0aGUgZXZlbnQsIHRoZSBldmVudCdzIHBvc2l0aW9ucyBhcmUgdXBkYXRlZC4gVXNlcyBhXG4gIC8vIGNvcHktb24td3JpdGUgc2NoZW1lIGZvciB0aGUgcG9zaXRpb25zLCB0byBhdm9pZCBoYXZpbmcgdG9cbiAgLy8gcmVhbGxvY2F0ZSB0aGVtIGFsbCBvbiBldmVyeSByZWJhc2UsIGJ1dCBhbHNvIGF2b2lkIHByb2JsZW1zIHdpdGhcbiAgLy8gc2hhcmVkIHBvc2l0aW9uIG9iamVjdHMgYmVpbmcgdW5zYWZlbHkgdXBkYXRlZC5cbiAgZnVuY3Rpb24gcmViYXNlSGlzdEFycmF5KGFycmF5LCBmcm9tLCB0bywgZGlmZikge1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXJyYXkubGVuZ3RoOyArK2kpIHtcbiAgICAgIHZhciBzdWIgPSBhcnJheVtpXSwgb2sgPSB0cnVlO1xuICAgICAgaWYgKHN1Yi5yYW5nZXMpIHtcbiAgICAgICAgaWYgKCFzdWIuY29waWVkKSB7IHN1YiA9IGFycmF5W2ldID0gc3ViLmRlZXBDb3B5KCk7IHN1Yi5jb3BpZWQgPSB0cnVlOyB9XG4gICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgc3ViLnJhbmdlcy5sZW5ndGg7IGorKykge1xuICAgICAgICAgIHJlYmFzZUhpc3RTZWxTaW5nbGUoc3ViLnJhbmdlc1tqXS5hbmNob3IsIGZyb20sIHRvLCBkaWZmKTtcbiAgICAgICAgICByZWJhc2VIaXN0U2VsU2luZ2xlKHN1Yi5yYW5nZXNbal0uaGVhZCwgZnJvbSwgdG8sIGRpZmYpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBzdWIuY2hhbmdlcy5sZW5ndGg7ICsraikge1xuICAgICAgICB2YXIgY3VyID0gc3ViLmNoYW5nZXNbal07XG4gICAgICAgIGlmICh0byA8IGN1ci5mcm9tLmxpbmUpIHtcbiAgICAgICAgICBjdXIuZnJvbSA9IFBvcyhjdXIuZnJvbS5saW5lICsgZGlmZiwgY3VyLmZyb20uY2gpO1xuICAgICAgICAgIGN1ci50byA9IFBvcyhjdXIudG8ubGluZSArIGRpZmYsIGN1ci50by5jaCk7XG4gICAgICAgIH0gZWxzZSBpZiAoZnJvbSA8PSBjdXIudG8ubGluZSkge1xuICAgICAgICAgIG9rID0gZmFsc2U7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmICghb2spIHtcbiAgICAgICAgYXJyYXkuc3BsaWNlKDAsIGkgKyAxKTtcbiAgICAgICAgaSA9IDA7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gcmViYXNlSGlzdChoaXN0LCBjaGFuZ2UpIHtcbiAgICB2YXIgZnJvbSA9IGNoYW5nZS5mcm9tLmxpbmUsIHRvID0gY2hhbmdlLnRvLmxpbmUsIGRpZmYgPSBjaGFuZ2UudGV4dC5sZW5ndGggLSAodG8gLSBmcm9tKSAtIDE7XG4gICAgcmViYXNlSGlzdEFycmF5KGhpc3QuZG9uZSwgZnJvbSwgdG8sIGRpZmYpO1xuICAgIHJlYmFzZUhpc3RBcnJheShoaXN0LnVuZG9uZSwgZnJvbSwgdG8sIGRpZmYpO1xuICB9XG5cbiAgLy8gRVZFTlQgVVRJTElUSUVTXG5cbiAgLy8gRHVlIHRvIHRoZSBmYWN0IHRoYXQgd2Ugc3RpbGwgc3VwcG9ydCBqdXJhc3NpYyBJRSB2ZXJzaW9ucywgc29tZVxuICAvLyBjb21wYXRpYmlsaXR5IHdyYXBwZXJzIGFyZSBuZWVkZWQuXG5cbiAgdmFyIGVfcHJldmVudERlZmF1bHQgPSBDb2RlTWlycm9yLmVfcHJldmVudERlZmF1bHQgPSBmdW5jdGlvbihlKSB7XG4gICAgaWYgKGUucHJldmVudERlZmF1bHQpIGUucHJldmVudERlZmF1bHQoKTtcbiAgICBlbHNlIGUucmV0dXJuVmFsdWUgPSBmYWxzZTtcbiAgfTtcbiAgdmFyIGVfc3RvcFByb3BhZ2F0aW9uID0gQ29kZU1pcnJvci5lX3N0b3BQcm9wYWdhdGlvbiA9IGZ1bmN0aW9uKGUpIHtcbiAgICBpZiAoZS5zdG9wUHJvcGFnYXRpb24pIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgZWxzZSBlLmNhbmNlbEJ1YmJsZSA9IHRydWU7XG4gIH07XG4gIGZ1bmN0aW9uIGVfZGVmYXVsdFByZXZlbnRlZChlKSB7XG4gICAgcmV0dXJuIGUuZGVmYXVsdFByZXZlbnRlZCAhPSBudWxsID8gZS5kZWZhdWx0UHJldmVudGVkIDogZS5yZXR1cm5WYWx1ZSA9PSBmYWxzZTtcbiAgfVxuICB2YXIgZV9zdG9wID0gQ29kZU1pcnJvci5lX3N0b3AgPSBmdW5jdGlvbihlKSB7ZV9wcmV2ZW50RGVmYXVsdChlKTsgZV9zdG9wUHJvcGFnYXRpb24oZSk7fTtcblxuICBmdW5jdGlvbiBlX3RhcmdldChlKSB7cmV0dXJuIGUudGFyZ2V0IHx8IGUuc3JjRWxlbWVudDt9XG4gIGZ1bmN0aW9uIGVfYnV0dG9uKGUpIHtcbiAgICB2YXIgYiA9IGUud2hpY2g7XG4gICAgaWYgKGIgPT0gbnVsbCkge1xuICAgICAgaWYgKGUuYnV0dG9uICYgMSkgYiA9IDE7XG4gICAgICBlbHNlIGlmIChlLmJ1dHRvbiAmIDIpIGIgPSAzO1xuICAgICAgZWxzZSBpZiAoZS5idXR0b24gJiA0KSBiID0gMjtcbiAgICB9XG4gICAgaWYgKG1hYyAmJiBlLmN0cmxLZXkgJiYgYiA9PSAxKSBiID0gMztcbiAgICByZXR1cm4gYjtcbiAgfVxuXG4gIC8vIEVWRU5UIEhBTkRMSU5HXG5cbiAgLy8gTGlnaHR3ZWlnaHQgZXZlbnQgZnJhbWV3b3JrLiBvbi9vZmYgYWxzbyB3b3JrIG9uIERPTSBub2RlcyxcbiAgLy8gcmVnaXN0ZXJpbmcgbmF0aXZlIERPTSBoYW5kbGVycy5cblxuICB2YXIgb24gPSBDb2RlTWlycm9yLm9uID0gZnVuY3Rpb24oZW1pdHRlciwgdHlwZSwgZikge1xuICAgIGlmIChlbWl0dGVyLmFkZEV2ZW50TGlzdGVuZXIpXG4gICAgICBlbWl0dGVyLmFkZEV2ZW50TGlzdGVuZXIodHlwZSwgZiwgZmFsc2UpO1xuICAgIGVsc2UgaWYgKGVtaXR0ZXIuYXR0YWNoRXZlbnQpXG4gICAgICBlbWl0dGVyLmF0dGFjaEV2ZW50KFwib25cIiArIHR5cGUsIGYpO1xuICAgIGVsc2Uge1xuICAgICAgdmFyIG1hcCA9IGVtaXR0ZXIuX2hhbmRsZXJzIHx8IChlbWl0dGVyLl9oYW5kbGVycyA9IHt9KTtcbiAgICAgIHZhciBhcnIgPSBtYXBbdHlwZV0gfHwgKG1hcFt0eXBlXSA9IFtdKTtcbiAgICAgIGFyci5wdXNoKGYpO1xuICAgIH1cbiAgfTtcblxuICB2YXIgbm9IYW5kbGVycyA9IFtdXG4gIGZ1bmN0aW9uIGdldEhhbmRsZXJzKGVtaXR0ZXIsIHR5cGUsIGNvcHkpIHtcbiAgICB2YXIgYXJyID0gZW1pdHRlci5faGFuZGxlcnMgJiYgZW1pdHRlci5faGFuZGxlcnNbdHlwZV1cbiAgICBpZiAoY29weSkgcmV0dXJuIGFyciAmJiBhcnIubGVuZ3RoID4gMCA/IGFyci5zbGljZSgpIDogbm9IYW5kbGVyc1xuICAgIGVsc2UgcmV0dXJuIGFyciB8fCBub0hhbmRsZXJzXG4gIH1cblxuICB2YXIgb2ZmID0gQ29kZU1pcnJvci5vZmYgPSBmdW5jdGlvbihlbWl0dGVyLCB0eXBlLCBmKSB7XG4gICAgaWYgKGVtaXR0ZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcilcbiAgICAgIGVtaXR0ZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcih0eXBlLCBmLCBmYWxzZSk7XG4gICAgZWxzZSBpZiAoZW1pdHRlci5kZXRhY2hFdmVudClcbiAgICAgIGVtaXR0ZXIuZGV0YWNoRXZlbnQoXCJvblwiICsgdHlwZSwgZik7XG4gICAgZWxzZSB7XG4gICAgICB2YXIgaGFuZGxlcnMgPSBnZXRIYW5kbGVycyhlbWl0dGVyLCB0eXBlLCBmYWxzZSlcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaGFuZGxlcnMubGVuZ3RoOyArK2kpXG4gICAgICAgIGlmIChoYW5kbGVyc1tpXSA9PSBmKSB7IGhhbmRsZXJzLnNwbGljZShpLCAxKTsgYnJlYWs7IH1cbiAgICB9XG4gIH07XG5cbiAgdmFyIHNpZ25hbCA9IENvZGVNaXJyb3Iuc2lnbmFsID0gZnVuY3Rpb24oZW1pdHRlciwgdHlwZSAvKiwgdmFsdWVzLi4uKi8pIHtcbiAgICB2YXIgaGFuZGxlcnMgPSBnZXRIYW5kbGVycyhlbWl0dGVyLCB0eXBlLCB0cnVlKVxuICAgIGlmICghaGFuZGxlcnMubGVuZ3RoKSByZXR1cm47XG4gICAgdmFyIGFyZ3MgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDIpO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaGFuZGxlcnMubGVuZ3RoOyArK2kpIGhhbmRsZXJzW2ldLmFwcGx5KG51bGwsIGFyZ3MpO1xuICB9O1xuXG4gIHZhciBvcnBoYW5EZWxheWVkQ2FsbGJhY2tzID0gbnVsbDtcblxuICAvLyBPZnRlbiwgd2Ugd2FudCB0byBzaWduYWwgZXZlbnRzIGF0IGEgcG9pbnQgd2hlcmUgd2UgYXJlIGluIHRoZVxuICAvLyBtaWRkbGUgb2Ygc29tZSB3b3JrLCBidXQgZG9uJ3Qgd2FudCB0aGUgaGFuZGxlciB0byBzdGFydCBjYWxsaW5nXG4gIC8vIG90aGVyIG1ldGhvZHMgb24gdGhlIGVkaXRvciwgd2hpY2ggbWlnaHQgYmUgaW4gYW4gaW5jb25zaXN0ZW50XG4gIC8vIHN0YXRlIG9yIHNpbXBseSBub3QgZXhwZWN0IGFueSBvdGhlciBldmVudHMgdG8gaGFwcGVuLlxuICAvLyBzaWduYWxMYXRlciBsb29rcyB3aGV0aGVyIHRoZXJlIGFyZSBhbnkgaGFuZGxlcnMsIGFuZCBzY2hlZHVsZXNcbiAgLy8gdGhlbSB0byBiZSBleGVjdXRlZCB3aGVuIHRoZSBsYXN0IG9wZXJhdGlvbiBlbmRzLCBvciwgaWYgbm9cbiAgLy8gb3BlcmF0aW9uIGlzIGFjdGl2ZSwgd2hlbiBhIHRpbWVvdXQgZmlyZXMuXG4gIGZ1bmN0aW9uIHNpZ25hbExhdGVyKGVtaXR0ZXIsIHR5cGUgLyosIHZhbHVlcy4uLiovKSB7XG4gICAgdmFyIGFyciA9IGdldEhhbmRsZXJzKGVtaXR0ZXIsIHR5cGUsIGZhbHNlKVxuICAgIGlmICghYXJyLmxlbmd0aCkgcmV0dXJuO1xuICAgIHZhciBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAyKSwgbGlzdDtcbiAgICBpZiAob3BlcmF0aW9uR3JvdXApIHtcbiAgICAgIGxpc3QgPSBvcGVyYXRpb25Hcm91cC5kZWxheWVkQ2FsbGJhY2tzO1xuICAgIH0gZWxzZSBpZiAob3JwaGFuRGVsYXllZENhbGxiYWNrcykge1xuICAgICAgbGlzdCA9IG9ycGhhbkRlbGF5ZWRDYWxsYmFja3M7XG4gICAgfSBlbHNlIHtcbiAgICAgIGxpc3QgPSBvcnBoYW5EZWxheWVkQ2FsbGJhY2tzID0gW107XG4gICAgICBzZXRUaW1lb3V0KGZpcmVPcnBoYW5EZWxheWVkLCAwKTtcbiAgICB9XG4gICAgZnVuY3Rpb24gYm5kKGYpIHtyZXR1cm4gZnVuY3Rpb24oKXtmLmFwcGx5KG51bGwsIGFyZ3MpO307fTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFyci5sZW5ndGg7ICsraSlcbiAgICAgIGxpc3QucHVzaChibmQoYXJyW2ldKSk7XG4gIH1cblxuICBmdW5jdGlvbiBmaXJlT3JwaGFuRGVsYXllZCgpIHtcbiAgICB2YXIgZGVsYXllZCA9IG9ycGhhbkRlbGF5ZWRDYWxsYmFja3M7XG4gICAgb3JwaGFuRGVsYXllZENhbGxiYWNrcyA9IG51bGw7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkZWxheWVkLmxlbmd0aDsgKytpKSBkZWxheWVkW2ldKCk7XG4gIH1cblxuICAvLyBUaGUgRE9NIGV2ZW50cyB0aGF0IENvZGVNaXJyb3IgaGFuZGxlcyBjYW4gYmUgb3ZlcnJpZGRlbiBieVxuICAvLyByZWdpc3RlcmluZyBhIChub24tRE9NKSBoYW5kbGVyIG9uIHRoZSBlZGl0b3IgZm9yIHRoZSBldmVudCBuYW1lLFxuICAvLyBhbmQgcHJldmVudERlZmF1bHQtaW5nIHRoZSBldmVudCBpbiB0aGF0IGhhbmRsZXIuXG4gIGZ1bmN0aW9uIHNpZ25hbERPTUV2ZW50KGNtLCBlLCBvdmVycmlkZSkge1xuICAgIGlmICh0eXBlb2YgZSA9PSBcInN0cmluZ1wiKVxuICAgICAgZSA9IHt0eXBlOiBlLCBwcmV2ZW50RGVmYXVsdDogZnVuY3Rpb24oKSB7IHRoaXMuZGVmYXVsdFByZXZlbnRlZCA9IHRydWU7IH19O1xuICAgIHNpZ25hbChjbSwgb3ZlcnJpZGUgfHwgZS50eXBlLCBjbSwgZSk7XG4gICAgcmV0dXJuIGVfZGVmYXVsdFByZXZlbnRlZChlKSB8fCBlLmNvZGVtaXJyb3JJZ25vcmU7XG4gIH1cblxuICBmdW5jdGlvbiBzaWduYWxDdXJzb3JBY3Rpdml0eShjbSkge1xuICAgIHZhciBhcnIgPSBjbS5faGFuZGxlcnMgJiYgY20uX2hhbmRsZXJzLmN1cnNvckFjdGl2aXR5O1xuICAgIGlmICghYXJyKSByZXR1cm47XG4gICAgdmFyIHNldCA9IGNtLmN1ck9wLmN1cnNvckFjdGl2aXR5SGFuZGxlcnMgfHwgKGNtLmN1ck9wLmN1cnNvckFjdGl2aXR5SGFuZGxlcnMgPSBbXSk7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcnIubGVuZ3RoOyArK2kpIGlmIChpbmRleE9mKHNldCwgYXJyW2ldKSA9PSAtMSlcbiAgICAgIHNldC5wdXNoKGFycltpXSk7XG4gIH1cblxuICBmdW5jdGlvbiBoYXNIYW5kbGVyKGVtaXR0ZXIsIHR5cGUpIHtcbiAgICByZXR1cm4gZ2V0SGFuZGxlcnMoZW1pdHRlciwgdHlwZSkubGVuZ3RoID4gMFxuICB9XG5cbiAgLy8gQWRkIG9uIGFuZCBvZmYgbWV0aG9kcyB0byBhIGNvbnN0cnVjdG9yJ3MgcHJvdG90eXBlLCB0byBtYWtlXG4gIC8vIHJlZ2lzdGVyaW5nIGV2ZW50cyBvbiBzdWNoIG9iamVjdHMgbW9yZSBjb252ZW5pZW50LlxuICBmdW5jdGlvbiBldmVudE1peGluKGN0b3IpIHtcbiAgICBjdG9yLnByb3RvdHlwZS5vbiA9IGZ1bmN0aW9uKHR5cGUsIGYpIHtvbih0aGlzLCB0eXBlLCBmKTt9O1xuICAgIGN0b3IucHJvdG90eXBlLm9mZiA9IGZ1bmN0aW9uKHR5cGUsIGYpIHtvZmYodGhpcywgdHlwZSwgZik7fTtcbiAgfVxuXG4gIC8vIE1JU0MgVVRJTElUSUVTXG5cbiAgLy8gTnVtYmVyIG9mIHBpeGVscyBhZGRlZCB0byBzY3JvbGxlciBhbmQgc2l6ZXIgdG8gaGlkZSBzY3JvbGxiYXJcbiAgdmFyIHNjcm9sbGVyR2FwID0gMzA7XG5cbiAgLy8gUmV0dXJuZWQgb3IgdGhyb3duIGJ5IHZhcmlvdXMgcHJvdG9jb2xzIHRvIHNpZ25hbCAnSSdtIG5vdFxuICAvLyBoYW5kbGluZyB0aGlzJy5cbiAgdmFyIFBhc3MgPSBDb2RlTWlycm9yLlBhc3MgPSB7dG9TdHJpbmc6IGZ1bmN0aW9uKCl7cmV0dXJuIFwiQ29kZU1pcnJvci5QYXNzXCI7fX07XG5cbiAgLy8gUmV1c2VkIG9wdGlvbiBvYmplY3RzIGZvciBzZXRTZWxlY3Rpb24gJiBmcmllbmRzXG4gIHZhciBzZWxfZG9udFNjcm9sbCA9IHtzY3JvbGw6IGZhbHNlfSwgc2VsX21vdXNlID0ge29yaWdpbjogXCIqbW91c2VcIn0sIHNlbF9tb3ZlID0ge29yaWdpbjogXCIrbW92ZVwifTtcblxuICBmdW5jdGlvbiBEZWxheWVkKCkge3RoaXMuaWQgPSBudWxsO31cbiAgRGVsYXllZC5wcm90b3R5cGUuc2V0ID0gZnVuY3Rpb24obXMsIGYpIHtcbiAgICBjbGVhclRpbWVvdXQodGhpcy5pZCk7XG4gICAgdGhpcy5pZCA9IHNldFRpbWVvdXQoZiwgbXMpO1xuICB9O1xuXG4gIC8vIENvdW50cyB0aGUgY29sdW1uIG9mZnNldCBpbiBhIHN0cmluZywgdGFraW5nIHRhYnMgaW50byBhY2NvdW50LlxuICAvLyBVc2VkIG1vc3RseSB0byBmaW5kIGluZGVudGF0aW9uLlxuICB2YXIgY291bnRDb2x1bW4gPSBDb2RlTWlycm9yLmNvdW50Q29sdW1uID0gZnVuY3Rpb24oc3RyaW5nLCBlbmQsIHRhYlNpemUsIHN0YXJ0SW5kZXgsIHN0YXJ0VmFsdWUpIHtcbiAgICBpZiAoZW5kID09IG51bGwpIHtcbiAgICAgIGVuZCA9IHN0cmluZy5zZWFyY2goL1teXFxzXFx1MDBhMF0vKTtcbiAgICAgIGlmIChlbmQgPT0gLTEpIGVuZCA9IHN0cmluZy5sZW5ndGg7XG4gICAgfVxuICAgIGZvciAodmFyIGkgPSBzdGFydEluZGV4IHx8IDAsIG4gPSBzdGFydFZhbHVlIHx8IDA7Oykge1xuICAgICAgdmFyIG5leHRUYWIgPSBzdHJpbmcuaW5kZXhPZihcIlxcdFwiLCBpKTtcbiAgICAgIGlmIChuZXh0VGFiIDwgMCB8fCBuZXh0VGFiID49IGVuZClcbiAgICAgICAgcmV0dXJuIG4gKyAoZW5kIC0gaSk7XG4gICAgICBuICs9IG5leHRUYWIgLSBpO1xuICAgICAgbiArPSB0YWJTaXplIC0gKG4gJSB0YWJTaXplKTtcbiAgICAgIGkgPSBuZXh0VGFiICsgMTtcbiAgICB9XG4gIH07XG5cbiAgLy8gVGhlIGludmVyc2Ugb2YgY291bnRDb2x1bW4gLS0gZmluZCB0aGUgb2Zmc2V0IHRoYXQgY29ycmVzcG9uZHMgdG9cbiAgLy8gYSBwYXJ0aWN1bGFyIGNvbHVtbi5cbiAgdmFyIGZpbmRDb2x1bW4gPSBDb2RlTWlycm9yLmZpbmRDb2x1bW4gPSBmdW5jdGlvbihzdHJpbmcsIGdvYWwsIHRhYlNpemUpIHtcbiAgICBmb3IgKHZhciBwb3MgPSAwLCBjb2wgPSAwOzspIHtcbiAgICAgIHZhciBuZXh0VGFiID0gc3RyaW5nLmluZGV4T2YoXCJcXHRcIiwgcG9zKTtcbiAgICAgIGlmIChuZXh0VGFiID09IC0xKSBuZXh0VGFiID0gc3RyaW5nLmxlbmd0aDtcbiAgICAgIHZhciBza2lwcGVkID0gbmV4dFRhYiAtIHBvcztcbiAgICAgIGlmIChuZXh0VGFiID09IHN0cmluZy5sZW5ndGggfHwgY29sICsgc2tpcHBlZCA+PSBnb2FsKVxuICAgICAgICByZXR1cm4gcG9zICsgTWF0aC5taW4oc2tpcHBlZCwgZ29hbCAtIGNvbCk7XG4gICAgICBjb2wgKz0gbmV4dFRhYiAtIHBvcztcbiAgICAgIGNvbCArPSB0YWJTaXplIC0gKGNvbCAlIHRhYlNpemUpO1xuICAgICAgcG9zID0gbmV4dFRhYiArIDE7XG4gICAgICBpZiAoY29sID49IGdvYWwpIHJldHVybiBwb3M7XG4gICAgfVxuICB9XG5cbiAgdmFyIHNwYWNlU3RycyA9IFtcIlwiXTtcbiAgZnVuY3Rpb24gc3BhY2VTdHIobikge1xuICAgIHdoaWxlIChzcGFjZVN0cnMubGVuZ3RoIDw9IG4pXG4gICAgICBzcGFjZVN0cnMucHVzaChsc3Qoc3BhY2VTdHJzKSArIFwiIFwiKTtcbiAgICByZXR1cm4gc3BhY2VTdHJzW25dO1xuICB9XG5cbiAgZnVuY3Rpb24gbHN0KGFycikgeyByZXR1cm4gYXJyW2Fyci5sZW5ndGgtMV07IH1cblxuICB2YXIgc2VsZWN0SW5wdXQgPSBmdW5jdGlvbihub2RlKSB7IG5vZGUuc2VsZWN0KCk7IH07XG4gIGlmIChpb3MpIC8vIE1vYmlsZSBTYWZhcmkgYXBwYXJlbnRseSBoYXMgYSBidWcgd2hlcmUgc2VsZWN0KCkgaXMgYnJva2VuLlxuICAgIHNlbGVjdElucHV0ID0gZnVuY3Rpb24obm9kZSkgeyBub2RlLnNlbGVjdGlvblN0YXJ0ID0gMDsgbm9kZS5zZWxlY3Rpb25FbmQgPSBub2RlLnZhbHVlLmxlbmd0aDsgfTtcbiAgZWxzZSBpZiAoaWUpIC8vIFN1cHByZXNzIG15c3RlcmlvdXMgSUUxMCBlcnJvcnNcbiAgICBzZWxlY3RJbnB1dCA9IGZ1bmN0aW9uKG5vZGUpIHsgdHJ5IHsgbm9kZS5zZWxlY3QoKTsgfSBjYXRjaChfZSkge30gfTtcblxuICBmdW5jdGlvbiBpbmRleE9mKGFycmF5LCBlbHQpIHtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFycmF5Lmxlbmd0aDsgKytpKVxuICAgICAgaWYgKGFycmF5W2ldID09IGVsdCkgcmV0dXJuIGk7XG4gICAgcmV0dXJuIC0xO1xuICB9XG4gIGZ1bmN0aW9uIG1hcChhcnJheSwgZikge1xuICAgIHZhciBvdXQgPSBbXTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFycmF5Lmxlbmd0aDsgaSsrKSBvdXRbaV0gPSBmKGFycmF5W2ldLCBpKTtcbiAgICByZXR1cm4gb3V0O1xuICB9XG5cbiAgZnVuY3Rpb24gbm90aGluZygpIHt9XG5cbiAgZnVuY3Rpb24gY3JlYXRlT2JqKGJhc2UsIHByb3BzKSB7XG4gICAgdmFyIGluc3Q7XG4gICAgaWYgKE9iamVjdC5jcmVhdGUpIHtcbiAgICAgIGluc3QgPSBPYmplY3QuY3JlYXRlKGJhc2UpO1xuICAgIH0gZWxzZSB7XG4gICAgICBub3RoaW5nLnByb3RvdHlwZSA9IGJhc2U7XG4gICAgICBpbnN0ID0gbmV3IG5vdGhpbmcoKTtcbiAgICB9XG4gICAgaWYgKHByb3BzKSBjb3B5T2JqKHByb3BzLCBpbnN0KTtcbiAgICByZXR1cm4gaW5zdDtcbiAgfTtcblxuICBmdW5jdGlvbiBjb3B5T2JqKG9iaiwgdGFyZ2V0LCBvdmVyd3JpdGUpIHtcbiAgICBpZiAoIXRhcmdldCkgdGFyZ2V0ID0ge307XG4gICAgZm9yICh2YXIgcHJvcCBpbiBvYmopXG4gICAgICBpZiAob2JqLmhhc093blByb3BlcnR5KHByb3ApICYmIChvdmVyd3JpdGUgIT09IGZhbHNlIHx8ICF0YXJnZXQuaGFzT3duUHJvcGVydHkocHJvcCkpKVxuICAgICAgICB0YXJnZXRbcHJvcF0gPSBvYmpbcHJvcF07XG4gICAgcmV0dXJuIHRhcmdldDtcbiAgfVxuXG4gIGZ1bmN0aW9uIGJpbmQoZikge1xuICAgIHZhciBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTtcbiAgICByZXR1cm4gZnVuY3Rpb24oKXtyZXR1cm4gZi5hcHBseShudWxsLCBhcmdzKTt9O1xuICB9XG5cbiAgdmFyIG5vbkFTQ0lJU2luZ2xlQ2FzZVdvcmRDaGFyID0gL1tcXHUwMGRmXFx1MDU4N1xcdTA1OTAtXFx1MDVmNFxcdTA2MDAtXFx1MDZmZlxcdTMwNDAtXFx1MzA5ZlxcdTMwYTAtXFx1MzBmZlxcdTM0MDAtXFx1NGRiNVxcdTRlMDAtXFx1OWZjY1xcdWFjMDAtXFx1ZDdhZl0vO1xuICB2YXIgaXNXb3JkQ2hhckJhc2ljID0gQ29kZU1pcnJvci5pc1dvcmRDaGFyID0gZnVuY3Rpb24oY2gpIHtcbiAgICByZXR1cm4gL1xcdy8udGVzdChjaCkgfHwgY2ggPiBcIlxceDgwXCIgJiZcbiAgICAgIChjaC50b1VwcGVyQ2FzZSgpICE9IGNoLnRvTG93ZXJDYXNlKCkgfHwgbm9uQVNDSUlTaW5nbGVDYXNlV29yZENoYXIudGVzdChjaCkpO1xuICB9O1xuICBmdW5jdGlvbiBpc1dvcmRDaGFyKGNoLCBoZWxwZXIpIHtcbiAgICBpZiAoIWhlbHBlcikgcmV0dXJuIGlzV29yZENoYXJCYXNpYyhjaCk7XG4gICAgaWYgKGhlbHBlci5zb3VyY2UuaW5kZXhPZihcIlxcXFx3XCIpID4gLTEgJiYgaXNXb3JkQ2hhckJhc2ljKGNoKSkgcmV0dXJuIHRydWU7XG4gICAgcmV0dXJuIGhlbHBlci50ZXN0KGNoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGlzRW1wdHkob2JqKSB7XG4gICAgZm9yICh2YXIgbiBpbiBvYmopIGlmIChvYmouaGFzT3duUHJvcGVydHkobikgJiYgb2JqW25dKSByZXR1cm4gZmFsc2U7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICAvLyBFeHRlbmRpbmcgdW5pY29kZSBjaGFyYWN0ZXJzLiBBIHNlcmllcyBvZiBhIG5vbi1leHRlbmRpbmcgY2hhciArXG4gIC8vIGFueSBudW1iZXIgb2YgZXh0ZW5kaW5nIGNoYXJzIGlzIHRyZWF0ZWQgYXMgYSBzaW5nbGUgdW5pdCBhcyBmYXJcbiAgLy8gYXMgZWRpdGluZyBhbmQgbWVhc3VyaW5nIGlzIGNvbmNlcm5lZC4gVGhpcyBpcyBub3QgZnVsbHkgY29ycmVjdCxcbiAgLy8gc2luY2Ugc29tZSBzY3JpcHRzL2ZvbnRzL2Jyb3dzZXJzIGFsc28gdHJlYXQgb3RoZXIgY29uZmlndXJhdGlvbnNcbiAgLy8gb2YgY29kZSBwb2ludHMgYXMgYSBncm91cC5cbiAgdmFyIGV4dGVuZGluZ0NoYXJzID0gL1tcXHUwMzAwLVxcdTAzNmZcXHUwNDgzLVxcdTA0ODlcXHUwNTkxLVxcdTA1YmRcXHUwNWJmXFx1MDVjMVxcdTA1YzJcXHUwNWM0XFx1MDVjNVxcdTA1YzdcXHUwNjEwLVxcdTA2MWFcXHUwNjRiLVxcdTA2NWVcXHUwNjcwXFx1MDZkNi1cXHUwNmRjXFx1MDZkZS1cXHUwNmU0XFx1MDZlN1xcdTA2ZThcXHUwNmVhLVxcdTA2ZWRcXHUwNzExXFx1MDczMC1cXHUwNzRhXFx1MDdhNi1cXHUwN2IwXFx1MDdlYi1cXHUwN2YzXFx1MDgxNi1cXHUwODE5XFx1MDgxYi1cXHUwODIzXFx1MDgyNS1cXHUwODI3XFx1MDgyOS1cXHUwODJkXFx1MDkwMC1cXHUwOTAyXFx1MDkzY1xcdTA5NDEtXFx1MDk0OFxcdTA5NGRcXHUwOTUxLVxcdTA5NTVcXHUwOTYyXFx1MDk2M1xcdTA5ODFcXHUwOWJjXFx1MDliZVxcdTA5YzEtXFx1MDljNFxcdTA5Y2RcXHUwOWQ3XFx1MDllMlxcdTA5ZTNcXHUwYTAxXFx1MGEwMlxcdTBhM2NcXHUwYTQxXFx1MGE0MlxcdTBhNDdcXHUwYTQ4XFx1MGE0Yi1cXHUwYTRkXFx1MGE1MVxcdTBhNzBcXHUwYTcxXFx1MGE3NVxcdTBhODFcXHUwYTgyXFx1MGFiY1xcdTBhYzEtXFx1MGFjNVxcdTBhYzdcXHUwYWM4XFx1MGFjZFxcdTBhZTJcXHUwYWUzXFx1MGIwMVxcdTBiM2NcXHUwYjNlXFx1MGIzZlxcdTBiNDEtXFx1MGI0NFxcdTBiNGRcXHUwYjU2XFx1MGI1N1xcdTBiNjJcXHUwYjYzXFx1MGI4MlxcdTBiYmVcXHUwYmMwXFx1MGJjZFxcdTBiZDdcXHUwYzNlLVxcdTBjNDBcXHUwYzQ2LVxcdTBjNDhcXHUwYzRhLVxcdTBjNGRcXHUwYzU1XFx1MGM1NlxcdTBjNjJcXHUwYzYzXFx1MGNiY1xcdTBjYmZcXHUwY2MyXFx1MGNjNlxcdTBjY2NcXHUwY2NkXFx1MGNkNVxcdTBjZDZcXHUwY2UyXFx1MGNlM1xcdTBkM2VcXHUwZDQxLVxcdTBkNDRcXHUwZDRkXFx1MGQ1N1xcdTBkNjJcXHUwZDYzXFx1MGRjYVxcdTBkY2ZcXHUwZGQyLVxcdTBkZDRcXHUwZGQ2XFx1MGRkZlxcdTBlMzFcXHUwZTM0LVxcdTBlM2FcXHUwZTQ3LVxcdTBlNGVcXHUwZWIxXFx1MGViNC1cXHUwZWI5XFx1MGViYlxcdTBlYmNcXHUwZWM4LVxcdTBlY2RcXHUwZjE4XFx1MGYxOVxcdTBmMzVcXHUwZjM3XFx1MGYzOVxcdTBmNzEtXFx1MGY3ZVxcdTBmODAtXFx1MGY4NFxcdTBmODZcXHUwZjg3XFx1MGY5MC1cXHUwZjk3XFx1MGY5OS1cXHUwZmJjXFx1MGZjNlxcdTEwMmQtXFx1MTAzMFxcdTEwMzItXFx1MTAzN1xcdTEwMzlcXHUxMDNhXFx1MTAzZFxcdTEwM2VcXHUxMDU4XFx1MTA1OVxcdTEwNWUtXFx1MTA2MFxcdTEwNzEtXFx1MTA3NFxcdTEwODJcXHUxMDg1XFx1MTA4NlxcdTEwOGRcXHUxMDlkXFx1MTM1ZlxcdTE3MTItXFx1MTcxNFxcdTE3MzItXFx1MTczNFxcdTE3NTJcXHUxNzUzXFx1MTc3MlxcdTE3NzNcXHUxN2I3LVxcdTE3YmRcXHUxN2M2XFx1MTdjOS1cXHUxN2QzXFx1MTdkZFxcdTE4MGItXFx1MTgwZFxcdTE4YTlcXHUxOTIwLVxcdTE5MjJcXHUxOTI3XFx1MTkyOFxcdTE5MzJcXHUxOTM5LVxcdTE5M2JcXHUxYTE3XFx1MWExOFxcdTFhNTZcXHUxYTU4LVxcdTFhNWVcXHUxYTYwXFx1MWE2MlxcdTFhNjUtXFx1MWE2Y1xcdTFhNzMtXFx1MWE3Y1xcdTFhN2ZcXHUxYjAwLVxcdTFiMDNcXHUxYjM0XFx1MWIzNi1cXHUxYjNhXFx1MWIzY1xcdTFiNDJcXHUxYjZiLVxcdTFiNzNcXHUxYjgwXFx1MWI4MVxcdTFiYTItXFx1MWJhNVxcdTFiYThcXHUxYmE5XFx1MWMyYy1cXHUxYzMzXFx1MWMzNlxcdTFjMzdcXHUxY2QwLVxcdTFjZDJcXHUxY2Q0LVxcdTFjZTBcXHUxY2UyLVxcdTFjZThcXHUxY2VkXFx1MWRjMC1cXHUxZGU2XFx1MWRmZC1cXHUxZGZmXFx1MjAwY1xcdTIwMGRcXHUyMGQwLVxcdTIwZjBcXHUyY2VmLVxcdTJjZjFcXHUyZGUwLVxcdTJkZmZcXHUzMDJhLVxcdTMwMmZcXHUzMDk5XFx1MzA5YVxcdWE2NmYtXFx1YTY3MlxcdWE2N2NcXHVhNjdkXFx1YTZmMFxcdWE2ZjFcXHVhODAyXFx1YTgwNlxcdWE4MGJcXHVhODI1XFx1YTgyNlxcdWE4YzRcXHVhOGUwLVxcdWE4ZjFcXHVhOTI2LVxcdWE5MmRcXHVhOTQ3LVxcdWE5NTFcXHVhOTgwLVxcdWE5ODJcXHVhOWIzXFx1YTliNi1cXHVhOWI5XFx1YTliY1xcdWFhMjktXFx1YWEyZVxcdWFhMzFcXHVhYTMyXFx1YWEzNVxcdWFhMzZcXHVhYTQzXFx1YWE0Y1xcdWFhYjBcXHVhYWIyLVxcdWFhYjRcXHVhYWI3XFx1YWFiOFxcdWFhYmVcXHVhYWJmXFx1YWFjMVxcdWFiZTVcXHVhYmU4XFx1YWJlZFxcdWRjMDAtXFx1ZGZmZlxcdWZiMWVcXHVmZTAwLVxcdWZlMGZcXHVmZTIwLVxcdWZlMjZcXHVmZjllXFx1ZmY5Zl0vO1xuICBmdW5jdGlvbiBpc0V4dGVuZGluZ0NoYXIoY2gpIHsgcmV0dXJuIGNoLmNoYXJDb2RlQXQoMCkgPj0gNzY4ICYmIGV4dGVuZGluZ0NoYXJzLnRlc3QoY2gpOyB9XG5cbiAgLy8gRE9NIFVUSUxJVElFU1xuXG4gIGZ1bmN0aW9uIGVsdCh0YWcsIGNvbnRlbnQsIGNsYXNzTmFtZSwgc3R5bGUpIHtcbiAgICB2YXIgZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnKTtcbiAgICBpZiAoY2xhc3NOYW1lKSBlLmNsYXNzTmFtZSA9IGNsYXNzTmFtZTtcbiAgICBpZiAoc3R5bGUpIGUuc3R5bGUuY3NzVGV4dCA9IHN0eWxlO1xuICAgIGlmICh0eXBlb2YgY29udGVudCA9PSBcInN0cmluZ1wiKSBlLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGNvbnRlbnQpKTtcbiAgICBlbHNlIGlmIChjb250ZW50KSBmb3IgKHZhciBpID0gMDsgaSA8IGNvbnRlbnQubGVuZ3RoOyArK2kpIGUuYXBwZW5kQ2hpbGQoY29udGVudFtpXSk7XG4gICAgcmV0dXJuIGU7XG4gIH1cblxuICB2YXIgcmFuZ2U7XG4gIGlmIChkb2N1bWVudC5jcmVhdGVSYW5nZSkgcmFuZ2UgPSBmdW5jdGlvbihub2RlLCBzdGFydCwgZW5kLCBlbmROb2RlKSB7XG4gICAgdmFyIHIgPSBkb2N1bWVudC5jcmVhdGVSYW5nZSgpO1xuICAgIHIuc2V0RW5kKGVuZE5vZGUgfHwgbm9kZSwgZW5kKTtcbiAgICByLnNldFN0YXJ0KG5vZGUsIHN0YXJ0KTtcbiAgICByZXR1cm4gcjtcbiAgfTtcbiAgZWxzZSByYW5nZSA9IGZ1bmN0aW9uKG5vZGUsIHN0YXJ0LCBlbmQpIHtcbiAgICB2YXIgciA9IGRvY3VtZW50LmJvZHkuY3JlYXRlVGV4dFJhbmdlKCk7XG4gICAgdHJ5IHsgci5tb3ZlVG9FbGVtZW50VGV4dChub2RlLnBhcmVudE5vZGUpOyB9XG4gICAgY2F0Y2goZSkgeyByZXR1cm4gcjsgfVxuICAgIHIuY29sbGFwc2UodHJ1ZSk7XG4gICAgci5tb3ZlRW5kKFwiY2hhcmFjdGVyXCIsIGVuZCk7XG4gICAgci5tb3ZlU3RhcnQoXCJjaGFyYWN0ZXJcIiwgc3RhcnQpO1xuICAgIHJldHVybiByO1xuICB9O1xuXG4gIGZ1bmN0aW9uIHJlbW92ZUNoaWxkcmVuKGUpIHtcbiAgICBmb3IgKHZhciBjb3VudCA9IGUuY2hpbGROb2Rlcy5sZW5ndGg7IGNvdW50ID4gMDsgLS1jb3VudClcbiAgICAgIGUucmVtb3ZlQ2hpbGQoZS5maXJzdENoaWxkKTtcbiAgICByZXR1cm4gZTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHJlbW92ZUNoaWxkcmVuQW5kQWRkKHBhcmVudCwgZSkge1xuICAgIHJldHVybiByZW1vdmVDaGlsZHJlbihwYXJlbnQpLmFwcGVuZENoaWxkKGUpO1xuICB9XG5cbiAgdmFyIGNvbnRhaW5zID0gQ29kZU1pcnJvci5jb250YWlucyA9IGZ1bmN0aW9uKHBhcmVudCwgY2hpbGQpIHtcbiAgICBpZiAoY2hpbGQubm9kZVR5cGUgPT0gMykgLy8gQW5kcm9pZCBicm93c2VyIGFsd2F5cyByZXR1cm5zIGZhbHNlIHdoZW4gY2hpbGQgaXMgYSB0ZXh0bm9kZVxuICAgICAgY2hpbGQgPSBjaGlsZC5wYXJlbnROb2RlO1xuICAgIGlmIChwYXJlbnQuY29udGFpbnMpXG4gICAgICByZXR1cm4gcGFyZW50LmNvbnRhaW5zKGNoaWxkKTtcbiAgICBkbyB7XG4gICAgICBpZiAoY2hpbGQubm9kZVR5cGUgPT0gMTEpIGNoaWxkID0gY2hpbGQuaG9zdDtcbiAgICAgIGlmIChjaGlsZCA9PSBwYXJlbnQpIHJldHVybiB0cnVlO1xuICAgIH0gd2hpbGUgKGNoaWxkID0gY2hpbGQucGFyZW50Tm9kZSk7XG4gIH07XG5cbiAgZnVuY3Rpb24gYWN0aXZlRWx0KCkge1xuICAgIHZhciBhY3RpdmVFbGVtZW50ID0gZG9jdW1lbnQuYWN0aXZlRWxlbWVudDtcbiAgICB3aGlsZSAoYWN0aXZlRWxlbWVudCAmJiBhY3RpdmVFbGVtZW50LnJvb3QgJiYgYWN0aXZlRWxlbWVudC5yb290LmFjdGl2ZUVsZW1lbnQpXG4gICAgICBhY3RpdmVFbGVtZW50ID0gYWN0aXZlRWxlbWVudC5yb290LmFjdGl2ZUVsZW1lbnQ7XG4gICAgcmV0dXJuIGFjdGl2ZUVsZW1lbnQ7XG4gIH1cbiAgLy8gT2xkZXIgdmVyc2lvbnMgb2YgSUUgdGhyb3dzIHVuc3BlY2lmaWVkIGVycm9yIHdoZW4gdG91Y2hpbmdcbiAgLy8gZG9jdW1lbnQuYWN0aXZlRWxlbWVudCBpbiBzb21lIGNhc2VzIChkdXJpbmcgbG9hZGluZywgaW4gaWZyYW1lKVxuICBpZiAoaWUgJiYgaWVfdmVyc2lvbiA8IDExKSBhY3RpdmVFbHQgPSBmdW5jdGlvbigpIHtcbiAgICB0cnkgeyByZXR1cm4gZG9jdW1lbnQuYWN0aXZlRWxlbWVudDsgfVxuICAgIGNhdGNoKGUpIHsgcmV0dXJuIGRvY3VtZW50LmJvZHk7IH1cbiAgfTtcblxuICBmdW5jdGlvbiBjbGFzc1Rlc3QoY2xzKSB7IHJldHVybiBuZXcgUmVnRXhwKFwiKF58XFxcXHMpXCIgKyBjbHMgKyBcIig/OiR8XFxcXHMpXFxcXHMqXCIpOyB9XG4gIHZhciBybUNsYXNzID0gQ29kZU1pcnJvci5ybUNsYXNzID0gZnVuY3Rpb24obm9kZSwgY2xzKSB7XG4gICAgdmFyIGN1cnJlbnQgPSBub2RlLmNsYXNzTmFtZTtcbiAgICB2YXIgbWF0Y2ggPSBjbGFzc1Rlc3QoY2xzKS5leGVjKGN1cnJlbnQpO1xuICAgIGlmIChtYXRjaCkge1xuICAgICAgdmFyIGFmdGVyID0gY3VycmVudC5zbGljZShtYXRjaC5pbmRleCArIG1hdGNoWzBdLmxlbmd0aCk7XG4gICAgICBub2RlLmNsYXNzTmFtZSA9IGN1cnJlbnQuc2xpY2UoMCwgbWF0Y2guaW5kZXgpICsgKGFmdGVyID8gbWF0Y2hbMV0gKyBhZnRlciA6IFwiXCIpO1xuICAgIH1cbiAgfTtcbiAgdmFyIGFkZENsYXNzID0gQ29kZU1pcnJvci5hZGRDbGFzcyA9IGZ1bmN0aW9uKG5vZGUsIGNscykge1xuICAgIHZhciBjdXJyZW50ID0gbm9kZS5jbGFzc05hbWU7XG4gICAgaWYgKCFjbGFzc1Rlc3QoY2xzKS50ZXN0KGN1cnJlbnQpKSBub2RlLmNsYXNzTmFtZSArPSAoY3VycmVudCA/IFwiIFwiIDogXCJcIikgKyBjbHM7XG4gIH07XG4gIGZ1bmN0aW9uIGpvaW5DbGFzc2VzKGEsIGIpIHtcbiAgICB2YXIgYXMgPSBhLnNwbGl0KFwiIFwiKTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFzLmxlbmd0aDsgaSsrKVxuICAgICAgaWYgKGFzW2ldICYmICFjbGFzc1Rlc3QoYXNbaV0pLnRlc3QoYikpIGIgKz0gXCIgXCIgKyBhc1tpXTtcbiAgICByZXR1cm4gYjtcbiAgfVxuXG4gIC8vIFdJTkRPVy1XSURFIEVWRU5UU1xuXG4gIC8vIFRoZXNlIG11c3QgYmUgaGFuZGxlZCBjYXJlZnVsbHksIGJlY2F1c2UgbmFpdmVseSByZWdpc3RlcmluZyBhXG4gIC8vIGhhbmRsZXIgZm9yIGVhY2ggZWRpdG9yIHdpbGwgY2F1c2UgdGhlIGVkaXRvcnMgdG8gbmV2ZXIgYmVcbiAgLy8gZ2FyYmFnZSBjb2xsZWN0ZWQuXG5cbiAgZnVuY3Rpb24gZm9yRWFjaENvZGVNaXJyb3IoZikge1xuICAgIGlmICghZG9jdW1lbnQuYm9keS5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKSByZXR1cm47XG4gICAgdmFyIGJ5Q2xhc3MgPSBkb2N1bWVudC5ib2R5LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoXCJDb2RlTWlycm9yXCIpO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYnlDbGFzcy5sZW5ndGg7IGkrKykge1xuICAgICAgdmFyIGNtID0gYnlDbGFzc1tpXS5Db2RlTWlycm9yO1xuICAgICAgaWYgKGNtKSBmKGNtKTtcbiAgICB9XG4gIH1cblxuICB2YXIgZ2xvYmFsc1JlZ2lzdGVyZWQgPSBmYWxzZTtcbiAgZnVuY3Rpb24gZW5zdXJlR2xvYmFsSGFuZGxlcnMoKSB7XG4gICAgaWYgKGdsb2JhbHNSZWdpc3RlcmVkKSByZXR1cm47XG4gICAgcmVnaXN0ZXJHbG9iYWxIYW5kbGVycygpO1xuICAgIGdsb2JhbHNSZWdpc3RlcmVkID0gdHJ1ZTtcbiAgfVxuICBmdW5jdGlvbiByZWdpc3Rlckdsb2JhbEhhbmRsZXJzKCkge1xuICAgIC8vIFdoZW4gdGhlIHdpbmRvdyByZXNpemVzLCB3ZSBuZWVkIHRvIHJlZnJlc2ggYWN0aXZlIGVkaXRvcnMuXG4gICAgdmFyIHJlc2l6ZVRpbWVyO1xuICAgIG9uKHdpbmRvdywgXCJyZXNpemVcIiwgZnVuY3Rpb24oKSB7XG4gICAgICBpZiAocmVzaXplVGltZXIgPT0gbnVsbCkgcmVzaXplVGltZXIgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICByZXNpemVUaW1lciA9IG51bGw7XG4gICAgICAgIGZvckVhY2hDb2RlTWlycm9yKG9uUmVzaXplKTtcbiAgICAgIH0sIDEwMCk7XG4gICAgfSk7XG4gICAgLy8gV2hlbiB0aGUgd2luZG93IGxvc2VzIGZvY3VzLCB3ZSB3YW50IHRvIHNob3cgdGhlIGVkaXRvciBhcyBibHVycmVkXG4gICAgb24od2luZG93LCBcImJsdXJcIiwgZnVuY3Rpb24oKSB7XG4gICAgICBmb3JFYWNoQ29kZU1pcnJvcihvbkJsdXIpO1xuICAgIH0pO1xuICB9XG5cbiAgLy8gRkVBVFVSRSBERVRFQ1RJT05cblxuICAvLyBEZXRlY3QgZHJhZy1hbmQtZHJvcFxuICB2YXIgZHJhZ0FuZERyb3AgPSBmdW5jdGlvbigpIHtcbiAgICAvLyBUaGVyZSBpcyAqc29tZSoga2luZCBvZiBkcmFnLWFuZC1kcm9wIHN1cHBvcnQgaW4gSUU2LTgsIGJ1dCBJXG4gICAgLy8gY291bGRuJ3QgZ2V0IGl0IHRvIHdvcmsgeWV0LlxuICAgIGlmIChpZSAmJiBpZV92ZXJzaW9uIDwgOSkgcmV0dXJuIGZhbHNlO1xuICAgIHZhciBkaXYgPSBlbHQoJ2RpdicpO1xuICAgIHJldHVybiBcImRyYWdnYWJsZVwiIGluIGRpdiB8fCBcImRyYWdEcm9wXCIgaW4gZGl2O1xuICB9KCk7XG5cbiAgdmFyIHp3c3BTdXBwb3J0ZWQ7XG4gIGZ1bmN0aW9uIHplcm9XaWR0aEVsZW1lbnQobWVhc3VyZSkge1xuICAgIGlmICh6d3NwU3VwcG9ydGVkID09IG51bGwpIHtcbiAgICAgIHZhciB0ZXN0ID0gZWx0KFwic3BhblwiLCBcIlxcdTIwMGJcIik7XG4gICAgICByZW1vdmVDaGlsZHJlbkFuZEFkZChtZWFzdXJlLCBlbHQoXCJzcGFuXCIsIFt0ZXN0LCBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShcInhcIildKSk7XG4gICAgICBpZiAobWVhc3VyZS5maXJzdENoaWxkLm9mZnNldEhlaWdodCAhPSAwKVxuICAgICAgICB6d3NwU3VwcG9ydGVkID0gdGVzdC5vZmZzZXRXaWR0aCA8PSAxICYmIHRlc3Qub2Zmc2V0SGVpZ2h0ID4gMiAmJiAhKGllICYmIGllX3ZlcnNpb24gPCA4KTtcbiAgICB9XG4gICAgdmFyIG5vZGUgPSB6d3NwU3VwcG9ydGVkID8gZWx0KFwic3BhblwiLCBcIlxcdTIwMGJcIikgOlxuICAgICAgZWx0KFwic3BhblwiLCBcIlxcdTAwYTBcIiwgbnVsbCwgXCJkaXNwbGF5OiBpbmxpbmUtYmxvY2s7IHdpZHRoOiAxcHg7IG1hcmdpbi1yaWdodDogLTFweFwiKTtcbiAgICBub2RlLnNldEF0dHJpYnV0ZShcImNtLXRleHRcIiwgXCJcIik7XG4gICAgcmV0dXJuIG5vZGU7XG4gIH1cblxuICAvLyBGZWF0dXJlLWRldGVjdCBJRSdzIGNydW1teSBjbGllbnQgcmVjdCByZXBvcnRpbmcgZm9yIGJpZGkgdGV4dFxuICB2YXIgYmFkQmlkaVJlY3RzO1xuICBmdW5jdGlvbiBoYXNCYWRCaWRpUmVjdHMobWVhc3VyZSkge1xuICAgIGlmIChiYWRCaWRpUmVjdHMgIT0gbnVsbCkgcmV0dXJuIGJhZEJpZGlSZWN0cztcbiAgICB2YXIgdHh0ID0gcmVtb3ZlQ2hpbGRyZW5BbmRBZGQobWVhc3VyZSwgZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoXCJBXFx1MDYyZUFcIikpO1xuICAgIHZhciByMCA9IHJhbmdlKHR4dCwgMCwgMSkuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgaWYgKCFyMCB8fCByMC5sZWZ0ID09IHIwLnJpZ2h0KSByZXR1cm4gZmFsc2U7IC8vIFNhZmFyaSByZXR1cm5zIG51bGwgaW4gc29tZSBjYXNlcyAoIzI3ODApXG4gICAgdmFyIHIxID0gcmFuZ2UodHh0LCAxLCAyKS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICByZXR1cm4gYmFkQmlkaVJlY3RzID0gKHIxLnJpZ2h0IC0gcjAucmlnaHQgPCAzKTtcbiAgfVxuXG4gIC8vIFNlZSBpZiBcIlwiLnNwbGl0IGlzIHRoZSBicm9rZW4gSUUgdmVyc2lvbiwgaWYgc28sIHByb3ZpZGUgYW5cbiAgLy8gYWx0ZXJuYXRpdmUgd2F5IHRvIHNwbGl0IGxpbmVzLlxuICB2YXIgc3BsaXRMaW5lc0F1dG8gPSBDb2RlTWlycm9yLnNwbGl0TGluZXMgPSBcIlxcblxcbmJcIi5zcGxpdCgvXFxuLykubGVuZ3RoICE9IDMgPyBmdW5jdGlvbihzdHJpbmcpIHtcbiAgICB2YXIgcG9zID0gMCwgcmVzdWx0ID0gW10sIGwgPSBzdHJpbmcubGVuZ3RoO1xuICAgIHdoaWxlIChwb3MgPD0gbCkge1xuICAgICAgdmFyIG5sID0gc3RyaW5nLmluZGV4T2YoXCJcXG5cIiwgcG9zKTtcbiAgICAgIGlmIChubCA9PSAtMSkgbmwgPSBzdHJpbmcubGVuZ3RoO1xuICAgICAgdmFyIGxpbmUgPSBzdHJpbmcuc2xpY2UocG9zLCBzdHJpbmcuY2hhckF0KG5sIC0gMSkgPT0gXCJcXHJcIiA/IG5sIC0gMSA6IG5sKTtcbiAgICAgIHZhciBydCA9IGxpbmUuaW5kZXhPZihcIlxcclwiKTtcbiAgICAgIGlmIChydCAhPSAtMSkge1xuICAgICAgICByZXN1bHQucHVzaChsaW5lLnNsaWNlKDAsIHJ0KSk7XG4gICAgICAgIHBvcyArPSBydCArIDE7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXN1bHQucHVzaChsaW5lKTtcbiAgICAgICAgcG9zID0gbmwgKyAxO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9IDogZnVuY3Rpb24oc3RyaW5nKXtyZXR1cm4gc3RyaW5nLnNwbGl0KC9cXHJcXG4/fFxcbi8pO307XG5cbiAgdmFyIGhhc1NlbGVjdGlvbiA9IHdpbmRvdy5nZXRTZWxlY3Rpb24gPyBmdW5jdGlvbih0ZSkge1xuICAgIHRyeSB7IHJldHVybiB0ZS5zZWxlY3Rpb25TdGFydCAhPSB0ZS5zZWxlY3Rpb25FbmQ7IH1cbiAgICBjYXRjaChlKSB7IHJldHVybiBmYWxzZTsgfVxuICB9IDogZnVuY3Rpb24odGUpIHtcbiAgICB0cnkge3ZhciByYW5nZSA9IHRlLm93bmVyRG9jdW1lbnQuc2VsZWN0aW9uLmNyZWF0ZVJhbmdlKCk7fVxuICAgIGNhdGNoKGUpIHt9XG4gICAgaWYgKCFyYW5nZSB8fCByYW5nZS5wYXJlbnRFbGVtZW50KCkgIT0gdGUpIHJldHVybiBmYWxzZTtcbiAgICByZXR1cm4gcmFuZ2UuY29tcGFyZUVuZFBvaW50cyhcIlN0YXJ0VG9FbmRcIiwgcmFuZ2UpICE9IDA7XG4gIH07XG5cbiAgdmFyIGhhc0NvcHlFdmVudCA9IChmdW5jdGlvbigpIHtcbiAgICB2YXIgZSA9IGVsdChcImRpdlwiKTtcbiAgICBpZiAoXCJvbmNvcHlcIiBpbiBlKSByZXR1cm4gdHJ1ZTtcbiAgICBlLnNldEF0dHJpYnV0ZShcIm9uY29weVwiLCBcInJldHVybjtcIik7XG4gICAgcmV0dXJuIHR5cGVvZiBlLm9uY29weSA9PSBcImZ1bmN0aW9uXCI7XG4gIH0pKCk7XG5cbiAgdmFyIGJhZFpvb21lZFJlY3RzID0gbnVsbDtcbiAgZnVuY3Rpb24gaGFzQmFkWm9vbWVkUmVjdHMobWVhc3VyZSkge1xuICAgIGlmIChiYWRab29tZWRSZWN0cyAhPSBudWxsKSByZXR1cm4gYmFkWm9vbWVkUmVjdHM7XG4gICAgdmFyIG5vZGUgPSByZW1vdmVDaGlsZHJlbkFuZEFkZChtZWFzdXJlLCBlbHQoXCJzcGFuXCIsIFwieFwiKSk7XG4gICAgdmFyIG5vcm1hbCA9IG5vZGUuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgdmFyIGZyb21SYW5nZSA9IHJhbmdlKG5vZGUsIDAsIDEpLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgIHJldHVybiBiYWRab29tZWRSZWN0cyA9IE1hdGguYWJzKG5vcm1hbC5sZWZ0IC0gZnJvbVJhbmdlLmxlZnQpID4gMTtcbiAgfVxuXG4gIC8vIEtFWSBOQU1FU1xuXG4gIHZhciBrZXlOYW1lcyA9IENvZGVNaXJyb3Iua2V5TmFtZXMgPSB7XG4gICAgMzogXCJFbnRlclwiLCA4OiBcIkJhY2tzcGFjZVwiLCA5OiBcIlRhYlwiLCAxMzogXCJFbnRlclwiLCAxNjogXCJTaGlmdFwiLCAxNzogXCJDdHJsXCIsIDE4OiBcIkFsdFwiLFxuICAgIDE5OiBcIlBhdXNlXCIsIDIwOiBcIkNhcHNMb2NrXCIsIDI3OiBcIkVzY1wiLCAzMjogXCJTcGFjZVwiLCAzMzogXCJQYWdlVXBcIiwgMzQ6IFwiUGFnZURvd25cIiwgMzU6IFwiRW5kXCIsXG4gICAgMzY6IFwiSG9tZVwiLCAzNzogXCJMZWZ0XCIsIDM4OiBcIlVwXCIsIDM5OiBcIlJpZ2h0XCIsIDQwOiBcIkRvd25cIiwgNDQ6IFwiUHJpbnRTY3JuXCIsIDQ1OiBcIkluc2VydFwiLFxuICAgIDQ2OiBcIkRlbGV0ZVwiLCA1OTogXCI7XCIsIDYxOiBcIj1cIiwgOTE6IFwiTW9kXCIsIDkyOiBcIk1vZFwiLCA5MzogXCJNb2RcIixcbiAgICAxMDY6IFwiKlwiLCAxMDc6IFwiPVwiLCAxMDk6IFwiLVwiLCAxMTA6IFwiLlwiLCAxMTE6IFwiL1wiLCAxMjc6IFwiRGVsZXRlXCIsXG4gICAgMTczOiBcIi1cIiwgMTg2OiBcIjtcIiwgMTg3OiBcIj1cIiwgMTg4OiBcIixcIiwgMTg5OiBcIi1cIiwgMTkwOiBcIi5cIiwgMTkxOiBcIi9cIiwgMTkyOiBcImBcIiwgMjE5OiBcIltcIiwgMjIwOiBcIlxcXFxcIixcbiAgICAyMjE6IFwiXVwiLCAyMjI6IFwiJ1wiLCA2MzIzMjogXCJVcFwiLCA2MzIzMzogXCJEb3duXCIsIDYzMjM0OiBcIkxlZnRcIiwgNjMyMzU6IFwiUmlnaHRcIiwgNjMyNzI6IFwiRGVsZXRlXCIsXG4gICAgNjMyNzM6IFwiSG9tZVwiLCA2MzI3NTogXCJFbmRcIiwgNjMyNzY6IFwiUGFnZVVwXCIsIDYzMjc3OiBcIlBhZ2VEb3duXCIsIDYzMzAyOiBcIkluc2VydFwiXG4gIH07XG4gIChmdW5jdGlvbigpIHtcbiAgICAvLyBOdW1iZXIga2V5c1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgMTA7IGkrKykga2V5TmFtZXNbaSArIDQ4XSA9IGtleU5hbWVzW2kgKyA5Nl0gPSBTdHJpbmcoaSk7XG4gICAgLy8gQWxwaGFiZXRpYyBrZXlzXG4gICAgZm9yICh2YXIgaSA9IDY1OyBpIDw9IDkwOyBpKyspIGtleU5hbWVzW2ldID0gU3RyaW5nLmZyb21DaGFyQ29kZShpKTtcbiAgICAvLyBGdW5jdGlvbiBrZXlzXG4gICAgZm9yICh2YXIgaSA9IDE7IGkgPD0gMTI7IGkrKykga2V5TmFtZXNbaSArIDExMV0gPSBrZXlOYW1lc1tpICsgNjMyMzVdID0gXCJGXCIgKyBpO1xuICB9KSgpO1xuXG4gIC8vIEJJREkgSEVMUEVSU1xuXG4gIGZ1bmN0aW9uIGl0ZXJhdGVCaWRpU2VjdGlvbnMob3JkZXIsIGZyb20sIHRvLCBmKSB7XG4gICAgaWYgKCFvcmRlcikgcmV0dXJuIGYoZnJvbSwgdG8sIFwibHRyXCIpO1xuICAgIHZhciBmb3VuZCA9IGZhbHNlO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb3JkZXIubGVuZ3RoOyArK2kpIHtcbiAgICAgIHZhciBwYXJ0ID0gb3JkZXJbaV07XG4gICAgICBpZiAocGFydC5mcm9tIDwgdG8gJiYgcGFydC50byA+IGZyb20gfHwgZnJvbSA9PSB0byAmJiBwYXJ0LnRvID09IGZyb20pIHtcbiAgICAgICAgZihNYXRoLm1heChwYXJ0LmZyb20sIGZyb20pLCBNYXRoLm1pbihwYXJ0LnRvLCB0byksIHBhcnQubGV2ZWwgPT0gMSA/IFwicnRsXCIgOiBcImx0clwiKTtcbiAgICAgICAgZm91bmQgPSB0cnVlO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoIWZvdW5kKSBmKGZyb20sIHRvLCBcImx0clwiKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGJpZGlMZWZ0KHBhcnQpIHsgcmV0dXJuIHBhcnQubGV2ZWwgJSAyID8gcGFydC50byA6IHBhcnQuZnJvbTsgfVxuICBmdW5jdGlvbiBiaWRpUmlnaHQocGFydCkgeyByZXR1cm4gcGFydC5sZXZlbCAlIDIgPyBwYXJ0LmZyb20gOiBwYXJ0LnRvOyB9XG5cbiAgZnVuY3Rpb24gbGluZUxlZnQobGluZSkgeyB2YXIgb3JkZXIgPSBnZXRPcmRlcihsaW5lKTsgcmV0dXJuIG9yZGVyID8gYmlkaUxlZnQob3JkZXJbMF0pIDogMDsgfVxuICBmdW5jdGlvbiBsaW5lUmlnaHQobGluZSkge1xuICAgIHZhciBvcmRlciA9IGdldE9yZGVyKGxpbmUpO1xuICAgIGlmICghb3JkZXIpIHJldHVybiBsaW5lLnRleHQubGVuZ3RoO1xuICAgIHJldHVybiBiaWRpUmlnaHQobHN0KG9yZGVyKSk7XG4gIH1cblxuICBmdW5jdGlvbiBsaW5lU3RhcnQoY20sIGxpbmVOKSB7XG4gICAgdmFyIGxpbmUgPSBnZXRMaW5lKGNtLmRvYywgbGluZU4pO1xuICAgIHZhciB2aXN1YWwgPSB2aXN1YWxMaW5lKGxpbmUpO1xuICAgIGlmICh2aXN1YWwgIT0gbGluZSkgbGluZU4gPSBsaW5lTm8odmlzdWFsKTtcbiAgICB2YXIgb3JkZXIgPSBnZXRPcmRlcih2aXN1YWwpO1xuICAgIHZhciBjaCA9ICFvcmRlciA/IDAgOiBvcmRlclswXS5sZXZlbCAlIDIgPyBsaW5lUmlnaHQodmlzdWFsKSA6IGxpbmVMZWZ0KHZpc3VhbCk7XG4gICAgcmV0dXJuIFBvcyhsaW5lTiwgY2gpO1xuICB9XG4gIGZ1bmN0aW9uIGxpbmVFbmQoY20sIGxpbmVOKSB7XG4gICAgdmFyIG1lcmdlZCwgbGluZSA9IGdldExpbmUoY20uZG9jLCBsaW5lTik7XG4gICAgd2hpbGUgKG1lcmdlZCA9IGNvbGxhcHNlZFNwYW5BdEVuZChsaW5lKSkge1xuICAgICAgbGluZSA9IG1lcmdlZC5maW5kKDEsIHRydWUpLmxpbmU7XG4gICAgICBsaW5lTiA9IG51bGw7XG4gICAgfVxuICAgIHZhciBvcmRlciA9IGdldE9yZGVyKGxpbmUpO1xuICAgIHZhciBjaCA9ICFvcmRlciA/IGxpbmUudGV4dC5sZW5ndGggOiBvcmRlclswXS5sZXZlbCAlIDIgPyBsaW5lTGVmdChsaW5lKSA6IGxpbmVSaWdodChsaW5lKTtcbiAgICByZXR1cm4gUG9zKGxpbmVOID09IG51bGwgPyBsaW5lTm8obGluZSkgOiBsaW5lTiwgY2gpO1xuICB9XG4gIGZ1bmN0aW9uIGxpbmVTdGFydFNtYXJ0KGNtLCBwb3MpIHtcbiAgICB2YXIgc3RhcnQgPSBsaW5lU3RhcnQoY20sIHBvcy5saW5lKTtcbiAgICB2YXIgbGluZSA9IGdldExpbmUoY20uZG9jLCBzdGFydC5saW5lKTtcbiAgICB2YXIgb3JkZXIgPSBnZXRPcmRlcihsaW5lKTtcbiAgICBpZiAoIW9yZGVyIHx8IG9yZGVyWzBdLmxldmVsID09IDApIHtcbiAgICAgIHZhciBmaXJzdE5vbldTID0gTWF0aC5tYXgoMCwgbGluZS50ZXh0LnNlYXJjaCgvXFxTLykpO1xuICAgICAgdmFyIGluV1MgPSBwb3MubGluZSA9PSBzdGFydC5saW5lICYmIHBvcy5jaCA8PSBmaXJzdE5vbldTICYmIHBvcy5jaDtcbiAgICAgIHJldHVybiBQb3Moc3RhcnQubGluZSwgaW5XUyA/IDAgOiBmaXJzdE5vbldTKTtcbiAgICB9XG4gICAgcmV0dXJuIHN0YXJ0O1xuICB9XG5cbiAgZnVuY3Rpb24gY29tcGFyZUJpZGlMZXZlbChvcmRlciwgYSwgYikge1xuICAgIHZhciBsaW5lZGlyID0gb3JkZXJbMF0ubGV2ZWw7XG4gICAgaWYgKGEgPT0gbGluZWRpcikgcmV0dXJuIHRydWU7XG4gICAgaWYgKGIgPT0gbGluZWRpcikgcmV0dXJuIGZhbHNlO1xuICAgIHJldHVybiBhIDwgYjtcbiAgfVxuICB2YXIgYmlkaU90aGVyO1xuICBmdW5jdGlvbiBnZXRCaWRpUGFydEF0KG9yZGVyLCBwb3MpIHtcbiAgICBiaWRpT3RoZXIgPSBudWxsO1xuICAgIGZvciAodmFyIGkgPSAwLCBmb3VuZDsgaSA8IG9yZGVyLmxlbmd0aDsgKytpKSB7XG4gICAgICB2YXIgY3VyID0gb3JkZXJbaV07XG4gICAgICBpZiAoY3VyLmZyb20gPCBwb3MgJiYgY3VyLnRvID4gcG9zKSByZXR1cm4gaTtcbiAgICAgIGlmICgoY3VyLmZyb20gPT0gcG9zIHx8IGN1ci50byA9PSBwb3MpKSB7XG4gICAgICAgIGlmIChmb3VuZCA9PSBudWxsKSB7XG4gICAgICAgICAgZm91bmQgPSBpO1xuICAgICAgICB9IGVsc2UgaWYgKGNvbXBhcmVCaWRpTGV2ZWwob3JkZXIsIGN1ci5sZXZlbCwgb3JkZXJbZm91bmRdLmxldmVsKSkge1xuICAgICAgICAgIGlmIChjdXIuZnJvbSAhPSBjdXIudG8pIGJpZGlPdGhlciA9IGZvdW5kO1xuICAgICAgICAgIHJldHVybiBpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGlmIChjdXIuZnJvbSAhPSBjdXIudG8pIGJpZGlPdGhlciA9IGk7XG4gICAgICAgICAgcmV0dXJuIGZvdW5kO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBmb3VuZDtcbiAgfVxuXG4gIGZ1bmN0aW9uIG1vdmVJbkxpbmUobGluZSwgcG9zLCBkaXIsIGJ5VW5pdCkge1xuICAgIGlmICghYnlVbml0KSByZXR1cm4gcG9zICsgZGlyO1xuICAgIGRvIHBvcyArPSBkaXI7XG4gICAgd2hpbGUgKHBvcyA+IDAgJiYgaXNFeHRlbmRpbmdDaGFyKGxpbmUudGV4dC5jaGFyQXQocG9zKSkpO1xuICAgIHJldHVybiBwb3M7XG4gIH1cblxuICAvLyBUaGlzIGlzIG5lZWRlZCBpbiBvcmRlciB0byBtb3ZlICd2aXN1YWxseScgdGhyb3VnaCBiaS1kaXJlY3Rpb25hbFxuICAvLyB0ZXh0IC0tIGkuZS4sIHByZXNzaW5nIGxlZnQgc2hvdWxkIG1ha2UgdGhlIGN1cnNvciBnbyBsZWZ0LCBldmVuXG4gIC8vIHdoZW4gaW4gUlRMIHRleHQuIFRoZSB0cmlja3kgcGFydCBpcyB0aGUgJ2p1bXBzJywgd2hlcmUgUlRMIGFuZFxuICAvLyBMVFIgdGV4dCB0b3VjaCBlYWNoIG90aGVyLiBUaGlzIG9mdGVuIHJlcXVpcmVzIHRoZSBjdXJzb3Igb2Zmc2V0XG4gIC8vIHRvIG1vdmUgbW9yZSB0aGFuIG9uZSB1bml0LCBpbiBvcmRlciB0byB2aXN1YWxseSBtb3ZlIG9uZSB1bml0LlxuICBmdW5jdGlvbiBtb3ZlVmlzdWFsbHkobGluZSwgc3RhcnQsIGRpciwgYnlVbml0KSB7XG4gICAgdmFyIGJpZGkgPSBnZXRPcmRlcihsaW5lKTtcbiAgICBpZiAoIWJpZGkpIHJldHVybiBtb3ZlTG9naWNhbGx5KGxpbmUsIHN0YXJ0LCBkaXIsIGJ5VW5pdCk7XG4gICAgdmFyIHBvcyA9IGdldEJpZGlQYXJ0QXQoYmlkaSwgc3RhcnQpLCBwYXJ0ID0gYmlkaVtwb3NdO1xuICAgIHZhciB0YXJnZXQgPSBtb3ZlSW5MaW5lKGxpbmUsIHN0YXJ0LCBwYXJ0LmxldmVsICUgMiA/IC1kaXIgOiBkaXIsIGJ5VW5pdCk7XG5cbiAgICBmb3IgKDs7KSB7XG4gICAgICBpZiAodGFyZ2V0ID4gcGFydC5mcm9tICYmIHRhcmdldCA8IHBhcnQudG8pIHJldHVybiB0YXJnZXQ7XG4gICAgICBpZiAodGFyZ2V0ID09IHBhcnQuZnJvbSB8fCB0YXJnZXQgPT0gcGFydC50bykge1xuICAgICAgICBpZiAoZ2V0QmlkaVBhcnRBdChiaWRpLCB0YXJnZXQpID09IHBvcykgcmV0dXJuIHRhcmdldDtcbiAgICAgICAgcGFydCA9IGJpZGlbcG9zICs9IGRpcl07XG4gICAgICAgIHJldHVybiAoZGlyID4gMCkgPT0gcGFydC5sZXZlbCAlIDIgPyBwYXJ0LnRvIDogcGFydC5mcm9tO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcGFydCA9IGJpZGlbcG9zICs9IGRpcl07XG4gICAgICAgIGlmICghcGFydCkgcmV0dXJuIG51bGw7XG4gICAgICAgIGlmICgoZGlyID4gMCkgPT0gcGFydC5sZXZlbCAlIDIpXG4gICAgICAgICAgdGFyZ2V0ID0gbW92ZUluTGluZShsaW5lLCBwYXJ0LnRvLCAtMSwgYnlVbml0KTtcbiAgICAgICAgZWxzZVxuICAgICAgICAgIHRhcmdldCA9IG1vdmVJbkxpbmUobGluZSwgcGFydC5mcm9tLCAxLCBieVVuaXQpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIG1vdmVMb2dpY2FsbHkobGluZSwgc3RhcnQsIGRpciwgYnlVbml0KSB7XG4gICAgdmFyIHRhcmdldCA9IHN0YXJ0ICsgZGlyO1xuICAgIGlmIChieVVuaXQpIHdoaWxlICh0YXJnZXQgPiAwICYmIGlzRXh0ZW5kaW5nQ2hhcihsaW5lLnRleHQuY2hhckF0KHRhcmdldCkpKSB0YXJnZXQgKz0gZGlyO1xuICAgIHJldHVybiB0YXJnZXQgPCAwIHx8IHRhcmdldCA+IGxpbmUudGV4dC5sZW5ndGggPyBudWxsIDogdGFyZ2V0O1xuICB9XG5cbiAgLy8gQmlkaXJlY3Rpb25hbCBvcmRlcmluZyBhbGdvcml0aG1cbiAgLy8gU2VlIGh0dHA6Ly91bmljb2RlLm9yZy9yZXBvcnRzL3RyOS90cjktMTMuaHRtbCBmb3IgdGhlIGFsZ29yaXRobVxuICAvLyB0aGF0IHRoaXMgKHBhcnRpYWxseSkgaW1wbGVtZW50cy5cblxuICAvLyBPbmUtY2hhciBjb2RlcyB1c2VkIGZvciBjaGFyYWN0ZXIgdHlwZXM6XG4gIC8vIEwgKEwpOiAgIExlZnQtdG8tUmlnaHRcbiAgLy8gUiAoUik6ICAgUmlnaHQtdG8tTGVmdFxuICAvLyByIChBTCk6ICBSaWdodC10by1MZWZ0IEFyYWJpY1xuICAvLyAxIChFTik6ICBFdXJvcGVhbiBOdW1iZXJcbiAgLy8gKyAoRVMpOiAgRXVyb3BlYW4gTnVtYmVyIFNlcGFyYXRvclxuICAvLyAlIChFVCk6ICBFdXJvcGVhbiBOdW1iZXIgVGVybWluYXRvclxuICAvLyBuIChBTik6ICBBcmFiaWMgTnVtYmVyXG4gIC8vICwgKENTKTogIENvbW1vbiBOdW1iZXIgU2VwYXJhdG9yXG4gIC8vIG0gKE5TTSk6IE5vbi1TcGFjaW5nIE1hcmtcbiAgLy8gYiAoQk4pOiAgQm91bmRhcnkgTmV1dHJhbFxuICAvLyBzIChCKTogICBQYXJhZ3JhcGggU2VwYXJhdG9yXG4gIC8vIHQgKFMpOiAgIFNlZ21lbnQgU2VwYXJhdG9yXG4gIC8vIHcgKFdTKTogIFdoaXRlc3BhY2VcbiAgLy8gTiAoT04pOiAgT3RoZXIgTmV1dHJhbHNcblxuICAvLyBSZXR1cm5zIG51bGwgaWYgY2hhcmFjdGVycyBhcmUgb3JkZXJlZCBhcyB0aGV5IGFwcGVhclxuICAvLyAobGVmdC10by1yaWdodCksIG9yIGFuIGFycmF5IG9mIHNlY3Rpb25zICh7ZnJvbSwgdG8sIGxldmVsfVxuICAvLyBvYmplY3RzKSBpbiB0aGUgb3JkZXIgaW4gd2hpY2ggdGhleSBvY2N1ciB2aXN1YWxseS5cbiAgdmFyIGJpZGlPcmRlcmluZyA9IChmdW5jdGlvbigpIHtcbiAgICAvLyBDaGFyYWN0ZXIgdHlwZXMgZm9yIGNvZGVwb2ludHMgMCB0byAweGZmXG4gICAgdmFyIGxvd1R5cGVzID0gXCJiYmJiYmJiYmJ0c3R3c2JiYmJiYmJiYmJiYmJic3NzdHdOTiUlJU5OTk5OTixOLE4xMTExMTExMTExTk5OTk5OTkxMTExMTExMTExMTExMTExMTExMTExMTExMTk5OTk5OTExMTExMTExMTExMTExMTExMTExMTExMTExOTk5OYmJiYmJic2JiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiLE4lJSUlTk5OTkxOTk5OTiUlMTFOTE5OTjFMTk5OTk5MTExMTExMTExMTExMTExMTExMTExMTE5MTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTlwiO1xuICAgIC8vIENoYXJhY3RlciB0eXBlcyBmb3IgY29kZXBvaW50cyAweDYwMCB0byAweDZmZlxuICAgIHZhciBhcmFiaWNUeXBlcyA9IFwicnJycnJycnJycnJyLHJOTm1tbW1tbXJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJybW1tbW1tbW1tbW1tbW1ycnJycnJybm5ubm5ubm5ubiVubnJycm1ycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycm1tbW1tbW1tbW1tbW1tbW1tbW1ObW1tbVwiO1xuICAgIGZ1bmN0aW9uIGNoYXJUeXBlKGNvZGUpIHtcbiAgICAgIGlmIChjb2RlIDw9IDB4ZjcpIHJldHVybiBsb3dUeXBlcy5jaGFyQXQoY29kZSk7XG4gICAgICBlbHNlIGlmICgweDU5MCA8PSBjb2RlICYmIGNvZGUgPD0gMHg1ZjQpIHJldHVybiBcIlJcIjtcbiAgICAgIGVsc2UgaWYgKDB4NjAwIDw9IGNvZGUgJiYgY29kZSA8PSAweDZlZCkgcmV0dXJuIGFyYWJpY1R5cGVzLmNoYXJBdChjb2RlIC0gMHg2MDApO1xuICAgICAgZWxzZSBpZiAoMHg2ZWUgPD0gY29kZSAmJiBjb2RlIDw9IDB4OGFjKSByZXR1cm4gXCJyXCI7XG4gICAgICBlbHNlIGlmICgweDIwMDAgPD0gY29kZSAmJiBjb2RlIDw9IDB4MjAwYikgcmV0dXJuIFwid1wiO1xuICAgICAgZWxzZSBpZiAoY29kZSA9PSAweDIwMGMpIHJldHVybiBcImJcIjtcbiAgICAgIGVsc2UgcmV0dXJuIFwiTFwiO1xuICAgIH1cblxuICAgIHZhciBiaWRpUkUgPSAvW1xcdTA1OTAtXFx1MDVmNFxcdTA2MDAtXFx1MDZmZlxcdTA3MDAtXFx1MDhhY10vO1xuICAgIHZhciBpc05ldXRyYWwgPSAvW3N0d05dLywgaXNTdHJvbmcgPSAvW0xScl0vLCBjb3VudHNBc0xlZnQgPSAvW0xiMW5dLywgY291bnRzQXNOdW0gPSAvWzFuXS87XG4gICAgLy8gQnJvd3NlcnMgc2VlbSB0byBhbHdheXMgdHJlYXQgdGhlIGJvdW5kYXJpZXMgb2YgYmxvY2sgZWxlbWVudHMgYXMgYmVpbmcgTC5cbiAgICB2YXIgb3V0ZXJUeXBlID0gXCJMXCI7XG5cbiAgICBmdW5jdGlvbiBCaWRpU3BhbihsZXZlbCwgZnJvbSwgdG8pIHtcbiAgICAgIHRoaXMubGV2ZWwgPSBsZXZlbDtcbiAgICAgIHRoaXMuZnJvbSA9IGZyb207IHRoaXMudG8gPSB0bztcbiAgICB9XG5cbiAgICByZXR1cm4gZnVuY3Rpb24oc3RyKSB7XG4gICAgICBpZiAoIWJpZGlSRS50ZXN0KHN0cikpIHJldHVybiBmYWxzZTtcbiAgICAgIHZhciBsZW4gPSBzdHIubGVuZ3RoLCB0eXBlcyA9IFtdO1xuICAgICAgZm9yICh2YXIgaSA9IDAsIHR5cGU7IGkgPCBsZW47ICsraSlcbiAgICAgICAgdHlwZXMucHVzaCh0eXBlID0gY2hhclR5cGUoc3RyLmNoYXJDb2RlQXQoaSkpKTtcblxuICAgICAgLy8gVzEuIEV4YW1pbmUgZWFjaCBub24tc3BhY2luZyBtYXJrIChOU00pIGluIHRoZSBsZXZlbCBydW4sIGFuZFxuICAgICAgLy8gY2hhbmdlIHRoZSB0eXBlIG9mIHRoZSBOU00gdG8gdGhlIHR5cGUgb2YgdGhlIHByZXZpb3VzXG4gICAgICAvLyBjaGFyYWN0ZXIuIElmIHRoZSBOU00gaXMgYXQgdGhlIHN0YXJ0IG9mIHRoZSBsZXZlbCBydW4sIGl0IHdpbGxcbiAgICAgIC8vIGdldCB0aGUgdHlwZSBvZiBzb3IuXG4gICAgICBmb3IgKHZhciBpID0gMCwgcHJldiA9IG91dGVyVHlwZTsgaSA8IGxlbjsgKytpKSB7XG4gICAgICAgIHZhciB0eXBlID0gdHlwZXNbaV07XG4gICAgICAgIGlmICh0eXBlID09IFwibVwiKSB0eXBlc1tpXSA9IHByZXY7XG4gICAgICAgIGVsc2UgcHJldiA9IHR5cGU7XG4gICAgICB9XG5cbiAgICAgIC8vIFcyLiBTZWFyY2ggYmFja3dhcmRzIGZyb20gZWFjaCBpbnN0YW5jZSBvZiBhIEV1cm9wZWFuIG51bWJlclxuICAgICAgLy8gdW50aWwgdGhlIGZpcnN0IHN0cm9uZyB0eXBlIChSLCBMLCBBTCwgb3Igc29yKSBpcyBmb3VuZC4gSWYgYW5cbiAgICAgIC8vIEFMIGlzIGZvdW5kLCBjaGFuZ2UgdGhlIHR5cGUgb2YgdGhlIEV1cm9wZWFuIG51bWJlciB0byBBcmFiaWNcbiAgICAgIC8vIG51bWJlci5cbiAgICAgIC8vIFczLiBDaGFuZ2UgYWxsIEFMcyB0byBSLlxuICAgICAgZm9yICh2YXIgaSA9IDAsIGN1ciA9IG91dGVyVHlwZTsgaSA8IGxlbjsgKytpKSB7XG4gICAgICAgIHZhciB0eXBlID0gdHlwZXNbaV07XG4gICAgICAgIGlmICh0eXBlID09IFwiMVwiICYmIGN1ciA9PSBcInJcIikgdHlwZXNbaV0gPSBcIm5cIjtcbiAgICAgICAgZWxzZSBpZiAoaXNTdHJvbmcudGVzdCh0eXBlKSkgeyBjdXIgPSB0eXBlOyBpZiAodHlwZSA9PSBcInJcIikgdHlwZXNbaV0gPSBcIlJcIjsgfVxuICAgICAgfVxuXG4gICAgICAvLyBXNC4gQSBzaW5nbGUgRXVyb3BlYW4gc2VwYXJhdG9yIGJldHdlZW4gdHdvIEV1cm9wZWFuIG51bWJlcnNcbiAgICAgIC8vIGNoYW5nZXMgdG8gYSBFdXJvcGVhbiBudW1iZXIuIEEgc2luZ2xlIGNvbW1vbiBzZXBhcmF0b3IgYmV0d2VlblxuICAgICAgLy8gdHdvIG51bWJlcnMgb2YgdGhlIHNhbWUgdHlwZSBjaGFuZ2VzIHRvIHRoYXQgdHlwZS5cbiAgICAgIGZvciAodmFyIGkgPSAxLCBwcmV2ID0gdHlwZXNbMF07IGkgPCBsZW4gLSAxOyArK2kpIHtcbiAgICAgICAgdmFyIHR5cGUgPSB0eXBlc1tpXTtcbiAgICAgICAgaWYgKHR5cGUgPT0gXCIrXCIgJiYgcHJldiA9PSBcIjFcIiAmJiB0eXBlc1tpKzFdID09IFwiMVwiKSB0eXBlc1tpXSA9IFwiMVwiO1xuICAgICAgICBlbHNlIGlmICh0eXBlID09IFwiLFwiICYmIHByZXYgPT0gdHlwZXNbaSsxXSAmJlxuICAgICAgICAgICAgICAgICAocHJldiA9PSBcIjFcIiB8fCBwcmV2ID09IFwiblwiKSkgdHlwZXNbaV0gPSBwcmV2O1xuICAgICAgICBwcmV2ID0gdHlwZTtcbiAgICAgIH1cblxuICAgICAgLy8gVzUuIEEgc2VxdWVuY2Ugb2YgRXVyb3BlYW4gdGVybWluYXRvcnMgYWRqYWNlbnQgdG8gRXVyb3BlYW5cbiAgICAgIC8vIG51bWJlcnMgY2hhbmdlcyB0byBhbGwgRXVyb3BlYW4gbnVtYmVycy5cbiAgICAgIC8vIFc2LiBPdGhlcndpc2UsIHNlcGFyYXRvcnMgYW5kIHRlcm1pbmF0b3JzIGNoYW5nZSB0byBPdGhlclxuICAgICAgLy8gTmV1dHJhbC5cbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuOyArK2kpIHtcbiAgICAgICAgdmFyIHR5cGUgPSB0eXBlc1tpXTtcbiAgICAgICAgaWYgKHR5cGUgPT0gXCIsXCIpIHR5cGVzW2ldID0gXCJOXCI7XG4gICAgICAgIGVsc2UgaWYgKHR5cGUgPT0gXCIlXCIpIHtcbiAgICAgICAgICBmb3IgKHZhciBlbmQgPSBpICsgMTsgZW5kIDwgbGVuICYmIHR5cGVzW2VuZF0gPT0gXCIlXCI7ICsrZW5kKSB7fVxuICAgICAgICAgIHZhciByZXBsYWNlID0gKGkgJiYgdHlwZXNbaS0xXSA9PSBcIiFcIikgfHwgKGVuZCA8IGxlbiAmJiB0eXBlc1tlbmRdID09IFwiMVwiKSA/IFwiMVwiIDogXCJOXCI7XG4gICAgICAgICAgZm9yICh2YXIgaiA9IGk7IGogPCBlbmQ7ICsraikgdHlwZXNbal0gPSByZXBsYWNlO1xuICAgICAgICAgIGkgPSBlbmQgLSAxO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIFc3LiBTZWFyY2ggYmFja3dhcmRzIGZyb20gZWFjaCBpbnN0YW5jZSBvZiBhIEV1cm9wZWFuIG51bWJlclxuICAgICAgLy8gdW50aWwgdGhlIGZpcnN0IHN0cm9uZyB0eXBlIChSLCBMLCBvciBzb3IpIGlzIGZvdW5kLiBJZiBhbiBMIGlzXG4gICAgICAvLyBmb3VuZCwgdGhlbiBjaGFuZ2UgdGhlIHR5cGUgb2YgdGhlIEV1cm9wZWFuIG51bWJlciB0byBMLlxuICAgICAgZm9yICh2YXIgaSA9IDAsIGN1ciA9IG91dGVyVHlwZTsgaSA8IGxlbjsgKytpKSB7XG4gICAgICAgIHZhciB0eXBlID0gdHlwZXNbaV07XG4gICAgICAgIGlmIChjdXIgPT0gXCJMXCIgJiYgdHlwZSA9PSBcIjFcIikgdHlwZXNbaV0gPSBcIkxcIjtcbiAgICAgICAgZWxzZSBpZiAoaXNTdHJvbmcudGVzdCh0eXBlKSkgY3VyID0gdHlwZTtcbiAgICAgIH1cblxuICAgICAgLy8gTjEuIEEgc2VxdWVuY2Ugb2YgbmV1dHJhbHMgdGFrZXMgdGhlIGRpcmVjdGlvbiBvZiB0aGVcbiAgICAgIC8vIHN1cnJvdW5kaW5nIHN0cm9uZyB0ZXh0IGlmIHRoZSB0ZXh0IG9uIGJvdGggc2lkZXMgaGFzIHRoZSBzYW1lXG4gICAgICAvLyBkaXJlY3Rpb24uIEV1cm9wZWFuIGFuZCBBcmFiaWMgbnVtYmVycyBhY3QgYXMgaWYgdGhleSB3ZXJlIFIgaW5cbiAgICAgIC8vIHRlcm1zIG9mIHRoZWlyIGluZmx1ZW5jZSBvbiBuZXV0cmFscy4gU3RhcnQtb2YtbGV2ZWwtcnVuIChzb3IpXG4gICAgICAvLyBhbmQgZW5kLW9mLWxldmVsLXJ1biAoZW9yKSBhcmUgdXNlZCBhdCBsZXZlbCBydW4gYm91bmRhcmllcy5cbiAgICAgIC8vIE4yLiBBbnkgcmVtYWluaW5nIG5ldXRyYWxzIHRha2UgdGhlIGVtYmVkZGluZyBkaXJlY3Rpb24uXG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgKytpKSB7XG4gICAgICAgIGlmIChpc05ldXRyYWwudGVzdCh0eXBlc1tpXSkpIHtcbiAgICAgICAgICBmb3IgKHZhciBlbmQgPSBpICsgMTsgZW5kIDwgbGVuICYmIGlzTmV1dHJhbC50ZXN0KHR5cGVzW2VuZF0pOyArK2VuZCkge31cbiAgICAgICAgICB2YXIgYmVmb3JlID0gKGkgPyB0eXBlc1tpLTFdIDogb3V0ZXJUeXBlKSA9PSBcIkxcIjtcbiAgICAgICAgICB2YXIgYWZ0ZXIgPSAoZW5kIDwgbGVuID8gdHlwZXNbZW5kXSA6IG91dGVyVHlwZSkgPT0gXCJMXCI7XG4gICAgICAgICAgdmFyIHJlcGxhY2UgPSBiZWZvcmUgfHwgYWZ0ZXIgPyBcIkxcIiA6IFwiUlwiO1xuICAgICAgICAgIGZvciAodmFyIGogPSBpOyBqIDwgZW5kOyArK2opIHR5cGVzW2pdID0gcmVwbGFjZTtcbiAgICAgICAgICBpID0gZW5kIC0gMTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBIZXJlIHdlIGRlcGFydCBmcm9tIHRoZSBkb2N1bWVudGVkIGFsZ29yaXRobSwgaW4gb3JkZXIgdG8gYXZvaWRcbiAgICAgIC8vIGJ1aWxkaW5nIHVwIGFuIGFjdHVhbCBsZXZlbHMgYXJyYXkuIFNpbmNlIHRoZXJlIGFyZSBvbmx5IHRocmVlXG4gICAgICAvLyBsZXZlbHMgKDAsIDEsIDIpIGluIGFuIGltcGxlbWVudGF0aW9uIHRoYXQgZG9lc24ndCB0YWtlXG4gICAgICAvLyBleHBsaWNpdCBlbWJlZGRpbmcgaW50byBhY2NvdW50LCB3ZSBjYW4gYnVpbGQgdXAgdGhlIG9yZGVyIG9uXG4gICAgICAvLyB0aGUgZmx5LCB3aXRob3V0IGZvbGxvd2luZyB0aGUgbGV2ZWwtYmFzZWQgYWxnb3JpdGhtLlxuICAgICAgdmFyIG9yZGVyID0gW10sIG07XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjspIHtcbiAgICAgICAgaWYgKGNvdW50c0FzTGVmdC50ZXN0KHR5cGVzW2ldKSkge1xuICAgICAgICAgIHZhciBzdGFydCA9IGk7XG4gICAgICAgICAgZm9yICgrK2k7IGkgPCBsZW4gJiYgY291bnRzQXNMZWZ0LnRlc3QodHlwZXNbaV0pOyArK2kpIHt9XG4gICAgICAgICAgb3JkZXIucHVzaChuZXcgQmlkaVNwYW4oMCwgc3RhcnQsIGkpKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB2YXIgcG9zID0gaSwgYXQgPSBvcmRlci5sZW5ndGg7XG4gICAgICAgICAgZm9yICgrK2k7IGkgPCBsZW4gJiYgdHlwZXNbaV0gIT0gXCJMXCI7ICsraSkge31cbiAgICAgICAgICBmb3IgKHZhciBqID0gcG9zOyBqIDwgaTspIHtcbiAgICAgICAgICAgIGlmIChjb3VudHNBc051bS50ZXN0KHR5cGVzW2pdKSkge1xuICAgICAgICAgICAgICBpZiAocG9zIDwgaikgb3JkZXIuc3BsaWNlKGF0LCAwLCBuZXcgQmlkaVNwYW4oMSwgcG9zLCBqKSk7XG4gICAgICAgICAgICAgIHZhciBuc3RhcnQgPSBqO1xuICAgICAgICAgICAgICBmb3IgKCsrajsgaiA8IGkgJiYgY291bnRzQXNOdW0udGVzdCh0eXBlc1tqXSk7ICsraikge31cbiAgICAgICAgICAgICAgb3JkZXIuc3BsaWNlKGF0LCAwLCBuZXcgQmlkaVNwYW4oMiwgbnN0YXJ0LCBqKSk7XG4gICAgICAgICAgICAgIHBvcyA9IGo7XG4gICAgICAgICAgICB9IGVsc2UgKytqO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAocG9zIDwgaSkgb3JkZXIuc3BsaWNlKGF0LCAwLCBuZXcgQmlkaVNwYW4oMSwgcG9zLCBpKSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmIChvcmRlclswXS5sZXZlbCA9PSAxICYmIChtID0gc3RyLm1hdGNoKC9eXFxzKy8pKSkge1xuICAgICAgICBvcmRlclswXS5mcm9tID0gbVswXS5sZW5ndGg7XG4gICAgICAgIG9yZGVyLnVuc2hpZnQobmV3IEJpZGlTcGFuKDAsIDAsIG1bMF0ubGVuZ3RoKSk7XG4gICAgICB9XG4gICAgICBpZiAobHN0KG9yZGVyKS5sZXZlbCA9PSAxICYmIChtID0gc3RyLm1hdGNoKC9cXHMrJC8pKSkge1xuICAgICAgICBsc3Qob3JkZXIpLnRvIC09IG1bMF0ubGVuZ3RoO1xuICAgICAgICBvcmRlci5wdXNoKG5ldyBCaWRpU3BhbigwLCBsZW4gLSBtWzBdLmxlbmd0aCwgbGVuKSk7XG4gICAgICB9XG4gICAgICBpZiAob3JkZXJbMF0ubGV2ZWwgPT0gMilcbiAgICAgICAgb3JkZXIudW5zaGlmdChuZXcgQmlkaVNwYW4oMSwgb3JkZXJbMF0udG8sIG9yZGVyWzBdLnRvKSk7XG4gICAgICBpZiAob3JkZXJbMF0ubGV2ZWwgIT0gbHN0KG9yZGVyKS5sZXZlbClcbiAgICAgICAgb3JkZXIucHVzaChuZXcgQmlkaVNwYW4ob3JkZXJbMF0ubGV2ZWwsIGxlbiwgbGVuKSk7XG5cbiAgICAgIHJldHVybiBvcmRlcjtcbiAgICB9O1xuICB9KSgpO1xuXG4gIC8vIFRIRSBFTkRcblxuICBDb2RlTWlycm9yLnZlcnNpb24gPSBcIjUuMTEuMFwiO1xuXG4gIHJldHVybiBDb2RlTWlycm9yO1xufSk7XG4iLCIvLyBDb2RlTWlycm9yLCBjb3B5cmlnaHQgKGMpIGJ5IE1hcmlqbiBIYXZlcmJla2UgYW5kIG90aGVyc1xuLy8gRGlzdHJpYnV0ZWQgdW5kZXIgYW4gTUlUIGxpY2Vuc2U6IGh0dHA6Ly9jb2RlbWlycm9yLm5ldC9MSUNFTlNFXG5cbi8qKlxuICogQXV0aG9yOiBIYW5zIEVuZ2VsXG4gKiBCcmFuY2hlZCBmcm9tIENvZGVNaXJyb3IncyBTY2hlbWUgbW9kZSAoYnkgS29oIFppIEhhbiwgYmFzZWQgb24gaW1wbGVtZW50YXRpb24gYnkgS29oIFppIENodW4pXG4gKi9cblxuKGZ1bmN0aW9uKG1vZCkge1xuICBpZiAodHlwZW9mIGV4cG9ydHMgPT0gXCJvYmplY3RcIiAmJiB0eXBlb2YgbW9kdWxlID09IFwib2JqZWN0XCIpIC8vIENvbW1vbkpTXG4gICAgbW9kKHJlcXVpcmUoXCIuLi8uLi9saWIvY29kZW1pcnJvclwiKSk7XG4gIGVsc2UgaWYgKHR5cGVvZiBkZWZpbmUgPT0gXCJmdW5jdGlvblwiICYmIGRlZmluZS5hbWQpIC8vIEFNRFxuICAgIGRlZmluZShbXCIuLi8uLi9saWIvY29kZW1pcnJvclwiXSwgbW9kKTtcbiAgZWxzZSAvLyBQbGFpbiBicm93c2VyIGVudlxuICAgIG1vZChDb2RlTWlycm9yKTtcbn0pKGZ1bmN0aW9uKENvZGVNaXJyb3IpIHtcblwidXNlIHN0cmljdFwiO1xuXG5Db2RlTWlycm9yLmRlZmluZU1vZGUoXCJjbG9qdXJlXCIsIGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgdmFyIEJVSUxUSU4gPSBcImJ1aWx0aW5cIiwgQ09NTUVOVCA9IFwiY29tbWVudFwiLCBTVFJJTkcgPSBcInN0cmluZ1wiLCBDSEFSQUNURVIgPSBcInN0cmluZy0yXCIsXG4gICAgICAgIEFUT00gPSBcImF0b21cIiwgTlVNQkVSID0gXCJudW1iZXJcIiwgQlJBQ0tFVCA9IFwiYnJhY2tldFwiLCBLRVlXT1JEID0gXCJrZXl3b3JkXCIsIFZBUiA9IFwidmFyaWFibGVcIjtcbiAgICB2YXIgSU5ERU5UX1dPUkRfU0tJUCA9IG9wdGlvbnMuaW5kZW50VW5pdCB8fCAyO1xuICAgIHZhciBOT1JNQUxfSU5ERU5UX1VOSVQgPSBvcHRpb25zLmluZGVudFVuaXQgfHwgMjtcblxuICAgIGZ1bmN0aW9uIG1ha2VLZXl3b3JkcyhzdHIpIHtcbiAgICAgICAgdmFyIG9iaiA9IHt9LCB3b3JkcyA9IHN0ci5zcGxpdChcIiBcIik7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgd29yZHMubGVuZ3RoOyArK2kpIG9ialt3b3Jkc1tpXV0gPSB0cnVlO1xuICAgICAgICByZXR1cm4gb2JqO1xuICAgIH1cblxuICAgIHZhciBhdG9tcyA9IG1ha2VLZXl3b3JkcyhcInRydWUgZmFsc2UgbmlsXCIpO1xuXG4gICAgdmFyIGtleXdvcmRzID0gbWFrZUtleXdvcmRzKFxuICAgICAgXCJkZWZuIGRlZm4tIGRlZiBkZWYtIGRlZm9uY2UgZGVmbXVsdGkgZGVmbWV0aG9kIGRlZm1hY3JvIGRlZnN0cnVjdCBkZWZ0eXBlIGRlZnByb3RvY29sIGRlZnJlY29yZCBkZWZwcm9qZWN0IGRlZnRlc3Qgc2xpY2UgZGVmYWxpYXMgZGVmaGludGVkIGRlZm1hY3JvLSBkZWZuLW1lbW8gZGVmbmsgZGVmbmsgZGVmb25jZS0gZGVmdW5ib3VuZCBkZWZ1bmJvdW5kLSBkZWZ2YXIgZGVmdmFyLSBsZXQgbGV0Zm4gZG8gY2FzZSBjb25kIGNvbmRwIGZvciBsb29wIHJlY3VyIHdoZW4gd2hlbi1ub3Qgd2hlbi1sZXQgd2hlbi1maXJzdCBpZiBpZi1sZXQgaWYtbm90IC4gLi4gLT4gLT4+IGRvdG8gYW5kIG9yIGRvc3luYyBkb3NlcSBkb3RpbWVzIGRvcnVuIGRvYWxsIGxvYWQgaW1wb3J0IHVuaW1wb3J0IG5zIGluLW5zIHJlZmVyIHRyeSBjYXRjaCBmaW5hbGx5IHRocm93IHdpdGgtb3BlbiB3aXRoLWxvY2FsLXZhcnMgYmluZGluZyBnZW4tY2xhc3MgZ2VuLWFuZC1sb2FkLWNsYXNzIGdlbi1hbmQtc2F2ZS1jbGFzcyBoYW5kbGVyLWNhc2UgaGFuZGxlXCIpO1xuXG4gICAgdmFyIGJ1aWx0aW5zID0gbWFrZUtleXdvcmRzKFxuICAgICAgICBcIiogKicgKjEgKjIgKjMgKmFnZW50KiAqYWxsb3ctdW5yZXNvbHZlZC12YXJzKiAqYXNzZXJ0KiAqY2xvanVyZS12ZXJzaW9uKiAqY29tbWFuZC1saW5lLWFyZ3MqICpjb21waWxlLWZpbGVzKiAqY29tcGlsZS1wYXRoKiAqY29tcGlsZXItb3B0aW9ucyogKmRhdGEtcmVhZGVycyogKmUgKmVyciogKmZpbGUqICpmbHVzaC1vbi1uZXdsaW5lKiAqZm4tbG9hZGVyKiAqaW4qICptYXRoLWNvbnRleHQqICpucyogKm91dCogKnByaW50LWR1cCogKnByaW50LWxlbmd0aCogKnByaW50LWxldmVsKiAqcHJpbnQtbWV0YSogKnByaW50LXJlYWRhYmx5KiAqcmVhZC1ldmFsKiAqc291cmNlLXBhdGgqICp1bmNoZWNrZWQtbWF0aCogKnVzZS1jb250ZXh0LWNsYXNzbG9hZGVyKiAqdmVyYm9zZS1kZWZyZWNvcmRzKiAqd2Fybi1vbi1yZWZsZWN0aW9uKiArICsnIC0gLScgLT4gLT4+IC0+QXJyYXlDaHVuayAtPlZlYyAtPlZlY05vZGUgLT5WZWNTZXEgLWNhY2hlLXByb3RvY29sLWZuIC1yZXNldC1tZXRob2RzIC4uIC8gPCA8PSA9ID09ID4gPj0gRU1QVFktTk9ERSBhY2Nlc3NvciBhY2xvbmUgYWRkLWNsYXNzcGF0aCBhZGQtd2F0Y2ggYWdlbnQgYWdlbnQtZXJyb3IgYWdlbnQtZXJyb3JzIGFnZXQgYWxlbmd0aCBhbGlhcyBhbGwtbnMgYWx0ZXIgYWx0ZXItbWV0YSEgYWx0ZXItdmFyLXJvb3QgYW1hcCBhbmNlc3RvcnMgYW5kIGFwcGx5IGFyZWR1Y2UgYXJyYXktbWFwIGFzZXQgYXNldC1ib29sZWFuIGFzZXQtYnl0ZSBhc2V0LWNoYXIgYXNldC1kb3VibGUgYXNldC1mbG9hdCBhc2V0LWludCBhc2V0LWxvbmcgYXNldC1zaG9ydCBhc3NlcnQgYXNzb2MgYXNzb2MhIGFzc29jLWluIGFzc29jaWF0aXZlPyBhdG9tIGF3YWl0IGF3YWl0LWZvciBhd2FpdDEgYmFzZXMgYmVhbiBiaWdkZWMgYmlnaW50IGJpZ2ludGVnZXIgYmluZGluZyBiaXQtYW5kIGJpdC1hbmQtbm90IGJpdC1jbGVhciBiaXQtZmxpcCBiaXQtbm90IGJpdC1vciBiaXQtc2V0IGJpdC1zaGlmdC1sZWZ0IGJpdC1zaGlmdC1yaWdodCBiaXQtdGVzdCBiaXQteG9yIGJvb2xlYW4gYm9vbGVhbi1hcnJheSBib29sZWFucyBib3VuZC1mbiBib3VuZC1mbiogYm91bmQ/IGJ1dGxhc3QgYnl0ZSBieXRlLWFycmF5IGJ5dGVzIGNhc2UgY2FzdCBjaGFyIGNoYXItYXJyYXkgY2hhci1lc2NhcGUtc3RyaW5nIGNoYXItbmFtZS1zdHJpbmcgY2hhcj8gY2hhcnMgY2h1bmsgY2h1bmstYXBwZW5kIGNodW5rLWJ1ZmZlciBjaHVuay1jb25zIGNodW5rLWZpcnN0IGNodW5rLW5leHQgY2h1bmstcmVzdCBjaHVua2VkLXNlcT8gY2xhc3MgY2xhc3M/IGNsZWFyLWFnZW50LWVycm9ycyBjbG9qdXJlLXZlcnNpb24gY29sbD8gY29tbWVudCBjb21tdXRlIGNvbXAgY29tcGFyYXRvciBjb21wYXJlIGNvbXBhcmUtYW5kLXNldCEgY29tcGlsZSBjb21wbGVtZW50IGNvbmNhdCBjb25kIGNvbmRwIGNvbmogY29uaiEgY29ucyBjb25zdGFudGx5IGNvbnN0cnVjdC1wcm94eSBjb250YWlucz8gY291bnQgY291bnRlZD8gY3JlYXRlLW5zIGNyZWF0ZS1zdHJ1Y3QgY3ljbGUgZGVjIGRlYycgZGVjaW1hbD8gZGVjbGFyZSBkZWZhdWx0LWRhdGEtcmVhZGVycyBkZWZpbmxpbmUgZGVmaW50ZXJmYWNlIGRlZm1hY3JvIGRlZm1ldGhvZCBkZWZtdWx0aSBkZWZuIGRlZm4tIGRlZm9uY2UgZGVmcHJvdG9jb2wgZGVmcmVjb3JkIGRlZnN0cnVjdCBkZWZ0eXBlIGRlbGF5IGRlbGF5PyBkZWxpdmVyIGRlbm9taW5hdG9yIGRlcmVmIGRlcml2ZSBkZXNjZW5kYW50cyBkZXN0cnVjdHVyZSBkaXNqIGRpc2ohIGRpc3NvYyBkaXNzb2MhIGRpc3RpbmN0IGRpc3RpbmN0PyBkb2FsbCBkb3J1biBkb3NlcSBkb3N5bmMgZG90aW1lcyBkb3RvIGRvdWJsZSBkb3VibGUtYXJyYXkgZG91YmxlcyBkcm9wIGRyb3AtbGFzdCBkcm9wLXdoaWxlIGVtcHR5IGVtcHR5PyBlbnN1cmUgZW51bWVyYXRpb24tc2VxIGVycm9yLWhhbmRsZXIgZXJyb3ItbW9kZSBldmFsIGV2ZW4/IGV2ZXJ5LXByZWQgZXZlcnk/IGV4LWRhdGEgZXgtaW5mbyBleHRlbmQgZXh0ZW5kLXByb3RvY29sIGV4dGVuZC10eXBlIGV4dGVuZGVycyBleHRlbmRzPyBmYWxzZT8gZmZpcnN0IGZpbGUtc2VxIGZpbHRlciBmaWx0ZXJ2IGZpbmQgZmluZC1rZXl3b3JkIGZpbmQtbnMgZmluZC1wcm90b2NvbC1pbXBsIGZpbmQtcHJvdG9jb2wtbWV0aG9kIGZpbmQtdmFyIGZpcnN0IGZsYXR0ZW4gZmxvYXQgZmxvYXQtYXJyYXkgZmxvYXQ/IGZsb2F0cyBmbHVzaCBmbiBmbj8gZm5leHQgZm5pbCBmb3IgZm9yY2UgZm9ybWF0IGZyZXF1ZW5jaWVzIGZ1dHVyZSBmdXR1cmUtY2FsbCBmdXR1cmUtY2FuY2VsIGZ1dHVyZS1jYW5jZWxsZWQ/IGZ1dHVyZS1kb25lPyBmdXR1cmU/IGdlbi1jbGFzcyBnZW4taW50ZXJmYWNlIGdlbnN5bSBnZXQgZ2V0LWluIGdldC1tZXRob2QgZ2V0LXByb3h5LWNsYXNzIGdldC10aHJlYWQtYmluZGluZ3MgZ2V0LXZhbGlkYXRvciBncm91cC1ieSBoYXNoIGhhc2gtY29tYmluZSBoYXNoLW1hcCBoYXNoLXNldCBpZGVudGljYWw/IGlkZW50aXR5IGlmLWxldCBpZi1ub3QgaWZuPyBpbXBvcnQgaW4tbnMgaW5jIGluYycgaW5pdC1wcm94eSBpbnN0YW5jZT8gaW50IGludC1hcnJheSBpbnRlZ2VyPyBpbnRlcmxlYXZlIGludGVybiBpbnRlcnBvc2UgaW50byBpbnRvLWFycmF5IGludHMgaW8hIGlzYT8gaXRlcmF0ZSBpdGVyYXRvci1zZXEganV4dCBrZWVwIGtlZXAtaW5kZXhlZCBrZXkga2V5cyBrZXl3b3JkIGtleXdvcmQ/IGxhc3QgbGF6eS1jYXQgbGF6eS1zZXEgbGV0IGxldGZuIGxpbmUtc2VxIGxpc3QgbGlzdCogbGlzdD8gbG9hZCBsb2FkLWZpbGUgbG9hZC1yZWFkZXIgbG9hZC1zdHJpbmcgbG9hZGVkLWxpYnMgbG9ja2luZyBsb25nIGxvbmctYXJyYXkgbG9uZ3MgbG9vcCBtYWNyb2V4cGFuZCBtYWNyb2V4cGFuZC0xIG1ha2UtYXJyYXkgbWFrZS1oaWVyYXJjaHkgbWFwIG1hcC1pbmRleGVkIG1hcD8gbWFwY2F0IG1hcHYgbWF4IG1heC1rZXkgbWVtZm4gbWVtb2l6ZSBtZXJnZSBtZXJnZS13aXRoIG1ldGEgbWV0aG9kLXNpZyBtZXRob2RzIG1pbiBtaW4ta2V5IG1vZCBtdW5nZSBuYW1lIG5hbWVzcGFjZSBuYW1lc3BhY2UtbXVuZ2UgbmVnPyBuZXdsaW5lIG5leHQgbmZpcnN0IG5pbD8gbm5leHQgbm90IG5vdC1hbnk/IG5vdC1lbXB0eSBub3QtZXZlcnk/IG5vdD0gbnMgbnMtYWxpYXNlcyBucy1pbXBvcnRzIG5zLWludGVybnMgbnMtbWFwIG5zLW5hbWUgbnMtcHVibGljcyBucy1yZWZlcnMgbnMtcmVzb2x2ZSBucy11bmFsaWFzIG5zLXVubWFwIG50aCBudGhuZXh0IG50aHJlc3QgbnVtIG51bWJlcj8gbnVtZXJhdG9yIG9iamVjdC1hcnJheSBvZGQ/IG9yIHBhcmVudHMgcGFydGlhbCBwYXJ0aXRpb24gcGFydGl0aW9uLWFsbCBwYXJ0aXRpb24tYnkgcGNhbGxzIHBlZWsgcGVyc2lzdGVudCEgcG1hcCBwb3AgcG9wISBwb3AtdGhyZWFkLWJpbmRpbmdzIHBvcz8gcHIgcHItc3RyIHByZWZlci1tZXRob2QgcHJlZmVycyBwcmltaXRpdmVzLWNsYXNzbmFtZXMgcHJpbnQgcHJpbnQtY3RvciBwcmludC1kdXAgcHJpbnQtbWV0aG9kIHByaW50LXNpbXBsZSBwcmludC1zdHIgcHJpbnRmIHByaW50bG4gcHJpbnRsbi1zdHIgcHJuIHBybi1zdHIgcHJvbWlzZSBwcm94eSBwcm94eS1jYWxsLXdpdGgtc3VwZXIgcHJveHktbWFwcGluZ3MgcHJveHktbmFtZSBwcm94eS1zdXBlciBwdXNoLXRocmVhZC1iaW5kaW5ncyBwdmFsdWVzIHF1b3QgcmFuZCByYW5kLWludCByYW5kLW50aCByYW5nZSByYXRpbz8gcmF0aW9uYWw/IHJhdGlvbmFsaXplIHJlLWZpbmQgcmUtZ3JvdXBzIHJlLW1hdGNoZXIgcmUtbWF0Y2hlcyByZS1wYXR0ZXJuIHJlLXNlcSByZWFkIHJlYWQtbGluZSByZWFkLXN0cmluZyByZWFsaXplZD8gcmVkdWNlIHJlZHVjZS1rdiByZWR1Y3Rpb25zIHJlZiByZWYtaGlzdG9yeS1jb3VudCByZWYtbWF4LWhpc3RvcnkgcmVmLW1pbi1oaXN0b3J5IHJlZi1zZXQgcmVmZXIgcmVmZXItY2xvanVyZSByZWlmeSByZWxlYXNlLXBlbmRpbmctc2VuZHMgcmVtIHJlbW92ZSByZW1vdmUtYWxsLW1ldGhvZHMgcmVtb3ZlLW1ldGhvZCByZW1vdmUtbnMgcmVtb3ZlLXdhdGNoIHJlcGVhdCByZXBlYXRlZGx5IHJlcGxhY2UgcmVwbGljYXRlIHJlcXVpcmUgcmVzZXQhIHJlc2V0LW1ldGEhIHJlc29sdmUgcmVzdCByZXN0YXJ0LWFnZW50IHJlc3VsdHNldC1zZXEgcmV2ZXJzZSByZXZlcnNpYmxlPyByc2VxIHJzdWJzZXEgc2F0aXNmaWVzPyBzZWNvbmQgc2VsZWN0LWtleXMgc2VuZCBzZW5kLW9mZiBzZXEgc2VxPyBzZXF1ZSBzZXF1ZW5jZSBzZXF1ZW50aWFsPyBzZXQgc2V0LWVycm9yLWhhbmRsZXIhIHNldC1lcnJvci1tb2RlISBzZXQtdmFsaWRhdG9yISBzZXQ/IHNob3J0IHNob3J0LWFycmF5IHNob3J0cyBzaHVmZmxlIHNodXRkb3duLWFnZW50cyBzbHVycCBzb21lIHNvbWUtZm4gc29ydCBzb3J0LWJ5IHNvcnRlZC1tYXAgc29ydGVkLW1hcC1ieSBzb3J0ZWQtc2V0IHNvcnRlZC1zZXQtYnkgc29ydGVkPyBzcGVjaWFsLXN5bWJvbD8gc3BpdCBzcGxpdC1hdCBzcGxpdC13aXRoIHN0ciBzdHJpbmc/IHN0cnVjdCBzdHJ1Y3QtbWFwIHN1YnMgc3Vic2VxIHN1YnZlYyBzdXBlcnMgc3dhcCEgc3ltYm9sIHN5bWJvbD8gc3luYyB0YWtlIHRha2UtbGFzdCB0YWtlLW50aCB0YWtlLXdoaWxlIHRlc3QgdGhlLW5zIHRocmVhZC1ib3VuZD8gdGltZSB0by1hcnJheSB0by1hcnJheS0yZCB0cmFtcG9saW5lIHRyYW5zaWVudCB0cmVlLXNlcSB0cnVlPyB0eXBlIHVuY2hlY2tlZC1hZGQgdW5jaGVja2VkLWFkZC1pbnQgdW5jaGVja2VkLWJ5dGUgdW5jaGVja2VkLWNoYXIgdW5jaGVja2VkLWRlYyB1bmNoZWNrZWQtZGVjLWludCB1bmNoZWNrZWQtZGl2aWRlLWludCB1bmNoZWNrZWQtZG91YmxlIHVuY2hlY2tlZC1mbG9hdCB1bmNoZWNrZWQtaW5jIHVuY2hlY2tlZC1pbmMtaW50IHVuY2hlY2tlZC1pbnQgdW5jaGVja2VkLWxvbmcgdW5jaGVja2VkLW11bHRpcGx5IHVuY2hlY2tlZC1tdWx0aXBseS1pbnQgdW5jaGVja2VkLW5lZ2F0ZSB1bmNoZWNrZWQtbmVnYXRlLWludCB1bmNoZWNrZWQtcmVtYWluZGVyLWludCB1bmNoZWNrZWQtc2hvcnQgdW5jaGVja2VkLXN1YnRyYWN0IHVuY2hlY2tlZC1zdWJ0cmFjdC1pbnQgdW5kZXJpdmUgdW5xdW90ZSB1bnF1b3RlLXNwbGljaW5nIHVwZGF0ZS1pbiB1cGRhdGUtcHJveHkgdXNlIHZhbCB2YWxzIHZhci1nZXQgdmFyLXNldCB2YXI/IHZhcnktbWV0YSB2ZWMgdmVjdG9yIHZlY3Rvci1vZiB2ZWN0b3I/IHdoZW4gd2hlbi1maXJzdCB3aGVuLWxldCB3aGVuLW5vdCB3aGlsZSB3aXRoLWJpbmRpbmdzIHdpdGgtYmluZGluZ3MqIHdpdGgtaW4tc3RyIHdpdGgtbG9hZGluZy1jb250ZXh0IHdpdGgtbG9jYWwtdmFycyB3aXRoLW1ldGEgd2l0aC1vcGVuIHdpdGgtb3V0LXN0ciB3aXRoLXByZWNpc2lvbiB3aXRoLXJlZGVmcyB3aXRoLXJlZGVmcy1mbiB4bWwtc2VxIHplcm8/IHppcG1hcCAqZGVmYXVsdC1kYXRhLXJlYWRlci1mbiogYXMtPiBjb25kLT4gY29uZC0+PiByZWR1Y2VkIHJlZHVjZWQ/IHNlbmQtdmlhIHNldC1hZ2VudC1zZW5kLWV4ZWN1dG9yISBzZXQtYWdlbnQtc2VuZC1vZmYtZXhlY3V0b3IhIHNvbWUtPiBzb21lLT4+XCIpO1xuXG4gICAgdmFyIGluZGVudEtleXMgPSBtYWtlS2V5d29yZHMoXG4gICAgICAgIC8vIEJ1aWx0LWluc1xuICAgICAgICBcIm5zIGZuIGRlZiBkZWZuIGRlZm1ldGhvZCBib3VuZC1mbiBpZiBpZi1ub3QgY2FzZSBjb25kcCB3aGVuIHdoaWxlIHdoZW4tbm90IHdoZW4tZmlyc3QgZG8gZnV0dXJlIGNvbW1lbnQgZG90byBsb2NraW5nIHByb3h5IHdpdGgtb3BlbiB3aXRoLXByZWNpc2lvbiByZWlmeSBkZWZ0eXBlIGRlZnJlY29yZCBkZWZwcm90b2NvbCBleHRlbmQgZXh0ZW5kLXByb3RvY29sIGV4dGVuZC10eXBlIHRyeSBjYXRjaCBcIiArXG5cbiAgICAgICAgLy8gQmluZGluZyBmb3Jtc1xuICAgICAgICBcImxldCBsZXRmbiBiaW5kaW5nIGxvb3AgZm9yIGRvc2VxIGRvdGltZXMgd2hlbi1sZXQgaWYtbGV0IFwiICtcblxuICAgICAgICAvLyBEYXRhIHN0cnVjdHVyZXNcbiAgICAgICAgXCJkZWZzdHJ1Y3Qgc3RydWN0LW1hcCBhc3NvYyBcIiArXG5cbiAgICAgICAgLy8gY2xvanVyZS50ZXN0XG4gICAgICAgIFwidGVzdGluZyBkZWZ0ZXN0IFwiICtcblxuICAgICAgICAvLyBjb250cmliXG4gICAgICAgIFwiaGFuZGxlci1jYXNlIGhhbmRsZSBkb3RyYWNlIGRlZnRyYWNlXCIpO1xuXG4gICAgdmFyIHRlc3RzID0ge1xuICAgICAgICBkaWdpdDogL1xcZC8sXG4gICAgICAgIGRpZ2l0X29yX2NvbG9uOiAvW1xcZDpdLyxcbiAgICAgICAgaGV4OiAvWzAtOWEtZl0vaSxcbiAgICAgICAgc2lnbjogL1srLV0vLFxuICAgICAgICBleHBvbmVudDogL2UvaSxcbiAgICAgICAga2V5d29yZF9jaGFyOiAvW15cXHNcXChcXFtcXDtcXClcXF1dLyxcbiAgICAgICAgc3ltYm9sOiAvW1xcdyorIVxcLVxcLl8/Ojw+XFwvXFx4YTEtXFx1ZmZmZl0vLFxuICAgICAgICBibG9ja19pbmRlbnQ6IC9eKD86ZGVmfHdpdGgpW15cXC9dKyR8XFwvKD86ZGVmfHdpdGgpL1xuICAgIH07XG5cbiAgICBmdW5jdGlvbiBzdGF0ZVN0YWNrKGluZGVudCwgdHlwZSwgcHJldikgeyAvLyByZXByZXNlbnRzIGEgc3RhdGUgc3RhY2sgb2JqZWN0XG4gICAgICAgIHRoaXMuaW5kZW50ID0gaW5kZW50O1xuICAgICAgICB0aGlzLnR5cGUgPSB0eXBlO1xuICAgICAgICB0aGlzLnByZXYgPSBwcmV2O1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHB1c2hTdGFjayhzdGF0ZSwgaW5kZW50LCB0eXBlKSB7XG4gICAgICAgIHN0YXRlLmluZGVudFN0YWNrID0gbmV3IHN0YXRlU3RhY2soaW5kZW50LCB0eXBlLCBzdGF0ZS5pbmRlbnRTdGFjayk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gcG9wU3RhY2soc3RhdGUpIHtcbiAgICAgICAgc3RhdGUuaW5kZW50U3RhY2sgPSBzdGF0ZS5pbmRlbnRTdGFjay5wcmV2O1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGlzTnVtYmVyKGNoLCBzdHJlYW0pe1xuICAgICAgICAvLyBoZXhcbiAgICAgICAgaWYgKCBjaCA9PT0gJzAnICYmIHN0cmVhbS5lYXQoL3gvaSkgKSB7XG4gICAgICAgICAgICBzdHJlYW0uZWF0V2hpbGUodGVzdHMuaGV4KTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gbGVhZGluZyBzaWduXG4gICAgICAgIGlmICggKCBjaCA9PSAnKycgfHwgY2ggPT0gJy0nICkgJiYgKCB0ZXN0cy5kaWdpdC50ZXN0KHN0cmVhbS5wZWVrKCkpICkgKSB7XG4gICAgICAgICAgc3RyZWFtLmVhdCh0ZXN0cy5zaWduKTtcbiAgICAgICAgICBjaCA9IHN0cmVhbS5uZXh0KCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIHRlc3RzLmRpZ2l0LnRlc3QoY2gpICkge1xuICAgICAgICAgICAgc3RyZWFtLmVhdChjaCk7XG4gICAgICAgICAgICBzdHJlYW0uZWF0V2hpbGUodGVzdHMuZGlnaXQpO1xuXG4gICAgICAgICAgICBpZiAoICcuJyA9PSBzdHJlYW0ucGVlaygpICkge1xuICAgICAgICAgICAgICAgIHN0cmVhbS5lYXQoJy4nKTtcbiAgICAgICAgICAgICAgICBzdHJlYW0uZWF0V2hpbGUodGVzdHMuZGlnaXQpO1xuICAgICAgICAgICAgfSBlbHNlIGlmICgnLycgPT0gc3RyZWFtLnBlZWsoKSApIHtcbiAgICAgICAgICAgICAgICBzdHJlYW0uZWF0KCcvJyk7XG4gICAgICAgICAgICAgICAgc3RyZWFtLmVhdFdoaWxlKHRlc3RzLmRpZ2l0KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCBzdHJlYW0uZWF0KHRlc3RzLmV4cG9uZW50KSApIHtcbiAgICAgICAgICAgICAgICBzdHJlYW0uZWF0KHRlc3RzLnNpZ24pO1xuICAgICAgICAgICAgICAgIHN0cmVhbS5lYXRXaGlsZSh0ZXN0cy5kaWdpdCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIC8vIEVhdCBjaGFyYWN0ZXIgdGhhdCBzdGFydHMgYWZ0ZXIgYmFja3NsYXNoIFxcXG4gICAgZnVuY3Rpb24gZWF0Q2hhcmFjdGVyKHN0cmVhbSkge1xuICAgICAgICB2YXIgZmlyc3QgPSBzdHJlYW0ubmV4dCgpO1xuICAgICAgICAvLyBSZWFkIHNwZWNpYWwgbGl0ZXJhbHM6IGJhY2tzcGFjZSwgbmV3bGluZSwgc3BhY2UsIHJldHVybi5cbiAgICAgICAgLy8gSnVzdCByZWFkIGFsbCBsb3dlcmNhc2UgbGV0dGVycy5cbiAgICAgICAgaWYgKGZpcnN0ICYmIGZpcnN0Lm1hdGNoKC9bYS16XS8pICYmIHN0cmVhbS5tYXRjaCgvW2Etel0rLywgdHJ1ZSkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICAvLyBSZWFkIHVuaWNvZGUgY2hhcmFjdGVyOiBcXHUxMDAwIFxcdUEwYTFcbiAgICAgICAgaWYgKGZpcnN0ID09PSBcInVcIikge1xuICAgICAgICAgICAgc3RyZWFtLm1hdGNoKC9bMC05YS16XXs0fS9pLCB0cnVlKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICAgIHN0YXJ0U3RhdGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgaW5kZW50U3RhY2s6IG51bGwsXG4gICAgICAgICAgICAgICAgaW5kZW50YXRpb246IDAsXG4gICAgICAgICAgICAgICAgbW9kZTogZmFsc2VcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0sXG5cbiAgICAgICAgdG9rZW46IGZ1bmN0aW9uIChzdHJlYW0sIHN0YXRlKSB7XG4gICAgICAgICAgICBpZiAoc3RhdGUuaW5kZW50U3RhY2sgPT0gbnVsbCAmJiBzdHJlYW0uc29sKCkpIHtcbiAgICAgICAgICAgICAgICAvLyB1cGRhdGUgaW5kZW50YXRpb24sIGJ1dCBvbmx5IGlmIGluZGVudFN0YWNrIGlzIGVtcHR5XG4gICAgICAgICAgICAgICAgc3RhdGUuaW5kZW50YXRpb24gPSBzdHJlYW0uaW5kZW50YXRpb24oKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gc2tpcCBzcGFjZXNcbiAgICAgICAgICAgIGlmIChzdGF0ZS5tb2RlICE9IFwic3RyaW5nXCIgJiYgc3RyZWFtLmVhdFNwYWNlKCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciByZXR1cm5UeXBlID0gbnVsbDtcblxuICAgICAgICAgICAgc3dpdGNoKHN0YXRlLm1vZGUpe1xuICAgICAgICAgICAgICAgIGNhc2UgXCJzdHJpbmdcIjogLy8gbXVsdGktbGluZSBzdHJpbmcgcGFyc2luZyBtb2RlXG4gICAgICAgICAgICAgICAgICAgIHZhciBuZXh0LCBlc2NhcGVkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIHdoaWxlICgobmV4dCA9IHN0cmVhbS5uZXh0KCkpICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuZXh0ID09IFwiXFxcIlwiICYmICFlc2NhcGVkKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZS5tb2RlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlc2NhcGVkID0gIWVzY2FwZWQgJiYgbmV4dCA9PSBcIlxcXFxcIjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm5UeXBlID0gU1RSSU5HOyAvLyBjb250aW51ZSBvbiBpbiBzdHJpbmcgbW9kZVxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBkZWZhdWx0OiAvLyBkZWZhdWx0IHBhcnNpbmcgbW9kZVxuICAgICAgICAgICAgICAgICAgICB2YXIgY2ggPSBzdHJlYW0ubmV4dCgpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChjaCA9PSBcIlxcXCJcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUubW9kZSA9IFwic3RyaW5nXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5UeXBlID0gU1RSSU5HO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNoID09IFwiXFxcXFwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlYXRDaGFyYWN0ZXIoc3RyZWFtKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVyblR5cGUgPSBDSEFSQUNURVI7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoY2ggPT0gXCInXCIgJiYgISggdGVzdHMuZGlnaXRfb3JfY29sb24udGVzdChzdHJlYW0ucGVlaygpKSApKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5UeXBlID0gQVRPTTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChjaCA9PSBcIjtcIikgeyAvLyBjb21tZW50XG4gICAgICAgICAgICAgICAgICAgICAgICBzdHJlYW0uc2tpcFRvRW5kKCk7IC8vIHJlc3Qgb2YgdGhlIGxpbmUgaXMgYSBjb21tZW50XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5UeXBlID0gQ09NTUVOVDtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpc051bWJlcihjaCxzdHJlYW0pKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVyblR5cGUgPSBOVU1CRVI7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoY2ggPT0gXCIoXCIgfHwgY2ggPT0gXCJbXCIgfHwgY2ggPT0gXCJ7XCIgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIga2V5V29yZCA9ICcnLCBpbmRlbnRUZW1wID0gc3RyZWFtLmNvbHVtbigpLCBsZXR0ZXI7XG4gICAgICAgICAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgICAgICAgIEVpdGhlclxuICAgICAgICAgICAgICAgICAgICAgICAgKGluZGVudC13b3JkIC4uXG4gICAgICAgICAgICAgICAgICAgICAgICAobm9uLWluZGVudC13b3JkIC4uXG4gICAgICAgICAgICAgICAgICAgICAgICAoO3NvbWV0aGluZyBlbHNlLCBicmFja2V0LCBldGMuXG4gICAgICAgICAgICAgICAgICAgICAgICAqL1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2ggPT0gXCIoXCIpIHdoaWxlICgobGV0dGVyID0gc3RyZWFtLmVhdCh0ZXN0cy5rZXl3b3JkX2NoYXIpKSAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAga2V5V29yZCArPSBsZXR0ZXI7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChrZXlXb3JkLmxlbmd0aCA+IDAgJiYgKGluZGVudEtleXMucHJvcGVydHlJc0VudW1lcmFibGUoa2V5V29yZCkgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlc3RzLmJsb2NrX2luZGVudC50ZXN0KGtleVdvcmQpKSkgeyAvLyBpbmRlbnQtd29yZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB1c2hTdGFjayhzdGF0ZSwgaW5kZW50VGVtcCArIElOREVOVF9XT1JEX1NLSVAsIGNoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7IC8vIG5vbi1pbmRlbnQgd29yZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHdlIGNvbnRpbnVlIGVhdGluZyB0aGUgc3BhY2VzXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RyZWFtLmVhdFNwYWNlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN0cmVhbS5lb2woKSB8fCBzdHJlYW0ucGVlaygpID09IFwiO1wiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIG5vdGhpbmcgc2lnbmlmaWNhbnQgYWZ0ZXJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gd2UgcmVzdGFydCBpbmRlbnRhdGlvbiB0aGUgdXNlciBkZWZpbmVkIHNwYWNlcyBhZnRlclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdXNoU3RhY2soc3RhdGUsIGluZGVudFRlbXAgKyBOT1JNQUxfSU5ERU5UX1VOSVQsIGNoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdXNoU3RhY2soc3RhdGUsIGluZGVudFRlbXAgKyBzdHJlYW0uY3VycmVudCgpLmxlbmd0aCwgY2gpOyAvLyBlbHNlIHdlIG1hdGNoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgc3RyZWFtLmJhY2tVcChzdHJlYW0uY3VycmVudCgpLmxlbmd0aCAtIDEpOyAvLyB1bmRvIGFsbCB0aGUgZWF0aW5nXG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVyblR5cGUgPSBCUkFDS0VUO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNoID09IFwiKVwiIHx8IGNoID09IFwiXVwiIHx8IGNoID09IFwifVwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5UeXBlID0gQlJBQ0tFVDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdGF0ZS5pbmRlbnRTdGFjayAhPSBudWxsICYmIHN0YXRlLmluZGVudFN0YWNrLnR5cGUgPT0gKGNoID09IFwiKVwiID8gXCIoXCIgOiAoY2ggPT0gXCJdXCIgPyBcIltcIiA6XCJ7XCIpKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvcFN0YWNrKHN0YXRlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICggY2ggPT0gXCI6XCIgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdHJlYW0uZWF0V2hpbGUodGVzdHMuc3ltYm9sKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBBVE9NO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgc3RyZWFtLmVhdFdoaWxlKHRlc3RzLnN5bWJvbCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChrZXl3b3JkcyAmJiBrZXl3b3Jkcy5wcm9wZXJ0eUlzRW51bWVyYWJsZShzdHJlYW0uY3VycmVudCgpKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVyblR5cGUgPSBLRVlXT1JEO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChidWlsdGlucyAmJiBidWlsdGlucy5wcm9wZXJ0eUlzRW51bWVyYWJsZShzdHJlYW0uY3VycmVudCgpKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVyblR5cGUgPSBCVUlMVElOO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhdG9tcyAmJiBhdG9tcy5wcm9wZXJ0eUlzRW51bWVyYWJsZShzdHJlYW0uY3VycmVudCgpKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVyblR5cGUgPSBBVE9NO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuVHlwZSA9IFZBUjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gcmV0dXJuVHlwZTtcbiAgICAgICAgfSxcblxuICAgICAgICBpbmRlbnQ6IGZ1bmN0aW9uIChzdGF0ZSkge1xuICAgICAgICAgICAgaWYgKHN0YXRlLmluZGVudFN0YWNrID09IG51bGwpIHJldHVybiBzdGF0ZS5pbmRlbnRhdGlvbjtcbiAgICAgICAgICAgIHJldHVybiBzdGF0ZS5pbmRlbnRTdGFjay5pbmRlbnQ7XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2xvc2VCcmFja2V0czoge3BhaXJzOiBcIigpW117fVxcXCJcXFwiXCJ9LFxuICAgICAgICBsaW5lQ29tbWVudDogXCI7O1wiXG4gICAgfTtcbn0pO1xuXG5Db2RlTWlycm9yLmRlZmluZU1JTUUoXCJ0ZXh0L3gtY2xvanVyZVwiLCBcImNsb2p1cmVcIik7XG5Db2RlTWlycm9yLmRlZmluZU1JTUUoXCJ0ZXh0L3gtY2xvanVyZXNjcmlwdFwiLCBcImNsb2p1cmVcIik7XG5cbn0pO1xuIiwiLy8gQ29kZU1pcnJvciwgY29weXJpZ2h0IChjKSBieSBNYXJpam4gSGF2ZXJiZWtlIGFuZCBvdGhlcnNcbi8vIERpc3RyaWJ1dGVkIHVuZGVyIGFuIE1JVCBsaWNlbnNlOiBodHRwOi8vY29kZW1pcnJvci5uZXQvTElDRU5TRVxuXG4oZnVuY3Rpb24obW9kKSB7XG4gIGlmICh0eXBlb2YgZXhwb3J0cyA9PSBcIm9iamVjdFwiICYmIHR5cGVvZiBtb2R1bGUgPT0gXCJvYmplY3RcIikgLy8gQ29tbW9uSlNcbiAgICBtb2QocmVxdWlyZShcIi4uLy4uL2xpYi9jb2RlbWlycm9yXCIpLCByZXF1aXJlKFwiLi4vbWFya2Rvd24vbWFya2Rvd25cIiksIHJlcXVpcmUoXCIuLi8uLi9hZGRvbi9tb2RlL292ZXJsYXlcIikpO1xuICBlbHNlIGlmICh0eXBlb2YgZGVmaW5lID09IFwiZnVuY3Rpb25cIiAmJiBkZWZpbmUuYW1kKSAvLyBBTURcbiAgICBkZWZpbmUoW1wiLi4vLi4vbGliL2NvZGVtaXJyb3JcIiwgXCIuLi9tYXJrZG93bi9tYXJrZG93blwiLCBcIi4uLy4uL2FkZG9uL21vZGUvb3ZlcmxheVwiXSwgbW9kKTtcbiAgZWxzZSAvLyBQbGFpbiBicm93c2VyIGVudlxuICAgIG1vZChDb2RlTWlycm9yKTtcbn0pKGZ1bmN0aW9uKENvZGVNaXJyb3IpIHtcblwidXNlIHN0cmljdFwiO1xuXG52YXIgdXJsUkUgPSAvXigoPzooPzphYWFzP3xhYm91dHxhY2FwfGFkaXVteHRyYXxhZltwc118YWltfGFwdHxhdHRhY2htZW50fGF3fGJlc2hhcmV8Yml0Y29pbnxib2xvfGNhbGx0b3xjYXB8Y2hyb21lKD86LWV4dGVuc2lvbik/fGNpZHxjb2FwfGNvbS1ldmVudGJyaXRlLWF0dGVuZGVlfGNvbnRlbnR8Y3JpZHxjdnN8ZGF0YXxkYXZ8ZGljdHxkbG5hLSg/OnBsYXljb250YWluZXJ8cGxheXNpbmdsZSl8ZG5zfGRvaXxkdG58ZHZifGVkMmt8ZmFjZXRpbWV8ZmVlZHxmaWxlfGZpbmdlcnxmaXNofGZ0cHxnZW98Z2d8Z2l0fGdpem1vcHJvamVjdHxnb3xnb3BoZXJ8Z3RhbGt8aDMyM3xoY3B8aHR0cHM/fGlheHxpY2FwfGljb258aW18aW1hcHxpbmZvfGlwbnxpcHB8aXJjWzZzXT98aXJpcyg/OlxcLmJlZXB8XFwubHd6fFxcLnhwY3xcXC54cGNzKT98aXRtc3xqYXJ8amF2YXNjcmlwdHxqbXN8a2V5cGFyY3xsYXN0Zm18bGRhcHM/fG1hZ25ldHxtYWlsdG98bWFwc3xtYXJrZXR8bWVzc2FnZXxtaWR8bW1zfG1zLWhlbHB8bXNuaW18bXNycHM/fG10cXB8bXVtYmxlfG11cGRhdGV8bXZufG5ld3N8bmZzfG5paD98bm50cHxub3Rlc3xvaWR8b3BhcXVlbG9ja3Rva2VufHBhbG18cGFwYXJhenppfHBsYXRmb3JtfHBvcHxwcmVzfHByb3h5fHBzeWN8cXVlcnl8cmVzKD86b3VyY2UpP3xybWl8cnN5bmN8cnRtcHxydHNwfHNlY29uZGxpZmV8c2VydmljZXxzZXNzaW9ufHNmdHB8c2dufHNodHRwfHNpZXZlfHNpcHM/fHNreXBlfHNtW2JzXXxzbm1wfHNvYXBcXC5iZWVwcz98c29sZGF0fHNwb3RpZnl8c3NofHN0ZWFtfHN2bnx0YWd8dGVhbXNwZWFrfHRlbCg/Om5ldCk/fHRmdHB8dGhpbmdzfHRoaXNtZXNzYWdlfHRpcHx0bjMyNzB8dHZ8dWRwfHVucmVhbHx1cm58dXQyMDA0fHZlbW1pfHZlbnRyaWxvfHZpZXctc291cmNlfHdlYmNhbHx3c3M/fHd0YWl8d3ljaXd5Z3x4Y29uKD86LXVzZXJpZCk/fHhmaXJlfHhtbHJwY1xcLmJlZXBzP3x4bXBwfHhyaXx5bXNncnx6MzlcXC41MFtyc10/KTooPzpcXC97MSwzfXxbYS16MC05JV0pfHd3d1xcZHswLDN9Wy5dfFthLXowLTkuXFwtXStbLl1bYS16XXsyLDR9XFwvKSg/OlteXFxzKCk8Pl18XFwoW15cXHMoKTw+XSpcXCkpKyg/OlxcKFteXFxzKCk8Pl0qXFwpfFteXFxzYCohKClcXFtcXF17fTs6J1wiLiw8Pj/Cq8K74oCc4oCd4oCY4oCZXSkpL2lcblxuQ29kZU1pcnJvci5kZWZpbmVNb2RlKFwiZ2ZtXCIsIGZ1bmN0aW9uKGNvbmZpZywgbW9kZUNvbmZpZykge1xuICB2YXIgY29kZURlcHRoID0gMDtcbiAgZnVuY3Rpb24gYmxhbmtMaW5lKHN0YXRlKSB7XG4gICAgc3RhdGUuY29kZSA9IGZhbHNlO1xuICAgIHJldHVybiBudWxsO1xuICB9XG4gIHZhciBnZm1PdmVybGF5ID0ge1xuICAgIHN0YXJ0U3RhdGU6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgY29kZTogZmFsc2UsXG4gICAgICAgIGNvZGVCbG9jazogZmFsc2UsXG4gICAgICAgIGF0ZVNwYWNlOiBmYWxzZVxuICAgICAgfTtcbiAgICB9LFxuICAgIGNvcHlTdGF0ZTogZnVuY3Rpb24ocykge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgY29kZTogcy5jb2RlLFxuICAgICAgICBjb2RlQmxvY2s6IHMuY29kZUJsb2NrLFxuICAgICAgICBhdGVTcGFjZTogcy5hdGVTcGFjZVxuICAgICAgfTtcbiAgICB9LFxuICAgIHRva2VuOiBmdW5jdGlvbihzdHJlYW0sIHN0YXRlKSB7XG4gICAgICBzdGF0ZS5jb21iaW5lVG9rZW5zID0gbnVsbDtcblxuICAgICAgLy8gSGFjayB0byBwcmV2ZW50IGZvcm1hdHRpbmcgb3ZlcnJpZGUgaW5zaWRlIGNvZGUgYmxvY2tzIChibG9jayBhbmQgaW5saW5lKVxuICAgICAgaWYgKHN0YXRlLmNvZGVCbG9jaykge1xuICAgICAgICBpZiAoc3RyZWFtLm1hdGNoKC9eYGBgKy8pKSB7XG4gICAgICAgICAgc3RhdGUuY29kZUJsb2NrID0gZmFsc2U7XG4gICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgc3RyZWFtLnNraXBUb0VuZCgpO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cbiAgICAgIGlmIChzdHJlYW0uc29sKCkpIHtcbiAgICAgICAgc3RhdGUuY29kZSA9IGZhbHNlO1xuICAgICAgfVxuICAgICAgaWYgKHN0cmVhbS5zb2woKSAmJiBzdHJlYW0ubWF0Y2goL15gYGArLykpIHtcbiAgICAgICAgc3RyZWFtLnNraXBUb0VuZCgpO1xuICAgICAgICBzdGF0ZS5jb2RlQmxvY2sgPSB0cnVlO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cbiAgICAgIC8vIElmIHRoaXMgYmxvY2sgaXMgY2hhbmdlZCwgaXQgbWF5IG5lZWQgdG8gYmUgdXBkYXRlZCBpbiBNYXJrZG93biBtb2RlXG4gICAgICBpZiAoc3RyZWFtLnBlZWsoKSA9PT0gJ2AnKSB7XG4gICAgICAgIHN0cmVhbS5uZXh0KCk7XG4gICAgICAgIHZhciBiZWZvcmUgPSBzdHJlYW0ucG9zO1xuICAgICAgICBzdHJlYW0uZWF0V2hpbGUoJ2AnKTtcbiAgICAgICAgdmFyIGRpZmZlcmVuY2UgPSAxICsgc3RyZWFtLnBvcyAtIGJlZm9yZTtcbiAgICAgICAgaWYgKCFzdGF0ZS5jb2RlKSB7XG4gICAgICAgICAgY29kZURlcHRoID0gZGlmZmVyZW5jZTtcbiAgICAgICAgICBzdGF0ZS5jb2RlID0gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpZiAoZGlmZmVyZW5jZSA9PT0gY29kZURlcHRoKSB7IC8vIE11c3QgYmUgZXhhY3RcbiAgICAgICAgICAgIHN0YXRlLmNvZGUgPSBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9IGVsc2UgaWYgKHN0YXRlLmNvZGUpIHtcbiAgICAgICAgc3RyZWFtLm5leHQoKTtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9XG4gICAgICAvLyBDaGVjayBpZiBzcGFjZS4gSWYgc28sIGxpbmtzIGNhbiBiZSBmb3JtYXR0ZWQgbGF0ZXIgb25cbiAgICAgIGlmIChzdHJlYW0uZWF0U3BhY2UoKSkge1xuICAgICAgICBzdGF0ZS5hdGVTcGFjZSA9IHRydWU7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuICAgICAgaWYgKHN0cmVhbS5zb2woKSB8fCBzdGF0ZS5hdGVTcGFjZSkge1xuICAgICAgICBzdGF0ZS5hdGVTcGFjZSA9IGZhbHNlO1xuICAgICAgICBpZiAobW9kZUNvbmZpZy5naXRIdWJTcGljZSAhPT0gZmFsc2UpIHtcbiAgICAgICAgICBpZihzdHJlYW0ubWF0Y2goL14oPzpbYS16QS1aMC05XFwtX10rXFwvKT8oPzpbYS16QS1aMC05XFwtX10rQCk/KD86W2EtZjAtOV17Nyw0MH1cXGIpLykpIHtcbiAgICAgICAgICAgIC8vIFVzZXIvUHJvamVjdEBTSEFcbiAgICAgICAgICAgIC8vIFVzZXJAU0hBXG4gICAgICAgICAgICAvLyBTSEFcbiAgICAgICAgICAgIHN0YXRlLmNvbWJpbmVUb2tlbnMgPSB0cnVlO1xuICAgICAgICAgICAgcmV0dXJuIFwibGlua1wiO1xuICAgICAgICAgIH0gZWxzZSBpZiAoc3RyZWFtLm1hdGNoKC9eKD86W2EtekEtWjAtOVxcLV9dK1xcLyk/KD86W2EtekEtWjAtOVxcLV9dKyk/I1swLTldK1xcYi8pKSB7XG4gICAgICAgICAgICAvLyBVc2VyL1Byb2plY3QjTnVtXG4gICAgICAgICAgICAvLyBVc2VyI051bVxuICAgICAgICAgICAgLy8gI051bVxuICAgICAgICAgICAgc3RhdGUuY29tYmluZVRva2VucyA9IHRydWU7XG4gICAgICAgICAgICByZXR1cm4gXCJsaW5rXCI7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAoc3RyZWFtLm1hdGNoKHVybFJFKSAmJlxuICAgICAgICAgIHN0cmVhbS5zdHJpbmcuc2xpY2Uoc3RyZWFtLnN0YXJ0IC0gMiwgc3RyZWFtLnN0YXJ0KSAhPSBcIl0oXCIgJiZcbiAgICAgICAgICAoc3RyZWFtLnN0YXJ0ID09IDAgfHwgL1xcVy8udGVzdChzdHJlYW0uc3RyaW5nLmNoYXJBdChzdHJlYW0uc3RhcnQgLSAxKSkpKSB7XG4gICAgICAgIC8vIFVSTHNcbiAgICAgICAgLy8gVGFrZW4gZnJvbSBodHRwOi8vZGFyaW5nZmlyZWJhbGwubmV0LzIwMTAvMDcvaW1wcm92ZWRfcmVnZXhfZm9yX21hdGNoaW5nX3VybHNcbiAgICAgICAgLy8gQW5kIHRoZW4gKGlzc3VlICMxMTYwKSBzaW1wbGlmaWVkIHRvIG1ha2UgaXQgbm90IGNyYXNoIHRoZSBDaHJvbWUgUmVnZXhwIGVuZ2luZVxuICAgICAgICAvLyBBbmQgdGhlbiBsaW1pdGVkIHVybCBzY2hlbWVzIHRvIHRoZSBDb21tb25NYXJrIGxpc3QsIHNvIGZvbzpiYXIgaXNuJ3QgbWF0Y2hlZCBhcyBhIFVSTFxuICAgICAgICBzdGF0ZS5jb21iaW5lVG9rZW5zID0gdHJ1ZTtcbiAgICAgICAgcmV0dXJuIFwibGlua1wiO1xuICAgICAgfVxuICAgICAgc3RyZWFtLm5leHQoKTtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH0sXG4gICAgYmxhbmtMaW5lOiBibGFua0xpbmVcbiAgfTtcblxuICB2YXIgbWFya2Rvd25Db25maWcgPSB7XG4gICAgdW5kZXJzY29yZXNCcmVha1dvcmRzOiBmYWxzZSxcbiAgICB0YXNrTGlzdHM6IHRydWUsXG4gICAgZmVuY2VkQ29kZUJsb2NrczogJ2BgYCcsXG4gICAgc3RyaWtldGhyb3VnaDogdHJ1ZVxuICB9O1xuICBmb3IgKHZhciBhdHRyIGluIG1vZGVDb25maWcpIHtcbiAgICBtYXJrZG93bkNvbmZpZ1thdHRyXSA9IG1vZGVDb25maWdbYXR0cl07XG4gIH1cbiAgbWFya2Rvd25Db25maWcubmFtZSA9IFwibWFya2Rvd25cIjtcbiAgcmV0dXJuIENvZGVNaXJyb3Iub3ZlcmxheU1vZGUoQ29kZU1pcnJvci5nZXRNb2RlKGNvbmZpZywgbWFya2Rvd25Db25maWcpLCBnZm1PdmVybGF5KTtcblxufSwgXCJtYXJrZG93blwiKTtcblxuICBDb2RlTWlycm9yLmRlZmluZU1JTUUoXCJ0ZXh0L3gtZ2ZtXCIsIFwiZ2ZtXCIpO1xufSk7XG4iLCIvLyBDb2RlTWlycm9yLCBjb3B5cmlnaHQgKGMpIGJ5IE1hcmlqbiBIYXZlcmJla2UgYW5kIG90aGVyc1xuLy8gRGlzdHJpYnV0ZWQgdW5kZXIgYW4gTUlUIGxpY2Vuc2U6IGh0dHA6Ly9jb2RlbWlycm9yLm5ldC9MSUNFTlNFXG5cbihmdW5jdGlvbihtb2QpIHtcbiAgaWYgKHR5cGVvZiBleHBvcnRzID09IFwib2JqZWN0XCIgJiYgdHlwZW9mIG1vZHVsZSA9PSBcIm9iamVjdFwiKSAvLyBDb21tb25KU1xuICAgIG1vZChyZXF1aXJlKFwiLi4vLi4vbGliL2NvZGVtaXJyb3JcIiksIHJlcXVpcmUoXCIuLi94bWwveG1sXCIpLCByZXF1aXJlKFwiLi4vbWV0YVwiKSk7XG4gIGVsc2UgaWYgKHR5cGVvZiBkZWZpbmUgPT0gXCJmdW5jdGlvblwiICYmIGRlZmluZS5hbWQpIC8vIEFNRFxuICAgIGRlZmluZShbXCIuLi8uLi9saWIvY29kZW1pcnJvclwiLCBcIi4uL3htbC94bWxcIiwgXCIuLi9tZXRhXCJdLCBtb2QpO1xuICBlbHNlIC8vIFBsYWluIGJyb3dzZXIgZW52XG4gICAgbW9kKENvZGVNaXJyb3IpO1xufSkoZnVuY3Rpb24oQ29kZU1pcnJvcikge1xuXCJ1c2Ugc3RyaWN0XCI7XG5cbkNvZGVNaXJyb3IuZGVmaW5lTW9kZShcIm1hcmtkb3duXCIsIGZ1bmN0aW9uKGNtQ2ZnLCBtb2RlQ2ZnKSB7XG5cbiAgdmFyIGh0bWxGb3VuZCA9IENvZGVNaXJyb3IubW9kZXMuaGFzT3duUHJvcGVydHkoXCJ4bWxcIik7XG4gIHZhciBodG1sTW9kZSA9IENvZGVNaXJyb3IuZ2V0TW9kZShjbUNmZywgaHRtbEZvdW5kID8ge25hbWU6IFwieG1sXCIsIGh0bWxNb2RlOiB0cnVlfSA6IFwidGV4dC9wbGFpblwiKTtcblxuICBmdW5jdGlvbiBnZXRNb2RlKG5hbWUpIHtcbiAgICBpZiAoQ29kZU1pcnJvci5maW5kTW9kZUJ5TmFtZSkge1xuICAgICAgdmFyIGZvdW5kID0gQ29kZU1pcnJvci5maW5kTW9kZUJ5TmFtZShuYW1lKTtcbiAgICAgIGlmIChmb3VuZCkgbmFtZSA9IGZvdW5kLm1pbWUgfHwgZm91bmQubWltZXNbMF07XG4gICAgfVxuICAgIHZhciBtb2RlID0gQ29kZU1pcnJvci5nZXRNb2RlKGNtQ2ZnLCBuYW1lKTtcbiAgICByZXR1cm4gbW9kZS5uYW1lID09IFwibnVsbFwiID8gbnVsbCA6IG1vZGU7XG4gIH1cblxuICAvLyBTaG91bGQgY2hhcmFjdGVycyB0aGF0IGFmZmVjdCBoaWdobGlnaHRpbmcgYmUgaGlnaGxpZ2h0ZWQgc2VwYXJhdGU/XG4gIC8vIERvZXMgbm90IGluY2x1ZGUgY2hhcmFjdGVycyB0aGF0IHdpbGwgYmUgb3V0cHV0IChzdWNoIGFzIGAxLmAgYW5kIGAtYCBmb3IgbGlzdHMpXG4gIGlmIChtb2RlQ2ZnLmhpZ2hsaWdodEZvcm1hdHRpbmcgPT09IHVuZGVmaW5lZClcbiAgICBtb2RlQ2ZnLmhpZ2hsaWdodEZvcm1hdHRpbmcgPSBmYWxzZTtcblxuICAvLyBNYXhpbXVtIG51bWJlciBvZiBuZXN0ZWQgYmxvY2txdW90ZXMuIFNldCB0byAwIGZvciBpbmZpbml0ZSBuZXN0aW5nLlxuICAvLyBFeGNlc3MgYD5gIHdpbGwgZW1pdCBgZXJyb3JgIHRva2VuLlxuICBpZiAobW9kZUNmZy5tYXhCbG9ja3F1b3RlRGVwdGggPT09IHVuZGVmaW5lZClcbiAgICBtb2RlQ2ZnLm1heEJsb2NrcXVvdGVEZXB0aCA9IDA7XG5cbiAgLy8gU2hvdWxkIHVuZGVyc2NvcmVzIGluIHdvcmRzIG9wZW4vY2xvc2UgZW0vc3Ryb25nP1xuICBpZiAobW9kZUNmZy51bmRlcnNjb3Jlc0JyZWFrV29yZHMgPT09IHVuZGVmaW5lZClcbiAgICBtb2RlQ2ZnLnVuZGVyc2NvcmVzQnJlYWtXb3JkcyA9IHRydWU7XG5cbiAgLy8gVXNlIGBmZW5jZWRDb2RlQmxvY2tzYCB0byBjb25maWd1cmUgZmVuY2VkIGNvZGUgYmxvY2tzLiBmYWxzZSB0b1xuICAvLyBkaXNhYmxlLCBzdHJpbmcgdG8gc3BlY2lmeSBhIHByZWNpc2UgcmVnZXhwIHRoYXQgdGhlIGZlbmNlIHNob3VsZFxuICAvLyBtYXRjaCwgYW5kIHRydWUgdG8gYWxsb3cgdGhyZWUgb3IgbW9yZSBiYWNrdGlja3Mgb3IgdGlsZGVzIChhc1xuICAvLyBwZXIgQ29tbW9uTWFyaykuXG5cbiAgLy8gVHVybiBvbiB0YXNrIGxpc3RzPyAoXCItIFsgXSBcIiBhbmQgXCItIFt4XSBcIilcbiAgaWYgKG1vZGVDZmcudGFza0xpc3RzID09PSB1bmRlZmluZWQpIG1vZGVDZmcudGFza0xpc3RzID0gZmFsc2U7XG5cbiAgLy8gVHVybiBvbiBzdHJpa2V0aHJvdWdoIHN5bnRheFxuICBpZiAobW9kZUNmZy5zdHJpa2V0aHJvdWdoID09PSB1bmRlZmluZWQpXG4gICAgbW9kZUNmZy5zdHJpa2V0aHJvdWdoID0gZmFsc2U7XG5cbiAgLy8gQWxsb3cgdG9rZW4gdHlwZXMgdG8gYmUgb3ZlcnJpZGRlbiBieSB1c2VyLXByb3ZpZGVkIHRva2VuIHR5cGVzLlxuICBpZiAobW9kZUNmZy50b2tlblR5cGVPdmVycmlkZXMgPT09IHVuZGVmaW5lZClcbiAgICBtb2RlQ2ZnLnRva2VuVHlwZU92ZXJyaWRlcyA9IHt9O1xuXG4gIHZhciBjb2RlRGVwdGggPSAwO1xuXG4gIHZhciB0b2tlblR5cGVzID0ge1xuICAgIGhlYWRlcjogXCJoZWFkZXJcIixcbiAgICBjb2RlOiBcImNvbW1lbnRcIixcbiAgICBxdW90ZTogXCJxdW90ZVwiLFxuICAgIGxpc3QxOiBcInZhcmlhYmxlLTJcIixcbiAgICBsaXN0MjogXCJ2YXJpYWJsZS0zXCIsXG4gICAgbGlzdDM6IFwia2V5d29yZFwiLFxuICAgIGhyOiBcImhyXCIsXG4gICAgaW1hZ2U6IFwidGFnXCIsXG4gICAgZm9ybWF0dGluZzogXCJmb3JtYXR0aW5nXCIsXG4gICAgbGlua0lubGluZTogXCJsaW5rXCIsXG4gICAgbGlua0VtYWlsOiBcImxpbmtcIixcbiAgICBsaW5rVGV4dDogXCJsaW5rXCIsXG4gICAgbGlua0hyZWY6IFwic3RyaW5nXCIsXG4gICAgZW06IFwiZW1cIixcbiAgICBzdHJvbmc6IFwic3Ryb25nXCIsXG4gICAgc3RyaWtldGhyb3VnaDogXCJzdHJpa2V0aHJvdWdoXCJcbiAgfTtcblxuICBmb3IgKHZhciB0b2tlblR5cGUgaW4gdG9rZW5UeXBlcykge1xuICAgIGlmICh0b2tlblR5cGVzLmhhc093blByb3BlcnR5KHRva2VuVHlwZSkgJiYgbW9kZUNmZy50b2tlblR5cGVPdmVycmlkZXNbdG9rZW5UeXBlXSkge1xuICAgICAgdG9rZW5UeXBlc1t0b2tlblR5cGVdID0gbW9kZUNmZy50b2tlblR5cGVPdmVycmlkZXNbdG9rZW5UeXBlXTtcbiAgICB9XG4gIH1cblxuICB2YXIgaHJSRSA9IC9eKFsqXFwtX10pKD86XFxzKlxcMSl7Mix9XFxzKiQvXG4gICwgICB1bFJFID0gL15bKlxcLStdXFxzKy9cbiAgLCAgIG9sUkUgPSAvXlswLTldKyhbLildKVxccysvXG4gICwgICB0YXNrTGlzdFJFID0gL15cXFsoeHwgKVxcXSg/PVxccykvIC8vIE11c3QgZm9sbG93IHVsUkUgb3Igb2xSRVxuICAsICAgYXR4SGVhZGVyUkUgPSBtb2RlQ2ZnLmFsbG93QXR4SGVhZGVyV2l0aG91dFNwYWNlID8gL14oIyspLyA6IC9eKCMrKSg/OiB8JCkvXG4gICwgICBzZXRleHRIZWFkZXJSRSA9IC9eICooPzpcXD17MSx9fC17MSx9KVxccyokL1xuICAsICAgdGV4dFJFID0gL15bXiMhXFxbXFxdKl9cXFxcPD5gIFwiJyh+XSsvXG4gICwgICBmZW5jZWRDb2RlUkUgPSBuZXcgUmVnRXhwKFwiXihcIiArIChtb2RlQ2ZnLmZlbmNlZENvZGVCbG9ja3MgPT09IHRydWUgPyBcIn5+fit8YGBgK1wiIDogbW9kZUNmZy5mZW5jZWRDb2RlQmxvY2tzKSArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiKVsgXFxcXHRdKihbXFxcXHcrI10qKVwiKTtcblxuICBmdW5jdGlvbiBzd2l0Y2hJbmxpbmUoc3RyZWFtLCBzdGF0ZSwgZikge1xuICAgIHN0YXRlLmYgPSBzdGF0ZS5pbmxpbmUgPSBmO1xuICAgIHJldHVybiBmKHN0cmVhbSwgc3RhdGUpO1xuICB9XG5cbiAgZnVuY3Rpb24gc3dpdGNoQmxvY2soc3RyZWFtLCBzdGF0ZSwgZikge1xuICAgIHN0YXRlLmYgPSBzdGF0ZS5ibG9jayA9IGY7XG4gICAgcmV0dXJuIGYoc3RyZWFtLCBzdGF0ZSk7XG4gIH1cblxuICBmdW5jdGlvbiBsaW5lSXNFbXB0eShsaW5lKSB7XG4gICAgcmV0dXJuICFsaW5lIHx8ICEvXFxTLy50ZXN0KGxpbmUuc3RyaW5nKVxuICB9XG5cbiAgLy8gQmxvY2tzXG5cbiAgZnVuY3Rpb24gYmxhbmtMaW5lKHN0YXRlKSB7XG4gICAgLy8gUmVzZXQgbGlua1RpdGxlIHN0YXRlXG4gICAgc3RhdGUubGlua1RpdGxlID0gZmFsc2U7XG4gICAgLy8gUmVzZXQgRU0gc3RhdGVcbiAgICBzdGF0ZS5lbSA9IGZhbHNlO1xuICAgIC8vIFJlc2V0IFNUUk9ORyBzdGF0ZVxuICAgIHN0YXRlLnN0cm9uZyA9IGZhbHNlO1xuICAgIC8vIFJlc2V0IHN0cmlrZXRocm91Z2ggc3RhdGVcbiAgICBzdGF0ZS5zdHJpa2V0aHJvdWdoID0gZmFsc2U7XG4gICAgLy8gUmVzZXQgc3RhdGUucXVvdGVcbiAgICBzdGF0ZS5xdW90ZSA9IDA7XG4gICAgLy8gUmVzZXQgc3RhdGUuaW5kZW50ZWRDb2RlXG4gICAgc3RhdGUuaW5kZW50ZWRDb2RlID0gZmFsc2U7XG4gICAgaWYgKCFodG1sRm91bmQgJiYgc3RhdGUuZiA9PSBodG1sQmxvY2spIHtcbiAgICAgIHN0YXRlLmYgPSBpbmxpbmVOb3JtYWw7XG4gICAgICBzdGF0ZS5ibG9jayA9IGJsb2NrTm9ybWFsO1xuICAgIH1cbiAgICAvLyBSZXNldCBzdGF0ZS50cmFpbGluZ1NwYWNlXG4gICAgc3RhdGUudHJhaWxpbmdTcGFjZSA9IDA7XG4gICAgc3RhdGUudHJhaWxpbmdTcGFjZU5ld0xpbmUgPSBmYWxzZTtcbiAgICAvLyBNYXJrIHRoaXMgbGluZSBhcyBibGFua1xuICAgIHN0YXRlLnByZXZMaW5lID0gc3RhdGUudGhpc0xpbmVcbiAgICBzdGF0ZS50aGlzTGluZSA9IG51bGxcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIGZ1bmN0aW9uIGJsb2NrTm9ybWFsKHN0cmVhbSwgc3RhdGUpIHtcblxuICAgIHZhciBzb2wgPSBzdHJlYW0uc29sKCk7XG5cbiAgICB2YXIgcHJldkxpbmVJc0xpc3QgPSBzdGF0ZS5saXN0ICE9PSBmYWxzZSxcbiAgICAgICAgcHJldkxpbmVJc0luZGVudGVkQ29kZSA9IHN0YXRlLmluZGVudGVkQ29kZTtcblxuICAgIHN0YXRlLmluZGVudGVkQ29kZSA9IGZhbHNlO1xuXG4gICAgaWYgKHByZXZMaW5lSXNMaXN0KSB7XG4gICAgICBpZiAoc3RhdGUuaW5kZW50YXRpb25EaWZmID49IDApIHsgLy8gQ29udGludWVkIGxpc3RcbiAgICAgICAgaWYgKHN0YXRlLmluZGVudGF0aW9uRGlmZiA8IDQpIHsgLy8gT25seSBhZGp1c3QgaW5kZW50YXRpb24gaWYgKm5vdCogYSBjb2RlIGJsb2NrXG4gICAgICAgICAgc3RhdGUuaW5kZW50YXRpb24gLT0gc3RhdGUuaW5kZW50YXRpb25EaWZmO1xuICAgICAgICB9XG4gICAgICAgIHN0YXRlLmxpc3QgPSBudWxsO1xuICAgICAgfSBlbHNlIGlmIChzdGF0ZS5pbmRlbnRhdGlvbiA+IDApIHtcbiAgICAgICAgc3RhdGUubGlzdCA9IG51bGw7XG4gICAgICAgIHN0YXRlLmxpc3REZXB0aCA9IE1hdGguZmxvb3Ioc3RhdGUuaW5kZW50YXRpb24gLyA0KTtcbiAgICAgIH0gZWxzZSB7IC8vIE5vIGxvbmdlciBhIGxpc3RcbiAgICAgICAgc3RhdGUubGlzdCA9IGZhbHNlO1xuICAgICAgICBzdGF0ZS5saXN0RGVwdGggPSAwO1xuICAgICAgfVxuICAgIH1cblxuICAgIHZhciBtYXRjaCA9IG51bGw7XG4gICAgaWYgKHN0YXRlLmluZGVudGF0aW9uRGlmZiA+PSA0KSB7XG4gICAgICBzdHJlYW0uc2tpcFRvRW5kKCk7XG4gICAgICBpZiAocHJldkxpbmVJc0luZGVudGVkQ29kZSB8fCBsaW5lSXNFbXB0eShzdGF0ZS5wcmV2TGluZSkpIHtcbiAgICAgICAgc3RhdGUuaW5kZW50YXRpb24gLT0gNDtcbiAgICAgICAgc3RhdGUuaW5kZW50ZWRDb2RlID0gdHJ1ZTtcbiAgICAgICAgcmV0dXJuIHRva2VuVHlwZXMuY29kZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoc3RyZWFtLmVhdFNwYWNlKCkpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH0gZWxzZSBpZiAoKG1hdGNoID0gc3RyZWFtLm1hdGNoKGF0eEhlYWRlclJFKSkgJiYgbWF0Y2hbMV0ubGVuZ3RoIDw9IDYpIHtcbiAgICAgIHN0YXRlLmhlYWRlciA9IG1hdGNoWzFdLmxlbmd0aDtcbiAgICAgIGlmIChtb2RlQ2ZnLmhpZ2hsaWdodEZvcm1hdHRpbmcpIHN0YXRlLmZvcm1hdHRpbmcgPSBcImhlYWRlclwiO1xuICAgICAgc3RhdGUuZiA9IHN0YXRlLmlubGluZTtcbiAgICAgIHJldHVybiBnZXRUeXBlKHN0YXRlKTtcbiAgICB9IGVsc2UgaWYgKCFsaW5lSXNFbXB0eShzdGF0ZS5wcmV2TGluZSkgJiYgIXN0YXRlLnF1b3RlICYmICFwcmV2TGluZUlzTGlzdCAmJlxuICAgICAgICAgICAgICAgIXByZXZMaW5lSXNJbmRlbnRlZENvZGUgJiYgKG1hdGNoID0gc3RyZWFtLm1hdGNoKHNldGV4dEhlYWRlclJFKSkpIHtcbiAgICAgIHN0YXRlLmhlYWRlciA9IG1hdGNoWzBdLmNoYXJBdCgwKSA9PSAnPScgPyAxIDogMjtcbiAgICAgIGlmIChtb2RlQ2ZnLmhpZ2hsaWdodEZvcm1hdHRpbmcpIHN0YXRlLmZvcm1hdHRpbmcgPSBcImhlYWRlclwiO1xuICAgICAgc3RhdGUuZiA9IHN0YXRlLmlubGluZTtcbiAgICAgIHJldHVybiBnZXRUeXBlKHN0YXRlKTtcbiAgICB9IGVsc2UgaWYgKHN0cmVhbS5lYXQoJz4nKSkge1xuICAgICAgc3RhdGUucXVvdGUgPSBzb2wgPyAxIDogc3RhdGUucXVvdGUgKyAxO1xuICAgICAgaWYgKG1vZGVDZmcuaGlnaGxpZ2h0Rm9ybWF0dGluZykgc3RhdGUuZm9ybWF0dGluZyA9IFwicXVvdGVcIjtcbiAgICAgIHN0cmVhbS5lYXRTcGFjZSgpO1xuICAgICAgcmV0dXJuIGdldFR5cGUoc3RhdGUpO1xuICAgIH0gZWxzZSBpZiAoc3RyZWFtLnBlZWsoKSA9PT0gJ1snKSB7XG4gICAgICByZXR1cm4gc3dpdGNoSW5saW5lKHN0cmVhbSwgc3RhdGUsIGZvb3Rub3RlTGluayk7XG4gICAgfSBlbHNlIGlmIChzdHJlYW0ubWF0Y2goaHJSRSwgdHJ1ZSkpIHtcbiAgICAgIHN0YXRlLmhyID0gdHJ1ZTtcbiAgICAgIHJldHVybiB0b2tlblR5cGVzLmhyO1xuICAgIH0gZWxzZSBpZiAoKGxpbmVJc0VtcHR5KHN0YXRlLnByZXZMaW5lKSB8fCBwcmV2TGluZUlzTGlzdCkgJiYgKHN0cmVhbS5tYXRjaCh1bFJFLCBmYWxzZSkgfHwgc3RyZWFtLm1hdGNoKG9sUkUsIGZhbHNlKSkpIHtcbiAgICAgIHZhciBsaXN0VHlwZSA9IG51bGw7XG4gICAgICBpZiAoc3RyZWFtLm1hdGNoKHVsUkUsIHRydWUpKSB7XG4gICAgICAgIGxpc3RUeXBlID0gJ3VsJztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHN0cmVhbS5tYXRjaChvbFJFLCB0cnVlKTtcbiAgICAgICAgbGlzdFR5cGUgPSAnb2wnO1xuICAgICAgfVxuICAgICAgc3RhdGUuaW5kZW50YXRpb24gPSBzdHJlYW0uY29sdW1uKCkgKyBzdHJlYW0uY3VycmVudCgpLmxlbmd0aDtcbiAgICAgIHN0YXRlLmxpc3QgPSB0cnVlO1xuICAgICAgc3RhdGUubGlzdERlcHRoKys7XG4gICAgICBpZiAobW9kZUNmZy50YXNrTGlzdHMgJiYgc3RyZWFtLm1hdGNoKHRhc2tMaXN0UkUsIGZhbHNlKSkge1xuICAgICAgICBzdGF0ZS50YXNrTGlzdCA9IHRydWU7XG4gICAgICB9XG4gICAgICBzdGF0ZS5mID0gc3RhdGUuaW5saW5lO1xuICAgICAgaWYgKG1vZGVDZmcuaGlnaGxpZ2h0Rm9ybWF0dGluZykgc3RhdGUuZm9ybWF0dGluZyA9IFtcImxpc3RcIiwgXCJsaXN0LVwiICsgbGlzdFR5cGVdO1xuICAgICAgcmV0dXJuIGdldFR5cGUoc3RhdGUpO1xuICAgIH0gZWxzZSBpZiAobW9kZUNmZy5mZW5jZWRDb2RlQmxvY2tzICYmIChtYXRjaCA9IHN0cmVhbS5tYXRjaChmZW5jZWRDb2RlUkUsIHRydWUpKSkge1xuICAgICAgc3RhdGUuZmVuY2VkQ2hhcnMgPSBtYXRjaFsxXVxuICAgICAgLy8gdHJ5IHN3aXRjaGluZyBtb2RlXG4gICAgICBzdGF0ZS5sb2NhbE1vZGUgPSBnZXRNb2RlKG1hdGNoWzJdKTtcbiAgICAgIGlmIChzdGF0ZS5sb2NhbE1vZGUpIHN0YXRlLmxvY2FsU3RhdGUgPSBzdGF0ZS5sb2NhbE1vZGUuc3RhcnRTdGF0ZSgpO1xuICAgICAgc3RhdGUuZiA9IHN0YXRlLmJsb2NrID0gbG9jYWw7XG4gICAgICBpZiAobW9kZUNmZy5oaWdobGlnaHRGb3JtYXR0aW5nKSBzdGF0ZS5mb3JtYXR0aW5nID0gXCJjb2RlLWJsb2NrXCI7XG4gICAgICBzdGF0ZS5jb2RlID0gdHJ1ZTtcbiAgICAgIHJldHVybiBnZXRUeXBlKHN0YXRlKTtcbiAgICB9XG5cbiAgICByZXR1cm4gc3dpdGNoSW5saW5lKHN0cmVhbSwgc3RhdGUsIHN0YXRlLmlubGluZSk7XG4gIH1cblxuICBmdW5jdGlvbiBodG1sQmxvY2soc3RyZWFtLCBzdGF0ZSkge1xuICAgIHZhciBzdHlsZSA9IGh0bWxNb2RlLnRva2VuKHN0cmVhbSwgc3RhdGUuaHRtbFN0YXRlKTtcbiAgICBpZiAoKGh0bWxGb3VuZCAmJiBzdGF0ZS5odG1sU3RhdGUudGFnU3RhcnQgPT09IG51bGwgJiZcbiAgICAgICAgICghc3RhdGUuaHRtbFN0YXRlLmNvbnRleHQgJiYgc3RhdGUuaHRtbFN0YXRlLnRva2VuaXplLmlzSW5UZXh0KSkgfHxcbiAgICAgICAgKHN0YXRlLm1kX2luc2lkZSAmJiBzdHJlYW0uY3VycmVudCgpLmluZGV4T2YoXCI+XCIpID4gLTEpKSB7XG4gICAgICBzdGF0ZS5mID0gaW5saW5lTm9ybWFsO1xuICAgICAgc3RhdGUuYmxvY2sgPSBibG9ja05vcm1hbDtcbiAgICAgIHN0YXRlLmh0bWxTdGF0ZSA9IG51bGw7XG4gICAgfVxuICAgIHJldHVybiBzdHlsZTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGxvY2FsKHN0cmVhbSwgc3RhdGUpIHtcbiAgICBpZiAoc3RhdGUuZmVuY2VkQ2hhcnMgJiYgc3RyZWFtLm1hdGNoKHN0YXRlLmZlbmNlZENoYXJzLCBmYWxzZSkpIHtcbiAgICAgIHN0YXRlLmxvY2FsTW9kZSA9IHN0YXRlLmxvY2FsU3RhdGUgPSBudWxsO1xuICAgICAgc3RhdGUuZiA9IHN0YXRlLmJsb2NrID0gbGVhdmluZ0xvY2FsO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfSBlbHNlIGlmIChzdGF0ZS5sb2NhbE1vZGUpIHtcbiAgICAgIHJldHVybiBzdGF0ZS5sb2NhbE1vZGUudG9rZW4oc3RyZWFtLCBzdGF0ZS5sb2NhbFN0YXRlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc3RyZWFtLnNraXBUb0VuZCgpO1xuICAgICAgcmV0dXJuIHRva2VuVHlwZXMuY29kZTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBsZWF2aW5nTG9jYWwoc3RyZWFtLCBzdGF0ZSkge1xuICAgIHN0cmVhbS5tYXRjaChzdGF0ZS5mZW5jZWRDaGFycyk7XG4gICAgc3RhdGUuYmxvY2sgPSBibG9ja05vcm1hbDtcbiAgICBzdGF0ZS5mID0gaW5saW5lTm9ybWFsO1xuICAgIHN0YXRlLmZlbmNlZENoYXJzID0gbnVsbDtcbiAgICBpZiAobW9kZUNmZy5oaWdobGlnaHRGb3JtYXR0aW5nKSBzdGF0ZS5mb3JtYXR0aW5nID0gXCJjb2RlLWJsb2NrXCI7XG4gICAgc3RhdGUuY29kZSA9IHRydWU7XG4gICAgdmFyIHJldHVyblR5cGUgPSBnZXRUeXBlKHN0YXRlKTtcbiAgICBzdGF0ZS5jb2RlID0gZmFsc2U7XG4gICAgcmV0dXJuIHJldHVyblR5cGU7XG4gIH1cblxuICAvLyBJbmxpbmVcbiAgZnVuY3Rpb24gZ2V0VHlwZShzdGF0ZSkge1xuICAgIHZhciBzdHlsZXMgPSBbXTtcblxuICAgIGlmIChzdGF0ZS5mb3JtYXR0aW5nKSB7XG4gICAgICBzdHlsZXMucHVzaCh0b2tlblR5cGVzLmZvcm1hdHRpbmcpO1xuXG4gICAgICBpZiAodHlwZW9mIHN0YXRlLmZvcm1hdHRpbmcgPT09IFwic3RyaW5nXCIpIHN0YXRlLmZvcm1hdHRpbmcgPSBbc3RhdGUuZm9ybWF0dGluZ107XG5cbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc3RhdGUuZm9ybWF0dGluZy5sZW5ndGg7IGkrKykge1xuICAgICAgICBzdHlsZXMucHVzaCh0b2tlblR5cGVzLmZvcm1hdHRpbmcgKyBcIi1cIiArIHN0YXRlLmZvcm1hdHRpbmdbaV0pO1xuXG4gICAgICAgIGlmIChzdGF0ZS5mb3JtYXR0aW5nW2ldID09PSBcImhlYWRlclwiKSB7XG4gICAgICAgICAgc3R5bGVzLnB1c2godG9rZW5UeXBlcy5mb3JtYXR0aW5nICsgXCItXCIgKyBzdGF0ZS5mb3JtYXR0aW5nW2ldICsgXCItXCIgKyBzdGF0ZS5oZWFkZXIpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQWRkIGBmb3JtYXR0aW5nLXF1b3RlYCBhbmQgYGZvcm1hdHRpbmctcXVvdGUtI2AgZm9yIGJsb2NrcXVvdGVzXG4gICAgICAgIC8vIEFkZCBgZXJyb3JgIGluc3RlYWQgaWYgdGhlIG1heGltdW0gYmxvY2txdW90ZSBuZXN0aW5nIGRlcHRoIGlzIHBhc3NlZFxuICAgICAgICBpZiAoc3RhdGUuZm9ybWF0dGluZ1tpXSA9PT0gXCJxdW90ZVwiKSB7XG4gICAgICAgICAgaWYgKCFtb2RlQ2ZnLm1heEJsb2NrcXVvdGVEZXB0aCB8fCBtb2RlQ2ZnLm1heEJsb2NrcXVvdGVEZXB0aCA+PSBzdGF0ZS5xdW90ZSkge1xuICAgICAgICAgICAgc3R5bGVzLnB1c2godG9rZW5UeXBlcy5mb3JtYXR0aW5nICsgXCItXCIgKyBzdGF0ZS5mb3JtYXR0aW5nW2ldICsgXCItXCIgKyBzdGF0ZS5xdW90ZSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHN0eWxlcy5wdXNoKFwiZXJyb3JcIik7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKHN0YXRlLnRhc2tPcGVuKSB7XG4gICAgICBzdHlsZXMucHVzaChcIm1ldGFcIik7XG4gICAgICByZXR1cm4gc3R5bGVzLmxlbmd0aCA/IHN0eWxlcy5qb2luKCcgJykgOiBudWxsO1xuICAgIH1cbiAgICBpZiAoc3RhdGUudGFza0Nsb3NlZCkge1xuICAgICAgc3R5bGVzLnB1c2goXCJwcm9wZXJ0eVwiKTtcbiAgICAgIHJldHVybiBzdHlsZXMubGVuZ3RoID8gc3R5bGVzLmpvaW4oJyAnKSA6IG51bGw7XG4gICAgfVxuXG4gICAgaWYgKHN0YXRlLmxpbmtIcmVmKSB7XG4gICAgICBzdHlsZXMucHVzaCh0b2tlblR5cGVzLmxpbmtIcmVmLCBcInVybFwiKTtcbiAgICB9IGVsc2UgeyAvLyBPbmx5IGFwcGx5IGlubGluZSBzdHlsZXMgdG8gbm9uLXVybCB0ZXh0XG4gICAgICBpZiAoc3RhdGUuc3Ryb25nKSB7IHN0eWxlcy5wdXNoKHRva2VuVHlwZXMuc3Ryb25nKTsgfVxuICAgICAgaWYgKHN0YXRlLmVtKSB7IHN0eWxlcy5wdXNoKHRva2VuVHlwZXMuZW0pOyB9XG4gICAgICBpZiAoc3RhdGUuc3RyaWtldGhyb3VnaCkgeyBzdHlsZXMucHVzaCh0b2tlblR5cGVzLnN0cmlrZXRocm91Z2gpOyB9XG4gICAgICBpZiAoc3RhdGUubGlua1RleHQpIHsgc3R5bGVzLnB1c2godG9rZW5UeXBlcy5saW5rVGV4dCk7IH1cbiAgICAgIGlmIChzdGF0ZS5jb2RlKSB7IHN0eWxlcy5wdXNoKHRva2VuVHlwZXMuY29kZSk7IH1cbiAgICB9XG5cbiAgICBpZiAoc3RhdGUuaGVhZGVyKSB7IHN0eWxlcy5wdXNoKHRva2VuVHlwZXMuaGVhZGVyLCB0b2tlblR5cGVzLmhlYWRlciArIFwiLVwiICsgc3RhdGUuaGVhZGVyKTsgfVxuXG4gICAgaWYgKHN0YXRlLnF1b3RlKSB7XG4gICAgICBzdHlsZXMucHVzaCh0b2tlblR5cGVzLnF1b3RlKTtcblxuICAgICAgLy8gQWRkIGBxdW90ZS0jYCB3aGVyZSB0aGUgbWF4aW11bSBmb3IgYCNgIGlzIG1vZGVDZmcubWF4QmxvY2txdW90ZURlcHRoXG4gICAgICBpZiAoIW1vZGVDZmcubWF4QmxvY2txdW90ZURlcHRoIHx8IG1vZGVDZmcubWF4QmxvY2txdW90ZURlcHRoID49IHN0YXRlLnF1b3RlKSB7XG4gICAgICAgIHN0eWxlcy5wdXNoKHRva2VuVHlwZXMucXVvdGUgKyBcIi1cIiArIHN0YXRlLnF1b3RlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHN0eWxlcy5wdXNoKHRva2VuVHlwZXMucXVvdGUgKyBcIi1cIiArIG1vZGVDZmcubWF4QmxvY2txdW90ZURlcHRoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoc3RhdGUubGlzdCAhPT0gZmFsc2UpIHtcbiAgICAgIHZhciBsaXN0TW9kID0gKHN0YXRlLmxpc3REZXB0aCAtIDEpICUgMztcbiAgICAgIGlmICghbGlzdE1vZCkge1xuICAgICAgICBzdHlsZXMucHVzaCh0b2tlblR5cGVzLmxpc3QxKTtcbiAgICAgIH0gZWxzZSBpZiAobGlzdE1vZCA9PT0gMSkge1xuICAgICAgICBzdHlsZXMucHVzaCh0b2tlblR5cGVzLmxpc3QyKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHN0eWxlcy5wdXNoKHRva2VuVHlwZXMubGlzdDMpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChzdGF0ZS50cmFpbGluZ1NwYWNlTmV3TGluZSkge1xuICAgICAgc3R5bGVzLnB1c2goXCJ0cmFpbGluZy1zcGFjZS1uZXctbGluZVwiKTtcbiAgICB9IGVsc2UgaWYgKHN0YXRlLnRyYWlsaW5nU3BhY2UpIHtcbiAgICAgIHN0eWxlcy5wdXNoKFwidHJhaWxpbmctc3BhY2UtXCIgKyAoc3RhdGUudHJhaWxpbmdTcGFjZSAlIDIgPyBcImFcIiA6IFwiYlwiKSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHN0eWxlcy5sZW5ndGggPyBzdHlsZXMuam9pbignICcpIDogbnVsbDtcbiAgfVxuXG4gIGZ1bmN0aW9uIGhhbmRsZVRleHQoc3RyZWFtLCBzdGF0ZSkge1xuICAgIGlmIChzdHJlYW0ubWF0Y2godGV4dFJFLCB0cnVlKSkge1xuICAgICAgcmV0dXJuIGdldFR5cGUoc3RhdGUpO1xuICAgIH1cbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9XG5cbiAgZnVuY3Rpb24gaW5saW5lTm9ybWFsKHN0cmVhbSwgc3RhdGUpIHtcbiAgICB2YXIgc3R5bGUgPSBzdGF0ZS50ZXh0KHN0cmVhbSwgc3RhdGUpO1xuICAgIGlmICh0eXBlb2Ygc3R5bGUgIT09ICd1bmRlZmluZWQnKVxuICAgICAgcmV0dXJuIHN0eWxlO1xuXG4gICAgaWYgKHN0YXRlLmxpc3QpIHsgLy8gTGlzdCBtYXJrZXIgKCosICssIC0sIDEuLCBldGMpXG4gICAgICBzdGF0ZS5saXN0ID0gbnVsbDtcbiAgICAgIHJldHVybiBnZXRUeXBlKHN0YXRlKTtcbiAgICB9XG5cbiAgICBpZiAoc3RhdGUudGFza0xpc3QpIHtcbiAgICAgIHZhciB0YXNrT3BlbiA9IHN0cmVhbS5tYXRjaCh0YXNrTGlzdFJFLCB0cnVlKVsxXSAhPT0gXCJ4XCI7XG4gICAgICBpZiAodGFza09wZW4pIHN0YXRlLnRhc2tPcGVuID0gdHJ1ZTtcbiAgICAgIGVsc2Ugc3RhdGUudGFza0Nsb3NlZCA9IHRydWU7XG4gICAgICBpZiAobW9kZUNmZy5oaWdobGlnaHRGb3JtYXR0aW5nKSBzdGF0ZS5mb3JtYXR0aW5nID0gXCJ0YXNrXCI7XG4gICAgICBzdGF0ZS50YXNrTGlzdCA9IGZhbHNlO1xuICAgICAgcmV0dXJuIGdldFR5cGUoc3RhdGUpO1xuICAgIH1cblxuICAgIHN0YXRlLnRhc2tPcGVuID0gZmFsc2U7XG4gICAgc3RhdGUudGFza0Nsb3NlZCA9IGZhbHNlO1xuXG4gICAgaWYgKHN0YXRlLmhlYWRlciAmJiBzdHJlYW0ubWF0Y2goL14jKyQvLCB0cnVlKSkge1xuICAgICAgaWYgKG1vZGVDZmcuaGlnaGxpZ2h0Rm9ybWF0dGluZykgc3RhdGUuZm9ybWF0dGluZyA9IFwiaGVhZGVyXCI7XG4gICAgICByZXR1cm4gZ2V0VHlwZShzdGF0ZSk7XG4gICAgfVxuXG4gICAgLy8gR2V0IHNvbCgpIHZhbHVlIG5vdywgYmVmb3JlIGNoYXJhY3RlciBpcyBjb25zdW1lZFxuICAgIHZhciBzb2wgPSBzdHJlYW0uc29sKCk7XG5cbiAgICB2YXIgY2ggPSBzdHJlYW0ubmV4dCgpO1xuXG4gICAgaWYgKGNoID09PSAnXFxcXCcpIHtcbiAgICAgIHN0cmVhbS5uZXh0KCk7XG4gICAgICBpZiAobW9kZUNmZy5oaWdobGlnaHRGb3JtYXR0aW5nKSB7XG4gICAgICAgIHZhciB0eXBlID0gZ2V0VHlwZShzdGF0ZSk7XG4gICAgICAgIHZhciBmb3JtYXR0aW5nRXNjYXBlID0gdG9rZW5UeXBlcy5mb3JtYXR0aW5nICsgXCItZXNjYXBlXCI7XG4gICAgICAgIHJldHVybiB0eXBlID8gdHlwZSArIFwiIFwiICsgZm9ybWF0dGluZ0VzY2FwZSA6IGZvcm1hdHRpbmdFc2NhcGU7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gTWF0Y2hlcyBsaW5rIHRpdGxlcyBwcmVzZW50IG9uIG5leHQgbGluZVxuICAgIGlmIChzdGF0ZS5saW5rVGl0bGUpIHtcbiAgICAgIHN0YXRlLmxpbmtUaXRsZSA9IGZhbHNlO1xuICAgICAgdmFyIG1hdGNoQ2ggPSBjaDtcbiAgICAgIGlmIChjaCA9PT0gJygnKSB7XG4gICAgICAgIG1hdGNoQ2ggPSAnKSc7XG4gICAgICB9XG4gICAgICBtYXRjaENoID0gKG1hdGNoQ2grJycpLnJlcGxhY2UoLyhbLj8qK14kW1xcXVxcXFwoKXt9fC1dKS9nLCBcIlxcXFwkMVwiKTtcbiAgICAgIHZhciByZWdleCA9ICdeXFxcXHMqKD86W14nICsgbWF0Y2hDaCArICdcXFxcXFxcXF0rfFxcXFxcXFxcXFxcXFxcXFx8XFxcXFxcXFwuKScgKyBtYXRjaENoO1xuICAgICAgaWYgKHN0cmVhbS5tYXRjaChuZXcgUmVnRXhwKHJlZ2V4KSwgdHJ1ZSkpIHtcbiAgICAgICAgcmV0dXJuIHRva2VuVHlwZXMubGlua0hyZWY7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gSWYgdGhpcyBibG9jayBpcyBjaGFuZ2VkLCBpdCBtYXkgbmVlZCB0byBiZSB1cGRhdGVkIGluIEdGTSBtb2RlXG4gICAgaWYgKGNoID09PSAnYCcpIHtcbiAgICAgIHZhciBwcmV2aW91c0Zvcm1hdHRpbmcgPSBzdGF0ZS5mb3JtYXR0aW5nO1xuICAgICAgaWYgKG1vZGVDZmcuaGlnaGxpZ2h0Rm9ybWF0dGluZykgc3RhdGUuZm9ybWF0dGluZyA9IFwiY29kZVwiO1xuICAgICAgdmFyIHQgPSBnZXRUeXBlKHN0YXRlKTtcbiAgICAgIHZhciBiZWZvcmUgPSBzdHJlYW0ucG9zO1xuICAgICAgc3RyZWFtLmVhdFdoaWxlKCdgJyk7XG4gICAgICB2YXIgZGlmZmVyZW5jZSA9IDEgKyBzdHJlYW0ucG9zIC0gYmVmb3JlO1xuICAgICAgaWYgKCFzdGF0ZS5jb2RlKSB7XG4gICAgICAgIGNvZGVEZXB0aCA9IGRpZmZlcmVuY2U7XG4gICAgICAgIHN0YXRlLmNvZGUgPSB0cnVlO1xuICAgICAgICByZXR1cm4gZ2V0VHlwZShzdGF0ZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoZGlmZmVyZW5jZSA9PT0gY29kZURlcHRoKSB7IC8vIE11c3QgYmUgZXhhY3RcbiAgICAgICAgICBzdGF0ZS5jb2RlID0gZmFsc2U7XG4gICAgICAgICAgcmV0dXJuIHQ7XG4gICAgICAgIH1cbiAgICAgICAgc3RhdGUuZm9ybWF0dGluZyA9IHByZXZpb3VzRm9ybWF0dGluZztcbiAgICAgICAgcmV0dXJuIGdldFR5cGUoc3RhdGUpO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoc3RhdGUuY29kZSkge1xuICAgICAgcmV0dXJuIGdldFR5cGUoc3RhdGUpO1xuICAgIH1cblxuICAgIGlmIChjaCA9PT0gJyEnICYmIHN0cmVhbS5tYXRjaCgvXFxbW15cXF1dKlxcXSA/KD86XFwofFxcWykvLCBmYWxzZSkpIHtcbiAgICAgIHN0cmVhbS5tYXRjaCgvXFxbW15cXF1dKlxcXS8pO1xuICAgICAgc3RhdGUuaW5saW5lID0gc3RhdGUuZiA9IGxpbmtIcmVmO1xuICAgICAgcmV0dXJuIHRva2VuVHlwZXMuaW1hZ2U7XG4gICAgfVxuXG4gICAgaWYgKGNoID09PSAnWycgJiYgc3RyZWFtLm1hdGNoKC8uKlxcXShcXCguKlxcKXwgP1xcWy4qXFxdKS8sIGZhbHNlKSkge1xuICAgICAgc3RhdGUubGlua1RleHQgPSB0cnVlO1xuICAgICAgaWYgKG1vZGVDZmcuaGlnaGxpZ2h0Rm9ybWF0dGluZykgc3RhdGUuZm9ybWF0dGluZyA9IFwibGlua1wiO1xuICAgICAgcmV0dXJuIGdldFR5cGUoc3RhdGUpO1xuICAgIH1cblxuICAgIGlmIChjaCA9PT0gJ10nICYmIHN0YXRlLmxpbmtUZXh0ICYmIHN0cmVhbS5tYXRjaCgvXFwoLipcXCl8ID9cXFsuKlxcXS8sIGZhbHNlKSkge1xuICAgICAgaWYgKG1vZGVDZmcuaGlnaGxpZ2h0Rm9ybWF0dGluZykgc3RhdGUuZm9ybWF0dGluZyA9IFwibGlua1wiO1xuICAgICAgdmFyIHR5cGUgPSBnZXRUeXBlKHN0YXRlKTtcbiAgICAgIHN0YXRlLmxpbmtUZXh0ID0gZmFsc2U7XG4gICAgICBzdGF0ZS5pbmxpbmUgPSBzdGF0ZS5mID0gbGlua0hyZWY7XG4gICAgICByZXR1cm4gdHlwZTtcbiAgICB9XG5cbiAgICBpZiAoY2ggPT09ICc8JyAmJiBzdHJlYW0ubWF0Y2goL14oaHR0cHM/fGZ0cHM/KTpcXC9cXC8oPzpbXlxcXFw+XXxcXFxcLikrPi8sIGZhbHNlKSkge1xuICAgICAgc3RhdGUuZiA9IHN0YXRlLmlubGluZSA9IGxpbmtJbmxpbmU7XG4gICAgICBpZiAobW9kZUNmZy5oaWdobGlnaHRGb3JtYXR0aW5nKSBzdGF0ZS5mb3JtYXR0aW5nID0gXCJsaW5rXCI7XG4gICAgICB2YXIgdHlwZSA9IGdldFR5cGUoc3RhdGUpO1xuICAgICAgaWYgKHR5cGUpe1xuICAgICAgICB0eXBlICs9IFwiIFwiO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdHlwZSA9IFwiXCI7XG4gICAgICB9XG4gICAgICByZXR1cm4gdHlwZSArIHRva2VuVHlwZXMubGlua0lubGluZTtcbiAgICB9XG5cbiAgICBpZiAoY2ggPT09ICc8JyAmJiBzdHJlYW0ubWF0Y2goL15bXj4gXFxcXF0rQCg/OlteXFxcXD5dfFxcXFwuKSs+LywgZmFsc2UpKSB7XG4gICAgICBzdGF0ZS5mID0gc3RhdGUuaW5saW5lID0gbGlua0lubGluZTtcbiAgICAgIGlmIChtb2RlQ2ZnLmhpZ2hsaWdodEZvcm1hdHRpbmcpIHN0YXRlLmZvcm1hdHRpbmcgPSBcImxpbmtcIjtcbiAgICAgIHZhciB0eXBlID0gZ2V0VHlwZShzdGF0ZSk7XG4gICAgICBpZiAodHlwZSl7XG4gICAgICAgIHR5cGUgKz0gXCIgXCI7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0eXBlID0gXCJcIjtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0eXBlICsgdG9rZW5UeXBlcy5saW5rRW1haWw7XG4gICAgfVxuXG4gICAgaWYgKGNoID09PSAnPCcgJiYgc3RyZWFtLm1hdGNoKC9eKCEtLXxcXHcpLywgZmFsc2UpKSB7XG4gICAgICB2YXIgZW5kID0gc3RyZWFtLnN0cmluZy5pbmRleE9mKFwiPlwiLCBzdHJlYW0ucG9zKTtcbiAgICAgIGlmIChlbmQgIT0gLTEpIHtcbiAgICAgICAgdmFyIGF0dHMgPSBzdHJlYW0uc3RyaW5nLnN1YnN0cmluZyhzdHJlYW0uc3RhcnQsIGVuZCk7XG4gICAgICAgIGlmICgvbWFya2Rvd25cXHMqPVxccyooJ3xcIil7MCwxfTEoJ3xcIil7MCwxfS8udGVzdChhdHRzKSkgc3RhdGUubWRfaW5zaWRlID0gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIHN0cmVhbS5iYWNrVXAoMSk7XG4gICAgICBzdGF0ZS5odG1sU3RhdGUgPSBDb2RlTWlycm9yLnN0YXJ0U3RhdGUoaHRtbE1vZGUpO1xuICAgICAgcmV0dXJuIHN3aXRjaEJsb2NrKHN0cmVhbSwgc3RhdGUsIGh0bWxCbG9jayk7XG4gICAgfVxuXG4gICAgaWYgKGNoID09PSAnPCcgJiYgc3RyZWFtLm1hdGNoKC9eXFwvXFx3Kj8+LykpIHtcbiAgICAgIHN0YXRlLm1kX2luc2lkZSA9IGZhbHNlO1xuICAgICAgcmV0dXJuIFwidGFnXCI7XG4gICAgfVxuXG4gICAgdmFyIGlnbm9yZVVuZGVyc2NvcmUgPSBmYWxzZTtcbiAgICBpZiAoIW1vZGVDZmcudW5kZXJzY29yZXNCcmVha1dvcmRzKSB7XG4gICAgICBpZiAoY2ggPT09ICdfJyAmJiBzdHJlYW0ucGVlaygpICE9PSAnXycgJiYgc3RyZWFtLm1hdGNoKC8oXFx3KS8sIGZhbHNlKSkge1xuICAgICAgICB2YXIgcHJldlBvcyA9IHN0cmVhbS5wb3MgLSAyO1xuICAgICAgICBpZiAocHJldlBvcyA+PSAwKSB7XG4gICAgICAgICAgdmFyIHByZXZDaCA9IHN0cmVhbS5zdHJpbmcuY2hhckF0KHByZXZQb3MpO1xuICAgICAgICAgIGlmIChwcmV2Q2ggIT09ICdfJyAmJiBwcmV2Q2gubWF0Y2goLyhcXHcpLywgZmFsc2UpKSB7XG4gICAgICAgICAgICBpZ25vcmVVbmRlcnNjb3JlID0gdHJ1ZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKGNoID09PSAnKicgfHwgKGNoID09PSAnXycgJiYgIWlnbm9yZVVuZGVyc2NvcmUpKSB7XG4gICAgICBpZiAoc29sICYmIHN0cmVhbS5wZWVrKCkgPT09ICcgJykge1xuICAgICAgICAvLyBEbyBub3RoaW5nLCBzdXJyb3VuZGVkIGJ5IG5ld2xpbmUgYW5kIHNwYWNlXG4gICAgICB9IGVsc2UgaWYgKHN0YXRlLnN0cm9uZyA9PT0gY2ggJiYgc3RyZWFtLmVhdChjaCkpIHsgLy8gUmVtb3ZlIFNUUk9OR1xuICAgICAgICBpZiAobW9kZUNmZy5oaWdobGlnaHRGb3JtYXR0aW5nKSBzdGF0ZS5mb3JtYXR0aW5nID0gXCJzdHJvbmdcIjtcbiAgICAgICAgdmFyIHQgPSBnZXRUeXBlKHN0YXRlKTtcbiAgICAgICAgc3RhdGUuc3Ryb25nID0gZmFsc2U7XG4gICAgICAgIHJldHVybiB0O1xuICAgICAgfSBlbHNlIGlmICghc3RhdGUuc3Ryb25nICYmIHN0cmVhbS5lYXQoY2gpKSB7IC8vIEFkZCBTVFJPTkdcbiAgICAgICAgc3RhdGUuc3Ryb25nID0gY2g7XG4gICAgICAgIGlmIChtb2RlQ2ZnLmhpZ2hsaWdodEZvcm1hdHRpbmcpIHN0YXRlLmZvcm1hdHRpbmcgPSBcInN0cm9uZ1wiO1xuICAgICAgICByZXR1cm4gZ2V0VHlwZShzdGF0ZSk7XG4gICAgICB9IGVsc2UgaWYgKHN0YXRlLmVtID09PSBjaCkgeyAvLyBSZW1vdmUgRU1cbiAgICAgICAgaWYgKG1vZGVDZmcuaGlnaGxpZ2h0Rm9ybWF0dGluZykgc3RhdGUuZm9ybWF0dGluZyA9IFwiZW1cIjtcbiAgICAgICAgdmFyIHQgPSBnZXRUeXBlKHN0YXRlKTtcbiAgICAgICAgc3RhdGUuZW0gPSBmYWxzZTtcbiAgICAgICAgcmV0dXJuIHQ7XG4gICAgICB9IGVsc2UgaWYgKCFzdGF0ZS5lbSkgeyAvLyBBZGQgRU1cbiAgICAgICAgc3RhdGUuZW0gPSBjaDtcbiAgICAgICAgaWYgKG1vZGVDZmcuaGlnaGxpZ2h0Rm9ybWF0dGluZykgc3RhdGUuZm9ybWF0dGluZyA9IFwiZW1cIjtcbiAgICAgICAgcmV0dXJuIGdldFR5cGUoc3RhdGUpO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoY2ggPT09ICcgJykge1xuICAgICAgaWYgKHN0cmVhbS5lYXQoJyonKSB8fCBzdHJlYW0uZWF0KCdfJykpIHsgLy8gUHJvYmFibHkgc3Vycm91bmRlZCBieSBzcGFjZXNcbiAgICAgICAgaWYgKHN0cmVhbS5wZWVrKCkgPT09ICcgJykgeyAvLyBTdXJyb3VuZGVkIGJ5IHNwYWNlcywgaWdub3JlXG4gICAgICAgICAgcmV0dXJuIGdldFR5cGUoc3RhdGUpO1xuICAgICAgICB9IGVsc2UgeyAvLyBOb3Qgc3Vycm91bmRlZCBieSBzcGFjZXMsIGJhY2sgdXAgcG9pbnRlclxuICAgICAgICAgIHN0cmVhbS5iYWNrVXAoMSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAobW9kZUNmZy5zdHJpa2V0aHJvdWdoKSB7XG4gICAgICBpZiAoY2ggPT09ICd+JyAmJiBzdHJlYW0uZWF0V2hpbGUoY2gpKSB7XG4gICAgICAgIGlmIChzdGF0ZS5zdHJpa2V0aHJvdWdoKSB7Ly8gUmVtb3ZlIHN0cmlrZXRocm91Z2hcbiAgICAgICAgICBpZiAobW9kZUNmZy5oaWdobGlnaHRGb3JtYXR0aW5nKSBzdGF0ZS5mb3JtYXR0aW5nID0gXCJzdHJpa2V0aHJvdWdoXCI7XG4gICAgICAgICAgdmFyIHQgPSBnZXRUeXBlKHN0YXRlKTtcbiAgICAgICAgICBzdGF0ZS5zdHJpa2V0aHJvdWdoID0gZmFsc2U7XG4gICAgICAgICAgcmV0dXJuIHQ7XG4gICAgICAgIH0gZWxzZSBpZiAoc3RyZWFtLm1hdGNoKC9eW15cXHNdLywgZmFsc2UpKSB7Ly8gQWRkIHN0cmlrZXRocm91Z2hcbiAgICAgICAgICBzdGF0ZS5zdHJpa2V0aHJvdWdoID0gdHJ1ZTtcbiAgICAgICAgICBpZiAobW9kZUNmZy5oaWdobGlnaHRGb3JtYXR0aW5nKSBzdGF0ZS5mb3JtYXR0aW5nID0gXCJzdHJpa2V0aHJvdWdoXCI7XG4gICAgICAgICAgcmV0dXJuIGdldFR5cGUoc3RhdGUpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKGNoID09PSAnICcpIHtcbiAgICAgICAgaWYgKHN0cmVhbS5tYXRjaCgvXn5+LywgdHJ1ZSkpIHsgLy8gUHJvYmFibHkgc3Vycm91bmRlZCBieSBzcGFjZVxuICAgICAgICAgIGlmIChzdHJlYW0ucGVlaygpID09PSAnICcpIHsgLy8gU3Vycm91bmRlZCBieSBzcGFjZXMsIGlnbm9yZVxuICAgICAgICAgICAgcmV0dXJuIGdldFR5cGUoc3RhdGUpO1xuICAgICAgICAgIH0gZWxzZSB7IC8vIE5vdCBzdXJyb3VuZGVkIGJ5IHNwYWNlcywgYmFjayB1cCBwb2ludGVyXG4gICAgICAgICAgICBzdHJlYW0uYmFja1VwKDIpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChjaCA9PT0gJyAnKSB7XG4gICAgICBpZiAoc3RyZWFtLm1hdGNoKC8gKyQvLCBmYWxzZSkpIHtcbiAgICAgICAgc3RhdGUudHJhaWxpbmdTcGFjZSsrO1xuICAgICAgfSBlbHNlIGlmIChzdGF0ZS50cmFpbGluZ1NwYWNlKSB7XG4gICAgICAgIHN0YXRlLnRyYWlsaW5nU3BhY2VOZXdMaW5lID0gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gZ2V0VHlwZShzdGF0ZSk7XG4gIH1cblxuICBmdW5jdGlvbiBsaW5rSW5saW5lKHN0cmVhbSwgc3RhdGUpIHtcbiAgICB2YXIgY2ggPSBzdHJlYW0ubmV4dCgpO1xuXG4gICAgaWYgKGNoID09PSBcIj5cIikge1xuICAgICAgc3RhdGUuZiA9IHN0YXRlLmlubGluZSA9IGlubGluZU5vcm1hbDtcbiAgICAgIGlmIChtb2RlQ2ZnLmhpZ2hsaWdodEZvcm1hdHRpbmcpIHN0YXRlLmZvcm1hdHRpbmcgPSBcImxpbmtcIjtcbiAgICAgIHZhciB0eXBlID0gZ2V0VHlwZShzdGF0ZSk7XG4gICAgICBpZiAodHlwZSl7XG4gICAgICAgIHR5cGUgKz0gXCIgXCI7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0eXBlID0gXCJcIjtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0eXBlICsgdG9rZW5UeXBlcy5saW5rSW5saW5lO1xuICAgIH1cblxuICAgIHN0cmVhbS5tYXRjaCgvXltePl0rLywgdHJ1ZSk7XG5cbiAgICByZXR1cm4gdG9rZW5UeXBlcy5saW5rSW5saW5lO1xuICB9XG5cbiAgZnVuY3Rpb24gbGlua0hyZWYoc3RyZWFtLCBzdGF0ZSkge1xuICAgIC8vIENoZWNrIGlmIHNwYWNlLCBhbmQgcmV0dXJuIE5VTEwgaWYgc28gKHRvIGF2b2lkIG1hcmtpbmcgdGhlIHNwYWNlKVxuICAgIGlmKHN0cmVhbS5lYXRTcGFjZSgpKXtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICB2YXIgY2ggPSBzdHJlYW0ubmV4dCgpO1xuICAgIGlmIChjaCA9PT0gJygnIHx8IGNoID09PSAnWycpIHtcbiAgICAgIHN0YXRlLmYgPSBzdGF0ZS5pbmxpbmUgPSBnZXRMaW5rSHJlZkluc2lkZShjaCA9PT0gXCIoXCIgPyBcIilcIiA6IFwiXVwiKTtcbiAgICAgIGlmIChtb2RlQ2ZnLmhpZ2hsaWdodEZvcm1hdHRpbmcpIHN0YXRlLmZvcm1hdHRpbmcgPSBcImxpbmstc3RyaW5nXCI7XG4gICAgICBzdGF0ZS5saW5rSHJlZiA9IHRydWU7XG4gICAgICByZXR1cm4gZ2V0VHlwZShzdGF0ZSk7XG4gICAgfVxuICAgIHJldHVybiAnZXJyb3InO1xuICB9XG5cbiAgZnVuY3Rpb24gZ2V0TGlua0hyZWZJbnNpZGUoZW5kQ2hhcikge1xuICAgIHJldHVybiBmdW5jdGlvbihzdHJlYW0sIHN0YXRlKSB7XG4gICAgICB2YXIgY2ggPSBzdHJlYW0ubmV4dCgpO1xuXG4gICAgICBpZiAoY2ggPT09IGVuZENoYXIpIHtcbiAgICAgICAgc3RhdGUuZiA9IHN0YXRlLmlubGluZSA9IGlubGluZU5vcm1hbDtcbiAgICAgICAgaWYgKG1vZGVDZmcuaGlnaGxpZ2h0Rm9ybWF0dGluZykgc3RhdGUuZm9ybWF0dGluZyA9IFwibGluay1zdHJpbmdcIjtcbiAgICAgICAgdmFyIHJldHVyblN0YXRlID0gZ2V0VHlwZShzdGF0ZSk7XG4gICAgICAgIHN0YXRlLmxpbmtIcmVmID0gZmFsc2U7XG4gICAgICAgIHJldHVybiByZXR1cm5TdGF0ZTtcbiAgICAgIH1cblxuICAgICAgaWYgKHN0cmVhbS5tYXRjaChpbmxpbmVSRShlbmRDaGFyKSwgdHJ1ZSkpIHtcbiAgICAgICAgc3RyZWFtLmJhY2tVcCgxKTtcbiAgICAgIH1cblxuICAgICAgc3RhdGUubGlua0hyZWYgPSB0cnVlO1xuICAgICAgcmV0dXJuIGdldFR5cGUoc3RhdGUpO1xuICAgIH07XG4gIH1cblxuICBmdW5jdGlvbiBmb290bm90ZUxpbmsoc3RyZWFtLCBzdGF0ZSkge1xuICAgIGlmIChzdHJlYW0ubWF0Y2goL14oW15cXF1cXFxcXXxcXFxcLikqXFxdOi8sIGZhbHNlKSkge1xuICAgICAgc3RhdGUuZiA9IGZvb3Rub3RlTGlua0luc2lkZTtcbiAgICAgIHN0cmVhbS5uZXh0KCk7IC8vIENvbnN1bWUgW1xuICAgICAgaWYgKG1vZGVDZmcuaGlnaGxpZ2h0Rm9ybWF0dGluZykgc3RhdGUuZm9ybWF0dGluZyA9IFwibGlua1wiO1xuICAgICAgc3RhdGUubGlua1RleHQgPSB0cnVlO1xuICAgICAgcmV0dXJuIGdldFR5cGUoc3RhdGUpO1xuICAgIH1cbiAgICByZXR1cm4gc3dpdGNoSW5saW5lKHN0cmVhbSwgc3RhdGUsIGlubGluZU5vcm1hbCk7XG4gIH1cblxuICBmdW5jdGlvbiBmb290bm90ZUxpbmtJbnNpZGUoc3RyZWFtLCBzdGF0ZSkge1xuICAgIGlmIChzdHJlYW0ubWF0Y2goL15cXF06LywgdHJ1ZSkpIHtcbiAgICAgIHN0YXRlLmYgPSBzdGF0ZS5pbmxpbmUgPSBmb290bm90ZVVybDtcbiAgICAgIGlmIChtb2RlQ2ZnLmhpZ2hsaWdodEZvcm1hdHRpbmcpIHN0YXRlLmZvcm1hdHRpbmcgPSBcImxpbmtcIjtcbiAgICAgIHZhciByZXR1cm5UeXBlID0gZ2V0VHlwZShzdGF0ZSk7XG4gICAgICBzdGF0ZS5saW5rVGV4dCA9IGZhbHNlO1xuICAgICAgcmV0dXJuIHJldHVyblR5cGU7XG4gICAgfVxuXG4gICAgc3RyZWFtLm1hdGNoKC9eKFteXFxdXFxcXF18XFxcXC4pKy8sIHRydWUpO1xuXG4gICAgcmV0dXJuIHRva2VuVHlwZXMubGlua1RleHQ7XG4gIH1cblxuICBmdW5jdGlvbiBmb290bm90ZVVybChzdHJlYW0sIHN0YXRlKSB7XG4gICAgLy8gQ2hlY2sgaWYgc3BhY2UsIGFuZCByZXR1cm4gTlVMTCBpZiBzbyAodG8gYXZvaWQgbWFya2luZyB0aGUgc3BhY2UpXG4gICAgaWYoc3RyZWFtLmVhdFNwYWNlKCkpe1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIC8vIE1hdGNoIFVSTFxuICAgIHN0cmVhbS5tYXRjaCgvXlteXFxzXSsvLCB0cnVlKTtcbiAgICAvLyBDaGVjayBmb3IgbGluayB0aXRsZVxuICAgIGlmIChzdHJlYW0ucGVlaygpID09PSB1bmRlZmluZWQpIHsgLy8gRW5kIG9mIGxpbmUsIHNldCBmbGFnIHRvIGNoZWNrIG5leHQgbGluZVxuICAgICAgc3RhdGUubGlua1RpdGxlID0gdHJ1ZTtcbiAgICB9IGVsc2UgeyAvLyBNb3JlIGNvbnRlbnQgb24gbGluZSwgY2hlY2sgaWYgbGluayB0aXRsZVxuICAgICAgc3RyZWFtLm1hdGNoKC9eKD86XFxzKyg/OlwiKD86W15cIlxcXFxdfFxcXFxcXFxcfFxcXFwuKStcInwnKD86W14nXFxcXF18XFxcXFxcXFx8XFxcXC4pKyd8XFwoKD86W14pXFxcXF18XFxcXFxcXFx8XFxcXC4pK1xcKSkpPy8sIHRydWUpO1xuICAgIH1cbiAgICBzdGF0ZS5mID0gc3RhdGUuaW5saW5lID0gaW5saW5lTm9ybWFsO1xuICAgIHJldHVybiB0b2tlblR5cGVzLmxpbmtIcmVmICsgXCIgdXJsXCI7XG4gIH1cblxuICB2YXIgc2F2ZWRJbmxpbmVSRSA9IFtdO1xuICBmdW5jdGlvbiBpbmxpbmVSRShlbmRDaGFyKSB7XG4gICAgaWYgKCFzYXZlZElubGluZVJFW2VuZENoYXJdKSB7XG4gICAgICAvLyBFc2NhcGUgZW5kQ2hhciBmb3IgUmVnRXhwICh0YWtlbiBmcm9tIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9hLzQ5NDEyMi81MjY3NDEpXG4gICAgICBlbmRDaGFyID0gKGVuZENoYXIrJycpLnJlcGxhY2UoLyhbLj8qK14kW1xcXVxcXFwoKXt9fC1dKS9nLCBcIlxcXFwkMVwiKTtcbiAgICAgIC8vIE1hdGNoIGFueSBub24tZW5kQ2hhciwgZXNjYXBlZCBjaGFyYWN0ZXIsIGFzIHdlbGwgYXMgdGhlIGNsb3NpbmdcbiAgICAgIC8vIGVuZENoYXIuXG4gICAgICBzYXZlZElubGluZVJFW2VuZENoYXJdID0gbmV3IFJlZ0V4cCgnXig/OlteXFxcXFxcXFxdfFxcXFxcXFxcLikqPygnICsgZW5kQ2hhciArICcpJyk7XG4gICAgfVxuICAgIHJldHVybiBzYXZlZElubGluZVJFW2VuZENoYXJdO1xuICB9XG5cbiAgdmFyIG1vZGUgPSB7XG4gICAgc3RhcnRTdGF0ZTogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBmOiBibG9ja05vcm1hbCxcblxuICAgICAgICBwcmV2TGluZTogbnVsbCxcbiAgICAgICAgdGhpc0xpbmU6IG51bGwsXG5cbiAgICAgICAgYmxvY2s6IGJsb2NrTm9ybWFsLFxuICAgICAgICBodG1sU3RhdGU6IG51bGwsXG4gICAgICAgIGluZGVudGF0aW9uOiAwLFxuXG4gICAgICAgIGlubGluZTogaW5saW5lTm9ybWFsLFxuICAgICAgICB0ZXh0OiBoYW5kbGVUZXh0LFxuXG4gICAgICAgIGZvcm1hdHRpbmc6IGZhbHNlLFxuICAgICAgICBsaW5rVGV4dDogZmFsc2UsXG4gICAgICAgIGxpbmtIcmVmOiBmYWxzZSxcbiAgICAgICAgbGlua1RpdGxlOiBmYWxzZSxcbiAgICAgICAgZW06IGZhbHNlLFxuICAgICAgICBzdHJvbmc6IGZhbHNlLFxuICAgICAgICBoZWFkZXI6IDAsXG4gICAgICAgIGhyOiBmYWxzZSxcbiAgICAgICAgdGFza0xpc3Q6IGZhbHNlLFxuICAgICAgICBsaXN0OiBmYWxzZSxcbiAgICAgICAgbGlzdERlcHRoOiAwLFxuICAgICAgICBxdW90ZTogMCxcbiAgICAgICAgdHJhaWxpbmdTcGFjZTogMCxcbiAgICAgICAgdHJhaWxpbmdTcGFjZU5ld0xpbmU6IGZhbHNlLFxuICAgICAgICBzdHJpa2V0aHJvdWdoOiBmYWxzZSxcbiAgICAgICAgZmVuY2VkQ2hhcnM6IG51bGxcbiAgICAgIH07XG4gICAgfSxcblxuICAgIGNvcHlTdGF0ZTogZnVuY3Rpb24ocykge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZjogcy5mLFxuXG4gICAgICAgIHByZXZMaW5lOiBzLnByZXZMaW5lLFxuICAgICAgICB0aGlzTGluZTogcy50aGlzTGluZSxcblxuICAgICAgICBibG9jazogcy5ibG9jayxcbiAgICAgICAgaHRtbFN0YXRlOiBzLmh0bWxTdGF0ZSAmJiBDb2RlTWlycm9yLmNvcHlTdGF0ZShodG1sTW9kZSwgcy5odG1sU3RhdGUpLFxuICAgICAgICBpbmRlbnRhdGlvbjogcy5pbmRlbnRhdGlvbixcblxuICAgICAgICBsb2NhbE1vZGU6IHMubG9jYWxNb2RlLFxuICAgICAgICBsb2NhbFN0YXRlOiBzLmxvY2FsTW9kZSA/IENvZGVNaXJyb3IuY29weVN0YXRlKHMubG9jYWxNb2RlLCBzLmxvY2FsU3RhdGUpIDogbnVsbCxcblxuICAgICAgICBpbmxpbmU6IHMuaW5saW5lLFxuICAgICAgICB0ZXh0OiBzLnRleHQsXG4gICAgICAgIGZvcm1hdHRpbmc6IGZhbHNlLFxuICAgICAgICBsaW5rVGl0bGU6IHMubGlua1RpdGxlLFxuICAgICAgICBjb2RlOiBzLmNvZGUsXG4gICAgICAgIGVtOiBzLmVtLFxuICAgICAgICBzdHJvbmc6IHMuc3Ryb25nLFxuICAgICAgICBzdHJpa2V0aHJvdWdoOiBzLnN0cmlrZXRocm91Z2gsXG4gICAgICAgIGhlYWRlcjogcy5oZWFkZXIsXG4gICAgICAgIGhyOiBzLmhyLFxuICAgICAgICB0YXNrTGlzdDogcy50YXNrTGlzdCxcbiAgICAgICAgbGlzdDogcy5saXN0LFxuICAgICAgICBsaXN0RGVwdGg6IHMubGlzdERlcHRoLFxuICAgICAgICBxdW90ZTogcy5xdW90ZSxcbiAgICAgICAgaW5kZW50ZWRDb2RlOiBzLmluZGVudGVkQ29kZSxcbiAgICAgICAgdHJhaWxpbmdTcGFjZTogcy50cmFpbGluZ1NwYWNlLFxuICAgICAgICB0cmFpbGluZ1NwYWNlTmV3TGluZTogcy50cmFpbGluZ1NwYWNlTmV3TGluZSxcbiAgICAgICAgbWRfaW5zaWRlOiBzLm1kX2luc2lkZSxcbiAgICAgICAgZmVuY2VkQ2hhcnM6IHMuZmVuY2VkQ2hhcnNcbiAgICAgIH07XG4gICAgfSxcblxuICAgIHRva2VuOiBmdW5jdGlvbihzdHJlYW0sIHN0YXRlKSB7XG5cbiAgICAgIC8vIFJlc2V0IHN0YXRlLmZvcm1hdHRpbmdcbiAgICAgIHN0YXRlLmZvcm1hdHRpbmcgPSBmYWxzZTtcblxuICAgICAgaWYgKHN0cmVhbSAhPSBzdGF0ZS50aGlzTGluZSkge1xuICAgICAgICB2YXIgZm9yY2VCbGFua0xpbmUgPSBzdGF0ZS5oZWFkZXIgfHwgc3RhdGUuaHI7XG5cbiAgICAgICAgLy8gUmVzZXQgc3RhdGUuaGVhZGVyIGFuZCBzdGF0ZS5oclxuICAgICAgICBzdGF0ZS5oZWFkZXIgPSAwO1xuICAgICAgICBzdGF0ZS5ociA9IGZhbHNlO1xuXG4gICAgICAgIGlmIChzdHJlYW0ubWF0Y2goL15cXHMqJC8sIHRydWUpIHx8IGZvcmNlQmxhbmtMaW5lKSB7XG4gICAgICAgICAgYmxhbmtMaW5lKHN0YXRlKTtcbiAgICAgICAgICBpZiAoIWZvcmNlQmxhbmtMaW5lKSByZXR1cm4gbnVsbFxuICAgICAgICAgIHN0YXRlLnByZXZMaW5lID0gbnVsbFxuICAgICAgICB9XG5cbiAgICAgICAgc3RhdGUucHJldkxpbmUgPSBzdGF0ZS50aGlzTGluZVxuICAgICAgICBzdGF0ZS50aGlzTGluZSA9IHN0cmVhbVxuXG4gICAgICAgIC8vIFJlc2V0IHN0YXRlLnRhc2tMaXN0XG4gICAgICAgIHN0YXRlLnRhc2tMaXN0ID0gZmFsc2U7XG5cbiAgICAgICAgLy8gUmVzZXQgc3RhdGUudHJhaWxpbmdTcGFjZVxuICAgICAgICBzdGF0ZS50cmFpbGluZ1NwYWNlID0gMDtcbiAgICAgICAgc3RhdGUudHJhaWxpbmdTcGFjZU5ld0xpbmUgPSBmYWxzZTtcblxuICAgICAgICBzdGF0ZS5mID0gc3RhdGUuYmxvY2s7XG4gICAgICAgIHZhciBpbmRlbnRhdGlvbiA9IHN0cmVhbS5tYXRjaCgvXlxccyovLCB0cnVlKVswXS5yZXBsYWNlKC9cXHQvZywgJyAgICAnKS5sZW5ndGg7XG4gICAgICAgIHZhciBkaWZmZXJlbmNlID0gTWF0aC5mbG9vcigoaW5kZW50YXRpb24gLSBzdGF0ZS5pbmRlbnRhdGlvbikgLyA0KSAqIDQ7XG4gICAgICAgIGlmIChkaWZmZXJlbmNlID4gNCkgZGlmZmVyZW5jZSA9IDQ7XG4gICAgICAgIHZhciBhZGp1c3RlZEluZGVudGF0aW9uID0gc3RhdGUuaW5kZW50YXRpb24gKyBkaWZmZXJlbmNlO1xuICAgICAgICBzdGF0ZS5pbmRlbnRhdGlvbkRpZmYgPSBhZGp1c3RlZEluZGVudGF0aW9uIC0gc3RhdGUuaW5kZW50YXRpb247XG4gICAgICAgIHN0YXRlLmluZGVudGF0aW9uID0gYWRqdXN0ZWRJbmRlbnRhdGlvbjtcbiAgICAgICAgaWYgKGluZGVudGF0aW9uID4gMCkgcmV0dXJuIG51bGw7XG4gICAgICB9XG4gICAgICByZXR1cm4gc3RhdGUuZihzdHJlYW0sIHN0YXRlKTtcbiAgICB9LFxuXG4gICAgaW5uZXJNb2RlOiBmdW5jdGlvbihzdGF0ZSkge1xuICAgICAgaWYgKHN0YXRlLmJsb2NrID09IGh0bWxCbG9jaykgcmV0dXJuIHtzdGF0ZTogc3RhdGUuaHRtbFN0YXRlLCBtb2RlOiBodG1sTW9kZX07XG4gICAgICBpZiAoc3RhdGUubG9jYWxTdGF0ZSkgcmV0dXJuIHtzdGF0ZTogc3RhdGUubG9jYWxTdGF0ZSwgbW9kZTogc3RhdGUubG9jYWxNb2RlfTtcbiAgICAgIHJldHVybiB7c3RhdGU6IHN0YXRlLCBtb2RlOiBtb2RlfTtcbiAgICB9LFxuXG4gICAgYmxhbmtMaW5lOiBibGFua0xpbmUsXG5cbiAgICBnZXRUeXBlOiBnZXRUeXBlLFxuXG4gICAgZm9sZDogXCJtYXJrZG93blwiXG4gIH07XG4gIHJldHVybiBtb2RlO1xufSwgXCJ4bWxcIik7XG5cbkNvZGVNaXJyb3IuZGVmaW5lTUlNRShcInRleHQveC1tYXJrZG93blwiLCBcIm1hcmtkb3duXCIpO1xuXG59KTtcbiIsIi8vIENvZGVNaXJyb3IsIGNvcHlyaWdodCAoYykgYnkgTWFyaWpuIEhhdmVyYmVrZSBhbmQgb3RoZXJzXG4vLyBEaXN0cmlidXRlZCB1bmRlciBhbiBNSVQgbGljZW5zZTogaHR0cDovL2NvZGVtaXJyb3IubmV0L0xJQ0VOU0VcblxuKGZ1bmN0aW9uKG1vZCkge1xuICBpZiAodHlwZW9mIGV4cG9ydHMgPT0gXCJvYmplY3RcIiAmJiB0eXBlb2YgbW9kdWxlID09IFwib2JqZWN0XCIpIC8vIENvbW1vbkpTXG4gICAgbW9kKHJlcXVpcmUoXCIuLi9saWIvY29kZW1pcnJvclwiKSk7XG4gIGVsc2UgaWYgKHR5cGVvZiBkZWZpbmUgPT0gXCJmdW5jdGlvblwiICYmIGRlZmluZS5hbWQpIC8vIEFNRFxuICAgIGRlZmluZShbXCIuLi9saWIvY29kZW1pcnJvclwiXSwgbW9kKTtcbiAgZWxzZSAvLyBQbGFpbiBicm93c2VyIGVudlxuICAgIG1vZChDb2RlTWlycm9yKTtcbn0pKGZ1bmN0aW9uKENvZGVNaXJyb3IpIHtcbiAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgQ29kZU1pcnJvci5tb2RlSW5mbyA9IFtcbiAgICB7bmFtZTogXCJBUExcIiwgbWltZTogXCJ0ZXh0L2FwbFwiLCBtb2RlOiBcImFwbFwiLCBleHQ6IFtcImR5YWxvZ1wiLCBcImFwbFwiXX0sXG4gICAge25hbWU6IFwiUEdQXCIsIG1pbWVzOiBbXCJhcHBsaWNhdGlvbi9wZ3BcIiwgXCJhcHBsaWNhdGlvbi9wZ3Ata2V5c1wiLCBcImFwcGxpY2F0aW9uL3BncC1zaWduYXR1cmVcIl0sIG1vZGU6IFwiYXNjaWlhcm1vclwiLCBleHQ6IFtcInBncFwiXX0sXG4gICAge25hbWU6IFwiQVNOLjFcIiwgbWltZTogXCJ0ZXh0L3gtdHRjbi1hc25cIiwgbW9kZTogXCJhc24uMVwiLCBleHQ6IFtcImFzblwiLCBcImFzbjFcIl19LFxuICAgIHtuYW1lOiBcIkFzdGVyaXNrXCIsIG1pbWU6IFwidGV4dC94LWFzdGVyaXNrXCIsIG1vZGU6IFwiYXN0ZXJpc2tcIiwgZmlsZTogL15leHRlbnNpb25zXFwuY29uZiQvaX0sXG4gICAge25hbWU6IFwiQnJhaW5mdWNrXCIsIG1pbWU6IFwidGV4dC94LWJyYWluZnVja1wiLCBtb2RlOiBcImJyYWluZnVja1wiLCBleHQ6IFtcImJcIiwgXCJiZlwiXX0sXG4gICAge25hbWU6IFwiQ1wiLCBtaW1lOiBcInRleHQveC1jc3JjXCIsIG1vZGU6IFwiY2xpa2VcIiwgZXh0OiBbXCJjXCIsIFwiaFwiXX0sXG4gICAge25hbWU6IFwiQysrXCIsIG1pbWU6IFwidGV4dC94LWMrK3NyY1wiLCBtb2RlOiBcImNsaWtlXCIsIGV4dDogW1wiY3BwXCIsIFwiYysrXCIsIFwiY2NcIiwgXCJjeHhcIiwgXCJocHBcIiwgXCJoKytcIiwgXCJoaFwiLCBcImh4eFwiXSwgYWxpYXM6IFtcImNwcFwiXX0sXG4gICAge25hbWU6IFwiQ29ib2xcIiwgbWltZTogXCJ0ZXh0L3gtY29ib2xcIiwgbW9kZTogXCJjb2JvbFwiLCBleHQ6IFtcImNvYlwiLCBcImNweVwiXX0sXG4gICAge25hbWU6IFwiQyNcIiwgbWltZTogXCJ0ZXh0L3gtY3NoYXJwXCIsIG1vZGU6IFwiY2xpa2VcIiwgZXh0OiBbXCJjc1wiXSwgYWxpYXM6IFtcImNzaGFycFwiXX0sXG4gICAge25hbWU6IFwiQ2xvanVyZVwiLCBtaW1lOiBcInRleHQveC1jbG9qdXJlXCIsIG1vZGU6IFwiY2xvanVyZVwiLCBleHQ6IFtcImNsalwiXX0sXG4gICAge25hbWU6IFwiQ2xvanVyZVNjcmlwdFwiLCBtaW1lOiBcInRleHQveC1jbG9qdXJlc2NyaXB0XCIsIG1vZGU6IFwiY2xvanVyZVwiLCBleHQ6IFtcImNsanNcIl19LFxuICAgIHtuYW1lOiBcIkNsb3N1cmUgU3R5bGVzaGVldHMgKEdTUylcIiwgbWltZTogXCJ0ZXh0L3gtZ3NzXCIsIG1vZGU6IFwiY3NzXCIsIGV4dDogW1wiZ3NzXCJdfSxcbiAgICB7bmFtZTogXCJDTWFrZVwiLCBtaW1lOiBcInRleHQveC1jbWFrZVwiLCBtb2RlOiBcImNtYWtlXCIsIGV4dDogW1wiY21ha2VcIiwgXCJjbWFrZS5pblwiXSwgZmlsZTogL15DTWFrZUxpc3RzLnR4dCQvfSxcbiAgICB7bmFtZTogXCJDb2ZmZWVTY3JpcHRcIiwgbWltZTogXCJ0ZXh0L3gtY29mZmVlc2NyaXB0XCIsIG1vZGU6IFwiY29mZmVlc2NyaXB0XCIsIGV4dDogW1wiY29mZmVlXCJdLCBhbGlhczogW1wiY29mZmVlXCIsIFwiY29mZmVlLXNjcmlwdFwiXX0sXG4gICAge25hbWU6IFwiQ29tbW9uIExpc3BcIiwgbWltZTogXCJ0ZXh0L3gtY29tbW9uLWxpc3BcIiwgbW9kZTogXCJjb21tb25saXNwXCIsIGV4dDogW1wiY2xcIiwgXCJsaXNwXCIsIFwiZWxcIl0sIGFsaWFzOiBbXCJsaXNwXCJdfSxcbiAgICB7bmFtZTogXCJDeXBoZXJcIiwgbWltZTogXCJhcHBsaWNhdGlvbi94LWN5cGhlci1xdWVyeVwiLCBtb2RlOiBcImN5cGhlclwiLCBleHQ6IFtcImN5cFwiLCBcImN5cGhlclwiXX0sXG4gICAge25hbWU6IFwiQ3l0aG9uXCIsIG1pbWU6IFwidGV4dC94LWN5dGhvblwiLCBtb2RlOiBcInB5dGhvblwiLCBleHQ6IFtcInB5eFwiLCBcInB4ZFwiLCBcInB4aVwiXX0sXG4gICAge25hbWU6IFwiQ3J5c3RhbFwiLCBtaW1lOiBcInRleHQveC1jcnlzdGFsXCIsIG1vZGU6IFwiY3J5c3RhbFwiLCBleHQ6IFtcImNyXCJdfSxcbiAgICB7bmFtZTogXCJDU1NcIiwgbWltZTogXCJ0ZXh0L2Nzc1wiLCBtb2RlOiBcImNzc1wiLCBleHQ6IFtcImNzc1wiXX0sXG4gICAge25hbWU6IFwiQ1FMXCIsIG1pbWU6IFwidGV4dC94LWNhc3NhbmRyYVwiLCBtb2RlOiBcInNxbFwiLCBleHQ6IFtcImNxbFwiXX0sXG4gICAge25hbWU6IFwiRFwiLCBtaW1lOiBcInRleHQveC1kXCIsIG1vZGU6IFwiZFwiLCBleHQ6IFtcImRcIl19LFxuICAgIHtuYW1lOiBcIkRhcnRcIiwgbWltZXM6IFtcImFwcGxpY2F0aW9uL2RhcnRcIiwgXCJ0ZXh0L3gtZGFydFwiXSwgbW9kZTogXCJkYXJ0XCIsIGV4dDogW1wiZGFydFwiXX0sXG4gICAge25hbWU6IFwiZGlmZlwiLCBtaW1lOiBcInRleHQveC1kaWZmXCIsIG1vZGU6IFwiZGlmZlwiLCBleHQ6IFtcImRpZmZcIiwgXCJwYXRjaFwiXX0sXG4gICAge25hbWU6IFwiRGphbmdvXCIsIG1pbWU6IFwidGV4dC94LWRqYW5nb1wiLCBtb2RlOiBcImRqYW5nb1wifSxcbiAgICB7bmFtZTogXCJEb2NrZXJmaWxlXCIsIG1pbWU6IFwidGV4dC94LWRvY2tlcmZpbGVcIiwgbW9kZTogXCJkb2NrZXJmaWxlXCIsIGZpbGU6IC9eRG9ja2VyZmlsZSQvfSxcbiAgICB7bmFtZTogXCJEVERcIiwgbWltZTogXCJhcHBsaWNhdGlvbi94bWwtZHRkXCIsIG1vZGU6IFwiZHRkXCIsIGV4dDogW1wiZHRkXCJdfSxcbiAgICB7bmFtZTogXCJEeWxhblwiLCBtaW1lOiBcInRleHQveC1keWxhblwiLCBtb2RlOiBcImR5bGFuXCIsIGV4dDogW1wiZHlsYW5cIiwgXCJkeWxcIiwgXCJpbnRyXCJdfSxcbiAgICB7bmFtZTogXCJFQk5GXCIsIG1pbWU6IFwidGV4dC94LWVibmZcIiwgbW9kZTogXCJlYm5mXCJ9LFxuICAgIHtuYW1lOiBcIkVDTFwiLCBtaW1lOiBcInRleHQveC1lY2xcIiwgbW9kZTogXCJlY2xcIiwgZXh0OiBbXCJlY2xcIl19LFxuICAgIHtuYW1lOiBcIkVpZmZlbFwiLCBtaW1lOiBcInRleHQveC1laWZmZWxcIiwgbW9kZTogXCJlaWZmZWxcIiwgZXh0OiBbXCJlXCJdfSxcbiAgICB7bmFtZTogXCJFbG1cIiwgbWltZTogXCJ0ZXh0L3gtZWxtXCIsIG1vZGU6IFwiZWxtXCIsIGV4dDogW1wiZWxtXCJdfSxcbiAgICB7bmFtZTogXCJFbWJlZGRlZCBKYXZhc2NyaXB0XCIsIG1pbWU6IFwiYXBwbGljYXRpb24veC1lanNcIiwgbW9kZTogXCJodG1sZW1iZWRkZWRcIiwgZXh0OiBbXCJlanNcIl19LFxuICAgIHtuYW1lOiBcIkVtYmVkZGVkIFJ1YnlcIiwgbWltZTogXCJhcHBsaWNhdGlvbi94LWVyYlwiLCBtb2RlOiBcImh0bWxlbWJlZGRlZFwiLCBleHQ6IFtcImVyYlwiXX0sXG4gICAge25hbWU6IFwiRXJsYW5nXCIsIG1pbWU6IFwidGV4dC94LWVybGFuZ1wiLCBtb2RlOiBcImVybGFuZ1wiLCBleHQ6IFtcImVybFwiXX0sXG4gICAge25hbWU6IFwiRmFjdG9yXCIsIG1pbWU6IFwidGV4dC94LWZhY3RvclwiLCBtb2RlOiBcImZhY3RvclwiLCBleHQ6IFtcImZhY3RvclwiXX0sXG4gICAge25hbWU6IFwiRm9ydGhcIiwgbWltZTogXCJ0ZXh0L3gtZm9ydGhcIiwgbW9kZTogXCJmb3J0aFwiLCBleHQ6IFtcImZvcnRoXCIsIFwiZnRoXCIsIFwiNHRoXCJdfSxcbiAgICB7bmFtZTogXCJGb3J0cmFuXCIsIG1pbWU6IFwidGV4dC94LWZvcnRyYW5cIiwgbW9kZTogXCJmb3J0cmFuXCIsIGV4dDogW1wiZlwiLCBcImZvclwiLCBcImY3N1wiLCBcImY5MFwiXX0sXG4gICAge25hbWU6IFwiRiNcIiwgbWltZTogXCJ0ZXh0L3gtZnNoYXJwXCIsIG1vZGU6IFwibWxsaWtlXCIsIGV4dDogW1wiZnNcIl0sIGFsaWFzOiBbXCJmc2hhcnBcIl19LFxuICAgIHtuYW1lOiBcIkdhc1wiLCBtaW1lOiBcInRleHQveC1nYXNcIiwgbW9kZTogXCJnYXNcIiwgZXh0OiBbXCJzXCJdfSxcbiAgICB7bmFtZTogXCJHaGVya2luXCIsIG1pbWU6IFwidGV4dC94LWZlYXR1cmVcIiwgbW9kZTogXCJnaGVya2luXCIsIGV4dDogW1wiZmVhdHVyZVwiXX0sXG4gICAge25hbWU6IFwiR2l0SHViIEZsYXZvcmVkIE1hcmtkb3duXCIsIG1pbWU6IFwidGV4dC94LWdmbVwiLCBtb2RlOiBcImdmbVwiLCBmaWxlOiAvXihyZWFkbWV8Y29udHJpYnV0aW5nfGhpc3RvcnkpLm1kJC9pfSxcbiAgICB7bmFtZTogXCJHb1wiLCBtaW1lOiBcInRleHQveC1nb1wiLCBtb2RlOiBcImdvXCIsIGV4dDogW1wiZ29cIl19LFxuICAgIHtuYW1lOiBcIkdyb292eVwiLCBtaW1lOiBcInRleHQveC1ncm9vdnlcIiwgbW9kZTogXCJncm9vdnlcIiwgZXh0OiBbXCJncm9vdnlcIl19LFxuICAgIHtuYW1lOiBcIkhBTUxcIiwgbWltZTogXCJ0ZXh0L3gtaGFtbFwiLCBtb2RlOiBcImhhbWxcIiwgZXh0OiBbXCJoYW1sXCJdfSxcbiAgICB7bmFtZTogXCJIYXNrZWxsXCIsIG1pbWU6IFwidGV4dC94LWhhc2tlbGxcIiwgbW9kZTogXCJoYXNrZWxsXCIsIGV4dDogW1wiaHNcIl19LFxuICAgIHtuYW1lOiBcIkhhc2tlbGwgKExpdGVyYXRlKVwiLCBtaW1lOiBcInRleHQveC1saXRlcmF0ZS1oYXNrZWxsXCIsIG1vZGU6IFwiaGFza2VsbC1saXRlcmF0ZVwiLCBleHQ6IFtcImxoc1wiXX0sXG4gICAge25hbWU6IFwiSGF4ZVwiLCBtaW1lOiBcInRleHQveC1oYXhlXCIsIG1vZGU6IFwiaGF4ZVwiLCBleHQ6IFtcImh4XCJdfSxcbiAgICB7bmFtZTogXCJIWE1MXCIsIG1pbWU6IFwidGV4dC94LWh4bWxcIiwgbW9kZTogXCJoYXhlXCIsIGV4dDogW1wiaHhtbFwiXX0sXG4gICAge25hbWU6IFwiQVNQLk5FVFwiLCBtaW1lOiBcImFwcGxpY2F0aW9uL3gtYXNweFwiLCBtb2RlOiBcImh0bWxlbWJlZGRlZFwiLCBleHQ6IFtcImFzcHhcIl0sIGFsaWFzOiBbXCJhc3BcIiwgXCJhc3B4XCJdfSxcbiAgICB7bmFtZTogXCJIVE1MXCIsIG1pbWU6IFwidGV4dC9odG1sXCIsIG1vZGU6IFwiaHRtbG1peGVkXCIsIGV4dDogW1wiaHRtbFwiLCBcImh0bVwiXSwgYWxpYXM6IFtcInhodG1sXCJdfSxcbiAgICB7bmFtZTogXCJIVFRQXCIsIG1pbWU6IFwibWVzc2FnZS9odHRwXCIsIG1vZGU6IFwiaHR0cFwifSxcbiAgICB7bmFtZTogXCJJRExcIiwgbWltZTogXCJ0ZXh0L3gtaWRsXCIsIG1vZGU6IFwiaWRsXCIsIGV4dDogW1wicHJvXCJdfSxcbiAgICB7bmFtZTogXCJKYWRlXCIsIG1pbWU6IFwidGV4dC94LWphZGVcIiwgbW9kZTogXCJqYWRlXCIsIGV4dDogW1wiamFkZVwiXX0sXG4gICAge25hbWU6IFwiSmF2YVwiLCBtaW1lOiBcInRleHQveC1qYXZhXCIsIG1vZGU6IFwiY2xpa2VcIiwgZXh0OiBbXCJqYXZhXCJdfSxcbiAgICB7bmFtZTogXCJKYXZhIFNlcnZlciBQYWdlc1wiLCBtaW1lOiBcImFwcGxpY2F0aW9uL3gtanNwXCIsIG1vZGU6IFwiaHRtbGVtYmVkZGVkXCIsIGV4dDogW1wianNwXCJdLCBhbGlhczogW1wianNwXCJdfSxcbiAgICB7bmFtZTogXCJKYXZhU2NyaXB0XCIsIG1pbWVzOiBbXCJ0ZXh0L2phdmFzY3JpcHRcIiwgXCJ0ZXh0L2VjbWFzY3JpcHRcIiwgXCJhcHBsaWNhdGlvbi9qYXZhc2NyaXB0XCIsIFwiYXBwbGljYXRpb24veC1qYXZhc2NyaXB0XCIsIFwiYXBwbGljYXRpb24vZWNtYXNjcmlwdFwiXSxcbiAgICAgbW9kZTogXCJqYXZhc2NyaXB0XCIsIGV4dDogW1wianNcIl0sIGFsaWFzOiBbXCJlY21hc2NyaXB0XCIsIFwianNcIiwgXCJub2RlXCJdfSxcbiAgICB7bmFtZTogXCJKU09OXCIsIG1pbWVzOiBbXCJhcHBsaWNhdGlvbi9qc29uXCIsIFwiYXBwbGljYXRpb24veC1qc29uXCJdLCBtb2RlOiBcImphdmFzY3JpcHRcIiwgZXh0OiBbXCJqc29uXCIsIFwibWFwXCJdLCBhbGlhczogW1wianNvbjVcIl19LFxuICAgIHtuYW1lOiBcIkpTT04tTERcIiwgbWltZTogXCJhcHBsaWNhdGlvbi9sZCtqc29uXCIsIG1vZGU6IFwiamF2YXNjcmlwdFwiLCBleHQ6IFtcImpzb25sZFwiXSwgYWxpYXM6IFtcImpzb25sZFwiXX0sXG4gICAge25hbWU6IFwiSlNYXCIsIG1pbWU6IFwidGV4dC9qc3hcIiwgbW9kZTogXCJqc3hcIiwgZXh0OiBbXCJqc3hcIl19LFxuICAgIHtuYW1lOiBcIkppbmphMlwiLCBtaW1lOiBcIm51bGxcIiwgbW9kZTogXCJqaW5qYTJcIn0sXG4gICAge25hbWU6IFwiSnVsaWFcIiwgbWltZTogXCJ0ZXh0L3gtanVsaWFcIiwgbW9kZTogXCJqdWxpYVwiLCBleHQ6IFtcImpsXCJdfSxcbiAgICB7bmFtZTogXCJLb3RsaW5cIiwgbWltZTogXCJ0ZXh0L3gta290bGluXCIsIG1vZGU6IFwiY2xpa2VcIiwgZXh0OiBbXCJrdFwiXX0sXG4gICAge25hbWU6IFwiTEVTU1wiLCBtaW1lOiBcInRleHQveC1sZXNzXCIsIG1vZGU6IFwiY3NzXCIsIGV4dDogW1wibGVzc1wiXX0sXG4gICAge25hbWU6IFwiTGl2ZVNjcmlwdFwiLCBtaW1lOiBcInRleHQveC1saXZlc2NyaXB0XCIsIG1vZGU6IFwibGl2ZXNjcmlwdFwiLCBleHQ6IFtcImxzXCJdLCBhbGlhczogW1wibHNcIl19LFxuICAgIHtuYW1lOiBcIkx1YVwiLCBtaW1lOiBcInRleHQveC1sdWFcIiwgbW9kZTogXCJsdWFcIiwgZXh0OiBbXCJsdWFcIl19LFxuICAgIHtuYW1lOiBcIk1hcmtkb3duXCIsIG1pbWU6IFwidGV4dC94LW1hcmtkb3duXCIsIG1vZGU6IFwibWFya2Rvd25cIiwgZXh0OiBbXCJtYXJrZG93blwiLCBcIm1kXCIsIFwibWtkXCJdfSxcbiAgICB7bmFtZTogXCJtSVJDXCIsIG1pbWU6IFwidGV4dC9taXJjXCIsIG1vZGU6IFwibWlyY1wifSxcbiAgICB7bmFtZTogXCJNYXJpYURCIFNRTFwiLCBtaW1lOiBcInRleHQveC1tYXJpYWRiXCIsIG1vZGU6IFwic3FsXCJ9LFxuICAgIHtuYW1lOiBcIk1hdGhlbWF0aWNhXCIsIG1pbWU6IFwidGV4dC94LW1hdGhlbWF0aWNhXCIsIG1vZGU6IFwibWF0aGVtYXRpY2FcIiwgZXh0OiBbXCJtXCIsIFwibmJcIl19LFxuICAgIHtuYW1lOiBcIk1vZGVsaWNhXCIsIG1pbWU6IFwidGV4dC94LW1vZGVsaWNhXCIsIG1vZGU6IFwibW9kZWxpY2FcIiwgZXh0OiBbXCJtb1wiXX0sXG4gICAge25hbWU6IFwiTVVNUFNcIiwgbWltZTogXCJ0ZXh0L3gtbXVtcHNcIiwgbW9kZTogXCJtdW1wc1wifSxcbiAgICB7bmFtZTogXCJNUyBTUUxcIiwgbWltZTogXCJ0ZXh0L3gtbXNzcWxcIiwgbW9kZTogXCJzcWxcIn0sXG4gICAge25hbWU6IFwiTXlTUUxcIiwgbWltZTogXCJ0ZXh0L3gtbXlzcWxcIiwgbW9kZTogXCJzcWxcIn0sXG4gICAge25hbWU6IFwiTmdpbnhcIiwgbWltZTogXCJ0ZXh0L3gtbmdpbngtY29uZlwiLCBtb2RlOiBcIm5naW54XCIsIGZpbGU6IC9uZ2lueC4qXFwuY29uZiQvaX0sXG4gICAge25hbWU6IFwiTlNJU1wiLCBtaW1lOiBcInRleHQveC1uc2lzXCIsIG1vZGU6IFwibnNpc1wiLCBleHQ6IFtcIm5zaFwiLCBcIm5zaVwiXX0sXG4gICAge25hbWU6IFwiTlRyaXBsZXNcIiwgbWltZTogXCJ0ZXh0L24tdHJpcGxlc1wiLCBtb2RlOiBcIm50cmlwbGVzXCIsIGV4dDogW1wibnRcIl19LFxuICAgIHtuYW1lOiBcIk9iamVjdGl2ZSBDXCIsIG1pbWU6IFwidGV4dC94LW9iamVjdGl2ZWNcIiwgbW9kZTogXCJjbGlrZVwiLCBleHQ6IFtcIm1cIiwgXCJtbVwiXX0sXG4gICAge25hbWU6IFwiT0NhbWxcIiwgbWltZTogXCJ0ZXh0L3gtb2NhbWxcIiwgbW9kZTogXCJtbGxpa2VcIiwgZXh0OiBbXCJtbFwiLCBcIm1saVwiLCBcIm1sbFwiLCBcIm1seVwiXX0sXG4gICAge25hbWU6IFwiT2N0YXZlXCIsIG1pbWU6IFwidGV4dC94LW9jdGF2ZVwiLCBtb2RlOiBcIm9jdGF2ZVwiLCBleHQ6IFtcIm1cIl19LFxuICAgIHtuYW1lOiBcIk96XCIsIG1pbWU6IFwidGV4dC94LW96XCIsIG1vZGU6IFwib3pcIiwgZXh0OiBbXCJvelwiXX0sXG4gICAge25hbWU6IFwiUGFzY2FsXCIsIG1pbWU6IFwidGV4dC94LXBhc2NhbFwiLCBtb2RlOiBcInBhc2NhbFwiLCBleHQ6IFtcInBcIiwgXCJwYXNcIl19LFxuICAgIHtuYW1lOiBcIlBFRy5qc1wiLCBtaW1lOiBcIm51bGxcIiwgbW9kZTogXCJwZWdqc1wiLCBleHQ6IFtcImpzb25sZFwiXX0sXG4gICAge25hbWU6IFwiUGVybFwiLCBtaW1lOiBcInRleHQveC1wZXJsXCIsIG1vZGU6IFwicGVybFwiLCBleHQ6IFtcInBsXCIsIFwicG1cIl19LFxuICAgIHtuYW1lOiBcIlBIUFwiLCBtaW1lOiBcImFwcGxpY2F0aW9uL3gtaHR0cGQtcGhwXCIsIG1vZGU6IFwicGhwXCIsIGV4dDogW1wicGhwXCIsIFwicGhwM1wiLCBcInBocDRcIiwgXCJwaHA1XCIsIFwicGh0bWxcIl19LFxuICAgIHtuYW1lOiBcIlBpZ1wiLCBtaW1lOiBcInRleHQveC1waWdcIiwgbW9kZTogXCJwaWdcIiwgZXh0OiBbXCJwaWdcIl19LFxuICAgIHtuYW1lOiBcIlBsYWluIFRleHRcIiwgbWltZTogXCJ0ZXh0L3BsYWluXCIsIG1vZGU6IFwibnVsbFwiLCBleHQ6IFtcInR4dFwiLCBcInRleHRcIiwgXCJjb25mXCIsIFwiZGVmXCIsIFwibGlzdFwiLCBcImxvZ1wiXX0sXG4gICAge25hbWU6IFwiUExTUUxcIiwgbWltZTogXCJ0ZXh0L3gtcGxzcWxcIiwgbW9kZTogXCJzcWxcIiwgZXh0OiBbXCJwbHNcIl19LFxuICAgIHtuYW1lOiBcIlByb3BlcnRpZXMgZmlsZXNcIiwgbWltZTogXCJ0ZXh0L3gtcHJvcGVydGllc1wiLCBtb2RlOiBcInByb3BlcnRpZXNcIiwgZXh0OiBbXCJwcm9wZXJ0aWVzXCIsIFwiaW5pXCIsIFwiaW5cIl0sIGFsaWFzOiBbXCJpbmlcIiwgXCJwcm9wZXJ0aWVzXCJdfSxcbiAgICB7bmFtZTogXCJQeXRob25cIiwgbWltZTogXCJ0ZXh0L3gtcHl0aG9uXCIsIG1vZGU6IFwicHl0aG9uXCIsIGV4dDogW1wicHlcIiwgXCJweXdcIl19LFxuICAgIHtuYW1lOiBcIlB1cHBldFwiLCBtaW1lOiBcInRleHQveC1wdXBwZXRcIiwgbW9kZTogXCJwdXBwZXRcIiwgZXh0OiBbXCJwcFwiXX0sXG4gICAge25hbWU6IFwiUVwiLCBtaW1lOiBcInRleHQveC1xXCIsIG1vZGU6IFwicVwiLCBleHQ6IFtcInFcIl19LFxuICAgIHtuYW1lOiBcIlJcIiwgbWltZTogXCJ0ZXh0L3gtcnNyY1wiLCBtb2RlOiBcInJcIiwgZXh0OiBbXCJyXCJdLCBhbGlhczogW1wicnNjcmlwdFwiXX0sXG4gICAge25hbWU6IFwicmVTdHJ1Y3R1cmVkVGV4dFwiLCBtaW1lOiBcInRleHQveC1yc3RcIiwgbW9kZTogXCJyc3RcIiwgZXh0OiBbXCJyc3RcIl0sIGFsaWFzOiBbXCJyc3RcIl19LFxuICAgIHtuYW1lOiBcIlJQTSBDaGFuZ2VzXCIsIG1pbWU6IFwidGV4dC94LXJwbS1jaGFuZ2VzXCIsIG1vZGU6IFwicnBtXCJ9LFxuICAgIHtuYW1lOiBcIlJQTSBTcGVjXCIsIG1pbWU6IFwidGV4dC94LXJwbS1zcGVjXCIsIG1vZGU6IFwicnBtXCIsIGV4dDogW1wic3BlY1wiXX0sXG4gICAge25hbWU6IFwiUnVieVwiLCBtaW1lOiBcInRleHQveC1ydWJ5XCIsIG1vZGU6IFwicnVieVwiLCBleHQ6IFtcInJiXCJdLCBhbGlhczogW1wianJ1YnlcIiwgXCJtYWNydWJ5XCIsIFwicmFrZVwiLCBcInJiXCIsIFwicmJ4XCJdfSxcbiAgICB7bmFtZTogXCJSdXN0XCIsIG1pbWU6IFwidGV4dC94LXJ1c3RzcmNcIiwgbW9kZTogXCJydXN0XCIsIGV4dDogW1wicnNcIl19LFxuICAgIHtuYW1lOiBcIlNhc3NcIiwgbWltZTogXCJ0ZXh0L3gtc2Fzc1wiLCBtb2RlOiBcInNhc3NcIiwgZXh0OiBbXCJzYXNzXCJdfSxcbiAgICB7bmFtZTogXCJTY2FsYVwiLCBtaW1lOiBcInRleHQveC1zY2FsYVwiLCBtb2RlOiBcImNsaWtlXCIsIGV4dDogW1wic2NhbGFcIl19LFxuICAgIHtuYW1lOiBcIlNjaGVtZVwiLCBtaW1lOiBcInRleHQveC1zY2hlbWVcIiwgbW9kZTogXCJzY2hlbWVcIiwgZXh0OiBbXCJzY21cIiwgXCJzc1wiXX0sXG4gICAge25hbWU6IFwiU0NTU1wiLCBtaW1lOiBcInRleHQveC1zY3NzXCIsIG1vZGU6IFwiY3NzXCIsIGV4dDogW1wic2Nzc1wiXX0sXG4gICAge25hbWU6IFwiU2hlbGxcIiwgbWltZTogXCJ0ZXh0L3gtc2hcIiwgbW9kZTogXCJzaGVsbFwiLCBleHQ6IFtcInNoXCIsIFwia3NoXCIsIFwiYmFzaFwiXSwgYWxpYXM6IFtcImJhc2hcIiwgXCJzaFwiLCBcInpzaFwiXSwgZmlsZTogL15QS0dCVUlMRCQvfSxcbiAgICB7bmFtZTogXCJTaWV2ZVwiLCBtaW1lOiBcImFwcGxpY2F0aW9uL3NpZXZlXCIsIG1vZGU6IFwic2lldmVcIiwgZXh0OiBbXCJzaXZcIiwgXCJzaWV2ZVwiXX0sXG4gICAge25hbWU6IFwiU2xpbVwiLCBtaW1lczogW1widGV4dC94LXNsaW1cIiwgXCJhcHBsaWNhdGlvbi94LXNsaW1cIl0sIG1vZGU6IFwic2xpbVwiLCBleHQ6IFtcInNsaW1cIl19LFxuICAgIHtuYW1lOiBcIlNtYWxsdGFsa1wiLCBtaW1lOiBcInRleHQveC1zdHNyY1wiLCBtb2RlOiBcInNtYWxsdGFsa1wiLCBleHQ6IFtcInN0XCJdfSxcbiAgICB7bmFtZTogXCJTbWFydHlcIiwgbWltZTogXCJ0ZXh0L3gtc21hcnR5XCIsIG1vZGU6IFwic21hcnR5XCIsIGV4dDogW1widHBsXCJdfSxcbiAgICB7bmFtZTogXCJTb2xyXCIsIG1pbWU6IFwidGV4dC94LXNvbHJcIiwgbW9kZTogXCJzb2xyXCJ9LFxuICAgIHtuYW1lOiBcIlNveVwiLCBtaW1lOiBcInRleHQveC1zb3lcIiwgbW9kZTogXCJzb3lcIiwgZXh0OiBbXCJzb3lcIl0sIGFsaWFzOiBbXCJjbG9zdXJlIHRlbXBsYXRlXCJdfSxcbiAgICB7bmFtZTogXCJTUEFSUUxcIiwgbWltZTogXCJhcHBsaWNhdGlvbi9zcGFycWwtcXVlcnlcIiwgbW9kZTogXCJzcGFycWxcIiwgZXh0OiBbXCJycVwiLCBcInNwYXJxbFwiXSwgYWxpYXM6IFtcInNwYXJ1bFwiXX0sXG4gICAge25hbWU6IFwiU3ByZWFkc2hlZXRcIiwgbWltZTogXCJ0ZXh0L3gtc3ByZWFkc2hlZXRcIiwgbW9kZTogXCJzcHJlYWRzaGVldFwiLCBhbGlhczogW1wiZXhjZWxcIiwgXCJmb3JtdWxhXCJdfSxcbiAgICB7bmFtZTogXCJTUUxcIiwgbWltZTogXCJ0ZXh0L3gtc3FsXCIsIG1vZGU6IFwic3FsXCIsIGV4dDogW1wic3FsXCJdfSxcbiAgICB7bmFtZTogXCJTcXVpcnJlbFwiLCBtaW1lOiBcInRleHQveC1zcXVpcnJlbFwiLCBtb2RlOiBcImNsaWtlXCIsIGV4dDogW1wibnV0XCJdfSxcbiAgICB7bmFtZTogXCJTd2lmdFwiLCBtaW1lOiBcInRleHQveC1zd2lmdFwiLCBtb2RlOiBcInN3aWZ0XCIsIGV4dDogW1wic3dpZnRcIl19LFxuICAgIHtuYW1lOiBcIk1hcmlhREJcIiwgbWltZTogXCJ0ZXh0L3gtbWFyaWFkYlwiLCBtb2RlOiBcInNxbFwifSxcbiAgICB7bmFtZTogXCJzVGVYXCIsIG1pbWU6IFwidGV4dC94LXN0ZXhcIiwgbW9kZTogXCJzdGV4XCJ9LFxuICAgIHtuYW1lOiBcIkxhVGVYXCIsIG1pbWU6IFwidGV4dC94LWxhdGV4XCIsIG1vZGU6IFwic3RleFwiLCBleHQ6IFtcInRleHRcIiwgXCJsdHhcIl0sIGFsaWFzOiBbXCJ0ZXhcIl19LFxuICAgIHtuYW1lOiBcIlN5c3RlbVZlcmlsb2dcIiwgbWltZTogXCJ0ZXh0L3gtc3lzdGVtdmVyaWxvZ1wiLCBtb2RlOiBcInZlcmlsb2dcIiwgZXh0OiBbXCJ2XCJdfSxcbiAgICB7bmFtZTogXCJUY2xcIiwgbWltZTogXCJ0ZXh0L3gtdGNsXCIsIG1vZGU6IFwidGNsXCIsIGV4dDogW1widGNsXCJdfSxcbiAgICB7bmFtZTogXCJUZXh0aWxlXCIsIG1pbWU6IFwidGV4dC94LXRleHRpbGVcIiwgbW9kZTogXCJ0ZXh0aWxlXCIsIGV4dDogW1widGV4dGlsZVwiXX0sXG4gICAge25hbWU6IFwiVGlkZGx5V2lraSBcIiwgbWltZTogXCJ0ZXh0L3gtdGlkZGx5d2lraVwiLCBtb2RlOiBcInRpZGRseXdpa2lcIn0sXG4gICAge25hbWU6IFwiVGlraSB3aWtpXCIsIG1pbWU6IFwidGV4dC90aWtpXCIsIG1vZGU6IFwidGlraVwifSxcbiAgICB7bmFtZTogXCJUT01MXCIsIG1pbWU6IFwidGV4dC94LXRvbWxcIiwgbW9kZTogXCJ0b21sXCIsIGV4dDogW1widG9tbFwiXX0sXG4gICAge25hbWU6IFwiVG9ybmFkb1wiLCBtaW1lOiBcInRleHQveC10b3JuYWRvXCIsIG1vZGU6IFwidG9ybmFkb1wifSxcbiAgICB7bmFtZTogXCJ0cm9mZlwiLCBtaW1lOiBcInRyb2ZmXCIsIG1vZGU6IFwidHJvZmZcIiwgZXh0OiBbXCIxXCIsIFwiMlwiLCBcIjNcIiwgXCI0XCIsIFwiNVwiLCBcIjZcIiwgXCI3XCIsIFwiOFwiLCBcIjlcIl19LFxuICAgIHtuYW1lOiBcIlRUQ05cIiwgbWltZTogXCJ0ZXh0L3gtdHRjblwiLCBtb2RlOiBcInR0Y25cIiwgZXh0OiBbXCJ0dGNuXCIsIFwidHRjbjNcIiwgXCJ0dGNucHBcIl19LFxuICAgIHtuYW1lOiBcIlRUQ05fQ0ZHXCIsIG1pbWU6IFwidGV4dC94LXR0Y24tY2ZnXCIsIG1vZGU6IFwidHRjbi1jZmdcIiwgZXh0OiBbXCJjZmdcIl19LFxuICAgIHtuYW1lOiBcIlR1cnRsZVwiLCBtaW1lOiBcInRleHQvdHVydGxlXCIsIG1vZGU6IFwidHVydGxlXCIsIGV4dDogW1widHRsXCJdfSxcbiAgICB7bmFtZTogXCJUeXBlU2NyaXB0XCIsIG1pbWU6IFwiYXBwbGljYXRpb24vdHlwZXNjcmlwdFwiLCBtb2RlOiBcImphdmFzY3JpcHRcIiwgZXh0OiBbXCJ0c1wiXSwgYWxpYXM6IFtcInRzXCJdfSxcbiAgICB7bmFtZTogXCJUd2lnXCIsIG1pbWU6IFwidGV4dC94LXR3aWdcIiwgbW9kZTogXCJ0d2lnXCJ9LFxuICAgIHtuYW1lOiBcIlZCLk5FVFwiLCBtaW1lOiBcInRleHQveC12YlwiLCBtb2RlOiBcInZiXCIsIGV4dDogW1widmJcIl19LFxuICAgIHtuYW1lOiBcIlZCU2NyaXB0XCIsIG1pbWU6IFwidGV4dC92YnNjcmlwdFwiLCBtb2RlOiBcInZic2NyaXB0XCIsIGV4dDogW1widmJzXCJdfSxcbiAgICB7bmFtZTogXCJWZWxvY2l0eVwiLCBtaW1lOiBcInRleHQvdmVsb2NpdHlcIiwgbW9kZTogXCJ2ZWxvY2l0eVwiLCBleHQ6IFtcInZ0bFwiXX0sXG4gICAge25hbWU6IFwiVmVyaWxvZ1wiLCBtaW1lOiBcInRleHQveC12ZXJpbG9nXCIsIG1vZGU6IFwidmVyaWxvZ1wiLCBleHQ6IFtcInZcIl19LFxuICAgIHtuYW1lOiBcIlZIRExcIiwgbWltZTogXCJ0ZXh0L3gtdmhkbFwiLCBtb2RlOiBcInZoZGxcIiwgZXh0OiBbXCJ2aGRcIiwgXCJ2aGRsXCJdfSxcbiAgICB7bmFtZTogXCJYTUxcIiwgbWltZXM6IFtcImFwcGxpY2F0aW9uL3htbFwiLCBcInRleHQveG1sXCJdLCBtb2RlOiBcInhtbFwiLCBleHQ6IFtcInhtbFwiLCBcInhzbFwiLCBcInhzZFwiXSwgYWxpYXM6IFtcInJzc1wiLCBcIndzZGxcIiwgXCJ4c2RcIl19LFxuICAgIHtuYW1lOiBcIlhRdWVyeVwiLCBtaW1lOiBcImFwcGxpY2F0aW9uL3hxdWVyeVwiLCBtb2RlOiBcInhxdWVyeVwiLCBleHQ6IFtcInh5XCIsIFwieHF1ZXJ5XCJdfSxcbiAgICB7bmFtZTogXCJZQU1MXCIsIG1pbWU6IFwidGV4dC94LXlhbWxcIiwgbW9kZTogXCJ5YW1sXCIsIGV4dDogW1wieWFtbFwiLCBcInltbFwiXSwgYWxpYXM6IFtcInltbFwiXX0sXG4gICAge25hbWU6IFwiWjgwXCIsIG1pbWU6IFwidGV4dC94LXo4MFwiLCBtb2RlOiBcIno4MFwiLCBleHQ6IFtcIno4MFwiXX0sXG4gICAge25hbWU6IFwibXNjZ2VuXCIsIG1pbWU6IFwidGV4dC94LW1zY2dlblwiLCBtb2RlOiBcIm1zY2dlblwiLCBleHQ6IFtcIm1zY2dlblwiLCBcIm1zY2luXCIsIFwibXNjXCJdfSxcbiAgICB7bmFtZTogXCJ4dVwiLCBtaW1lOiBcInRleHQveC14dVwiLCBtb2RlOiBcIm1zY2dlblwiLCBleHQ6IFtcInh1XCJdfSxcbiAgICB7bmFtZTogXCJtc2dlbm55XCIsIG1pbWU6IFwidGV4dC94LW1zZ2VubnlcIiwgbW9kZTogXCJtc2NnZW5cIiwgZXh0OiBbXCJtc2dlbm55XCJdfVxuICBdO1xuICAvLyBFbnN1cmUgYWxsIG1vZGVzIGhhdmUgYSBtaW1lIHByb3BlcnR5IGZvciBiYWNrd2FyZHMgY29tcGF0aWJpbGl0eVxuICBmb3IgKHZhciBpID0gMDsgaSA8IENvZGVNaXJyb3IubW9kZUluZm8ubGVuZ3RoOyBpKyspIHtcbiAgICB2YXIgaW5mbyA9IENvZGVNaXJyb3IubW9kZUluZm9baV07XG4gICAgaWYgKGluZm8ubWltZXMpIGluZm8ubWltZSA9IGluZm8ubWltZXNbMF07XG4gIH1cblxuICBDb2RlTWlycm9yLmZpbmRNb2RlQnlNSU1FID0gZnVuY3Rpb24obWltZSkge1xuICAgIG1pbWUgPSBtaW1lLnRvTG93ZXJDYXNlKCk7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBDb2RlTWlycm9yLm1vZGVJbmZvLmxlbmd0aDsgaSsrKSB7XG4gICAgICB2YXIgaW5mbyA9IENvZGVNaXJyb3IubW9kZUluZm9baV07XG4gICAgICBpZiAoaW5mby5taW1lID09IG1pbWUpIHJldHVybiBpbmZvO1xuICAgICAgaWYgKGluZm8ubWltZXMpIGZvciAodmFyIGogPSAwOyBqIDwgaW5mby5taW1lcy5sZW5ndGg7IGorKylcbiAgICAgICAgaWYgKGluZm8ubWltZXNbal0gPT0gbWltZSkgcmV0dXJuIGluZm87XG4gICAgfVxuICB9O1xuXG4gIENvZGVNaXJyb3IuZmluZE1vZGVCeUV4dGVuc2lvbiA9IGZ1bmN0aW9uKGV4dCkge1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgQ29kZU1pcnJvci5tb2RlSW5mby5sZW5ndGg7IGkrKykge1xuICAgICAgdmFyIGluZm8gPSBDb2RlTWlycm9yLm1vZGVJbmZvW2ldO1xuICAgICAgaWYgKGluZm8uZXh0KSBmb3IgKHZhciBqID0gMDsgaiA8IGluZm8uZXh0Lmxlbmd0aDsgaisrKVxuICAgICAgICBpZiAoaW5mby5leHRbal0gPT0gZXh0KSByZXR1cm4gaW5mbztcbiAgICB9XG4gIH07XG5cbiAgQ29kZU1pcnJvci5maW5kTW9kZUJ5RmlsZU5hbWUgPSBmdW5jdGlvbihmaWxlbmFtZSkge1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgQ29kZU1pcnJvci5tb2RlSW5mby5sZW5ndGg7IGkrKykge1xuICAgICAgdmFyIGluZm8gPSBDb2RlTWlycm9yLm1vZGVJbmZvW2ldO1xuICAgICAgaWYgKGluZm8uZmlsZSAmJiBpbmZvLmZpbGUudGVzdChmaWxlbmFtZSkpIHJldHVybiBpbmZvO1xuICAgIH1cbiAgICB2YXIgZG90ID0gZmlsZW5hbWUubGFzdEluZGV4T2YoXCIuXCIpO1xuICAgIHZhciBleHQgPSBkb3QgPiAtMSAmJiBmaWxlbmFtZS5zdWJzdHJpbmcoZG90ICsgMSwgZmlsZW5hbWUubGVuZ3RoKTtcbiAgICBpZiAoZXh0KSByZXR1cm4gQ29kZU1pcnJvci5maW5kTW9kZUJ5RXh0ZW5zaW9uKGV4dCk7XG4gIH07XG5cbiAgQ29kZU1pcnJvci5maW5kTW9kZUJ5TmFtZSA9IGZ1bmN0aW9uKG5hbWUpIHtcbiAgICBuYW1lID0gbmFtZS50b0xvd2VyQ2FzZSgpO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgQ29kZU1pcnJvci5tb2RlSW5mby5sZW5ndGg7IGkrKykge1xuICAgICAgdmFyIGluZm8gPSBDb2RlTWlycm9yLm1vZGVJbmZvW2ldO1xuICAgICAgaWYgKGluZm8ubmFtZS50b0xvd2VyQ2FzZSgpID09IG5hbWUpIHJldHVybiBpbmZvO1xuICAgICAgaWYgKGluZm8uYWxpYXMpIGZvciAodmFyIGogPSAwOyBqIDwgaW5mby5hbGlhcy5sZW5ndGg7IGorKylcbiAgICAgICAgaWYgKGluZm8uYWxpYXNbal0udG9Mb3dlckNhc2UoKSA9PSBuYW1lKSByZXR1cm4gaW5mbztcbiAgICB9XG4gIH07XG59KTtcbiIsIi8vIENvZGVNaXJyb3IsIGNvcHlyaWdodCAoYykgYnkgTWFyaWpuIEhhdmVyYmVrZSBhbmQgb3RoZXJzXG4vLyBEaXN0cmlidXRlZCB1bmRlciBhbiBNSVQgbGljZW5zZTogaHR0cDovL2NvZGVtaXJyb3IubmV0L0xJQ0VOU0VcblxuKGZ1bmN0aW9uKG1vZCkge1xuICBpZiAodHlwZW9mIGV4cG9ydHMgPT0gXCJvYmplY3RcIiAmJiB0eXBlb2YgbW9kdWxlID09IFwib2JqZWN0XCIpIC8vIENvbW1vbkpTXG4gICAgbW9kKHJlcXVpcmUoXCIuLi8uLi9saWIvY29kZW1pcnJvclwiKSk7XG4gIGVsc2UgaWYgKHR5cGVvZiBkZWZpbmUgPT0gXCJmdW5jdGlvblwiICYmIGRlZmluZS5hbWQpIC8vIEFNRFxuICAgIGRlZmluZShbXCIuLi8uLi9saWIvY29kZW1pcnJvclwiXSwgbW9kKTtcbiAgZWxzZSAvLyBQbGFpbiBicm93c2VyIGVudlxuICAgIG1vZChDb2RlTWlycm9yKTtcbn0pKGZ1bmN0aW9uKENvZGVNaXJyb3IpIHtcblwidXNlIHN0cmljdFwiO1xuXG52YXIgaHRtbENvbmZpZyA9IHtcbiAgYXV0b1NlbGZDbG9zZXJzOiB7J2FyZWEnOiB0cnVlLCAnYmFzZSc6IHRydWUsICdicic6IHRydWUsICdjb2wnOiB0cnVlLCAnY29tbWFuZCc6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICdlbWJlZCc6IHRydWUsICdmcmFtZSc6IHRydWUsICdocic6IHRydWUsICdpbWcnOiB0cnVlLCAnaW5wdXQnOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAna2V5Z2VuJzogdHJ1ZSwgJ2xpbmsnOiB0cnVlLCAnbWV0YSc6IHRydWUsICdwYXJhbSc6IHRydWUsICdzb3VyY2UnOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAndHJhY2snOiB0cnVlLCAnd2JyJzogdHJ1ZSwgJ21lbnVpdGVtJzogdHJ1ZX0sXG4gIGltcGxpY2l0bHlDbG9zZWQ6IHsnZGQnOiB0cnVlLCAnbGknOiB0cnVlLCAnb3B0Z3JvdXAnOiB0cnVlLCAnb3B0aW9uJzogdHJ1ZSwgJ3AnOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgJ3JwJzogdHJ1ZSwgJ3J0JzogdHJ1ZSwgJ3Rib2R5JzogdHJ1ZSwgJ3RkJzogdHJ1ZSwgJ3Rmb290JzogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICd0aCc6IHRydWUsICd0cic6IHRydWV9LFxuICBjb250ZXh0R3JhYmJlcnM6IHtcbiAgICAnZGQnOiB7J2RkJzogdHJ1ZSwgJ2R0JzogdHJ1ZX0sXG4gICAgJ2R0JzogeydkZCc6IHRydWUsICdkdCc6IHRydWV9LFxuICAgICdsaSc6IHsnbGknOiB0cnVlfSxcbiAgICAnb3B0aW9uJzogeydvcHRpb24nOiB0cnVlLCAnb3B0Z3JvdXAnOiB0cnVlfSxcbiAgICAnb3B0Z3JvdXAnOiB7J29wdGdyb3VwJzogdHJ1ZX0sXG4gICAgJ3AnOiB7J2FkZHJlc3MnOiB0cnVlLCAnYXJ0aWNsZSc6IHRydWUsICdhc2lkZSc6IHRydWUsICdibG9ja3F1b3RlJzogdHJ1ZSwgJ2Rpcic6IHRydWUsXG4gICAgICAgICAgJ2Rpdic6IHRydWUsICdkbCc6IHRydWUsICdmaWVsZHNldCc6IHRydWUsICdmb290ZXInOiB0cnVlLCAnZm9ybSc6IHRydWUsXG4gICAgICAgICAgJ2gxJzogdHJ1ZSwgJ2gyJzogdHJ1ZSwgJ2gzJzogdHJ1ZSwgJ2g0JzogdHJ1ZSwgJ2g1JzogdHJ1ZSwgJ2g2JzogdHJ1ZSxcbiAgICAgICAgICAnaGVhZGVyJzogdHJ1ZSwgJ2hncm91cCc6IHRydWUsICdocic6IHRydWUsICdtZW51JzogdHJ1ZSwgJ25hdic6IHRydWUsICdvbCc6IHRydWUsXG4gICAgICAgICAgJ3AnOiB0cnVlLCAncHJlJzogdHJ1ZSwgJ3NlY3Rpb24nOiB0cnVlLCAndGFibGUnOiB0cnVlLCAndWwnOiB0cnVlfSxcbiAgICAncnAnOiB7J3JwJzogdHJ1ZSwgJ3J0JzogdHJ1ZX0sXG4gICAgJ3J0JzogeydycCc6IHRydWUsICdydCc6IHRydWV9LFxuICAgICd0Ym9keSc6IHsndGJvZHknOiB0cnVlLCAndGZvb3QnOiB0cnVlfSxcbiAgICAndGQnOiB7J3RkJzogdHJ1ZSwgJ3RoJzogdHJ1ZX0sXG4gICAgJ3Rmb290Jzogeyd0Ym9keSc6IHRydWV9LFxuICAgICd0aCc6IHsndGQnOiB0cnVlLCAndGgnOiB0cnVlfSxcbiAgICAndGhlYWQnOiB7J3Rib2R5JzogdHJ1ZSwgJ3Rmb290JzogdHJ1ZX0sXG4gICAgJ3RyJzogeyd0cic6IHRydWV9XG4gIH0sXG4gIGRvTm90SW5kZW50OiB7XCJwcmVcIjogdHJ1ZX0sXG4gIGFsbG93VW5xdW90ZWQ6IHRydWUsXG4gIGFsbG93TWlzc2luZzogdHJ1ZSxcbiAgY2FzZUZvbGQ6IHRydWVcbn1cblxudmFyIHhtbENvbmZpZyA9IHtcbiAgYXV0b1NlbGZDbG9zZXJzOiB7fSxcbiAgaW1wbGljaXRseUNsb3NlZDoge30sXG4gIGNvbnRleHRHcmFiYmVyczoge30sXG4gIGRvTm90SW5kZW50OiB7fSxcbiAgYWxsb3dVbnF1b3RlZDogZmFsc2UsXG4gIGFsbG93TWlzc2luZzogZmFsc2UsXG4gIGNhc2VGb2xkOiBmYWxzZVxufVxuXG5Db2RlTWlycm9yLmRlZmluZU1vZGUoXCJ4bWxcIiwgZnVuY3Rpb24oZWRpdG9yQ29uZiwgY29uZmlnXykge1xuICB2YXIgaW5kZW50VW5pdCA9IGVkaXRvckNvbmYuaW5kZW50VW5pdFxuICB2YXIgY29uZmlnID0ge31cbiAgdmFyIGRlZmF1bHRzID0gY29uZmlnXy5odG1sTW9kZSA/IGh0bWxDb25maWcgOiB4bWxDb25maWdcbiAgZm9yICh2YXIgcHJvcCBpbiBkZWZhdWx0cykgY29uZmlnW3Byb3BdID0gZGVmYXVsdHNbcHJvcF1cbiAgZm9yICh2YXIgcHJvcCBpbiBjb25maWdfKSBjb25maWdbcHJvcF0gPSBjb25maWdfW3Byb3BdXG5cbiAgLy8gUmV0dXJuIHZhcmlhYmxlcyBmb3IgdG9rZW5pemVyc1xuICB2YXIgdHlwZSwgc2V0U3R5bGU7XG5cbiAgZnVuY3Rpb24gaW5UZXh0KHN0cmVhbSwgc3RhdGUpIHtcbiAgICBmdW5jdGlvbiBjaGFpbihwYXJzZXIpIHtcbiAgICAgIHN0YXRlLnRva2VuaXplID0gcGFyc2VyO1xuICAgICAgcmV0dXJuIHBhcnNlcihzdHJlYW0sIHN0YXRlKTtcbiAgICB9XG5cbiAgICB2YXIgY2ggPSBzdHJlYW0ubmV4dCgpO1xuICAgIGlmIChjaCA9PSBcIjxcIikge1xuICAgICAgaWYgKHN0cmVhbS5lYXQoXCIhXCIpKSB7XG4gICAgICAgIGlmIChzdHJlYW0uZWF0KFwiW1wiKSkge1xuICAgICAgICAgIGlmIChzdHJlYW0ubWF0Y2goXCJDREFUQVtcIikpIHJldHVybiBjaGFpbihpbkJsb2NrKFwiYXRvbVwiLCBcIl1dPlwiKSk7XG4gICAgICAgICAgZWxzZSByZXR1cm4gbnVsbDtcbiAgICAgICAgfSBlbHNlIGlmIChzdHJlYW0ubWF0Y2goXCItLVwiKSkge1xuICAgICAgICAgIHJldHVybiBjaGFpbihpbkJsb2NrKFwiY29tbWVudFwiLCBcIi0tPlwiKSk7XG4gICAgICAgIH0gZWxzZSBpZiAoc3RyZWFtLm1hdGNoKFwiRE9DVFlQRVwiLCB0cnVlLCB0cnVlKSkge1xuICAgICAgICAgIHN0cmVhbS5lYXRXaGlsZSgvW1xcd1xcLl9cXC1dLyk7XG4gICAgICAgICAgcmV0dXJuIGNoYWluKGRvY3R5cGUoMSkpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKHN0cmVhbS5lYXQoXCI/XCIpKSB7XG4gICAgICAgIHN0cmVhbS5lYXRXaGlsZSgvW1xcd1xcLl9cXC1dLyk7XG4gICAgICAgIHN0YXRlLnRva2VuaXplID0gaW5CbG9jayhcIm1ldGFcIiwgXCI/PlwiKTtcbiAgICAgICAgcmV0dXJuIFwibWV0YVwiO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdHlwZSA9IHN0cmVhbS5lYXQoXCIvXCIpID8gXCJjbG9zZVRhZ1wiIDogXCJvcGVuVGFnXCI7XG4gICAgICAgIHN0YXRlLnRva2VuaXplID0gaW5UYWc7XG4gICAgICAgIHJldHVybiBcInRhZyBicmFja2V0XCI7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChjaCA9PSBcIiZcIikge1xuICAgICAgdmFyIG9rO1xuICAgICAgaWYgKHN0cmVhbS5lYXQoXCIjXCIpKSB7XG4gICAgICAgIGlmIChzdHJlYW0uZWF0KFwieFwiKSkge1xuICAgICAgICAgIG9rID0gc3RyZWFtLmVhdFdoaWxlKC9bYS1mQS1GXFxkXS8pICYmIHN0cmVhbS5lYXQoXCI7XCIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIG9rID0gc3RyZWFtLmVhdFdoaWxlKC9bXFxkXS8pICYmIHN0cmVhbS5lYXQoXCI7XCIpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBvayA9IHN0cmVhbS5lYXRXaGlsZSgvW1xcd1xcLlxcLTpdLykgJiYgc3RyZWFtLmVhdChcIjtcIik7XG4gICAgICB9XG4gICAgICByZXR1cm4gb2sgPyBcImF0b21cIiA6IFwiZXJyb3JcIjtcbiAgICB9IGVsc2Uge1xuICAgICAgc3RyZWFtLmVhdFdoaWxlKC9bXiY8XS8pO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICB9XG4gIGluVGV4dC5pc0luVGV4dCA9IHRydWU7XG5cbiAgZnVuY3Rpb24gaW5UYWcoc3RyZWFtLCBzdGF0ZSkge1xuICAgIHZhciBjaCA9IHN0cmVhbS5uZXh0KCk7XG4gICAgaWYgKGNoID09IFwiPlwiIHx8IChjaCA9PSBcIi9cIiAmJiBzdHJlYW0uZWF0KFwiPlwiKSkpIHtcbiAgICAgIHN0YXRlLnRva2VuaXplID0gaW5UZXh0O1xuICAgICAgdHlwZSA9IGNoID09IFwiPlwiID8gXCJlbmRUYWdcIiA6IFwic2VsZmNsb3NlVGFnXCI7XG4gICAgICByZXR1cm4gXCJ0YWcgYnJhY2tldFwiO1xuICAgIH0gZWxzZSBpZiAoY2ggPT0gXCI9XCIpIHtcbiAgICAgIHR5cGUgPSBcImVxdWFsc1wiO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfSBlbHNlIGlmIChjaCA9PSBcIjxcIikge1xuICAgICAgc3RhdGUudG9rZW5pemUgPSBpblRleHQ7XG4gICAgICBzdGF0ZS5zdGF0ZSA9IGJhc2VTdGF0ZTtcbiAgICAgIHN0YXRlLnRhZ05hbWUgPSBzdGF0ZS50YWdTdGFydCA9IG51bGw7XG4gICAgICB2YXIgbmV4dCA9IHN0YXRlLnRva2VuaXplKHN0cmVhbSwgc3RhdGUpO1xuICAgICAgcmV0dXJuIG5leHQgPyBuZXh0ICsgXCIgdGFnIGVycm9yXCIgOiBcInRhZyBlcnJvclwiO1xuICAgIH0gZWxzZSBpZiAoL1tcXCdcXFwiXS8udGVzdChjaCkpIHtcbiAgICAgIHN0YXRlLnRva2VuaXplID0gaW5BdHRyaWJ1dGUoY2gpO1xuICAgICAgc3RhdGUuc3RyaW5nU3RhcnRDb2wgPSBzdHJlYW0uY29sdW1uKCk7XG4gICAgICByZXR1cm4gc3RhdGUudG9rZW5pemUoc3RyZWFtLCBzdGF0ZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHN0cmVhbS5tYXRjaCgvXlteXFxzXFx1MDBhMD08PlxcXCJcXCddKlteXFxzXFx1MDBhMD08PlxcXCJcXCdcXC9dLyk7XG4gICAgICByZXR1cm4gXCJ3b3JkXCI7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gaW5BdHRyaWJ1dGUocXVvdGUpIHtcbiAgICB2YXIgY2xvc3VyZSA9IGZ1bmN0aW9uKHN0cmVhbSwgc3RhdGUpIHtcbiAgICAgIHdoaWxlICghc3RyZWFtLmVvbCgpKSB7XG4gICAgICAgIGlmIChzdHJlYW0ubmV4dCgpID09IHF1b3RlKSB7XG4gICAgICAgICAgc3RhdGUudG9rZW5pemUgPSBpblRhZztcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIFwic3RyaW5nXCI7XG4gICAgfTtcbiAgICBjbG9zdXJlLmlzSW5BdHRyaWJ1dGUgPSB0cnVlO1xuICAgIHJldHVybiBjbG9zdXJlO1xuICB9XG5cbiAgZnVuY3Rpb24gaW5CbG9jayhzdHlsZSwgdGVybWluYXRvcikge1xuICAgIHJldHVybiBmdW5jdGlvbihzdHJlYW0sIHN0YXRlKSB7XG4gICAgICB3aGlsZSAoIXN0cmVhbS5lb2woKSkge1xuICAgICAgICBpZiAoc3RyZWFtLm1hdGNoKHRlcm1pbmF0b3IpKSB7XG4gICAgICAgICAgc3RhdGUudG9rZW5pemUgPSBpblRleHQ7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgc3RyZWFtLm5leHQoKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBzdHlsZTtcbiAgICB9O1xuICB9XG4gIGZ1bmN0aW9uIGRvY3R5cGUoZGVwdGgpIHtcbiAgICByZXR1cm4gZnVuY3Rpb24oc3RyZWFtLCBzdGF0ZSkge1xuICAgICAgdmFyIGNoO1xuICAgICAgd2hpbGUgKChjaCA9IHN0cmVhbS5uZXh0KCkpICE9IG51bGwpIHtcbiAgICAgICAgaWYgKGNoID09IFwiPFwiKSB7XG4gICAgICAgICAgc3RhdGUudG9rZW5pemUgPSBkb2N0eXBlKGRlcHRoICsgMSk7XG4gICAgICAgICAgcmV0dXJuIHN0YXRlLnRva2VuaXplKHN0cmVhbSwgc3RhdGUpO1xuICAgICAgICB9IGVsc2UgaWYgKGNoID09IFwiPlwiKSB7XG4gICAgICAgICAgaWYgKGRlcHRoID09IDEpIHtcbiAgICAgICAgICAgIHN0YXRlLnRva2VuaXplID0gaW5UZXh0O1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHN0YXRlLnRva2VuaXplID0gZG9jdHlwZShkZXB0aCAtIDEpO1xuICAgICAgICAgICAgcmV0dXJuIHN0YXRlLnRva2VuaXplKHN0cmVhbSwgc3RhdGUpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIFwibWV0YVwiO1xuICAgIH07XG4gIH1cblxuICBmdW5jdGlvbiBDb250ZXh0KHN0YXRlLCB0YWdOYW1lLCBzdGFydE9mTGluZSkge1xuICAgIHRoaXMucHJldiA9IHN0YXRlLmNvbnRleHQ7XG4gICAgdGhpcy50YWdOYW1lID0gdGFnTmFtZTtcbiAgICB0aGlzLmluZGVudCA9IHN0YXRlLmluZGVudGVkO1xuICAgIHRoaXMuc3RhcnRPZkxpbmUgPSBzdGFydE9mTGluZTtcbiAgICBpZiAoY29uZmlnLmRvTm90SW5kZW50Lmhhc093blByb3BlcnR5KHRhZ05hbWUpIHx8IChzdGF0ZS5jb250ZXh0ICYmIHN0YXRlLmNvbnRleHQubm9JbmRlbnQpKVxuICAgICAgdGhpcy5ub0luZGVudCA9IHRydWU7XG4gIH1cbiAgZnVuY3Rpb24gcG9wQ29udGV4dChzdGF0ZSkge1xuICAgIGlmIChzdGF0ZS5jb250ZXh0KSBzdGF0ZS5jb250ZXh0ID0gc3RhdGUuY29udGV4dC5wcmV2O1xuICB9XG4gIGZ1bmN0aW9uIG1heWJlUG9wQ29udGV4dChzdGF0ZSwgbmV4dFRhZ05hbWUpIHtcbiAgICB2YXIgcGFyZW50VGFnTmFtZTtcbiAgICB3aGlsZSAodHJ1ZSkge1xuICAgICAgaWYgKCFzdGF0ZS5jb250ZXh0KSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHBhcmVudFRhZ05hbWUgPSBzdGF0ZS5jb250ZXh0LnRhZ05hbWU7XG4gICAgICBpZiAoIWNvbmZpZy5jb250ZXh0R3JhYmJlcnMuaGFzT3duUHJvcGVydHkocGFyZW50VGFnTmFtZSkgfHxcbiAgICAgICAgICAhY29uZmlnLmNvbnRleHRHcmFiYmVyc1twYXJlbnRUYWdOYW1lXS5oYXNPd25Qcm9wZXJ0eShuZXh0VGFnTmFtZSkpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgcG9wQ29udGV4dChzdGF0ZSk7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gYmFzZVN0YXRlKHR5cGUsIHN0cmVhbSwgc3RhdGUpIHtcbiAgICBpZiAodHlwZSA9PSBcIm9wZW5UYWdcIikge1xuICAgICAgc3RhdGUudGFnU3RhcnQgPSBzdHJlYW0uY29sdW1uKCk7XG4gICAgICByZXR1cm4gdGFnTmFtZVN0YXRlO1xuICAgIH0gZWxzZSBpZiAodHlwZSA9PSBcImNsb3NlVGFnXCIpIHtcbiAgICAgIHJldHVybiBjbG9zZVRhZ05hbWVTdGF0ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIGJhc2VTdGF0ZTtcbiAgICB9XG4gIH1cbiAgZnVuY3Rpb24gdGFnTmFtZVN0YXRlKHR5cGUsIHN0cmVhbSwgc3RhdGUpIHtcbiAgICBpZiAodHlwZSA9PSBcIndvcmRcIikge1xuICAgICAgc3RhdGUudGFnTmFtZSA9IHN0cmVhbS5jdXJyZW50KCk7XG4gICAgICBzZXRTdHlsZSA9IFwidGFnXCI7XG4gICAgICByZXR1cm4gYXR0clN0YXRlO1xuICAgIH0gZWxzZSB7XG4gICAgICBzZXRTdHlsZSA9IFwiZXJyb3JcIjtcbiAgICAgIHJldHVybiB0YWdOYW1lU3RhdGU7XG4gICAgfVxuICB9XG4gIGZ1bmN0aW9uIGNsb3NlVGFnTmFtZVN0YXRlKHR5cGUsIHN0cmVhbSwgc3RhdGUpIHtcbiAgICBpZiAodHlwZSA9PSBcIndvcmRcIikge1xuICAgICAgdmFyIHRhZ05hbWUgPSBzdHJlYW0uY3VycmVudCgpO1xuICAgICAgaWYgKHN0YXRlLmNvbnRleHQgJiYgc3RhdGUuY29udGV4dC50YWdOYW1lICE9IHRhZ05hbWUgJiZcbiAgICAgICAgICBjb25maWcuaW1wbGljaXRseUNsb3NlZC5oYXNPd25Qcm9wZXJ0eShzdGF0ZS5jb250ZXh0LnRhZ05hbWUpKVxuICAgICAgICBwb3BDb250ZXh0KHN0YXRlKTtcbiAgICAgIGlmIChzdGF0ZS5jb250ZXh0ICYmIHN0YXRlLmNvbnRleHQudGFnTmFtZSA9PSB0YWdOYW1lKSB7XG4gICAgICAgIHNldFN0eWxlID0gXCJ0YWdcIjtcbiAgICAgICAgcmV0dXJuIGNsb3NlU3RhdGU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzZXRTdHlsZSA9IFwidGFnIGVycm9yXCI7XG4gICAgICAgIHJldHVybiBjbG9zZVN0YXRlRXJyO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBzZXRTdHlsZSA9IFwiZXJyb3JcIjtcbiAgICAgIHJldHVybiBjbG9zZVN0YXRlRXJyO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIGNsb3NlU3RhdGUodHlwZSwgX3N0cmVhbSwgc3RhdGUpIHtcbiAgICBpZiAodHlwZSAhPSBcImVuZFRhZ1wiKSB7XG4gICAgICBzZXRTdHlsZSA9IFwiZXJyb3JcIjtcbiAgICAgIHJldHVybiBjbG9zZVN0YXRlO1xuICAgIH1cbiAgICBwb3BDb250ZXh0KHN0YXRlKTtcbiAgICByZXR1cm4gYmFzZVN0YXRlO1xuICB9XG4gIGZ1bmN0aW9uIGNsb3NlU3RhdGVFcnIodHlwZSwgc3RyZWFtLCBzdGF0ZSkge1xuICAgIHNldFN0eWxlID0gXCJlcnJvclwiO1xuICAgIHJldHVybiBjbG9zZVN0YXRlKHR5cGUsIHN0cmVhbSwgc3RhdGUpO1xuICB9XG5cbiAgZnVuY3Rpb24gYXR0clN0YXRlKHR5cGUsIF9zdHJlYW0sIHN0YXRlKSB7XG4gICAgaWYgKHR5cGUgPT0gXCJ3b3JkXCIpIHtcbiAgICAgIHNldFN0eWxlID0gXCJhdHRyaWJ1dGVcIjtcbiAgICAgIHJldHVybiBhdHRyRXFTdGF0ZTtcbiAgICB9IGVsc2UgaWYgKHR5cGUgPT0gXCJlbmRUYWdcIiB8fCB0eXBlID09IFwic2VsZmNsb3NlVGFnXCIpIHtcbiAgICAgIHZhciB0YWdOYW1lID0gc3RhdGUudGFnTmFtZSwgdGFnU3RhcnQgPSBzdGF0ZS50YWdTdGFydDtcbiAgICAgIHN0YXRlLnRhZ05hbWUgPSBzdGF0ZS50YWdTdGFydCA9IG51bGw7XG4gICAgICBpZiAodHlwZSA9PSBcInNlbGZjbG9zZVRhZ1wiIHx8XG4gICAgICAgICAgY29uZmlnLmF1dG9TZWxmQ2xvc2Vycy5oYXNPd25Qcm9wZXJ0eSh0YWdOYW1lKSkge1xuICAgICAgICBtYXliZVBvcENvbnRleHQoc3RhdGUsIHRhZ05hbWUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbWF5YmVQb3BDb250ZXh0KHN0YXRlLCB0YWdOYW1lKTtcbiAgICAgICAgc3RhdGUuY29udGV4dCA9IG5ldyBDb250ZXh0KHN0YXRlLCB0YWdOYW1lLCB0YWdTdGFydCA9PSBzdGF0ZS5pbmRlbnRlZCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gYmFzZVN0YXRlO1xuICAgIH1cbiAgICBzZXRTdHlsZSA9IFwiZXJyb3JcIjtcbiAgICByZXR1cm4gYXR0clN0YXRlO1xuICB9XG4gIGZ1bmN0aW9uIGF0dHJFcVN0YXRlKHR5cGUsIHN0cmVhbSwgc3RhdGUpIHtcbiAgICBpZiAodHlwZSA9PSBcImVxdWFsc1wiKSByZXR1cm4gYXR0clZhbHVlU3RhdGU7XG4gICAgaWYgKCFjb25maWcuYWxsb3dNaXNzaW5nKSBzZXRTdHlsZSA9IFwiZXJyb3JcIjtcbiAgICByZXR1cm4gYXR0clN0YXRlKHR5cGUsIHN0cmVhbSwgc3RhdGUpO1xuICB9XG4gIGZ1bmN0aW9uIGF0dHJWYWx1ZVN0YXRlKHR5cGUsIHN0cmVhbSwgc3RhdGUpIHtcbiAgICBpZiAodHlwZSA9PSBcInN0cmluZ1wiKSByZXR1cm4gYXR0ckNvbnRpbnVlZFN0YXRlO1xuICAgIGlmICh0eXBlID09IFwid29yZFwiICYmIGNvbmZpZy5hbGxvd1VucXVvdGVkKSB7c2V0U3R5bGUgPSBcInN0cmluZ1wiOyByZXR1cm4gYXR0clN0YXRlO31cbiAgICBzZXRTdHlsZSA9IFwiZXJyb3JcIjtcbiAgICByZXR1cm4gYXR0clN0YXRlKHR5cGUsIHN0cmVhbSwgc3RhdGUpO1xuICB9XG4gIGZ1bmN0aW9uIGF0dHJDb250aW51ZWRTdGF0ZSh0eXBlLCBzdHJlYW0sIHN0YXRlKSB7XG4gICAgaWYgKHR5cGUgPT0gXCJzdHJpbmdcIikgcmV0dXJuIGF0dHJDb250aW51ZWRTdGF0ZTtcbiAgICByZXR1cm4gYXR0clN0YXRlKHR5cGUsIHN0cmVhbSwgc3RhdGUpO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBzdGFydFN0YXRlOiBmdW5jdGlvbihiYXNlSW5kZW50KSB7XG4gICAgICB2YXIgc3RhdGUgPSB7dG9rZW5pemU6IGluVGV4dCxcbiAgICAgICAgICAgICAgICAgICBzdGF0ZTogYmFzZVN0YXRlLFxuICAgICAgICAgICAgICAgICAgIGluZGVudGVkOiBiYXNlSW5kZW50IHx8IDAsXG4gICAgICAgICAgICAgICAgICAgdGFnTmFtZTogbnVsbCwgdGFnU3RhcnQ6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgY29udGV4dDogbnVsbH1cbiAgICAgIGlmIChiYXNlSW5kZW50ICE9IG51bGwpIHN0YXRlLmJhc2VJbmRlbnQgPSBiYXNlSW5kZW50XG4gICAgICByZXR1cm4gc3RhdGVcbiAgICB9LFxuXG4gICAgdG9rZW46IGZ1bmN0aW9uKHN0cmVhbSwgc3RhdGUpIHtcbiAgICAgIGlmICghc3RhdGUudGFnTmFtZSAmJiBzdHJlYW0uc29sKCkpXG4gICAgICAgIHN0YXRlLmluZGVudGVkID0gc3RyZWFtLmluZGVudGF0aW9uKCk7XG5cbiAgICAgIGlmIChzdHJlYW0uZWF0U3BhY2UoKSkgcmV0dXJuIG51bGw7XG4gICAgICB0eXBlID0gbnVsbDtcbiAgICAgIHZhciBzdHlsZSA9IHN0YXRlLnRva2VuaXplKHN0cmVhbSwgc3RhdGUpO1xuICAgICAgaWYgKChzdHlsZSB8fCB0eXBlKSAmJiBzdHlsZSAhPSBcImNvbW1lbnRcIikge1xuICAgICAgICBzZXRTdHlsZSA9IG51bGw7XG4gICAgICAgIHN0YXRlLnN0YXRlID0gc3RhdGUuc3RhdGUodHlwZSB8fCBzdHlsZSwgc3RyZWFtLCBzdGF0ZSk7XG4gICAgICAgIGlmIChzZXRTdHlsZSlcbiAgICAgICAgICBzdHlsZSA9IHNldFN0eWxlID09IFwiZXJyb3JcIiA/IHN0eWxlICsgXCIgZXJyb3JcIiA6IHNldFN0eWxlO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHN0eWxlO1xuICAgIH0sXG5cbiAgICBpbmRlbnQ6IGZ1bmN0aW9uKHN0YXRlLCB0ZXh0QWZ0ZXIsIGZ1bGxMaW5lKSB7XG4gICAgICB2YXIgY29udGV4dCA9IHN0YXRlLmNvbnRleHQ7XG4gICAgICAvLyBJbmRlbnQgbXVsdGktbGluZSBzdHJpbmdzIChlLmcuIGNzcykuXG4gICAgICBpZiAoc3RhdGUudG9rZW5pemUuaXNJbkF0dHJpYnV0ZSkge1xuICAgICAgICBpZiAoc3RhdGUudGFnU3RhcnQgPT0gc3RhdGUuaW5kZW50ZWQpXG4gICAgICAgICAgcmV0dXJuIHN0YXRlLnN0cmluZ1N0YXJ0Q29sICsgMTtcbiAgICAgICAgZWxzZVxuICAgICAgICAgIHJldHVybiBzdGF0ZS5pbmRlbnRlZCArIGluZGVudFVuaXQ7XG4gICAgICB9XG4gICAgICBpZiAoY29udGV4dCAmJiBjb250ZXh0Lm5vSW5kZW50KSByZXR1cm4gQ29kZU1pcnJvci5QYXNzO1xuICAgICAgaWYgKHN0YXRlLnRva2VuaXplICE9IGluVGFnICYmIHN0YXRlLnRva2VuaXplICE9IGluVGV4dClcbiAgICAgICAgcmV0dXJuIGZ1bGxMaW5lID8gZnVsbExpbmUubWF0Y2goL14oXFxzKikvKVswXS5sZW5ndGggOiAwO1xuICAgICAgLy8gSW5kZW50IHRoZSBzdGFydHMgb2YgYXR0cmlidXRlIG5hbWVzLlxuICAgICAgaWYgKHN0YXRlLnRhZ05hbWUpIHtcbiAgICAgICAgaWYgKGNvbmZpZy5tdWx0aWxpbmVUYWdJbmRlbnRQYXN0VGFnICE9PSBmYWxzZSlcbiAgICAgICAgICByZXR1cm4gc3RhdGUudGFnU3RhcnQgKyBzdGF0ZS50YWdOYW1lLmxlbmd0aCArIDI7XG4gICAgICAgIGVsc2VcbiAgICAgICAgICByZXR1cm4gc3RhdGUudGFnU3RhcnQgKyBpbmRlbnRVbml0ICogKGNvbmZpZy5tdWx0aWxpbmVUYWdJbmRlbnRGYWN0b3IgfHwgMSk7XG4gICAgICB9XG4gICAgICBpZiAoY29uZmlnLmFsaWduQ0RBVEEgJiYgLzwhXFxbQ0RBVEFcXFsvLnRlc3QodGV4dEFmdGVyKSkgcmV0dXJuIDA7XG4gICAgICB2YXIgdGFnQWZ0ZXIgPSB0ZXh0QWZ0ZXIgJiYgL148KFxcLyk/KFtcXHdfOlxcLi1dKikvLmV4ZWModGV4dEFmdGVyKTtcbiAgICAgIGlmICh0YWdBZnRlciAmJiB0YWdBZnRlclsxXSkgeyAvLyBDbG9zaW5nIHRhZyBzcG90dGVkXG4gICAgICAgIHdoaWxlIChjb250ZXh0KSB7XG4gICAgICAgICAgaWYgKGNvbnRleHQudGFnTmFtZSA9PSB0YWdBZnRlclsyXSkge1xuICAgICAgICAgICAgY29udGV4dCA9IGNvbnRleHQucHJldjtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH0gZWxzZSBpZiAoY29uZmlnLmltcGxpY2l0bHlDbG9zZWQuaGFzT3duUHJvcGVydHkoY29udGV4dC50YWdOYW1lKSkge1xuICAgICAgICAgICAgY29udGV4dCA9IGNvbnRleHQucHJldjtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKHRhZ0FmdGVyKSB7IC8vIE9wZW5pbmcgdGFnIHNwb3R0ZWRcbiAgICAgICAgd2hpbGUgKGNvbnRleHQpIHtcbiAgICAgICAgICB2YXIgZ3JhYmJlcnMgPSBjb25maWcuY29udGV4dEdyYWJiZXJzW2NvbnRleHQudGFnTmFtZV07XG4gICAgICAgICAgaWYgKGdyYWJiZXJzICYmIGdyYWJiZXJzLmhhc093blByb3BlcnR5KHRhZ0FmdGVyWzJdKSlcbiAgICAgICAgICAgIGNvbnRleHQgPSBjb250ZXh0LnByZXY7XG4gICAgICAgICAgZWxzZVxuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHdoaWxlIChjb250ZXh0ICYmIGNvbnRleHQucHJldiAmJiAhY29udGV4dC5zdGFydE9mTGluZSlcbiAgICAgICAgY29udGV4dCA9IGNvbnRleHQucHJldjtcbiAgICAgIGlmIChjb250ZXh0KSByZXR1cm4gY29udGV4dC5pbmRlbnQgKyBpbmRlbnRVbml0O1xuICAgICAgZWxzZSByZXR1cm4gc3RhdGUuYmFzZUluZGVudCB8fCAwO1xuICAgIH0sXG5cbiAgICBlbGVjdHJpY0lucHV0OiAvPFxcL1tcXHNcXHc6XSs+JC8sXG4gICAgYmxvY2tDb21tZW50U3RhcnQ6IFwiPCEtLVwiLFxuICAgIGJsb2NrQ29tbWVudEVuZDogXCItLT5cIixcblxuICAgIGNvbmZpZ3VyYXRpb246IGNvbmZpZy5odG1sTW9kZSA/IFwiaHRtbFwiIDogXCJ4bWxcIixcbiAgICBoZWxwZXJUeXBlOiBjb25maWcuaHRtbE1vZGUgPyBcImh0bWxcIiA6IFwieG1sXCIsXG5cbiAgICBza2lwQXR0cmlidXRlOiBmdW5jdGlvbihzdGF0ZSkge1xuICAgICAgaWYgKHN0YXRlLnN0YXRlID09IGF0dHJWYWx1ZVN0YXRlKVxuICAgICAgICBzdGF0ZS5zdGF0ZSA9IGF0dHJTdGF0ZVxuICAgIH1cbiAgfTtcbn0pO1xuXG5Db2RlTWlycm9yLmRlZmluZU1JTUUoXCJ0ZXh0L3htbFwiLCBcInhtbFwiKTtcbkNvZGVNaXJyb3IuZGVmaW5lTUlNRShcImFwcGxpY2F0aW9uL3htbFwiLCBcInhtbFwiKTtcbmlmICghQ29kZU1pcnJvci5taW1lTW9kZXMuaGFzT3duUHJvcGVydHkoXCJ0ZXh0L2h0bWxcIikpXG4gIENvZGVNaXJyb3IuZGVmaW5lTUlNRShcInRleHQvaHRtbFwiLCB7bmFtZTogXCJ4bWxcIiwgaHRtbE1vZGU6IHRydWV9KTtcblxufSk7XG4iLCJpbXBvcnQge2V2ZX0gZnJvbSBcIi4vYXBwXCI7XG5cbmRlY2xhcmUgdmFyIHBsdXJhbGl6ZTtcblxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuLy8gVXNlci1GYWNpbmcgZnVuY3Rpb25zXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbmV4cG9ydCBpbnRlcmZhY2UgUmVzdWx0IHtcbiAgaW50ZW50OiBJbnRlbnRzLFxuICBjb250ZXh0OiBDb250ZXh0LFxuICB0b2tlbnM6IEFycmF5PFRva2VuPixcbiAgdHJlZTogTm9kZSxcbiAgcXVlcnk6IFF1ZXJ5LFxuICBpbnNlcnRzOiBBcnJheTxJbnNlcnQ+LFxufVxuXG5leHBvcnQgZW51bSBOb2RlVHlwZXMge1xuICBFTlRJVFksXG4gIENPTExFQ1RJT04sXG4gIEFUVFJJQlVURSxcbiAgTlVNQkVSLFxuICBTVFJJTkcsXG4gIEZVTkNUSU9OLFxufVxuXG5leHBvcnQgaW50ZXJmYWNlIEluc2VydCB7XG4gIGVudGl0eTogTm9kZSxcbiAgYXR0cmlidXRlOiBOb2RlLFxuICB2YWx1ZTogTm9kZXxRdWVyeSxcbn1cblxuZXhwb3J0IGVudW0gSW50ZW50cyB7XG4gIFFVRVJZLFxuICBJTlNFUlQsXG4gIE1PUkVJTkZPLFxuICBOT1JFU1VMVCxcbn1cblxuLy8gRW50cnkgcG9pbnQgZm9yIE5MUVBcbmV4cG9ydCBmdW5jdGlvbiBwYXJzZShxdWVyeVN0cmluZzogc3RyaW5nLCBsYXN0UGFyc2U/OiBSZXN1bHQpOiBBcnJheTxSZXN1bHQ+IHtcbiAgbGV0IHRyZWU6IE5vZGU7XG4gIGxldCBjb250ZXh0OiBDb250ZXh0O1xuICBsZXQgdG9rZW5zOiBBcnJheTxUb2tlbj47XG4gIC8vIElmIHRoaXMgaXMgdGhlIGZpcnN0IHJ1biwgdGhlbiBjcmVhdGUgYSByb290IG5vZGUuXG4gIGlmIChsYXN0UGFyc2UgPT09IHVuZGVmaW5lZCkge1xuICAgIGxldCByb290VG9rZW4gPSBuZXdUb2tlbihcInJvb3RcIik7XG4gICAgcm9vdFRva2VuLnByb3BlcnRpZXMucHVzaChQcm9wZXJ0aWVzLlJPT1QpO1xuICAgIHRyZWUgPSBuZXdOb2RlKHJvb3RUb2tlbik7XG4gICAgdHJlZS5mb3VuZCA9IHRydWU7XG4gICAgY29udGV4dCA9IG5ld0NvbnRleHQoKTtcbiAgICB0b2tlbnMgPSBbcm9vdFRva2VuXTtcbiAgLy8gT3RoZXJ3aXNlLCB1c2UgdGhlIHByZXZpb3VzIHBhcnNlIHRyZWVcbiAgfSBlbHNlIHtcbiAgICB0cmVlID0gbGFzdFBhcnNlLnRyZWU7XG4gICAgY29udGV4dCA9IGxhc3RQYXJzZS5jb250ZXh0O1xuICAgIHRva2VucyA9IGxhc3RQYXJzZS50b2tlbnM7XG4gIH1cbiAgLy8gTm93IGRvIHNvbWV0aGluZyB3aXRoIHRoZSBxdWVyeSBzdHJpbmdcbiAgbGV0IHdvcmRzID0gbm9ybWFsaXplUXVlcnlTdHJpbmcocXVlcnlTdHJpbmcpO1xuICBmb3IgKGxldCB3b3JkIG9mIHdvcmRzKSB7XG4gICAgLy8gRnJvbSBhIHRva2VuXG4gICAgbGV0IHRva2VuID0gZm9ybVRva2VuKHdvcmQpO1xuICAgIC8vIExpbmsgbmV3IHRva2VuIHdpdGggdGhlIHJlc3RcbiAgICBsZXQgbGFzdFRva2VuID0gdG9rZW5zW3Rva2Vucy5sZW5ndGggLSAxXTtcbiAgICBsYXN0VG9rZW4ubmV4dCA9IHRva2VuO1xuICAgIHRva2VuLnByZXYgPSBsYXN0VG9rZW47XG4gICAgdG9rZW5zLnB1c2godG9rZW4pO1xuICAgIC8vIEFkZCB0aGUgdG9rZW4gdG8gdGhlIHRyZWVcbiAgICBsZXQgbm9kZSA9IG5ld05vZGUodG9rZW4pO1xuICAgIGxldCB0cmVlUmVzdWx0ID0gZm9ybVRyZWUobm9kZSwgdHJlZSwgY29udGV4dCk7XG4gICAgdHJlZSA9IHRyZWVSZXN1bHQudHJlZTtcbiAgICBjb250ZXh0ID0gdHJlZVJlc3VsdC5jb250ZXh0O1xuICB9XG4gIC8vIE1hbmFnZSBjb250ZXh0XG4gIGNvbnRleHQuZW50aXRpZXMgPSBjb250ZXh0LmZvdW5kLmZpbHRlcigobikgPT4gbi5oYXNQcm9wZXJ0eShQcm9wZXJ0aWVzLkVOVElUWSkgJiYgIW4uaGFzUHJvcGVydHkoUHJvcGVydGllcy5TVUJTVU1FRCkgJiYgIW4uaGFzUHJvcGVydHkoUHJvcGVydGllcy5JTVBMSUNJVCkpO1xuICBjb250ZXh0LmNvbGxlY3Rpb25zID0gY29udGV4dC5mb3VuZC5maWx0ZXIoKG4pID0+IG4uaGFzUHJvcGVydHkoUHJvcGVydGllcy5DT0xMRUNUSU9OKSAmJiAhbi5oYXNQcm9wZXJ0eShQcm9wZXJ0aWVzLlNVQlNVTUVEKSAmJiAhbi5oYXNQcm9wZXJ0eShQcm9wZXJ0aWVzLklNUExJQ0lUKSk7IFxuICBjb250ZXh0LmF0dHJpYnV0ZXMgPSBjb250ZXh0LmZvdW5kLmZpbHRlcigobikgPT4gbi5oYXNQcm9wZXJ0eShQcm9wZXJ0aWVzLkFUVFJJQlVURSkgJiYgIW4uaGFzUHJvcGVydHkoUHJvcGVydGllcy5TVUJTVU1FRCkgJiYgIW4uaGFzUHJvcGVydHkoUHJvcGVydGllcy5JTVBMSUNJVCkpO1xuICBjb250ZXh0Lm1heWJlQXR0cmlidXRlcyA9IGNvbnRleHQubWF5YmVBdHRyaWJ1dGVzLmZpbHRlcigobikgPT4gIW4uaGFzUHJvcGVydHkoUHJvcGVydGllcy5TVUJTVU1FRCkgJiYgIW4uZm91bmQpO1xuICBjb250ZXh0Lm1heWJlQ29sbGVjdGlvbnMgPSBjb250ZXh0Lm1heWJlQ29sbGVjdGlvbnMuZmlsdGVyKChuKSA9PiAhbi5oYXNQcm9wZXJ0eShQcm9wZXJ0aWVzLlNVQlNVTUVEKSAmJiAhbi5mb3VuZCk7XG4gIGNvbnRleHQubWF5YmVFbnRpdGllcyA9IGNvbnRleHQubWF5YmVFbnRpdGllcy5maWx0ZXIoKG4pID0+ICFuLmhhc1Byb3BlcnR5KFByb3BlcnRpZXMuU1VCU1VNRUQpICYmICFuLmZvdW5kKTtcbiAgXG4gIC8vIE1hbmFnZSByZXN1bHRzXG4gIGxldCBpbnRlbnQgPSBJbnRlbnRzLk5PUkVTVUxUO1xuICBsZXQgcXVlcnkgPSBuZXdRdWVyeSgpO1xuICBsZXQgaW5zZXJ0UmVzdWx0cyA9IFtdO1xuICBpZiAoYWxsRm91bmQodHJlZSkpIHtcbiAgICBsZXQgaW5zZXJ0cyA9IGNvbnRleHQuaW50ZXJuYWxGeG5zLmZpbHRlcigoZikgPT4gZi5meG4udHlwZSA9PT0gRnVuY3Rpb25UeXBlcy5JTlNFUlQpO1xuICAgIGlmIChpbnNlcnRzLmxlbmd0aCA+IDApIHtcbiAgICAgIGludGVudCA9IEludGVudHMuSU5TRVJUO1xuICAgICAgLy8gRm9ybWF0IGVhY2ggaW5zZXJ0XG4gICAgICBmb3IgKGxldCBpbnNlcnQgb2YgaW5zZXJ0cykge1xuICAgICAgICBpZiAoaW5zZXJ0LmNoaWxkcmVuLmV2ZXJ5KChjKSA9PiBjLmZvdW5kKSkge1xuICAgICAgICAgIC8vIENvbGxhcHNlIHRoZSByZXN1bHQgcm9vdCBpZiBldmVyeSBub2RlIGRvZXNuJ3QgaGF2ZSBhIGNoaWxkXG4gICAgICAgICAgaWYgKGluc2VydC5jaGlsZHJlblsyXS5jaGlsZHJlbi5sZW5ndGggPiAxICYmIGluc2VydC5jaGlsZHJlblsyXS5jaGlsZHJlbi5ldmVyeSgoYykgPT4gYy5jaGlsZHJlbi5sZW5ndGggPT09IDApKSB7XG4gICAgICAgICAgICBsZXQgbk5hbWUgPSBpbnNlcnQuY2hpbGRyZW5bMl0uY2hpbGRyZW4ubWFwKChjKSA9PiBjLm5hbWUpLmpvaW4oXCIgXCIpO1xuICAgICAgICAgICAgbGV0IG5Ub2tlbiA9IG5ld1Rva2VuKG5OYW1lKTtcbiAgICAgICAgICAgIGxldCBuTm9kZSA9IG5ld05vZGUoblRva2VuKTtcbiAgICAgICAgICAgIG5Ob2RlLmZvdW5kID0gdHJ1ZTtcbiAgICAgICAgICAgIG5Ob2RlLnR5cGUgPSBOb2RlVHlwZXMuU1RSSU5HOyBcbiAgICAgICAgICAgIGluc2VydC5jaGlsZHJlblsyXS5jaGlsZHJlbi5tYXAocmVtb3ZlTm9kZSk7XG4gICAgICAgICAgICBpbnNlcnQuY2hpbGRyZW5bMl0uYWRkQ2hpbGQobk5vZGUpO1xuICAgICAgICAgIH0gICAgICAgIFxuICAgICAgICAgIGxldCBpbnNlcnRSZXN1bHQ6IEluc2VydCA9IHtcbiAgICAgICAgICAgIGVudGl0eTogaW5zZXJ0LmNoaWxkcmVuWzBdLmNoaWxkcmVuWzBdLFxuICAgICAgICAgICAgYXR0cmlidXRlOiBpbnNlcnQuY2hpbGRyZW5bMV0uY2hpbGRyZW5bMF0sXG4gICAgICAgICAgICB2YWx1ZTogaW5zZXJ0LmNoaWxkcmVuWzJdLmNoaWxkcmVuWzBdLFxuICAgICAgICAgIH1cbiAgICAgICAgICBpbnNlcnRSZXN1bHRzLnB1c2goaW5zZXJ0UmVzdWx0KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoY29udGV4dC5tYXliZUF0dHJpYnV0ZXMubGVuZ3RoID4gMCkge1xuICAgICAgaW50ZW50ID0gSW50ZW50cy5NT1JFSU5GTztcbiAgICAvLyBUaGlzIGNsYXVzZSBpcyB0byBwcm90ZWN0IGFnYWluc3QgcHJvZHVjdCBqb2luaW5nXG4gICAgfSBlbHNlIGlmIChjb250ZXh0LmZvdW5kLmxlbmd0aCA+IDEgJiYgLy8gcHJvZHVjdCBqb2lucyBvbmx5IG9jY3VyciBpbiB0aGUgY2FzZSB3aGVuIHRoZXJlIGlzIG1vcmUgdGhhbiBvbmUgdGhpbmdcbiAgICAgICAgICAgICAgICgoY29udGV4dC5hdHRyaWJ1dGVzLmZpbHRlcigoYSkgPT4gYS5hdHRyaWJ1dGUucmVmcyA9PT0gdW5kZWZpbmVkICYmICFhLnBhcmVudC5oYXNQcm9wZXJ0eShQcm9wZXJ0aWVzLkFSR1VNRU5UKSkubGVuZ3RoID4gMCkgfHxcbiAgICAgICAgICAgICAgIChjb250ZXh0LmNvbGxlY3Rpb25zLmZpbHRlcigoYykgPT4gYy5yZWxhdGlvbnNoaXBzLmxlbmd0aCA9PT0gMCkubGVuZ3RoID4gMCkpKSB7XG4gICAgICBpbnRlbnQgPSBJbnRlbnRzLk5PUkVTVUxUO1xuICAgIH0gZWxzZSB7XG4gICAgICBpbnRlbnQgPSBJbnRlbnRzLlFVRVJZO1xuICAgIH1cbiAgfVxuICBpZiAoaW50ZW50ID09PSBJbnRlbnRzLlFVRVJZKSB7XG4gICAgLy8gQ3JlYXRlIHRoZSBxdWVyeSBmcm9tIHRoZSBuZXcgdHJlZVxuICAgIGludGVudCA9IEludGVudHMuUVVFUlk7XG4gICAgbG9nKFwiQnVpbGRpbmcgcXVlcnkuLi5cIik7XG4gICAgcXVlcnkgPSBmb3JtUXVlcnkodHJlZSk7ICBcbiAgICBpZiAocXVlcnkucHJvamVjdHMubGVuZ3RoID09PSAwKSB7XG4gICAgICBpbnRlbnQgPSBJbnRlbnRzLk5PUkVTVUxUO1xuICAgICAgcXVlcnkgPSBuZXdRdWVyeSgpO1xuICAgIH1cbiAgfVxuICBcbiAgcmV0dXJuIFt7aW50ZW50OiBpbnRlbnQsIGNvbnRleHQ6IGNvbnRleHQsIHRva2VuczogdG9rZW5zLCB0cmVlOiB0cmVlLCBxdWVyeTogcXVlcnksIGluc2VydHM6IGluc2VydFJlc3VsdHN9XTtcbn1cblxuLy8gUmV0dXJucyBmYWxzZSBpZiBhbnkgbm9kZXMgYXJlIG5vdCBtYXJrZWQgZm91bmRcbi8vIFJldHVybnMgdHJ1ZSBpZiBhbGwgbm9kZXMgYXJlIG1hcmtlZCBmb3VuZFxuZnVuY3Rpb24gdHJlZUNvbXBsZXRlKG5vZGU6IE5vZGUpOiBib29sZWFuIHtcbiAgaWYgKG5vZGUuZm91bmQgPT09IGZhbHNlKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9IGVsc2Uge1xuICAgIGxldCBjaGlsZHJlblN0YXR1cyA9IG5vZGUuY2hpbGRyZW4ubWFwKHRyZWVDb21wbGV0ZSk7XG4gICAgcmV0dXJuIGNoaWxkcmVuU3RhdHVzLmV2ZXJ5KChjaGlsZCkgPT4gY2hpbGQgPT09IHRydWUpOyBcbiAgfVxufVxuXG5pbnRlcmZhY2UgV29yZCB7XG4gIGl4OiBudW1iZXI7XG4gIHRleHQ6IHN0cmluZztcbn1cblxuLy8gUGVyZm9ybXMgc29tZSB0cmFuc2Zvcm1hdGlvbnMgdG8gdGhlIHF1ZXJ5IHN0cmluZyBiZWZvcmUgdG9rZW5pemluZ1xuZXhwb3J0IGZ1bmN0aW9uIG5vcm1hbGl6ZVF1ZXJ5U3RyaW5nKHF1ZXJ5U3RyaW5nOiBzdHJpbmcpOiBBcnJheTxXb3JkPiB7XG4gIC8vIEFkZCB3aGl0ZXNwYWNlIGJlZm9yZSBhbmQgYWZ0ZXIgc2VwYXJhdG9yIGFuZCBvcGVyYXRvcnNcbiAgbGV0IG5vcm1hbGl6ZWRRdWVyeVN0cmluZyA9IHF1ZXJ5U3RyaW5nLnJlcGxhY2UoLywvZywnICwgJyk7XG4gIG5vcm1hbGl6ZWRRdWVyeVN0cmluZyA9IG5vcm1hbGl6ZWRRdWVyeVN0cmluZy5yZXBsYWNlKC87L2csJyA7ICcpO1xuICBub3JtYWxpemVkUXVlcnlTdHJpbmcgPSBub3JtYWxpemVkUXVlcnlTdHJpbmcucmVwbGFjZSgvXFwrL2csJyArICcpO1xuICBub3JtYWxpemVkUXVlcnlTdHJpbmcgPSBub3JtYWxpemVkUXVlcnlTdHJpbmcucmVwbGFjZSgvXFxeL2csJyBeICcpO1xuICBub3JtYWxpemVkUXVlcnlTdHJpbmcgPSBub3JtYWxpemVkUXVlcnlTdHJpbmcucmVwbGFjZSgvLS9nLCcgLSAnKTtcbiAgbm9ybWFsaXplZFF1ZXJ5U3RyaW5nID0gbm9ybWFsaXplZFF1ZXJ5U3RyaW5nLnJlcGxhY2UoL1xcKi9nLCcgKiAnKTtcbiAgbm9ybWFsaXplZFF1ZXJ5U3RyaW5nID0gbm9ybWFsaXplZFF1ZXJ5U3RyaW5nLnJlcGxhY2UoL1xcLy9nLCcgLyAnKTtcbiAgbm9ybWFsaXplZFF1ZXJ5U3RyaW5nID0gbm9ybWFsaXplZFF1ZXJ5U3RyaW5nLnJlcGxhY2UoL1wiL2csJyBcIiAnKTtcbiAgLy8gU3BsaXQgcG9zc2Vzc2l2ZSBlbmRpbmdzXG4gIG5vcm1hbGl6ZWRRdWVyeVN0cmluZyA9IG5vcm1hbGl6ZWRRdWVyeVN0cmluZy5yZXBsYWNlKC9cXCdzL2csJyBcXCdzICcpO1xuICBub3JtYWxpemVkUXVlcnlTdHJpbmcgPSBub3JtYWxpemVkUXVlcnlTdHJpbmcucmVwbGFjZSgvcycvZywncyBcXCcgJyk7XG4gIC8vIENsZWFuIHZhcmlvdXMgc3ltYm9scyB3ZSBkb24ndCB3YW50IHRvIGRlYWwgd2l0aFxuICBub3JtYWxpemVkUXVlcnlTdHJpbmcgPSBub3JtYWxpemVkUXVlcnlTdHJpbmcucmVwbGFjZSgvYHxcXD98XFw6fFxcW3xcXF18XFx7fFxcfXxcXCh8XFwpfFxcfnxcXGB8fnxAfCN8XFwkfCV8JnxffFxcfC9nLCcgJyk7XG4gIC8vIENvbGxhcHNlIHdoaXRlc3BhY2UgICBcbiAgbm9ybWFsaXplZFF1ZXJ5U3RyaW5nID0gbm9ybWFsaXplZFF1ZXJ5U3RyaW5nLnJlcGxhY2UoL1xccysvZywnICcpO1xuICAvLyBTcGxpdCB3b3JkcyBhdCB3aGl0ZXNwYWNlXG4gIGxldCBzcGxpdFN0cmluZ3MgPSBub3JtYWxpemVkUXVlcnlTdHJpbmcuc3BsaXQoXCIgXCIpO1xuICBsZXQgd29yZHMgPSBzcGxpdFN0cmluZ3MubWFwKCh0ZXh0LCBpKSA9PiB7cmV0dXJuIHtpeDogaSArIDEsIHRleHQ6IHRleHR9O30pO1xuICB3b3JkcyA9IHdvcmRzLmZpbHRlcigod29yZCkgPT4gd29yZC50ZXh0ICE9PSBcIlwiKTtcbiAgcmV0dXJuIHdvcmRzO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gbm9ybWFsaXplU3RyaW5nKHF1ZXJ5U3RyaW5nOiBzdHJpbmcpOiBzdHJpbmcge1xuICAvLyBBZGQgd2hpdGVzcGFjZSBiZWZvcmUgYW5kIGFmdGVyIHNlcGFyYXRvciBhbmQgb3BlcmF0b3JzXG4gIGxldCBub3JtYWxpemVkID0gcXVlcnlTdHJpbmcucmVwbGFjZSgvLC9nLCcgLCAnKTtcbiAgbm9ybWFsaXplZCA9IG5vcm1hbGl6ZWQucmVwbGFjZSgvOy9nLCcgOyAnKTtcbiAgbm9ybWFsaXplZCA9IG5vcm1hbGl6ZWQucmVwbGFjZSgvXFwrL2csJyArICcpO1xuICBub3JtYWxpemVkID0gbm9ybWFsaXplZC5yZXBsYWNlKC9cXF4vZywnIF4gJyk7XG4gIG5vcm1hbGl6ZWQgPSBub3JtYWxpemVkLnJlcGxhY2UoLy0vZywnIC0gJyk7XG4gIG5vcm1hbGl6ZWQgPSBub3JtYWxpemVkLnJlcGxhY2UoL1xcKi9nLCcgKiAnKTtcbiAgbm9ybWFsaXplZCA9IG5vcm1hbGl6ZWQucmVwbGFjZSgvXFwvL2csJyAvICcpO1xuICBub3JtYWxpemVkID0gbm9ybWFsaXplZC5yZXBsYWNlKC9cIi9nLCcgXCIgJyk7XG4gIC8vIFNwbGl0IHBvc3Nlc3NpdmUgZW5kaW5nc1xuICBub3JtYWxpemVkID0gbm9ybWFsaXplZC5yZXBsYWNlKC9cXCdzL2csJyBcXCdzICcpO1xuICBub3JtYWxpemVkID0gbm9ybWFsaXplZC5yZXBsYWNlKC9zJy9nLCdzIFxcJyAnKTtcbiAgLy8gQ2xlYW4gdmFyaW91cyBzeW1ib2xzIHdlIGRvbid0IHdhbnQgdG8gZGVhbCB3aXRoXG4gIG5vcm1hbGl6ZWQgPSBub3JtYWxpemVkLnJlcGxhY2UoL2B8XFw/fFxcOnxcXFt8XFxdfFxce3xcXH18XFwofFxcKXxcXH58XFxgfH58QHwjfFxcJHwlfCZ8X3xcXHwvZywnICcpO1xuICAvLyBDb2xsYXBzZSB3aGl0ZXNwYWNlICAgXG4gIG5vcm1hbGl6ZWQgPSBub3JtYWxpemVkLnJlcGxhY2UoL1xccysvZywnICcpOyAgXG4gIG5vcm1hbGl6ZWQgPSBub3JtYWxpemVkLnRvTG93ZXJDYXNlKCk7XG4gIG5vcm1hbGl6ZWQgPSBzaW5ndWxhcml6ZShub3JtYWxpemVkKTsgIFxuICByZXR1cm4gbm9ybWFsaXplZDtcbn1cblxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuLy8gVG9rZW4gZnVuY3Rpb25zXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbmVudW0gTWFqb3JQYXJ0c09mU3BlZWNoIHtcbiAgUk9PVCxcbiAgVkVSQixcbiAgQURKRUNUSVZFLFxuICBBRFZFUkIsXG4gIE5PVU4sXG4gIFZBTFVFLFxuICBHTFVFLFxuICBXSFdPUkQsXG4gIFNZTUJPTCxcbn1cblxuZW51bSBNaW5vclBhcnRzT2ZTcGVlY2gge1xuICBST09ULFxuICAvLyBWZXJiXG4gIFZCLCAgIC8vIHZlcmIsIGdlbmVyaWMgKGVhdClcbiAgVkJELCAgLy8gcGFzdC10ZW5zZSB2ZXJiIChhdGUpXG4gIFZCTiwgIC8vIHBhc3QtcGFydGljaXBsZSB2ZXJiIChlYXRlbilcbiAgVkJQLCAgLy8gaW5maW5pdGl2ZSB2ZXJiIChlYXQpXG4gIFZCWiwgIC8vIHByZXNudC10ZW5zZSB2ZXJiIChlYXRzKVxuICBWQkYsICAvLyBmdXR1cmUtdGVuc2UgdmVyYiAoZWF0KVxuICBDUCwgICAvLyBjb3B1bGEgKGlzLCB3YXMsIHdlcmUpXG4gIFZCRywgIC8vIGdlcnVuZCB2ZXJiIChlYXRpbmcpXG4gIC8vIEFkamVjdGl2ZVxuICBKSiwgICAvLyBhZGplY3RpdmUsIGdlbmVyaWMgKGJpZylcbiAgSkpSLCAgLy8gY29tcGFyYXRpdmUgYWRqZWN0aXZlIChiaWdnZXIpXG4gIEpKUywgIC8vIHN1cGVybGF0aXZlIGFkamVjdGl2ZSAoYmlnZ2VzdClcbiAgLy8gQWR2ZXJiXG4gIFJCLCAgIC8vIGFkdmVyYiwgZ2VuZXJpYyAocXVpY2tseSlcbiAgUkJSLCAgLy8gY29tcGFyYXRpdmUgYWR2ZXJiIChjb29sZXIpXG4gIFJCUywgIC8vIHN1cGVybGF0aXZlIGFkdmVyYiAoY29vbGVzdCAobG9va2luZykpXG4gIC8vIE5vdW5cbiAgTk4sICAgLy8gbm91biwgc2luZ3VsYXIgKGRvZykgXG4gIE5OUEEsIC8vIGFjcm9ueW0gKEZCSSlcbiAgTk5BQiwgLy8gYWJicmV2aWF0aW9uIChqci4pXG4gIE5HLCAgIC8vIGdlcnVuZCBub3VuIChlYXRpbmcsIHdpbm5pbmcsIGJ1dCB1c2VkIGFzIGEgbm91bilcbiAgUFJQLCAgLy8gcGVyc29uYWwgcHJvbm91biAoSSwgeW91LCBzaGUpXG4gIFBQLCAgIC8vIHBvc3Nlc3NpdmUgcHJvbm91biAobXksIG9uZSdzKVxuICAvLyBMZWdhY3kgTm91blxuICBOTlAsICAvLyBTaW5ndWxhciBwcm9wZXIgbm91biAoU21pdGgpXG4gIE5OUFMsIC8vIFBsdXJhbCBwcm9wZXIgbm91biAoU21pdGhzKVxuICBOTk8sICAvLyBQb3NzZXNzaXZlIG5vdW4gKHBlb3BsZSdzKVxuICBOTlMsICAvLyBQbHVyYWwgbm91biAocGVvcGxlKVxuICBOTkEsICAvLyBAVE9ETyBmaWd1cmUgb3V0IHdoYXQgTk5BIGlzLlxuICBOTlEsICAvLyBRdW90ZWQgdGV4dFxuICAvLyBHbHVlXG4gIEZXLCAgIC8vIGZvcmVpZ24gd29yZCAodm9pbGEpIFxuICBJTiwgICAvLyBwcmVwb3NpdGlvbiAob2YsIGluLCBieSlcbiAgTUQsICAgLy8gbW9kYWwgdmVyYiAoY2FuLCBzaG91bGQpXG4gIENDLCAgIC8vIGNvb3JkaW5hdGluZyBjb25qdW5jdGlvbiAoYW5kLCBidXQsIG9yKVxuICBQRFQsICAvLyBwcmVkZXRlcm1pbmVyIChzb21lLCBhbGwsIGFueSlcbiAgRFQsICAgLy8gZGV0ZXJtaW5lciAodGhlKVxuICBVSCwgICAvLyBpbnRlcmplY3Rpb24gKG9oLCBvb3BzKVxuICBFWCwgICAvLyBleGlzdGVudGlhbCB0aGVyZSAodGhlcmUpXG4gIC8vIFZhbHVlXG4gIENELCAgIC8vIGNhcmRpbmFsIHZhbHVlIChvbmUsIHR3bywgZmlyc3QpXG4gIERBLCAgIC8vIGRhdGUgKGp1bmUgNXRoIDE5OTgpXG4gIE5VLCAgIC8vIG51bWJlciAoMTAwLCBvbmUgaHVuZHJlZClcbiAgLy8gU3ltYm9sXG4gIExULCAgIC8vIFN5bWJvbCAoPClcbiAgR1QsICAgLy8gU3ltYm9sICg+KVxuICBHVEUsICAvLyBTeW1ib2wgKD49KVxuICBMVEUsICAvLyBTeW1ib2wgKDw9KVxuICBFUSwgICAvLyBTeW1ib2wgKD0pXG4gIE5FUSwgIC8vIFN5bWJvbCAoIT0pXG4gIFBMVVMsIC8vIFN5bWJvbCAoKylcbiAgTUlOVVMsLy8gU3ltYm9sICgtKVxuICBESVYsICAvLyBTeW1ib2wgKC8pXG4gIE1VTCwgIC8vIFN5bWJvbCAoKilcbiAgUE9XLCAgLy8gU3ltYm9sICheKVxuICBTRVAsICAvLyBTZXBhcmF0b3IgKCwgOyA6IFwiKVxuICBQT1MsICAvLyBQb3NzZXNzaXZlIGVuZGluZyAoJ3MpXG4gIC8vIFdoLSB3b3JkXG4gIFdEVCwgIC8vIFdoLWRldGVybWluZXIgKHRoYXQgd2hhdCB3aGF0ZXZlciB3aGljaCB3aGljaGV2ZXIpXG4gIFdQLCAgIC8vIFdoLXByb25vdW4gKHRoYXQgd2hhdCB3aGF0ZXZlciB3aGljaCB3aG8gd2hvbSlcbiAgV1BPLCAgLy8gV2gtcHJvbm91biBwb3NzZXNzaXZlICh3aG9zZSlcbiAgV1JCICAgLy8gV2gtYWR2ZXJiIChob3dldmVyIHdoZW5ldmVyIHdoZXJlIHdoeSlcbn1cblxuaW50ZXJmYWNlIFRva2VuIHtcbiAgaXg6IG51bWJlcixcbiAgc3RhcnQ/OiBudW1iZXIsXG4gIGVuZD86IG51bWJlcixcbiAgb3JpZ2luYWxXb3JkOiBzdHJpbmcsXG4gIG5vcm1hbGl6ZWRXb3JkOiBzdHJpbmcsXG4gIFBPUzogTWlub3JQYXJ0c09mU3BlZWNoLFxuICBwcm9wZXJ0aWVzOiBBcnJheTxQcm9wZXJ0aWVzPixcbiAgbm9kZT86IE5vZGUsXG4gIHByZXY/OiBUb2tlbixcbiAgbmV4dD86IFRva2VuLFxufVxuXG5mdW5jdGlvbiBuZXdUb2tlbih0ZXh0OiBzdHJpbmcpOiBUb2tlbiB7XG4gIGxldCB0b2tlbiA9IGZvcm1Ub2tlbih7aXg6IDAsIHRleHQ6IHRleHR9KTtcbiAgdG9rZW4ucHJvcGVydGllcy5wdXNoKFByb3BlcnRpZXMuSU1QTElDSVQpO1xuICByZXR1cm4gdG9rZW47XG59XG5cbmZ1bmN0aW9uIGNsb25lVG9rZW4odG9rZW46IFRva2VuKTogVG9rZW4ge1xuICBsZXQgY2xvbmU6IFRva2VuID0ge1xuICAgIGl4OiB0b2tlbi5peCxcbiAgICBvcmlnaW5hbFdvcmQ6IHRva2VuLm9yaWdpbmFsV29yZCxcbiAgICBub3JtYWxpemVkV29yZDogdG9rZW4ubm9ybWFsaXplZFdvcmQsXG4gICAgUE9TOiB0b2tlbi5QT1MsXG4gICAgcHJvcGVydGllczogW10sXG4gIH07XG4gIHRva2VuLnByb3BlcnRpZXMubWFwKChwcm9wZXJ0eSkgPT4gY2xvbmUucHJvcGVydGllcy5wdXNoKHByb3BlcnR5KSk7XG4gIHJldHVybiBjbG9uZTtcbn1cblxuZW51bSBQcm9wZXJ0aWVzIHtcbiAgLy8gTm9kZSBwcm9wZXJ0aWVzXG4gIFJPT1QsXG4gIC8vIEVWRSB0eXBlc1xuICBDT0xMRUNUSU9OLFxuICBFTlRJVFksXG4gIEFUVFJJQlVURSxcbiAgRlVOQ1RJT04sXG4gIFFVQU5USVRZLFxuICBTVFJJTkcsXG4gIC8vIEZ1bmN0aW9uIHByb3BlcnRpZXMgIFxuICBPVVRQVVQsXG4gIElOUFVULFxuICBBUkdVTUVOVCxcbiAgQUdHUkVHQVRFLFxuICBDQUxDVUxBVEUsXG4gIE9QRVJBVE9SLFxuICAvLyBUb2tlbiBwcm9wZXJ0aWVzXG4gIFBST1BFUixcbiAgUExVUkFMLFxuICBQT1NTRVNTSVZFLFxuICBCQUNLUkVMQVRJT05TSElQLFxuICBDT01QQVJBVElWRSxcbiAgU1VQRVJMQVRJVkUsXG4gIFBST05PVU4sICBcbiAgU0VQQVJBVE9SLFxuICBDT05KVU5DVElPTixcbiAgUVVPVEVELFxuICBTRVRURVIsXG4gIFNVQlNVTUVELFxuICBDT01QT1VORCxcbiAgLy8gTW9kaWZpZXJzXG4gIE5FR0FURVMsXG4gIEdST1VQSU5HLFxuICBJTVBMSUNJVCxcbiAgU1RPUFBBUlNFLFxufVxuXG4vLyB0YWtlIGFuIGlucHV0IHN0cmluZywgZXh0cmFjdCB0b2tlbnNcbmZ1bmN0aW9uIGZvcm1Ub2tlbih3b3JkOiBXb3JkKTogVG9rZW4ge1xuICAvLyBFdmVyeSB3b3JkIGlzIHRhZ2dlZCBhIG5vdW4gdW5sZXNzIHNvbWUgcnVsZSBzYXlzIG90aGVyd2lzZVxuICBsZXQgUE9TOiBNaW5vclBhcnRzT2ZTcGVlY2ggPSBNaW5vclBhcnRzT2ZTcGVlY2guTk47XG4gIGxldCBwcm9wZXJ0aWVzOiBBcnJheTxQcm9wZXJ0aWVzPiA9IFtdO1xuICBsZXQgb3JpZ2luYWxXb3JkID0gd29yZC50ZXh0O1xuICBsZXQgbm9ybWFsaXplZFdvcmQgPSBvcmlnaW5hbFdvcmQ7XG4gIGxldCBmb3VuZCA9IGZhbHNlO1xuICBcbiAgbGV0IHVwcGVyQ2FzZUxldHRlcnMgPSBbJ0EnLCdCJywnQycsJ0QnLCdFJywnRicsJ0cnLCdIJywnSScsJ0onLCdLJywnTCcsJ00nLCdOJywnTycsJ1AnLCdRJywnUicsJ1MnLCdUJywnVScsJ1YnLCdXJywnWCcsJ1knLCdaJ107XG4gIGxldCBsb3dlckNhc2VMZXR0ZXJzID0gWydhJywnYicsJ2MnLCdkJywnZScsJ2YnLCdnJywnaCcsJ2knLCdqJywnaycsJ2wnLCdtJywnbicsJ28nLCdwJywncScsJ3InLCdzJywndCcsJ3UnLCd2JywndycsJ3gnLCd5JywneiddO1xuICBsZXQgZGlnaXRzID0gWycxJywnMicsJzMnLCc0JywnNScsJzYnLCc3JywnOCcsJzknLCcwJ107XG4gIGxldCBzZXBhcmF0b3JzID0gWycsJywnOicsJzsnLCdcIiddO1xuICBsZXQgb3BlcmF0b3JzID0gWycrJywnLScsJyonLCcvJywnXiddO1xuICBsZXQgY29tcGFyYXRvcnMgPSBbJz4nLCc+PScsJzwnLCc8PScsJz0nLCchPSddO1xuICBcbiAgLy8gTW9zdCBvZiB0aGUgZm9sbG93aW5nIHZlY3RvcnMgd2VyZSB0YWtlbiBmcm9tIE5MUCBDb21wcm9taXNlXG4gIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9ubHAtY29tcHJvbWlzZS9ubHBfY29tcHJvbWlzZVxuICAvLyBDb3B5cmlnaHQgKGMpIDIwMTYgU3BlbmNlciBLZWxseTogXG4gIC8vIExpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgTGljZW5zZTogaHR0cHM6Ly9naXRodWIuY29tL25scC1jb21wcm9taXNlL25scF9jb21wcm9taXNlL2Jsb2IvbWFzdGVyL0xJQ0VOU0UudHh0XG4gIGxldCBwcmVEZXRlcm1pbmVycyA9IFsnYWxsJ107XG4gIGxldCBkZXRlcm1pbmVycyA9IFsndGhpcycsICdhbnknLCAnZW5vdWdoJywgJ2VhY2gnLCAnZXZlcnknLCAndGhlc2UnLCAnYW5vdGhlcicsICdwbGVudHknLCAnd2hpY2hldmVyJywgJ25laXRoZXInLCAnYW4nLCAnYScsICdsZWFzdCcsICdvd24nLCAnZmV3JywgJ2JvdGgnLCAndGhvc2UnLCAndGhlJywgJ3RoYXQnLCAndmFyaW91cycsICd3aGF0JywgJ2VpdGhlcicsICdtdWNoJywgJ3NvbWUnLCAnZWxzZScsICdubyddO1xuICBsZXQgY29wdWxhZSA9IFsnYW0nLCAnaXMnLCAnYXJlJywgJ3dhcycsICd3ZXJlJywgJ2FzJywgJ2FtJywgJ2JlJywgJ2hhcycsICdiZWNvbWUnLCAnYmVjYW1lJywgJ3NlZW1lZCcsICdzZWVtcycsICdzZWVtaW5nJ107XG4gIGxldCBjb25qdW5jdGlvbnMgPSBbJ3lldCcsICd0aGVyZWZvcmUnLCAnb3InLCAnd2hpbGUnLCAnbm9yJywgJ3doZXRoZXInLCAndGhvdWdoJywgJ2JlY2F1c2UnLCAnYnV0JywgJ2ZvcicsICdhbmQnLCAnaWYnLCAnYmVmb3JlJywgJ2FsdGhvdWdoJywgJ3BsdXMnLCAndmVyc3VzJywgJ25vdCddO1xuICBsZXQgcHJlcG9zaXRpb25zID0gWyd3aXRoJywgJ3VudGlsJywgJ29udG8nLCAnb2YnLCAnaW50bycsICdvdXQnLCAnZXhjZXB0JywgJ2Fjcm9zcycsICdieScsICdiZXR3ZWVuJywgJ2F0JywgJ2Rvd24nLCAnYXMnLCAnZnJvbScsICdhcm91bmQnLCAnYW1vbmcnLCAndXBvbicsICdhbWlkJywgJ3RvJywgJ2Fsb25nJywgJ3NpbmNlJywgJ2Fib3V0JywgJ29mZicsICdvbicsICd3aXRoaW4nLCAnaW4nLCAnZHVyaW5nJywgJ3BlcicsICd3aXRob3V0JywgJ3Rocm91Z2hvdXQnLCAndGhyb3VnaCcsICd0aGFuJywgJ3ZpYScsICd1cCcsICd1bmxpa2UnLCAnZGVzcGl0ZScsICdiZWxvdycsICd1bmxlc3MnLCAndG93YXJkcycsICdiZXNpZGVzJywgJ2FmdGVyJywgJ3doZXJlYXMnLCdhbW9uZ3N0JywgJ2F0b3AnLCAnYmFycmluZycsICdjaXJjYScsICdtaWQnLCAnbWlkc3QnLCAnbm90d2l0aHN0YW5kaW5nJywgJ3NhbnMnLCAndGhydScsICd0aWxsJywgJ3ZlcnN1cyddO1xuICBsZXQgcG9zc2Vzc2l2ZVByb25vdW5zID0gWydtaW5lJywgJ3NvbWV0aGluZycsICdub25lJywgJ2FueXRoaW5nJywgJ2FueW9uZScsICd0aGVpcnMnLCAnaGltc2VsZicsICdvdXJzJywgJ2hpcycsICdteScsICd0aGVpcicsICd5b3VycycsICd5b3VyJywgJ291cicsICdpdHMnLCAnbm90aGluZycsICdoZXJzZWxmJywgJ2hlcnMnLCAndGhlbXNlbHZlcycsICdldmVyeXRoaW5nJywgJ215c2VsZicsICdpdHNlbGYnLCAnaGVyJ107XG4gIGxldCBwZXJzb25hbFByb25vdW5zID0gWydpdCcsICd0aGV5JywgJ2knLCAndGhlbScsICd5b3UnLCAnc2hlJywgJ21lJywgJ2hlJywgJ2hpbScsICdvdXJzZWx2ZXMnLCAndXMnLCAnd2UnLCAneW91cnNlbGYnXTtcbiAgbGV0IG1vZGFscyA9IFsnY2FuJywgJ21heScsICdjb3VsZCcsICdtaWdodCcsICd3aWxsJywgJ3dvdWxkJywgJ211c3QnLCAnc2hhbGwnLCAnc2hvdWxkJywgJ291Z2h0J107XG4gIGxldCB3aFByb25vdW5zID0gWyd3aG8nLCAnd2hhdCcsICd3aG9tJ107XG4gIGxldCB3aERldGVybWluZXJzID0gWyd3aGF0ZXZlcicsICd3aGljaCddO1xuICBsZXQgd2hQb3NzZXNzaXZlUHJvbm91biA9IFsnd2hvc2UnXTtcbiAgbGV0IHdoQWR2ZXJicyA9IFsnaG93JywgJ3doZW4nLCAnaG93ZXZlcicsICd3aGVuZXZlcicsICd3aGVyZScsICd3aHknXTsgICBcbiAgbGV0IHZlcmJzID0gWydoYXZlJywgJ2RvJ107XG4gIGxldCBhZHZlcmJzID0gWyd0aGVyZSddO1xuXG4gIC8vIFdlIGhhdmUgdGhyZWUgY2FzZXM6IHRoZSB3b3JkIGlzIGEgc3ltYm9sIChvZiB3aGljaCB0aGVyZSBhcmUgdmFyaW91cyBraW5kcyksIGEgbnVtYmVyLCBvciBhIHN0cmluZ1xuICBcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvLyBDYXNlIDE6IGhhbmRsZSBzeW1ib2xzXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgaWYgKCFmb3VuZCkge1xuICAgIGlmIChvcGVyYXRvcnMuaW5kZXhPZihvcmlnaW5hbFdvcmQpID49IDApIHtcbiAgICAgIGZvdW5kID0gdHJ1ZTtcbiAgICAgIHByb3BlcnRpZXMucHVzaChQcm9wZXJ0aWVzLk9QRVJBVE9SKTtcbiAgICAgIHN3aXRjaCAob3JpZ2luYWxXb3JkKSB7XG4gICAgICAgIGNhc2UgXCIrXCI6XG4gICAgICAgICAgUE9TID0gTWlub3JQYXJ0c09mU3BlZWNoLlBMVVM7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCItXCI6XG4gICAgICAgICAgUE9TID0gTWlub3JQYXJ0c09mU3BlZWNoLk1JTlVTO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwiKlwiOlxuICAgICAgICAgIFBPUyA9IE1pbm9yUGFydHNPZlNwZWVjaC5NVUw7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCIvXCI6XG4gICAgICAgICAgUE9TID0gTWlub3JQYXJ0c09mU3BlZWNoLkRJVjtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcIl5cIjpcbiAgICAgICAgICBQT1MgPSBNaW5vclBhcnRzT2ZTcGVlY2guUE9XO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoY29tcGFyYXRvcnMuaW5kZXhPZihvcmlnaW5hbFdvcmQpID49IDApIHtcbiAgICAgIGZvdW5kID0gdHJ1ZTtcbiAgICAgIHByb3BlcnRpZXMucHVzaChQcm9wZXJ0aWVzLkNPTVBBUkFUSVZFKTtcbiAgICAgIHN3aXRjaCAob3JpZ2luYWxXb3JkKSB7XG4gICAgICAgIGNhc2UgXCI+XCI6XG4gICAgICAgICAgUE9TID0gTWlub3JQYXJ0c09mU3BlZWNoLkdUO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwiPj1cIjpcbiAgICAgICAgICBQT1MgPSBNaW5vclBhcnRzT2ZTcGVlY2guR1RFO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwiPFwiOlxuICAgICAgICAgIFBPUyA9IE1pbm9yUGFydHNPZlNwZWVjaC5MVDtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcIjw9XCI6XG4gICAgICAgICAgUE9TID0gTWlub3JQYXJ0c09mU3BlZWNoLkxURTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcIj1cIjpcbiAgICAgICAgICBQT1MgPSBNaW5vclBhcnRzT2ZTcGVlY2guRVE7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCIhPVwiOlxuICAgICAgICAgIFBPUyA9IE1pbm9yUGFydHNPZlNwZWVjaC5ORVE7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChzZXBhcmF0b3JzLmluZGV4T2Yob3JpZ2luYWxXb3JkKSA+PSAwKSB7XG4gICAgICBmb3VuZCA9IHRydWU7XG4gICAgICBwcm9wZXJ0aWVzLnB1c2goUHJvcGVydGllcy5TRVBBUkFUT1IpO1xuICAgICAgUE9TID0gTWlub3JQYXJ0c09mU3BlZWNoLlNFUDtcbiAgICAgIGlmIChvcmlnaW5hbFdvcmQgPT09IGBcImApIHtcbiAgICAgICAgcHJvcGVydGllcy5wdXNoKFByb3BlcnRpZXMuUVVPVEVEKTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKG9yaWdpbmFsV29yZCA9PT0gXCInc1wiIHx8IG9yaWdpbmFsV29yZCA9PT0gXCInXCIpIHtcbiAgICAgIHByb3BlcnRpZXMucHVzaChQcm9wZXJ0aWVzLlBPU1NFU1NJVkUpOyAgXG4gICAgICBQT1MgPSBNaW5vclBhcnRzT2ZTcGVlY2guUE9TOyAgICBcbiAgICB9XG4gIH1cbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvLyBDYXNlIDI6IGhhbmRsZSBudW1iZXJzXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgaWYgKCFmb3VuZCkge1xuICAgIGlmIChkaWdpdHMuaW5kZXhPZihvcmlnaW5hbFdvcmRbMF0pID49IDAgJiYgaXNOdW1lcmljKG9yaWdpbmFsV29yZCkpIHtcbiAgICAgIGZvdW5kID0gdHJ1ZTtcbiAgICAgIHByb3BlcnRpZXMucHVzaChQcm9wZXJ0aWVzLlFVQU5USVRZKTtcbiAgICAgIFBPUyA9IE1pbm9yUGFydHNPZlNwZWVjaC5OVTtcbiAgICB9XG4gIH1cbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvLyBDYXNlIDM6IGhhbmRsZSBzdHJpbmdzXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgaWYgKCFmb3VuZCkge1xuICAgIC8vIE5vcm1hbGl6ZSB0aGUgd29yZFxuICAgIG5vcm1hbGl6ZWRXb3JkID0gbm9ybWFsaXplZFdvcmQudG9Mb3dlckNhc2UoKTtcbiAgICBsZXQgYmVmb3JlID0gbm9ybWFsaXplZFdvcmQ7XG4gICAgbm9ybWFsaXplZFdvcmQgPSBzaW5ndWxhcml6ZShub3JtYWxpemVkV29yZCk7XG4gICAgaWYgKGJlZm9yZSAhPT0gbm9ybWFsaXplZFdvcmQpIHtcbiAgICAgIHByb3BlcnRpZXMucHVzaChQcm9wZXJ0aWVzLlBMVVJBTCk7XG4gICAgfVxuICAgIC8vIEZpbmQgdGhlIFBPUyBpbiB0aGUgZGljdGlvbmFyeSwgYXBwbHkgc29tZSBwcm9wZXJ0aWVzIGJhc2VkIG9uIHRoZSB3b3JkXG4gICAgLy8gRGV0ZXJtaW5lcnNcbiAgICBpZiAoZGV0ZXJtaW5lcnMuaW5kZXhPZihub3JtYWxpemVkV29yZCkgPj0gMCkge1xuICAgICAgUE9TID0gTWlub3JQYXJ0c09mU3BlZWNoLkRUO1xuICAgIC8vIE1vZGFsc1xuICAgIH0gZWxzZSBpZiAobW9kYWxzLmluZGV4T2Yobm9ybWFsaXplZFdvcmQpID49IDApIHtcbiAgICAgIFBPUyA9IE1pbm9yUGFydHNPZlNwZWVjaC5NRDtcbiAgICAvLyBQcmVkZXRlcm1pbmVyc1xuICAgIH0gZWxzZSBpZiAocHJlRGV0ZXJtaW5lcnMuaW5kZXhPZihub3JtYWxpemVkV29yZCkgPj0gMCkge1xuICAgICAgUE9TID0gTWlub3JQYXJ0c09mU3BlZWNoLlBEVDtcbiAgICAvLyBDb3B1bGFlXG4gICAgfSBlbHNlIGlmIChjb3B1bGFlLmluZGV4T2Yobm9ybWFsaXplZFdvcmQpID49IDApIHtcbiAgICAgIFBPUyA9IE1pbm9yUGFydHNPZlNwZWVjaC5DUDtcbiAgICAvLyBQcmVwb3NpdGlvbnNcbiAgICB9IGVsc2UgaWYgKHByZXBvc2l0aW9ucy5pbmRleE9mKG5vcm1hbGl6ZWRXb3JkKSA+PSAwKSB7XG4gICAgICBQT1MgPSBNaW5vclBhcnRzT2ZTcGVlY2guSU47XG4gICAgLy8gUGVyc29uYWwgcHJvbm91bnNcbiAgICB9IGVsc2UgaWYgKHBlcnNvbmFsUHJvbm91bnMuaW5kZXhPZihub3JtYWxpemVkV29yZCkgPj0gMCkge1xuICAgICAgUE9TID0gTWlub3JQYXJ0c09mU3BlZWNoLlBSUDsgXG4gICAgICBwcm9wZXJ0aWVzLnB1c2goUHJvcGVydGllcy5QUk9OT1VOKTtcbiAgICAvLyBQb3NzZXNzaXZlIHByb25vdW5zXG4gICAgfSBlbHNlIGlmIChwb3NzZXNzaXZlUHJvbm91bnMuaW5kZXhPZihub3JtYWxpemVkV29yZCkgPj0gMCkge1xuICAgICAgUE9TID0gTWlub3JQYXJ0c09mU3BlZWNoLlBSUDsgXG4gICAgICBwcm9wZXJ0aWVzLnB1c2goUHJvcGVydGllcy5QUk9OT1VOKTtcbiAgICAgIHByb3BlcnRpZXMucHVzaChQcm9wZXJ0aWVzLlBPU1NFU1NJVkUpO1xuICAgIC8vIENvbmp1bmN0aW9uc1xuICAgIH0gZWxzZSBpZiAoY29uanVuY3Rpb25zLmluZGV4T2Yobm9ybWFsaXplZFdvcmQpID49IDApIHtcbiAgICAgIFBPUyA9IE1pbm9yUGFydHNPZlNwZWVjaC5DQzsgXG4gICAgICBwcm9wZXJ0aWVzLnB1c2goUHJvcGVydGllcy5DT05KVU5DVElPTik7XG4gICAgLy8gV2gtd29yZHNcbiAgICB9IGVsc2UgaWYgKHdoUHJvbm91bnMuaW5kZXhPZihub3JtYWxpemVkV29yZCkgPj0gMCkge1xuICAgICAgUE9TID0gTWlub3JQYXJ0c09mU3BlZWNoLldQOyBcbiAgICB9IGVsc2UgaWYgKHdoRGV0ZXJtaW5lcnMuaW5kZXhPZihub3JtYWxpemVkV29yZCkgPj0gMCkge1xuICAgICAgUE9TID0gTWlub3JQYXJ0c09mU3BlZWNoLldEVDsgXG4gICAgfSBlbHNlIGlmICh3aEFkdmVyYnMuaW5kZXhPZihub3JtYWxpemVkV29yZCkgPj0gMCkge1xuICAgICAgUE9TID0gTWlub3JQYXJ0c09mU3BlZWNoLldSQjsgXG4gICAgfSBlbHNlIGlmICh3aFBvc3Nlc3NpdmVQcm9ub3VuLmluZGV4T2Yobm9ybWFsaXplZFdvcmQpID49IDApIHtcbiAgICAgIFBPUyA9IE1pbm9yUGFydHNPZlNwZWVjaC5XUE87XG4gICAgICBwcm9wZXJ0aWVzLnB1c2goUHJvcGVydGllcy5QT1NTRVNTSVZFKVxuICAgIC8vIFZlcmJzIFxuICAgIH0gZWxzZSBpZiAodmVyYnMuaW5kZXhPZihub3JtYWxpemVkV29yZCkgPj0gMCkge1xuICAgICAgUE9TID0gTWlub3JQYXJ0c09mU3BlZWNoLlZCO1xuICAgIC8vIEFkdmVyYnMgXG4gICAgfSBlbHNlIGlmIChhZHZlcmJzLmluZGV4T2Yobm9ybWFsaXplZFdvcmQpID49IDApIHtcbiAgICAgIFBPUyA9IE1pbm9yUGFydHNPZlNwZWVjaC5SQjtcbiAgICB9XG4gICAgXG4gICAgLy8gU2V0IGdyb3VwaW5nIHByb3BlcnR5XG4gICAgbGV0IGdyb3VwaW5nV29yZHMgPSBbJ3BlcicsICdieSddO1xuICAgIGxldCBuZWdhdGluZ1dvcmRzID0gWydleGNlcHQnLCAnd2l0aG91dCcsICdzYW5zJywgJ25vdCcsICdub3InLCAnbmVpdGhlcicsICdubyddO1xuICAgIGxldCBwbHVyYWxXb3JkcyA9IFsndGhlaXInXTtcbiAgICBpZiAoZ3JvdXBpbmdXb3Jkcy5pbmRleE9mKG5vcm1hbGl6ZWRXb3JkKSA+PSAwKSB7XG4gICAgICBwcm9wZXJ0aWVzLnB1c2goUHJvcGVydGllcy5HUk9VUElORyk7XG4gICAgLy8gU2V0IG5lZ2F0ZSBwcm9wZXJ0eSAgICAgICAgXG4gICAgfSBlbHNlIGlmIChuZWdhdGluZ1dvcmRzLmluZGV4T2Yobm9ybWFsaXplZFdvcmQpID49IDApIHtcbiAgICAgIHByb3BlcnRpZXMucHVzaChQcm9wZXJ0aWVzLk5FR0FURVMpO1xuICAgIC8vIFNldCBwbHVyYWwgcHJvcGVydHlcbiAgICB9IGVsc2UgaWYgKHBsdXJhbFdvcmRzLmluZGV4T2Yobm9ybWFsaXplZFdvcmQpID49IDApIHtcbiAgICAgIHByb3BlcnRpZXMucHVzaChQcm9wZXJ0aWVzLlBMVVJBTCk7XG4gICAgfVxuICAgIC8vIElmIHRoZSB3b3JkIGlzIHN0aWxsIGEgbm91biwgaWYgaXQgaXMgdXBwZXIgY2FzZSB0aGFuIGl0IGlzIGEgcHJvcGVyIG5vdW4gXG4gICAgaWYgKGdldE1ham9yUE9TKFBPUykgPT09IE1ham9yUGFydHNPZlNwZWVjaC5OT1VOKSB7XG4gICAgICBpZiAodXBwZXJDYXNlTGV0dGVycy5pbmRleE9mKG9yaWdpbmFsV29yZFswXSkgPj0gMCkge1xuICAgICAgICBwcm9wZXJ0aWVzLnB1c2goUHJvcGVydGllcy5QUk9QRVIpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICAvLyBCdWlsZCB0aGUgdG9rZW5cbiAgbGV0IHRva2VuOiBUb2tlbiA9IHtcbiAgICBpeDogd29yZC5peCwgXG4gICAgb3JpZ2luYWxXb3JkOiB3b3JkLnRleHQsIFxuICAgIG5vcm1hbGl6ZWRXb3JkOiBub3JtYWxpemVkV29yZCxcbiAgICBQT1M6IFBPUyxcbiAgICBwcm9wZXJ0aWVzOiBwcm9wZXJ0aWVzLFxuICB9O1xuICByZXR1cm4gdG9rZW47XG59XG5cbmZ1bmN0aW9uIGdldE1ham9yUE9TKG1pbm9yUGFydE9mU3BlZWNoOiBNaW5vclBhcnRzT2ZTcGVlY2gpOiBNYWpvclBhcnRzT2ZTcGVlY2gge1xuICAvLyBST09UXG4gIGlmIChtaW5vclBhcnRPZlNwZWVjaCA9PT0gTWlub3JQYXJ0c09mU3BlZWNoLlJPT1QpIHtcbiAgICByZXR1cm4gTWFqb3JQYXJ0c09mU3BlZWNoLlJPT1Q7XG4gIH1cbiAgLy8gVmVyYlxuICBsZXQgdmVyYnMgPSBbJ1ZCJywnVkJEJywnVkJOJywnVkJQJywnVkJaJywnVkJGJywnVkJHJ107XG4gIGlmICh2ZXJicy5pbmRleE9mKE1pbm9yUGFydHNPZlNwZWVjaFttaW5vclBhcnRPZlNwZWVjaF0pID49IDApIHtcbiAgICAgICAgcmV0dXJuIE1ham9yUGFydHNPZlNwZWVjaC5WRVJCO1xuICB9XG4gIC8vIEFkamVjdGl2ZVxuICBsZXQgYWRqZWN0aXZlcyA9IFsnSkonLCdKSlInLCdKSlMnXTtcbiAgaWYgKGFkamVjdGl2ZXMuaW5kZXhPZihNaW5vclBhcnRzT2ZTcGVlY2hbbWlub3JQYXJ0T2ZTcGVlY2hdKSA+PSAwKSB7XG4gICAgICAgIHJldHVybiBNYWpvclBhcnRzT2ZTcGVlY2guQURKRUNUSVZFO1xuICB9XG4gIC8vIEFkdmVyYlxuICBsZXQgYWR2ZXJicyA9IFsnUkInLCdSQlInLCdSQlMnXTtcbiAgaWYgKGFkdmVyYnMuaW5kZXhPZihNaW5vclBhcnRzT2ZTcGVlY2hbbWlub3JQYXJ0T2ZTcGVlY2hdKSA+PSAwKSB7XG4gICAgICAgIHJldHVybiBNYWpvclBhcnRzT2ZTcGVlY2guQURWRVJCO1xuICB9XG4gIC8vIE5vdW5cbiAgbGV0IG5vdW5zID0gWydOTicsJ05OQScsJ05OUEEnLCdOTkFCJywnTk5QJywnTk5QUycsJ05OUycsJ05OUScsJ05OTycsJ05HJywnUFJQJywnUFAnXTtcbiAgaWYgKG5vdW5zLmluZGV4T2YoTWlub3JQYXJ0c09mU3BlZWNoW21pbm9yUGFydE9mU3BlZWNoXSkgPj0gMCkge1xuICAgIHJldHVybiBNYWpvclBhcnRzT2ZTcGVlY2guTk9VTjtcbiAgfVxuICAvLyBWYWx1ZVxuICBsZXQgdmFsdWVzID0gWydDRCcsJ0RBJywnTlUnXTtcbiAgaWYgKHZhbHVlcy5pbmRleE9mKE1pbm9yUGFydHNPZlNwZWVjaFttaW5vclBhcnRPZlNwZWVjaF0pID49IDApIHtcbiAgICByZXR1cm4gTWFqb3JQYXJ0c09mU3BlZWNoLlZBTFVFO1xuICB9XG4gIC8vIEdsdWVcbiAgbGV0IGdsdWVzID0gWydGVycsJ0lOJywnQ1AnLCdNRCcsJ0NDJywnUERUJywnRFQnLCdVSCcsJ0VYJ107XG4gIGlmIChnbHVlcy5pbmRleE9mKE1pbm9yUGFydHNPZlNwZWVjaFttaW5vclBhcnRPZlNwZWVjaF0pID49IDApIHtcbiAgICByZXR1cm4gTWFqb3JQYXJ0c09mU3BlZWNoLkdMVUU7XG4gIH0gIFxuICAvLyBTeW1ib2xcbiAgbGV0IHN5bWJvbHMgPSBbJ0xUJywnR1QnLCdMVEUnLCdHVEUnLCdFUScsJ05FUScsXG4gICAgICAgICAgICAgICAgICdQTFVTJywnTUlOVVMnLCdESVYnLCdNVUwnLCdQT1cnLFxuICAgICAgICAgICAgICAgICAnU0VQJywnUE9TJ107XG4gIGlmIChzeW1ib2xzLmluZGV4T2YoTWlub3JQYXJ0c09mU3BlZWNoW21pbm9yUGFydE9mU3BlZWNoXSkgPj0gMCkge1xuICAgIHJldHVybiBNYWpvclBhcnRzT2ZTcGVlY2guU1lNQk9MO1xuICB9XG4gIC8vIFdoLVdvcmRcbiAgbGV0IHdoV29yZHMgPSBbJ1dEVCcsJ1dQJywnV1BPJywnV1JCJ107XG4gIGlmICh3aFdvcmRzLmluZGV4T2YoTWlub3JQYXJ0c09mU3BlZWNoW21pbm9yUGFydE9mU3BlZWNoXSkgPj0gMCkge1xuICAgIHJldHVybiBNYWpvclBhcnRzT2ZTcGVlY2guV0hXT1JEO1xuICB9XG59XG5cbi8vIFdyYXAgcGx1cmFsaXplIHRvIHNwZWNpYWwgY2FzZSBjZXJ0YWluIHdvcmRzIGl0IGdldHMgd3Jvbmdcbi8vIEBIQUNLIGRhdGEgc2luZ3VsYXJpemVzIHRvIGRhdHVtLCB3aGljaCBpcyBjb3JyZWN0LCBidXQgd2Vcbi8vIGhhdmUgYSBjb2xsZWN0aW9uIGNhbGxlZCB0ZXN0IGRhdGEsIHdoaWNoIE5MUVAgdHVybnMgaW50byB0ZXN0IGRhdHVtXG5leHBvcnQgZnVuY3Rpb24gc2luZ3VsYXJpemUod29yZDogc3RyaW5nKTogc3RyaW5nIHtcbiAgLy8gc3BsaXQgd29yZCBhdCBzcGFjZXNcbiAgbGV0IHdvcmRzID0gd29yZC5zcGxpdChcIiBcIik7XG4gIGlmICh3b3Jkcy5sZW5ndGggPT09IDEpIHtcbiAgICBsZXQgc3BlY2lhbENhc2VzID0gW1wiaGlzXCIsIFwidGltZXNcIiwgXCJoYXNcIiwgXCJkb3duc3RhaXJzXCIsIFwiaXRzXCIsIFwiJ3NcIiwgXCJkYXRhXCIsIFwiYXJlXCIsIFwid2FzXCJdO1xuICAgIGZvciAobGV0IHNwZWNpYWxDYXNlIG9mIHNwZWNpYWxDYXNlcykge1xuICAgICAgaWYgKHNwZWNpYWxDYXNlID09PSB3b3JkKSB7XG4gICAgICAgIHJldHVybiB3b3JkO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcGx1cmFsaXplKHdvcmQsIDEpOyAgXG4gIH1cbiAgcmV0dXJuIHdvcmRzLm1hcChzaW5ndWxhcml6ZSkuam9pbihcIiBcIik7XG59XG5cbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbi8vIFRyZWUgZnVuY3Rpb25zXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbmludGVyZmFjZSBOb2RlIHtcbiAgaXg6IG51bWJlcixcbiAgdHlwZT86IE5vZGVUeXBlcyxcbiAgbmFtZTogc3RyaW5nLFxuICBwYXJlbnQ6IE5vZGUsXG4gIGNoaWxkcmVuOiBBcnJheTxOb2RlPixcbiAgZW50aXR5PzogRW50aXR5LFxuICBjb2xsZWN0aW9uPzogQ29sbGVjdGlvbixcbiAgYXR0cmlidXRlPzogQXR0cmlidXRlLFxuICBmeG4/OiBCdWlsdEluRnVuY3Rpb24sXG4gIHF1YW50aXR5PzogbnVtYmVyLFxuICBjb25zdGl0dWVudHM/OiBBcnJheTxOb2RlPixcbiAgcmVsYXRpb25zaGlwczogQXJyYXk8UmVsYXRpb25zaGlwPixcbiAgcmVwcmVzZW50YXRpb25zOiB7XG4gICAgY29sbGVjdGlvbj86IENvbGxlY3Rpb24sXG4gICAgZW50aXR5PzogRW50aXR5LFxuICAgIGF0dHJpYnV0ZT86IEF0dHJpYnV0ZSxcbiAgICBmeG4/OiBCdWlsdEluRnVuY3Rpb24sXG4gIH0sXG4gIHRva2VuOiBUb2tlbixcbiAgZm91bmQ6IGJvb2xlYW4sXG4gIGZvdW5kUmVwczogYm9vbGVhbixcbiAgcHJvcGVydGllczogQXJyYXk8UHJvcGVydGllcz4sXG4gIGhhc1Byb3BlcnR5KFByb3BlcnRpZXMpOiBib29sZWFuO1xuICB0b1N0cmluZyhudW1iZXI/OiBudW1iZXIpOiBzdHJpbmc7XG4gIG5leHQoKTogTm9kZTtcbiAgcHJldigpOiBOb2RlO1xuICBhZGRDaGlsZChub2RlOiBOb2RlKTogdm9pZDtcbn1cblxuZnVuY3Rpb24gY2xvbmVOb2RlKG5vZGU6IE5vZGUpOiBOb2RlIHtcbiAgbGV0IHRva2VuID0gY2xvbmVUb2tlbihub2RlLnRva2VuKTtcbiAgbGV0IGNsb25lTm9kZSA9IG5ld05vZGUodG9rZW4pO1xuICBjbG9uZU5vZGUuZW50aXR5ID0gbm9kZS5lbnRpdHk7XG4gIGNsb25lTm9kZS5jb2xsZWN0aW9uID0gbm9kZS5jb2xsZWN0aW9uO1xuICBjbG9uZU5vZGUuYXR0cmlidXRlID0gbm9kZS5hdHRyaWJ1dGU7XG4gIGNsb25lTm9kZS5meG4gPSBub2RlLmZ4bjtcbiAgY2xvbmVOb2RlLmZvdW5kID0gbm9kZS5mb3VuZDtcbiAgbm9kZS5wcm9wZXJ0aWVzLm1hcCgocHJvcGVydHkpID0+IGNsb25lTm9kZS5wcm9wZXJ0aWVzLnB1c2gocHJvcGVydHkpKTtcbiAgcmV0dXJuIGNsb25lTm9kZTtcbn1cblxuZnVuY3Rpb24gbmV3Tm9kZSh0b2tlbjogVG9rZW4pOiBOb2RlIHtcbiAgbGV0IG5vZGU6IE5vZGUgPSB7XG4gICAgaXg6IHRva2VuLml4LFxuICAgIG5hbWU6IHRva2VuLm5vcm1hbGl6ZWRXb3JkLFxuICAgIHBhcmVudDogdW5kZWZpbmVkLFxuICAgIGNoaWxkcmVuOiBbXSxcbiAgICB0b2tlbjogdG9rZW4sIFxuICAgIHByb3BlcnRpZXM6IHRva2VuLnByb3BlcnRpZXMsXG4gICAgcmVsYXRpb25zaGlwczogW10sXG4gICAgcmVwcmVzZW50YXRpb25zOiB7XG4gICAgICBlbnRpdHk6IHVuZGVmaW5lZCxcbiAgICAgIGNvbGxlY3Rpb246IHVuZGVmaW5lZCxcbiAgICAgIGF0dHJpYnV0ZTogdW5kZWZpbmVkLFxuICAgICAgZnhuOiB1bmRlZmluZWQsICBcbiAgICB9LFxuICAgIGZvdW5kOiBmYWxzZSxcbiAgICBmb3VuZFJlcHM6IGZhbHNlLFxuICAgIGhhc1Byb3BlcnR5OiBoYXNQcm9wZXJ0eSxcbiAgICB0b1N0cmluZzogbm9kZVRvU3RyaW5nLFxuICAgIG5leHQ6IG5leHROb2RlLFxuICAgIHByZXY6IHByZXZpb3VzTm9kZSxcbiAgICBhZGRDaGlsZDogYWRkQ2hpbGQsXG4gIH07XG4gIHRva2VuLm5vZGUgPSBub2RlO1xuICBmdW5jdGlvbiBoYXNQcm9wZXJ0eShwcm9wZXJ0eTogUHJvcGVydGllcyk6IGJvb2xlYW4ge1xuICBsZXQgZm91bmQgPSBub2RlLnByb3BlcnRpZXMuaW5kZXhPZihwcm9wZXJ0eSk7XG4gIGlmIChmb3VuZCAhPT0gLTEpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG4gIGZ1bmN0aW9uIG5leHROb2RlKCk6IE5vZGUge1xuICAgIGxldCB0b2tlbiA9IG5vZGUudG9rZW47XG4gICAgbGV0IG5leHRUb2tlbiA9IHRva2VuLm5leHQ7XG4gICAgaWYgKG5leHRUb2tlbiAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICByZXR1cm4gbmV4dFRva2VuLm5vZGU7XG4gICAgfVxuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH1cbiAgZnVuY3Rpb24gcHJldmlvdXNOb2RlKCk6IE5vZGUge1xuICAgIGxldCB0b2tlbiA9IG5vZGUudG9rZW47XG4gICAgbGV0IHByZXZUb2tlbiA9IHRva2VuLnByZXY7XG4gICAgaWYgKHByZXZUb2tlbiAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICByZXR1cm4gcHJldlRva2VuLm5vZGU7XG4gICAgfVxuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH1cbiAgZnVuY3Rpb24gYWRkQ2hpbGQobmV3Q2hpbGQ6IE5vZGUpOiB2b2lkIHtcbiAgICBub2RlLmNoaWxkcmVuLnB1c2gobmV3Q2hpbGQpO1xuICAgIG5ld0NoaWxkLnBhcmVudCA9IG5vZGU7XG4gIH1cbiAgZnVuY3Rpb24gbm9kZVRvU3RyaW5nKGRlcHRoPzogbnVtYmVyKTogc3RyaW5nIHtcbiAgICBpZiAoZGVwdGggPT09IHVuZGVmaW5lZCkge1xuICAgICAgZGVwdGggPSAwO1xuICAgIH1cbiAgICBsZXQgY2hpbGRyZW5TdHJpbmdzID0gbm9kZS5jaGlsZHJlbi5tYXAoKGNoaWxkTm9kZSkgPT4gY2hpbGROb2RlLnRvU3RyaW5nKGRlcHRoKzEpKS5qb2luKFwiXFxuXCIpO1xuICAgIGxldCBjaGlsZHJlbiA9IGNoaWxkcmVuU3RyaW5ncy5sZW5ndGggPiAwID8gXCJcXG5cIiArIGNoaWxkcmVuU3RyaW5ncyA6IFwiXCI7XG4gICAgbGV0IGluZGVudCA9IEFycmF5KGRlcHRoKzEpLmpvaW4oXCIgXCIpO1xuICAgIGxldCBpbmRleCA9IG5vZGUuaXggPT09IHVuZGVmaW5lZCA/IFwiKyBcIiA6IGAke25vZGUuaXh9OiBgO1xuICAgIGxldCBwcm9wZXJ0aWVzID0gbm9kZS5wcm9wZXJ0aWVzLmxlbmd0aCA9PT0gMCA/IFwiXCIgOiBgKCR7bm9kZS5wcm9wZXJ0aWVzLm1hcCgocHJvcGVydHk6IFByb3BlcnRpZXMpID0+IFByb3BlcnRpZXNbcHJvcGVydHldKS5qb2luKFwifFwiKX0pYDtcbiAgICBsZXQgYXR0cmlidXRlID0gbm9kZS5hdHRyaWJ1dGUgPT09IHVuZGVmaW5lZCA/IFwiXCIgOiBgWyR7bm9kZS5hdHRyaWJ1dGUudmFyaWFibGV9XWA7XG4gICAgbGV0IGVudGl0eSA9IG5vZGUuZW50aXR5ID09PSB1bmRlZmluZWQgPyBcIlwiIDogYFske25vZGUuZW50aXR5LmRpc3BsYXlOYW1lfV1gO1xuICAgIGxldCBjb2xsZWN0aW9uID0gbm9kZS5jb2xsZWN0aW9uID09PSB1bmRlZmluZWQgPyBcIlwiIDogYFske25vZGUuY29sbGVjdGlvbi5kaXNwbGF5TmFtZX1dYDtcbiAgICBsZXQgZnhuID0gbm9kZS5meG4gPT09IHVuZGVmaW5lZCA/IFwiXCIgOiBgWyR7bm9kZS5meG4ubmFtZX1dYDtcbiAgICBsZXQgZm91bmQgPSBub2RlLmZvdW5kID8gXCIqXCIgOiBcIiBcIjtcbiAgICBwcm9wZXJ0aWVzID0gcHJvcGVydGllcy5sZW5ndGggPT09IDIgPyBcIlwiIDogcHJvcGVydGllcztcbiAgICBsZXQgbm9kZVN0cmluZyA9IGB8JHtmb3VuZH0ke2luZGVudH0ke2luZGV4fSR7bm9kZS5uYW1lfSAke2Z4bn0ke2VudGl0eX0ke2NvbGxlY3Rpb259JHthdHRyaWJ1dGV9ICR7cHJvcGVydGllc30ke2NoaWxkcmVufWA7IFxuICAgIHJldHVybiBub2RlU3RyaW5nO1xuICB9XG4gIHJldHVybiBub2RlOyAgXG59XG5cbi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4vLyBWYXJpb3VzIG5vZGUgbWFuaXB1bGF0aW9uIGZ1bmN0aW9uc1xuLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuLy8gUmVtb3ZlcyB0aGUgbm9kZSBhbmQgaXRzIGNoaWxkcmVuIGZyb20gdGhlIHRyZWUsIFxuLy8gYW5kIG1ha2VzIGl0IGEgY2hpbGQgb2YgdGhlIHRhcmdldCBub2RlXG5mdW5jdGlvbiByZXJvb3Qobm9kZTogTm9kZSwgdGFyZ2V0OiBOb2RlKTogdm9pZCB7XG4gIG5vZGUucGFyZW50LmNoaWxkcmVuLnNwbGljZShub2RlLnBhcmVudC5jaGlsZHJlbi5pbmRleE9mKG5vZGUpLDEpOyAgXG4gIHRhcmdldC5hZGRDaGlsZChub2RlKTtcbn1cblxuLy8gUmVtb3ZlcyBhIG5vZGUgZnJvbSB0aGUgdHJlZVxuLy8gVGhlIG5vZGUncyBjaGlsZHJlbiBnZXQgYWRkZWQgdG8gaXRzIHBhcmVudFxuLy8gcmV0dXJucyB0aGUgbm9kZSBvciB1bmRlZmluZWQgaWYgdGhlIG9wZXJhdGlvbiBmYWlsZWRcbmZ1bmN0aW9uIHJlbW92ZU5vZGUobm9kZTogTm9kZSk6IE5vZGUge1xuICBpZiAobm9kZS5oYXNQcm9wZXJ0eShQcm9wZXJ0aWVzLlJPT1QpKSB7XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfVxuICBpZiAobm9kZS5wYXJlbnQgPT09IHVuZGVmaW5lZCAmJiBub2RlLmNoaWxkcmVuLmxlbmd0aCA9PT0gMCkge1xuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH1cbiAgbGV0IGNoaWxkcmVuOiBBcnJheTxOb2RlPiA9IG5vZGUuY2hpbGRyZW47XG4gIGxldCBwYXJlbnQ6IE5vZGUgPSBub2RlLnBhcmVudDtcbiAgLy8gUmV3aXJlXG4gIGlmIChwYXJlbnQgIT09IHVuZGVmaW5lZCkge1xuICAgIHBhcmVudC5jaGlsZHJlbiA9IHBhcmVudC5jaGlsZHJlbi5jb25jYXQoY2hpbGRyZW4pO1xuICAgIHBhcmVudC5jaGlsZHJlbi5zb3J0KChhLGIpID0+IGEuaXggLSBiLml4KTtcbiAgICBwYXJlbnQuY2hpbGRyZW4uc3BsaWNlKHBhcmVudC5jaGlsZHJlbi5pbmRleE9mKG5vZGUpLDEpO1xuICAgIGNoaWxkcmVuLm1hcCgoY2hpbGQpID0+IGNoaWxkLnBhcmVudCA9IHBhcmVudCk7XG4gICAgaWYgKHBhcmVudC5oYXNQcm9wZXJ0eShQcm9wZXJ0aWVzLkFSR1VNRU5UKSkge1xuICAgICAgaWYgKHBhcmVudC5jaGlsZHJlbi5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcGFyZW50LmZvdW5kID0gZmFsc2U7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIC8vIEdldCByaWQgb2YgcmVmZXJlbmNlcyBvbiBjdXJyZW50IG5vZGVcbiAgbm9kZS5wYXJlbnQgPSB1bmRlZmluZWQ7XG4gIG5vZGUuY2hpbGRyZW4gPSBbXTtcbiAgcmV0dXJuIG5vZGU7XG59XG5cbmZ1bmN0aW9uIHJlbW92ZUJyYW5jaChub2RlOiBOb2RlKTogTm9kZSB7XG4gIGxldCBwYXJlbnQgPSBub2RlLnBhcmVudDtcbiAgaWYgKHBhcmVudCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgcGFyZW50LmNoaWxkcmVuLnNwbGljZShwYXJlbnQuY2hpbGRyZW4uaW5kZXhPZihub2RlKSwxKTtcbiAgICBub2RlLnBhcmVudCA9IHVuZGVmaW5lZDtcbiAgICByZXR1cm4gbm9kZTsgIFxuICB9XG4gIHJldHVybiB1bmRlZmluZWQ7XG59XG5cbi8vIFJldHVybnMgdGhlIGZpcnN0IGFuY2VzdG9yIG5vZGUgdGhhdCBoYXMgYmVlbiBmb3VuZFxuZnVuY3Rpb24gcHJldmlvdXNseU1hdGNoZWQobm9kZTogTm9kZSwgaWdub3JlRnVuY3Rpb25zPzogYm9vbGVhbik6IE5vZGUge1xuICBpZiAoaWdub3JlRnVuY3Rpb25zID09PSB1bmRlZmluZWQpIHtcbiAgICBpZ25vcmVGdW5jdGlvbnMgPSBmYWxzZTtcbiAgfVxuICBpZiAobm9kZS5wYXJlbnQgPT09IHVuZGVmaW5lZCkge1xuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH0gZWxzZSBpZiAoIWlnbm9yZUZ1bmN0aW9ucyAmJiBcbiAgICAgICAgICAgICAobm9kZS5wYXJlbnQuaGFzUHJvcGVydHkoUHJvcGVydGllcy5TRVRURVIpIHx8XG4gICAgICAgICAgICAgKG5vZGUucGFyZW50Lmhhc1Byb3BlcnR5KFByb3BlcnRpZXMuRlVOQ1RJT04pICYmICFub2RlLnBhcmVudC5oYXNQcm9wZXJ0eShQcm9wZXJ0aWVzLkNPTkpVTkNUSU9OKSkpKSAge1xuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH0gZWxzZSBpZiAobm9kZS5wYXJlbnQuaGFzUHJvcGVydHkoUHJvcGVydGllcy5FTlRJVFkpIHx8XG4gICAgICAgICAgICAgbm9kZS5wYXJlbnQuaGFzUHJvcGVydHkoUHJvcGVydGllcy5BVFRSSUJVVEUpIHx8XG4gICAgICAgICAgICAgbm9kZS5wYXJlbnQuaGFzUHJvcGVydHkoUHJvcGVydGllcy5DT0xMRUNUSU9OKSkge1xuICAgIHJldHVybiBub2RlLnBhcmVudDtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gcHJldmlvdXNseU1hdGNoZWQobm9kZS5wYXJlbnQsaWdub3JlRnVuY3Rpb25zKTtcbiAgfVxufVxuXG4vLyBSZXR1cm5zIHRoZSBmaXJzdCBhbmNlc3RvciBub2RlIHRoYXQgaGFzIGJlZW4gZm91bmRcbmZ1bmN0aW9uIHByZXZpb3VzbHlNYXRjaGVkRW50aXR5T3JDb2xsZWN0aW9uKG5vZGU6IE5vZGUsIGlnbm9yZUZ1bmN0aW9ucz86IGJvb2xlYW4pOiBOb2RlIHtcbiAgaWYgKGlnbm9yZUZ1bmN0aW9ucyA9PT0gdW5kZWZpbmVkKSB7XG4gICAgaWdub3JlRnVuY3Rpb25zID0gZmFsc2U7XG4gIH1cbiAgaWYgKG5vZGUucGFyZW50ID09PSB1bmRlZmluZWQpIHtcbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9IGVsc2UgaWYgKCFpZ25vcmVGdW5jdGlvbnMgJiYgXG4gICAgICAgICAgICAgKG5vZGUucGFyZW50Lmhhc1Byb3BlcnR5KFByb3BlcnRpZXMuU0VUVEVSKSB8fFxuICAgICAgICAgICAgIChub2RlLnBhcmVudC5oYXNQcm9wZXJ0eShQcm9wZXJ0aWVzLkZVTkNUSU9OKSAmJiAhbm9kZS5wYXJlbnQuaGFzUHJvcGVydHkoUHJvcGVydGllcy5DT05KVU5DVElPTikpKSkgIHtcbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9IGVsc2UgaWYgKG5vZGUucGFyZW50Lmhhc1Byb3BlcnR5KFByb3BlcnRpZXMuRU5USVRZKSB8fFxuICAgICAgICAgICAgIG5vZGUucGFyZW50Lmhhc1Byb3BlcnR5KFByb3BlcnRpZXMuQ09MTEVDVElPTikpIHtcbiAgICByZXR1cm4gbm9kZS5wYXJlbnQ7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIHByZXZpb3VzbHlNYXRjaGVkRW50aXR5T3JDb2xsZWN0aW9uKG5vZGUucGFyZW50LGlnbm9yZUZ1bmN0aW9ucyk7XG4gIH1cbn1cblxuLy8gUmV0dXJucyB0aGUgZmlyc3QgYW5jZXN0b3Igbm9kZSB0aGF0IGhhcyBiZWVuIGZvdW5kXG5mdW5jdGlvbiBwcmV2aW91c2x5TWF0Y2hlZEF0dHJpYnV0ZShub2RlOiBOb2RlLCBpZ25vcmVGdW5jdGlvbnM/OiBib29sZWFuKTogTm9kZSB7XG4gIGlmIChpZ25vcmVGdW5jdGlvbnMgPT09IHVuZGVmaW5lZCkge1xuICAgIGlnbm9yZUZ1bmN0aW9ucyA9IGZhbHNlO1xuICB9XG4gIGlmIChub2RlLnBhcmVudCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfSBlbHNlIGlmICghaWdub3JlRnVuY3Rpb25zICYmIFxuICAgICAgICAgICAgIChub2RlLnBhcmVudC5oYXNQcm9wZXJ0eShQcm9wZXJ0aWVzLlNFVFRFUikgfHxcbiAgICAgICAgICAgICAobm9kZS5wYXJlbnQuaGFzUHJvcGVydHkoUHJvcGVydGllcy5GVU5DVElPTikgJiYgIW5vZGUucGFyZW50Lmhhc1Byb3BlcnR5KFByb3BlcnRpZXMuQ09OSlVOQ1RJT04pKSkpICB7XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfSBlbHNlIGlmIChub2RlLnBhcmVudC5oYXNQcm9wZXJ0eShQcm9wZXJ0aWVzLkFUVFJJQlVURSkpIHtcbiAgICByZXR1cm4gbm9kZS5wYXJlbnQ7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIHByZXZpb3VzbHlNYXRjaGVkQXR0cmlidXRlKG5vZGUucGFyZW50LGlnbm9yZUZ1bmN0aW9ucyk7XG4gIH1cbn1cblxuLy8gSW5zZXJ0cyBhIG5vZGUgYWZ0ZXIgdGhlIHRhcmdldCwgbW92aW5nIGFsbCBvZiB0aGVcbi8vIHRhcmdldCdzIGNoaWxkcmVuIHRvIHRoZSBub2RlXG4vLyBCZWZvcmU6IFtUYXJnZXRdIC0+IFtDaGlsZHJlbl1cbi8vIEFmdGVyOiAgW1RhcmdldF0gLT4gW05vZGVdIC0+IFtDaGlsZHJlbl1cbmZ1bmN0aW9uIGluc2VydEFmdGVyTm9kZShub2RlOiBOb2RlLCB0YXJnZXQ6IE5vZGUpOiB2b2lkIHtcbiAgbm9kZS5wYXJlbnQgPSB0YXJnZXQ7XG4gIG5vZGUuY2hpbGRyZW4gPSB0YXJnZXQuY2hpbGRyZW47XG4gIHRhcmdldC5jaGlsZHJlbi5tYXAoKG4pID0+IG4ucGFyZW50ID0gbm9kZSk7XG4gIHRhcmdldC5jaGlsZHJlbiA9IFtub2RlXTtcbn1cblxuZnVuY3Rpb24gaW5zZXJ0QmVmb3JlTm9kZShub2RlOiBOb2RlLCB0YXJnZXQ6IE5vZGUpOiB2b2lkIHtcbiAgbGV0IHBhcmVudCA9IHRhcmdldC5wYXJlbnQ7XG4gIGlmIChwYXJlbnQgIT09IHVuZGVmaW5lZCkge1xuICAgIHBhcmVudC5hZGRDaGlsZChub2RlKTtcbiAgICBwYXJlbnQuY2hpbGRyZW4uc3BsaWNlKHBhcmVudC5jaGlsZHJlbi5pbmRleE9mKHRhcmdldCksMSk7XG4gICAgbm9kZS5hZGRDaGlsZCh0YXJnZXQpO1xuICB9XG59XG5cbi8vIEZpbmQgYWxsIGxlYWYgbm9kZXMgc3RlbW1pbmcgZnJvbSBhIGdpdmVuIG5vZGVcbmZ1bmN0aW9uIGZpbmRMZWFmTm9kZXMobm9kZTogTm9kZSk6IEFycmF5PE5vZGU+IHtcbiAgaWYobm9kZS5jaGlsZHJlbi5sZW5ndGggPT09IDApIHtcbiAgICByZXR1cm4gW25vZGVdO1xuICB9XG4gIGVsc2Uge1xuICAgIGxldCBmb3VuZExlYWZzID0gbm9kZS5jaGlsZHJlbi5tYXAoZmluZExlYWZOb2Rlcyk7XG4gICAgbGV0IGZsYXRMZWFmcyA9IGZsYXR0ZW5OZXN0ZWRBcnJheShmb3VuZExlYWZzKTtcbiAgICByZXR1cm4gZmxhdExlYWZzO1xuICB9XG59IFxuXG4vKmZ1bmN0aW9uIG1vdmVOb2RlKG5vZGU6IE5vZGUsIHRhcmdldDogTm9kZSk6IHZvaWQge1xuICBpZiAobm9kZS5oYXNQcm9wZXJ0eShQcm9wZXJ0aWVzLlJPT1QpKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIGxldCBwYXJlbnQgPSBub2RlLnBhcmVudDtcbiAgcGFyZW50LmNoaWxkcmVuLnNwbGljZShwYXJlbnQuY2hpbGRyZW4uaW5kZXhPZihub2RlKSwxKTtcbiAgcGFyZW50LmNoaWxkcmVuID0gcGFyZW50LmNoaWxkcmVuLmNvbmNhdChub2RlLmNoaWxkcmVuKTtcbiAgbm9kZS5jaGlsZHJlbi5tYXAoKGNoaWxkKSA9PiBjaGlsZC5wYXJlbnQgPSBwYXJlbnQpO1xuICBub2RlLmNoaWxkcmVuID0gW107XG4gIG5vZGUucGFyZW50ID0gdGFyZ2V0O1xuICB0YXJnZXQuY2hpbGRyZW4ucHVzaChub2RlKTtcbn0qL1xuXG4vLyBGaW5kcyBhIHBhcmVudCBub2RlIHdpdGggdGhlIHNwZWNpZmllZCBwcm9wZXJ0eSwgXG4vLyByZXR1cm5zIHVuZGVmaW5lZCBpZiBubyBub2RlIHdhcyBmb3VuZFxuZnVuY3Rpb24gZmluZFBhcmVudFdpdGhQcm9wZXJ0eShub2RlOiBOb2RlLCBwcm9wZXJ0eTogUHJvcGVydGllcyk6IE5vZGUge1xuICBpZiAobm9kZS5wYXJlbnQgPT09IHVuZGVmaW5lZCkge1xuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH1cbiAgIGVsc2UgaWYgKG5vZGUucGFyZW50Lmhhc1Byb3BlcnR5KHByb3BlcnR5KSkge1xuICAgIHJldHVybiBub2RlLnBhcmVudDtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gZmluZFBhcmVudFdpdGhQcm9wZXJ0eShub2RlLnBhcmVudCxwcm9wZXJ0eSk7XG4gIH0gXG59XG5cbi8vIEZpbmRzIGEgcGFyZW50IG5vZGUgd2l0aCB0aGUgc3BlY2lmaWVkIHByb3BlcnR5LCBcbi8vIHJldHVybnMgdW5kZWZpbmVkIGlmIG5vIG5vZGUgd2FzIGZvdW5kXG5mdW5jdGlvbiBmaW5kQ2hpbGRXaXRoUHJvcGVydHkobm9kZTogTm9kZSwgcHJvcGVydHk6IFByb3BlcnRpZXMpOiBOb2RlIHtcbiAgaWYgKG5vZGUuY2hpbGRyZW4ubGVuZ3RoID09PSAwKSB7XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfVxuICBpZiAobm9kZS5oYXNQcm9wZXJ0eShwcm9wZXJ0eSkpIHtcbiAgICByZXR1cm4gbm9kZTtcbiAgfSBlbHNlIHtcbiAgICBsZXQgY2hpbGRyZW5XaXRoUHJvcGVydHkgPSBub2RlLmNoaWxkcmVuLmZpbHRlcigoY2hpbGQpID0+IGNoaWxkLmhhc1Byb3BlcnR5KHByb3BlcnR5KSk7XG4gICAgaWYgKGNoaWxkcmVuV2l0aFByb3BlcnR5ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHJldHVybiBjaGlsZHJlbldpdGhQcm9wZXJ0eVswXTtcbiAgICB9IGVsc2Uge1xuICAgICAgbGV0IHJlc3VsdHMgPSBub2RlLmNoaWxkcmVuLm1hcCgoY2hpbGQpID0+IGZpbmRDaGlsZFdpdGhQcm9wZXJ0eShjaGlsZCxwcm9wZXJ0eSkpLmZpbHRlcigocmVzdWx0KSA9PiByZXN1bHQgIT09IHVuZGVmaW5lZCk7XG4gICAgICBpZiAocmVzdWx0cy5sZW5ndGggPiAwKSB7XG4gICAgICAgIHJldHVybiByZXN1bHRzWzBdO1xuICAgICAgfVxuICAgIH1cbiAgfSBcbn1cblxuLy8gRmluZHMgYSBwYXJlbnQgbm9kZSB3aXRoIHRoZSBzcGVjaWZpZWQgUE9TLCBcbi8vIHJldHVybnMgdW5kZWZpbmVkIGlmIG5vIG5vZGUgd2FzIGZvdW5kXG5mdW5jdGlvbiBmaW5kUGFyZW50V2l0aFBPUyhub2RlOiBOb2RlLCBtYWpvclBPUzogTWFqb3JQYXJ0c09mU3BlZWNoKTogTm9kZSB7XG4gIGlmIChnZXRNYWpvclBPUyhub2RlLnRva2VuLlBPUykgPT09IE1ham9yUGFydHNPZlNwZWVjaC5ST09UKSB7XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfVxuICBpZiAoZ2V0TWFqb3JQT1Mobm9kZS5wYXJlbnQudG9rZW4uUE9TKSA9PT0gbWFqb3JQT1MpIHtcbiAgICByZXR1cm4gbm9kZS5wYXJlbnQ7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIGZpbmRQYXJlbnRXaXRoUE9TKG5vZGUucGFyZW50LG1ham9yUE9TKTtcbiAgfSBcbn1cblxuLypcbi8vIFNldHMgbm9kZSB0byBiZSBhIHNpYmxpbmcgb2YgaXRzIHBhcmVudFxuLy8gQmVmb3JlOiBbR3JhbmRwYXJlbnRdIC0+IFtQYXJlbnRdIC0+IFtOb2RlXSBcbi8vIEFmdGVyOiAgW0dyYW5kcGFyZW50XSAtPiBbUGFyZW50XVxuLy8gICAgICAgICAgICAgICAgICAgICAgIC0+IFtOb2RlXVxuZnVuY3Rpb24gcHJvbW90ZU5vZGUobm9kZTogTm9kZSk6IHZvaWQge1xuICBpZiAobm9kZS5wYXJlbnQuaGFzUHJvcGVydHkoUHJvcGVydGllcy5ST09UKSkge1xuICAgIHJldHVybjtcbiAgfVxuICBsZXQgbmV3U2libGluZyA9IG5vZGUucGFyZW50O1xuICBsZXQgbmV3UGFyZW50ID0gbmV3U2libGluZy5wYXJlbnQ7XG4gIC8vIFNldCBwYXJlbnRcbiAgbm9kZS5wYXJlbnQgPSBuZXdQYXJlbnQ7XG4gIC8vIFJlbW92ZSBub2RlIGZyb20gcGFyZW50J3MgY2hpbGRyZW5cbiAgbmV3U2libGluZy5jaGlsZHJlbi5zcGxpY2UobmV3U2libGluZy5jaGlsZHJlbi5pbmRleE9mKG5vZGUpLDEpO1xuICAvLyBBZGQgbm9kZSB0byBuZXcgcGFyZW50J3MgY2hpbGRyZW5cbiAgbmV3UGFyZW50LmNoaWxkcmVuLnB1c2gobm9kZSk7XG59Ki9cblxuLy8gTWFrZXMgdGhlIG5vZGUncyBwYXJlbnQgYSBjaGlsZCBvZiB0aGUgbm9kZS5cbi8vIFRoZSBub2RlJ3MgZ3JhbmRwYXJlbnQgaXMgdGhlbiB0aGUgbm9kZSdzIHBhcmVudFxuLy8gQmVmb3JlOiBbR3JhbmRwYXJlbnRdIC0+IFtQYXJlbnRdIC0+IFtOb2RlXVxuLy8gQWZ0ZXI6IFtHcmFuZHBhcmVuXSAtPiBbTm9kZV0gLT4gW1BhcmVudF1cbmZ1bmN0aW9uIG1ha2VQYXJlbnRDaGlsZChub2RlOiBOb2RlKTogdm9pZCB7XG4gIGxldCBwYXJlbnQgPSBub2RlLnBhcmVudDtcbiAgLy8gRG8gbm90IHN3YXAgd2l0aCByb290XG4gIGlmIChwYXJlbnQuaGFzUHJvcGVydHkoUHJvcGVydGllcy5ST09UKSkge1xuICAgIHJldHVybjtcbiAgfVxuICAvLyBTZXQgcGFyZW50c1xuICBub2RlLnBhcmVudCA9IHBhcmVudC5wYXJlbnRcbiAgcGFyZW50LnBhcmVudCA9IG5vZGU7XG4gIC8vIFJlbW92ZSBub2RlIGFzIGEgY2hpbGQgZnJvbSBwYXJlbnRcbiAgcGFyZW50LmNoaWxkcmVuLnNwbGljZShwYXJlbnQuY2hpbGRyZW4uaW5kZXhPZihub2RlKSwxKTtcbiAgLy8gU2V0IGNoaWxkcmVuXG4gIG5vZGUuY2hpbGRyZW4gPSBub2RlLmNoaWxkcmVuLmNvbmNhdChwYXJlbnQpO1xuICBub2RlLnBhcmVudC5jaGlsZHJlbi5wdXNoKG5vZGUpO1xuICBub2RlLnBhcmVudC5jaGlsZHJlbi5zcGxpY2Uobm9kZS5wYXJlbnQuY2hpbGRyZW4uaW5kZXhPZihwYXJlbnQpLDEpO1xufVxuXG5cbi8vIFN3YXBzIGEgbm9kZSB3aXRoIGl0cyBwYXJlbnQuIFRoZSBub2RlJ3MgcGFyZW50XG4vLyBpcyB0aGVuIHRoZSBwYXJlbnQncyBwYXJlbnQsIGFuZCBpdHMgY2hpbGQgaXMgdGhlIHBhcmVudC5cbi8vIFRoZSBwYXJlbnQgZ2V0cyB0aGUgbm9kZSdzIGNoaWxkcmVuXG5mdW5jdGlvbiBzd2FwV2l0aFBhcmVudChub2RlOiBOb2RlKTogdm9pZCB7XG4gIGxldCBwYXJlbnQgPSBub2RlLnBhcmVudDtcbiAgbGV0IHBwYXJlbnQgPSBwYXJlbnQucGFyZW50O1xuICBpZiAocGFyZW50Lmhhc1Byb3BlcnR5KFByb3BlcnRpZXMuUk9PVCkpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgcGFyZW50LnBhcmVudCA9IG5vZGU7XG4gIHBhcmVudC5jaGlsZHJlbiA9IG5vZGUuY2hpbGRyZW47XG4gIHBwYXJlbnQuY2hpbGRyZW4uc3BsaWNlKHBwYXJlbnQuY2hpbGRyZW4uaW5kZXhPZihwYXJlbnQpLDEpO1xuICBub2RlLnBhcmVudCA9IHBwYXJlbnQ7XG4gIG5vZGUuY2hpbGRyZW4gPSBbcGFyZW50XTtcbiAgcHBhcmVudC5jaGlsZHJlbi5wdXNoKG5vZGUpO1xufVxuXG5pbnRlcmZhY2UgQ29udGV4dCB7XG4gIGVudGl0aWVzOiBBcnJheTxOb2RlPixcbiAgY29sbGVjdGlvbnM6IEFycmF5PE5vZGU+LFxuICBhdHRyaWJ1dGVzOiBBcnJheTxOb2RlPixcbiAgZnhuczogQXJyYXk8Tm9kZT4sXG4gIGdyb3VwaW5nczogQXJyYXk8Tm9kZT4sXG4gIHJlbGF0aW9uc2hpcHM6IEFycmF5PFJlbGF0aW9uc2hpcD4sXG4gIGZvdW5kOiBBcnJheTxOb2RlPixcbiAgYXJndW1lbnRzOiBBcnJheTxOb2RlPixcbiAgbWF5YmVFbnRpdGllczogQXJyYXk8Tm9kZT4sXG4gIG1heWJlQXR0cmlidXRlczogQXJyYXk8Tm9kZT4sXG4gIG1heWJlQ29sbGVjdGlvbnM6IEFycmF5PE5vZGU+LFxuICBtYXliZUZ1bmN0aW9uczogQXJyYXk8Tm9kZT4sXG4gIG1heWJlQXJndW1lbnRzOiBBcnJheTxOb2RlPixcbiAgaW50ZXJuYWxGeG5zOiBBcnJheTxOb2RlPixcbiAgbm9kZXM6IEFycmF5PE5vZGU+LFxuICBzdGF0ZUZsYWdzOiB7bGlzdDogYm9vbGVhbiwgaW5zZXJ0OiBib29sZWFufSxcbn1cblxuXG5cbmZ1bmN0aW9uIG5ld0NvbnRleHQoKTogQ29udGV4dCB7XG4gIHJldHVybiB7XG4gICAgZW50aXRpZXM6IFtdLFxuICAgIGNvbGxlY3Rpb25zOiBbXSxcbiAgICBhdHRyaWJ1dGVzOiBbXSxcbiAgICBmeG5zOiBbXSxcbiAgICBncm91cGluZ3M6IFtdLFxuICAgIHJlbGF0aW9uc2hpcHM6IFtdLFxuICAgIGZvdW5kOiBbXSxcbiAgICBhcmd1bWVudHM6IFtdLFxuICAgIG1heWJlRW50aXRpZXM6IFtdLFxuICAgIG1heWJlQXR0cmlidXRlczogW10sXG4gICAgbWF5YmVDb2xsZWN0aW9uczogW10sXG4gICAgbWF5YmVGdW5jdGlvbnM6IFtdLFxuICAgIG1heWJlQXJndW1lbnRzOiBbXSxcbiAgICBpbnRlcm5hbEZ4bnM6IFtdLFxuICAgIG5vZGVzOiBbXSxcbiAgICBzdGF0ZUZsYWdzOiB7bGlzdDogZmFsc2UsIGluc2VydDogZmFsc2V9LFxuICB9O1xufVxuXG5leHBvcnQgZW51bSBGdW5jdGlvblR5cGVzIHtcbiAgRklMVEVSLFxuICBBR0dSRUdBVEUsXG4gIEJPT0xFQU4sXG4gIENBTENVTEFURSxcbiAgSU5TRVJULFxuICBTRUxFQ1QsXG4gIEdST1VQLFxuICBORUdBVEUsXG59XG5cbmludGVyZmFjZSBCdWlsdEluRnVuY3Rpb24ge1xuICBuYW1lOiBzdHJpbmcsXG4gIHR5cGU6IEZ1bmN0aW9uVHlwZXMsXG4gIGF0dHJpYnV0ZT86IHN0cmluZyxcbiAgZmllbGRzOiBBcnJheTxGdW5jdGlvbkZpZWxkPixcbiAgcHJvamVjdDogYm9vbGVhbixcbiAgbmVnYXRlZD86IGJvb2xlYW4sXG4gIG5vZGU/OiBOb2RlLFxuICBwcm9qZWN0ZWRBcz86IHN0cmluZyxcbn1cblxuaW50ZXJmYWNlIEZ1bmN0aW9uRmllbGQge1xuICBuYW1lOiBzdHJpbmcsXG4gIHR5cGVzOiBBcnJheTxQcm9wZXJ0aWVzPixcbn1cblxuZnVuY3Rpb24gc3RyaW5nVG9GdW5jdGlvbih3b3JkOiBzdHJpbmcpOiBCdWlsdEluRnVuY3Rpb24ge1xuICBsZXQgYWxsID0gW1Byb3BlcnRpZXMuRU5USVRZLCBQcm9wZXJ0aWVzLkFUVFJJQlVURSwgUHJvcGVydGllcy5DT0xMRUNUSU9OLCBQcm9wZXJ0aWVzLkZVTkNUSU9OLCBQcm9wZXJ0aWVzLlJPT1RdO1xuICBsZXQgQ0ZBID0gW1Byb3BlcnRpZXMuQ09MTEVDVElPTiwgUHJvcGVydGllcy5GVU5DVElPTiwgUHJvcGVydGllcy5BVFRSSUJVVEVdO1xuICBsZXQgZmlsdGVyRmllbGRzID0gW3tuYW1lOiBcImFcIiwgdHlwZXM6IFtQcm9wZXJ0aWVzLkFUVFJJQlVURSwgUHJvcGVydGllcy5RVUFOVElUWV19LCBcbiAgICAgICAgICAgICAgICAgICAgICB7bmFtZTpcImJcIiwgdHlwZXM6IFtQcm9wZXJ0aWVzLkFUVFJJQlVURSwgUHJvcGVydGllcy5RVUFOVElUWV19XG4gICAgICAgICAgICAgICAgICAgICBdO1xuICBsZXQgY2FsY3VsYXRlRmllbGRzID0gW3tuYW1lOiBcInJlc3VsdFwiLCB0eXBlczogW1Byb3BlcnRpZXMuT1VUUFVUXX0sIFxuICAgICAgICAgICAgICAgICAgICAgICAgIHtuYW1lOiBcImFcIiwgdHlwZXM6IFtQcm9wZXJ0aWVzLkFUVFJJQlVURSwgUHJvcGVydGllcy5RVUFOVElUWV19LCBcbiAgICAgICAgICAgICAgICAgICAgICAgICB7bmFtZTpcImJcIiwgdHlwZXM6IFtQcm9wZXJ0aWVzLkFUVFJJQlVURSwgUHJvcGVydGllcy5RVUFOVElUWV19XG4gICAgICAgICAgICAgICAgICAgICAgICBdO1xuICBzd2l0Y2ggKHdvcmQpIHtcbiAgICBjYXNlIFwiYWZ0ZXJcIjpcbiAgICBjYXNlIFwiPlwiOlxuICAgICAgcmV0dXJuIHtuYW1lOiBcIj5cIiwgdHlwZTogRnVuY3Rpb25UeXBlcy5GSUxURVIsIGZpZWxkczogZmlsdGVyRmllbGRzLCBwcm9qZWN0OiBmYWxzZX07XG4gICAgY2FzZSBcImJlZm9yZVwiOlxuICAgIGNhc2UgXCI8XCI6XG4gICAgICByZXR1cm4ge25hbWU6IFwiPFwiLCB0eXBlOiBGdW5jdGlvblR5cGVzLkZJTFRFUiwgZmllbGRzOiBmaWx0ZXJGaWVsZHMsIHByb2plY3Q6IGZhbHNlfTtcbiAgICBjYXNlIFwiPj1cIjpcbiAgICAgIHJldHVybiB7bmFtZTogXCI+PVwiLCB0eXBlOiBGdW5jdGlvblR5cGVzLkZJTFRFUiwgZmllbGRzOiBmaWx0ZXJGaWVsZHMsIHByb2plY3Q6IGZhbHNlfTtcbiAgICBjYXNlIFwiPD1cIjpcbiAgICAgIHJldHVybiB7bmFtZTogXCI8PVwiLCB0eXBlOiBGdW5jdGlvblR5cGVzLkZJTFRFUiwgZmllbGRzOiBmaWx0ZXJGaWVsZHMsIHByb2plY3Q6IGZhbHNlfTtcbiAgICBjYXNlIFwiPVwiOlxuICAgICAgcmV0dXJuIHtuYW1lOiBcIj1cIiwgdHlwZTogRnVuY3Rpb25UeXBlcy5GSUxURVIsIGZpZWxkczogZmlsdGVyRmllbGRzLCBwcm9qZWN0OiBmYWxzZX07XG4gICAgY2FzZSBcIiE9XCI6XG4gICAgICByZXR1cm4ge25hbWU6IFwiIT1cIiwgdHlwZTogRnVuY3Rpb25UeXBlcy5GSUxURVIsIGZpZWxkczogZmlsdGVyRmllbGRzLCBwcm9qZWN0OiBmYWxzZX07ICAgICBcbiAgICBjYXNlIFwidGFsbGVyXCI6XG4gICAgICByZXR1cm4ge25hbWU6IFwiPlwiLCB0eXBlOiBGdW5jdGlvblR5cGVzLkZJTFRFUiwgYXR0cmlidXRlOiBcImhlaWdodFwiLCBmaWVsZHM6IGZpbHRlckZpZWxkcywgcHJvamVjdDogZmFsc2V9O1xuICAgIGNhc2UgXCJzaG9ydGVyXCI6XG4gICAgICByZXR1cm4ge25hbWU6IFwiPFwiLCB0eXBlOiBGdW5jdGlvblR5cGVzLkZJTFRFUiwgYXR0cmlidXRlOiBcImxlbmd0aFwiLCBmaWVsZHM6IGZpbHRlckZpZWxkcywgcHJvamVjdDogZmFsc2V9O1xuICAgIGNhc2UgXCJsb25nZXJcIjpcbiAgICAgIHJldHVybiB7bmFtZTogXCI+XCIsIHR5cGU6IEZ1bmN0aW9uVHlwZXMuRklMVEVSLCBhdHRyaWJ1dGU6IFwibGVuZ3RoXCIsIGZpZWxkczogZmlsdGVyRmllbGRzLCBwcm9qZWN0OiBmYWxzZX07XG4gICAgY2FzZSBcInlvdW5nZXJcIjpcbiAgICAgIHJldHVybiB7bmFtZTogXCI8XCIsIHR5cGU6IEZ1bmN0aW9uVHlwZXMuRklMVEVSLCBhdHRyaWJ1dGU6IFwiYWdlXCIsIGZpZWxkczogZmlsdGVyRmllbGRzLCBwcm9qZWN0OiBmYWxzZX07XG4gICAgY2FzZSBcIiZcIjpcbiAgICBjYXNlIFwiYW5kXCI6XG4gICAgICByZXR1cm4ge25hbWU6IFwiYW5kXCIsIHR5cGU6IEZ1bmN0aW9uVHlwZXMuQk9PTEVBTiwgZmllbGRzOiBbXSwgcHJvamVjdDogZmFsc2V9O1xuICAgIGNhc2UgXCJvclwiOlxuICAgICAgcmV0dXJuIHtuYW1lOiBcIm9yXCIsIHR5cGU6IEZ1bmN0aW9uVHlwZXMuQk9PTEVBTiwgZmllbGRzOiBbXSwgcHJvamVjdDogZmFsc2V9O1xuICAgIGNhc2UgXCJ0b3RhbFwiOlxuICAgIGNhc2UgXCJzdW1cIjpcbiAgICAgIHJldHVybiB7bmFtZTogXCJzdW1cIiwgdHlwZTogRnVuY3Rpb25UeXBlcy5BR0dSRUdBVEUsIGZpZWxkczogW3tuYW1lOiBcInN1bVwiLCB0eXBlczogW1Byb3BlcnRpZXMuT1VUUFVUXX0sIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtuYW1lOiBcInZhbHVlXCIsIHR5cGVzOiBbUHJvcGVydGllcy5BVFRSSUJVVEVdfV0sIHByb2plY3Q6IHRydWUsIHByb2plY3RlZEFzOiBcInN1bVwifTtcbiAgICBjYXNlIFwiY291bnRcIjpcbiAgICBjYXNlIFwibnVtYmVyIG9mXCI6XG4gICAgY2FzZSBcImNvdW50IHRoZSBudW1iZXIgb2ZcIjpcbiAgICBjYXNlIFwiY291bnQgbnVtYmVyIG9mXCI6XG4gICAgY2FzZSBcImhvdyBtYW55XCI6XG4gICAgICByZXR1cm4ge25hbWU6IFwiY291bnRcIiwgdHlwZTogRnVuY3Rpb25UeXBlcy5BR0dSRUdBVEUsIGZpZWxkczogW3tuYW1lOiBcImNvdW50XCIsIHR5cGVzOiBbUHJvcGVydGllcy5PVVRQVVRdfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtuYW1lOiBcInJvb3RcIiwgdHlwZXM6IGFsbH1dLCBwcm9qZWN0OiB0cnVlLCBwcm9qZWN0ZWRBczogXCJjb3VudFwifTtcblxuICAgIGNhc2UgXCJhdmVyYWdlXCI6XG4gICAgY2FzZSBcImF2Z1wiOlxuICAgIGNhc2UgXCJtZWFuXCI6XG4gICAgICByZXR1cm4ge25hbWU6IFwiYXZlcmFnZVwiLCB0eXBlOiBGdW5jdGlvblR5cGVzLkFHR1JFR0FURSwgZmllbGRzOiBbe25hbWU6IFwiYXZlcmFnZVwiLCB0eXBlczogW1Byb3BlcnRpZXMuT1VUUFVUXX0sIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7bmFtZTogXCJ2YWx1ZVwiLCB0eXBlczogW1Byb3BlcnRpZXMuQVRUUklCVVRFXX1dLCBwcm9qZWN0OiB0cnVlLCBwcm9qZWN0ZWRBczogXCJhdmVyYWdlXCJ9O1xuICAgIGNhc2UgXCJwbHVzXCI6XG4gICAgY2FzZSBcImFkZFwiOlxuICAgIGNhc2UgXCIrXCI6XG4gICAgICByZXR1cm4ge25hbWU6IFwiK1wiLCB0eXBlOiBGdW5jdGlvblR5cGVzLkNBTENVTEFURSwgZmllbGRzOiBjYWxjdWxhdGVGaWVsZHMsIHByb2plY3Q6IHRydWUsIHByb2plY3RlZEFzOiBcIitcIn07XG4gICAgY2FzZSBcInN1YnRyYWN0XCI6XG4gICAgY2FzZSBcIm1pbnVzXCI6XG4gICAgY2FzZSBcIi1cIjpcbiAgICAgIHJldHVybiB7bmFtZTogXCItXCIsIHR5cGU6IEZ1bmN0aW9uVHlwZXMuQ0FMQ1VMQVRFLCBmaWVsZHM6IGNhbGN1bGF0ZUZpZWxkcywgcHJvamVjdDogdHJ1ZSwgcHJvamVjdGVkQXM6IFwiLVwifTtcbiAgICBjYXNlIFwidGltZXNcIjpcbiAgICBjYXNlIFwibXVsdGlwbHlcIjpcbiAgICBjYXNlIFwibXVsdGlwbGllZFwiOlxuICAgIGNhc2UgXCJtdWx0aXBsaWVkIGJ5XCI6XG4gICAgY2FzZSBcIipcIjpcbiAgICAgIHJldHVybiB7bmFtZTogXCIqXCIsIHR5cGU6IEZ1bmN0aW9uVHlwZXMuQ0FMQ1VMQVRFLCBmaWVsZHM6IGNhbGN1bGF0ZUZpZWxkcywgcHJvamVjdDogdHJ1ZSwgcHJvamVjdGVkQXM6IFwiKlwifTtcbiAgICBjYXNlIFwiZGl2aWRlXCI6XG4gICAgY2FzZSBcImRpdmlkZWRcIjpcbiAgICBjYXNlIFwiZGl2aWRlZCBieVwiOlxuICAgIGNhc2UgXCIvXCI6XG4gICAgICByZXR1cm4ge25hbWU6IFwiL1wiLCB0eXBlOiBGdW5jdGlvblR5cGVzLkNBTENVTEFURSwgZmllbGRzOiBjYWxjdWxhdGVGaWVsZHMsIHByb2plY3Q6IHRydWUsIHByb2plY3RlZEFzOiBcIi9cIn07XG4gICAgY2FzZSBcIl5cIjpcbiAgICAgIHJldHVybiB7bmFtZTogXCJeXCIsIHR5cGU6IEZ1bmN0aW9uVHlwZXMuQ0FMQ1VMQVRFLCBmaWVsZHM6IGNhbGN1bGF0ZUZpZWxkcywgcHJvamVjdDogdHJ1ZSwgcHJvamVjdGVkQXM6IFwiXlwifTtcbiAgICBjYXNlIFwiaXNcIjpcbiAgICBjYXNlIFwiaXMgYVwiOlxuICAgIGNhc2UgXCJpcyBhblwiOlxuICAgICAgcmV0dXJuIHtuYW1lOiBcImluc2VydFwiLCB0eXBlOiBGdW5jdGlvblR5cGVzLklOU0VSVCwgZmllbGRzOiBbe25hbWU6IFwiZW50aXR5XCIsIHR5cGVzOiBbUHJvcGVydGllcy5FTlRJVFldfSwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge25hbWU6IFwiYXR0cmlidXRlXCIsIHR5cGVzOiBbUHJvcGVydGllcy5BVFRSSUJVVEVdfSwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge25hbWU6IFwicm9vdFwiLCB0eXBlczogYWxsfV0sIHByb2plY3Q6IGZhbHNlfTtcbiAgICAvKmNhc2UgXCJhcmVcIjpcbiAgICAgIHJldHVybiB7bmFtZTogXCJpbnNlcnRcIiwgdHlwZTogRnVuY3Rpb25UeXBlcy5JTlNFUlQsIGZpZWxkczogW3tuYW1lOiBcImNvbGxlY3Rpb25cIiwgdHlwZXM6IFtQcm9wZXJ0aWVzLkNPTExFQ1RJT05dfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7bmFtZTogXCJjb2xsZWN0aW9uXCIsIHR5cGVzOiBbUHJvcGVydGllcy5DT0xMRUNUSU9OXX1dLCBwcm9qZWN0OiBmYWxzZX07Ki8gXG4gICAgY2FzZSBcImhpc1wiOlxuICAgIGNhc2UgXCJoZXJzXCI6XG4gICAgY2FzZSBcInRoZWlyXCI6XG4gICAgY2FzZSBcIml0c1wiOlxuICAgIGNhc2UgXCInc1wiOlxuICAgIGNhc2UgXCInXCI6XG4gICAgICByZXR1cm4ge25hbWU6IFwic2VsZWN0XCIsIHR5cGU6IEZ1bmN0aW9uVHlwZXMuU0VMRUNULCBmaWVsZHM6IFt7bmFtZTogXCJzdWJqZWN0XCIsIHR5cGVzOiBbUHJvcGVydGllcy5FTlRJVFksIFByb3BlcnRpZXMuQ09MTEVDVElPTiwgUHJvcGVydGllcy5BVFRSSUJVVEVdfV0sIHByb2plY3Q6IGZhbHNlfTsgXG4gICAgY2FzZSBcImJ5XCI6XG4gICAgY2FzZSBcImdyb3VwZWQgYnlcIjpcbiAgICBjYXNlIFwicGVyXCI6XG4gICAgICByZXR1cm4ge25hbWU6IFwiZ3JvdXBcIiwgdHlwZTogRnVuY3Rpb25UeXBlcy5HUk9VUCwgZmllbGRzOiBbe25hbWU6IFwicm9vdFwiLCB0eXBlczogYWxsfSwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtuYW1lOiBcImNvbGxlY3Rpb25cIiwgdHlwZXM6IFtQcm9wZXJ0aWVzLkNPTExFQ1RJT04sIFByb3BlcnRpZXMuQVRUUklCVVRFXX1dLCBwcm9qZWN0OiBmYWxzZX07XG4gICAgY2FzZSBcImV4Y2VwdFwiOlxuICAgIGNhc2UgXCJ3aXRob3V0XCI6XG4gICAgY2FzZSBcIm5vdFwiOlxuICAgIGNhc2UgXCJhcmVuJ3RcIjpcbiAgICAgIHJldHVybiB7bmFtZTogXCJuZWdhdGVcIiwgdHlwZTogRnVuY3Rpb25UeXBlcy5ORUdBVEUsIGZpZWxkczogW3tuYW1lOiBcIm5lZ2F0ZWRcIiwgdHlwZXM6IENGQX1dLCBwcm9qZWN0OiBmYWxzZX07XG4gICAgZGVmYXVsdDpcbiAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH0gIFxufVxuXG5mdW5jdGlvbiBmaW5kRnVuY3Rpb24obm9kZTogTm9kZSwgY29udGV4dDogQ29udGV4dCk6IGJvb2xlYW4ge1xuICBsb2coYFNlYXJjaGluZyBmb3IgZnVuY3Rpb246ICR7bm9kZS5uYW1lfWApO1xuICBsZXQgZnhuID0gc3RyaW5nVG9GdW5jdGlvbihub2RlLm5hbWUpOyBcbiAgaWYgKGZ4biA9PT0gdW5kZWZpbmVkKSB7ICBcbiAgICBsb2coYCBOb3QgRm91bmQ6ICR7bm9kZS5uYW1lfWApO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICBcbiAgLy8gSW5zZXJ0IGZ1bmN0aW9uIG5lZWRzIHRvIGZvbGxvdyBhIHBvc3Nlc3NpdmUgZnVuY3Rpb25cbiAgaWYgKGZ4bi50eXBlID09PSBGdW5jdGlvblR5cGVzLklOU0VSVCAmJiAhY29udGV4dC5mb3VuZC5zb21lKChuKSA9PiBuLmhhc1Byb3BlcnR5KFByb3BlcnRpZXMuUE9TU0VTU0lWRSkpKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIFxuICBsb2coYCBGb3VuZDogJHtmeG4ubmFtZX1gKTtcbiAgbm9kZS5meG4gPSBmeG47XG4gIGZ4bi5ub2RlID0gbm9kZTtcbiAgLy8gQWRkIGFyZ3VtZW50cyB0byB0aGUgbm9kZVxuICBsZXQgYXJncyA9IGZ4bi5maWVsZHMubWFwKChmaWVsZCwgaSkgPT4ge1xuICAgIGxldCBhcmdUb2tlbiA9IG5ld1Rva2VuKGZpZWxkLm5hbWUpO1xuICAgIGxldCBhcmdOb2RlID0gbmV3Tm9kZShhcmdUb2tlbik7XG4gICAgYXJnTm9kZS5wcm9wZXJ0aWVzLnB1c2goUHJvcGVydGllcy5BUkdVTUVOVCk7XG4gICAgaWYgKGZ4bi5wcm9qZWN0ICYmIGkgPT09IDApIHtcbiAgICAgIGFyZ05vZGUucHJvcGVydGllcy5wdXNoKFByb3BlcnRpZXMuT1VUUFVUKTtcbiAgICAgIGFyZ05vZGUuZm91bmQgPSB0cnVlO1xuICAgICAgbGV0IG91dHB1dFRva2VuID0gbmV3VG9rZW4oXCJvdXRwdXRcIitjb250ZXh0LmZ4bnMubGVuZ3RoKTtcbiAgICAgIGxldCBvdXRwdXROb2RlID0gbmV3Tm9kZShvdXRwdXRUb2tlbik7XG4gICAgICBsZXQgb3V0cHV0QXR0cmlidXRlID0ge1xuICAgICAgICBpZDogb3V0cHV0Tm9kZS5uYW1lLFxuICAgICAgICBkaXNwbGF5TmFtZTogb3V0cHV0Tm9kZS5uYW1lLFxuICAgICAgICB2YXJpYWJsZTogb3V0cHV0Tm9kZS5uYW1lLFxuICAgICAgICBub2RlOiBvdXRwdXROb2RlLFxuICAgICAgICBwcm9qZWN0OiBmYWxzZSxcbiAgICAgIH1cbiAgICAgIG91dHB1dE5vZGUuYXR0cmlidXRlID0gb3V0cHV0QXR0cmlidXRlO1xuICAgICAgb3V0cHV0Tm9kZS5wcm9wZXJ0aWVzLnB1c2goUHJvcGVydGllcy5PVVRQVVQpO1xuICAgICAgb3V0cHV0Tm9kZS5mb3VuZCA9IHRydWU7XG4gICAgICBhcmdOb2RlLmFkZENoaWxkKG91dHB1dE5vZGUpOyAgICAgICAgICBcbiAgICB9IGVsc2Uge1xuICAgICAgYXJnTm9kZS5wcm9wZXJ0aWVzLnB1c2goUHJvcGVydGllcy5JTlBVVCk7XG4gICAgfVxuICAgIGFyZ05vZGUucHJvcGVydGllcyA9IGFyZ05vZGUucHJvcGVydGllcy5jb25jYXQoZmllbGQudHlwZXMpO1xuICAgIGNvbnRleHQuYXJndW1lbnRzLnB1c2goYXJnTm9kZSk7XG4gICAgcmV0dXJuIGFyZ05vZGU7XG4gIH0pO1xuICBub2RlLnByb3BlcnRpZXMucHVzaChQcm9wZXJ0aWVzLkZVTkNUSU9OKTtcbiAgZm9yIChsZXQgYXJnIG9mIGFyZ3MpIHtcbiAgICBub2RlLmFkZENoaWxkKGFyZyk7XG4gIH1cbiAgbm9kZS5mb3VuZCA9IHRydWU7XG4gIG5vZGUudHlwZSA9IE5vZGVUeXBlcy5GVU5DVElPTjtcbiAgaWYgKG5vZGUuZnhuLnR5cGUgPT09IEZ1bmN0aW9uVHlwZXMuQUdHUkVHQVRFIHx8IFxuICAgICAgbm9kZS5meG4udHlwZSA9PT0gRnVuY3Rpb25UeXBlcy5DQUxDVUxBVEUgfHxcbiAgICAgIG5vZGUuZnhuLnR5cGUgPT09IEZ1bmN0aW9uVHlwZXMuRklMVEVSKSB7XG4gICAgY29udGV4dC5meG5zLnB1c2gobm9kZSk7ICAgICAgXG4gIH1cbiAgY29udGV4dC5pbnRlcm5hbEZ4bnMucHVzaChub2RlKTtcbiAgcmV0dXJuIHRydWU7XG59XG5cbmZ1bmN0aW9uIGZvcm1UcmVlKG5vZGU6IE5vZGUsIHRyZWU6IE5vZGUsIGNvbnRleHQ6IENvbnRleHQpOiB7dHJlZTogTm9kZSwgY29udGV4dDogQ29udGV4dH0ge1xuICBsb2coXCItLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVwiKTtcbiAgbG9nKG5vZGUudG9TdHJpbmcoKSk7XG4gIGxvZyhjb250ZXh0KTtcbiAgaWYgKGNvbnRleHQubm9kZXMuaW5kZXhPZihub2RlKSA9PT0gLTEpIHtcbiAgICBjb250ZXh0Lm5vZGVzLnB1c2gobm9kZSk7XG4gIH1cbiAgLy8gRG9uJ3QgZG8gYW55dGhpbmcgd2l0aCBzdWJzdW1lZCBub2Rlc1xuICBpZiAobm9kZS5oYXNQcm9wZXJ0eShQcm9wZXJ0aWVzLlNVQlNVTUVEKSkge1xuICAgIGxvZyhcIlNraXBwaW5nLi4uXCIpO1xuICAgIHJldHVybiB7dHJlZTogdHJlZSwgY29udGV4dDogY29udGV4dH07XG4gIH1cbiAgXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy8gU3RlcCAxOiBCdWlsZCBuLWdyYW1zXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgbG9nKFwibmdyYW1zOlwiKTtcbiAgXG4gIC8vIEZsYXR0ZW4gdGhlIHRyZWVcbiAgbGV0IG5leHROb2RlID0gdHJlZTtcbiAgbGV0IG5vZGVzOiBBcnJheTxOb2RlPiA9IFtdO1xuICB3aGlsZShuZXh0Tm9kZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgbm9kZXMucHVzaChuZXh0Tm9kZSk7XG4gICAgbmV4dE5vZGUgPSBuZXh0Tm9kZS5uZXh0KCk7XG4gIH1cbiAgXG4gIC8vIEJ1aWxkIG5ncmFtc1xuICAvLyBJbml0aWFsaXplIHRoZSBuZ3JhbXMgd2l0aCAxLWdyYW1zXG4gIGxldCBuZ3JhbXM6IEFycmF5PEFycmF5PE5vZGU+PiA9IG5vZGVzLm1hcCgobm9kZSkgPT4gW25vZGVdKTtcbiAgLy8gU2hpZnQgb2ZmIHRoZSByb290IG5vZGVcbiAgbmdyYW1zLnNoaWZ0KCk7XG4gIGxldCBuID0gNDtcbiAgbGV0IG0gPSBuZ3JhbXMubGVuZ3RoO1xuICBsZXQgb2Zmc2V0ID0gMDtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBuIC0gMTsgaSsrKSB7XG4gICAgbGV0IG5ld05ncmFtczogQXJyYXk8QXJyYXk8Tm9kZT4+ID0gW107XG4gICAgZm9yIChsZXQgaiA9IG9mZnNldDsgaiA8IG5ncmFtcy5sZW5ndGg7IGorKykge1xuICAgICAgbGV0IHRoaXNOZ3JhbSA9IG5ncmFtc1tqXTtcbiAgICAgIGxldCBuZXh0TmdyYW0gPSBuZ3JhbXNbaiArIDFdO1xuICAgICAgLy8gQnJlYWsgYXQgdGhlIGVuZCBvZiB0aGUgbmdyYW1zXG4gICAgICBpZiAobmV4dE5ncmFtID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICAvLyBGcm9tIHRoZSBuZXcgbmdyYW1cbiAgICAgIGxldCBuZXdOZ3JhbSA9IHRoaXNOZ3JhbS5jb25jYXQoW25leHROZ3JhbVtuZXh0TmdyYW0ubGVuZ3RoLTFdXSk7XG4gICAgICBuZXdOZ3JhbXMucHVzaChuZXdOZ3JhbSk7XG4gICAgfVxuICAgIG9mZnNldCA9IG5ncmFtcy5sZW5ndGg7XG4gICAgbmdyYW1zID0gbmdyYW1zLmNvbmNhdChuZXdOZ3JhbXMpO1xuICB9XG4gIFxuICAvLyBDaGVjayBlYWNoIG5ncmFtIGZvciBhIGRpc3BsYXkgbmFtZVxuICBsZXQgbWF0Y2hlZE5ncmFtczogQXJyYXk8QXJyYXk8Tm9kZT4+ID0gW107XG4gIGZvciAobGV0IGkgPSBuZ3JhbXMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICBsZXQgbmdyYW0gPSBuZ3JhbXNbaV07ICAgIFxuICAgIGxldCBhbGxGb3VuZCA9IG5ncmFtLmV2ZXJ5KChub2RlKSA9PiBub2RlLmZvdW5kKTtcbiAgICBpZiAoYWxsRm91bmQgIT09IHRydWUpIHtcbiAgICAgIGxldCBkaXNwbGF5TmFtZSA9IG5ncmFtLm1hcCgobm9kZSk9Pm5vZGUubmFtZSkuam9pbihcIiBcIikucmVwbGFjZSgvICcvZywnXFwnJyk7XG4gICAgICBsb2coZGlzcGxheU5hbWUpXG4gICAgICBsZXQgZm91bmROYW1lID0gZXZlLmZpbmRPbmUoXCJpbmRleCBuYW1lXCIseyBuYW1lOiBkaXNwbGF5TmFtZSB9KTtcbiAgICAgIC8vIElmIHRoZSBkaXNwbGF5IG5hbWUgaXMgaW4gdGhlIHN5c3RlbSwgbWFyayBhbGwgdGhlIG5vZGVzIGFzIGZvdW5kIFxuICAgICAgaWYgKGZvdW5kTmFtZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIG5ncmFtLm1hcCgobm9kZSkgPT4gbm9kZS5mb3VuZCA9IHRydWUpO1xuICAgICAgICBtYXRjaGVkTmdyYW1zLnB1c2gobmdyYW0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbGV0IGZvdW5kQXR0cmlidXRlID0gZXZlLmZpbmRPbmUoXCJlbnRpdHkgZWF2c1wiLCB7IGF0dHJpYnV0ZTogZGlzcGxheU5hbWUgfSk7XG4gICAgICAgIGlmIChmb3VuZEF0dHJpYnV0ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgbmdyYW0ubWFwKChub2RlKSA9PiBub2RlLmZvdW5kID0gdHJ1ZSk7XG4gICAgICAgICAgbWF0Y2hlZE5ncmFtcy5wdXNoKG5ncmFtKTsgIFxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGxldCBmeG4gPSBzdHJpbmdUb0Z1bmN0aW9uKGRpc3BsYXlOYW1lKTtcbiAgICAgICAgICBpZiAoZnhuICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIG5ncmFtLm1hcCgobm9kZSkgPT4gbm9kZS5mb3VuZCA9IHRydWUpO1xuICAgICAgICAgICAgLy8gXCJlbmdpbmVlcnMgYXJlIGVtcGxveWVlc1wiIGFzc2VydHMgdGhhdCBldmVyeSBlbmdpbmVlciBpcyBhbHNvIGFuIGVtcGxveWVlXG4gICAgICAgICAgICAvLyBcImVuZ2luZWVycyB0aGF0IGFyZSBlbXBsb3llZXNcIiBpcyBhc2tpbmcgZm9yIHRoZSBpbnRlcnNlY3Rpb24gb2YgZW5naW5lZXJzIGFuZCBlbXBsb3llZXNcbiAgICAgICAgICAgIC8vIFwidGhhdFwiIGlzIGEgZGV0ZXJtaW5lciwgd2hpY2ggY25hZ2VzIHRoZSBtZWFuaW5nIG9mIHRoZSBzZW50ZW5jZSwgc28gd2UgcHJldmVudCBcbiAgICAgICAgICAgIC8vIGFuIGluc2VydCB1c2luZyB0aGlzIGhldXJpc3RpYyBcbiAgICAgICAgICAgIGlmIChmeG4udHlwZSA9PT0gRnVuY3Rpb25UeXBlcy5JTlNFUlQgJiYgXG4gICAgICAgICAgICAgICAgKG5ncmFtWzBdLnByZXYoKS50b2tlbi5QT1MgPT09IE1pbm9yUGFydHNPZlNwZWVjaC5EVCB8fCBcbiAgICAgICAgICAgICAgICAgZ2V0TWFqb3JQT1MobmdyYW1bMF0ucHJldigpLnRva2VuLlBPUykgPT09IE1ham9yUGFydHNPZlNwZWVjaC5XSFdPUkQpKSB7XG4gICAgICAgICAgICAgIHJldHVybiB7dHJlZTogdHJlZSwgY29udGV4dDogY29udGV4dH07XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBtYXRjaGVkTmdyYW1zLnB1c2gobmdyYW0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuICBcbiAgLy8gVHVybiBtYXRjaGVkIG5ncmFtcyBpbnRvIGNvbXBvdW5kIG5vZGVzICBcbiAgZm9yIChsZXQgbmdyYW0gb2YgbWF0Y2hlZE5ncmFtcykge1xuICAgIC8vIERvbid0IGRvIGFueXRoaW5nIGZvciAxLWdyYW1zXG4gICAgaWYgKG5ncmFtLmxlbmd0aCA9PT0gMSkge1xuICAgICAgbmdyYW1bMF0uZm91bmQgPSBmYWxzZTtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cbiAgICBsZXQgZGlzcGxheU5hbWUgPSBuZ3JhbS5tYXAoKG5vZGUpPT5ub2RlLm5hbWUpLmpvaW4oXCIgXCIpLnJlcGxhY2UoLyAnL2csJ1xcJycpO1xuICAgIGxvZyAoYENyZWF0aW5nIGNvbXBvdW5kIG5vZGU6ICR7ZGlzcGxheU5hbWV9YCk7XG4gICAgbGV0IGxhc3RHcmFtID0gbmdyYW1bbmdyYW0ubGVuZ3RoIC0gMV07XG4gICAgbGV0IGNvbXBvdW5kVG9rZW4gPSBuZXdUb2tlbihkaXNwbGF5TmFtZSk7XG4gICAgY29tcG91bmRUb2tlbi5wcmV2ID0gbmdyYW1bMF0udG9rZW4ucHJldjtcbiAgICBsZXQgY29tcG91bmROb2RlID0gbmV3Tm9kZShjb21wb3VuZFRva2VuKTtcbiAgICBjb21wb3VuZE5vZGUuY29uc3RpdHVlbnRzID0gbmdyYW07XG4gICAgY29tcG91bmROb2RlLmNvbnN0aXR1ZW50cy5tYXAoKG5vZGUpID0+IG5vZGUucHJvcGVydGllcy5wdXNoKFByb3BlcnRpZXMuU1VCU1VNRUQpKTtcbiAgICBjb21wb3VuZE5vZGUuaXggPSBsYXN0R3JhbS5peDtcbiAgICAvLyBJbmhlcml0IHByb3BlcnRpZXMgZnJvbSB0aGUgbm9kZXNcbiAgICBjb21wb3VuZE5vZGUucHJvcGVydGllcyA9IGxhc3RHcmFtLnByb3BlcnRpZXM7ICAgIFxuICAgIGNvbXBvdW5kTm9kZS5wcm9wZXJ0aWVzLnB1c2goUHJvcGVydGllcy5DT01QT1VORCk7XG4gICAgY29tcG91bmROb2RlLnByb3BlcnRpZXMuc3BsaWNlKGNvbXBvdW5kTm9kZS5wcm9wZXJ0aWVzLmluZGV4T2YoUHJvcGVydGllcy5TVUJTVU1FRCksMSk7IC8vIERvbid0IGluaGVyaXQgc3Vic3VtZWQgcHJvcGVydHlcbiAgICAvLyBUaGUgY29tcG91bmQgbm9kZSByZXN1bHRzIGZyb20gdGhlIG5ldyBub2RlLFxuICAgIC8vIHNvIHRoZSBjb21wb3VuZCBub2RlIHJlcGxhY2VzIGl0XG4gICAgbm9kZSA9IGNvbXBvdW5kTm9kZTtcbiAgfVxuICBsb2coJy0tLS0tLS0nKTtcblxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vIFN0ZXAgMjogSWRlbnRpZnkgdGhlIG5vZGVcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICBcbiAgLy8gSWYgdGhlIG5vZGUgaXMgYSBxdWFudGl0eSwganVzdCBidWlsZCBhbiBhdHRyaWJ1dGVcbiAgaWYgKG5vZGUuaGFzUHJvcGVydHkoUHJvcGVydGllcy5RVUFOVElUWSkpIHtcbiAgICBsZXQgcXVhbnRpdHlBdHRyaWJ1dGU6IEF0dHJpYnV0ZSA9IHtcbiAgICAgIGlkOiBub2RlLm5hbWUsXG4gICAgICBkaXNwbGF5TmFtZTogbm9kZS5uYW1lLFxuICAgICAgdmFyaWFibGU6IG5vZGUubmFtZSxcbiAgICAgIG5vZGU6IG5vZGUsXG4gICAgICBwcm9qZWN0OiBmYWxzZSxcbiAgICAgIGhhbmRsZWQ6IHRydWUsXG4gICAgfVxuICAgIG5vZGUucXVhbnRpdHkgPSBwYXJzZUZsb2F0KG5vZGUubmFtZSk7XG4gICAgbm9kZS5wcm9wZXJ0aWVzLnB1c2goUHJvcGVydGllcy5BVFRSSUJVVEUpO1xuICAgIG5vZGUudHlwZSA9IE5vZGVUeXBlcy5OVU1CRVI7XG4gICAgbm9kZS5hdHRyaWJ1dGUgPSBxdWFudGl0eUF0dHJpYnV0ZTtcbiAgICBub2RlLmZvdW5kID0gdHJ1ZTtcbiAgfVxuICBcbiAgLy8gRmluZCBhIGNvbGxlY3Rpb24sIGVudGl0eSwgYXR0cmlidXRlLCBvciBmdW5jdGlvblxuICBpZiAoIW5vZGUuZm91bmQpIHtcbiAgICBmaW5kQ29sbGVjdGlvbihub2RlLCBjb250ZXh0KTtcbiAgICBpZiAoIW5vZGUuZm91bmQpIHtcbiAgICAgIGZpbmRBdHRyaWJ1dGUobm9kZSwgY29udGV4dCk7IFxuICAgICAgaWYgKCFub2RlLmZvdW5kKSB7XG4gICAgICAgIGZpbmRFbnRpdHkobm9kZSwgY29udGV4dCk7XG4gICAgICAgIGlmICghbm9kZS5mb3VuZCkge1xuICAgICAgICAgIGZpbmRGdW5jdGlvbihub2RlLCBjb250ZXh0KTsgIFxuICAgICAgICAgIGlmICghbm9kZS5mb3VuZCkge1xuICAgICAgICAgICAgbG9nKG5vZGUubmFtZSArIFwiIHdhcyBub3QgZm91bmQgYW55d2hlcmUhXCIpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuICBcbiAgLy8gSWYgdGhlIG5vZGUgd2Fzbid0IGZvdW5kIGF0IGFsbCwgZG9uJ3QgdHJ5IHRvIHBsYWNlIGl0IGFueXdoZXJlXG4gIGlmICghbm9kZS5mb3VuZCAmJiBjb250ZXh0LnN0YXRlRmxhZ3MuaW5zZXJ0ID09PSBmYWxzZSkge1xuICAgIGlmIChnZXRNYWpvclBPUyhub2RlLnRva2VuLlBPUykgPT09IE1ham9yUGFydHNPZlNwZWVjaC5OT1VOKSB7XG4gICAgICBpZiAobm9kZS5oYXNQcm9wZXJ0eShQcm9wZXJ0aWVzLlBST1BFUikpIHtcbiAgICAgICAgY29udGV4dC5tYXliZUVudGl0aWVzLnB1c2gobm9kZSk7XG4gICAgICB9IGVsc2UgaWYgKG5vZGUuaGFzUHJvcGVydHkoUHJvcGVydGllcy5QTFVSQUwpKSB7XG4gICAgICAgIGNvbnRleHQubWF5YmVDb2xsZWN0aW9ucy5wdXNoKG5vZGUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29udGV4dC5tYXliZUF0dHJpYnV0ZXMucHVzaChub2RlKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHt0cmVlOiB0cmVlLCBjb250ZXh0OiBjb250ZXh0fTtcbiAgfSBlbHNlIGlmICghbm9kZS5mb3VuZCAmJiBjb250ZXh0LnN0YXRlRmxhZ3MuaW5zZXJ0ID09PSB0cnVlKSB7XG4gICAgbGV0IHJvb3QgPSBjb250ZXh0LmFyZ3VtZW50cy5maWx0ZXIoKGEpID0+IGEuaGFzUHJvcGVydHkoUHJvcGVydGllcy5ST09UKSkucG9wKCk7XG4gICAgaWYgKHJvb3QgIT09IHVuZGVmaW5lZCkge1xuICAgICAgbm9kZS5mb3VuZCA9IHRydWU7XG4gICAgICBhZGROb2RlVG9GdW5jdGlvbihub2RlLCByb290LnBhcmVudCwgY29udGV4dCk7XG4gICAgfVxuICAgIGNvbnRleHQubWF5YmVBdHRyaWJ1dGVzLnB1c2gobm9kZSk7XG4gICAgcmV0dXJuIHt0cmVlOiB0cmVlLCBjb250ZXh0OiBjb250ZXh0fTtcbiAgfSBlbHNlIGlmIChub2RlLmZvdW5kICYmICFub2RlLmZvdW5kUmVwcykge1xuICAgIGZpbmRBbHRlcm5hdGl2ZVJlcHJlc2VudGF0aW9ucyhub2RlKTtcbiAgfVxuICBcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvLyBTdGVwIDM6IEluc2VydCB0aGUgbm9kZSBpbnRvIHRoZSB0cmVlXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgXG4gIGxvZyhcIk1hdGNoaW5nOiBcIiArIG5vZGUubmFtZSk7XG4gICAgXG4gIC8vIElmIHRoZSBub2RlIGlzIGNvbXBvdW5kLCByZXBsYWNlIHRoZSBsYXN0IHN1YnN1bWVkIG5vZGUgd2l0aCBpdFxuICBpZiAobm9kZS5oYXNQcm9wZXJ0eShQcm9wZXJ0aWVzLkNPTVBPVU5EKSkge1xuICAgIGxldCBzdWJzdW1lZE5vZGUgPSBub2RlLmNvbnN0aXR1ZW50c1tub2RlLmNvbnN0aXR1ZW50cy5sZW5ndGggLSAyXTtcbiAgICBpZiAoc3Vic3VtZWROb2RlLnBhcmVudCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBsb2coYFJlcGxhY2luZyBcIiR7c3Vic3VtZWROb2RlLm5hbWV9XCIgd2l0aCBcIiR7bm9kZS5uYW1lfVwiYClcbiAgICAgIGluc2VydEJlZm9yZU5vZGUobm9kZSxzdWJzdW1lZE5vZGUpO1xuICAgICAgcmVtb3ZlQnJhbmNoKHN1YnN1bWVkTm9kZSk7XG4gICAgICBsZXQgY2hpbGRyZW4gPSBzdWJzdW1lZE5vZGUuY2hpbGRyZW47XG4gICAgICAvLyBSZWxpbnF1aXNoIGNoaWxkcmVuXG4gICAgICBmb3IgKGxldCBjaGlsZCBvZiBjaGlsZHJlbikge1xuICAgICAgICBpZiAoY2hpbGQuaGFzUHJvcGVydHkoUHJvcGVydGllcy5BUkdVTUVOVCkpIHtcbiAgICAgICAgICBmb3IgKGxldCBncmFuZENoaWxkIG9mIGNoaWxkLmNoaWxkcmVuKSB7XG4gICAgICAgICAgICByZW1vdmVCcmFuY2goZ3JhbmRDaGlsZCk7XG4gICAgICAgICAgICBmb3JtVHJlZShncmFuZENoaWxkLCB0cmVlLCBjb250ZXh0KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmVtb3ZlQnJhbmNoKGNoaWxkKTtcbiAgICAgICAgICBmb3JtVHJlZShjaGlsZCwgdHJlZSwgY29udGV4dCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIC8vIGZpbHRlciBjb250ZXh0XG4gICAgICBjb250ZXh0LmludGVybmFsRnhucyA9IGNvbnRleHQuaW50ZXJuYWxGeG5zLmZpbHRlcigoZikgPT4gIWYuaGFzUHJvcGVydHkoUHJvcGVydGllcy5TVUJTVU1FRCkpO1xuICAgICAgY29udGV4dC5hcmd1bWVudHMgPSBjb250ZXh0LmFyZ3VtZW50cy5maWx0ZXIoKGEpID0+ICFhLnBhcmVudC5oYXNQcm9wZXJ0eShQcm9wZXJ0aWVzLlNVQlNVTUVEKSk7XG4gICAgICByZXR1cm4ge3RyZWU6IHRyZWUsIGNvbnRleHQ6IGNvbnRleHR9OyAgXG4gICAgfVxuICB9XG4gIC8vIEhhbmRsZSBmdW5jdGlvbnNcbiAgaWYgKG5vZGUuaGFzUHJvcGVydHkoUHJvcGVydGllcy5GVU5DVElPTikpIHtcbiAgICAvLyBGaW5kIGFuIGFyZ3VtZW50IHRvIGF0dGFjaCB0aGUgbm9kZSB0b1xuICAgIGxldCBmdW5jdGlvbkFyZyA9IGNvbnRleHQuYXJndW1lbnRzLmZpbHRlcigobikgPT4gbi5oYXNQcm9wZXJ0eShQcm9wZXJ0aWVzLkZVTkNUSU9OKSAmJiBuLnBhcmVudCAhPT0gbm9kZSAmJiAhbi5mb3VuZCk7XG4gICAgaWYgKGZ1bmN0aW9uQXJnLmxlbmd0aCA+IDApIHtcbiAgICAgIGxldCBhcmcgPSBmdW5jdGlvbkFyZy5wb3AoKTtcbiAgICAgIGFkZE5vZGVUb0Z1bmN0aW9uKG5vZGUsIGFyZy5wYXJlbnQsIGNvbnRleHQpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0cmVlLmFkZENoaWxkKG5vZGUpOyAgXG4gICAgfVxuICAgIFxuICAgIC8vIElmIHRoZSBub2RlIGlzIGEgZ3JvdXBpbmcgbm9kZSwgYXR0YWNoIHRoZSBvbGQgcm9vdCB0byB0aGUgbmV3IG9uZVxuICAgIGlmIChub2RlLmZ4bi50eXBlID09PSBGdW5jdGlvblR5cGVzLkdST1VQKSB7XG4gICAgICBsZXQgbmV3Um9vdCA9IG5vZGUuY2hpbGRyZW5bMF07XG4gICAgICBmb3IgKGxldCBjaGlsZCBvZiB0cmVlLmNoaWxkcmVuKSB7XG4gICAgICAgIGlmIChjaGlsZCA9PT0gbm9kZSkge1xuICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJlcm9vdChjaGlsZCwgbmV3Um9vdCk7XG4gICAgICAgIH1cbiAgICAgICAgbmV3Um9vdC5mb3VuZCA9IHRydWU7XG4gICAgICB9XG4gICAgLy8gSWYgdGhlIG5vZGUgaXMgYW4gaW5zZXJ0LCBhdHRhY2ggdW5pZGVudGlmaWVkIHdvcmRzICBcbiAgICB9IGVsc2UgaWYgKG5vZGUuZnhuLnR5cGUgPT09IEZ1bmN0aW9uVHlwZXMuSU5TRVJUKSB7XG4gICAgICAvLyBGaW5kIGFuIGVudGl0eVxuICAgICAgbGV0IGVudGl0eSA9IGNvbnRleHQuZm91bmQuZmlsdGVyKChuKSA9PiBuLmhhc1Byb3BlcnR5KFByb3BlcnRpZXMuRU5USVRZKSAmJiBuLml4IDwgbm9kZS5peCkucG9wKCk7XG4gICAgICBpZiAoZW50aXR5ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgcmVtb3ZlTm9kZShlbnRpdHkpO1xuICAgICAgICBhZGROb2RlVG9GdW5jdGlvbihlbnRpdHksIG5vZGUsIGNvbnRleHQpOyAgXG4gICAgICAgIC8vIEZpbmQgYW4gYXR0cmlidXRlXG4gICAgICAgIGxldCBhdHRyaWJ1dGUgPSBjb250ZXh0LmZvdW5kLmZpbHRlcigobikgPT4gbi5oYXNQcm9wZXJ0eShQcm9wZXJ0aWVzLkFUVFJJQlVURSkgJiYgbi5peCA+IGVudGl0eS5peCkucG9wKCk7XG4gICAgICAgIGlmIChhdHRyaWJ1dGUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIHJlbW92ZU5vZGUoYXR0cmlidXRlKTtcbiAgICAgICAgICBhZGROb2RlVG9GdW5jdGlvbihhdHRyaWJ1dGUsIG5vZGUsIGNvbnRleHQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGxldCBhdHRyaWJ1dGVOb2RlcyA9IGNvbnRleHQubm9kZXMuZmlsdGVyKChtYSkgPT4gbWEuaXggPiBlbnRpdHkuaXggKyAxKTtcbiAgICAgICAgICBhdHRyaWJ1dGVOb2Rlcy5wb3AoKTtcbiAgICAgICAgICBpZiAoYXR0cmlidXRlTm9kZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgYXR0cmlidXRlTm9kZXMubWFwKHJlbW92ZU5vZGUpO1xuICAgICAgICAgICAgbGV0IG5OYW1lID0gYXR0cmlidXRlTm9kZXMubWFwKChtYSkgPT4gbWEubmFtZSkuam9pbihcIiBcIik7XG4gICAgICAgICAgICBsZXQgblRva2VuID0gbmV3VG9rZW4obk5hbWUpO1xuICAgICAgICAgICAgblRva2VuLml4ID0gYXR0cmlidXRlTm9kZXNbMF0uaXg7XG4gICAgICAgICAgICBsZXQgbk5vZGUgPSBuZXdOb2RlKG5Ub2tlbik7XG4gICAgICAgICAgICBuTm9kZS50eXBlID0gTm9kZVR5cGVzLlNUUklORzsgIFxuICAgICAgICAgICAgbk5vZGUuZm91bmQgPSB0cnVlO1xuICAgICAgICAgICAgbk5vZGUucHJvcGVydGllcy5wdXNoKFByb3BlcnRpZXMuQVRUUklCVVRFKTtcbiAgICAgICAgICAgIGFkZE5vZGVUb0Z1bmN0aW9uKG5Ob2RlLCBub2RlLCBjb250ZXh0KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0gIFxuICAgIC8vIElmIHRoZSBub2RlIGlzIGEgZmlsdGVyLCBhdHRhY2ggZmlsdGVyIG5vZGVzICBcbiAgICB9IGVsc2UgaWYgKG5vZGUuZnhuLnR5cGUgPT09IEZ1bmN0aW9uVHlwZXMuRklMVEVSKSB7XG4gICAgICAvLyBJZiBhbiBhdHRyaWJ1dGUgaXMgc3BlY2lmaWVkLCBjcmVhdGUgYW4gYXR0cmlidXRlIG5vZGUgZm9yIGVhY2ggb25lXG4gICAgICBpZiAobm9kZS5meG4uYXR0cmlidXRlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgLy8gTEhTXG4gICAgICAgIGxldCBuVG9rZW4gPSBuZXdUb2tlbihub2RlLmZ4bi5hdHRyaWJ1dGUpO1xuICAgICAgICBsZXQgbk5vZGUgPSBuZXdOb2RlKG5Ub2tlbik7XG4gICAgICAgIGZvcm1UcmVlKG5Ob2RlLCB0cmVlLCBjb250ZXh0KTtcbiAgICAgICAgLy8gUkhTXG4gICAgICAgIG5Ub2tlbiA9IG5ld1Rva2VuKG5vZGUuZnhuLmF0dHJpYnV0ZSk7XG4gICAgICAgIG5Ob2RlID0gbmV3Tm9kZShuVG9rZW4pO1xuICAgICAgICBmaW5kQXR0cmlidXRlKG5Ob2RlLCBjb250ZXh0KTtcbiAgICAgICAgYWRkTm9kZVRvRnVuY3Rpb24obk5vZGUsIG5vZGUsIGNvbnRleHQpO1xuICAgICAgLy8gTm8gYXR0cmlidXRlIGlzIHNwZWNpZmllZCwgdHJ5IHRvIGF0dGFjaCBleGlzdGluZyBhdHRyaWJ1dGVzXG4gICAgICB9IGVsc2Uge1xuICAgICAgIGxldCBvcnBoYW5zID0gY29udGV4dC5mb3VuZC5maWx0ZXIoKG4pID0+IG4uaGFzUHJvcGVydHkoUHJvcGVydGllcy5BVFRSSUJVVEUpKTtcbiAgICAgICBmb3IgKGxldCBvcnBoYW4gb2Ygb3JwaGFucykge1xuICAgICAgICAgIHJlbW92ZU5vZGUob3JwaGFuKTtcbiAgICAgICAgICBmb3JtVHJlZShvcnBoYW4sIHRyZWUsIGNvbnRleHQpO1xuICAgICAgICAgIC8vIEJyZWFrIHdoZW4gYWxsIGFyZ3MgYXJlIGZpbGxlZFxuICAgICAgICAgIGlmIChub2RlLmNoaWxkcmVuLmV2ZXJ5KChuKSA9PiBuLmZvdW5kKSkge1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuICAgICAgICB9IFxuICAgICAgfVxuICAgIC8vIElmIHRoZSBub2RlIGlzIGEgbmVnYXRlLCBkb24ndCBkbyBhIGJhY2sgc2VhcmNoXG4gICAgfSBlbHNlIGlmIChub2RlLmZ4bi50eXBlID09PSBGdW5jdGlvblR5cGVzLk5FR0FURSkge1xuICAgICAgLy8gVGhpcyBzcGFjZSBpcyBsZWZ0IGludGVudGlvbmFsbHkgYmxhbmtcbiAgICB9IGVsc2UgaWYgKG5vZGUuZnhuLnR5cGUgPT09IEZ1bmN0aW9uVHlwZXMuQ0FMQ1VMQVRFKSB7XG4gICAgICBsZXQgQVFGcyA9IGNvbnRleHQubm9kZXMuZmlsdGVyKChuKSA9PiBuLmhhc1Byb3BlcnR5KFByb3BlcnRpZXMuQVRUUklCVVRFKSB8fCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG4uaGFzUHJvcGVydHkoUHJvcGVydGllcy5RVUFOVElUWSkgfHwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuLmhhc1Byb3BlcnR5KFByb3BlcnRpZXMuRlVOQ1RJT04pKTtcbiAgICAgIGZvciAobGV0IGFxZiBvZiBBUUZzICkge1xuICAgICAgICBpZiAoYXFmLnBhcmVudCAhPT0gdW5kZWZpbmVkICYmIGFxZi5wYXJlbnQuaGFzUHJvcGVydHkoUHJvcGVydGllcy5BUkdVTUVOVCkpIHtcbiAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoYXFmLmhhc1Byb3BlcnR5KFByb3BlcnRpZXMuRlVOQ1RJT04pKSB7XG4gICAgICAgICAgaWYgKGFxZi5meG4udHlwZSA9PT0gRnVuY3Rpb25UeXBlcy5BR0dSRUdBVEUpIHtcbiAgICAgICAgICAgIHJlbW92ZUJyYW5jaChhcWYpOyAgIFxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmVtb3ZlTm9kZShhcWYpICBcbiAgICAgICAgfVxuICAgICAgICBmb3JtVHJlZShhcWYsIHRyZWUsIGNvbnRleHQpO1xuICAgICAgICBpZiAobm9kZS5jaGlsZHJlbi5ldmVyeSgobikgPT4gbi5mb3VuZCkpIHtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfVxuICAgIC8vIE90aGVyd2lzZSwganVzdCBhdHRhY2ggYXJndW1lbnRzIHRoYXQgYXJlIGFwcGxpY2FibGVcbiAgICB9IGVsc2UgeyAgXG4gICAgICBpZiAobm9kZS5meG4uZmllbGRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgZm9yIChsZXQgaSA9IGNvbnRleHQuZm91bmQubGVuZ3RoIC0xOyBpID49IDA7IGktLSkge1xuICAgICAgICAgIGxldCBmb3VuZE5vZGUgPSBjb250ZXh0LmZvdW5kW2ldOyBcbiAgICAgICAgICByZW1vdmVOb2RlKGZvdW5kTm9kZSk7XG4gICAgICAgICAgZm9ybVRyZWUoZm91bmROb2RlLCB0cmVlLCBjb250ZXh0KTtcbiAgICAgICAgICAvLyBCcmVhayB3aGVuIGFsbCBhcmdzIGFyZSBmaWxsZWRcbiAgICAgICAgICBpZiAobm9kZS5jaGlsZHJlbi5ldmVyeSgobikgPT4gbi5mb3VuZCkpIHtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBcbiAgICAgIH1cbiAgICB9XG4gIC8vIEhhbmRsZSBldmVyeXRoaW5nIGVsc2VcbiAgfSBlbHNlIHtcbiAgICAvLyBGaW5kIGEgcmVsYXRpb25zaGlwIGlmIHdlIGhhdmUgdG9cbiAgICBsZXQgcmVsYXRpb25zaGlwOiBSZWxhdGlvbnNoaXAgPSB7dHlwZTogUmVsYXRpb25zaGlwVHlwZXMuTk9ORX07XG4gICAgaWYgKG5vZGUucmVsYXRpb25zaGlwcy5sZW5ndGggPT09IDApIHtcbiAgICAgIC8vbGV0IG9ycGhhbnMgPSB0cmVlLmNoaWxkcmVuLmZpbHRlcigoY2hpbGQpID0+IGNoaWxkLnJlbGF0aW9uc2hpcHMubGVuZ3RoID09PSAwICYmIGNoaWxkLmNoaWxkcmVuLmxlbmd0aCA9PT0gMCk7ICBcbiAgICAgIGZvciAobGV0IGkgPSBjb250ZXh0LmZvdW5kLmxlbmd0aCAtMTsgaSA+PSAwOyBpLS0pIHtcbiAgICAgICAgbGV0IGZvdW5kTm9kZSA9IGNvbnRleHQuZm91bmRbaV07IFxuICAgICAgICBpZiAoZm91bmROb2RlID09PSBub2RlKSB7XG4gICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG5vZGUucmVsYXRpb25zaGlwcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICByZW1vdmVOb2RlKG5vZGUpO1xuICAgICAgICB9XG4gICAgICAgIHJlbGF0aW9uc2hpcCA9IGZpbmRSZWxhdGlvbnNoaXAobm9kZSwgZm91bmROb2RlLCBjb250ZXh0KTtcbiAgICAgICAgaWYgKHJlbGF0aW9uc2hpcC50eXBlICE9PSBSZWxhdGlvbnNoaXBUeXBlcy5OT05FKSB7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH0gZWxzZSBpZiAocmVsYXRpb25zaGlwLnR5cGUgPT09IFJlbGF0aW9uc2hpcFR5cGVzLk5PTkUpIHtcbiAgICAgICAgICBpZiAoZm91bmROb2RlLmhhc1Byb3BlcnR5KFByb3BlcnRpZXMuUE9TU0VTU0lWRSkgJiYgIW5vZGUuZm91bmQgJiYgIW5vZGUuaGFzUHJvcGVydHkoUHJvcGVydGllcy5RVUFOVElUWSkpIHtcbiAgICAgICAgICAgIGNvbnRleHQubWF5YmVBdHRyaWJ1dGVzLnB1c2gobm9kZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIC8vIFBsYWNlIHRoZSBub2RlIG9udG8gYSBmdW5jdGlvbiBpZiBvbmUgaXMgb3BlblxuICAgIGxldCBvcGVuRnVuY3Rpb25zID0gY29udGV4dC5pbnRlcm5hbEZ4bnMuZmlsdGVyKChmeG4pID0+ICFmeG4uY2hpbGRyZW4uZXZlcnkoKGMpID0+IGMuZm91bmQpKTtcbiAgICBmb3IgKGxldCBmeG5Ob2RlIG9mIG9wZW5GdW5jdGlvbnMpIHtcbiAgICAgIGxldCBhZGRlZCA9IGFkZE5vZGVUb0Z1bmN0aW9uKG5vZGUsIGZ4bk5vZGUsIGNvbnRleHQpO1xuICAgICAgaWYgKGFkZGVkKSB7XG4gICAgICAgIHJlbGF0aW9uc2hpcC50eXBlID0gUmVsYXRpb25zaGlwVHlwZXMuRElSRUNUO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgLy8gSWYgbm8gcmVsYXRpb25zaGlwcyB3ZXJlIGZvdW5kLCBzdGljayB0aGUgbm9kZSBvbnRvIHRoZSByb290XG4gICAgaWYgKG5vZGUucGFyZW50ID09PSB1bmRlZmluZWQgJiYgbm9kZS5yZWxhdGlvbnNoaXBzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgdHJlZS5hZGRDaGlsZChub2RlKTtcbiAgICAvLyBJZiB0aGVyZSBpcyBhIHJlbGF0aW9uc2hpcCwgYnV0IHRoZSBub2RlIGhhcyBubyBwYXJlbnQsIGp1c3QgcHV0IGl0IG9uIHRoZSByb290XG4gICAgfSBlbHNlIGlmIChub2RlLnBhcmVudCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICBsZXQgcmVsYXRlZE5vZGVzID0gbm9kZS5yZWxhdGlvbnNoaXBzLm1hcCgocikgPT4gci5ub2Rlcyk7XG4gICAgICBsZXQgZmxhdFJlbGF0ZWROb2RlcyA9IGZsYXR0ZW5OZXN0ZWRBcnJheShyZWxhdGVkTm9kZXMpO1xuICAgICAgbGV0IHJlbGF0ZWRBdHRyaWJ1dGUgPSBmbGF0UmVsYXRlZE5vZGVzLmZpbHRlcigobikgPT4gbi5oYXNQcm9wZXJ0eShQcm9wZXJ0aWVzLkFUVFJJQlVURSkpLnNoaWZ0KCk7XG4gICAgICBpZiAocmVsYXRlZEF0dHJpYnV0ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGxldCByb290ID0gZmluZFBhcmVudFdpdGhQcm9wZXJ0eShyZWxhdGVkQXR0cmlidXRlLCBQcm9wZXJ0aWVzLlJPT1QpO1xuICAgICAgICBpZiAocm9vdCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgcm9vdC5hZGRDaGlsZChub2RlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0cmVlLmFkZENoaWxkKG5vZGUpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0cmVlLmFkZENoaWxkKG5vZGUpO1xuICAgICAgfVxuICAgIH1cbiAgICAvLyBGaW5hbGx5IGFkZCBhbnkgbm9kZXMgaW1wbGljaXQgaW4gdGhlIHJlbGF0aW9uc2hpcCAgICBcbiAgICBpZiAocmVsYXRpb25zaGlwLmltcGxpY2l0Tm9kZXMgIT09IHVuZGVmaW5lZCAmJiByZWxhdGlvbnNoaXAuaW1wbGljaXROb2Rlcy5sZW5ndGggPiAwKSB7XG4gICAgICBmb3IgKGxldCBpbXBsTm9kZSBvZiByZWxhdGlvbnNoaXAuaW1wbGljaXROb2Rlcykge1xuICAgICAgICBmb3JtVHJlZShpbXBsTm9kZSwgdHJlZSwgY29udGV4dCk7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIFxuICAvLyBTd2l0Y2ggc3RhdGVcbiAgaWYgKG5vZGUuZnhuICYmIG5vZGUuZnhuLnR5cGUgPT09IEZ1bmN0aW9uVHlwZXMuSU5TRVJUKSB7XG4gICAgY29udGV4dC5zdGF0ZUZsYWdzLmluc2VydCA9IHRydWU7XG4gIH1cbiAgXG4gIGxvZyhcIlRyZWU6XCIpO1xuICBsb2codHJlZS50b1N0cmluZygpKTtcbiAgcmV0dXJuIHt0cmVlOiB0cmVlLCBjb250ZXh0OiBjb250ZXh0fTtcbn1cblxuLy8gRmluZCBhbGwgdGhlIHJlcHJlc2VudGF0aW9ucyBvZiBhIHRoaW5nXG5mdW5jdGlvbiBmaW5kQWx0ZXJuYXRpdmVSZXByZXNlbnRhdGlvbnMobm9kZTogTm9kZSk6IHZvaWQge1xuICBcbiAgbGV0IGF0dHIgPSBmaW5kRXZlQXR0cmlidXRlKG5vZGUubmFtZSk7XG4gIGxldCBjb2xsID0gZmluZEV2ZUNvbGxlY3Rpb24obm9kZS5uYW1lKTtcbiAgbGV0IGVudCA9IGZpbmRFdmVFbnRpdHkobm9kZS5uYW1lKTtcbiAgbGV0IGZ4biA9IHN0cmluZ1RvRnVuY3Rpb24obm9kZS5uYW1lKTtcbiAgXG4gIG5vZGUucmVwcmVzZW50YXRpb25zID0ge1xuICAgIGNvbGxlY3Rpb246IGNvbGwsXG4gICAgZW50aXR5OiBlbnQsXG4gICAgYXR0cmlidXRlOiBhdHRyLFxuICAgIGZ4bjogZnhuLFxuICB9XG4gIG5vZGUuZm91bmRSZXBzID0gdHJ1ZTtcbn1cblxuLy8gU3dhcCB0aGUgcmVwcmVzZW50YXRpb24gb2YgdGhlIG5vZGUgd2l0aCBhbm90aGVyIG9uZVxuLy8gQ2xlYXJzIGFsbCBhdHRyaWJ1dGVzIHJlbGF0ZWQgdG8gdGhlIG9sZCByZXAsIGFuZCBhZGRzIGEgbmV3IG9uZVxuZnVuY3Rpb24gY2hhbmdlUmVwcmVzZW50YXRpb24obm9kZTogTm9kZSwgcmVwOiBQcm9wZXJ0aWVzLCBjb250ZXh0OiBDb250ZXh0KTogYm9vbGVhbiB7XG4gIC8vIENsZWFyIHRoZSBub2RlXG4gIG5vZGUuZm91bmQgPSBmYWxzZTtcbiAgaWYgKG5vZGUuY29sbGVjdGlvbiAhPT0gdW5kZWZpbmVkKSB7XG4gICAgbm9kZS5jb2xsZWN0aW9uID0gdW5kZWZpbmVkOyAgXG4gICAgbm9kZS5wcm9wZXJ0aWVzLnNwbGljZShub2RlLnByb3BlcnRpZXMuaW5kZXhPZihQcm9wZXJ0aWVzLkNPTExFQ1RJT04pLDEpO1xuICB9IGVsc2UgaWYgKG5vZGUuZW50aXR5ICE9PSB1bmRlZmluZWQpIHtcbiAgICBub2RlLmVudGl0eSA9IHVuZGVmaW5lZDtcbiAgICBub2RlLnByb3BlcnRpZXMuc3BsaWNlKG5vZGUucHJvcGVydGllcy5pbmRleE9mKFByb3BlcnRpZXMuRU5USVRZKSwxKTtcbiAgfSBlbHNlIGlmIChub2RlLmF0dHJpYnV0ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgbm9kZS5hdHRyaWJ1dGUgPSB1bmRlZmluZWQ7XG4gICAgbm9kZS5wcm9wZXJ0aWVzLnNwbGljZShub2RlLnByb3BlcnRpZXMuaW5kZXhPZihQcm9wZXJ0aWVzLkFUVFJJQlVURSksMSk7XG4gIH0gZWxzZSBpZiAobm9kZS5meG4gIT09IHVuZGVmaW5lZCkge1xuICAgIG5vZGUuZnhuID0gdW5kZWZpbmVkO1xuICAgIG5vZGUucHJvcGVydGllcy5zcGxpY2Uobm9kZS5wcm9wZXJ0aWVzLmluZGV4T2YoUHJvcGVydGllcy5GVU5DVElPTiksMSk7XG4gIH1cbiAgLy8gU3dpdGNoIHRoZSByZXByZXNlbnRhdGlvblxuICBpZiAocmVwID09PSBQcm9wZXJ0aWVzLkNPTExFQ1RJT04pIHtcbiAgICBpZiAobm9kZS5yZXByZXNlbnRhdGlvbnMuY29sbGVjdGlvbikge1xuICAgICAgZmluZENvbGxlY3Rpb24obm9kZSwgY29udGV4dCk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gIH0gZWxzZSBpZiAocmVwID09PSBQcm9wZXJ0aWVzLkVOVElUWSkge1xuICAgIGlmIChub2RlLnJlcHJlc2VudGF0aW9ucy5lbnRpdHkpIHtcbiAgICAgIGZpbmRFbnRpdHkobm9kZSwgY29udGV4dCk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gIH0gZWxzZSBpZiAocmVwID09PSBQcm9wZXJ0aWVzLkFUVFJJQlVURSkge1xuICAgIGlmIChub2RlLnJlcHJlc2VudGF0aW9ucy5hdHRyaWJ1dGUpIHtcbiAgICAgIGZpbmRBdHRyaWJ1dGUobm9kZSwgY29udGV4dCk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gIH0gZWxzZSBpZiAocmVwID09PSBQcm9wZXJ0aWVzLkZVTkNUSU9OKSB7XG4gICAgaWYgKG5vZGUucmVwcmVzZW50YXRpb25zLmZ4bikge1xuICAgICAgZmluZEZ1bmN0aW9uKG5vZGUsIGNvbnRleHQpO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICB9XG4gIHJldHVybiBmYWxzZTtcbn1cblxuLy8gQWRkcyBhIG5vZGUgdG8gYW4gYXJndW1lbnQuIElmIGFkZGluZyB0aGUgbm9kZSBjb21wbGV0ZXMgYSBzZWxlY3QsXG4vLyBhIG5ldyBub2RlIHdpbGwgYmUgcmV0dXJuZWRcbmZ1bmN0aW9uIGFkZE5vZGVUb0Z1bmN0aW9uKG5vZGU6IE5vZGUsIGZ4bk5vZGU6IE5vZGUsIGNvbnRleHQ6IENvbnRleHQpOiBib29sZWFuIHtcbiAgbG9nKGBNYXRjaGluZyBcIiR7bm9kZS5uYW1lfVwiIHdpdGggZnVuY3Rpb24gXCIke2Z4bk5vZGUubmFtZX1cImApO1xuICAvLyBGaW5kIHRoZSBjb3JyZWN0IGFyZ1xuICBsZXQgYXJnOiBOb2RlO1xuICBpZiAobm9kZS5oYXNQcm9wZXJ0eShQcm9wZXJ0aWVzLkVOVElUWSkpIHtcbiAgICBhcmcgPSBmeG5Ob2RlLmNoaWxkcmVuLmZpbHRlcigoYykgPT4gYy5oYXNQcm9wZXJ0eShQcm9wZXJ0aWVzLkVOVElUWSkgJiYgIWMuZm91bmQpLnNoaWZ0KCk7XG4gIH0gZWxzZSBpZiAobm9kZS5oYXNQcm9wZXJ0eShQcm9wZXJ0aWVzLkNPTExFQ1RJT04pKSB7XG4gICAgYXJnID0gZnhuTm9kZS5jaGlsZHJlbi5maWx0ZXIoKGMpID0+IGMuaGFzUHJvcGVydHkoUHJvcGVydGllcy5DT0xMRUNUSU9OKSAmJiAhYy5mb3VuZCkuc2hpZnQoKTtcbiAgfSBlbHNlIGlmIChub2RlLmhhc1Byb3BlcnR5KFByb3BlcnRpZXMuQVRUUklCVVRFKSkge1xuICAgIGFyZyA9IGZ4bk5vZGUuY2hpbGRyZW4uZmlsdGVyKChjKSA9PiBjLmhhc1Byb3BlcnR5KFByb3BlcnRpZXMuQVRUUklCVVRFKSAmJiAhYy5mb3VuZCkuc2hpZnQoKTtcbiAgfSBlbHNlIGlmIChub2RlLmhhc1Byb3BlcnR5KFByb3BlcnRpZXMuRlVOQ1RJT04pKSB7XG4gICAgYXJnID0gZnhuTm9kZS5jaGlsZHJlbi5maWx0ZXIoKGMpID0+IGMuaGFzUHJvcGVydHkoUHJvcGVydGllcy5GVU5DVElPTikgJiYgIWMuZm91bmQpLnNoaWZ0KCk7XG4gIH0gZWxzZSB7XG4gICAgYXJnID0gZnhuTm9kZS5jaGlsZHJlbi5maWx0ZXIoKGMpID0+IGMuaGFzUHJvcGVydHkoUHJvcGVydGllcy5ST09UKSkuc2hpZnQoKTtcbiAgfVxuXG4gIC8vIEFkZCB0aGUgbm9kZSB0byB0aGUgYXJnXG4gIGlmIChhcmcgIT09IHVuZGVmaW5lZCkge1xuICAgIGlmIChmeG5Ob2RlLmZ4bi50eXBlID09PSBGdW5jdGlvblR5cGVzLkdST1VQICYmIGFyZy5uYW1lID09PSBcImNvbGxlY3Rpb25cIikge1xuICAgICAgY29udGV4dC5ncm91cGluZ3MucHVzaChub2RlKTtcbiAgICAgIGFyZy5hZGRDaGlsZChub2RlKTtcbiAgICB9IGVsc2UgaWYgKGZ4bk5vZGUuZnhuLnR5cGUgPT09IEZ1bmN0aW9uVHlwZXMuU0VMRUNUKSB7XG4gICAgICBsZXQgcm9vdCA9IGZpbmRQYXJlbnRXaXRoUHJvcGVydHkoZnhuTm9kZSwgUHJvcGVydGllcy5ST09UKTtcbiAgICAgIHJlbW92ZUJyYW5jaChmeG5Ob2RlKTtcbiAgICAgIGNvbnRleHQuYXJndW1lbnRzLnNwbGljZShjb250ZXh0LmFyZ3VtZW50cy5pbmRleE9mKG5vZGUuY2hpbGRyZW5bMF0pLDEpO1xuICAgICAgY29udGV4dC5pbnRlcm5hbEZ4bnMuc3BsaWNlKGNvbnRleHQuaW50ZXJuYWxGeG5zLmluZGV4T2YoZnhuTm9kZSksMSk7XG4gICAgICBub2RlLnByb3BlcnRpZXMucHVzaChQcm9wZXJ0aWVzLlBPU1NFU1NJVkUpO1xuICAgICAgcm9vdC5hZGRDaGlsZChub2RlKTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0gZWxzZSB7XG4gICAgICBhcmcuYWRkQ2hpbGQobm9kZSk7XG4gICAgfVxuICAgIGFyZy5mb3VuZCA9IHRydWU7XG4gICAgcmV0dXJuIHRydWU7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG59XG5cbi8vIEVBViBGdW5jdGlvbnNcblxuaW50ZXJmYWNlIEVudGl0eSB7XG4gIGlkOiBzdHJpbmcsXG4gIGRpc3BsYXlOYW1lOiBzdHJpbmcsXG4gIG5vZGU/OiBOb2RlLFxuICByZWZzPzogQXJyYXk8Tm9kZT4sXG4gIHZhcmlhYmxlOiBzdHJpbmcsXG4gIHByb2plY3Q6IGJvb2xlYW4sXG4gIGhhbmRsZWQ/OiBib29sZWFuLFxuICBlbnRpdHlBdHRyOiBib29sZWFuLFxuICBlbnRpdHlWYXI6IGJvb2xlYW4sXG4gIHZhbHVlVmFyOiBib29sZWFuLFxuICB2YWx1ZT86IHN0cmluZyxcbiAgcHJvamVjdGVkQXM/OiBzdHJpbmcsXG59XG5cbmludGVyZmFjZSBDb2xsZWN0aW9uIHtcbiAgaWQ6IHN0cmluZyxcbiAgZGlzcGxheU5hbWU6IHN0cmluZyxcbiAgbm9kZT86IE5vZGUsXG4gIHJlZnM/OiBBcnJheTxOb2RlPixcbiAgdmFyaWFibGU6IHN0cmluZyxcbiAgcHJvamVjdDogYm9vbGVhbixcbiAgaGFuZGxlZD86IGJvb2xlYW4sXG4gIHByb2plY3RlZEFzPzogc3RyaW5nLFxufVxuXG5mdW5jdGlvbiBjbG9uZUNvbGxlY3Rpb24oY29sbGVjdGlvbjogQ29sbGVjdGlvbik6IENvbGxlY3Rpb24ge1xuICBsZXQgY2xvbmU6IENvbGxlY3Rpb24gPSB7XG4gICAgaWQ6IGNvbGxlY3Rpb24uaWQsXG4gICAgZGlzcGxheU5hbWU6IGNvbGxlY3Rpb24uZGlzcGxheU5hbWUsXG4gICAgbm9kZTogY29sbGVjdGlvbi5ub2RlLFxuICAgIHZhcmlhYmxlOiBjb2xsZWN0aW9uLnZhcmlhYmxlLFxuICAgIHByb2plY3Q6IGNvbGxlY3Rpb24ucHJvamVjdCxcbiAgfVxuICByZXR1cm4gY2xvbmU7XG59XG5cbmludGVyZmFjZSBBdHRyaWJ1dGUge1xuICBpZDogc3RyaW5nLFxuICBkaXNwbGF5TmFtZTogc3RyaW5nLFxuICBub2RlPzogTm9kZSxcbiAgcmVmcz86IEFycmF5PE5vZGU+LFxuICB2YXJpYWJsZTogc3RyaW5nLFxuICBwcm9qZWN0OiBib29sZWFuLFxuICBoYW5kbGVkPzogYm9vbGVhbixcbiAgcHJvamVjdGVkQXM/OiBzdHJpbmcsXG4gIGF0dHJpYnV0ZVZhcj86IGJvb2xlYW4sXG59XG5cbi8vIFJldHVybnMgdGhlIGVudGl0eSB3aXRoIHRoZSBnaXZlbiBkaXNwbGF5IG5hbWUuXG4vLyBJZiB0aGUgZW50aXR5IGlzIG5vdCBmb3VuZCwgcmV0dXJucyB1bmRlZmluZWRcbi8vIFR3byBlcnJvciBtb2RlcyBoZXJlOiBcbi8vIDEpIHRoZSBuYW1lIGlzIG5vdCBmb3VuZCBpbiBcImRpc3BsYXkgbmFtZVwiXG4vLyAyKSB0aGUgbmFtZSBpcyBmb3VuZCBpbiBcImRpc3BsYXkgbmFtZVwiIGJ1dCBub3QgZm91bmQgaW4gXCJlbnRpdHlcIlxuLy8gY2FuIDIpIGV2ZXIgaGFwcGVuP1xuLy8gUmV0dXJucyB0aGUgY29sbGVjdGlvbiB3aXRoIHRoZSBnaXZlbiBkaXNwbGF5IG5hbWUuXG5mdW5jdGlvbiBmaW5kRXZlRW50aXR5KHNlYXJjaDogc3RyaW5nKTogRW50aXR5IHtcbiAgbG9nKFwiU2VhcmNoaW5nIGZvciBlbnRpdHk6IFwiICsgc2VhcmNoKTtcbiAgbGV0IGZvdW5kRW50aXR5O1xuICBsZXQgbmFtZTogc3RyaW5nO1xuICAvLyBUcnkgdG8gZmluZCBieSBkaXNwbGF5IG5hbWUgZmlyc3RcbiAgbGV0IGRpc3BsYXkgPSBldmUuZmluZE9uZShcImluZGV4IG5hbWVcIix7IG5hbWU6IHNlYXJjaCB9KTtcbiAgaWYgKGRpc3BsYXkgIT09IHVuZGVmaW5lZCkge1xuICAgIGZvdW5kRW50aXR5ID0gZXZlLmZpbmRPbmUoXCJlbnRpdHlcIiwgeyBlbnRpdHk6IGRpc3BsYXkuaWQgfSk7XG4gICAgbmFtZSA9IHNlYXJjaDtcbiAgLy8gSWYgd2UgZGlkbid0IGZpbmQgaXQgdGhhdCB3YXksIHRyeSBhZ2FpbiBieSBJRFxuICB9IGVsc2Uge1xuICAgIGZvdW5kRW50aXR5ID0gZXZlLmZpbmRPbmUoXCJlbnRpdHlcIiwgeyBlbnRpdHk6IHNlYXJjaCB9KTtcbiAgfVxuICAvLyBCdWlsZCB0aGUgZW50aXR5XG4gIGlmIChmb3VuZEVudGl0eSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgaWYgKG5hbWUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgZGlzcGxheSA9IGV2ZS5maW5kT25lKFwiZGlzcGxheSBuYW1lXCIseyBpZDogc2VhcmNoIH0pO1xuICAgICAgbmFtZSA9IGRpc3BsYXkubmFtZTsgIFxuICAgIH1cbiAgICBsZXQgZW50aXR5OiBFbnRpdHkgPSB7XG4gICAgICBpZDogZm91bmRFbnRpdHkuZW50aXR5LFxuICAgICAgZGlzcGxheU5hbWU6IG5hbWUsXG4gICAgICB2YXJpYWJsZTogbmFtZS5yZXBsYWNlKC8gL2csJycpLFxuICAgICAgcHJvamVjdDogdHJ1ZSxcbiAgICAgIGVudGl0eUF0dHI6IGZhbHNlLFxuICAgICAgZW50aXR5VmFyOiBmYWxzZSxcbiAgICAgIHZhbHVlVmFyOiBmYWxzZSxcbiAgICB9XG4gICAgbG9nKFwiIEZvdW5kOiBcIiArIGVudGl0eS5pZCk7XG4gICAgcmV0dXJuIGVudGl0eTtcbiAgfSBlbHNlIHtcbiAgICBsb2coXCIgTm90IGZvdW5kOiBcIiArIHNlYXJjaCk7XG4gICAgcmV0dXJuIHVuZGVmaW5lZDsgIFxuICB9XG59XG4vLyBSZXR1cm5zIHRoZSBjb2xsZWN0aW9uIHdpdGggdGhlIGdpdmVuIGRpc3BsYXkgbmFtZS5cbmZ1bmN0aW9uIGZpbmRFdmVDb2xsZWN0aW9uKHNlYXJjaDogc3RyaW5nKTogQ29sbGVjdGlvbiB7XG4gIGxvZyhcIlNlYXJjaGluZyBmb3IgY29sbGVjdGlvbjogXCIgKyBzZWFyY2gpO1xuICBsZXQgZm91bmRDb2xsZWN0aW9uO1xuICBsZXQgbmFtZTogc3RyaW5nO1xuICAvLyBUcnkgdG8gZmluZCBieSBkaXNwbGF5IG5hbWUgZmlyc3RcbiAgbGV0IGRpc3BsYXkgPSBldmUuZmluZE9uZShcImluZGV4IG5hbWVcIix7IG5hbWU6IHNlYXJjaCB9KTtcbiAgaWYgKGRpc3BsYXkgIT09IHVuZGVmaW5lZCkge1xuICAgIGZvdW5kQ29sbGVjdGlvbiA9IGV2ZS5maW5kT25lKFwiY29sbGVjdGlvblwiLCB7IGNvbGxlY3Rpb246IGRpc3BsYXkuaWQgfSk7XG4gICAgbmFtZSA9IHNlYXJjaDtcbiAgLy8gSWYgd2UgZGlkbid0IGZpbmQgaXQgdGhhdCB3YXksIHRyeSBhZ2FpbiBieSBJRFxuICB9IGVsc2Uge1xuICAgIGZvdW5kQ29sbGVjdGlvbiA9IGV2ZS5maW5kT25lKFwiY29sbGVjdGlvblwiLCB7IGNvbGxlY3Rpb246IHNlYXJjaCB9KTtcbiAgfVxuICAvLyBCdWlsZCB0aGUgY29sbGVjdGlvblxuICBpZiAoZm91bmRDb2xsZWN0aW9uICE9PSB1bmRlZmluZWQpIHtcbiAgICBpZiAobmFtZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICBkaXNwbGF5ID0gZXZlLmZpbmRPbmUoXCJkaXNwbGF5IG5hbWVcIix7IGlkOiBzZWFyY2ggfSk7XG4gICAgICBuYW1lID0gZGlzcGxheS5uYW1lOyAgXG4gICAgfVxuICAgIGxldCBjb2xsZWN0aW9uOiBDb2xsZWN0aW9uID0ge1xuICAgICAgaWQ6IGZvdW5kQ29sbGVjdGlvbi5jb2xsZWN0aW9uLFxuICAgICAgZGlzcGxheU5hbWU6IG5hbWUsXG4gICAgICB2YXJpYWJsZTogbmFtZS5yZXBsYWNlKC8gL2csJycpLFxuICAgICAgcHJvamVjdDogdHJ1ZSxcbiAgICB9XG4gICAgbG9nKFwiIEZvdW5kOiBcIiArIGNvbGxlY3Rpb24uaWQpO1xuICAgIHJldHVybiBjb2xsZWN0aW9uO1xuICB9IGVsc2Uge1xuICAgIGxvZyhcIiBOb3QgZm91bmQ6IFwiICsgc2VhcmNoKTtcbiAgICByZXR1cm4gdW5kZWZpbmVkOyAgXG4gIH1cbn1cblxuLy8gUmV0dXJucyB0aGUgYXR0cmlidXRlIHdpdGggdGhlIGdpdmVuIGRpc3BsYXkgbmFtZSBhdHRhY2hlZCB0byB0aGUgZ2l2ZW4gZW50aXR5XG4vLyBJZiB0aGUgZW50aXR5IGRvZXMgbm90IGhhdmUgdGhhdCBhdHRyaWJ1dGUsIG9yIHRoZSBlbnRpdHkgZG9lcyBub3QgZXhpc3QsIHJldHVybnMgdW5kZWZpbmVkXG5mdW5jdGlvbiBmaW5kRXZlQXR0cmlidXRlKG5hbWU6IHN0cmluZyk6IEF0dHJpYnV0ZSB7XG4gIGxvZyhcIlNlYXJjaGluZyBmb3IgYXR0cmlidXRlOiBcIiArIG5hbWUpO1xuICBsZXQgZm91bmRBdHRyaWJ1dGUgPSBldmUuZmluZE9uZShcImVudGl0eSBlYXZzXCIsIHsgYXR0cmlidXRlOiBuYW1lIH0pO1xuICBpZiAoZm91bmRBdHRyaWJ1dGUgIT09IHVuZGVmaW5lZCkge1xuICAgIGxldCBhdHRyaWJ1dGU6IEF0dHJpYnV0ZSA9IHtcbiAgICAgIGlkOiBmb3VuZEF0dHJpYnV0ZS5hdHRyaWJ1dGUsXG4gICAgICBkaXNwbGF5TmFtZTogbmFtZSxcbiAgICAgIHZhcmlhYmxlOiBuYW1lLnJlcGxhY2UoLyAvZywnJyksXG4gICAgICBwcm9qZWN0OiB0cnVlLFxuICAgIH1cbiAgICBsb2coXCIgRm91bmQ6IFwiICsgbmFtZSk7XG4gICAgbG9nKGF0dHJpYnV0ZSk7XG4gICAgcmV0dXJuIGF0dHJpYnV0ZTtcbiAgfVxuICBsb2coXCIgTm90IGZvdW5kOiBcIiArIG5hbWUpO1xuICByZXR1cm4gdW5kZWZpbmVkO1xufVxuXG5lbnVtIFJlbGF0aW9uc2hpcFR5cGVzIHtcbiAgTk9ORSxcbiAgRElSRUNULFxuICBPTkVIT1AsXG4gIFRXT0hPUCxcbiAgSU5URVJTRUNUSU9OLFxufVxuXG5pbnRlcmZhY2UgUmVsYXRpb25zaGlwIHtcbiAgdHlwZTogUmVsYXRpb25zaGlwVHlwZXMsXG4gIG5vZGVzPzogQXJyYXk8Tm9kZT4sXG4gIGltcGxpY2l0Tm9kZXM/OiBBcnJheTxOb2RlPixcbn1cblxuZnVuY3Rpb24gZmluZFJlbGF0aW9uc2hpcChub2RlQTogTm9kZSwgbm9kZUI6IE5vZGUsIGNvbnRleHQ6IENvbnRleHQpOiBSZWxhdGlvbnNoaXAge1xuICBsZXQgcmVsYXRpb25zaGlwID0ge3R5cGU6IFJlbGF0aW9uc2hpcFR5cGVzLk5PTkV9O1xuICBpZiAoKG5vZGVBID09PSBub2RlQikgfHwgXG4gICAgICAoY29udGV4dC5zdGF0ZUZsYWdzLmluc2VydCkgfHxcbiAgICAgIChub2RlQS5oYXNQcm9wZXJ0eShQcm9wZXJ0aWVzLlFVQU5USVRZKSAmJiBub2RlQi5oYXNQcm9wZXJ0eShQcm9wZXJ0aWVzLlFVQU5USVRZKSkpIHtcbiAgICByZXR1cm4gcmVsYXRpb25zaGlwO1xuICB9XG4gIGxvZyhgRmluZGluZyByZWxhdGlvbnNoaXAgYmV0d2VlbiBcIiR7bm9kZUEubmFtZX1cIiBhbmQgXCIke25vZGVCLm5hbWV9XCJgKTtcbiAgICBcbiAgLy8gU29ydCB0aGUgbm9kZXMgaW4gb3JkZXJcbiAgLy8gMSkgQ29sbGVjdGlvbiBcbiAgLy8gMikgRW50aXR5IFxuICAvLyAzKSBBdHRyaWJ1dGVcbiAgLy8gNCkgRnVuY3Rpb25cbiAgLy8gNSkgUXVhbnRpdHlcbiAgLy8gNikgU3RyaW5nXG4gIG5vZGVBLnByb3BlcnRpZXMuc29ydCgoYSwgYikgPT4gYSAtIGIpO1xuICBub2RlQi5wcm9wZXJ0aWVzLnNvcnQoKGEsIGIpID0+IGEgLSBiKTtcbiAgbGV0IG5vZGVzID0gW25vZGVBLCBub2RlQl0uc29ydCgoYSwgYikgPT4gYS5wcm9wZXJ0aWVzWzBdIC0gYi5wcm9wZXJ0aWVzWzBdKTtcbiAgbm9kZUEgPSBub2Rlc1swXVxuICBub2RlQiA9IG5vZGVzWzFdO1xuICBcbiAgLy8gRmluZCB0aGUgcHJvcGVyIHJlbGF0aW9uc2hpcFxuICBpZiAobm9kZUEuaGFzUHJvcGVydHkoUHJvcGVydGllcy5FTlRJVFkpICYmIG5vZGVCLmhhc1Byb3BlcnR5KFByb3BlcnRpZXMuQVRUUklCVVRFKSkge1xuICAgIHJlbGF0aW9uc2hpcCA9IGZpbmRFbnRUb0F0dHJSZWxhdGlvbnNoaXAobm9kZUEsIG5vZGVCLCBjb250ZXh0KTtcbiAgfSBlbHNlIGlmIChub2RlQS5oYXNQcm9wZXJ0eShQcm9wZXJ0aWVzLkNPTExFQ1RJT04pICYmIG5vZGVCLmhhc1Byb3BlcnR5KFByb3BlcnRpZXMuQVRUUklCVVRFKSkge1xuICAgIHJlbGF0aW9uc2hpcCA9IGZpbmRDb2xsVG9BdHRyUmVsYXRpb25zaGlwKG5vZGVBLCBub2RlQiwgY29udGV4dCk7XG4gIH0gZWxzZSBpZiAobm9kZUEuaGFzUHJvcGVydHkoUHJvcGVydGllcy5DT0xMRUNUSU9OKSAmJiBub2RlQi5oYXNQcm9wZXJ0eShQcm9wZXJ0aWVzLkNPTExFQ1RJT04pKSB7XG4gICAgcmVsYXRpb25zaGlwID0gZmluZENvbGxUb0NvbGxSZWxhdGlvbnNoaXAobm9kZUEsIG5vZGVCLCBjb250ZXh0KTtcbiAgfSBlbHNlIGlmIChub2RlQS5oYXNQcm9wZXJ0eShQcm9wZXJ0aWVzLkFUVFJJQlVURSkgJiYgbm9kZUIuaGFzUHJvcGVydHkoUHJvcGVydGllcy5BVFRSSUJVVEUpKSB7XG4gICAgcmVsYXRpb25zaGlwID0gZmluZEF0dHJUb0F0dHJSZWxhdGlvbnNoaXAobm9kZUEsIG5vZGVCLCBjb250ZXh0KTtcbiAgfSBlbHNlIGlmIChub2RlQS5oYXNQcm9wZXJ0eShQcm9wZXJ0aWVzLkNPTExFQ1RJT04pICYmIG5vZGVCLmhhc1Byb3BlcnR5KFByb3BlcnRpZXMuRU5USVRZKSkge1xuICAgIHJlbGF0aW9uc2hpcCA9IGZpbmRDb2xsVG9FbnRSZWxhdGlvbnNoaXAobm9kZUEsIG5vZGVCLCBjb250ZXh0KTtcbiAgfSBcbiAgXG4gIC8vIEFkZCByZWxhdGlvbnNoaXBzIHRvIHRoZSBub2RlcyBhbmQgY29udGV4dFxuICBpZiAocmVsYXRpb25zaGlwLnR5cGUgIT09IFJlbGF0aW9uc2hpcFR5cGVzLk5PTkUpIHtcbiAgICBub2RlQS5yZWxhdGlvbnNoaXBzLnB1c2gocmVsYXRpb25zaGlwKTtcbiAgICBub2RlQi5yZWxhdGlvbnNoaXBzLnB1c2gocmVsYXRpb25zaGlwKTtcbiAgICBjb250ZXh0LnJlbGF0aW9uc2hpcHMucHVzaChyZWxhdGlvbnNoaXApO1xuICAvLyBJZiBubyByZWxhdGlvbnNoaXAgd2FzIGZvdW5kLCBjaGFuZ2UgdGhlIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBub2RlXG4gIH0gZWxzZSB7XG4gICAgbm9kZXMgPSBbbm9kZUEsIG5vZGVCXS5zb3J0KChhLGIpID0+IGEuaXggLSBiLml4KTtcbiAgICBub2RlQSA9IG5vZGVzWzBdO1xuICAgIG5vZGVCID0gbm9kZXNbMV07XG4gICAgbGV0IHJlcENoYW5nZWQgPSBmYWxzZTtcbiAgICAvLyBJZiBvbmUgbm9kZSBpcyBwb3NzZXNzaXZlLCBpdCBzdWdnZXN0cyB0aGUgb3RoZXIgc2hvdWxkIGJlIHJlcHJlc2VudGVkIGFzIGFuIGF0dHJpYnV0ZSBvZiB0aGUgZmlyc3RcbiAgICBpZiAobm9kZUEuaGFzUHJvcGVydHkoUHJvcGVydGllcy5QT1NTRVNTSVZFKSAmJiAhbm9kZUIuaGFzUHJvcGVydHkoUHJvcGVydGllcy5BVFRSSUJVVEUpICYmIG5vZGVCLnJlcHJlc2VudGF0aW9ucy5hdHRyaWJ1dGUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgcmVwQ2hhbmdlZCA9IGNoYW5nZVJlcHJlc2VudGF0aW9uKG5vZGVCLCBQcm9wZXJ0aWVzLkFUVFJJQlVURSwgY29udGV4dCk7IFxuICAgIH0gZWxzZSBpZiAobm9kZUEuaGFzUHJvcGVydHkoUHJvcGVydGllcy5DT0xMRUNUSU9OKSAmJiBub2RlQi5oYXNQcm9wZXJ0eShQcm9wZXJ0aWVzLkNPTExFQ1RJT04pICYmIG5vZGVCLnJlcHJlc2VudGF0aW9ucy5hdHRyaWJ1dGUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgcmVwQ2hhbmdlZCA9IGNoYW5nZVJlcHJlc2VudGF0aW9uKG5vZGVCLCBQcm9wZXJ0aWVzLkFUVFJJQlVURSwgY29udGV4dCk7XG4gICAgfVxuICAgIGlmIChyZXBDaGFuZ2VkKSB7XG4gICAgICByZWxhdGlvbnNoaXAgPSBmaW5kUmVsYXRpb25zaGlwKG5vZGVBLCBub2RlQiwgY29udGV4dCk7XG4gICAgfVxuICB9XG4gIHJldHVybiByZWxhdGlvbnNoaXA7XG59XG5cbi8vIGUuZy4gQ29yZXkncyB3aWZlJ3MgYWdlXG5mdW5jdGlvbiBmaW5kQXR0clRvQXR0clJlbGF0aW9uc2hpcChhdHRyQTogTm9kZSwgYXR0ckI6IE5vZGUsIGNvbnRleHQ6IENvbnRleHQpOiBSZWxhdGlvbnNoaXAge1xuICBsb2coYEZpbmRpbmcgQXR0ciAtPiBBdHRyIHJlbGF0aW9uc2hpcCBiZXR3ZWVuIFwiJHthdHRyQS5uYW1lfVwiIGFuZCBcIiR7YXR0ckIubmFtZX1cIi4uLmApO1xuICBcbiAgY29uc29sZS5sb2coYXR0ckEpXG4gIGNvbnNvbGUubG9nKGF0dHJCKVxuICBcbiAgaWYgKGF0dHJBLmhhc1Byb3BlcnR5KFByb3BlcnRpZXMuUVVBTlRJVFkpKSB7XG4gICAgbGV0IHRlbXAgPSBhdHRyQTtcbiAgICBhdHRyQSA9IGF0dHJCOyBcbiAgICBhdHRyQiA9IHRlbXA7XG4gIH1cbiAgXG4gIC8vIGUuZy4gZW1wbG95ZWVzIHdob3NlIHNhbGFyeSBpcyAxMFxuICBpZiAoYXR0ckEucmVsYXRpb25zaGlwcy5sZW5ndGggPiAwICYmIGF0dHJCLmhhc1Byb3BlcnR5KFByb3BlcnRpZXMuUVVBTlRJVFkpICYmICFhdHRyQS5wYXJlbnQuaGFzUHJvcGVydHkoUHJvcGVydGllcy5BUkdVTUVOVCkpIHtcbiAgICBhdHRyQS5hdHRyaWJ1dGUudmFyaWFibGUgPSBgJHthdHRyQi5xdWFudGl0eX1gO1xuICAgIGF0dHJBLmF0dHJpYnV0ZS5hdHRyaWJ1dGVWYXIgPSBmYWxzZTtcbiAgICBhdHRyQS5hdHRyaWJ1dGUucHJvamVjdCA9IGZhbHNlO1xuICAgIHJldHVybiB7dHlwZTogUmVsYXRpb25zaGlwVHlwZXMuRElSRUNULCBub2RlczogW2F0dHJBLCBhdHRyQl19OyAgIFxuICB9IGVsc2Uge1xuICAgIHJldHVybiB7dHlwZTogUmVsYXRpb25zaGlwVHlwZXMuTk9ORX07ICBcbiAgfVxuICBcbiAgLy8gQ2hlY2sgd2hldGhlciBvbmUgb2YgdGhlIGF0dHJpYnV0ZXMgaXMgYW4gZW50aXR5IGF0dHJpYnV0ZVxuICBsZXQgZGlyZWN0ID0gZmFsc2U7XG4gIGlmIChhdHRyQS5oYXNQcm9wZXJ0eShQcm9wZXJ0aWVzLlBPU1NFU1NJVkUpKSB7XG4gICAgZGlyZWN0ID0gdHJ1ZTsgICAgXG4gIH0gZWxzZSBpZiAoYXR0ckIuaGFzUHJvcGVydHkoUHJvcGVydGllcy5QT1NTRVNTSVZFKSkge1xuICAgIGxldCB0Tm9kZSA9IGF0dHJBO1xuICAgIGF0dHJBID0gYXR0ckI7XG4gICAgYXR0ckIgPSB0Tm9kZTtcbiAgICBkaXJlY3QgPSB0cnVlO1xuICB9XG4gIFxuICBpZiAoZGlyZWN0KSB7XG4gICAgbG9nKFwiICBGb3VuZCBhIGRpcmVjdCByZWxhdGlvbnNoaXBcIik7XG4gICAgLy8gQ3JlYXRlIGFuIGVudGl0eSBhdHRyaWJ1dGVcbiAgICBsZXQgZW50aXR5QXR0ciA9IGF0dHJBLmF0dHJpYnV0ZTtcbiAgICBsZXQgZW50OiBFbnRpdHkgPSB7XG4gICAgICBpZDogZW50aXR5QXR0ci52YXJpYWJsZSxcbiAgICAgIGRpc3BsYXlOYW1lOiBlbnRpdHlBdHRyLnZhcmlhYmxlLFxuICAgICAgdmFyaWFibGU6IGVudGl0eUF0dHIudmFyaWFibGUsXG4gICAgICBwcm9qZWN0OiBmYWxzZSxcbiAgICAgIGVudGl0eUF0dHI6IHRydWUsXG4gICAgICBlbnRpdHlWYXI6IGZhbHNlLFxuICAgICAgdmFsdWVWYXI6IGZhbHNlLFxuICAgIH1cbiAgICBsZXQgblRva2VuID0gbmV3VG9rZW4oZW50aXR5QXR0ci52YXJpYWJsZSk7XG4gICAgbGV0IG5Ob2RlID0gbmV3Tm9kZShuVG9rZW4pO1xuICAgIG5Ob2RlLmVudGl0eSA9IGVudDtcbiAgICBlbnQubm9kZSA9IG5Ob2RlO1xuICAgIGF0dHJCLmF0dHJpYnV0ZS52YXJpYWJsZSA9IGAke2F0dHJBLmF0dHJpYnV0ZS52YXJpYWJsZX18JHthdHRyQi5hdHRyaWJ1dGUuaWR9YDtcbiAgICBhdHRyQi5hdHRyaWJ1dGUucmVmcyA9IFtuTm9kZV07XG4gICAgcmV0dXJuIHt0eXBlOiBSZWxhdGlvbnNoaXBUeXBlcy5ESVJFQ1QsIG5vZGVzOiBbYXR0ckEsIGF0dHJCXX07IFxuICB9XG4gIHJldHVybiB7dHlwZTogUmVsYXRpb25zaGlwVHlwZXMuTk9ORX07ICBcbn1cblxuXG4vLyBlLmcuIFwibWVldGluZ3Mgam9obiB3YXMgaW5cIlxuZnVuY3Rpb24gZmluZENvbGxUb0VudFJlbGF0aW9uc2hpcChjb2xsOiBOb2RlLCBlbnQ6IE5vZGUsIGNvbnRleHQ6IENvbnRleHQpOiBSZWxhdGlvbnNoaXAge1xuICBsb2coYEZpbmRpbmcgQ29sbCAtPiBFbnQgcmVsYXRpb25zaGlwIGJldHdlZW4gXCIke2NvbGwubmFtZX1cIiBhbmQgXCIke2VudC5uYW1lfVwiLi4uYCk7XG4gIC8qaWYgKGNvbGwgPT09IFwiY29sbGVjdGlvbnNcIikge1xuICAgIGlmIChldmUuZmluZE9uZShcImNvbGxlY3Rpb24gZW50aXRpZXNcIiwgeyBlbnRpdHk6IG5vZGVCLmVudGl0eS5pZCB9KSkge1xuICAgICAgcmV0dXJuIHsgdHlwZTogUmVsYXRpb25zaGlwVHlwZXMuRElSRUNUIH07XG4gICAgfVxuICB9XG4gIGlmIChldmUuZmluZE9uZShcImNvbGxlY3Rpb24gZW50aXRpZXNcIiwgeyBjb2xsZWN0aW9uOiBjb2xsLmNvbGxlY3Rpb24uaWQsIGVudGl0eTogZW50LmVudGl0eS5pZCB9KSkge1xuICAgIGxvZyhcIiAgRm91bmQgRGlyZWN0IHJlbGF0aW9uc2hpcFwiKVxuICAgIHJldHVybiB7IHR5cGU6IFJlbGF0aW9uc2hpcFR5cGVzLkRJUkVDVCB9O1xuICB9Ki9cbiAgbGV0IGV2ZVJlbGF0aW9uc2hpcCA9IGV2ZS5xdWVyeShgYClcbiAgICAuc2VsZWN0KFwiY29sbGVjdGlvbiBlbnRpdGllc1wiLCB7IGNvbGxlY3Rpb246IGNvbGwuY29sbGVjdGlvbi5pZCB9LCBcImNvbGxlY3Rpb25cIilcbiAgICAuc2VsZWN0KFwiZGlyZWN0aW9ubGVzcyBsaW5rc1wiLCB7IGVudGl0eTogW1wiY29sbGVjdGlvblwiLCBcImVudGl0eVwiXSwgbGluazogZW50LmVudGl0eS5pZCB9LCBcImxpbmtzXCIpXG4gICAgLmV4ZWMoKTtcbiAgaWYgKGV2ZVJlbGF0aW9uc2hpcC51bnByb2plY3RlZC5sZW5ndGgpIHtcbiAgICBsZXQgZW50aXRpZXMgPSBleHRyYWN0RnJvbVVucHJvamVjdGVkKGV2ZVJlbGF0aW9uc2hpcC51bnByb2plY3RlZCwgMSwgMiwgXCJsaW5rXCIpO1xuICAgIGxldCBjb2xsZWN0aW9ucyA9IGZpbmRDb21tb25Db2xsZWN0aW9ucyhlbnRpdGllcyk7XG4gICAgbGV0IGNvbGxMaW5rSUQ7XG4gICAgaWYgKGNvbGxlY3Rpb25zLmxlbmd0aCA+IDApIHtcbiAgICAgIGxvZyhcIiAgRm91bmQgRGlyZWN0IFJlbGF0aW9uc2hpcFwiKTtcbiAgICAgIGxldCBlbnRpdHkgPSBlbnQuZW50aXR5O1xuICAgICAgZW50aXR5LmVudGl0eVZhciA9IHRydWU7XG4gICAgICBlbnRpdHkucHJvamVjdCA9IGZhbHNlO1xuICAgICAgZW50aXR5LnZhcmlhYmxlID0gY29sbC5jb2xsZWN0aW9uLnZhcmlhYmxlO1xuICAgICAgbGV0IHJlbGF0aW9uc2hpcCA9IHt0eXBlOiBSZWxhdGlvbnNoaXBUeXBlcy5ESVJFQ1QsIG5vZGVzOiBbY29sbCwgZW50XX07XG4gICAgICByZXR1cm4gcmVsYXRpb25zaGlwO1xuICAgIH1cbiAgfVxuICAvKlxuICAvLyBlLmcuIGV2ZW50cyB3aXRoIGNocmlzIGdyYW5nZXIgKGV2ZW50cyAtPiBtZWV0aW5ncyAtPiBjaHJpcyBncmFuZ2VyKVxuICBsZXQgcmVsYXRpb25zaGlwczIgPSBldmUucXVlcnkoYGApXG4gICAgLnNlbGVjdChcImNvbGxlY3Rpb24gZW50aXRpZXNcIiwgeyBjb2xsZWN0aW9uOiBjb2xsIH0sIFwiY29sbGVjdGlvblwiKVxuICAgIC5zZWxlY3QoXCJkaXJlY3Rpb25sZXNzIGxpbmtzXCIsIHsgZW50aXR5OiBbXCJjb2xsZWN0aW9uXCIsIFwiZW50aXR5XCJdIH0sIFwibGlua3NcIilcbiAgICAuc2VsZWN0KFwiZGlyZWN0aW9ubGVzcyBsaW5rc1wiLCB7IGVudGl0eTogW1wibGlua3NcIiwgXCJsaW5rXCJdLCBsaW5rOiBlbnQgfSwgXCJsaW5rczJcIilcbiAgICAuZXhlYygpO1xuICBpZiAocmVsYXRpb25zaGlwczIudW5wcm9qZWN0ZWQubGVuZ3RoKSB7XG4gICAgbGV0IGVudGl0aWVzID0gZXh0cmFjdEZyb21VbnByb2plY3RlZChyZWxhdGlvbnNoaXBzMi51bnByb2plY3RlZCwgMSwgMyk7XG4gICAgcmV0dXJuIHsgdHlwZTogUmVsYXRpb25zaGlwVHlwZXMuVFdPSE9QIH07XG4gIH0qL1xuICBsb2coXCIgIE5vIHJlbGF0aW9uc2hpcCBmb3VuZFwiKTtcbiAgcmV0dXJuIHsgdHlwZTogUmVsYXRpb25zaGlwVHlwZXMuTk9ORSB9O1xufVxuXG5mdW5jdGlvbiBmaW5kRW50VG9BdHRyUmVsYXRpb25zaGlwKGVudDogTm9kZSwgYXR0cjogTm9kZSwgY29udGV4dDogQ29udGV4dCk6IFJlbGF0aW9uc2hpcCB7XG4gIGxvZyhgRmluZGluZyBFbnQgLT4gQXR0ciByZWxhdGlvbnNoaXAgYmV0d2VlbiBcIiR7ZW50Lm5hbWV9XCIgYW5kIFwiJHthdHRyLm5hbWV9XCIuLi5gKTsgIFxuICBcbiAgLy8gSWYgdGhlIG5vZGUgYWxyZWFkeSBoYXMgYSByZWxhdGlvbnNoaXAsIHRoZW4gdHJlYXQgdGhlIGVudGl0eSBhcyBmaWx0ZXJpbmcgdGhlIG5vZGVcbiAgaWYgKGF0dHIucmVsYXRpb25zaGlwcy5sZW5ndGggPiAwICYmICFhdHRyLnBhcmVudC5oYXNQcm9wZXJ0eShQcm9wZXJ0aWVzLkFSR1VNRU5UKSkge1xuICAgIGF0dHIuYXR0cmlidXRlLnZhcmlhYmxlID0gZW50LmVudGl0eS5pZDtcbiAgICBhdHRyLmF0dHJpYnV0ZS5hdHRyaWJ1dGVWYXIgPSBmYWxzZTtcbiAgICBhdHRyLmF0dHJpYnV0ZS5wcm9qZWN0ID0gZmFsc2U7XG4gICAgZW50LmVudGl0eS5wcm9qZWN0ID0gZmFsc2U7XG4gICAgZW50LmVudGl0eS5oYW5kbGVkID0gdHJ1ZTtcbiAgICByZXR1cm4ge3R5cGU6IFJlbGF0aW9uc2hpcFR5cGVzLkRJUkVDVCwgbm9kZXM6IFtlbnQsIGF0dHJdfTtcbiAgfSBlbHNlIGlmIChhdHRyLnJlbGF0aW9uc2hpcHMubGVuZ3RoID4gMCkge1xuICAgIHJldHVybiB7dHlwZTogUmVsYXRpb25zaGlwVHlwZXMuTk9ORX07XG4gIH1cbiAgXG4gIC8vIENoZWNrIGZvciBhIGRpcmVjdCByZWxhdGlvbnNoaXBcbiAgLy8gZS5nLiBcIkpvc2gncyBhZ2VcIlxuICBsZXQgZXZlUmVsYXRpb25zaGlwID0gZXZlLmZpbmRPbmUoXCJlbnRpdHkgZWF2c1wiLCB7IGVudGl0eTogZW50LmVudGl0eS5pZCwgYXR0cmlidXRlOiBhdHRyLmF0dHJpYnV0ZS5pZCB9KTtcbiAgaWYgKGV2ZVJlbGF0aW9uc2hpcCkge1xuICAgIGxvZyhcIiAgRm91bmQgYSBkaXJlY3QgcmVsYXRpb25zaGlwLlwiKTtcbiAgICBsZXQgYXR0cmlidXRlID0gYXR0ci5hdHRyaWJ1dGU7XG4gICAgbGV0IHZhck5hbWUgPSBgJHtlbnQubmFtZX18JHthdHRyLm5hbWV9YC5yZXBsYWNlKC8gL2csJycpO1xuICAgIGF0dHJpYnV0ZS52YXJpYWJsZSA9IHZhck5hbWU7XG4gICAgYXR0cmlidXRlLnJlZnMgPSBbZW50XTtcbiAgICBhdHRyaWJ1dGUucHJvamVjdCA9IHRydWU7XG4gICAgZW50LmVudGl0eS5oYW5kbGVkID0gdHJ1ZTtcbiAgICByZXR1cm4ge3R5cGU6IFJlbGF0aW9uc2hpcFR5cGVzLkRJUkVDVCwgbm9kZXM6IFtlbnQsIGF0dHJdLCBpbXBsaWNpdE5vZGVzOiBbXX07XG4gIH1cbiAgLy8gQ2hlY2sgZm9yIGEgb25lLWhvcCByZWxhdGlvbnNoaXBcbiAgLy8gZS5nLiBcIlNhbGFyaWVzIGluIGVuZ2luZWVyaW5nXCJcbiAgZXZlUmVsYXRpb25zaGlwID0gZXZlLnF1ZXJ5KGBgKVxuICAgIC5zZWxlY3QoXCJkaXJlY3Rpb25sZXNzIGxpbmtzXCIsIHsgZW50aXR5OiBlbnQuZW50aXR5LmlkIH0sIFwibGlua3NcIilcbiAgICAuc2VsZWN0KFwiZW50aXR5IGVhdnNcIiwgeyBlbnRpdHk6IFtcImxpbmtzXCIsIFwibGlua1wiXSwgYXR0cmlidXRlOiBhdHRyLmF0dHJpYnV0ZS5pZCB9LCBcImVhdlwiKVxuICAgIC5leGVjKCk7XG4gIGlmIChldmVSZWxhdGlvbnNoaXAudW5wcm9qZWN0ZWQubGVuZ3RoKSB7XG4gICAgXG4gICAgbG9nKGV2ZVJlbGF0aW9uc2hpcCk7XG4gICAgLy8gRmlsbCBpbiB0aGUgYXR0cmlidXRlXG4gICAgbGV0IGVudGl0aWVzID0gZXh0cmFjdEZyb21VbnByb2plY3RlZChldmVSZWxhdGlvbnNoaXAudW5wcm9qZWN0ZWQsIDAsIDIsIFwibGlua1wiKTtcbiAgICBsZXQgY29sbGVjdGlvbnMgPSBmaW5kQ29tbW9uQ29sbGVjdGlvbnMoZW50aXRpZXMpO1xuXG4gICAgbGV0IGNvbGxMaW5rSUQ7XG4gICAgaWYgKGNvbGxlY3Rpb25zLmxlbmd0aCA+IDApIHtcbiAgICAgIGxvZyhcIiAgRm91bmQgT25lLUhvcCBSZWxhdGlvbnNoaXBcIik7XG4gICAgICBcbiAgICAgIC8vIEBIQUNLIENob29zZSB0aGUgY29ycmVjdCBjb2xsZWN0aW9uIGluIGEgc21hcnQgd2F5LiBcbiAgICAgIC8vIExhcmdlc3QgY29sbGVjdGlvbiBvdGhlciB0aGFuIGVudGl0eSBvciB0ZXN0ZGF0YT9cbiAgICAgIGNvbGxMaW5rSUQgPSBjb2xsZWN0aW9uc1swXTsgIFxuICAgIFxuICAgICAgbGV0IGZvdW5kQ29sbGVjdGlvbiA9IGZpbmRFdmVDb2xsZWN0aW9uKGNvbGxMaW5rSUQpO1xuICAgICAgbGV0IGxpbmtUb2tlbiA9IG5ld1Rva2VuKGZvdW5kQ29sbGVjdGlvbi5kaXNwbGF5TmFtZSk7XG4gICAgICBsZXQgbGlua0NvbGxlY3Rpb24gPSBuZXdOb2RlKGxpbmtUb2tlbik7XG4gICAgICBmaW5kQ29sbGVjdGlvbihsaW5rQ29sbGVjdGlvbiwgY29udGV4dCk7XG4gICAgICBsZXQgYXR0cmlidXRlID0gYXR0ci5hdHRyaWJ1dGU7XG4gICAgICBsZXQgdmFyTmFtZSA9IGAke2xpbmtDb2xsZWN0aW9uLm5hbWV9fCR7YXR0ci5uYW1lfWAucmVwbGFjZSgvIC9nLCcnKTtcbiAgICAgIGF0dHJpYnV0ZS52YXJpYWJsZSA9IHZhck5hbWU7XG4gICAgICBhdHRyaWJ1dGUucmVmcyA9IFtsaW5rQ29sbGVjdGlvbl07XG4gICAgICBcbiAgICAgIC8vIEZpbmQgdGhlIG9uZS1ob3AgbGlua1xuICAgICAgbGV0IGdldEF0dHIgPSBldmUucXVlcnkoYGApXG4gICAgICAgICAgICAgICAgICAgICAgLnNlbGVjdChcImRpcmVjdGlvbmxlc3MgbGlua3NcIiwgeyBlbnRpdHk6IGVudC5lbnRpdHkuaWQgfSwgXCJsaW5rc1wiKVxuICAgICAgICAgICAgICAgICAgICAgIC5zZWxlY3QoXCJlbnRpdHkgZWF2c1wiLCB7IGVudGl0eTogW1wibGlua3NcIiwgXCJsaW5rXCJdLCB2YWx1ZTogZW50LmVudGl0eS5pZCB9LCBcImVhdlwiKSBcbiAgICAgICAgICAgICAgICAgICAgICAuZXhlYygpO1xuICAgICAgbGV0IGF0dHJpYnV0ZXMgPSBleHRyYWN0RnJvbVVucHJvamVjdGVkKGdldEF0dHIudW5wcm9qZWN0ZWQsMSwyLFwiYXR0cmlidXRlXCIpO1xuICAgICAgYXR0cmlidXRlcyA9IGF0dHJpYnV0ZXMuZmlsdGVyKG9ubHlVbmlxdWUpO1xuICAgICAgbGV0IGF0dHJMaW5rSUQ7XG4gICAgICBsZXQgbk5vZGU7XG4gICAgICBsZXQgaW1wbGljaXROb2RlcyA9IFtdO1xuICAgICAgaWYgKGF0dHJpYnV0ZXMubGVuZ3RoID4gMCkge1xuICAgICAgICBhdHRyTGlua0lEID0gYXR0cmlidXRlc1swXTtcbiAgICAgICAgLy8gQnVpbGQgYSBsaW5rIGF0dHJpYnV0ZSBub2RlXG4gICAgICAgIGxldCBuZXdOYW1lID0gYXR0ckxpbmtJRDtcbiAgICAgICAgbGV0IG5Ub2tlbiA9IG5ld1Rva2VuKG5ld05hbWUpO1xuICAgICAgICBuTm9kZSA9IG5ld05vZGUoblRva2VuKTtcbiAgICAgICAgbGV0IG5BdHRyaWJ1dGU6IEF0dHJpYnV0ZSA9IHtcbiAgICAgICAgICBpZDogYXR0ckxpbmtJRCxcbiAgICAgICAgICByZWZzOiBbbGlua0NvbGxlY3Rpb25dLFxuICAgICAgICAgIG5vZGU6IG5Ob2RlLFxuICAgICAgICAgIGRpc3BsYXlOYW1lOiBhdHRyTGlua0lELFxuICAgICAgICAgIHZhcmlhYmxlOiBgXCIke2VudC5lbnRpdHkuaWR9XCJgLFxuICAgICAgICAgIHByb2plY3Q6IGZhbHNlLFxuICAgICAgICB9XG4gICAgICAgIG5Ob2RlLmF0dHJpYnV0ZSA9IG5BdHRyaWJ1dGU7XG4gICAgICAgIG5Ob2RlLnByb3BlcnRpZXMucHVzaChQcm9wZXJ0aWVzLkFUVFJJQlVURSk7XG4gICAgICAgIG5Ob2RlLmZvdW5kID0gdHJ1ZTtcbiAgICAgICAgaW1wbGljaXROb2Rlcy5wdXNoKG5Ob2RlKTtcbiAgICAgIH1cbiAgICAgIC8vIFByb2plY3Qgd2hhdCB3ZSBuZWVkIHRvXG4gICAgICBhdHRyaWJ1dGUucHJvamVjdCA9IHRydWU7XG4gICAgICBlbnQuZW50aXR5LnByb2plY3QgPSBmYWxzZTtcbiAgICAgIGVudC5lbnRpdHkuaGFuZGxlZCA9IHRydWU7XG4gICAgICBsZXQgcmVsYXRpb25zaGlwID0ge3R5cGU6IFJlbGF0aW9uc2hpcFR5cGVzLk9ORUhPUCwgbm9kZXM6IFtlbnQsIGF0dHJdLCBpbXBsaWNpdE5vZGVzOiBpbXBsaWNpdE5vZGVzfTtcbiAgICAgIGlmIChuTm9kZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIG5Ob2RlLnJlbGF0aW9uc2hpcHMucHVzaChyZWxhdGlvbnNoaXApOyAgXG4gICAgICB9XG4gICAgICByZXR1cm4gcmVsYXRpb25zaGlwXG4gICAgfVxuICB9XG4gIC8qXG4gIGxldCByZWxhdGlvbnNoaXBzMiA9IGV2ZS5xdWVyeShgYClcbiAgICAuc2VsZWN0KFwiZGlyZWN0aW9ubGVzcyBsaW5rc1wiLCB7IGVudGl0eTogZW50aXR5LmlkIH0sIFwibGlua3NcIilcbiAgICAuc2VsZWN0KFwiZGlyZWN0aW9ubGVzcyBsaW5rc1wiLCB7IGVudGl0eTogW1wibGlua3NcIiwgXCJsaW5rXCJdIH0sIFwibGlua3MyXCIpXG4gICAgLnNlbGVjdChcImVudGl0eSBlYXZzXCIsIHsgZW50aXR5OiBbXCJsaW5rczJcIiwgXCJsaW5rXCJdLCBhdHRyaWJ1dGU6IGF0dHIgfSwgXCJlYXZcIilcbiAgICAuZXhlYygpO1xuICBpZiAocmVsYXRpb25zaGlwczIudW5wcm9qZWN0ZWQubGVuZ3RoKSB7XG4gICAgbGV0IGVudGl0aWVzID0gZXh0cmFjdEZyb21VbnByb2plY3RlZChyZWxhdGlvbnNoaXBzMi51bnByb2plY3RlZCwgMCwgMyk7XG4gICAgbGV0IGVudGl0aWVzMiA9IGV4dHJhY3RGcm9tVW5wcm9qZWN0ZWQocmVsYXRpb25zaGlwczIudW5wcm9qZWN0ZWQsIDEsIDMpO1xuICAgIC8vcmV0dXJuIHsgZGlzdGFuY2U6IDIsIHR5cGU6IFJlbGF0aW9uc2hpcFR5cGVzLkVOVElUWV9BVFRSSUJVVEUsIG5vZGVzOiBbZmluZENvbW1vbkNvbGxlY3Rpb25zKGVudGl0aWVzKSwgZmluZENvbW1vbkNvbGxlY3Rpb25zKGVudGl0aWVzMildIH07XG4gIH0qL1xuICBsb2coXCIgIE5vIHJlbGF0aW9uc2hpcCBmb3VuZC5cIik7XG4gIHJldHVybiB7IHR5cGU6IFJlbGF0aW9uc2hpcFR5cGVzLk5PTkUgfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGZpbmRDb2xsVG9Db2xsUmVsYXRpb25zaGlwKGNvbGxBOiBOb2RlLCBjb2xsQjogTm9kZSwgY29udGV4dDogQ29udGV4dCk6IFJlbGF0aW9uc2hpcCB7ICBcbiAgbG9nKGBGaW5kaW5nIENvbGwgLT4gQ29sbCByZWxhdGlvbnNoaXAgYmV0d2VlbiBcIiR7Y29sbEEuY29sbGVjdGlvbi5kaXNwbGF5TmFtZX1cIiBhbmQgXCIke2NvbGxCLmNvbGxlY3Rpb24uZGlzcGxheU5hbWV9XCIuLi5gKTtcbiAgLy8gYXJlIHRoZXJlIHRoaW5ncyBpbiBib3RoIHNldHM/XG4gIGxldCBpbnRlcnNlY3Rpb24gPSBldmUucXVlcnkoYCR7Y29sbEEuY29sbGVjdGlvbi5kaXNwbGF5TmFtZX0tPiR7Y29sbEIuY29sbGVjdGlvbi5kaXNwbGF5TmFtZX1gKVxuICAgIC5zZWxlY3QoXCJjb2xsZWN0aW9uIGVudGl0aWVzXCIsIHsgY29sbGVjdGlvbjogY29sbEEuY29sbGVjdGlvbi5pZCB9LCBcImNvbGxBXCIpXG4gICAgLnNlbGVjdChcImNvbGxlY3Rpb24gZW50aXRpZXNcIiwgeyBjb2xsZWN0aW9uOiBjb2xsQi5jb2xsZWN0aW9uLmlkLCBlbnRpdHk6IFtcImNvbGxBXCIsIFwiZW50aXR5XCJdIH0sIFwiY29sbEJcIilcbiAgICAuZXhlYygpO1xuICAvLyBpcyB0aGVyZSBhIHJlbGF0aW9uc2hpcCBiZXR3ZWVuIHRoaW5ncyBpbiBib3RoIHNldHNcbiAgbGV0IGV2ZVJlbGF0aW9uc2hpcCA9IGV2ZS5xdWVyeShgcmVsYXRpb25zaGlwcyBiZXR3ZWVuICR7Y29sbEEuY29sbGVjdGlvbi5kaXNwbGF5TmFtZX0gYW5kICR7Y29sbEIuY29sbGVjdGlvbi5kaXNwbGF5TmFtZX1gKVxuICAgIC5zZWxlY3QoXCJjb2xsZWN0aW9uIGVudGl0aWVzXCIsIHsgY29sbGVjdGlvbjogY29sbEEuY29sbGVjdGlvbi5pZCB9LCBcImNvbGxBXCIpXG4gICAgLnNlbGVjdChcImRpcmVjdGlvbmxlc3MgbGlua3NcIiwgeyBlbnRpdHk6IFtcImNvbGxBXCIsIFwiZW50aXR5XCJdIH0sIFwibGlua3NcIilcbiAgICAuc2VsZWN0KFwiY29sbGVjdGlvbiBlbnRpdGllc1wiLCB7IGNvbGxlY3Rpb246IGNvbGxCLmNvbGxlY3Rpb24uaWQsIGVudGl0eTogW1wibGlua3NcIiwgXCJsaW5rXCJdIH0sIFwiY29sbEJcIilcbiAgICAuZ3JvdXAoW1tcImxpbmtzXCIsIFwibGlua1wiXV0pXG4gICAgLmFnZ3JlZ2F0ZShcImNvdW50XCIsIHt9LCBcImNvdW50XCIpXG4gICAgLnByb2plY3QoeyB0eXBlOiBbXCJsaW5rc1wiLCBcImxpbmtcIl0sIGNvdW50OiBbXCJjb3VudFwiLCBcImNvdW50XCJdIH0pXG4gICAgLmV4ZWMoKTtcbiAgbGV0IG1heFJlbCA9IHsgdHlwZTogXCJcIiwgY291bnQ6IDAgfTtcbiAgZm9yIChsZXQgcmVzdWx0IG9mIGV2ZVJlbGF0aW9uc2hpcC5yZXN1bHRzKSB7XG4gICAgaWYgKHJlc3VsdC5jb3VudCA+IG1heFJlbC5jb3VudCkgbWF4UmVsID0gcmVzdWx0O1xuICB9XG5cbiAgLy8gd2UgZGl2aWRlIGJ5IHR3byBiZWNhdXNlIHVucHJvamVjdGVkIHJlc3VsdHMgcGFjayByb3dzIG5leHQgdG8gZWFjaG90aGVyXG4gIC8vIGFuZCB3ZSBoYXZlIHR3byBzZWxlY3RzLlxuICBsZXQgaW50ZXJzZWN0aW9uU2l6ZSA9IGludGVyc2VjdGlvbi51bnByb2plY3RlZC5sZW5ndGggLyAyO1xuICBpZiAobWF4UmVsLmNvdW50ID4gaW50ZXJzZWN0aW9uU2l6ZSkge1xuICAgIC8qXG4gICAgY29uc29sZS5sb2coZXZlUmVsYXRpb25zaGlwKVxuICAgIGxldCBlbnRpdGllcyA9IGV4dHJhY3RGcm9tVW5wcm9qZWN0ZWQoZXZlUmVsYXRpb25zaGlwLnVucHJvamVjdGVkLDEsMixcImxpbmtcIikuZmlsdGVyKChlKSA9PiBlICE9PSB1bmRlZmluZWQpO1xuICAgIGxldCBjb2xsZWN0aW9ucyA9IGZpbmRDb21tb25Db2xsZWN0aW9ucyhlbnRpdGllcyk7XG4gICAgY29uc29sZS5sb2coZW50aXRpZXMpO1xuICAgIGNvbnNvbGUubG9nKGNvbGxlY3Rpb25zKVxuICAgIGNvbnNvbGUubG9nKGZpbmRFdmVDb2xsZWN0aW9uKGNvbGxlY3Rpb25zWzBdKSk7Ki9cbiAgICBsb2coXCIgRGlyZWN0IHJlbGF0aW9uc2hpcCBmb3VuZFwiKTtcbiAgICBsZXQgbk5hbWUgPSBgJHtjb2xsQS5uYW1lfXwke2NvbGxCLm5hbWV9YDtcbiAgICBsZXQgblRva2VuID0gbmV3VG9rZW4obk5hbWUpO1xuICAgIGxldCBuTm9kZSA9IG5ld05vZGUoblRva2VuKTtcbiAgICAvLyBDcmVhdGUgYSBsaW5rIGVhdlxuICAgIGxldCBlbnRpdHk6IEVudGl0eSA9IHtcbiAgICAgIGlkOiBuTmFtZSxcbiAgICAgIGRpc3BsYXlOYW1lOiBuTmFtZSxcbiAgICAgIHZhcmlhYmxlOiBjb2xsQi5jb2xsZWN0aW9uLnZhcmlhYmxlLFxuICAgICAgdmFsdWU6IGNvbGxBLmNvbGxlY3Rpb24udmFyaWFibGUsXG4gICAgICBwcm9qZWN0OiBmYWxzZSxcbiAgICAgIGVudGl0eUF0dHI6IGZhbHNlLFxuICAgICAgZW50aXR5VmFyOiB0cnVlLFxuICAgICAgdmFsdWVWYXI6IHRydWUsXG4gICAgICBub2RlOiBuTm9kZSxcbiAgICAgIGhhbmRsZWQ6IGZhbHNlLFxuICAgIH1cbiAgICBuTm9kZS5wcm9wZXJ0aWVzLnB1c2goUHJvcGVydGllcy5FTlRJVFkpO1xuICAgIG5Ob2RlLmVudGl0eSA9IGVudGl0eTtcbiAgICBuTm9kZS5mb3VuZCA9IHRydWU7XG4gICAgY29sbEIuYWRkQ2hpbGQobk5vZGUpO1xuICAgIGxldCByZWxhdGlvbnNoaXAgPSB7dHlwZTogUmVsYXRpb25zaGlwVHlwZXMuRElSRUNULCBub2RlczogW2NvbGxBLCBjb2xsQl19O1xuICAgIG5Ob2RlLnJlbGF0aW9uc2hpcHMucHVzaChyZWxhdGlvbnNoaXApOyAgICBcbiAgICByZXR1cm4gcmVsYXRpb25zaGlwO1xuICB9IGVsc2UgaWYgKGludGVyc2VjdGlvblNpemUgPiAwKSB7XG4gICAgbG9nKFwiIEZvdW5kIEludGVyc2VjdGlvbiByZWxhdGlvbnNoaXAuXCIpO1xuICAgIGNvbGxBLmNvbGxlY3Rpb24udmFyaWFibGUgPSBjb2xsQi5jb2xsZWN0aW9uLnZhcmlhYmxlO1xuICAgIGNvbGxCLmNvbGxlY3Rpb24ucHJvamVjdCA9IHRydWU7XG4gICAgY29sbEEuY29sbGVjdGlvbi5wcm9qZWN0ID0gZmFsc2U7XG4gICAgcmV0dXJuIHt0eXBlOiBSZWxhdGlvbnNoaXBUeXBlcy5JTlRFUlNFQ1RJT04sIG5vZGVzOiBbY29sbEEsIGNvbGxCXX07XG4gIH0gZWxzZSBpZiAobWF4UmVsLmNvdW50ID09PSAwICYmIGludGVyc2VjdGlvblNpemUgPT09IDApIHtcbiAgICBsb2coXCIgIE5vIHJlbGF0aW9uc2hpcCBmb3VuZDJcIik7XG4gICAgcmV0dXJuIHt0eXBlOiBSZWxhdGlvbnNoaXBUeXBlcy5OT05FfTtcbiAgfSBlbHNlIHtcbiAgICAvLyBAVE9ET1xuICAgIGxvZyhcIiAgTm8gcmVsYXRpb25zaGlwIGZvdW5kM1wiKTtcbiAgICByZXR1cm4ge3R5cGU6IFJlbGF0aW9uc2hpcFR5cGVzLk5PTkV9O1xuICB9XG59XG5cbmZ1bmN0aW9uIGZpbmRDb2xsVG9BdHRyUmVsYXRpb25zaGlwKGNvbGw6IE5vZGUsIGF0dHI6IE5vZGUsIGNvbnRleHQ6IENvbnRleHQpOiBSZWxhdGlvbnNoaXAge1xuICAvLyBGaW5kcyBhIGRpcmVjdCByZWxhdGlvbnNoaXAgYmV0d2VlbiBjb2xsZWN0aW9uIGFuZCBhdHRyaWJ1dGVcbiAgLy8gZS5nLiBcInBldHMnIGxlbmd0aHNcIlwiID0+IHBldCAtPiBsZW5ndGhcbiAgbG9nKGBGaW5kaW5nIENvbGwgLT4gQXR0ciByZWxhdGlvbnNoaXAgYmV0d2VlbiBcIiR7Y29sbC5uYW1lfVwiIGFuZCBcIiR7YXR0ci5uYW1lfVwiLi4uYCk7XG4gIGxldCBldmVSZWxhdGlvbnNoaXAgPSBldmUucXVlcnkoYGApXG4gICAgLnNlbGVjdChcImNvbGxlY3Rpb24gZW50aXRpZXNcIiwgeyBjb2xsZWN0aW9uOiBjb2xsLmNvbGxlY3Rpb24uaWQgfSwgXCJjb2xsZWN0aW9uXCIpXG4gICAgLnNlbGVjdChcImVudGl0eSBlYXZzXCIsIHsgZW50aXR5OiBbXCJjb2xsZWN0aW9uXCIsIFwiZW50aXR5XCJdLCBhdHRyaWJ1dGU6IGF0dHIuYXR0cmlidXRlLmlkIH0sIFwiZWF2XCIpXG4gICAgLmV4ZWMoKTtcbiAgaWYgKGV2ZVJlbGF0aW9uc2hpcC51bnByb2plY3RlZC5sZW5ndGggPiAwKSB7ICAgIFxuICAgIGxvZyhcIiAgRm91bmQgRGlyZWN0IFJlbGF0aW9uc2hpcFwiKTtcbiAgICAvLyBCdWlsZCBhbiBhdHRyaWJ1dGUgbm9kZVxuICAgIGxldCBhdHRyaWJ1dGUgPSBhdHRyLmF0dHJpYnV0ZTtcbiAgICBsZXQgdmFyTmFtZSA9IGAke2NvbGwubmFtZX18JHthdHRyLm5hbWV9YC5yZXBsYWNlKC8gL2csJycpO1xuICAgIGF0dHJpYnV0ZS52YXJpYWJsZSA9IHZhck5hbWU7XG4gICAgYXR0cmlidXRlLnJlZnMgPSBbY29sbF07XG4gICAgYXR0cmlidXRlLnByb2plY3QgPSB0cnVlO1xuICAgIHJldHVybiB7dHlwZTogUmVsYXRpb25zaGlwVHlwZXMuRElSRUNULCBub2RlczogW2NvbGwsIGF0dHJdLCBpbXBsaWNpdE5vZGVzOiBbXX07XG4gIH1cbiAgLy8gRmluZHMgYSBvbmUgaG9wIHJlbGF0aW9uc2hpcFxuICAvLyBlLmcuIFwiZGVwYXJ0bWVudCBzYWxhcmllc1wiID0+IGRlcGFydG1lbnQgLT4gZW1wbG95ZWUgLT4gc2FsYXJ5XG4gIGV2ZVJlbGF0aW9uc2hpcCA9IGV2ZS5xdWVyeShgYClcbiAgICAuc2VsZWN0KFwiY29sbGVjdGlvbiBlbnRpdGllc1wiLCB7IGNvbGxlY3Rpb246IGNvbGwuY29sbGVjdGlvbi5pZCB9LCBcImNvbGxlY3Rpb25cIilcbiAgICAuc2VsZWN0KFwiZGlyZWN0aW9ubGVzcyBsaW5rc1wiLCB7IGVudGl0eTogW1wiY29sbGVjdGlvblwiLCBcImVudGl0eVwiXSB9LCBcImxpbmtzXCIpXG4gICAgLnNlbGVjdChcImVudGl0eSBlYXZzXCIsIHsgZW50aXR5OiBbXCJsaW5rc1wiLCBcImxpbmtcIl0sIGF0dHJpYnV0ZTogYXR0ci5hdHRyaWJ1dGUuaWQgfSwgXCJlYXZcIilcbiAgICAuZXhlYygpO1xuICBpZiAoZXZlUmVsYXRpb25zaGlwLnVucHJvamVjdGVkLmxlbmd0aCA+IDApIHtcbiAgICBsb2coXCIgIEZvdW5kIE9uZS1Ib3AgUmVsYXRpb25zaGlwXCIpO1xuICAgIGxvZyhldmVSZWxhdGlvbnNoaXApXG4gICAgLy8gRmluZCB0aGUgb25lLWhvcCBsaW5rXG4gICAgbGV0IGVudGl0aWVzID0gZXh0cmFjdEZyb21VbnByb2plY3RlZChldmVSZWxhdGlvbnNoaXAudW5wcm9qZWN0ZWQsIDEsIDMsIFwibGlua1wiKTtcbiAgICBsZXQgY29sbGVjdGlvbnMgPSBmaW5kQ29tbW9uQ29sbGVjdGlvbnMoZW50aXRpZXMpXG4gICAgbGV0IGxpbmtJRDtcbiAgICBpZiAoY29sbGVjdGlvbnMubGVuZ3RoID4gMCkge1xuICAgICAgLy8gQEhBQ0sgQ2hvb3NlIHRoZSBjb3JyZWN0IGNvbGxlY3Rpb24gaW4gYSBzbWFydCB3YXkuIFxuICAgICAgLy8gTGFyZ2VzdCBjb2xsZWN0aW9uIG90aGVyIHRoYW4gZW50aXR5IG9yIHRlc3RkYXRhP1xuICAgICAgbGlua0lEID0gY29sbGVjdGlvbnNbMF07ICBcbiAgICB9ICAgIFxuICAgIC8vIEZpbGwgaW4gdGhlIGF0dHJpYnV0ZVxuICAgIGxldCBmb3VuZENvbGxlY3Rpb24gPSBmaW5kRXZlQ29sbGVjdGlvbihsaW5rSUQpO1xuICAgIGxldCBsaW5rVG9rZW4gPSBuZXdUb2tlbihmb3VuZENvbGxlY3Rpb24uZGlzcGxheU5hbWUpO1xuICAgIGxldCBsaW5rQ29sbGVjdGlvbiA9IG5ld05vZGUobGlua1Rva2VuKTtcbiAgICBmaW5kQ29sbGVjdGlvbihsaW5rQ29sbGVjdGlvbiwgY29udGV4dCk7XG4gICAgbGV0IGF0dHJpYnV0ZSA9IGF0dHIuYXR0cmlidXRlO1xuICAgIGxldCB2YXJOYW1lID0gYCR7bGlua0NvbGxlY3Rpb24ubmFtZX18JHthdHRyLm5hbWV9YC5yZXBsYWNlKC8gL2csJycpO1xuICAgIGF0dHJpYnV0ZS52YXJpYWJsZSA9IHZhck5hbWU7XG4gICAgYXR0cmlidXRlLnJlZnMgPSBbbGlua0NvbGxlY3Rpb25dO1xuICAgIGF0dHJpYnV0ZS5wcm9qZWN0ID0gdHJ1ZTtcbiAgICAvLyBCdWlsZCBhIGxpbmsgYXR0cmlidXRlIG5vZGVcbiAgICBsZXQgbmV3TmFtZSA9IGNvbGwuY29sbGVjdGlvbi52YXJpYWJsZTtcbiAgICBsZXQgblRva2VuID0gbmV3VG9rZW4obmV3TmFtZSk7XG4gICAgbGV0IG5Ob2RlID0gbmV3Tm9kZShuVG9rZW4pO1xuICAgIGxldCBuQXR0cmlidXRlOiBBdHRyaWJ1dGUgPSB7XG4gICAgICBpZDogY29sbC5jb2xsZWN0aW9uLmRpc3BsYXlOYW1lLFxuICAgICAgcmVmczogW2xpbmtDb2xsZWN0aW9uXSxcbiAgICAgIG5vZGU6IG5Ob2RlLFxuICAgICAgZGlzcGxheU5hbWU6IG5ld05hbWUsXG4gICAgICB2YXJpYWJsZTogbmV3TmFtZSxcbiAgICAgIHByb2plY3Q6IGZhbHNlLFxuICAgIH1cbiAgICBuTm9kZS5hdHRyaWJ1dGUgPSBuQXR0cmlidXRlO1xuICAgIG5Ob2RlLnByb3BlcnRpZXMucHVzaChQcm9wZXJ0aWVzLkFUVFJJQlVURSk7XG4gICAgbk5vZGUuZm91bmQgPSB0cnVlO1xuICAgIC8vIFByb2plY3Qgd2hhdCB3ZSBuZWVkIHRvXG4gICAgbGlua0NvbGxlY3Rpb24uY29sbGVjdGlvbi5wcm9qZWN0ID0gdHJ1ZTtcbiAgICBjb2xsLmNvbGxlY3Rpb24ucHJvamVjdCA9IHRydWU7XG4gICAgbGV0IHJlbGF0aW9uc2hpcCA9IHt0eXBlOiBSZWxhdGlvbnNoaXBUeXBlcy5PTkVIT1AsIG5vZGVzOiBbY29sbCwgYXR0cl0sIGltcGxpY2l0Tm9kZXM6IFtuTm9kZV19O1xuICAgIG5Ob2RlLnJlbGF0aW9uc2hpcHMucHVzaChyZWxhdGlvbnNoaXApO1xuICAgIGxpbmtDb2xsZWN0aW9uLnJlbGF0aW9uc2hpcHMucHVzaChyZWxhdGlvbnNoaXApO1xuICAgIHJldHVybiByZWxhdGlvbnNoaXA7XG4gIH1cbiAgLypcbiAgLy8gTm90IHN1cmUgaWYgdGhpcyBvbmUgd29ya3MuLi4gdXNpbmcgdGhlIGVudGl0eSB0YWJsZSwgYSAyIGhvcCBsaW5rIGNhblxuICAvLyBiZSBmb3VuZCBhbG1vc3QgYW55d2hlcmUsIHlpZWxkaW5nIHJlc3VsdHMgbGlrZVxuICAvLyBlLmcuIFwiUGV0cyBoZWlnaHRzXCIgPT4gcGV0cyAtPiBzbmFrZSAtPiBlbnRpdHkgLT4gY29yZXkgLT4gaGVpZ2h0XG4gICByZWxhdGlvbnNoaXAgPSBldmUucXVlcnkoYGApXG4gICAgLnNlbGVjdChcImNvbGxlY3Rpb24gZW50aXRpZXNcIiwgeyBjb2xsZWN0aW9uOiBjb2xsLmlkIH0sIFwiY29sbGVjdGlvblwiKVxuICAgIC5zZWxlY3QoXCJkaXJlY3Rpb25sZXNzIGxpbmtzXCIsIHsgZW50aXR5OiBbXCJjb2xsZWN0aW9uXCIsIFwiZW50aXR5XCJdIH0sIFwibGlua3NcIilcbiAgICAuc2VsZWN0KFwiZGlyZWN0aW9ubGVzcyBsaW5rc1wiLCB7IGVudGl0eTogW1wibGlua3NcIiwgXCJsaW5rXCJdIH0sIFwibGlua3MyXCIpXG4gICAuc2VsZWN0KFwiZW50aXR5IGVhdnNcIiwgeyBlbnRpdHk6IFtcImxpbmtzMlwiLCBcImxpbmtcIl0sIGF0dHJpYnV0ZTogYXR0ciB9LCBcImVhdlwiKVxuICAgIC5leGVjKCk7XG4gIGlmIChyZWxhdGlvbnNoaXAudW5wcm9qZWN0ZWQubGVuZ3RoID4gMCkge1xuICAgIHJldHVybiB0cnVlO1xuICB9Ki9cbiAgbG9nKFwiICBObyByZWxhdGlvbnNoaXAgZm91bmRcIik7XG4gIHJldHVybiB7dHlwZTogUmVsYXRpb25zaGlwVHlwZXMuTk9ORX07XG59XG5cbi8vIEV4dHJhY3RzIGVudGl0aWVzIGZyb20gdW5wcm9qZWN0ZWQgcmVzdWx0c1xuZnVuY3Rpb24gZXh0cmFjdEZyb21VbnByb2plY3RlZChjb2xsLCBpeDogbnVtYmVyLCBzaXplOiBudW1iZXIsIGZpZWxkOiBzdHJpbmcpOiBBcnJheTxzdHJpbmc+IHtcbiAgbGV0IHJlc3VsdHM6IEFycmF5PHN0cmluZz4gPSBbXTtcbiAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IGNvbGwubGVuZ3RoOyBpIDwgbGVuOyBpICs9IHNpemUpIHtcbiAgICByZXN1bHRzLnB1c2goY29sbFtpICsgaXhdW2ZpZWxkXSk7XG4gIH1cbiAgcmV0dXJuIHJlc3VsdHM7XG59XG5cbi8vIEZpbmQgY29sbGVjdGlvbnMgdGhhdCBlbnRpdGllcyBoYXZlIGluIGNvbW1vblxuZnVuY3Rpb24gZmluZENvbW1vbkNvbGxlY3Rpb25zKGVudGl0aWVzOiBBcnJheTxzdHJpbmc+KTogQXJyYXk8c3RyaW5nPiB7XG4gIGxldCBpbnRlcnNlY3Rpb24gPSBlbnRpdHlUb2NvbGxlY3Rpb25zQXJyYXkoZW50aXRpZXNbMF0pO1xuICBpbnRlcnNlY3Rpb24uc29ydCgpO1xuICBmb3IgKGxldCBlbnRJZCBvZiBlbnRpdGllcy5zbGljZSgxKSkge1xuICAgIGxldCBjdXIgPSBlbnRpdHlUb2NvbGxlY3Rpb25zQXJyYXkoZW50SWQpO1xuICAgIGN1ci5zb3J0KCk7XG4gICAgYXJyYXlJbnRlcnNlY3QoaW50ZXJzZWN0aW9uLCBjdXIpO1xuICB9XG4gIGludGVyc2VjdGlvbi5zb3J0KChhLCBiKSA9PiB7XG4gICAgcmV0dXJuIGV2ZS5maW5kT25lKFwiY29sbGVjdGlvblwiLCB7IGNvbGxlY3Rpb246IGEgfSlbXCJjb3VudFwiXSAtIGV2ZS5maW5kT25lKFwiY29sbGVjdGlvblwiLCB7IGNvbGxlY3Rpb246IGIgfSlbXCJjb3VudFwiXTtcbiAgfSk7XG4gIHJldHVybiBpbnRlcnNlY3Rpb247XG59XG5cbmZ1bmN0aW9uIGVudGl0eVRvY29sbGVjdGlvbnNBcnJheShlbnRpdHk6IHN0cmluZyk6IEFycmF5PHN0cmluZz4ge1xuICBsZXQgZW50aXRpZXMgPSBldmUuZmluZChcImNvbGxlY3Rpb24gZW50aXRpZXNcIiwgeyBlbnRpdHkgfSk7XG4gIHJldHVybiBlbnRpdGllcy5tYXAoKGEpID0+IGFbXCJjb2xsZWN0aW9uXCJdKTtcbn1cblxuZnVuY3Rpb24gZmluZENvbGxlY3Rpb24obm9kZTogTm9kZSwgY29udGV4dDogQ29udGV4dCk6IGJvb2xlYW4ge1xuICBsZXQgY29sbGVjdGlvbjogQ29sbGVjdGlvbjtcbiAgY29sbGVjdGlvbiA9IGZpbmRFdmVDb2xsZWN0aW9uKG5vZGUubmFtZSk7XG4gIGlmIChjb2xsZWN0aW9uICE9PSB1bmRlZmluZWQpIHtcbiAgICBjb250ZXh0LmZvdW5kLnB1c2gobm9kZSk7XG4gICAgY29sbGVjdGlvbi5ub2RlID0gbm9kZTtcbiAgICBub2RlLmNvbGxlY3Rpb24gPSBjb2xsZWN0aW9uO1xuICAgIG5vZGUucmVwcmVzZW50YXRpb25zLmNvbGxlY3Rpb24gPSBjb2xsZWN0aW9uO1xuICAgIG5vZGUudHlwZSA9IE5vZGVUeXBlcy5DT0xMRUNUSU9OO1xuICAgIG5vZGUuZm91bmQgPSB0cnVlO1xuICAgIG5vZGUucHJvcGVydGllcy5wdXNoKFByb3BlcnRpZXMuQ09MTEVDVElPTik7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgcmV0dXJuIGZhbHNlO1xufVxuXG5mdW5jdGlvbiBmaW5kRW50aXR5KG5vZGU6IE5vZGUsIGNvbnRleHQ6IENvbnRleHQpOiBib29sZWFuIHtcbiAgbGV0IGVudGl0eTogRW50aXR5O1xuICBlbnRpdHkgPSBmaW5kRXZlRW50aXR5KG5vZGUubmFtZSk7XG4gIGlmIChlbnRpdHkgIT09IHVuZGVmaW5lZCkge1xuICAgIGNvbnRleHQuZm91bmQucHVzaChub2RlKTtcbiAgICBlbnRpdHkubm9kZSA9IG5vZGU7XG4gICAgbm9kZS5lbnRpdHkgPSBlbnRpdHk7XG4gICAgbm9kZS5yZXByZXNlbnRhdGlvbnMuZW50aXR5ID0gZW50aXR5O1xuICAgIG5vZGUudHlwZSA9IE5vZGVUeXBlcy5FTlRJVFk7XG4gICAgbm9kZS5mb3VuZCA9IHRydWU7XG4gICAgbm9kZS5wcm9wZXJ0aWVzLnB1c2goUHJvcGVydGllcy5FTlRJVFkpO1xuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIHJldHVybiBmYWxzZTtcbn1cblxuZnVuY3Rpb24gZmluZEF0dHJpYnV0ZShub2RlOiBOb2RlLCBjb250ZXh0OiBDb250ZXh0KTogYm9vbGVhbiB7XG4gIGlmIChub2RlLm5hbWUgPT09IFwiaXMgYVwiKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIGxldCBhdHRyaWJ1dGU6IEF0dHJpYnV0ZTtcbiAgYXR0cmlidXRlID0gZmluZEV2ZUF0dHJpYnV0ZShub2RlLm5hbWUpO1xuICBpZiAoYXR0cmlidXRlICE9PSB1bmRlZmluZWQpIHtcbiAgICBjb250ZXh0LmZvdW5kLnB1c2gobm9kZSk7XG4gICAgYXR0cmlidXRlLm5vZGUgPSBub2RlO1xuICAgIG5vZGUuYXR0cmlidXRlID0gYXR0cmlidXRlO1xuICAgIG5vZGUucmVwcmVzZW50YXRpb25zLmF0dHJpYnV0ZSA9IGF0dHJpYnV0ZTtcbiAgICBub2RlLnR5cGUgPSBOb2RlVHlwZXMuQVRUUklCVVRFO1xuICAgIG5vZGUuZm91bmQgPSB0cnVlO1xuICAgIG5vZGUucHJvcGVydGllcy5wdXNoKFByb3BlcnRpZXMuQVRUUklCVVRFKTtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICByZXR1cm4gZmFsc2U7XG59XG5cbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbi8vIFF1ZXJ5IGZ1bmN0aW9uc1xuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG5pbnRlcmZhY2UgRmllbGQge1xuICBuYW1lOiBzdHJpbmcsXG4gIHZhbHVlOiBzdHJpbmcgfCBudW1iZXIsXG4gIHZhcmlhYmxlOiBib29sZWFuLFxufVxuXG5pbnRlcmZhY2UgVGVybSB7XG4gIHR5cGU6IHN0cmluZyxcbiAgdGFibGU/OiBzdHJpbmcsXG4gIGZpZWxkczogQXJyYXk8RmllbGQ+LFxuICBub2RlPzogTm9kZSxcbn1cblxuZXhwb3J0IGludGVyZmFjZSBRdWVyeSB7XG4gIHR5cGU6IHN0cmluZyxcbiAgdGVybXM6IEFycmF5PFRlcm0+LFxuICBzdWJxdWVyaWVzOiBBcnJheTxRdWVyeT4sXG4gIHByb2plY3RzOiBBcnJheTxUZXJtPixcbiAgdG9TdHJpbmcobnVtYmVyPzogbnVtYmVyKTogc3RyaW5nO1xufVxuXG5mdW5jdGlvbiBhZGRGaWVsZHNUb1Byb2plY3QocHJvamVjdEZpZWxkczogQXJyYXk8RmllbGQ+LCBmaWVsZHM6IEFycmF5PEZpZWxkPik6IHZvaWQge1xuICBsZXQgZmllbGRcbiAgZm9yIChmaWVsZCBvZiBmaWVsZHMpIHtcbiAgICBsZXQgbWF0Y2hpbmdGaWVsZHMgPSBwcm9qZWN0RmllbGRzLmZpbHRlcigoZikgPT4gZi5uYW1lID09PSBmaWVsZC5uYW1lKTtcbiAgICBpZiAobWF0Y2hpbmdGaWVsZHMubGVuZ3RoID09PSAwKSB7XG4gICAgICBwcm9qZWN0RmllbGRzLnB1c2goZmllbGQpO1xuICAgIH1cbiAgfVxufVxuXG5mdW5jdGlvbiBuZWdhdGVUZXJtKHRlcm06IFRlcm0pOiBRdWVyeSB7XG4gIGlmICh0ZXJtLnRhYmxlID09PSBcImVudGl0eSBlYXZzXCIgJiYgdGVybS5maWVsZHNbMl0gIT09IHVuZGVmaW5lZCAmJiB0ZXJtLmZpZWxkc1syXS5uYW1lID09PSBcInZhbHVlXCIpIHtcbiAgICB0ZXJtLmZpZWxkcy5zcGxpY2UoMiwxKTtcbiAgfVxuICBsZXQgbmVnYXRlID0gbmV3UXVlcnkoW3Rlcm1dKTtcbiAgbmVnYXRlLnR5cGUgPSBcIm5lZ2F0ZVwiO1xuICByZXR1cm4gbmVnYXRlO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gbmV3UXVlcnkodGVybXM/OiBBcnJheTxUZXJtPiwgc3VicXVlcmllcz86IEFycmF5PFF1ZXJ5PiwgcHJvamVjdHM/OiBBcnJheTxUZXJtPik6IFF1ZXJ5IHtcbiAgaWYgKHRlcm1zID09PSB1bmRlZmluZWQpIHtcbiAgICB0ZXJtcyA9IFtdO1xuICB9XG4gIGlmIChzdWJxdWVyaWVzID09PSB1bmRlZmluZWQpIHtcbiAgICBzdWJxdWVyaWVzID0gW107XG4gIH1cbiAgaWYgKHByb2plY3RzID09PSB1bmRlZmluZWQpIHtcbiAgICBwcm9qZWN0cyA9IFtdO1xuICB9XG4gIC8vIERlZHVwZSB0ZXJtc1xuICBsZXQgdGVybVN0cmluZ3MgPSB0ZXJtcy5tYXAodGVybVRvU3RyaW5nKTtcbiAgbGV0IHVuaXF1ZVRlcm1zOiBBcnJheTxib29sZWFuPiA9IHRlcm1TdHJpbmdzLm1hcCgodmFsdWUsIGluZGV4LCBzZWxmKSA9PiB7XG4gICAgcmV0dXJuIHNlbGYuaW5kZXhPZih2YWx1ZSkgPT09IGluZGV4O1xuICB9KTsgXG4gIHRlcm1zID0gdGVybXMuZmlsdGVyKCh0ZXJtLCBpbmRleCkgPT4gdW5pcXVlVGVybXNbaW5kZXhdKTtcbiAgbGV0IHF1ZXJ5OiBRdWVyeSA9IHtcbiAgICB0eXBlOiBcInF1ZXJ5XCIsXG4gICAgdGVybXM6IHRlcm1zLFxuICAgIHN1YnF1ZXJpZXM6IHN1YnF1ZXJpZXMsXG4gICAgcHJvamVjdHM6IHByb2plY3RzLFxuICAgIHRvU3RyaW5nOiBxdWVyeVRvU3RyaW5nLFxuICB9XG4gIGZ1bmN0aW9uIHF1ZXJ5VG9TdHJpbmcoZGVwdGg/OiBudW1iZXIpOiBzdHJpbmcge1xuICAgIGlmIChxdWVyeS50ZXJtcy5sZW5ndGggPT09IDAgJiYgcXVlcnkucHJvamVjdHMubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm4gXCJcIjtcbiAgICB9XG4gICAgaWYgKGRlcHRoID09PSB1bmRlZmluZWQpIHtcbiAgICAgIGRlcHRoID0gMDtcbiAgICB9XG4gICAgbGV0IGluZGVudCA9IEFycmF5KGRlcHRoKzEpLmpvaW4oXCJcXHRcIik7XG4gICAgbGV0IHF1ZXJ5U3RyaW5nID0gaW5kZW50ICsgXCIoXCI7XG4gICAgLy8gTWFwIGVhY2ggdGVybS9zdWJxdWVyeS9wcm9qZWN0IHRvIGEgc3RyaW5nXG4gICAgbGV0IHR5cGVTdHJpbmcgPSBxdWVyeS50eXBlO1xuICAgIGxldCB0ZXJtU3RyaW5nID0gcXVlcnkudGVybXMubWFwKCh0ZXJtKSA9PiB0ZXJtVG9TdHJpbmcodGVybSxkZXB0aCsxKSkuam9pbihcIlxcblwiKTtcbiAgICBsZXQgc3VicXVlcmllc1N0cmluZyA9IHF1ZXJ5LnN1YnF1ZXJpZXMubWFwKChxdWVyeSkgPT4gcXVlcnkudG9TdHJpbmcoZGVwdGggKyAxKSkuam9pbihcIlxcblwiKTtcbiAgICBsZXQgcHJvamVjdHNTdHJpbmcgPSBxdWVyeS5wcm9qZWN0cy5tYXAoKHRlcm0pID0+IHRlcm1Ub1N0cmluZyh0ZXJtLGRlcHRoKzEpKS5qb2luKFwiXFxuXCIpO1xuICAgIC8vIE5vdyBjb21wb3NlIHRoZSBxdWVyeSBzdHJpbmdcbiAgICBxdWVyeVN0cmluZyArPSB0eXBlU3RyaW5nO1xuICAgIHF1ZXJ5U3RyaW5nICs9IHRlcm1TdHJpbmcgPT09IFwiXCIgPyBcIlwiIDogXCJcXG5cIiArIHRlcm1TdHJpbmc7XG4gICAgcXVlcnlTdHJpbmcgKz0gc3VicXVlcmllc1N0cmluZyA9PT0gXCJcIiA/IFwiXCIgOiBcIlxcblwiICsgc3VicXVlcmllc1N0cmluZztcbiAgICBxdWVyeVN0cmluZyArPSBwcm9qZWN0c1N0cmluZyA9PT0gXCJcIiA/IFwiXCIgOiBcIlxcblwiICsgcHJvamVjdHNTdHJpbmc7XG4gICAgLy8gQ2xvc2Ugb3V0IHRoZSBxdWVyeVxuICAgIHF1ZXJ5U3RyaW5nICs9IFwiXFxuXCIgKyBpbmRlbnQgKyBcIilcIjtcbiAgICByZXR1cm4gcXVlcnlTdHJpbmc7XG4gIH1cbiAgZnVuY3Rpb24gdGVybVRvU3RyaW5nKHRlcm06IFRlcm0sIGRlcHRoPzogbnVtYmVyKTogc3RyaW5nIHtcbiAgICBpZiAoZGVwdGggPT09IHVuZGVmaW5lZCkge1xuICAgICAgZGVwdGggPSAwO1xuICAgIH1cbiAgICBsZXQgaW5kZW50ID0gQXJyYXkoZGVwdGgrMSkuam9pbihcIlxcdFwiKTtcbiAgICBsZXQgdGVybVN0cmluZyA9IGluZGVudCArIFwiKFwiO1xuICAgIHRlcm1TdHJpbmcgKz0gYCR7dGVybS50eXBlfSBgO1xuICAgIHRlcm1TdHJpbmcgKz0gYCR7dGVybS50YWJsZSA9PT0gdW5kZWZpbmVkID8gXCJcIiA6IGBcIiR7dGVybS50YWJsZX1cIiBgfWA7XG4gICAgdGVybVN0cmluZyArPSB0ZXJtLmZpZWxkcy5tYXAoKGZpZWxkKSA9PiBgOiR7ZmllbGQubmFtZX0gJHtmaWVsZC52YXJpYWJsZSA/IGZpZWxkLnZhbHVlIDogYFwiJHtmaWVsZC52YWx1ZX1cImB9YCkuam9pbihcIiBcIik7XG4gICAgdGVybVN0cmluZyArPSBcIilcIjtcbiAgICByZXR1cm4gdGVybVN0cmluZztcbiAgfVxuICByZXR1cm4gcXVlcnk7XG59XG5cbmZ1bmN0aW9uIGZvcm1RdWVyeShub2RlOiBOb2RlKTogUXVlcnkge1xuICBsZXQgcXVlcnk6IFF1ZXJ5ID0gbmV3UXVlcnkoKTtcbiAgbGV0IHByb2plY3RGaWVsZHM6IEFycmF5PEZpZWxkPiA9IFtdO1xuICBcbiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvLyBIYW5kbGUgdGhlIGNoaWxkcmVuIG5vZGVzXG4gIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgXG4gIGxldCBjaGlsZFF1ZXJpZXMgPSBub2RlLmNoaWxkcmVuLm1hcChmb3JtUXVlcnkpO1xuICAvLyBTdWJzdW1lIGNoaWxkIHF1ZXJpZXNcbiAgbGV0IGNvbWJpbmVkUHJvamVjdEZpZWxkczogQXJyYXk8RmllbGQ+ID0gW107XG4gIGZvciAobGV0IGNRdWVyeSBvZiBjaGlsZFF1ZXJpZXMpIHtcbiAgICBxdWVyeS50ZXJtcyA9IHF1ZXJ5LnRlcm1zLmNvbmNhdChjUXVlcnkudGVybXMpO1xuICAgIHF1ZXJ5LnN1YnF1ZXJpZXMgPSBxdWVyeS5zdWJxdWVyaWVzLmNvbmNhdChjUXVlcnkuc3VicXVlcmllcyk7XG4gICAgLy8gQ29tYmluZSB1bm5hbWVkIHByb2plY3RzXG4gICAgZm9yIChsZXQgcHJvamVjdCBvZiBjUXVlcnkucHJvamVjdHMpIHtcbiAgICAgIGlmIChwcm9qZWN0LnRhYmxlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgYWRkRmllbGRzVG9Qcm9qZWN0KGNvbWJpbmVkUHJvamVjdEZpZWxkcywgcHJvamVjdC5maWVsZHMpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICBpZiAoY29tYmluZWRQcm9qZWN0RmllbGRzLmxlbmd0aCA+IDApIHtcbiAgICBwcm9qZWN0RmllbGRzID0gY29tYmluZWRQcm9qZWN0RmllbGRzO1xuICB9XG4gIC8vIFNvcnQgdGVybXNcbiAgcXVlcnkudGVybXMgPSBxdWVyeS50ZXJtcy5zb3J0KChhLGIpID0+IHtcbiAgICBsZXQgYVJhbmsgPSBzZXRSYW5rKGEudGFibGUpO1xuICAgIGxldCBiUmFuayA9IHNldFJhbmsoYi50YWJsZSk7XG4gICAgZnVuY3Rpb24gc2V0UmFuayh0YWJsZTogc3RyaW5nKTogbnVtYmVyIHtcbiAgICAgIGlmICh0YWJsZSA9PT0gXCJlbnRpdHkgZWF2c1wiKSB7IHJldHVybiAxIH1cbiAgICAgIGVsc2UgaWYgKHRhYmxlID09PSBcImRpcmVjdGlvbmxlc3MgbGlua3NcIikgeyByZXR1cm4gMiB9XG4gICAgICBlbHNlIGlmICh0YWJsZSA9PT0gXCJpcyBhIGF0dHJpYnV0ZXNcIikgeyByZXR1cm4gMyB9XG4gICAgICBlbHNlIHsgcmV0dXJuIDQgfVxuICAgIH1cbiAgICByZXR1cm4gYVJhbmsgLSBiUmFuaztcbiAgfSk7XG4gIFxuICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy8gSGFuZGxlIHRoZSBjdXJyZW50IG5vZGVcbiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIFxuICAvLyBKdXN0IHJldHVybiBhdCB0aGUgcm9vdFxuICBpZiAobm9kZS5oYXNQcm9wZXJ0eShQcm9wZXJ0aWVzLlJPT1QpIHx8IG5vZGUuaGFzUHJvcGVydHkoUHJvcGVydGllcy5BUkdVTUVOVCkpIHtcbiAgICBpZiAocHJvamVjdEZpZWxkcy5sZW5ndGggPiAwKSB7ICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICBsZXQgcHJvamVjdCA9IHtcbiAgICAgICAgdHlwZTogXCJwcm9qZWN0IVwiLFxuICAgICAgICBmaWVsZHM6IHByb2plY3RGaWVsZHMsXG4gICAgICB9XG4gICAgICBxdWVyeS5wcm9qZWN0cy5wdXNoKHByb2plY3QpO1xuICAgIH1cbiAgICByZXR1cm4gcXVlcnk7XG4gIH1cbiAgLy8gSGFuZGxlIGZ1bmN0aW9ucyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIGlmIChub2RlLmhhc1Byb3BlcnR5KFByb3BlcnRpZXMuRlVOQ1RJT04pICYmIFxuICAgICAgbm9kZS5meG4udHlwZSA9PT0gRnVuY3Rpb25UeXBlcy5ORUdBVEUpIHtcbiAgICBsb2coXCJCdWlsZGluZyBuZWdhdGUgdGVybSBmb3I6IFwiICsgbm9kZS5uYW1lKTsgXG4gICAgbGV0IG5lZ2F0ZWRUZXJtID0gcXVlcnkudGVybXMucG9wKCk7XG4gICAgbGV0IG5lZ2F0ZWRRdWVyeSA9IG5lZ2F0ZVRlcm0obmVnYXRlZFRlcm0pO1xuICAgIHF1ZXJ5LnN1YnF1ZXJpZXMucHVzaChuZWdhdGVkUXVlcnkpO1xuICAgIHByb2plY3RGaWVsZHMgPSBbXTtcbiAgfVxuICBpZiAobm9kZS5oYXNQcm9wZXJ0eShQcm9wZXJ0aWVzLkZVTkNUSU9OKSAmJiAoIFxuICAgICAgbm9kZS5meG4udHlwZSA9PT0gRnVuY3Rpb25UeXBlcy5BR0dSRUdBVEUgfHwgXG4gICAgICBub2RlLmZ4bi50eXBlID09PSBGdW5jdGlvblR5cGVzLkNBTENVTEFURSB8fFxuICAgICAgbm9kZS5meG4udHlwZSA9PT0gRnVuY3Rpb25UeXBlcy5GSUxURVIpKSB7XG4gICAgLy8gQ29sbGVjdGlvbiBhbGwgaW5wdXQgYW5kIG91dHB1dCBub2RlcyB3aGljaCB3ZXJlIGZvdW5kXG4gICAgbGV0IGFsbEFyZ3NGb3VuZCA9IG5vZGUuY2hpbGRyZW4uZXZlcnkoKGNoaWxkKSA9PiBjaGlsZC5mb3VuZCk7XG4gICAgICAgIFxuICAgIC8vIElmIHdlIGhhdmUgdGhlIHJpZ2h0IG51bWJlciBvZiBhcmd1bWVudHMsIHByb2NlZWRcbiAgICBsZXQgb3V0cHV0O1xuICAgIGlmIChhbGxBcmdzRm91bmQpIHtcbiAgICAgIGxvZyhcIkJ1aWxkaW5nIGZ1bmN0aW9uIHRlcm0gZm9yOiBcIiArIG5vZGUubmFtZSk7XG4gICAgICBsZXQgYXJncyA9IG5vZGUuY2hpbGRyZW4uZmlsdGVyKChjaGlsZCkgPT4gY2hpbGQuaGFzUHJvcGVydHkoUHJvcGVydGllcy5BUkdVTUVOVCkpLm1hcCgoYXJnKSA9PiBhcmcuY2hpbGRyZW5bMF0pO1xuICAgICAgbGV0IGZpZWxkczogQXJyYXk8RmllbGQ+ID0gYXJncy5tYXAoKGFyZyxpKSA9PiB7XG4gICAgICAgIGlmIChhcmcucGFyZW50Lmhhc1Byb3BlcnR5KFByb3BlcnRpZXMuUk9PVCkpIHtcbiAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB7bmFtZTogbm9kZS5meG4uZmllbGRzW2ldLm5hbWUsIFxuICAgICAgICAgICAgICAgIHZhbHVlOiBhcmcuYXR0cmlidXRlLnZhcmlhYmxlLCBcbiAgICAgICAgICAgICAgICB2YXJpYWJsZTogYXJnLmF0dHJpYnV0ZS5hdHRyaWJ1dGVWYXIgIT09IHVuZGVmaW5lZCA/IGFyZy5hdHRyaWJ1dGUuYXR0cmlidXRlVmFyIDogdHJ1ZVxuICAgICAgICAgICAgICAgfTsgXG4gICAgICB9KS5maWx0ZXIoKGYpID0+IGYgIT09IHVuZGVmaW5lZCk7XG4gICAgICBsZXQgdGVybTogVGVybSA9IHtcbiAgICAgICAgdHlwZTogXCJzZWxlY3RcIixcbiAgICAgICAgdGFibGU6IG5vZGUuZnhuLm5hbWUsXG4gICAgICAgIGZpZWxkczogZmllbGRzLFxuICAgICAgICBub2RlOiBub2RlLFxuICAgICAgfVxuICAgICAgcXVlcnkudGVybXMucHVzaCh0ZXJtKTtcbiAgICAgIC8vIHByb2plY3Qgb3V0cHV0IGlmIG5lY2Vzc2FyeVxuICAgICAgaWYgKG5vZGUuZnhuLnByb2plY3QgPT09IHRydWUpIHtcbiAgICAgICAgcHJvamVjdEZpZWxkcyA9IGFyZ3MuZmlsdGVyKChhcmcpID0+IGFyZy5wYXJlbnQuaGFzUHJvcGVydHkoUHJvcGVydGllcy5PVVRQVVQpKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5tYXAoKGFyZykgPT4ge3JldHVybiB7bmFtZTogbm9kZS5meG4ubmFtZSwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogYXJnLmF0dHJpYnV0ZS52YXJpYWJsZSwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXJpYWJsZTogdHJ1ZX19KTtcbiAgICAgICAgYXJncy5tYXAoKGEpID0+IHtcbiAgICAgICAgICBpZiAoYS5oYXNQcm9wZXJ0eShQcm9wZXJ0aWVzLkFUVFJJQlVURSkpIHtcbiAgICAgICAgICAgIGEuYXR0cmlidXRlLnByb2plY3QgPSBmYWxzZTtcbiAgICAgICAgICAgIGEuYXR0cmlidXRlLnByb2plY3RlZEFzID0gdW5kZWZpbmVkOyAgXG4gICAgICAgICAgfSBlbHNlIGlmIChhLmhhc1Byb3BlcnR5KFByb3BlcnRpZXMuQ09MTEVDVElPTikpIHtcbiAgICAgICAgICAgIGEuY29sbGVjdGlvbi5wcm9qZWN0ID0gZmFsc2U7XG4gICAgICAgICAgICBhLmNvbGxlY3Rpb24ucHJvamVjdGVkQXMgPSB1bmRlZmluZWQ7ICBcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBxdWVyeS5wcm9qZWN0cyA9IFtdOyAvLyBDbGVhcnMgYWxsIHByZXZpb3VzIHByb2plY3RzXG4gICAgICB9XG4gICAgfSBcbiAgfVxuICBpZiAobm9kZS5oYXNQcm9wZXJ0eShQcm9wZXJ0aWVzLkZVTkNUSU9OKSAmJiAoIFxuICAgICAgbm9kZS5meG4udHlwZSA9PT0gRnVuY3Rpb25UeXBlcy5HUk9VUCkpIHtcbiAgICBsZXQgYWxsQXJnc0ZvdW5kID0gbm9kZS5jaGlsZHJlbi5ldmVyeSgoY2hpbGQpID0+IGNoaWxkLmZvdW5kKTtcbiAgICBpZiAoYWxsQXJnc0ZvdW5kKSB7XG4gICAgICBsb2coXCJCdWlsZGluZyBmdW5jdGlvbiB0ZXJtIGZvcjogXCIgKyBub2RlLm5hbWUpO1xuICAgICAgXG4gICAgICBsZXQgZ3JvdXBOb2RlID0gbm9kZS5jaGlsZHJlblsxXS5jaGlsZHJlblswXTtcbiAgICAgIGlmIChncm91cE5vZGUuaGFzUHJvcGVydHkoUHJvcGVydGllcy5DT0xMRUNUSU9OKSkge1xuICAgICAgICBncm91cE5vZGUuY29sbGVjdGlvbi5oYW5kbGVkID0gZmFsc2U7ICBcbiAgICAgIH0gZWxzZSBpZiAoZ3JvdXBOb2RlLmhhc1Byb3BlcnR5KFByb3BlcnRpZXMuQVRUUklCVVRFKSkge1xuICAgICAgICBncm91cE5vZGUuYXR0cmlidXRlLmhhbmRsZWQgPSBmYWxzZTsgIFxuICAgICAgfVxuICAgICAgXG4gICAgICBsZXQgc3VicXVlcnkgPSBxdWVyeTtcbiAgICAgIGxldCBxdWVyeTIgPSBmb3JtUXVlcnkoZ3JvdXBOb2RlKTtcbiAgICAgIHF1ZXJ5ID0gbmV3UXVlcnkoKTtcbiAgICAgIHF1ZXJ5LnN1YnF1ZXJpZXMucHVzaChzdWJxdWVyeSk7XG4gICAgICBxdWVyeS50ZXJtcyA9IHF1ZXJ5LnRlcm1zLmNvbmNhdChxdWVyeTIudGVybXMpOyBcbiAgICB9XG4gIH1cbiAgLy8gSGFuZGxlIGF0dHJpYnV0ZXMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICBpZiAobm9kZS5oYXNQcm9wZXJ0eShQcm9wZXJ0aWVzLkFUVFJJQlVURSkgJiYgIW5vZGUuYXR0cmlidXRlLmhhbmRsZWQpIHtcbiAgICBsb2coXCJCdWlsZGluZyBhdHRyaWJ1dGUgdGVybSBmb3I6IFwiICsgbm9kZS5uYW1lKTtcbiAgICBsZXQgZmllbGRzOiBBcnJheTxGaWVsZD4gPSBbXTtcbiAgICBsZXQgYXR0ciA9IG5vZGUuYXR0cmlidXRlO1xuICAgIGlmIChhdHRyLnJlZnMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgZm9yIChsZXQgcmVmIG9mIGF0dHIucmVmcykge1xuICAgICAgICBsZXQgZW50aXR5VmFyID0gcmVmLmVudGl0eSAhPT0gdW5kZWZpbmVkID8gcmVmLmVudGl0eS5pZCA6IHJlZi5jb2xsZWN0aW9uLnZhcmlhYmxlO1xuICAgICAgICBsZXQgZmllbGRWYXIgPSByZWYuZW50aXR5ICE9PSB1bmRlZmluZWQgJiYgcmVmLmVudGl0eS5lbnRpdHlBdHRyID09PSBmYWxzZSA/IGZhbHNlIDogdHJ1ZTtcbiAgICAgICAgaWYgKGZpZWxkcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICBsZXQgZW50aXR5RmllbGQgPSB7XG4gICAgICAgICAgICBuYW1lOiBcImVudGl0eVwiLCBcbiAgICAgICAgICAgIHZhbHVlOiBlbnRpdHlWYXIsIFxuICAgICAgICAgICAgdmFyaWFibGU6IGZpZWxkVmFyLFxuICAgICAgICAgIH07XG4gICAgICAgICAgZmllbGRzLnB1c2goZW50aXR5RmllbGQpO1xuICAgICAgICB9XG4gICAgICAgIC8vIEJ1aWxkIGEgcXVlcnkgZm9yIGVhY2ggcmVmIGFuZCBtZXJnZSBpdCB3aXRoIHRoZSBjdXJyZW50IHF1ZXJ5XG4gICAgICAgIGxldCByZWZRdWVyeSA9IGZvcm1RdWVyeShyZWYpO1xuICAgICAgICBxdWVyeS50ZXJtcyA9IHF1ZXJ5LnRlcm1zLmNvbmNhdChyZWZRdWVyeS50ZXJtcyk7XG4gICAgICAgIGlmIChyZWZRdWVyeS5wcm9qZWN0cy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgYWRkRmllbGRzVG9Qcm9qZWN0KHByb2plY3RGaWVsZHMsIHJlZlF1ZXJ5LnByb2plY3RzWzBdLmZpZWxkcylcbiAgICAgICAgfVxuICAgICAgfSAgICAgIFxuICAgIH0gICAgICAgICAgICAgXG4gICAgbGV0IGF0dHJGaWVsZCA9IHtcbiAgICAgIG5hbWU6IFwiYXR0cmlidXRlXCIsIFxuICAgICAgdmFsdWU6IGF0dHIuaWQsIFxuICAgICAgdmFyaWFibGU6IGZhbHNlXG4gICAgfTtcbiAgICBmaWVsZHMucHVzaChhdHRyRmllbGQpOyAgICAgICAgICAgXG4gICAgbGV0IHZhbHVlRmllbGQgPSB7XG4gICAgICBuYW1lOiBcInZhbHVlXCIsIFxuICAgICAgdmFsdWU6IGF0dHIudmFyaWFibGUsIFxuICAgICAgdmFyaWFibGU6IGF0dHIuYXR0cmlidXRlVmFyICE9PSB1bmRlZmluZWQgPyBhdHRyLmF0dHJpYnV0ZVZhciA6IHRydWUsXG4gICAgfTtcbiAgICBmaWVsZHMucHVzaCh2YWx1ZUZpZWxkKTsgICAgICAgICAgICBcbiAgICBsZXQgdGVybTogVGVybSA9IHtcbiAgICAgIHR5cGU6IFwic2VsZWN0XCIsXG4gICAgICB0YWJsZTogXCJlbnRpdHkgZWF2c1wiLFxuICAgICAgZmllbGRzOiBmaWVsZHMsXG4gICAgICBub2RlOiBub2RlLFxuICAgIH1cbiAgICBxdWVyeS50ZXJtcy5wdXNoKHRlcm0pO1xuICAgIC8vIHByb2plY3QgaWYgbmVjZXNzYXJ5XG4gICAgaWYgKG5vZGUuYXR0cmlidXRlLnByb2plY3QpIHtcbiAgICAgIGxldCBwcm9qZWN0QXR0cmlidXRlID0ge1xuICAgICAgICBuYW1lOiBhdHRyLmRpc3BsYXlOYW1lLnJlcGxhY2UoLyAvZywnJyksIFxuICAgICAgICB2YWx1ZTogYXR0ci52YXJpYWJsZSwgXG4gICAgICAgIHZhcmlhYmxlOiB0cnVlXG4gICAgICB9O1xuICAgICAgYXR0ci5wcm9qZWN0ZWRBcyA9IHByb2plY3RBdHRyaWJ1dGUubmFtZTtcbiAgICAgIGFkZEZpZWxkc1RvUHJvamVjdChwcm9qZWN0RmllbGRzLCBbcHJvamVjdEF0dHJpYnV0ZV0pO1xuICAgIH1cbiAgICBub2RlLmF0dHJpYnV0ZS5oYW5kbGVkID0gdHJ1ZTtcbiAgfVxuICAvLyBIYW5kbGUgY29sbGVjdGlvbnMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICBpZiAobm9kZS5oYXNQcm9wZXJ0eShQcm9wZXJ0aWVzLkNPTExFQ1RJT04pICYmICFub2RlLmNvbGxlY3Rpb24uaGFuZGxlZCkge1xuICAgIGxvZyhcIkJ1aWxkaW5nIGNvbGxlY3Rpb24gdGVybSBmb3I6IFwiICsgbm9kZS5uYW1lKTtcbiAgICBsZXQgY29sbGVjdGlvbiA9IG5vZGUuY29sbGVjdGlvbjtcbiAgICBsZXQgZW50aXR5RmllbGQgPSB7XG4gICAgICBuYW1lOiBcImVudGl0eVwiLCBcbiAgICAgIHZhbHVlOiBjb2xsZWN0aW9uLnZhcmlhYmxlLCBcbiAgICAgIHZhcmlhYmxlOiB0cnVlXG4gICAgfTtcbiAgICBsZXQgY29sbGVjdGlvbkZpZWxkID0ge1xuICAgICAgbmFtZTogXCJjb2xsZWN0aW9uXCIsIFxuICAgICAgdmFsdWU6IGNvbGxlY3Rpb24uaWQsIFxuICAgICAgdmFyaWFibGU6IGZhbHNlXG4gICAgfTtcbiAgICBsZXQgdGVybTogVGVybSA9IHtcbiAgICAgIHR5cGU6IFwic2VsZWN0XCIsXG4gICAgICB0YWJsZTogXCJpcyBhIGF0dHJpYnV0ZXNcIixcbiAgICAgIGZpZWxkczogW2VudGl0eUZpZWxkLCBjb2xsZWN0aW9uRmllbGRdLFxuICAgICAgbm9kZTogbm9kZSxcbiAgICB9XG4gICAgcXVlcnkudGVybXMucHVzaCh0ZXJtKTtcbiAgICAvLyBwcm9qZWN0IGlmIG5lY2Vzc2FyeVxuICAgIGlmIChub2RlLmNvbGxlY3Rpb24ucHJvamVjdCkge1xuICAgICAgbGV0IHByb2plY3RDb2xsZWN0aW9uID0ge1xuICAgICAgICBuYW1lOiBjb2xsZWN0aW9uLnZhcmlhYmxlLnJlcGxhY2UoLyAvZywnJyksIFxuICAgICAgICB2YWx1ZTogY29sbGVjdGlvbi52YXJpYWJsZSwgXG4gICAgICAgIHZhcmlhYmxlOiB0cnVlXG4gICAgICB9O1xuICAgICAgY29sbGVjdGlvbi5wcm9qZWN0ZWRBcyA9IHByb2plY3RDb2xsZWN0aW9uLm5hbWU7XG4gICAgICBhZGRGaWVsZHNUb1Byb2plY3QocHJvamVjdEZpZWxkcywgW3Byb2plY3RDb2xsZWN0aW9uXSk7XG4gICAgfVxuICAgIG5vZGUuY29sbGVjdGlvbi5oYW5kbGVkID0gdHJ1ZTtcbiAgfVxuICAvLyBIYW5kbGUgZW50aXRpZXMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICBpZiAobm9kZS5oYXNQcm9wZXJ0eShQcm9wZXJ0aWVzLkVOVElUWSkgJiYgIW5vZGUuZW50aXR5LmhhbmRsZWQpIHtcbiAgICBsb2coXCJCdWlsZGluZyBlbnRpdHkgdGVybSBmb3I6IFwiICsgbm9kZS5uYW1lKTtcbiAgICBsZXQgZW50aXR5ID0gbm9kZS5lbnRpdHk7XG4gICAgbGV0IGZpZWxkcyA9IFtdO1xuICAgIGxldCBlbnRpdHlGaWVsZCA9IHtcbiAgICAgIG5hbWU6IFwiZW50aXR5XCIsIFxuICAgICAgdmFsdWU6IGVudGl0eS5lbnRpdHlWYXIgPyBlbnRpdHkudmFyaWFibGUgOiBlbnRpdHkuaWQsIFxuICAgICAgdmFyaWFibGU6IGVudGl0eS5lbnRpdHlWYXIsXG4gICAgfTtcbiAgICBmaWVsZHMucHVzaChlbnRpdHlGaWVsZCk7XG5cbiAgICBpZiAoZW50aXR5LmVudGl0eVZhcikge1xuICAgICAgbGV0IHZhbHVlRmllbGQgPSB7XG4gICAgICAgIG5hbWU6IGVudGl0eS5lbnRpdHlWYXIgPyBcImxpbmtcIiA6IFwidmFsdWVcIiwgXG4gICAgICAgIHZhbHVlOiBlbnRpdHkudmFsdWVWYXIgPyBlbnRpdHkudmFsdWUgOiBlbnRpdHkuaWQsIFxuICAgICAgICB2YXJpYWJsZTogZW50aXR5LnZhbHVlVmFyLFxuICAgICAgfTtcbiAgICAgIGZpZWxkcy5wdXNoKHZhbHVlRmllbGQpOyAgXG4gICAgfVxuICAgIGxldCB0ZXJtOiBUZXJtID0ge1xuICAgICAgdHlwZTogXCJzZWxlY3RcIixcbiAgICAgIHRhYmxlOiBlbnRpdHkuZW50aXR5VmFyID8gXCJkaXJlY3Rpb25sZXNzIGxpbmtzXCIgOiBcImVudGl0eSBlYXZzXCIsXG4gICAgICBmaWVsZHM6IGZpZWxkcyxcbiAgICAgIG5vZGU6IG5vZGUsXG4gICAgfVxuICAgIHF1ZXJ5LnRlcm1zLnB1c2godGVybSk7XG4gICAgLy8gcHJvamVjdCBpZiBuZWNlc3NhcnlcbiAgICBpZiAoZW50aXR5LnByb2plY3QgPT09IHRydWUpIHtcbiAgICAgIGxldCBwcm9qZWN0RW50aXR5ID0ge1xuICAgICAgICBuYW1lOiBlbnRpdHkuZGlzcGxheU5hbWUucmVwbGFjZSgvIC9nLCcnKSxcbiAgICAgICAgdmFsdWU6IGVudGl0eS5pZCwgXG4gICAgICAgIHZhcmlhYmxlOiBmYWxzZVxuICAgICAgfTtcbiAgICAgIGVudGl0eS5wcm9qZWN0ZWRBcyA9IHByb2plY3RFbnRpdHkubmFtZTtcbiAgICAgIGFkZEZpZWxkc1RvUHJvamVjdChwcm9qZWN0RmllbGRzLCBbcHJvamVjdEVudGl0eV0pO1xuICAgIH1cbiAgICBub2RlLmVudGl0eS5oYW5kbGVkID0gdHJ1ZTtcbiAgfVxuICAvLyBQcm9qZWN0IHNvbWV0aGluZyBpZiBuZWNlc3NhcnkgICAgICAgXG4gIGlmIChwcm9qZWN0RmllbGRzLmxlbmd0aCA+IDApIHsgICAgICAgICAgICAgICAgICAgICAgICBcbiAgICBsZXQgcHJvamVjdCA9IHtcbiAgICAgIHR5cGU6IFwicHJvamVjdCFcIixcbiAgICAgIGZpZWxkczogcHJvamVjdEZpZWxkcyxcbiAgICB9XG4gICAgcXVlcnkucHJvamVjdHMucHVzaChwcm9qZWN0KTtcbiAgfVxuICByZXR1cm4gcXVlcnk7XG59XG5cbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbi8vIERlYnVnIHV0aWxpdHkgZnVuY3Rpb25zXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIFxubGV0IGRpdmlkZXIgPSBcIi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXCI7XG5cbmV4cG9ydCBsZXQgZGVidWcgPSBmYWxzZTtcblxuZnVuY3Rpb24gbG9nKHg6IGFueSkge1xuICBpZiAoZGVidWcpIHtcbiAgICBjb25zb2xlLmxvZyh4KTtcbiAgfVxufVxuXG5mdW5jdGlvbiB0b2tlblRvU3RyaW5nKHRva2VuOiBUb2tlbiwgczE/OiBudW1iZXIsIHMyPzogbnVtYmVyLCBzMz86IG51bWJlciwgczQ/OiBudW1iZXIsIHM1PzogbnVtYmVyKTogc3RyaW5nIHtcbiAgbGV0IHByb3BlcnRpZXMgPSBgKCR7dG9rZW4ucHJvcGVydGllcy5tYXAoKHByb3BlcnR5OiBQcm9wZXJ0aWVzKSA9PiBQcm9wZXJ0aWVzW3Byb3BlcnR5XSkuam9pbihcInxcIil9KWA7XG4gIHByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmxlbmd0aCA9PT0gMiA/IFwiXCIgOiBwcm9wZXJ0aWVzO1xuICBsZXQgdG9rZW5TcGFuID0gdG9rZW4uc3RhcnQgPT09IHVuZGVmaW5lZCA/IFwiIFwiIDogYCBbJHt0b2tlbi5zdGFydH0tJHt0b2tlbi5lbmR9XSBgO1xuICBsZXQgc3BhY2VyMSA9IEFycmF5KHMxLWAke3Rva2VuLml4fWAubGVuZ3RoICsgMSkuam9pbihcIiBcIik7XG4gIGxldCBzcGFjZXIyID0gQXJyYXkoczItYCR7dG9rZW4ub3JpZ2luYWxXb3JkfWAubGVuZ3RoICsgMSkuam9pbihcIiBcIik7XG4gIGxldCBzcGFjZXIzID0gQXJyYXkoczMtYCR7dG9rZW4ubm9ybWFsaXplZFdvcmR9YC5sZW5ndGggKyAxKS5qb2luKFwiIFwiKTtcbiAgbGV0IHNwYWNlcjQgPSBBcnJheShzNCAtIGAke01ham9yUGFydHNPZlNwZWVjaFtnZXRNYWpvclBPUyh0b2tlbi5QT1MpXX1gLmxlbmd0aCArIDEpLmpvaW4oXCIgXCIpO1xuICBsZXQgc3BhY2VyNSA9IEFycmF5KHM1IC0gYCR7TWlub3JQYXJ0c09mU3BlZWNoW3Rva2VuLlBPU119YC5sZW5ndGggKyAxKS5qb2luKFwiIFwiKTtcbiAgbGV0IHRva2VuU3RyaW5nID0gYCR7dG9rZW4uaXh9OiR7c3BhY2VyMX0gJHt0b2tlbi5vcmlnaW5hbFdvcmR9JHtzcGFjZXIyfSB8ICR7dG9rZW4ubm9ybWFsaXplZFdvcmR9JHtzcGFjZXIzfSB8ICR7TWFqb3JQYXJ0c09mU3BlZWNoW2dldE1ham9yUE9TKHRva2VuLlBPUyldfSR7c3BhY2VyNH0gfCAke01pbm9yUGFydHNPZlNwZWVjaFt0b2tlbi5QT1NdfSR7c3BhY2VyNX0gfCAke3Byb3BlcnRpZXN9YCA7XG4gIHJldHVybiB0b2tlblN0cmluZztcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHRva2VuQXJyYXlUb1N0cmluZyh0b2tlbnM6IEFycmF5PFRva2VuPik6IHN0cmluZyB7XG4gIGxldCBzMTogbnVtYmVyID0gYCR7dG9rZW5zW3Rva2Vucy5sZW5ndGgtMV0uaXh9YC5sZW5ndGg7IFxuICBsZXQgczI6IG51bWJlciA9IHRva2Vucy5tYXAoKHRva2VuKSA9PiB0b2tlbi5vcmlnaW5hbFdvcmQubGVuZ3RoKS5yZWR1Y2UoKGEsYikgPT4ge1xuICAgIGlmIChiID4gYSkgeyByZXR1cm4gYjsgfSBlbHNlIHsgcmV0dXJuIGE7IH1cbiAgfSk7XG4gIGxldCBzMzogbnVtYmVyID0gdG9rZW5zLm1hcCgodG9rZW4pID0+IHRva2VuLm5vcm1hbGl6ZWRXb3JkLmxlbmd0aCkucmVkdWNlKChhLGIpID0+IHtcbiAgICBpZiAoYiA+IGEpIHsgcmV0dXJuIGI7IH0gZWxzZSB7IHJldHVybiBhOyB9IFxuICB9KTtcbiAgbGV0IHM0OiBudW1iZXIgPSB0b2tlbnMubWFwKCh0b2tlbikgPT4gYCR7TWFqb3JQYXJ0c09mU3BlZWNoW2dldE1ham9yUE9TKHRva2VuLlBPUyldfWAubGVuZ3RoKS5yZWR1Y2UoKGEsYikgPT4ge1xuICAgIGlmIChiID4gYSkgeyByZXR1cm4gYjsgfSBlbHNlIHsgcmV0dXJuIGE7IH0gXG4gIH0pO1xuICBsZXQgczU6IG51bWJlciA9IHRva2Vucy5tYXAoKHRva2VuKSA9PiBgJHtNaW5vclBhcnRzT2ZTcGVlY2hbdG9rZW4uUE9TXX1gLmxlbmd0aCkucmVkdWNlKChhLGIpID0+IHtcbiAgICBpZiAoYiA+IGEpIHsgcmV0dXJuIGI7IH0gZWxzZSB7IHJldHVybiBhOyB9IFxuICB9KTtcbiAgbGV0IHRva2VuQXJyYXlTdHJpbmcgPSB0b2tlbnMubWFwKCh0b2tlbikgPT4gdG9rZW5Ub1N0cmluZyh0b2tlbixzMSxzMixzMyxzNCxzNSkpLmpvaW4oXCJcXG5cIik7XG4gIHJldHVybiBkaXZpZGVyICsgXCJcXG5cIiArIHRva2VuQXJyYXlTdHJpbmcgKyBcIlxcblwiICsgZGl2aWRlcjtcbn1cblxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuLy8gVXRpbGl0eSBmdW5jdGlvbnNcbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuZnVuY3Rpb24gZmxhdHRlbk5lc3RlZEFycmF5KG5lc3RlZEFycmF5OiBBcnJheTxBcnJheTxhbnk+Pik6IEFycmF5PGFueT4ge1xuICBsZXQgZmxhdHRlbmVkOiBBcnJheTxhbnk+ID0gW10uY29uY2F0LmFwcGx5KFtdLG5lc3RlZEFycmF5KTtcbiAgcmV0dXJuIGZsYXR0ZW5lZDtcbn1cblxuZnVuY3Rpb24gb25seVVuaXF1ZSh2YWx1ZSwgaW5kZXgsIHNlbGYpIHsgXG4gIHJldHVybiBzZWxmLmluZGV4T2YodmFsdWUpID09PSBpbmRleDtcbn1cblxuZnVuY3Rpb24gYXJyYXlJbnRlcnNlY3QoYSwgYikge1xuICBsZXQgYWkgPSAwO1xuICBsZXQgYmkgPSAwO1xuICBsZXQgcmVzdWx0ID0gW107XG4gIHdoaWxlIChhaSA8IGEubGVuZ3RoICYmIGJpIDwgYi5sZW5ndGgpIHtcbiAgICBpZiAoYVthaV0gPCBiW2JpXSkgYWkrKztcbiAgICBlbHNlIGlmIChhW2FpXSA+IGJbYmldKSBiaSsrO1xuICAgIGVsc2Uge1xuICAgICAgcmVzdWx0LnB1c2goYVthaV0pO1xuICAgICAgYWkrKztcbiAgICAgIGJpKys7XG4gICAgfVxuICB9XG4gIHJldHVybiByZXN1bHQ7XG59XG5cbmZ1bmN0aW9uIGlzTnVtZXJpYyhuOiBhbnkpOiBib29sZWFuIHtcbiAgcmV0dXJuICFpc05hTihwYXJzZUZsb2F0KG4pKSAmJiBpc0Zpbml0ZShuKTtcbn1cblxuZnVuY3Rpb24gYWxsRm91bmQobm9kZTogTm9kZSk6IGJvb2xlYW4ge1xuICBsZXQgY0ZvdW5kID0gbm9kZS5jaGlsZHJlbi5tYXAoYWxsRm91bmQpLmV2ZXJ5KChjKT0+Yyk7XG4gIGlmIChjRm91bmQgJiYgbm9kZS5mb3VuZCkge1xuICAgIHJldHVybiB0cnVlO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxufSBcbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuZGVjbGFyZSB2YXIgZXhwb3J0cztcbndpbmRvd1tcIk5MUVBcIl0gPSBleHBvcnRzO1xuIiwiLy8vIDxyZWZlcmVuY2UgcGF0aD1cIm1pY3JvUmVhY3QudHNcIiAvPlxuLy8vIDxyZWZlcmVuY2UgcGF0aD1cIi4uL3ZlbmRvci9tYXJrZWQuZC50c1wiIC8+XG5pbXBvcnQgKiBhcyBtaWNyb1JlYWN0IGZyb20gXCIuL21pY3JvUmVhY3RcIjtcbmltcG9ydCAqIGFzIHJ1bnRpbWUgZnJvbSBcIi4vcnVudGltZVwiO1xuaW1wb3J0IHtVSVJlbmRlcmVyfSBmcm9tIFwiLi91aVJlbmRlcmVyXCI7XG5pbXBvcnQge0VOViwgREVCVUcsIHV1aWR9IGZyb20gXCIuL3V0aWxzXCI7XG5cbmV4cG9ydCB2YXIgc3luY2VkVGFibGVzID0gW1wic291cmNlZCBlYXZcIiwgXCJ2aWV3XCIsIFwiYWN0aW9uXCIsIFwiYWN0aW9uIHNvdXJjZVwiLCBcImFjdGlvbiBtYXBwaW5nXCIsIFwiYWN0aW9uIG1hcHBpbmcgY29uc3RhbnRcIiwgXCJhY3Rpb24gbWFwcGluZyBzb3J0ZWRcIiwgXCJhY3Rpb24gbWFwcGluZyBsaW1pdFwiXTtcbmV4cG9ydCB2YXIgZXZlTG9jYWxTdG9yYWdlS2V5ID0gXCJldmVcIjtcblxuLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbi8vIFJlbmRlcmVyXG4vLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG52YXIgcGVyZlN0YXRzO1xudmFyIHBlcmZTdGF0c1VpO1xudmFyIHVwZGF0ZVN0YXQgPSAwO1xuZXhwb3J0IHZhciByZW5kZXJlcjtcbmV4cG9ydCB2YXIgdWlSZW5kZXJlcjtcbmZ1bmN0aW9uIGluaXRSZW5kZXJlcigpIHtcbiAgcmVuZGVyZXIgPSBuZXcgbWljcm9SZWFjdC5SZW5kZXJlcigpO1xuICB1aVJlbmRlcmVyID0gbmV3IFVJUmVuZGVyZXIoZXZlKTtcbiAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChyZW5kZXJlci5jb250ZW50KTtcbiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJyZXNpemVcIiwgcmVuZGVyKTtcbiAgcGVyZlN0YXRzVWkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICBwZXJmU3RhdHNVaS5pZCA9IFwicGVyZlN0YXRzXCI7XG4gIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQocGVyZlN0YXRzVWkpO1xufVxuXG5pZihFTlYgPT09IFwiYnJvd3NlclwiKSB2YXIgcGVyZm9ybWFuY2UgPSB3aW5kb3dbXCJwZXJmb3JtYW5jZVwiXSB8fCB7IG5vdzogKCkgPT4gKG5ldyBEYXRlKCkpLmdldFRpbWUoKSB9XG5cbmV4cG9ydCB2YXIgcmVuZGVyUm9vdHMgPSB7fTtcbmV4cG9ydCBmdW5jdGlvbiByZW5kZXIoKSB7XG4gIGlmKCFyZW5kZXJlciB8fCByZW5kZXJlci5xdWV1ZWQpIHJldHVybjtcbiAgcmVuZGVyZXIucXVldWVkID0gdHJ1ZTtcbiAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGZ1bmN0aW9uKCkge1xuICAgIGxldCBzdGF0czphbnkgPSB7fTtcbiAgICBsZXQgc3RhcnQgPSBwZXJmb3JtYW5jZS5ub3coKTtcblxuICAgIGxldCB0cmVlcyA9IFtdO1xuICAgIGZvciAodmFyIHJvb3QgaW4gcmVuZGVyUm9vdHMpIHtcbiAgICAgIHRyZWVzLnB1c2gocmVuZGVyUm9vdHNbcm9vdF0oKSk7XG4gICAgfVxuXG4gICAgc3RhdHMucm9vdCA9IChwZXJmb3JtYW5jZS5ub3coKSAtIHN0YXJ0KS50b0ZpeGVkKDIpO1xuICAgIGlmICgrc3RhdHMucm9vdCA+IDEwKSBjb25zb2xlLmluZm8oXCJTbG93IHJvb3Q6IFwiICsgc3RhdHMucm9vdCk7XG5cbiAgICBzdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpO1xuICAgIGxldCBkeW5hbWljVUkgPSBldmUuZmluZChcInN5c3RlbSB1aVwiKS5tYXAoKHVpKSA9PiB1aVtcInRlbXBsYXRlXCJdKTtcbiAgICBpZihERUJVRyAmJiBERUJVRy5VSV9DT01QSUxFKSB7XG4gICAgICBjb25zb2xlLmluZm8oXCJjb21waWxpbmdcIiwgZHluYW1pY1VJKTtcbiAgICAgIGNvbnNvbGUuaW5mbyhcIipcIiwgdWlSZW5kZXJlci5jb21waWxlKGR5bmFtaWNVSSkpO1xuICAgIH1cbiAgICB0cmVlcy5wdXNoLmFwcGx5KHRyZWVzLCB1aVJlbmRlcmVyLmNvbXBpbGUoZHluYW1pY1VJKSk7XG4gICAgc3RhdHMudWlDb21waWxlID0gKHBlcmZvcm1hbmNlLm5vdygpIC0gc3RhcnQpLnRvRml4ZWQoMik7XG4gICAgaWYgKCtzdGF0cy51aUNvbXBpbGUgPiAxMCkgY29uc29sZS5pbmZvKFwiU2xvdyB1aSBjb21waWxlOiBcIiArIHN0YXRzLnVpQ29tcGlsZSk7XG5cbiAgICBzdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpO1xuICAgIHJlbmRlcmVyLnJlbmRlcih0cmVlcyk7XG4gICAgc3RhdHMucmVuZGVyID0gKHBlcmZvcm1hbmNlLm5vdygpIC0gc3RhcnQpLnRvRml4ZWQoMik7XG4gICAgc3RhdHMudXBkYXRlID0gdXBkYXRlU3RhdC50b0ZpeGVkKDIpO1xuXG4gICAgbGV0IGh0bWwgPSBcIlwiO1xuICAgIGh0bWwgKz0gYDxzcGFuPnJvb3Q6ICR7c3RhdHMucm9vdH08L3NwYW4+YDtcbiAgICAvLyBodG1sICs9IGA8c3Bhbj51aSBjb21waWxlOiAke3N0YXRzLnVpQ29tcGlsZX08L3NwYW4+YDtcbiAgICBodG1sICs9IGA8c3Bhbj5yZW5kZXI6ICR7c3RhdHMucmVuZGVyfTwvc3Bhbj5gO1xuICAgIGh0bWwgKz0gYDxzcGFuPnVwZGF0ZTogJHtzdGF0cy51cGRhdGV9PC9zcGFuPmA7XG4gICAgcGVyZlN0YXRzVWkuaW5uZXJIVE1MID0gaHRtbDtcbiAgICBwZXJmU3RhdHMgPSBzdGF0cztcblxuICAgIHJlbmRlcmVyLnF1ZXVlZCA9IGZhbHNlO1xuICB9KTtcbn1cblxudmFyIHN0b3JlUXVldWVkID0gZmFsc2U7XG5mdW5jdGlvbiBzdG9yZUxvY2FsbHkoKSB7XG4gIGlmKHN0b3JlUXVldWVkKSByZXR1cm47XG4gIHN0b3JlUXVldWVkID0gdHJ1ZTtcbiAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgbGV0IHNlcmlhbGl6ZWQgPSBldmUuc2VyaWFsaXplKHRydWUpO1xuICAgIGlmIChldmVMb2NhbFN0b3JhZ2VLZXkgPT09IFwiZXZlXCIpIHtcbiAgICAgIGZvciAobGV0IHN5bmNlZCBvZiBzeW5jZWRUYWJsZXMpIHtcbiAgICAgICAgZGVsZXRlIHNlcmlhbGl6ZWRbc3luY2VkXTtcbiAgICAgIH1cbiAgICB9XG4gICAgZGVsZXRlIHNlcmlhbGl6ZWRbXCJwcm92ZW5hbmNlXCJdO1xuICAgIGxvY2FsU3RvcmFnZVtldmVMb2NhbFN0b3JhZ2VLZXldID0gSlNPTi5zdHJpbmdpZnkoc2VyaWFsaXplZCk7XG4gICAgc3RvcmVRdWV1ZWQgPSBmYWxzZTtcbiAgfSwgMTAwMCk7XG59XG5cbi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4vLyBEaXNwYXRjaFxuLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxubGV0IGRpc3BhdGNoZXMgPSB7fTtcblxuZXhwb3J0IGZ1bmN0aW9uIGhhbmRsZShldmVudCwgZnVuYykge1xuICBpZiAoZGlzcGF0Y2hlc1tldmVudF0pIHtcbiAgICBjb25zb2xlLmVycm9yKGBPdmVyd3JpdGluZyBoYW5kbGVyIGZvciAnJHtldmVudH0nYCk7XG4gIH1cbiAgZGlzcGF0Y2hlc1tldmVudF0gPSBmdW5jO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZGlzcGF0Y2goZXZlbnQ/OiBzdHJpbmcsIGluZm8/OiB7IFtrZXk6IHN0cmluZ106IGFueSB9LCBkaXNwYXRjaEluZm8/KSB7XG4gIGxldCByZXN1bHQgPSBkaXNwYXRjaEluZm87XG4gIGlmICghcmVzdWx0KSB7XG4gICAgcmVzdWx0ID0gZXZlLmRpZmYoKTtcbiAgICByZXN1bHQubWV0YS5yZW5kZXIgPSB0cnVlO1xuICAgIHJlc3VsdC5tZXRhLnN0b3JlID0gdHJ1ZTtcbiAgfVxuICByZXN1bHQuZGlzcGF0Y2ggPSAoZXZlbnQsIGluZm8pID0+IHtcbiAgICByZXR1cm4gZGlzcGF0Y2goZXZlbnQsIGluZm8sIHJlc3VsdCk7XG4gIH07XG4gIHJlc3VsdC5jb21taXQgPSAoKSA9PiB7XG4gICAgdmFyIHN0YXJ0ID0gcGVyZm9ybWFuY2Uubm93KCk7XG4gICAgLy8gcmVzdWx0LnJlbW92ZShcImJ1aWx0aW4gZW50aXR5XCIsIHtlbnRpdHk6IFwicmVuZGVyIHBlcmZvcm1hbmNlIHN0YXRpc3RpY3NcIn0pO1xuICAgIC8vIHJlc3VsdC5hZGQoXCJidWlsdGluIGVudGl0eVwiLCB7ZW50aXR5OiBcInJlbmRlciBwZXJmb3JtYW5jZSBzdGF0aXN0aWNzXCIsIGNvbnRlbnQ6IGBcbiAgICAvLyAjIFJlbmRlciBwZXJmb3JtYW5jZSBzdGF0aXN0aWNzICh7aXMgYTogc3lzdGVtfSlcbiAgICAvLyByb290OiB7cm9vdDogJHtwZXJmU3RhdHMucm9vdH19XG4gICAgLy8gdWkgY29tcGlsZToge3VpIGNvbXBpbGU6ICR7cGVyZlN0YXRzLnVpQ29tcGlsZX19XG4gICAgLy8gcmVuZGVyOiB7cmVuZGVyOiAke3BlcmZTdGF0cy5yZW5kZXJ9fVxuICAgIC8vIHVwZGF0ZToge3VwZGF0ZTogJHtwZXJmU3RhdHMudXBkYXRlfX1cbiAgICAvLyBIb3JyaWJsZSBoYWNrLCBkaXNyZWdhcmQgdGhpczoge3BlcmYgc3RhdHM6IHJlbmRlciBwZXJmb3JtYW5jZSBzdGF0aXN0aWNzfVxuICAgIC8vIGB9KTtcbiAgICBpZighcnVudGltZS5JTkNSRU1FTlRBTCkge1xuICAgICAgZXZlLmFwcGx5RGlmZihyZXN1bHQpO1xuICAgIH0gZWxzZSB7XG4gICAgICBldmUuYXBwbHlEaWZmSW5jcmVtZW50YWwocmVzdWx0KTtcbiAgICB9XG4gICAgaWYgKHJlc3VsdC5tZXRhLnJlbmRlcikge1xuICAgICAgcmVuZGVyKCk7XG4gICAgfVxuICAgIGlmIChyZXN1bHQubWV0YS5zdG9yZSkge1xuICAgICAgc3RvcmVMb2NhbGx5KCk7XG4gICAgICBpZiAoZXZlTG9jYWxTdG9yYWdlS2V5ID09PSBcImV2ZVwiKSB7XG4gICAgICAgIHNlbmRDaGFuZ2VTZXQocmVzdWx0KTtcbiAgICAgIH1cbiAgICB9XG4gICAgdXBkYXRlU3RhdCA9IHBlcmZvcm1hbmNlLm5vdygpIC0gc3RhcnQ7XG4gIH1cbiAgaWYoIWV2ZW50KSByZXR1cm4gcmVzdWx0O1xuICBsZXQgZnVuYyA9IGRpc3BhdGNoZXNbZXZlbnRdO1xuICBpZiAoIWZ1bmMpIHtcbiAgICBjb25zb2xlLmVycm9yKGBObyBkaXNwYXRjaGVzIGZvciAnJHtldmVudH0nIHdpdGggJHtKU09OLnN0cmluZ2lmeShpbmZvKSB9YCk7XG4gIH0gZWxzZSB7XG4gICAgZnVuYyhyZXN1bHQsIGluZm8pO1xuICB9XG4gIHJldHVybiByZXN1bHQ7XG59XG5cbi8vIE5vLW9wIGRpc3BhdGNoIHRvIHRyaWdnZXIgYSByZXJlbmRlciBvciBzdGFydCBhIGNoYWluLlxuaGFuZGxlKFwicmVyZW5kZXJcIiwgKGNoYW5nZXM6cnVudGltZS5EaWZmKSA9PiB7XG59KTtcblxuXG4vLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuLy8gU3RhdGVcbi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbmV4cG9ydCB2YXIgZXZlID0gcnVudGltZS5pbmRleGVyKCk7XG5leHBvcnQgdmFyIGluaXRpYWxpemVycyA9IHt9O1xuZXhwb3J0IHZhciBhY3RpdmVTZWFyY2hlcyA9IHt9O1xuXG5leHBvcnQgZnVuY3Rpb24gaW5pdChuYW1lLCBmdW5jKSB7XG4gIGluaXRpYWxpemVyc1tuYW1lXSA9IGZ1bmM7XG59XG5cbmZ1bmN0aW9uIGV4ZWN1dGVJbml0aWFsaXplcnMoKSB7XG4gIGZvciAobGV0IGluaXROYW1lIGluIGluaXRpYWxpemVycykge1xuICAgIGluaXRpYWxpemVyc1tpbml0TmFtZV0oKTtcbiAgfVxufVxuXG4vLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuLy8gV2Vic29ja2V0XG4vLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG52YXIgbWUgPSB1dWlkKCk7XG5pZih0aGlzLmxvY2FsU3RvcmFnZSkge1xuICBpZihsb2NhbFN0b3JhZ2VbXCJtZVwiXSkgbWUgPSBsb2NhbFN0b3JhZ2VbXCJtZVwiXTtcbiAgZWxzZSBsb2NhbFN0b3JhZ2VbXCJtZVwiXSA9IG1lO1xufVxuXG5leHBvcnQgdmFyIHNvY2tldDtcbmZ1bmN0aW9uIGNvbm5lY3RUb1NlcnZlcigpIHtcbiAgc29ja2V0ID0gbmV3IFdlYlNvY2tldChgd3M6Ly8ke3dpbmRvdy5sb2NhdGlvbi5ob3N0bmFtZSB8fCBcImxvY2FsaG9zdFwifTo4MDgwYCk7XG4gIHNvY2tldC5vbmVycm9yID0gKCkgPT4ge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gY29ubmVjdCB0byBzZXJ2ZXIsIGZhbGxpbmcgYmFjayB0byBsb2NhbCBzdG9yYWdlXCIpO1xuICAgIGV2ZUxvY2FsU3RvcmFnZUtleSA9IFwibG9jYWwtZXZlXCI7XG4gICAgZXhlY3V0ZUluaXRpYWxpemVycygpO1xuICAgIHJlbmRlcigpO1xuICB9XG4gIHNvY2tldC5vbm9wZW4gPSAoKSA9PiB7XG4gICAgc2VuZFNlcnZlcihcImNvbm5lY3RcIiwgbWUpO1xuICB9XG4gIHNvY2tldC5vbm1lc3NhZ2UgPSAoZGF0YSkgPT4ge1xuICAgIGxldCBwYXJzZWQgPSBKU09OLnBhcnNlKGRhdGEuZGF0YSk7XG4gICAgY29uc29sZS5sb2coXCJXUyBNRVNTQUdFOlwiLCBwYXJzZWQpO1xuXG4gICAgaWYgKHBhcnNlZC5raW5kID09PSBcImxvYWRcIikge1xuICAgICAgLy8gZXZlLmxvYWQocGFyc2VkLmRhdGEpO1xuICAgICAgZXhlY3V0ZUluaXRpYWxpemVycygpO1xuICAgICAgcmVuZGVyKCk7XG4gICAgfSBlbHNlIGlmIChwYXJzZWQua2luZCA9PT0gXCJjaGFuZ2VzZXRcIikge1xuICAgICAgbGV0IGRpZmYgPSBldmUuZGlmZigpO1xuICAgICAgZGlmZi50YWJsZXMgPSBwYXJzZWQuZGF0YTtcbiAgICAgIGV2ZS5hcHBseURpZmYoZGlmZik7XG4gICAgICByZW5kZXIoKTtcbiAgICB9XG4gIH07XG59XG5cbmZ1bmN0aW9uIHNlbmRTZXJ2ZXIobWVzc2FnZUtpbmQsIGRhdGEpIHtcbiAgaWYgKCFzb2NrZXQpIHJldHVybjtcbiAgc29ja2V0LnNlbmQoSlNPTi5zdHJpbmdpZnkoeyBraW5kOiBtZXNzYWdlS2luZCwgbWUsIHRpbWU6IChuZXcgRGF0ZSkuZ2V0VGltZSgpLCBkYXRhIH0pKTtcbn1cblxuZnVuY3Rpb24gc2VuZENoYW5nZVNldChjaGFuZ2VzZXQpIHtcbiAgaWYgKCFzb2NrZXQpIHJldHVybjtcbiAgbGV0IGNoYW5nZXMgPSB7fTtcbiAgbGV0IHNlbmQgPSBmYWxzZTtcbiAgZm9yIChsZXQgdGFibGUgb2Ygc3luY2VkVGFibGVzKSB7XG4gICAgaWYgKGNoYW5nZXNldC50YWJsZXNbdGFibGVdKSB7XG4gICAgICBzZW5kID0gdHJ1ZTtcbiAgICAgIGNoYW5nZXNbdGFibGVdID0gY2hhbmdlc2V0LnRhYmxlc1t0YWJsZV07XG4gICAgfVxuICB9XG4gIGlmIChzZW5kKSBzZW5kU2VydmVyKFwiY2hhbmdlc2V0XCIsIGNoYW5nZXMpO1xufVxuXG4vLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuLy8gR29cbi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5pZihFTlYgPT09IFwiYnJvd3NlclwiKSB7XG4gIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJET01Db250ZW50TG9hZGVkXCIsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgaW5pdFJlbmRlcmVyKCk7XG4gICAgLy8gY29ubmVjdFRvU2VydmVyKCk7XG4gICAgZXZlTG9jYWxTdG9yYWdlS2V5ID0gXCJsb2NhbC1ldmVcIjtcbiAgICBleGVjdXRlSW5pdGlhbGl6ZXJzKCk7XG4gICAgcmVuZGVyKCk7XG4gIH0pO1xufVxuXG5pbml0KFwibG9hZCBkYXRhXCIsZnVuY3Rpb24oKSB7XG4gIGxldCBzdG9yZWQgPSBsb2NhbFN0b3JhZ2VbZXZlTG9jYWxTdG9yYWdlS2V5XTtcbiAgaWYoc3RvcmVkKSB7XG4gICAgZXZlLmxvYWQoc3RvcmVkKTtcbiAgfVxufSk7XG5cbmRlY2xhcmUgdmFyIGV4cG9ydHM7XG5pZihFTlYgPT09IFwiYnJvd3NlclwiKSB3aW5kb3dbXCJhcHBcIl0gPSBleHBvcnRzO1xuIiwiaW1wb3J0IHt1bnBhZCwgdGl0bGVjYXNlLCBidWlsdGluSWR9IGZyb20gXCIuL3V0aWxzXCJcbmltcG9ydCAqIGFzIHJ1bnRpbWUgZnJvbSBcIi4vcnVudGltZVwiXG5pbXBvcnQgKiBhcyBhcHAgZnJvbSBcIi4vYXBwXCJcbmltcG9ydCB7ZXZlfSBmcm9tIFwiLi9hcHBcIlxuaW1wb3J0IHtVSUVsZW0sIHBhcnNlRFNMLCBBcnRpZmFjdHN9IGZyb20gXCIuL3BhcnNlclwiXG5pbXBvcnQge25vcm1hbGl6ZVN0cmluZ30gZnJvbSBcIi4vTkxRdWVyeVBhcnNlclwiXG5pbXBvcnQge1VJfSBmcm9tIFwiLi91aVJlbmRlcmVyXCJcblxuZXhwb3J0IHZhciBpeGVyID0gZXZlO1xuZGVjbGFyZSB2YXIgdXVpZDtcblxuLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuLy8gVXRpbGl0aWVzXG4vLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbnJ1bnRpbWUuZGVmaW5lKFwibm9ybWFsaXplIHN0cmluZ1wiLCB7cmVzdWx0OiBcInJlc3VsdFwifSwgZnVuY3Rpb24odGV4dCkge1xuICBpZih0eXBlb2YgdGV4dCA9PT0gXCJzdHJpbmdcIikge1xuICAgIHJldHVybiB7cmVzdWx0OiBub3JtYWxpemVTdHJpbmcodGV4dCl9O1xuICB9XG4gIHJldHVybiB7cmVzdWx0OiB0ZXh0fTtcbn0pXG5cbi8vIGV4cG9ydCBmdW5jdGlvbiBVSUZyb21EU0woc3RyOnN0cmluZyk6VUkge1xuLy8gICBmdW5jdGlvbiBwcm9jZXNzRWxlbShkYXRhOlVJRWxlbSk6VUkge1xuLy8gICAgIGxldCBlbGVtID0gbmV3IFVJKGRhdGEuaWQgfHwgdXVpZCgpKTtcbi8vICAgICBpZihkYXRhLmJpbmRpbmcpIGVsZW0uYmluZChkYXRhLmJpbmRpbmdLaW5kID09PSBcInF1ZXJ5XCIgPyBwYXJzZURTTChkYXRhLmJpbmRpbmcpO1xuLy8gICAgIGlmKGRhdGEuZW1iZWRkZWQpIGVsZW0uZW1iZWQoZGF0YS5lbWJlZGRlZCk7XG4vLyAgICAgaWYoZGF0YS5hdHRyaWJ1dGVzKSBlbGVtLmF0dHJpYnV0ZXMoZGF0YS5hdHRyaWJ1dGVzKTtcbi8vICAgICBpZihkYXRhLmV2ZW50cykgZWxlbS5ldmVudHMoZGF0YS5ldmVudHMpO1xuLy8gICAgIGlmKGRhdGEuY2hpbGRyZW4pIHtcbi8vICAgICAgIGZvcihsZXQgY2hpbGQgb2YgZGF0YS5jaGlsZHJlbikgZWxlbS5jaGlsZChwcm9jZXNzRWxlbShjaGlsZCkpO1xuLy8gICAgIH1cbi8vICAgICByZXR1cm4gZWxlbTtcbi8vICAgfVxuLy8gICByZXR1cm4gcHJvY2Vzc0VsZW0ocGFyc2VVSShzdHIpKTtcbi8vIH1cblxuY2xhc3MgQlNQaGFzZSB7XG4gIHByb3RlY3RlZCBfdmlld3M6e1t2aWV3OnN0cmluZ106IHN0cmluZ30gPSB7fTtcbiAgcHJvdGVjdGVkIF92aWV3RmllbGRzOntbdmlldzpzdHJpbmddOiBzdHJpbmdbXX0gPSB7fTtcbiAgcHJvdGVjdGVkIF9lbnRpdGllczpzdHJpbmdbXSA9IFtdO1xuICBwcm90ZWN0ZWQgX3Vpczp7W3VpOnN0cmluZ106IFVJfSA9IHt9O1xuICBwcm90ZWN0ZWQgX3F1ZXJpZXM6e1txdWVyeTpzdHJpbmddOiBydW50aW1lLlF1ZXJ5fSA9IHt9O1xuICBwcm90ZWN0ZWQgX25hbWVzOntbbmFtZTpzdHJpbmddOiBzdHJpbmd9ID0ge307XG5cbiAgY29uc3RydWN0b3IocHVibGljIGl4ZXI6cnVudGltZS5JbmRleGVyLCBwdWJsaWMgY2hhbmdlc2V0ID0gaXhlci5kaWZmKCkpIHt9XG5cbiAgdmlld0tpbmQodmlldzpzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5fdmlld3Nbdmlld107XG4gIH1cbiAgdmlld0ZpZWxkcyh2aWV3OnN0cmluZykge1xuICAgIHJldHVybiB0aGlzLl92aWV3RmllbGRzW3ZpZXddO1xuICB9XG4gIGFwcGx5KG51a2VFeGlzdGluZz86Ym9vbGVhbikge1xuICAgIGZvcihsZXQgdmlldyBpbiB0aGlzLl92aWV3cykge1xuICAgICAgaWYodGhpcy5fdmlld3Nbdmlld10gPT09IFwidGFibGVcIikgaXhlci5hZGRUYWJsZSh2aWV3LCB0aGlzLl92aWV3RmllbGRzW3ZpZXddKTtcbiAgICB9XG4gICAgaWYobnVrZUV4aXN0aW5nKSB7XG4gICAgICBmb3IobGV0IHZpZXcgaW4gdGhpcy5fdmlld3MpIHtcbiAgICAgICAgaWYodGhpcy5fdmlld3Nbdmlld10gIT09IFwidGFibGVcIikgdGhpcy5jaGFuZ2VzZXQubWVyZ2UocnVudGltZS5RdWVyeS5yZW1vdmUodmlldywgdGhpcy5peGVyKSk7XG4gICAgICB9XG4gICAgICBmb3IobGV0IGVudGl0eSBvZiB0aGlzLl9lbnRpdGllcykgdGhpcy5jaGFuZ2VzZXQucmVtb3ZlKFwiYnVpbHRpbiBlbnRpdHlcIiwge2VudGl0eX0pO1xuICAgICAgZm9yKGxldCB1aSBpbiB0aGlzLl91aXMpIHRoaXMuY2hhbmdlc2V0Lm1lcmdlKFVJLnJlbW92ZSh1aSwgdGhpcy5peGVyKSk7XG4gICAgfVxuICAgIGl4ZXIuYXBwbHlEaWZmKHRoaXMuY2hhbmdlc2V0KTtcbiAgfVxuXG4gIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy8gTWFjcm9zXG4gIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgYWRkRmFjdCh0YWJsZTpzdHJpbmcsIGZhY3Q6e30pIHtcbiAgICB0aGlzLmNoYW5nZXNldC5hZGQodGFibGUsIGZhY3QpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgYWRkRW50aXR5KGVudGl0eTpzdHJpbmcsIG5hbWU6c3RyaW5nLCBraW5kczpzdHJpbmdbXSwgYXR0cmlidXRlcz86e30sIGV4dHJhQ29udGVudD86c3RyaW5nKSB7XG4gICAgZW50aXR5ID0gYnVpbHRpbklkKGVudGl0eSk7XG4gICAgdGhpcy5fbmFtZXNbbmFtZV0gPSBlbnRpdHk7XG4gICAgdGhpcy5fZW50aXRpZXMucHVzaChlbnRpdHkpO1xuICAgIHRoaXMuYWRkRmFjdChcImRpc3BsYXkgbmFtZVwiLCB7aWQ6IGVudGl0eSwgbmFtZTogbmFtZX0pO1xuICAgIGxldCBpc0FzID0gW107XG4gICAgZm9yKGxldCBraW5kIG9mIGtpbmRzKSB7XG4gICAgICBsZXQgc291cmNlSWQgPSBgJHtlbnRpdHl9LGlzIGEsJHtraW5kfWA7XG4gICAgICBpc0FzLnB1c2goYHske2tpbmR9fHJlcD1saW5rOyBlYXYgc291cmNlID0gJHtzb3VyY2VJZH19YCk7XG4gICAgICBsZXQgY29sbEVudGl0eSA9IGJ1aWx0aW5JZChraW5kKTtcbiAgICAgIHRoaXMuYWRkRmFjdChcImRpc3BsYXkgbmFtZVwiLCB7aWQ6IGNvbGxFbnRpdHksIG5hbWU6IGtpbmR9KTtcbiAgICAgIHRoaXMuYWRkRmFjdChcInNvdXJjZWQgZWF2XCIsIHtlbnRpdHksIGF0dHJpYnV0ZTogXCJpcyBhXCIsIHZhbHVlOiBjb2xsRW50aXR5LCBzb3VyY2U6IHNvdXJjZUlkfSlcbiAgICB9XG4gICAgbGV0IGNvbGxlY3Rpb25zVGV4dCA9IFwiXCI7XG4gICAgaWYoaXNBcy5sZW5ndGgpXG4gICAgICBjb2xsZWN0aW9uc1RleHQgPSBgJHt0aXRsZWNhc2UobmFtZSl9IGlzIGEgJHtpc0FzLnNsaWNlKDAsIC0xKS5qb2luKFwiLCBcIil9ICR7aXNBcy5sZW5ndGggPiAxID8gXCJhbmRcIiA6IFwiXCJ9ICR7aXNBc1tpc0FzLmxlbmd0aCAtIDFdfS5gO1xuICAgIGxldCBjb250ZW50ID0gdW5wYWQoNikgYFxuICAgICAgJHtjb2xsZWN0aW9uc1RleHR9XG4gICAgYDtcbiAgICBpZihhdHRyaWJ1dGVzKSB7XG4gICAgICBmb3IobGV0IGF0dHIgaW4gYXR0cmlidXRlcykge1xuICAgICAgICBsZXQgc291cmNlSWQgPSBgJHtlbnRpdHl9LCR7YXR0cn0sJHthdHRyaWJ1dGVzW2F0dHJdfWA7XG4gICAgICAgIGxldCB2YWx1ZSA9IHRoaXMuX25hbWVzW2F0dHJpYnV0ZXNbYXR0cl1dIHx8IGF0dHJpYnV0ZXNbYXR0cl07XG4gICAgICAgIHRoaXMuYWRkRmFjdChcInNvdXJjZWQgZWF2XCIsIHtlbnRpdHksIGF0dHJpYnV0ZTogYXR0ciwgdmFsdWUsIHNvdXJjZTogc291cmNlSWR9KTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYoZXh0cmFDb250ZW50KSBjb250ZW50ICs9IFwiXFxuXCIgKyBleHRyYUNvbnRlbnQ7XG4gICAgbGV0IHBhZ2UgPSBgJHtlbnRpdHl9fHJvb3RgO1xuICAgIHRoaXMuYWRkRmFjdChcInBhZ2UgY29udGVudFwiLCB7cGFnZSwgY29udGVudH0pO1xuICAgIHRoaXMuYWRkRmFjdChcImVudGl0eSBwYWdlXCIsIHtlbnRpdHksIHBhZ2V9KTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIGFkZFZpZXcodmlldzpzdHJpbmcsIGtpbmQ6c3RyaW5nLCBmaWVsZHM6c3RyaW5nW10pIHtcbiAgICB0aGlzLl92aWV3c1t2aWV3XSA9IGtpbmQ7XG4gICAgdGhpcy5fdmlld0ZpZWxkc1t2aWV3XSA9IGZpZWxkcztcbiAgICB0aGlzLmFkZEZhY3QoXCJ2aWV3XCIsIHt2aWV3LCBraW5kOiBraW5kfSk7XG4gICAgZm9yKGxldCBmaWVsZCBvZiBmaWVsZHMpIHRoaXMuYWRkRmFjdChcImZpZWxkXCIsIHt2aWV3LCBmaWVsZH0pO1xuICAgIGxldCBlbnRpdHkgPSBgJHt2aWV3fSB2aWV3YDtcbiAgICB0aGlzLmFkZEVudGl0eShlbnRpdHksIGVudGl0eSwgW1wic3lzdGVtXCIsIGtpbmRdLCB1bmRlZmluZWQsIHVucGFkKDYpIGBcbiAgICAgICMjIEZpZWxkc1xuICAgICAgJHtmaWVsZHMubWFwKChmaWVsZCkgPT4gYCogJHtmaWVsZH1gKS5qb2luKFwiXFxuICAgICAgXCIpfVxuICAgIGApO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgYWRkVGFibGUodmlldzpzdHJpbmcsIGZpZWxkczpzdHJpbmdbXSkge1xuICAgIHRoaXMuYWRkVmlldyh2aWV3LCBcInRhYmxlXCIsIGZpZWxkcyk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBhZGRVbmlvbih2aWV3OnN0cmluZywgZmllbGRzOnN0cmluZ1tdLCBidWlsdGluOmJvb2xlYW4gPSB0cnVlKSB7XG4gICAgdGhpcy5hZGRWaWV3KHZpZXcsIFwidW5pb25cIiwgZmllbGRzKTtcbiAgICBpZihidWlsdGluKSB7XG4gICAgICBsZXQgdGFibGUgPSBgYnVpbHRpbiAke3ZpZXd9YDtcbiAgICAgIHRoaXMuYWRkVGFibGUodGFibGUsIGZpZWxkcyk7XG4gICAgICB0aGlzLmFkZFVuaW9uTWVtYmVyKHZpZXcsIHRhYmxlKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIGFkZFVuaW9uTWVtYmVyKHVuaW9uOnN0cmluZywgbWVtYmVyOiBzdHJpbmcsIG1hcHBpbmc/Ont9KSB7XG4gICAgLy8gYXBwbHkgdGhlIG5hdHVyYWwgbWFwcGluZy5cbiAgICBpZighbWFwcGluZykge1xuICAgICAgaWYodGhpcy52aWV3S2luZCh1bmlvbikgIT09IFwidW5pb25cIikgdGhyb3cgbmV3IEVycm9yKGBVbmlvbiAnJHt1bmlvbn0nIG11c3QgYmUgYWRkZWQgYmVmb3JlIGFkZGluZyBtZW1iZXJzYCk7XG4gICAgICBtYXBwaW5nID0ge307XG4gICAgICBmb3IobGV0IGZpZWxkIG9mIHRoaXMudmlld0ZpZWxkcyh1bmlvbikpIG1hcHBpbmdbZmllbGRdID0gZmllbGQ7XG4gICAgfVxuICAgIGxldCBhY3Rpb24gPSBgJHt1bmlvbn0gPC0tICR7bWVtYmVyfSA8LS0gJHtKU09OLnN0cmluZ2lmeShtYXBwaW5nKX1gO1xuICAgIHRoaXMuYWRkRmFjdChcImFjdGlvblwiLCB7dmlldzogdW5pb24sIGFjdGlvbiwga2luZDogXCJ1bmlvblwiLCBpeDogMH0pXG4gICAgICAuYWRkRmFjdChcImFjdGlvbiBzb3VyY2VcIiwge2FjdGlvbiwgXCJzb3VyY2Ugdmlld1wiOiBtZW1iZXJ9KTtcblxuICAgIGZvcihsZXQgZmllbGQgaW4gbWFwcGluZykge1xuICAgICAgbGV0IG1hcHBlZCA9IG1hcHBpbmdbZmllbGRdO1xuICAgICAgaWYobWFwcGVkLmNvbnN0cnVjdG9yID09PSBBcnJheSkge1xuICAgICAgICB0aGlzLmFkZEZhY3QoXCJhY3Rpb24gbWFwcGluZyBjb25zdGFudFwiLCB7YWN0aW9uLCBmcm9tOiBmaWVsZCwgXCJ2YWx1ZVwiOiBtYXBwZWRbMF19KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuYWRkRmFjdChcImFjdGlvbiBtYXBwaW5nXCIsIHthY3Rpb24sIGZyb206IGZpZWxkLCBcInRvIHNvdXJjZVwiOiBtZW1iZXIsIFwidG8gZmllbGRcIjogbWFwcGVkfSk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgYWRkUXVlcnkodmlldzpzdHJpbmcsIHF1ZXJ5OnJ1bnRpbWUuUXVlcnkpIHtcbiAgICBxdWVyeS5uYW1lID0gdmlldztcbiAgICB0aGlzLl9xdWVyaWVzW3ZpZXddID0gcXVlcnk7XG4gICAgdGhpcy5hZGRWaWV3KHZpZXcsIFwicXVlcnlcIiwgT2JqZWN0LmtleXMocXVlcnkucHJvamVjdGlvbk1hcCB8fCB7fSkpO1xuICAgIHRoaXMuY2hhbmdlc2V0Lm1lcmdlKHF1ZXJ5LmNoYW5nZXNldCh0aGlzLml4ZXIpKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIGFkZEFydGlmYWN0cyhhcnRpZmFjdHM6QXJ0aWZhY3RzKSB7XG4gICAgbGV0IHZpZXdzID0gYXJ0aWZhY3RzLnZpZXdzO1xuICAgIGZvcihsZXQgdmlldyBpbiBhcnRpZmFjdHMudmlld3MpIHtcbiAgICAgIHRoaXMuX3ZpZXdzW3ZpZXddID0gXCJxdWVyeVwiO1xuICAgIH1cbiAgICBmb3IobGV0IGlkIGluIHZpZXdzKSB0aGlzLmNoYW5nZXNldC5tZXJnZSh2aWV3c1tpZF0uY2hhbmdlc2V0KGV2ZSkpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgYWRkVUkoaWQ6c3RyaW5nLCB1aTpVSSkge1xuICAgIHVpLmlkID0gaWQ7XG4gICAgdGhpcy5fdWlzW2lkXSA9IHVpO1xuICAgIHRoaXMuYWRkRW50aXR5KGlkLCBpZCwgW1wic3lzdGVtXCIsIFwidWlcIl0pO1xuICAgIHRoaXMuY2hhbmdlc2V0Lm1lcmdlKHVpLmNoYW5nZXNldCh0aGlzLml4ZXIpKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG59XG5cbi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbi8vIFJ1bnRpbWUgU2V0dXBcbi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuYXBwLmluaXQoXCJib290c3RyYXBcIiwgZnVuY3Rpb24gYm9vdHN0cmFwKCkge1xuICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vIEVudGl0eSBTeXN0ZW1cbiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICBsZXQgcGhhc2UgPSBuZXcgQlNQaGFzZShldmUpO1xuICBwaGFzZS5jaGFuZ2VzZXQuYWRkTWFueShcImRpc3BsYXkgbmFtZVwiLCBbe2lkOiBcImlzIGFcIiwgbmFtZTogXCJpcyBhXCJ9LCB7aWQ6IFwiY29udGVudFwiLCBuYW1lOiBcImNvbnRlbnRcIn0sIHtpZDogXCJhcnRpZmFjdFwiLCBuYW1lOiBcImFydGlmYWN0XCJ9XSk7XG4gIHBoYXNlLmFkZFRhYmxlKFwibWFudWFsIGVudGl0eVwiLCBbXCJlbnRpdHlcIiwgXCJjb250ZW50XCJdKTtcbiAgcGhhc2UuYWRkVGFibGUoXCJzb3VyY2VkIGVhdlwiLCBbXCJlbnRpdHlcIiwgXCJhdHRyaWJ1dGVcIiwgXCJ2YWx1ZVwiLCBcInNvdXJjZVwiXSk7XG4gIHBoYXNlLmFkZFRhYmxlKFwicGFnZSBjb250ZW50XCIsIFtcInBhZ2VcIiwgXCJjb250ZW50XCJdKTtcbiAgcGhhc2UuYWRkVGFibGUoXCJlbnRpdHkgcGFnZVwiLCBbXCJlbnRpdHlcIiwgXCJwYWdlXCJdKTtcbiAgcGhhc2UuYWRkVGFibGUoXCJhY3Rpb24gZW50aXR5XCIsIFtcImVudGl0eVwiLCBcImNvbnRlbnRcIiwgXCJzb3VyY2VcIl0pO1xuICBwaGFzZVxuICAgIC5hZGRFbnRpdHkoXCJlbnRpdHlcIiwgXCJlbnRpdHlcIiwgW1wic3lzdGVtXCJdKVxuICAgIC5hZGRFbnRpdHkoXCJjb2xsZWN0aW9uXCIsIFwiY29sbGVjdGlvblwiLCBbXCJzeXN0ZW1cIl0pXG4gICAgLmFkZEVudGl0eShcInN5c3RlbVwiLCBcInN5c3RlbVwiLCBbXCJzeXN0ZW1cIiwgXCJjb2xsZWN0aW9uXCJdKVxuICAgIC5hZGRFbnRpdHkoXCJ1bmlvblwiLCBcInVuaW9uXCIsIFtcInN5c3RlbVwiLCBcImNvbGxlY3Rpb25cIl0pXG4gICAgLmFkZEVudGl0eShcInF1ZXJ5XCIsIFwicXVlcnlcIiwgW1wic3lzdGVtXCIsIFwiY29sbGVjdGlvblwiXSlcbiAgICAuYWRkRW50aXR5KFwidGFibGVcIiwgXCJ0YWJsZVwiLCBbXCJzeXN0ZW1cIiwgXCJjb2xsZWN0aW9uXCJdKVxuICAgIC5hZGRFbnRpdHkoXCJ1aVwiLCBcInVpXCIsIFtcInN5c3RlbVwiLCBcImNvbGxlY3Rpb25cIl0pXG4gICAgLmFkZEVudGl0eShcImhvbWVcIiwgXCJob21lXCIsIFtcInN5c3RlbVwiXSwgdW5kZWZpbmVkLCB1bnBhZCg2KSBgXG4gICAgICB7ZW50aXR5fHJlcCA9IGRpcmVjdG9yeX1cbiAgICBgKTtcblxuICBwaGFzZS5hZGRVbmlvbihcImVudGl0eSBlYXZzXCIsIFtcImVudGl0eVwiLCBcImF0dHJpYnV0ZVwiLCBcInZhbHVlXCJdLCB0cnVlKVxuICAgIC5hZGRVbmlvbk1lbWJlcihcImVudGl0eSBlYXZzXCIsIFwiZ2VuZXJhdGVkIGVhdlwiLCB7ZW50aXR5OiBcImVudGl0eVwiLCBhdHRyaWJ1dGU6IFwiYXR0cmlidXRlXCIsIHZhbHVlOiBcInZhbHVlXCJ9KVxuICAgIC5hZGRVbmlvbk1lbWJlcihcImVudGl0eSBlYXZzXCIsIFwic291cmNlZCBlYXZcIiwge2VudGl0eTogXCJlbnRpdHlcIiwgYXR0cmlidXRlOiBcImF0dHJpYnV0ZVwiLCB2YWx1ZTogXCJ2YWx1ZVwifSlcbiAgICAvLyB0aGlzIGlzIGEgc3RvcmVkIHVuaW9uIHRoYXQgaXMgdXNlZCBieSB0aGUgYWRkIGVhdiBhY3Rpb24gdG8gdGFrZSBxdWVyeSByZXN1bHRzIGFuZFxuICAgIC8vIHB1c2ggdGhlbSBpbnRvIGVhdnMsIGUuZy4gc3VtIHNhbGFyaWVzIHBlciBkZXBhcnRtZW50IC0+IFt0b3RhbCBzYWxhcnkgPSAqXVxuICAgIC5hZGRVbmlvbk1lbWJlcihcImVudGl0eSBlYXZzXCIsIFwiYWRkZWQgZWF2c1wiKTtcblxuICBwaGFzZS5hZGRVbmlvbihcImVudGl0eSBsaW5rc1wiLCBbXCJlbnRpdHlcIiwgXCJsaW5rXCIsIFwidHlwZVwiXSlcbiAgICAuYWRkVW5pb25NZW1iZXIoXCJlbnRpdHkgbGlua3NcIiwgXCJlYXYgZW50aXR5IGxpbmtzXCIpXG4gICAgLmFkZFVuaW9uTWVtYmVyKFwiZW50aXR5IGxpbmtzXCIsIFwiaXMgYSBhdHRyaWJ1dGVzXCIsIHtlbnRpdHk6IFwiZW50aXR5XCIsIGxpbms6IFwiY29sbGVjdGlvblwiLCB0eXBlOiBbXCJpcyBhXCJdfSk7XG5cbiAgcGhhc2UuYWRkVW5pb24oXCJkaXJlY3Rpb25sZXNzIGxpbmtzXCIsIFtcImVudGl0eVwiLCBcImxpbmtcIl0pXG4gICAgLmFkZFVuaW9uTWVtYmVyKFwiZGlyZWN0aW9ubGVzcyBsaW5rc1wiLCBcImVudGl0eSBsaW5rc1wiKVxuICAgIC5hZGRVbmlvbk1lbWJlcihcImRpcmVjdGlvbmxlc3MgbGlua3NcIiwgXCJlbnRpdHkgbGlua3NcIiwge2VudGl0eTogXCJsaW5rXCIsIGxpbms6IFwiZW50aXR5XCJ9KTtcblxuICBwaGFzZS5hZGRVbmlvbihcImNvbGxlY3Rpb24gZW50aXRpZXNcIiwgW1wiZW50aXR5XCIsIFwiY29sbGVjdGlvblwiXSlcbiAgICAuYWRkVW5pb25NZW1iZXIoXCJjb2xsZWN0aW9uIGVudGl0aWVzXCIsIFwiaXMgYSBhdHRyaWJ1dGVzXCIpO1xuXG4gIHBoYXNlLmFkZEFydGlmYWN0cyhwYXJzZURTTChgXG4gICAgKHF1ZXJ5IDokJHZpZXcgXCJiczogaW5kZXggbmFtZVwiXG4gICAgICAoZGlzcGxheS1uYW1lIDppZCBpZCA6bmFtZSByYXcpXG4gICAgICAobm9ybWFsaXplLXN0cmluZyA6dGV4dCByYXcgOnJlc3VsdCBuYW1lKVxuICAgICAgKHByb2plY3QhIFwiaW5kZXggbmFtZVwiIDppZCBpZCA6bmFtZSBuYW1lKSlcbiAgYCkpO1xuICBcbiAgcGhhc2UuYWRkQXJ0aWZhY3RzKHBhcnNlRFNMKGBcbiAgICAocXVlcnkgOiQkdmlldyBcImJzOiBlbnRpdHlcIlxuICAgICAgKGVudGl0eS1wYWdlIDplbnRpdHkgZW50aXR5IDpwYWdlIHBhZ2UpXG4gICAgICAocGFnZS1jb250ZW50IDpwYWdlIHBhZ2UgOmNvbnRlbnQgY29udGVudClcbiAgICAgIChwcm9qZWN0ISBcImVudGl0eVwiIDplbnRpdHkgZW50aXR5IDpjb250ZW50IGNvbnRlbnQpKVxuICBgKSk7XG5cbiAgcGhhc2UuYWRkQXJ0aWZhY3RzKHBhcnNlRFNMKGBcbiAgICAocXVlcnkgOiQkdmlldyBcImJzOiB1bm1vZGlmaWVkIGFkZGVkIGJpdHNcIlxuICAgICAgKGFkZGVkLWJpdHMgOmVudGl0eSBlbnRpdHkgOmNvbnRlbnQgY29udGVudClcbiAgICAgIChuZWdhdGUgKG1hbnVhbC1lbnRpdHkgOmVudGl0eSBlbnRpdHkpKVxuICAgICAgKHByb2plY3QhIFwidW5tb2RpZmllZCBhZGRlZCBiaXRzXCIgOmVudGl0eSBlbnRpdHkgOmNvbnRlbnQgY29udGVudCkpXG4gIGApKTtcblxuICBwaGFzZS5hZGRBcnRpZmFjdHMocGFyc2VEU0woYFxuICAgIChxdWVyeSA6JCR2aWV3IFwiYnM6IGlzIGEgYXR0cmlidXRlc1wiXG4gICAgICAoZW50aXR5LWVhdnMgOmF0dHJpYnV0ZSBcImlzIGFcIiA6ZW50aXR5IGVudGl0eSA6dmFsdWUgdmFsdWUpXG4gICAgICAocHJvamVjdCEgXCJpcyBhIGF0dHJpYnV0ZXNcIiA6Y29sbGVjdGlvbiB2YWx1ZSA6ZW50aXR5IGVudGl0eSkpXG4gIGApKTtcblxuICAvLyBASEFDSzogdGhpcyB2aWV3IGlzIHJlcXVpcmVkIGJlY2F1c2UgeW91IGNhbid0IGN1cnJlbnRseSBqb2luIGEgc2VsZWN0IG9uIHRoZSByZXN1bHQgb2YgYSBmdW5jdGlvbi5cbiAgLy8gc28gd2UgY3JlYXRlIGEgdmVyc2lvbiBvZiB0aGUgZWF2cyB0YWJsZSB0aGF0IGFscmVhZHkgaGFzIGV2ZXJ5dGhpbmcgbG93ZXJjYXNlZC5cbiAgcGhhc2UuYWRkQXJ0aWZhY3RzKHBhcnNlRFNMKGBcbiAgICAocXVlcnkgOiQkdmlldyBcImJzOiBsb3dlcmNhc2UgZWF2c1wiXG4gICAgICAoZW50aXR5LWVhdnMgOmVudGl0eSBlbnRpdHkgOmF0dHJpYnV0ZSBhdHRyaWJ1dGUgOnZhbHVlIHZhbHVlKVxuICAgICAgKGxvd2VyY2FzZSA6dGV4dCB2YWx1ZSA6cmVzdWx0IGxvd2VyY2FzZWQpXG4gICAgICAocHJvamVjdCEgXCJsb3dlcmNhc2UgZWF2c1wiIDplbnRpdHkgZW50aXR5IDphdHRyaWJ1dGUgYXR0cmlidXRlIDp2YWx1ZSBsb3dlcmNhc2VkKSlcbiAgYCkpO1xuXG4gIHBoYXNlLmFkZEFydGlmYWN0cyhwYXJzZURTTChgXG4gICAgKHF1ZXJ5IDokJHZpZXcgXCJiczogZWF2IGVudGl0eSBsaW5rc1wiXG4gICAgICAoZW50aXR5LWVhdnMgOmVudGl0eSBlbnRpdHkgOmF0dHJpYnV0ZSBhdHRyaWJ1dGUgOnZhbHVlIHZhbHVlKVxuICAgICAgKGVudGl0eSA6ZW50aXR5IHZhbHVlKVxuICAgICAgKHByb2plY3QhIFwiZWF2IGVudGl0eSBsaW5rc1wiIDplbnRpdHkgZW50aXR5IDp0eXBlIGF0dHJpYnV0ZSA6bGluayB2YWx1ZSkpXG4gIGApKTtcblxuICBwaGFzZS5hZGRBcnRpZmFjdHMocGFyc2VEU0woYFxuICAgIChxdWVyeSA6JCR2aWV3IFwiYnM6IGNvbGxlY3Rpb25cIlxuICAgICAgKGlzLWEtYXR0cmlidXRlcyA6Y29sbGVjdGlvbiBlbnRpdHkpXG4gICAgICAocXVlcnkgOiQkdmlldyBcImJzOiBjb2xsZWN0aW9uIGNvdW50XCJcbiAgICAgICAgKGlzLWEtYXR0cmlidXRlcyA6Y29sbGVjdGlvbiBlbnRpdHkgOmVudGl0eSBjaGlsZClcbiAgICAgICAgKGNvdW50IDpjb3VudCBjaGlsZENvdW50KSlcbiAgICAgIChwcm9qZWN0ISBcImNvbGxlY3Rpb25cIiA6Y29sbGVjdGlvbiBlbnRpdHkgOmNvdW50IGNoaWxkQ291bnQpKVxuICBgKSk7XG5cbiAgcGhhc2UuYWRkRW50aXR5KFwiZW50aXR5XCIsIFwiZW50aXR5XCIsIFtcInN5c3RlbVwiXSk7XG4gIHBoYXNlLmFkZEVudGl0eShcImNvbGxlY3Rpb25cIiwgXCJjb2xsZWN0aW9uXCIsIFtcInN5c3RlbVwiXSk7XG4gIHBoYXNlLmFkZEFydGlmYWN0cyhwYXJzZURTTCh1bnBhZCg0KSBgXG4gICAgKHF1ZXJ5IDokJHZpZXcgXCJiczogZW50aXR5IGVhdnMgZnJvbSBlbnRpdGllc1wiXG4gICAgICAoZW50aXR5IDplbnRpdHkgZW50aXR5KVxuICAgICAgKHByb2plY3QhIFwiZW50aXR5IGVhdnNcIiA6ZW50aXR5IGVudGl0eSA6YXR0cmlidXRlIFwiaXMgYVwiIDp2YWx1ZSBcIiR7YnVpbHRpbklkKFwiZW50aXR5XCIpfVwiKSlcbiAgYCkpO1xuICBwaGFzZS5hZGRBcnRpZmFjdHMocGFyc2VEU0wodW5wYWQoNCkgYFxuICAgIChxdWVyeSA6JCR2aWV3IFwiYnM6IGVudGl0eSBlYXZzIGZyb20gY29sbGVjdGlvbnNcIlxuICAgICAgKGlzLWEtYXR0cmlidXRlcyA6Y29sbGVjdGlvbiBjb2xsKVxuICAgICAgKHByb2plY3QhIFwiZW50aXR5IGVhdnNcIiA6ZW50aXR5IGNvbGwgOmF0dHJpYnV0ZSBcImlzIGFcIiA6dmFsdWUgXCIke2J1aWx0aW5JZChcImNvbGxlY3Rpb25cIil9XCIpKVxuICBgKSk7XG4vKiAgcGhhc2UuYWRkQXJ0aWZhY3RzKHBhcnNlRFNMKHVucGFkKDQpIGBcbiAgICAocXVlcnlcbiAgICAgIChlbnRpdHkgOmVudGl0eSBlbnRpdHkpXG4gICAgICAobmVnYXRlIChxdWVyeVxuICAgICAgICAoZGlyZWN0aW9ubGVzcy1saW5rcyA6ZW50aXR5IGVudGl0eSA6bGluayBsaW5rKVxuICAgICAgICAoIT0gbGluayBcIkFVVE9HRU5FUkFURUQgZW50aXR5IFRISVMgU0hPVUxETidUIFNIT1cgVVAgQU5ZV0hFUkVcIilcbiAgICAgICAgKCE9IGxpbmsgXCJBVVRPR0VORVJBVEVEIG9ycGhhbmVkIFRISVMgU0hPVUxETidUIFNIT1cgVVAgQU5ZV0hFUkVcIilcbiAgICAgICAgKSlcbiAgICAgIChwcm9qZWN0ISBcImVudGl0eSBlYXZzXCIgOmVudGl0eSBjb2xsIDphdHRyaWJ1dGUgXCJpcyBhXCIgOnZhbHVlIFwiQVVUT0dFTkVSQVRFRCBjb2xsZWN0aW9uIFRISVMgU0hPVUxETidUIFNIT1cgVVAgQU5ZV0hFUkVcIikpXG5gKSk7Ki9cblxuICBwaGFzZS5hZGRUYWJsZShcInVpIHBhbmVcIiwgW1wicGFuZVwiLCBcImtpbmRcIiwgXCJyZXBcIiwgXCJjb250YWluc1wiLCBcInBhcmFtc1wiXSk7XG4gIGlmKGV2ZS5maW5kKFwidWkgcGFuZVwiKS5sZW5ndGggPT09IDApIHBoYXNlLmFkZEZhY3QoXCJ1aSBwYW5lXCIsIHtwYW5lOiBcInAxXCIsIGtpbmQ6IDAsIHJlcDogXCJlbnRpdHlcIiwgY29udGFpbnM6IFwiXCIsIHBhcmFtczogXCJcIn0pO1xuICBwaGFzZS5hcHBseSh0cnVlKTtcblxuICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vIFVJXG4gIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgcGhhc2UgPSBuZXcgQlNQaGFzZShldmUpO1xuXG4gIC8vIEBGSVhNRTogVGhlc2Ugc2hvdWxkIHByb2JhYmx5IGJlIHVuaW9uaXplZC5cbiAgZnVuY3Rpb24gcmVzb2x2ZSh0YWJsZSwgZmllbGRzKSB7XG4gICAgcmV0dXJuIGZpZWxkcy5tYXAoKGZpZWxkKSA9PiBgJHt0YWJsZX06ICR7ZmllbGR9YCk7XG4gIH1cbiAgcGhhc2UuYWRkVGFibGUoXCJ1aSB0ZW1wbGF0ZVwiLCByZXNvbHZlKFwidWkgdGVtcGxhdGVcIiwgW1widGVtcGxhdGVcIiwgXCJwYXJlbnRcIiwgXCJpeFwiXSkpO1xuICBwaGFzZS5hZGRUYWJsZShcInVpIHRlbXBsYXRlIGJpbmRpbmdcIiwgcmVzb2x2ZShcInVpIHRlbXBsYXRlIGJpbmRpbmdcIiwgW1widGVtcGxhdGVcIiwgXCJxdWVyeVwiXSkpO1xuICBwaGFzZS5hZGRUYWJsZShcInVpIGVtYmVkXCIsIHJlc29sdmUoXCJ1aSBlbWJlZFwiLCBbXCJlbWJlZFwiLCBcInRlbXBsYXRlXCIsIFwicGFyZW50XCIsIFwiaXhcIl0pKTtcbiAgcGhhc2UuYWRkVGFibGUoXCJ1aSBlbWJlZCBzY29wZVwiLCByZXNvbHZlKFwidWkgZW1iZWQgc2NvcGVcIiwgW1wiZW1iZWRcIiwgXCJrZXlcIiwgXCJ2YWx1ZVwiXSkpO1xuICBwaGFzZS5hZGRUYWJsZShcInVpIGVtYmVkIHNjb3BlIGJpbmRpbmdcIiwgcmVzb2x2ZShcInVpIGVtYmVkIHNjb3BlIGJpbmRpbmdcIiwgW1wiZW1iZWRcIiwgXCJrZXlcIiwgXCJzb3VyY2VcIiwgXCJhbGlhc1wiXSkpO1xuICBwaGFzZS5hZGRUYWJsZShcInVpIGF0dHJpYnV0ZVwiLCByZXNvbHZlKFwidWkgYXR0cmlidXRlXCIsIFtcInRlbXBsYXRlXCIsIFwicHJvcGVydHlcIiwgXCJ2YWx1ZVwiXSkpO1xuICBwaGFzZS5hZGRUYWJsZShcInVpIGF0dHJpYnV0ZSBiaW5kaW5nXCIsIHJlc29sdmUoXCJ1aSBhdHRyaWJ1dGUgYmluZGluZ1wiLCBbXCJ0ZW1wbGF0ZVwiLCBcInByb3BlcnR5XCIsIFwic291cmNlXCIsIFwiYWxpYXNcIl0pKTtcbiAgcGhhc2UuYWRkVGFibGUoXCJ1aSBldmVudFwiLCByZXNvbHZlKFwidWkgZXZlbnRcIiwgW1widGVtcGxhdGVcIiwgXCJldmVudFwiXSkpO1xuICBwaGFzZS5hZGRUYWJsZShcInVpIGV2ZW50IHN0YXRlXCIsIHJlc29sdmUoXCJ1aSBldmVudCBzdGF0ZVwiLCBbXCJ0ZW1wbGF0ZVwiLCBcImV2ZW50XCIsIFwia2V5XCIsIFwidmFsdWVcIl0pKTtcbiAgcGhhc2UuYWRkVGFibGUoXCJ1aSBldmVudCBzdGF0ZSBiaW5kaW5nXCIsIHJlc29sdmUoXCJ1aSBldmVudCBzdGF0ZSBiaW5kaW5nXCIsIFtcInRlbXBsYXRlXCIsIFwiZXZlbnRcIiwgXCJrZXlcIiwgXCJzb3VyY2VcIiwgXCJhbGlhc1wiXSkpO1xuXG4gIHBoYXNlLmFkZFRhYmxlKFwic3lzdGVtIHVpXCIsIFtcInRlbXBsYXRlXCJdKTtcblxuICBwaGFzZS5hcHBseSh0cnVlKTtcblxuICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vIFRlc3RpbmdcbiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICBwaGFzZSA9IG5ldyBCU1BoYXNlKGV2ZSk7XG4gIGxldCB0ZXN0RGF0YSA9IHtcbiAgICBcInRlc3QgZGF0YVwiOiBbXSxcbiAgICBwZXQ6IFtdLFxuICAgIGV4b3RpYzogW10sXG4gICAgZGFuZ2Vyb3VzOiBbXSxcbiAgICBjYXQ6IFtcInBldFwiXSxcbiAgICBkb2c6IFtcInBldFwiXSxcbiAgICBmaXNoOiBbXCJwZXRcIl0sXG4gICAgc25ha2U6IFtcInBldFwiLCBcImV4b3RpY1wiXSxcbiAgICBrb2FsYTogW1wicGV0XCIsIFwiZXhvdGljXCJdLFxuICAgIHNsb3RoOiBbXCJwZXRcIiwgXCJleG90aWNcIl0sXG4gICAga2FuZ2Fyb286IFtcImV4b3RpY1wiXSxcbiAgICBnaXJhZmZlOiBbXCJleG90aWNcIl0sXG4gICAgZ29yaWxsYTogW1wiZXhvdGljXCIsIFwiZGFuZ2Vyb3VzXCJdLFxuXG4gICAgY29tcGFueTogW10sXG4gICAga29kb3dhOiBbXCJjb21wYW55XCJdLFxuXG4gICAgZGVwYXJ0bWVudDogW10sXG4gICAgZW5naW5lZXJpbmc6IFtcImRlcGFydG1lbnRcIl0sXG4gICAgb3BlcmF0aW9uczogW1wiZGVwYXJ0bWVudFwiXSxcbiAgICBtYWdpYzogW1wiZGVwYXJ0bWVudFwiXSxcblxuICAgIGVtcGxveWVlOiBbXSxcbiAgICBqb3NoOiBbXCJlbXBsb3llZVwiXSxcbiAgICBjb3JleTogW1wiZW1wbG95ZWVcIl0sXG4gICAgY2hyaXM6IFtcImVtcGxveWVlXCJdLFxuICAgIHJvYjogW1wiZW1wbG95ZWVcIl0sXG4gICAgZXJpYzogW1wiZW1wbG95ZWVcIl0sXG4gIH07XG4gIGxldCB0ZXN0QXR0cnMgPSB7XG4gICAgY2F0OiB7bGVuZ3RoOiA0fSxcbiAgICBkb2c6IHtsZW5ndGg6IDN9LFxuICAgIGZpc2g6IHtsZW5ndGg6IDF9LFxuICAgIHNuYWtlOiB7bGVuZ3RoOiA0fSxcbiAgICBrb2FsYToge2xlbmd0aDogM30sXG4gICAgc2xvdGg6IHtsZW5ndGg6IDN9LFxuICAgIGVuZ2luZWVyaW5nOiB7Y29tcGFueTogXCJrb2Rvd2FcIn0sXG4gICAgb3BlcmF0aW9uczoge2NvbXBhbnk6IFwia29kb3dhXCJ9LFxuICAgIG1hZ2ljOiB7Y29tcGFueTogXCJrb2Rvd2FcIn0sXG5cbiAgICBqb3NoOiB7ZGVwYXJ0bWVudDogXCJlbmdpbmVlcmluZ1wiLCBzYWxhcnk6IDd9LFxuICAgIGNvcmV5OiB7ZGVwYXJ0bWVudDogXCJlbmdpbmVlcmluZ1wiLCBzYWxhcnk6IDEwfSxcbiAgICBjaHJpczoge2RlcGFydG1lbnQ6IFwiZW5naW5lZXJpbmdcIiwgc2FsYXJ5OiAxMH0sXG4gICAgZXJpYzoge2RlcGFydG1lbnQ6IFwiZW5naW5lZXJpbmdcIiwgc2FsYXJ5OiA3fSxcbiAgICByb2I6IHtkZXBhcnRtZW50OiBcIm9wZXJhdGlvbnNcIiwgc2FsYXJ5OiAxMH0sXG4gIH07XG4gIGZvcihsZXQgZW50aXR5IGluIHRlc3REYXRhKSBwaGFzZS5hZGRFbnRpdHkoZW50aXR5LCBlbnRpdHksIFtcInRlc3QgZGF0YVwiXS5jb25jYXQodGVzdERhdGFbZW50aXR5XSksIHRlc3RBdHRyc1tlbnRpdHldLCBcIlwiKTtcblxuICAvLyBwaGFzZS5hZGRUYWJsZShcImRlcGFydG1lbnRcIiwgW1wiZGVwYXJ0bWVudFwiXSlcbiAgLy8gICAuYWRkRmFjdChcImRlcGFydG1lbnRcIiwge2RlcGFydG1lbnQ6IFwiZW5naW5lZXJpbmdcIn0pXG4gIC8vICAgLmFkZEZhY3QoXCJkZXBhcnRtZW50XCIsIHtkZXBhcnRtZW50OiBcIm9wZXJhdGlvbnNcIn0pXG4gIC8vICAgLmFkZEZhY3QoXCJkZXBhcnRtZW50XCIsIHtkZXBhcnRtZW50OiBcIm1hZ2ljXCJ9KTtcbiAgLy8gcGhhc2UuYWRkVGFibGUoXCJlbXBsb3llZVwiLCBbXCJkZXBhcnRtZW50XCIsIFwiZW1wbG95ZWVcIiwgXCJzYWxhcnlcIl0pXG4gIC8vICAgLmFkZEZhY3QoXCJlbXBsb3llZVwiLCB7ZGVwYXJ0bWVudDogXCJlbmdpbmVlcmluZ1wiLCBlbXBsb3llZTogXCJqb3NoXCIsIHNhbGFyeTogMTB9KVxuICAvLyAgIC5hZGRGYWN0KFwiZW1wbG95ZWVcIiwge2RlcGFydG1lbnQ6IFwiZW5naW5lZXJpbmdcIiwgZW1wbG95ZWU6IFwiY29yZXlcIiwgc2FsYXJ5OiAxMX0pXG4gIC8vICAgLmFkZEZhY3QoXCJlbXBsb3llZVwiLCB7ZGVwYXJ0bWVudDogXCJlbmdpbmVlcmluZ1wiLCBlbXBsb3llZTogXCJjaHJpc1wiLCBzYWxhcnk6IDd9KVxuICAvLyAgIC5hZGRGYWN0KFwiZW1wbG95ZWVcIiwge2RlcGFydG1lbnQ6IFwib3BlcmF0aW9uc1wiLCBlbXBsb3llZTogXCJyb2JcIiwgc2FsYXJ5OiA3fSk7XG5cbiAgLy8gcGhhc2UuYXBwbHkodHJ1ZSk7XG4gIHdpbmRvd1tcInBcIl0gPSBwaGFzZTtcbn0pO1xuXG5kZWNsYXJlIHZhciBleHBvcnRzO1xud2luZG93W1wiYm9vdHN0cmFwXCJdID0gZXhwb3J0cztcbiIsImltcG9ydCB7c3JhbmQsIHNodWZmbGUsIHNvcnRCeUZpZWxkfSBmcm9tIFwiLi91dGlsc1wiO1xuaW1wb3J0IHtFbGVtZW50LCBIYW5kbGVyfSBmcm9tIFwiLi9taWNyb1JlYWN0XCI7XG5cbmZ1bmN0aW9uIHN1bShsaXN0Om51bWJlcltdKTpudW1iZXIge1xuICBsZXQgdG90YWwgPSAwO1xuICBmb3IobGV0IG51bSBvZiBsaXN0KSB0b3RhbCArPSBudW07XG4gIHJldHVybiB0b3RhbDtcbn1cblxuZnVuY3Rpb24gdmVjbXVsKGE6bnVtYmVyW10sIGI6bnVtYmVyW10pOm51bWJlcltdIHtcbiAgaWYoIWEgfHwgIWIgfHwgYS5sZW5ndGggIT09IGIubGVuZ3RoKSB0aHJvdyBuZXcgRXJyb3IoXCJMaXN0cyBtdXN0IGJlIHNhbWUgbGVuZ3RoXCIpO1xuICBsZXQgcmVzdWx0ID0gW107XG4gIGZvcihsZXQgaSA9IDAsIGxlbiA9IGEubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHJlc3VsdFtpXSA9IGFbaV0gKiBiW2ldO1xuICByZXR1cm4gcmVzdWx0O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIE1hc29ucnlMYXlvdXQgeyBzaXplOiBudW1iZXIsIGZyZXE/OiBudW1iZXIsIGdyb3VwZWQ/OiBudW1iZXIsIGM6IHN0cmluZywgZm9ybWF0PzooZWxlbTpNYXNvbnJ5VGlsZUVsZW0pID0+IE1hc29ucnlUaWxlRWxlbSB9XG5pbnRlcmZhY2UgTWFzb25yeVRpbGVFbGVtIGV4dGVuZHMgRWxlbWVudCB7IHNpemU/OiBudW1iZXIsIGxheW91dD86IE1hc29ucnlMYXlvdXQgfVxuaW50ZXJmYWNlIE1hc29ucnlFbGVtIGV4dGVuZHMgRWxlbWVudCB7IHNlZWQ/OiBudW1iZXIsIHJvd1NpemU/OiBudW1iZXIsIGNoaWxkcmVuOiBNYXNvbnJ5VGlsZUVsZW1bXSwgbGF5b3V0cz86TWFzb25yeUxheW91dFtdLCBzdHlsZXM/OnN0cmluZ1tdIH1cblxubGV0IF9sYXlvdXRzOk1hc29ucnlMYXlvdXRbXSA9IFtcbiAge3NpemU6IDQsIGM6IFwiYmlnXCJ9LFxuICB7c2l6ZTogMiwgYzogXCJkZXRhaWxlZFwifSxcbiAge3NpemU6IDEsIGM6IFwibm9ybWFsXCIsIGdyb3VwZWQ6IDJ9LFxuXTtcbmV4cG9ydCBmdW5jdGlvbiBtYXNvbnJ5KGVsZW06TWFzb25yeUVsZW0pOkVsZW1lbnQge1xuICBsZXQge3NlZWQgPSAwLCByb3dTaXplID0gOCwgbGF5b3V0cyA9IF9sYXlvdXRzLCBzdHlsZXMgPSB1bmRlZmluZWQsIGNoaWxkcmVufSA9IGVsZW07XG4gIGxldCByYW5kID0gc3JhbmQoc2VlZCk7ICBcbiAgbGF5b3V0cy5zb3J0KHNvcnRCeUZpZWxkKFwic2l6ZVwiKSk7XG5cbiAgLy8gQXNzaWduIG5vdGlvbmFsIHRpbGVzIGFuIGluaXRpYWwgc2l6ZSBiYXNlZCBvbiB0aGUgdmlzdWFsIGZyZXF1ZW5jeSBvZiBlYWNoIGxheW91dFxuICBsZXQgaXggPSAwO1xuICBsZXQgdGlsZXNQZXJMYXlvdXQgPSBbXTtcbiAgbGV0IHRvdGFsTGF5b3V0RnJlcSA9IDA7XG4gIGxldCBzaXplcyA9IFtdO1xuICBmb3IobGV0IGxheW91dCBvZiBsYXlvdXRzKSB7XG4gICAgbGF5b3V0LmZyZXEgPSBsYXlvdXQuZnJlcSB8fCAxIC8gbGF5b3V0LnNpemU7XG4gICAgdG90YWxMYXlvdXRGcmVxICs9IGxheW91dC5mcmVxO1xuICB9XG4gIGZvcihsZXQgbGF5b3V0IG9mIGxheW91dHMpIHtcbiAgICBzaXplc1tpeF0gPSBsYXlvdXQuc2l6ZTtcbiAgICB0aWxlc1BlckxheW91dFtpeCsrXSA9IE1hdGgucm91bmQobGF5b3V0LmZyZXEgLyB0b3RhbExheW91dEZyZXEgKiBjaGlsZHJlbi5sZW5ndGgpO1xuICB9XG5cbiAgLy8gRW5zdXJlIGV2ZXJ5IG5vdGlvbmFsIHRpbGUgaGFzIGFuIGFzc2lnbmVkIHNpemUgKHRvIGZpeCByb3VuZGluZyBlcnJvcnMpXG4gIGxldCB0b3RhbDtcbiAgbGV0IHRyeUl4ID0gMDtcbiAgd2hpbGUoKHRvdGFsID0gc3VtKHRpbGVzUGVyTGF5b3V0KSkgIT09IGNoaWxkcmVuLmxlbmd0aCkge1xuICAgIGlmKHN1bSh0aWxlc1BlckxheW91dCkgPiBjaGlsZHJlbi5sZW5ndGgpIHRpbGVzUGVyTGF5b3V0W3RpbGVzUGVyTGF5b3V0Lmxlbmd0aCAtIDFdIC09IDE7XG4gICAgZWxzZSBpZihzdW0odGlsZXNQZXJMYXlvdXQpIDwgY2hpbGRyZW4ubGVuZ3RoKSB0aWxlc1BlckxheW91dFt0aWxlc1BlckxheW91dC5sZW5ndGggLSAxXSArPSAxO1xuICB9XG5cbiAgLy8gT3B0aW1pemUgZGlzdHJpYnV0aW9uIG9mIG5vdGlvbmFsIHRpbGVzIHRvIG1heGltYWxseSBmaWxsIHJvd3NcbiAgdHJ5SXggPSAwLCBpeCA9IDA7XG4gIGxldCBtaW5TaXplID0gbGF5b3V0c1tsYXlvdXRzLmxlbmd0aCAtIDFdLnNpemU7XG4gIHdoaWxlKHRydWUpIHtcbiAgICBsZXQgZmlsbGVkU2l6ZSA9IHN1bSh2ZWNtdWwodGlsZXNQZXJMYXlvdXQsIHNpemVzKSk7XG4gICAgbGV0IHJvd0NvdW50ID0gTWF0aC5jZWlsKGZpbGxlZFNpemUgLyByb3dTaXplKTtcbiAgICBsZXQgZGVsdGEgPSByb3dTaXplICogcm93Q291bnQgLSBmaWxsZWRTaXplO1xuICAgIGlmKGRlbHRhIDw9IDAgfHwgdHJ5SXgrKyA+IDEwMDApIGJyZWFrO1xuICAgIC8vIFNpbmNlIHdlJ2xsIGJlIHNoaWZ0aW5nIG9uZSBvZiB0aGUgc21hbGxlc3QgbGF5b3V0IHRpbGVzIHRvIGEgYmlnZ2VyIHNpemUsIHdlIG9mZnNldCBieSB0aGF0IHNpemVcbiAgICBpZihpeCA9PT0gbGF5b3V0cy5sZW5ndGggLSAxKSBpeCA9IDA7XG4gICAgaWYoZGVsdGEgPj0gbGF5b3V0c1tpeF0uc2l6ZSAtIG1pblNpemUpIHtcbiAgICAgIHRpbGVzUGVyTGF5b3V0W2xheW91dHMubGVuZ3RoIC0gMV0tLTtcbiAgICAgIHRpbGVzUGVyTGF5b3V0W2l4XSsrO1xuICAgIH0gZWxzZSBpZihpeCA9PT0gbGF5b3V0cy5sZW5ndGggLSAyKSB7XG4gICAgICAvLyBUaGUgc2Vjb25kIHNtYWxsZXN0IHNpemUgd2FzIHN0aWxsIHRvbyBsYXJnZSwgd2UncmUgZG9uZS5cbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgICBpeCsrO1xuICB9XG5cbiAgLy8gQXNzaWduIGRpc2NyZXRlIHRpbGVzIHRvIHNpemVzIGJhc2VkIG9uIHRoZWlyIHJlbGF0aXZlIHNpemUgb3JkZXJpbmdcbiAgY2hpbGRyZW4uc29ydChzb3J0QnlGaWVsZChcInNpemVcIikpO1xuICBsZXQgdGlsZXMgPSBbXSwgbGF5b3V0SXggPSAwLCB0aWxlSXggPSAwO1xuICBmb3IobGV0IGNvdW50IG9mIHRpbGVzUGVyTGF5b3V0KSB7XG4gICAgbGV0IGxheW91dCA9IGxheW91dHNbbGF5b3V0SXgrK107XG4gICAgaWYoIWxheW91dC5ncm91cGVkKSB7XG4gICAgICBmb3IobGV0IGl4ID0gdGlsZUl4OyAgaXggPCB0aWxlSXggKyBjb3VudDsgaXgrKykge1xuICAgICAgICBsZXQgdGlsZSA9IGNoaWxkcmVuW2l4XTtcbiAgICAgICAgdGlsZS5jID0gYGRpcmVjdG9yeS10aWxlICR7dGlsZS5jIHx8IFwiXCJ9ICR7bGF5b3V0LmMgfHwgXCJcIn1gO1xuICAgICAgICBpZihzdHlsZXMpIHRpbGUuYyArPSBcIiBcIiArIHN0eWxlc1t0aWxlSXggJSBzdHlsZXMubGVuZ3RoXTtcbiAgICAgICAgaWYobGF5b3V0LmZvcm1hdCkgdGlsZSA9IGxheW91dC5mb3JtYXQodGlsZSk7XG4gICAgICAgIHRpbGVzLnB1c2goe2M6IGBncm91cCAke2xheW91dC5jIHx8IFwiXCJ9YCwgbGF5b3V0LCBzaXplOiBsYXlvdXQuc2l6ZSwgY2hpbGRyZW46IFt0aWxlXX0pO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAvLyBHcm91cGVkIGxheW91dHMgYXJlIGdyb3VwZWQgYXQgdGhpcyBzdGFnZSB0byBrZWVwIHRoZSBsYXlvdXQgcHJvY2VzcyAxLWRpbWVuc2lvbmFsXG4gICAgICBsZXQgYWRkZWQgPSAwOztcbiAgICAgIGZvcihsZXQgaXggPSB0aWxlSXg7ICBpeCA8IHRpbGVJeCArIGNvdW50OyBpeCArPSBsYXlvdXQuZ3JvdXBlZCkge1xuICAgICAgICBsZXQgZ3JvdXAgPSB7YzogYGdyb3VwICR7bGF5b3V0LmMgfHwgXCJcIn1gLCBsYXlvdXQsIHNpemU6IGxheW91dC5zaXplICogbGF5b3V0Lmdyb3VwZWQsIGNoaWxkcmVuOiBbXX07XG4gICAgICAgIGZvcihsZXQgcGFydEl4ID0gMDsgcGFydEl4IDwgbGF5b3V0Lmdyb3VwZWQgJiYgYWRkZWQgPCBjb3VudDsgcGFydEl4KyspIHtcbiAgICAgICAgICBsZXQgdGlsZSA9IGNoaWxkcmVuW2l4ICsgcGFydEl4XTtcbiAgICAgICAgICB0aWxlLmMgPSBgZGlyZWN0b3J5LXRpbGUgJHt0aWxlLmMgfHwgXCJcIn0gJHtsYXlvdXQuYyB8fCBcIlwifWA7XG4gICAgICAgICAgaWYoc3R5bGVzKSB0aWxlLmMgKz0gXCIgXCIgKyBzdHlsZXNbKHRpbGVJeCArIHBhcnRJeCkgJSBzdHlsZXMubGVuZ3RoXTtcbiAgICAgICAgICBpZihsYXlvdXQuZm9ybWF0KSB0aWxlID0gbGF5b3V0LmZvcm1hdCh0aWxlKTtcbiAgICAgICAgICBncm91cC5jaGlsZHJlbi5wdXNoKHRpbGUpO1xuICAgICAgICAgIGFkZGVkKys7XG4gICAgICAgIH1cbiAgICAgICAgdGlsZXMucHVzaChncm91cCk7XG4gICAgICB9XG4gICAgfVxuICAgIHRpbGVJeCArPSBjb3VudDtcbiAgfVxuXG4gIC8vIEBUT0RPOiBQdWxsIHRpbGVzIGZyb20gYmFnLCBkaXN0cmlidXRpbmcgdGhlbSBldmVubHkgaW50byByb3dzXG4gIGxldCBmaWxsZWRTaXplID0gc3VtKHZlY211bCh0aWxlc1BlckxheW91dCwgc2l6ZXMpKTtcbiAgbGV0IHJvd0NvdW50ID0gTWF0aC5jZWlsKGZpbGxlZFNpemUgLyByb3dTaXplKTtcbiAgbGV0IHJvd3MgPSBbXTtcbiAgZm9yKGxldCBpeCA9IDA7IGl4IDwgcm93Q291bnQ7IGl4KyspIHJvd3MucHVzaCh7YzogXCJtYXNvbnJ5LXJvd1wiLCBjaGlsZHJlbjogW10sIHNpemU6IDB9KTtcbiAgdHJ5SXggPSAwO1xuICBsZXQgcm93SXggPSAwO1xuICBmb3IobGV0IHRpbGUgb2YgdGlsZXMpIHtcbiAgICBsZXQgc2l6ZSA9IHRpbGUubGF5b3V0LnNpemUgKiAodGlsZS5sYXlvdXQuZ3JvdXBlZCB8fCAxKTtcbiAgICBsZXQgcGxhY2VkID0gZmFsc2U7XG4gICAgbGV0IGF0dGVtcHRzID0gMDtcbiAgICB3aGlsZSghcGxhY2VkKSB7XG4gICAgICBsZXQgcm93ID0gcm93c1tyb3dJeF07XG4gICAgICBpZihyb3cuc2l6ZSArIHNpemUgPD0gcm93U2l6ZSkge1xuICAgICAgICByb3cuc2l6ZSArPSBzaXplO1xuICAgICAgICByb3cuY2hpbGRyZW4ucHVzaCh0aWxlKTtcbiAgICAgICAgcGxhY2VkID0gdHJ1ZTtcbiAgICAgIH1cblxuICAgICAgcm93SXgrKztcbiAgICAgIGlmKHJvd0l4ID49IHJvd0NvdW50KSByb3dJeCA9IDA7XG4gICAgICBhdHRlbXB0cysrO1xuICAgICAgaWYoYXR0ZW1wdHMgPT09IHJvd0NvdW50KSBicmVhaztcbiAgICB9XG4gICAgaWYoIXBsYWNlZCkgY29uc29sZS5lcnJvcihcIkNvdWxkIG5vdCBwbGFjZSB0aWxlXCIsIHRpbGUpO1xuICB9XG4gIGl4ID0gMDtcbiAgLy8gU2h1ZmZsZSB0aGUgcm93IGNvbnRlbnRzIGFuZCB0aGUgc2V0IG9mIHJvd3MgZm9yIHBsZWFzaW5nIGlycmVndWxhcml0eVxuICBmb3IobGV0IHJvdyBvZiByb3dzKSBzaHVmZmxlKHJvdy5jaGlsZHJlbiwgcmFuZCk7XG4gIHNodWZmbGUocm93cywgcmFuZCk7XG5cbiAgZWxlbS5jID0gYG1hc29ucnkgJHtlbGVtLmMgfHwgXCJcIn1gO1xuICBlbGVtLmNoaWxkcmVuID0gcm93cztcbiAgcmV0dXJuIGVsZW07XG59XG4iLCJkZWNsYXJlIHZhciBWZWxvY2l0eTtcblxuZXhwb3J0IGludGVyZmFjZSBIYW5kbGVyPFQgZXh0ZW5kcyBFdmVudD4ge1xuICAoZXZ0OlQsIGVsZW06RWxlbWVudCk6IHZvaWRcbn1cbmV4cG9ydCBpbnRlcmZhY2UgUmVuZGVySGFuZGxlciB7XG4gIChub2RlOkhUTUxFbGVtZW50LCBlbGVtOkVsZW1lbnQpOiB2b2lkXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgRWxlbWVudCB7XG4gIHQ/OnN0cmluZ1xuICBjPzpzdHJpbmdcbiAgaWQ/OnN0cmluZ1xuICBwYXJlbnQ/OnN0cmluZ1xuICBjaGlsZHJlbj86RWxlbWVudFtdXG4gIGl4PzpudW1iZXJcbiAga2V5PzpzdHJpbmdcbiAgZGlydHk/OmJvb2xlYW5cbiAgc2VtYW50aWM/OnN0cmluZ1xuICB0d2Vlbj86IGFueVxuICBlbnRlcj86IGFueVxuICBsZWF2ZT86IGFueVxuICBkZWJ1Zz86YW55XG5cbiAgLy8gQ29udGVudFxuICBjb250ZW50RWRpdGFibGU/OmJvb2xlYW5cbiAgY2hlY2tlZD86Ym9vbGVhblxuICBkcmFnZ2FibGU/OmJvb2xlYW5cbiAgaHJlZj86c3RyaW5nXG4gIHNyYz86c3RyaW5nXG4gIGRhdGE/OmFueVxuICBkb3dubG9hZD86c3RyaW5nXG4gIGFsbG93ZnVsbHNjcmVlbj86Ym9vbGVhblxuICBwbGFjZWhvbGRlcj86c3RyaW5nXG4gIHNlbGVjdGVkPzpib29sZWFuXG4gIHRhYmluZGV4PzpudW1iZXJcbiAgdGV4dD86c3RyaW5nXG4gIHN0cmljdFRleHQ/OiBib29sZWFuXG4gIHR5cGU/OnN0cmluZ1xuICB2YWx1ZT86c3RyaW5nXG4gIGRhbmdlcm91c2x5U2V0SW5uZXJIVE1MPzpzdHJpbmdcbiAgdGFyZ2V0PzpzdHJpbmdcblxuICBzdHlsZT86IHN0cmluZyxcblxuICAvLyBTdHlsZXMgKFN0cnVjdHVyZSlcbiAgZmxleD86bnVtYmVyfHN0cmluZ1xuICBsZWZ0PzpudW1iZXJ8c3RyaW5nXG4gIHRvcD86bnVtYmVyfHN0cmluZ1xuICB3aWR0aD86bnVtYmVyfHN0cmluZ1xuICBoZWlnaHQ/Om51bWJlcnxzdHJpbmdcbiAgdGV4dEFsaWduPzpzdHJpbmdcbiAgdHJhbnNmb3JtPzpzdHJpbmdcbiAgdmVydGljYWxBbGlnbj86c3RyaW5nXG4gIHpJbmRleD86bnVtYmVyXG5cbiAgLy8gU3R5bGVzIChBZXN0aGV0aWMpXG4gIGJhY2tncm91bmRDb2xvcj86c3RyaW5nXG4gIGJhY2tncm91bmRJbWFnZT86c3RyaW5nXG4gIGJvcmRlcj86c3RyaW5nXG4gIGJvcmRlckNvbG9yPzpzdHJpbmdcbiAgYm9yZGVyV2lkdGg/Om51bWJlcnxzdHJpbmdcbiAgYm9yZGVyUmFkaXVzPzpudW1iZXJ8c3RyaW5nXG4gIGNvbG9yPzpzdHJpbmdcbiAgY29sc3Bhbj86bnVtYmVyXG4gIGZvbnRGYW1pbHk/OnN0cmluZ1xuICBmb250U2l6ZT86c3RyaW5nXG5cbiAgb3BhY2l0eT86bnVtYmVyXG5cbiAgLy8gU3ZnXG4gIHN2Zz86Ym9vbGVhblxuICB4PzpudW1iZXJ8c3RyaW5nXG4gIHk/Om51bWJlcnxzdHJpbmdcbiAgZHg/Om51bWJlcnxzdHJpbmdcbiAgZHk/Om51bWJlcnxzdHJpbmdcbiAgY3g/Om51bWJlcnxzdHJpbmdcbiAgY3k/Om51bWJlcnxzdHJpbmdcbiAgcj86bnVtYmVyfHN0cmluZ1xuICBkPzpudW1iZXJ8c3RyaW5nXG4gIGZpbGw/OnN0cmluZ1xuICBzdHJva2U/OnN0cmluZ1xuICBzdHJva2VXaWR0aD86c3RyaW5nXG4gIHN0YXJ0T2Zmc2V0PzpudW1iZXJ8c3RyaW5nXG4gIHRleHRBbmNob3I/OnN0cmluZ1xuICB2aWV3Qm94PzpzdHJpbmdcbiAgeGxpbmtocmVmPzpzdHJpbmdcblxuICAvLyBFdmVudHNcbiAgZGJsY2xpY2s/OkhhbmRsZXI8TW91c2VFdmVudD5cbiAgY2xpY2s/OkhhbmRsZXI8TW91c2VFdmVudD5cbiAgY29udGV4dG1lbnU/OkhhbmRsZXI8TW91c2VFdmVudD5cbiAgbW91c2Vkb3duPzpIYW5kbGVyPE1vdXNlRXZlbnQ+XG4gIG1vdXNlbW92ZT86SGFuZGxlcjxNb3VzZUV2ZW50PlxuICBtb3VzZXVwPzpIYW5kbGVyPE1vdXNlRXZlbnQ+XG4gIG1vdXNlb3Zlcj86SGFuZGxlcjxNb3VzZUV2ZW50PlxuICBtb3VzZW91dD86SGFuZGxlcjxNb3VzZUV2ZW50PlxuICBtb3VzZWxlYXZlPzpIYW5kbGVyPE1vdXNlRXZlbnQ+XG4gIG1vdXNld2hlZWw/OkhhbmRsZXI8TW91c2VFdmVudD5cbiAgZHJhZ292ZXI/OkhhbmRsZXI8TW91c2VFdmVudD5cbiAgZHJhZ3N0YXJ0PzpIYW5kbGVyPE1vdXNlRXZlbnQ+XG4gIGRyYWdlbmQ/OkhhbmRsZXI8TW91c2VFdmVudD5cbiAgZHJhZz86SGFuZGxlcjxNb3VzZUV2ZW50PlxuICBkcm9wPzpIYW5kbGVyPE1vdXNlRXZlbnQ+XG4gIHNjcm9sbD86SGFuZGxlcjxNb3VzZUV2ZW50PlxuICBmb2N1cz86SGFuZGxlcjxGb2N1c0V2ZW50PlxuICBibHVyPzpIYW5kbGVyPEZvY3VzRXZlbnQ+XG4gIGlucHV0PzpIYW5kbGVyPEV2ZW50PlxuICBjaGFuZ2U/OkhhbmRsZXI8RXZlbnQ+XG4gIGtleXVwPzpIYW5kbGVyPEtleWJvYXJkRXZlbnQ+XG4gIGtleWRvd24/OkhhbmRsZXI8S2V5Ym9hcmRFdmVudD5cblxuICBwb3N0UmVuZGVyPzpSZW5kZXJIYW5kbGVyXG5cbiAgW2F0dHI6c3RyaW5nXTogYW55XG59XG5cbmZ1bmN0aW9uIG5vdygpIHtcbiAgaWYod2luZG93LnBlcmZvcm1hbmNlKSB7XG4gICAgcmV0dXJuIHdpbmRvdy5wZXJmb3JtYW5jZS5ub3coKTtcbiAgfVxuICByZXR1cm4gKG5ldyBEYXRlKCkpLmdldFRpbWUoKTtcbn1cblxuZnVuY3Rpb24gc2hhbGxvd0VxdWFscyhhLCBiKSB7XG4gIGlmKGEgPT09IGIpIHJldHVybiB0cnVlO1xuICBpZighYSB8fCAhYikgcmV0dXJuIGZhbHNlO1xuICBmb3IodmFyIGsgaW4gYSkge1xuICAgIGlmKGFba10gIT09IGJba10pIHJldHVybiBmYWxzZTtcbiAgfVxuICBmb3IodmFyIGsgaW4gYikge1xuICAgIGlmKGJba10gIT09IGFba10pIHJldHVybiBmYWxzZTtcbiAgfVxuICByZXR1cm4gdHJ1ZTtcbn1cblxuZnVuY3Rpb24gcG9zdEFuaW1hdGlvblJlbW92ZShlbGVtZW50cykge1xuICBmb3IobGV0IGVsZW0gb2YgZWxlbWVudHMpIHtcbiAgICBpZihlbGVtLnBhcmVudE5vZGUpIGVsZW0ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChlbGVtKTtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgUmVuZGVyZXIge1xuICAvLyBAVE9ETzogQSBtb3JlIHBlcmZvcm1hbnQgaW1wbGVtZW50YXRpb24gd291bGQgaGF2ZSBhIHdheSBvZiByZW5kZXJpbmcgc3VidHJlZXMgYW5kIGp1c3QgaGF2ZSBhIGxhbWJkYSBSZW5kZXJlciB0byBjb21waWxlIGludG9cbiAgc3RhdGljIF9jb21waWxlUmVuZGVyZXI6e1tpZDpzdHJpbmddOiBSZW5kZXJlcn0gPSB7fTtcbiAgc3RhdGljIGNvbXBpbGUoZWxlbTpFbGVtZW50KSB7XG4gICAgaWYoIWVsZW0uaWQpIHRocm93IG5ldyBFcnJvcihcIkNhbm5vdCBjb21waWxlIGVsZW1lbnQgd2l0aCBpZCBcIiArIGVsZW0uaWQpO1xuICAgIGxldCByZW5kZXJlciA9IFJlbmRlcmVyLl9jb21waWxlUmVuZGVyZXJbZWxlbS5pZF07XG4gICAgaWYoIXJlbmRlcmVyKSByZW5kZXJlciA9IFJlbmRlcmVyLl9jb21waWxlUmVuZGVyZXJbZWxlbS5pZF0gPSBuZXcgUmVuZGVyZXIoKTtcbiAgICByZW5kZXJlci5yZW5kZXIoW2VsZW1dKTtcbiAgICByZXR1cm4gcmVuZGVyZXIuZWxlbWVudENhY2hlW2VsZW0uaWRdO1xuICB9XG4gIFxuICBjb250ZW50OiBIVE1MRWxlbWVudDtcbiAgZWxlbWVudENhY2hlOiB7W2lkOnN0cmluZ106IEhUTUxFbGVtZW50fTtcbiAgcHJldlRyZWU6e1tpZDpzdHJpbmddOiBFbGVtZW50fTtcbiAgdHJlZTp7W2lkOnN0cmluZ106IEVsZW1lbnR9O1xuICBwb3N0UmVuZGVyczogRWxlbWVudFtdO1xuICBsYXN0RGlmZjoge2FkZHM6IHN0cmluZ1tdLCB1cGRhdGVzOiB7fX07XG4gIHF1ZXVlZDogYm9vbGVhbjtcbiAgaGFuZGxlRXZlbnQ6IChhbnkpO1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLmNvbnRlbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIHRoaXMuY29udGVudC5jbGFzc05hbWUgPSBcIl9fcm9vdFwiO1xuICAgIHRoaXMuZWxlbWVudENhY2hlID0geyBcIl9fcm9vdFwiOiB0aGlzLmNvbnRlbnQgfTtcbiAgICB0aGlzLnByZXZUcmVlID0ge307XG4gICAgdGhpcy50cmVlID0ge307XG4gICAgdGhpcy5wb3N0UmVuZGVycyA9IFtdO1xuICAgIHRoaXMubGFzdERpZmYgPSB7YWRkczogW10sIHVwZGF0ZXM6IHt9fTtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgdGhpcy5oYW5kbGVFdmVudCA9IGZ1bmN0aW9uIGhhbmRsZUV2ZW50KGU6IEV2ZW50KSB7XG4gICAgICB2YXIgaWQgPSAoZS5jdXJyZW50VGFyZ2V0IHx8IGUudGFyZ2V0KVtcIl9pZFwiXTtcbiAgICAgIHZhciBlbGVtID0gc2VsZi50cmVlW2lkXTtcbiAgICAgIGlmICghZWxlbSkgcmV0dXJuO1xuICAgICAgdmFyIGhhbmRsZXIgPSBlbGVtW2UudHlwZV07XG4gICAgICBpZiAoaGFuZGxlcikgeyBoYW5kbGVyKGUsIGVsZW0pOyB9XG4gICAgfTtcbiAgfVxuICByZXNldCgpIHtcbiAgICB0aGlzLnByZXZUcmVlID0gdGhpcy50cmVlO1xuICAgIHRoaXMudHJlZSA9IHt9O1xuICAgIHRoaXMucG9zdFJlbmRlcnMgPSBbXTtcbiAgfVxuXG4gIGRvbWlmeSgpIHtcbiAgICB2YXIgZmFrZVByZXY6RWxlbWVudCA9IHt9OyAvL2NyZWF0ZSBhbiBlbXB0eSBvYmplY3Qgb25jZSBpbnN0ZWFkIG9mIGV2ZXJ5IGluc3RhbmNlIG9mIHRoZSBsb29wXG4gICAgdmFyIGVsZW1lbnRzID0gdGhpcy50cmVlO1xuICAgIHZhciBwcmV2RWxlbWVudHMgPSB0aGlzLnByZXZUcmVlO1xuICAgIHZhciBkaWZmID0gdGhpcy5sYXN0RGlmZjtcbiAgICB2YXIgYWRkcyA9IGRpZmYuYWRkcztcbiAgICB2YXIgdXBkYXRlcyA9IGRpZmYudXBkYXRlcztcbiAgICB2YXIgZWxlbUtleXMgPSBPYmplY3Qua2V5cyh1cGRhdGVzKTtcbiAgICB2YXIgZWxlbWVudENhY2hlID0gdGhpcy5lbGVtZW50Q2FjaGU7XG4gICAgdmFyIHRlbXBUd2VlbjphbnkgPSB7fTtcblxuICAgIC8vQ3JlYXRlIGFsbCB0aGUgbmV3IGVsZW1lbnRzIHRvIGVuc3VyZSB0aGF0IHRoZXkncmUgdGhlcmUgd2hlbiB0aGV5IG5lZWQgdG8gYmVcbiAgICAvL3BhcmVudGVkXG4gICAgZm9yKHZhciBpID0gMCwgbGVuID0gYWRkcy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgdmFyIGlkID0gYWRkc1tpXTtcbiAgICAgIHZhciBjdXIgPSBlbGVtZW50c1tpZF07XG4gICAgICB2YXIgZGl2OiBhbnk7XG4gICAgICBpZiAoY3VyLnN2Zykge1xuICAgICAgICBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoXCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiLCBjdXIudCB8fCBcInJlY3RcIik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KGN1ci50IHx8IFwiZGl2XCIpO1xuICAgICAgfVxuICAgICAgZGl2Ll9pZCA9IGlkO1xuICAgICAgZWxlbWVudENhY2hlW2lkXSA9IGRpdjtcbiAgICAgIGlmKGN1ci5lbnRlcikge1xuICAgICAgICBpZihjdXIuZW50ZXIuZGVsYXkpIHtcbiAgICAgICAgICBjdXIuZW50ZXIuZGlzcGxheSA9IFwiYXV0b1wiO1xuICAgICAgICAgIGRpdi5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgICAgIH1cblxuICAgICAgICBWZWxvY2l0eShkaXYsIGN1ci5lbnRlciwgY3VyLmVudGVyKTtcblxuICAgICAgfVxuICAgIH1cblxuICAgIGZvcih2YXIgaSA9IDAsIGxlbiA9IGVsZW1LZXlzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICB2YXIgaWQgPSBlbGVtS2V5c1tpXTtcbiAgICAgIHZhciBjdXIgPSBlbGVtZW50c1tpZF07XG4gICAgICB2YXIgcHJldiA9IHByZXZFbGVtZW50c1tpZF0gfHwgZmFrZVByZXY7XG4gICAgICB2YXIgdHlwZSA9IHVwZGF0ZXNbaWRdO1xuICAgICAgdmFyIGRpdjtcbiAgICAgIGlmKHR5cGUgPT09IFwicmVwbGFjZWRcIikge1xuICAgICAgICB2YXIgbWUgPSBlbGVtZW50Q2FjaGVbaWRdO1xuICAgICAgICBpZiAobWUucGFyZW50Tm9kZSkgbWUucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChtZSk7XG4gICAgICAgIGlmIChjdXIuc3ZnKSB7XG4gICAgICAgICAgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKFwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIiwgY3VyLnQgfHwgXCJyZWN0XCIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoY3VyLnQgfHwgXCJkaXZcIik7XG4gICAgICAgIH1cbiAgICAgICAgcHJldiA9IGZha2VQcmV2O1xuICAgICAgICBkaXYuX2lkID0gaWQ7XG4gICAgICAgIGVsZW1lbnRDYWNoZVtpZF0gPSBkaXY7XG4gICAgICB9IGVsc2UgaWYgKHR5cGUgPT09IFwicmVtb3ZlZFwiKSB7XG4gICAgICAgIC8vTk9URTogQmF0Y2hpbmcgdGhlIHJlbW92ZXMgc3VjaCB0aGF0IHlvdSBvbmx5IHJlbW92ZSB0aGUgcGFyZW50XG4gICAgICAgIC8vZGlkbid0IGFjdHVhbGx5IG1ha2UgdGhpcyBmYXN0ZXIgc3VycHJpc2luZ2x5LiBHaXZlbiB0aGF0IHRoaXNcbiAgICAgICAgLy9zdHJhdGVneSBpcyBtdWNoIHNpbXBsZXIgYW5kIHRoZXJlJ3Mgbm8gbm90aWNhYmxlIHBlcmYgZGlmZmVyZW5jZVxuICAgICAgICAvL3dlJ2xsIGp1c3QgZG8gdGhlIGR1bWIgdGhpbmcgYW5kIHJlbW92ZSBhbGwgdGhlIGNoaWxkcmVuIG9uZSBieSBvbmUuXG4gICAgICAgIHZhciBtZSA9IGVsZW1lbnRDYWNoZVtpZF1cbiAgICAgICAgaWYocHJldi5sZWF2ZSkge1xuICAgICAgICAgIHByZXYubGVhdmUuY29tcGxldGUgPSBwb3N0QW5pbWF0aW9uUmVtb3ZlO1xuICAgICAgICAgIGlmKHByZXYubGVhdmUuYWJzb2x1dGUpIHtcbiAgICAgICAgICAgIG1lLnN0eWxlLnBvc2l0aW9uID0gXCJhYnNvbHV0ZVwiO1xuICAgICAgICAgIH1cbiAgICAgICAgICBWZWxvY2l0eShtZSwgcHJldi5sZWF2ZSwgcHJldi5sZWF2ZSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZihtZS5wYXJlbnROb2RlKSBtZS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKG1lKTtcbiAgICAgICAgZWxlbWVudENhY2hlW2lkXSA9IG51bGw7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZGl2ID0gZWxlbWVudENhY2hlW2lkXTtcbiAgICAgIH1cblxuICAgICAgdmFyIHN0eWxlID0gZGl2LnN0eWxlO1xuICAgICAgaWYoY3VyLmMgIT09IHByZXYuYykgZGl2LmNsYXNzTmFtZSA9IGN1ci5jO1xuICAgICAgaWYoY3VyLmRyYWdnYWJsZSAhPT0gcHJldi5kcmFnZ2FibGUpIGRpdi5kcmFnZ2FibGUgPSBjdXIuZHJhZ2dhYmxlID09PSB1bmRlZmluZWQgPyBudWxsIDogXCJ0cnVlXCI7XG4gICAgICBpZihjdXIuY29udGVudEVkaXRhYmxlICE9PSBwcmV2LmNvbnRlbnRFZGl0YWJsZSkgZGl2LmNvbnRlbnRFZGl0YWJsZSA9IGN1ci5jb250ZW50RWRpdGFibGUgIT09IHVuZGVmaW5lZCA/IEpTT04uc3RyaW5naWZ5KGN1ci5jb250ZW50RWRpdGFibGUpIDogXCJpbmhlcml0XCI7XG4gICAgICBpZihjdXIuY29sc3BhbiAhPT0gcHJldi5jb2xzcGFuKSBkaXYuY29sU3BhbiA9IGN1ci5jb2xzcGFuO1xuICAgICAgaWYoY3VyLnBsYWNlaG9sZGVyICE9PSBwcmV2LnBsYWNlaG9sZGVyKSBkaXYuc2V0QXR0cmlidXRlKFwicGxhY2Vob2xkZXJcIiwgY3VyLnBsYWNlaG9sZGVyKTtcbiAgICAgIGlmKGN1ci5zZWxlY3RlZCAhPT0gcHJldi5zZWxlY3RlZCkgZGl2LnNlbGVjdGVkID0gY3VyLnNlbGVjdGVkO1xuICAgICAgaWYoKGN1ci52YWx1ZSAhPT0gcHJldi52YWx1ZSB8fCBjdXIuc3RyaWN0VGV4dCkgJiYgZGl2LnZhbHVlICE9PSBjdXIudmFsdWUpIGRpdi52YWx1ZSA9IGN1ci52YWx1ZTtcbiAgICAgIGlmKGN1ci50ID09PSBcImlucHV0XCIgJiYgY3VyLnR5cGUgIT09IHByZXYudHlwZSkgZGl2LnR5cGUgPSBjdXIudHlwZTtcbiAgICAgIGlmKGN1ci50ID09PSBcImlucHV0XCIgJiYgY3VyLmNoZWNrZWQgIT09IHByZXYuY2hlY2tlZCkgZGl2LmNoZWNrZWQgPSBjdXIuY2hlY2tlZDtcbiAgICAgIGlmKChjdXIudGV4dCAhPT0gcHJldi50ZXh0IHx8IGN1ci5zdHJpY3RUZXh0KSAmJiBkaXYudGV4dENvbnRlbnQgIT09IGN1ci50ZXh0KSBkaXYudGV4dENvbnRlbnQgPSBjdXIudGV4dCA9PT0gdW5kZWZpbmVkID8gXCJcIiA6IGN1ci50ZXh0O1xuICAgICAgaWYoY3VyLnRhYmluZGV4ICE9PSBwcmV2LnRhYmluZGV4KSBkaXYuc2V0QXR0cmlidXRlKFwidGFiaW5kZXhcIiwgY3VyLnRhYmluZGV4KTtcbiAgICAgIGlmKGN1ci5ocmVmICE9PSBwcmV2LmhyZWYpIGRpdi5zZXRBdHRyaWJ1dGUoXCJocmVmXCIsIGN1ci5ocmVmKTtcbiAgICAgIGlmKGN1ci5zcmMgIT09IHByZXYuc3JjKSBkaXYuc2V0QXR0cmlidXRlKFwic3JjXCIsIGN1ci5zcmMpO1xuICAgICAgaWYoY3VyLnRhcmdldCAhPT0gcHJldi50YXJnZXQpIGRpdi5zZXRBdHRyaWJ1dGUoXCJ0YXJnZXRcIiwgY3VyLnRhcmdldCk7XG4gICAgICBpZihjdXIuZGF0YSAhPT0gcHJldi5kYXRhKSBkaXYuc2V0QXR0cmlidXRlKFwiZGF0YVwiLCBjdXIuZGF0YSk7XG4gICAgICBpZihjdXIuZG93bmxvYWQgIT09IHByZXYuZG93bmxvYWQpIGRpdi5zZXRBdHRyaWJ1dGUoXCJkb3dubG9hZFwiLCBjdXIuZG93bmxvYWQpO1xuICAgICAgaWYoY3VyLmFsbG93ZnVsbHNjcmVlbiAhPT0gcHJldi5hbGxvd2Z1bGxzY3JlZW4pIGRpdi5zZXRBdHRyaWJ1dGUoXCJhbGxvd2Z1bGxzY3JlZW5cIiwgY3VyLmFsbG93ZnVsbHNjcmVlbik7XG5cbiAgICAgIC8vIGFuaW1hdGVhYmxlIHByb3BlcnRpZXNcbiAgICAgIHZhciB0d2VlbiA9IGN1ci50d2VlbiB8fCB0ZW1wVHdlZW47XG4gICAgICBpZihjdXIuZmxleCAhPT0gcHJldi5mbGV4KSB7XG4gICAgICAgIGlmKHR3ZWVuLmZsZXgpIHRlbXBUd2Vlbi5mbGV4ID0gY3VyLmZsZXg7XG4gICAgICAgIGVsc2Ugc3R5bGUuZmxleCA9IGN1ci5mbGV4ID09PSB1bmRlZmluZWQgPyBcIlwiIDogY3VyLmZsZXg7XG4gICAgICB9XG4gICAgICBpZihjdXIubGVmdCAhPT0gcHJldi5sZWZ0KSB7XG4gICAgICAgICAgaWYodHdlZW4ubGVmdCkgdGVtcFR3ZWVuLmxlZnQgPSBjdXIubGVmdDtcbiAgICAgICAgICBlbHNlIHN0eWxlLmxlZnQgPSBjdXIubGVmdCA9PT0gdW5kZWZpbmVkID8gXCJcIiA6IGN1ci5sZWZ0O1xuICAgICAgfVxuICAgICAgaWYoY3VyLnRvcCAhPT0gcHJldi50b3ApIHtcbiAgICAgICAgaWYodHdlZW4udG9wKSB0ZW1wVHdlZW4udG9wID0gY3VyLnRvcDtcbiAgICAgICAgZWxzZSBzdHlsZS50b3AgPSBjdXIudG9wID09PSB1bmRlZmluZWQgPyBcIlwiIDogY3VyLnRvcDtcbiAgICAgIH1cbiAgICAgIGlmKGN1ci5oZWlnaHQgIT09IHByZXYuaGVpZ2h0KSB7XG4gICAgICAgIGlmKHR3ZWVuLmhlaWdodCkgdGVtcFR3ZWVuLmhlaWdodCA9IGN1ci5oZWlnaHQ7XG4gICAgICAgIGVsc2Ugc3R5bGUuaGVpZ2h0ID0gY3VyLmhlaWdodCA9PT0gdW5kZWZpbmVkID8gXCJhdXRvXCIgOiBjdXIuaGVpZ2h0O1xuICAgICAgfVxuICAgICAgaWYoY3VyLndpZHRoICE9PSBwcmV2LndpZHRoKSB7XG4gICAgICAgIGlmKHR3ZWVuLndpZHRoKSB0ZW1wVHdlZW4ud2lkdGggPSBjdXIud2lkdGg7XG4gICAgICAgIGVsc2Ugc3R5bGUud2lkdGggPSBjdXIud2lkdGggPT09IHVuZGVmaW5lZCA/IFwiYXV0b1wiIDogY3VyLndpZHRoO1xuICAgICAgfVxuICAgICAgaWYoY3VyLnpJbmRleCAhPT0gcHJldi56SW5kZXgpIHtcbiAgICAgICAgaWYodHdlZW4uekluZGV4KSB0ZW1wVHdlZW4uekluZGV4ID0gY3VyLnpJbmRleDtcbiAgICAgICAgZWxzZSBzdHlsZS56SW5kZXggPSBjdXIuekluZGV4O1xuICAgICAgfVxuICAgICAgaWYoY3VyLmJhY2tncm91bmRDb2xvciAhPT0gcHJldi5iYWNrZ3JvdW5kQ29sb3IpIHtcbiAgICAgICAgaWYodHdlZW4uYmFja2dyb3VuZENvbG9yKSB0ZW1wVHdlZW4uYmFja2dyb3VuZENvbG9yID0gY3VyLmJhY2tncm91bmRDb2xvcjtcbiAgICAgICAgZWxzZSBzdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBjdXIuYmFja2dyb3VuZENvbG9yIHx8IFwidHJhbnNwYXJlbnRcIjtcbiAgICAgIH1cbiAgICAgIGlmKGN1ci5ib3JkZXJDb2xvciAhPT0gcHJldi5ib3JkZXJDb2xvcikge1xuICAgICAgICBpZih0d2Vlbi5ib3JkZXJDb2xvcikgdGVtcFR3ZWVuLmJvcmRlckNvbG9yID0gY3VyLmJvcmRlckNvbG9yO1xuICAgICAgICBlbHNlIHN0eWxlLmJvcmRlckNvbG9yID0gY3VyLmJvcmRlckNvbG9yIHx8IFwibm9uZVwiO1xuICAgICAgfVxuICAgICAgaWYoY3VyLmJvcmRlcldpZHRoICE9PSBwcmV2LmJvcmRlcldpZHRoKSB7XG4gICAgICAgIGlmKHR3ZWVuLmJvcmRlcldpZHRoKSB0ZW1wVHdlZW4uYm9yZGVyV2lkdGggPSBjdXIuYm9yZGVyV2lkdGg7XG4gICAgICAgIGVsc2Ugc3R5bGUuYm9yZGVyV2lkdGggPSBjdXIuYm9yZGVyV2lkdGggfHwgMDtcbiAgICAgIH1cbiAgICAgIGlmKGN1ci5ib3JkZXJSYWRpdXMgIT09IHByZXYuYm9yZGVyUmFkaXVzKSB7XG4gICAgICAgIGlmKHR3ZWVuLmJvcmRlclJhZGl1cykgdGVtcFR3ZWVuLmJvcmRlclJhZGl1cyA9IGN1ci5ib3JkZXJSYWRpdXM7XG4gICAgICAgIGVsc2Ugc3R5bGUuYm9yZGVyUmFkaXVzID0gKGN1ci5ib3JkZXJSYWRpdXMgfHwgMCkgKyBcInB4XCI7XG4gICAgICB9XG4gICAgICBpZihjdXIub3BhY2l0eSAhPT0gcHJldi5vcGFjaXR5KSB7XG4gICAgICAgIGlmKHR3ZWVuLm9wYWNpdHkpIHRlbXBUd2Vlbi5vcGFjaXR5ID0gY3VyLm9wYWNpdHk7XG4gICAgICAgIGVsc2Ugc3R5bGUub3BhY2l0eSA9IGN1ci5vcGFjaXR5ID09PSB1bmRlZmluZWQgPyAxIDogY3VyLm9wYWNpdHk7XG4gICAgICB9XG4gICAgICBpZihjdXIuZm9udFNpemUgIT09IHByZXYuZm9udFNpemUpIHtcbiAgICAgICAgaWYodHdlZW4uZm9udFNpemUpIHRlbXBUd2Vlbi5mb250U2l6ZSA9IGN1ci5mb250U2l6ZTtcbiAgICAgICAgZWxzZSBzdHlsZS5mb250U2l6ZSA9IGN1ci5mb250U2l6ZTtcbiAgICAgIH1cbiAgICAgIGlmKGN1ci5jb2xvciAhPT0gcHJldi5jb2xvcikge1xuICAgICAgICBpZih0d2Vlbi5jb2xvcikgdGVtcFR3ZWVuLmNvbG9yID0gY3VyLmNvbG9yO1xuICAgICAgICBlbHNlIHN0eWxlLmNvbG9yID0gY3VyLmNvbG9yIHx8IFwiaW5oZXJpdFwiO1xuICAgICAgfVxuXG4gICAgICBsZXQgYW5pbUtleXMgPSBPYmplY3Qua2V5cyh0ZW1wVHdlZW4pO1xuICAgICAgaWYoYW5pbUtleXMubGVuZ3RoKSB7XG4gICAgICAgIFZlbG9jaXR5KGRpdiwgdGVtcFR3ZWVuLCB0d2Vlbik7XG4gICAgICAgIHRlbXBUd2VlbiA9IHt9O1xuICAgICAgfVxuXG4gICAgICAvLyBub24tYW5pbWF0aW9uIHN0eWxlIHByb3BlcnRpZXNcbiAgICAgIGlmKGN1ci5iYWNrZ3JvdW5kSW1hZ2UgIT09IHByZXYuYmFja2dyb3VuZEltYWdlKSBzdHlsZS5iYWNrZ3JvdW5kSW1hZ2UgPSBgdXJsKCcke2N1ci5iYWNrZ3JvdW5kSW1hZ2V9JylgO1xuICAgICAgaWYoY3VyLmJvcmRlciAhPT0gcHJldi5ib3JkZXIpIHN0eWxlLmJvcmRlciA9IGN1ci5ib3JkZXIgfHwgXCJub25lXCI7XG4gICAgICBpZihjdXIudGV4dEFsaWduICE9PSBwcmV2LnRleHRBbGlnbikge1xuICAgICAgICBzdHlsZS5hbGlnbkl0ZW1zID0gY3VyLnRleHRBbGlnbjtcbiAgICAgICAgaWYoY3VyLnRleHRBbGlnbiA9PT0gXCJjZW50ZXJcIikge1xuICAgICAgICAgIHN0eWxlLnRleHRBbGlnbiA9IFwiY2VudGVyXCI7XG4gICAgICAgIH0gZWxzZSBpZihjdXIudGV4dEFsaWduID09PSBcImZsZXgtZW5kXCIpIHtcbiAgICAgICAgICBzdHlsZS50ZXh0QWxpZ24gPSBcInJpZ2h0XCI7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgc3R5bGUudGV4dEFsaWduID0gXCJsZWZ0XCI7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmKGN1ci52ZXJ0aWNhbEFsaWduICE9PSBwcmV2LnZlcnRpY2FsQWxpZ24pIHN0eWxlLmp1c3RpZnlDb250ZW50ID0gY3VyLnZlcnRpY2FsQWxpZ247XG4gICAgICBpZihjdXIuZm9udEZhbWlseSAhPT0gcHJldi5mb250RmFtaWx5KSBzdHlsZS5mb250RmFtaWx5ID0gY3VyLmZvbnRGYW1pbHkgfHwgXCJpbmhlcml0XCI7XG4gICAgICBpZihjdXIudHJhbnNmb3JtICE9PSBwcmV2LnRyYW5zZm9ybSkgc3R5bGUudHJhbnNmb3JtID0gY3VyLnRyYW5zZm9ybSB8fCBcIm5vbmVcIjtcbiAgICAgIGlmKGN1ci5zdHlsZSAhPT0gcHJldi5zdHlsZSkgZGl2LnNldEF0dHJpYnV0ZShcInN0eWxlXCIsIGN1ci5zdHlsZSk7XG5cbiAgICAgIGlmKGN1ci5kYW5nZXJvdXNseVNldElubmVySFRNTCAhPT0gcHJldi5kYW5nZXJvdXNseVNldElubmVySFRNTCkgZGl2LmlubmVySFRNTCA9IGN1ci5kYW5nZXJvdXNseVNldElubmVySFRNTDtcblxuICAgICAgLy8gZGVidWcvcHJvZ3JhbW1hdGljIHByb3BlcnRpZXNcbiAgICAgIGlmKGN1ci5zZW1hbnRpYyAhPT0gcHJldi5zZW1hbnRpYykgZGl2LnNldEF0dHJpYnV0ZShcImRhdGEtc2VtYW50aWNcIiwgY3VyLnNlbWFudGljKTtcbiAgICAgIGlmKGN1ci5kZWJ1ZyAhPT0gcHJldi5kZWJ1ZykgZGl2LnNldEF0dHJpYnV0ZShcImRhdGEtZGVidWdcIiwgY3VyLmRlYnVnKTtcblxuICAgICAgLy8gU1ZHIHByb3BlcnRpZXNcbiAgICAgIGlmKGN1ci5zdmcpIHtcbiAgICAgICAgaWYoY3VyLmZpbGwgIT09IHByZXYuZmlsbCkgZGl2LnNldEF0dHJpYnV0ZU5TKG51bGwsIFwiZmlsbFwiLCBjdXIuZmlsbCk7XG4gICAgICAgIGlmKGN1ci5zdHJva2UgIT09IHByZXYuc3Ryb2tlKSBkaXYuc2V0QXR0cmlidXRlTlMobnVsbCwgXCJzdHJva2VcIiwgY3VyLnN0cm9rZSk7XG4gICAgICAgIGlmKGN1ci5zdHJva2VXaWR0aCAhPT0gcHJldi5zdHJva2VXaWR0aCkgZGl2LnNldEF0dHJpYnV0ZU5TKG51bGwsIFwic3Ryb2tlLXdpZHRoXCIsIGN1ci5zdHJva2VXaWR0aCk7XG4gICAgICAgIGlmKGN1ci5kICE9PSBwcmV2LmQpIGRpdi5zZXRBdHRyaWJ1dGVOUyhudWxsLCBcImRcIiwgY3VyLmQpO1xuICAgICAgICBpZihjdXIuYyAhPT0gcHJldi5jKSBkaXYuc2V0QXR0cmlidXRlTlMobnVsbCwgXCJjbGFzc1wiLCBjdXIuYyk7XG4gICAgICAgIGlmKGN1ci54ICE9PSBwcmV2LngpICBkaXYuc2V0QXR0cmlidXRlTlMobnVsbCwgXCJ4XCIsIGN1ci54KTtcbiAgICAgICAgaWYoY3VyLnkgIT09IHByZXYueSkgZGl2LnNldEF0dHJpYnV0ZU5TKG51bGwsIFwieVwiLCBjdXIueSk7XG4gICAgICAgIGlmKGN1ci5keCAhPT0gcHJldi5keCkgIGRpdi5zZXRBdHRyaWJ1dGVOUyhudWxsLCBcImR4XCIsIGN1ci5keCk7XG4gICAgICAgIGlmKGN1ci5keSAhPT0gcHJldi5keSkgZGl2LnNldEF0dHJpYnV0ZU5TKG51bGwsIFwiZHlcIiwgY3VyLmR5KTtcbiAgICAgICAgaWYoY3VyLmN4ICE9PSBwcmV2LmN4KSAgZGl2LnNldEF0dHJpYnV0ZU5TKG51bGwsIFwiY3hcIiwgY3VyLmN4KTtcbiAgICAgICAgaWYoY3VyLmN5ICE9PSBwcmV2LmN5KSBkaXYuc2V0QXR0cmlidXRlTlMobnVsbCwgXCJjeVwiLCBjdXIuY3kpO1xuICAgICAgICBpZihjdXIuciAhPT0gcHJldi5yKSBkaXYuc2V0QXR0cmlidXRlTlMobnVsbCwgXCJyXCIsIGN1ci5yKTtcbiAgICAgICAgaWYoY3VyLmhlaWdodCAhPT0gcHJldi5oZWlnaHQpIGRpdi5zZXRBdHRyaWJ1dGVOUyhudWxsLCBcImhlaWdodFwiLCBjdXIuaGVpZ2h0KTtcbiAgICAgICAgaWYoY3VyLndpZHRoICE9PSBwcmV2LndpZHRoKSAgZGl2LnNldEF0dHJpYnV0ZU5TKG51bGwsIFwid2lkdGhcIiwgY3VyLndpZHRoKTtcbiAgICAgICAgaWYoY3VyLnhsaW5raHJlZiAhPT0gcHJldi54bGlua2hyZWYpICBkaXYuc2V0QXR0cmlidXRlTlMoJ2h0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsnLCBcImhyZWZcIiwgY3VyLnhsaW5raHJlZik7XG4gICAgICAgIGlmKGN1ci5zdGFydE9mZnNldCAhPT0gcHJldi5zdGFydE9mZnNldCkgZGl2LnNldEF0dHJpYnV0ZU5TKG51bGwsIFwic3RhcnRPZmZzZXRcIiwgY3VyLnN0YXJ0T2Zmc2V0KTtcbiAgICAgICAgaWYoY3VyLmlkICE9PSBwcmV2LmlkKSBkaXYuc2V0QXR0cmlidXRlTlMobnVsbCwgXCJpZFwiLCBjdXIuaWQpO1xuICAgICAgICBpZihjdXIudmlld0JveCAhPT0gcHJldi52aWV3Qm94KSBkaXYuc2V0QXR0cmlidXRlTlMobnVsbCwgXCJ2aWV3Qm94XCIsIGN1ci52aWV3Qm94KTtcbiAgICAgICAgaWYoY3VyLnRyYW5zZm9ybSAhPT0gcHJldi50cmFuc2Zvcm0pIGRpdi5zZXRBdHRyaWJ1dGVOUyhudWxsLCBcInRyYW5zZm9ybVwiLCBjdXIudHJhbnNmb3JtKTtcbiAgICAgICAgaWYoY3VyLmRyYWdnYWJsZSAhPT0gcHJldi5kcmFnZ2FibGUpIGRpdi5zZXRBdHRyaWJ1dGVOUyhudWxsLCBcImRyYWdnYWJsZVwiLCBjdXIuZHJhZ2dhYmxlKTtcbiAgICAgICAgaWYoY3VyLnRleHRBbmNob3IgIT09IHByZXYudGV4dEFuY2hvcikgZGl2LnNldEF0dHJpYnV0ZU5TKG51bGwsIFwidGV4dC1hbmNob3JcIiwgY3VyLnRleHRBbmNob3IpO1xuICAgICAgfVxuXG4gICAgICAvL2V2ZW50c1xuICAgICAgaWYoY3VyLmRibGNsaWNrICE9PSBwcmV2LmRibGNsaWNrKSBkaXYub25kYmxjbGljayA9IGN1ci5kYmxjbGljayAhPT0gdW5kZWZpbmVkID8gdGhpcy5oYW5kbGVFdmVudCA6IHVuZGVmaW5lZDtcbiAgICAgIGlmKGN1ci5jbGljayAhPT0gcHJldi5jbGljaykgZGl2Lm9uY2xpY2sgPSBjdXIuY2xpY2sgIT09IHVuZGVmaW5lZCA/IHRoaXMuaGFuZGxlRXZlbnQgOiB1bmRlZmluZWQ7XG4gICAgICBpZihjdXIuY29udGV4dG1lbnUgIT09IHByZXYuY29udGV4dG1lbnUpIGRpdi5vbmNvbnRleHRtZW51ID0gY3VyLmNvbnRleHRtZW51ICE9PSB1bmRlZmluZWQgPyB0aGlzLmhhbmRsZUV2ZW50IDogdW5kZWZpbmVkO1xuICAgICAgaWYoY3VyLm1vdXNlZG93biAhPT0gcHJldi5tb3VzZWRvd24pIGRpdi5vbm1vdXNlZG93biA9IGN1ci5tb3VzZWRvd24gIT09IHVuZGVmaW5lZCA/IHRoaXMuaGFuZGxlRXZlbnQgOiB1bmRlZmluZWQ7XG4gICAgICBpZihjdXIubW91c2Vtb3ZlICE9PSBwcmV2Lm1vdXNlbW92ZSkgZGl2Lm9ubW91c2Vtb3ZlID0gY3VyLm1vdXNlbW92ZSAhPT0gdW5kZWZpbmVkID8gdGhpcy5oYW5kbGVFdmVudCA6IHVuZGVmaW5lZDtcbiAgICAgIGlmKGN1ci5tb3VzZXVwICE9PSBwcmV2Lm1vdXNldXApIGRpdi5vbm1vdXNldXAgPSBjdXIubW91c2V1cCAhPT0gdW5kZWZpbmVkID8gdGhpcy5oYW5kbGVFdmVudCA6IHVuZGVmaW5lZDtcbiAgICAgIGlmKGN1ci5tb3VzZW92ZXIgIT09IHByZXYubW91c2VvdmVyKSBkaXYub25tb3VzZW92ZXIgPSBjdXIubW91c2VvdmVyICE9PSB1bmRlZmluZWQgPyB0aGlzLmhhbmRsZUV2ZW50IDogdW5kZWZpbmVkO1xuICAgICAgaWYoY3VyLm1vdXNlb3V0ICE9PSBwcmV2Lm1vdXNlb3V0KSBkaXYub25tb3VzZW91dCA9IGN1ci5tb3VzZW91dCAhPT0gdW5kZWZpbmVkID8gdGhpcy5oYW5kbGVFdmVudCA6IHVuZGVmaW5lZDtcbiAgICAgIGlmKGN1ci5tb3VzZWxlYXZlICE9PSBwcmV2Lm1vdXNlbGVhdmUpIGRpdi5vbm1vdXNlbGVhdmUgPSBjdXIubW91c2VsZWF2ZSAhPT0gdW5kZWZpbmVkID8gdGhpcy5oYW5kbGVFdmVudCA6IHVuZGVmaW5lZDtcbiAgICAgIGlmKGN1ci5tb3VzZXdoZWVsICE9PSBwcmV2Lm1vdXNld2hlZWwpIGRpdi5vbm1vdXNlaGVlbCA9IGN1ci5tb3VzZXdoZWVsICE9PSB1bmRlZmluZWQgPyB0aGlzLmhhbmRsZUV2ZW50IDogdW5kZWZpbmVkO1xuICAgICAgaWYoY3VyLmRyYWdvdmVyICE9PSBwcmV2LmRyYWdvdmVyKSBkaXYub25kcmFnb3ZlciA9IGN1ci5kcmFnb3ZlciAhPT0gdW5kZWZpbmVkID8gdGhpcy5oYW5kbGVFdmVudCA6IHVuZGVmaW5lZDtcbiAgICAgIGlmKGN1ci5kcmFnc3RhcnQgIT09IHByZXYuZHJhZ3N0YXJ0KSBkaXYub25kcmFnc3RhcnQgPSBjdXIuZHJhZ3N0YXJ0ICE9PSB1bmRlZmluZWQgPyB0aGlzLmhhbmRsZUV2ZW50IDogdW5kZWZpbmVkO1xuICAgICAgaWYoY3VyLmRyYWdlbmQgIT09IHByZXYuZHJhZ2VuZCkgZGl2Lm9uZHJhZ2VuZCA9IGN1ci5kcmFnZW5kICE9PSB1bmRlZmluZWQgPyB0aGlzLmhhbmRsZUV2ZW50IDogdW5kZWZpbmVkO1xuICAgICAgaWYoY3VyLmRyYWcgIT09IHByZXYuZHJhZykgZGl2Lm9uZHJhZyA9IGN1ci5kcmFnICE9PSB1bmRlZmluZWQgPyB0aGlzLmhhbmRsZUV2ZW50IDogdW5kZWZpbmVkO1xuICAgICAgaWYoY3VyLmRyb3AgIT09IHByZXYuZHJvcCkgZGl2Lm9uZHJvcCA9IGN1ci5kcm9wICE9PSB1bmRlZmluZWQgPyB0aGlzLmhhbmRsZUV2ZW50IDogdW5kZWZpbmVkO1xuICAgICAgaWYoY3VyLnNjcm9sbCAhPT0gcHJldi5zY3JvbGwpIGRpdi5vbnNjcm9sbCA9IGN1ci5zY3JvbGwgIT09IHVuZGVmaW5lZCA/IHRoaXMuaGFuZGxlRXZlbnQgOiB1bmRlZmluZWQ7XG4gICAgICBpZihjdXIuZm9jdXMgIT09IHByZXYuZm9jdXMpIGRpdi5vbmZvY3VzID0gY3VyLmZvY3VzICE9PSB1bmRlZmluZWQgPyB0aGlzLmhhbmRsZUV2ZW50IDogdW5kZWZpbmVkO1xuICAgICAgaWYoY3VyLmJsdXIgIT09IHByZXYuYmx1cikgZGl2Lm9uYmx1ciA9IGN1ci5ibHVyICE9PSB1bmRlZmluZWQgPyB0aGlzLmhhbmRsZUV2ZW50IDogdW5kZWZpbmVkO1xuICAgICAgaWYoY3VyLmlucHV0ICE9PSBwcmV2LmlucHV0KSBkaXYub25pbnB1dCA9IGN1ci5pbnB1dCAhPT0gdW5kZWZpbmVkID8gdGhpcy5oYW5kbGVFdmVudCA6IHVuZGVmaW5lZDtcbiAgICAgIGlmKGN1ci5jaGFuZ2UgIT09IHByZXYuY2hhbmdlKSBkaXYub25jaGFuZ2UgPSBjdXIuY2hhbmdlICE9PSB1bmRlZmluZWQgPyB0aGlzLmhhbmRsZUV2ZW50IDogdW5kZWZpbmVkO1xuICAgICAgaWYoY3VyLmtleXVwICE9PSBwcmV2LmtleXVwKSBkaXYub25rZXl1cCA9IGN1ci5rZXl1cCAhPT0gdW5kZWZpbmVkID8gdGhpcy5oYW5kbGVFdmVudCA6IHVuZGVmaW5lZDtcbiAgICAgIGlmKGN1ci5rZXlkb3duICE9PSBwcmV2LmtleWRvd24pIGRpdi5vbmtleWRvd24gPSBjdXIua2V5ZG93biAhPT0gdW5kZWZpbmVkID8gdGhpcy5oYW5kbGVFdmVudCA6IHVuZGVmaW5lZDtcblxuICAgICAgaWYodHlwZSA9PT0gXCJhZGRlZFwiIHx8IHR5cGUgPT09IFwicmVwbGFjZWRcIiB8fCB0eXBlID09PSBcIm1vdmVkXCIpIHtcbiAgICAgICAgdmFyIHBhcmVudEVsID0gZWxlbWVudENhY2hlW2N1ci5wYXJlbnRdO1xuICAgICAgICBpZihwYXJlbnRFbCkge1xuICAgICAgICAgIGlmKGN1ci5peCA+PSBwYXJlbnRFbC5jaGlsZHJlbi5sZW5ndGgpIHtcbiAgICAgICAgICAgIHBhcmVudEVsLmFwcGVuZENoaWxkKGRpdik7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHBhcmVudEVsLmluc2VydEJlZm9yZShkaXYsIHBhcmVudEVsLmNoaWxkcmVuW2N1ci5peF0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGRpZmYoKSB7XG4gICAgdmFyIGEgPSB0aGlzLnByZXZUcmVlO1xuICAgIHZhciBiID0gdGhpcy50cmVlO1xuICAgIHZhciBhcyA9IE9iamVjdC5rZXlzKGEpO1xuICAgIHZhciBicyA9IE9iamVjdC5rZXlzKGIpO1xuICAgIHZhciB1cGRhdGVkID0ge307XG4gICAgdmFyIGFkZHMgPSBbXTtcbiAgICBmb3IodmFyIGkgPSAwLCBsZW4gPSBhcy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgdmFyIGlkID0gYXNbaV07XG4gICAgICB2YXIgY3VyQSA9IGFbaWRdO1xuICAgICAgdmFyIGN1ckIgPSBiW2lkXTtcbiAgICAgIGlmKGN1ckIgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICB1cGRhdGVkW2lkXSA9IFwicmVtb3ZlZFwiO1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICAgIGlmKGN1ckEudCAhPT0gY3VyQi50KSB7XG4gICAgICAgIHVwZGF0ZWRbaWRdID0gXCJyZXBsYWNlZFwiO1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICAgIGlmKGN1ckEuaXggIT09IGN1ckIuaXggfHwgY3VyQS5wYXJlbnQgIT09IGN1ckIucGFyZW50KSB7XG4gICAgICAgIHVwZGF0ZWRbaWRdID0gXCJtb3ZlZFwiO1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cblxuICAgICAgaWYoIWN1ckIuZGlydHlcbiAgICAgICAgICAmJiBjdXJBLmMgPT09IGN1ckIuY1xuICAgICAgICAgICYmIGN1ckEua2V5ID09PSBjdXJCLmtleVxuICAgICAgICAgICYmIGN1ckEuZGFuZ2Vyb3VzbHlTZXRJbm5lckhUTUwgPT09IGN1ckIuZGFuZ2Vyb3VzbHlTZXRJbm5lckhUTUxcbiAgICAgICAgICAmJiBjdXJBLnRhYmluZGV4ID09PSBjdXJCLnRhYmluZGV4XG4gICAgICAgICAgJiYgY3VyQS5ocmVmID09PSBjdXJCLmhyZWZcbiAgICAgICAgICAmJiBjdXJBLnNyYyA9PT0gY3VyQi5zcmNcbiAgICAgICAgICAmJiBjdXJBLmRhdGEgPT09IGN1ckIuZGF0YVxuICAgICAgICAgICYmIGN1ckEuZG93bmxvYWQgPT09IGN1ckIuZG93bmxvYWRcbiAgICAgICAgICAmJiBjdXJBLmFsbG93ZnVsbHNjcmVlbiA9PT0gY3VyQi5hbGxvd2Z1bGxzY3JlZW5cbiAgICAgICAgICAmJiBjdXJBLnBsYWNlaG9sZGVyID09PSBjdXJCLnBsYWNlaG9sZGVyXG4gICAgICAgICAgJiYgY3VyQS5zZWxlY3RlZCA9PT0gY3VyQi5zZWxlY3RlZFxuICAgICAgICAgICYmIGN1ckEuZHJhZ2dhYmxlID09PSBjdXJCLmRyYWdnYWJsZVxuICAgICAgICAgICYmIGN1ckEuY29udGVudEVkaXRhYmxlID09PSBjdXJCLmNvbnRlbnRFZGl0YWJsZVxuICAgICAgICAgICYmIGN1ckEudmFsdWUgPT09IGN1ckIudmFsdWVcbiAgICAgICAgICAmJiBjdXJBLnRhcmdldCA9PT0gY3VyQi50YXJnZXRcbiAgICAgICAgICAmJiBjdXJBLnR5cGUgPT09IGN1ckIudHlwZVxuICAgICAgICAgICYmIGN1ckEuY2hlY2tlZCA9PT0gY3VyQi5jaGVja2VkXG4gICAgICAgICAgJiYgY3VyQS50ZXh0ID09PSBjdXJCLnRleHRcbiAgICAgICAgICAmJiBjdXJBLnRvcCA9PT0gY3VyQi50b3BcbiAgICAgICAgICAmJiBjdXJBLmZsZXggPT09IGN1ckIuZmxleFxuICAgICAgICAgICYmIGN1ckEubGVmdCA9PT0gY3VyQi5sZWZ0XG4gICAgICAgICAgJiYgY3VyQS53aWR0aCA9PT0gY3VyQi53aWR0aFxuICAgICAgICAgICYmIGN1ckEuaGVpZ2h0ID09PSBjdXJCLmhlaWdodFxuICAgICAgICAgICYmIGN1ckEuekluZGV4ID09PSBjdXJCLnpJbmRleFxuICAgICAgICAgICYmIGN1ckEuYmFja2dyb3VuZENvbG9yID09PSBjdXJCLmJhY2tncm91bmRDb2xvclxuICAgICAgICAgICYmIGN1ckEuYmFja2dyb3VuZEltYWdlID09PSBjdXJCLmJhY2tncm91bmRJbWFnZVxuICAgICAgICAgICYmIGN1ckEuY29sb3IgPT09IGN1ckIuY29sb3JcbiAgICAgICAgICAmJiBjdXJBLmNvbHNwYW4gPT09IGN1ckIuY29sc3BhblxuICAgICAgICAgICYmIGN1ckEuYm9yZGVyID09PSBjdXJCLmJvcmRlclxuICAgICAgICAgICYmIGN1ckEuYm9yZGVyQ29sb3IgPT09IGN1ckIuYm9yZGVyQ29sb3JcbiAgICAgICAgICAmJiBjdXJBLmJvcmRlcldpZHRoID09PSBjdXJCLmJvcmRlcldpZHRoXG4gICAgICAgICAgJiYgY3VyQS5ib3JkZXJSYWRpdXMgPT09IGN1ckIuYm9yZGVyUmFkaXVzXG4gICAgICAgICAgJiYgY3VyQS5vcGFjaXR5ID09PSBjdXJCLm9wYWNpdHlcbiAgICAgICAgICAmJiBjdXJBLmZvbnRGYW1pbHkgPT09IGN1ckIuZm9udEZhbWlseVxuICAgICAgICAgICYmIGN1ckEuZm9udFNpemUgPT09IGN1ckIuZm9udFNpemVcbiAgICAgICAgICAmJiBjdXJBLnRleHRBbGlnbiA9PT0gY3VyQi50ZXh0QWxpZ25cbiAgICAgICAgICAmJiBjdXJBLnRyYW5zZm9ybSA9PT0gY3VyQi50cmFuc2Zvcm1cbiAgICAgICAgICAmJiBjdXJBLnZlcnRpY2FsQWxpZ24gPT09IGN1ckIudmVydGljYWxBbGlnblxuICAgICAgICAgICYmIGN1ckEuc2VtYW50aWMgPT09IGN1ckIuc2VtYW50aWNcbiAgICAgICAgICAmJiBjdXJBLmRlYnVnID09PSBjdXJCLmRlYnVnXG4gICAgICAgICAgJiYgY3VyQS5zdHlsZSA9PT0gY3VyQi5zdHlsZVxuICAgICAgICAgICYmIChjdXJCLnN2ZyA9PT0gdW5kZWZpbmVkIHx8IChcbiAgICAgICAgICAgICAgY3VyQS54ID09PSBjdXJCLnhcbiAgICAgICAgICAgICAgJiYgY3VyQS55ID09PSBjdXJCLnlcbiAgICAgICAgICAgICAgJiYgY3VyQS5keCA9PT0gY3VyQi5keFxuICAgICAgICAgICAgICAmJiBjdXJBLmR5ID09PSBjdXJCLmR5XG4gICAgICAgICAgICAgICYmIGN1ckEuY3ggPT09IGN1ckIuY3hcbiAgICAgICAgICAgICAgJiYgY3VyQS5jeSA9PT0gY3VyQi5jeVxuICAgICAgICAgICAgICAmJiBjdXJBLnIgPT09IGN1ckIuclxuICAgICAgICAgICAgICAmJiBjdXJBLmQgPT09IGN1ckIuZFxuICAgICAgICAgICAgICAmJiBjdXJBLmZpbGwgPT09IGN1ckIuZmlsbFxuICAgICAgICAgICAgICAmJiBjdXJBLnN0cm9rZSA9PT0gY3VyQi5zdHJva2VcbiAgICAgICAgICAgICAgJiYgY3VyQS5zdHJva2VXaWR0aCA9PT0gY3VyQi5zdHJva2VXaWR0aFxuICAgICAgICAgICAgICAmJiBjdXJBLnN0YXJ0T2Zmc2V0ID09PSBjdXJCLnN0YXJ0T2Zmc2V0XG4gICAgICAgICAgICAgICYmIGN1ckEudGV4dEFuY2hvciA9PT0gY3VyQi50ZXh0QW5jaG9yXG4gICAgICAgICAgICAgICYmIGN1ckEudmlld0JveCA9PT0gY3VyQi52aWV3Qm94XG4gICAgICAgICAgICAgICYmIGN1ckEueGxpbmtocmVmID09PSBjdXJCLnhsaW5raHJlZikpXG4gICAgICAgICAgICAgICkge1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICAgIHVwZGF0ZWRbaWRdID0gXCJ1cGRhdGVkXCI7XG4gICAgfVxuICAgIGZvcih2YXIgaSA9IDAsIGxlbiA9IGJzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICB2YXIgaWQgPSBic1tpXTtcbiAgICAgIHZhciBjdXJBID0gYVtpZF07XG4gICAgICBpZihjdXJBID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgYWRkcy5wdXNoKGlkKTtcbiAgICAgICAgdXBkYXRlZFtpZF0gPSBcImFkZGVkXCI7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgIH1cbiAgICB0aGlzLmxhc3REaWZmID0ge2FkZHM6IGFkZHMsIHVwZGF0ZXM6IHVwZGF0ZWR9O1xuICAgIHJldHVybiB0aGlzLmxhc3REaWZmO1xuICB9XG5cbiAgcHJlcGFyZShyb290OkVsZW1lbnQpIHtcbiAgICB2YXIgZWxlbUxlbiA9IDE7XG4gICAgdmFyIHRyZWUgPSB0aGlzLnRyZWU7XG4gICAgdmFyIGVsZW1lbnRzID0gW3Jvb3RdO1xuICAgIHZhciBlbGVtOkVsZW1lbnQ7XG4gICAgZm9yKHZhciBlbGVtSXggPSAwOyBlbGVtSXggPCBlbGVtTGVuOyBlbGVtSXgrKykge1xuICAgICAgZWxlbSA9IGVsZW1lbnRzW2VsZW1JeF07XG4gICAgICBpZihlbGVtLnBhcmVudCA9PT0gdW5kZWZpbmVkKSBlbGVtLnBhcmVudCA9IFwiX19yb290XCI7XG4gICAgICBpZihlbGVtLmlkID09PSB1bmRlZmluZWQpIGVsZW0uaWQgPSBcIl9fcm9vdF9fXCIgKyBlbGVtSXg7XG4gICAgICB0cmVlW2VsZW0uaWRdID0gZWxlbTtcbiAgICAgIGlmKGVsZW0ucG9zdFJlbmRlciAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHRoaXMucG9zdFJlbmRlcnMucHVzaChlbGVtKTtcbiAgICAgIH1cbiAgICAgIHZhciBjaGlsZHJlbiA9IGVsZW0uY2hpbGRyZW47XG4gICAgICBpZihjaGlsZHJlbiAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGZvcih2YXIgY2hpbGRJeCA9IDAsIGxlbiA9IGNoaWxkcmVuLmxlbmd0aDsgY2hpbGRJeCA8IGxlbjsgY2hpbGRJeCsrKSB7XG4gICAgICAgICAgdmFyIGNoaWxkID0gY2hpbGRyZW5bY2hpbGRJeF07XG4gICAgICAgICAgaWYoY2hpbGQgPT09IHVuZGVmaW5lZCkgY29udGludWU7XG4gICAgICAgICAgaWYoY2hpbGQuaWQgPT09IHVuZGVmaW5lZCkgeyBjaGlsZC5pZCA9IGVsZW0uaWQgKyBcIl9fXCIgKyBjaGlsZEl4OyB9XG4gICAgICAgICAgaWYoY2hpbGQuaXggPT09IHVuZGVmaW5lZCkgeyBjaGlsZC5peCA9IGNoaWxkSXg7IH1cbiAgICAgICAgICBpZihjaGlsZC5wYXJlbnQgPT09IHVuZGVmaW5lZCkgeyBjaGlsZC5wYXJlbnQgPSBlbGVtLmlkOyB9XG4gICAgICAgICAgZWxlbWVudHMucHVzaChjaGlsZCk7XG4gICAgICAgICAgZWxlbUxlbisrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0cmVlO1xuICB9XG5cbiAgcG9zdERvbWlmeSgpIHtcbiAgICB2YXIgcG9zdFJlbmRlcnMgPSB0aGlzLnBvc3RSZW5kZXJzO1xuICAgIHZhciBkaWZmID0gdGhpcy5sYXN0RGlmZi51cGRhdGVzO1xuICAgIHZhciBlbGVtZW50Q2FjaGUgPSB0aGlzLmVsZW1lbnRDYWNoZTtcbiAgICBmb3IodmFyIGkgPSAwLCBsZW4gPSBwb3N0UmVuZGVycy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgdmFyIGVsZW0gPSBwb3N0UmVuZGVyc1tpXTtcbiAgICAgIHZhciBpZCA9IGVsZW0uaWQ7XG4gICAgICBpZihkaWZmW2lkXSA9PT0gXCJ1cGRhdGVkXCIgfHwgZGlmZltpZF0gPT09IFwiYWRkZWRcIiB8fCBkaWZmW2lkXSA9PT0gXCJyZXBsYWNlZFwiIHx8IGVsZW0uZGlydHkgfHwgZGlmZltpZF0gPT09IFwibW92ZWRcIikge1xuICAgICAgICBlbGVtLnBvc3RSZW5kZXIoZWxlbWVudENhY2hlW2VsZW0uaWRdLCBlbGVtKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICByZW5kZXIoZWxlbXM6RWxlbWVudFtdKSB7XG4gICAgICB0aGlzLnJlc2V0KCk7XG4gICAgLy8gV2Ugc29ydCBlbGVtZW50cyBieSBkZXB0aCB0byBhbGxvdyB0aGVtIHRvIGJlIHNlbGYgcmVmZXJlbnRpYWwuXG4gICAgZWxlbXMuc29ydCgoYSwgYikgPT4gKGEucGFyZW50ID8gYS5wYXJlbnQuc3BsaXQoXCJfX1wiKS5sZW5ndGggOiAwKSAtIChiLnBhcmVudCA/IGIucGFyZW50LnNwbGl0KFwiX19cIikubGVuZ3RoIDogMCkpO1xuICAgIGxldCBzdGFydCA9IG5vdygpO1xuICAgIGZvcihsZXQgZWxlbSBvZiBlbGVtcykge1xuICAgICAgbGV0IHBvc3QgPSB0aGlzLnByZXBhcmUoZWxlbSk7XG5cbiAgICB9XG4gICAgbGV0IHByZXBhcmUgPSBub3coKTtcbiAgICBsZXQgZCA9IHRoaXMuZGlmZigpO1xuICAgIGxldCBkaWZmID0gbm93KCk7XG4gICAgdGhpcy5kb21pZnkoKTtcbiAgICBsZXQgZG9taWZ5ID0gbm93KCk7XG4gICAgdGhpcy5wb3N0RG9taWZ5KCk7XG4gICAgbGV0IHBvc3REb21pZnkgPSBub3coKTtcbiAgICBsZXQgdGltZSA9IG5vdygpIC0gc3RhcnQ7XG4gICAgaWYodGltZSA+IDUpIHtcbiAgICAgIGNvbnNvbGUubG9nKFwic2xvdyByZW5kZXIgKD4gNW1zKTogXCIsIHRpbWUsIHtcbiAgICAgICAgcHJlcGFyZTogcHJlcGFyZSAtIHN0YXJ0LFxuICAgICAgICBkaWZmOiBkaWZmIC0gcHJlcGFyZSxcbiAgICAgICAgZG9taWZ5OiBkb21pZnkgLSBkaWZmLFxuICAgICAgICBwb3N0RG9taWZ5OiBwb3N0RG9taWZ5IC0gZG9taWZ5XG4gICAgICB9KTtcbiAgICB9XG4gIH1cbn1cbiIsImltcG9ydCB7RU5WLCBERUJVRywgdXVpZCwgdW5wYWQsIHVuZGVybGluZSwgY29lcmNlSW5wdXR9IGZyb20gXCIuL3V0aWxzXCJcbmltcG9ydCAqIGFzIHJ1bnRpbWUgZnJvbSBcIi4vcnVudGltZVwiXG5pbXBvcnQge2V2ZX0gZnJvbSBcIi4vYXBwXCJcbmltcG9ydCB7cmVwZWF0fSBmcm9tIFwiLi91dGlsc1wiXG5cbmNsYXNzIFBhcnNlRXJyb3IgZXh0ZW5kcyBFcnJvciB7XG4gIG5hbWU6IHN0cmluZyA9IFwiUGFyc2UgRXJyb3JcIjtcblxuICBjb25zdHJ1Y3RvcihwdWJsaWMgbWVzc2FnZTpzdHJpbmcsIHB1YmxpYyBsaW5lOnN0cmluZywgcHVibGljIGxpbmVJeD86bnVtYmVyLCBwdWJsaWMgY2hhckl4Om51bWJlciA9IDAsIHB1YmxpYyBsZW5ndGg6bnVtYmVyID0gbGluZSAmJiAobGluZS5sZW5ndGggLSBjaGFySXgpKSB7XG4gICAgc3VwZXIobWVzc2FnZSk7XG4gIH1cbiAgdG9TdHJpbmcoKSB7XG4gICAgcmV0dXJuIHVucGFkKDYpIGBcbiAgICAgICR7dGhpcy5uYW1lfTogJHt0aGlzLm1lc3NhZ2V9XG4gICAgICAke3RoaXMubGluZUl4ICE9PSB1bmRlZmluZWQgPyBgT24gbGluZSAke3RoaXMubGluZUl4ICsgMX06JHt0aGlzLmNoYXJJeH1gIDogXCJcIn1cbiAgICAgICR7dGhpcy5saW5lfVxuICAgICAgJHt1bmRlcmxpbmUodGhpcy5jaGFySXgsIHRoaXMubGVuZ3RoKX1cbiAgICBgO1xuICB9XG59XG5cbmZ1bmN0aW9uIHJlYWRXaGlsZShzdHI6c3RyaW5nLCBwYXR0ZXJuOlJlZ0V4cCwgc3RhcnRJeDpudW1iZXIpOnN0cmluZyB7XG4gIGxldCBlbmRJeCA9IHN0YXJ0SXg7XG4gIHdoaWxlKHN0cltlbmRJeF0gIT09IHVuZGVmaW5lZCAmJiBzdHJbZW5kSXhdLm1hdGNoKHBhdHRlcm4pKSBlbmRJeCsrO1xuICByZXR1cm4gc3RyLnNsaWNlKHN0YXJ0SXgsIGVuZEl4KTtcbn1cblxuZnVuY3Rpb24gcmVhZFVudGlsKHN0cjpzdHJpbmcsIHNlbnRpbmVsOnN0cmluZywgc3RhcnRJeDpudW1iZXIpOnN0cmluZztcbmZ1bmN0aW9uIHJlYWRVbnRpbChzdHI6c3RyaW5nLCBzZW50aW5lbDpzdHJpbmcsIHN0YXJ0SXg6bnVtYmVyLCB1bnNhdGlzZmllZEVycjogRXJyb3IpOnN0cmluZ3xFcnJvcjtcbmZ1bmN0aW9uIHJlYWRVbnRpbChzdHI6c3RyaW5nLCBzZW50aW5lbDpzdHJpbmcsIHN0YXJ0SXg6bnVtYmVyLCB1bnNhdGlzZmllZEVycj86IEVycm9yKTphbnkge1xuICBsZXQgZW5kSXggPSBzdHIuaW5kZXhPZihzZW50aW5lbCwgc3RhcnRJeCk7XG4gIGlmKGVuZEl4ID09PSAtMSkge1xuICAgIGlmKHVuc2F0aXNmaWVkRXJyKSByZXR1cm4gdW5zYXRpc2ZpZWRFcnI7XG4gICAgcmV0dXJuIHN0ci5zbGljZShzdGFydEl4KTtcbiAgfVxuICByZXR1cm4gc3RyLnNsaWNlKHN0YXJ0SXgsIGVuZEl4KTtcbn1cblxuZnVuY3Rpb24gcmVhZFVudGlsQW55KHN0cjpzdHJpbmcsIHNlbnRpbmVsczpzdHJpbmdbXSwgc3RhcnRJeDpudW1iZXIpOnN0cmluZztcbmZ1bmN0aW9uIHJlYWRVbnRpbEFueShzdHI6c3RyaW5nLCBzZW50aW5lbHM6c3RyaW5nW10sIHN0YXJ0SXg6bnVtYmVyLCB1bnNhdGlzZmllZEVycjogRXJyb3IpOnN0cmluZ3xFcnJvcjtcbmZ1bmN0aW9uIHJlYWRVbnRpbEFueShzdHI6c3RyaW5nLCBzZW50aW5lbHM6c3RyaW5nW10sIHN0YXJ0SXg6bnVtYmVyLCB1bnNhdGlzZmllZEVycj86IEVycm9yKTphbnkge1xuICBsZXQgZW5kSXggPSAtMTtcbiAgZm9yKGxldCBzZW50aW5lbCBvZiBzZW50aW5lbHMpIHtcbiAgICBsZXQgaXggPSBzdHIuaW5kZXhPZihzZW50aW5lbCwgc3RhcnRJeCk7XG4gICAgaWYoaXggPT09IC0xIHx8IGVuZEl4ICE9PSAtMSAmJiBpeCA+IGVuZEl4KSBjb250aW51ZTtcbiAgICBlbmRJeCA9IGl4O1xuICB9XG4gIGlmKGVuZEl4ID09PSAtMSkge1xuICAgIGlmKHVuc2F0aXNmaWVkRXJyKSByZXR1cm4gdW5zYXRpc2ZpZWRFcnI7XG4gICAgcmV0dXJuIHN0ci5zbGljZShzdGFydEl4KTtcbiAgfVxuICByZXR1cm4gc3RyLnNsaWNlKHN0YXJ0SXgsIGVuZEl4KTtcbn1cblxuLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuLy8gVUkgRFNMIFBhcnNlclxuLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuZXhwb3J0IGludGVyZmFjZSBVSUVsZW0ge1xuICBpZD86IHN0cmluZ1xuICBjaGlsZHJlbj86IFVJRWxlbVtdXG4gIGVtYmVkZGVkPzoge30gLy8gVW5kZWZpbmVkIG9yIHRoZSByZXN0cmljdGVkIHNjb3BlIG9mIHRoZSBlbWJlZGRlZCBjaGlsZC5cbiAgYmluZGluZz86IHN0cmluZ1xuICBiaW5kaW5nS2luZD86IHN0cmluZ1xuICBhdHRyaWJ1dGVzPzoge31cbiAgZXZlbnRzPzoge1tldmVudDpzdHJpbmddOiB7fX1cbn1cblxuLy8gZXhwb3J0IGZ1bmN0aW9uIHBhcnNlVUkoc3RyOnN0cmluZyk6VUlFbGVtIHtcbi8vICAgbGV0IHJvb3Q6VUlFbGVtID0ge307XG4vLyAgIGxldCBlcnJvcnMgPSBbXTtcbi8vICAgbGV0IGxpbmVJeCA9IDA7XG4vLyAgIGxldCBsaW5lcyA9IHN0ci5zcGxpdChcIlxcblwiKTtcbi8vICAgbGV0IHN0YWNrOntpbmRlbnQ6IG51bWJlciwgZWxlbTogVUlFbGVtfVtdID0gW3tpbmRlbnQ6IC0yLCBlbGVtOiByb290fV07XG4vLyAgIC8vIEBGSVhNRTogQ2h1bmsgaW50byBlbGVtZW50IGNodW5rcyBpbnN0ZWFkIG9mIGxpbmVzIHRvIGVuYWJsZSBpbi1hcmd1bWVudCBjb250aW51YXRpb24uXG4vLyAgIGZvcihsZXQgbGluZSBvZiBsaW5lcykge1xuLy8gICAgIGxldCBjaGFySXggPSAwO1xuLy8gICAgIHdoaWxlKGxpbmVbY2hhckl4XSA9PT0gXCIgXCIpIGNoYXJJeCsrO1xuLy8gICAgIGxldCBpbmRlbnQgPSBjaGFySXg7XG4vLyAgICAgaWYobGluZVtjaGFySXhdID09PSB1bmRlZmluZWQpICBjb250aW51ZTtcbi8vICAgICBsZXQgcGFyZW50OlVJRWxlbTtcbi8vICAgICBmb3IobGV0IHN0YWNrSXggPSBzdGFjay5sZW5ndGggLSAxOyBzdGFja0l4ID49IDA7IHN0YWNrSXgtLSkge1xuLy8gICAgICAgaWYoaW5kZW50ID4gc3RhY2tbc3RhY2tJeF0uaW5kZW50KSB7XG4vLyAgICAgICAgIHBhcmVudCA9IHN0YWNrW3N0YWNrSXhdLmVsZW07XG4vLyAgICAgICAgIGJyZWFrO1xuLy8gICAgICAgfSBlbHNlIHN0YWNrLnBvcCgpO1xuLy8gICAgIH1cbi8vICAgICBsZXQga2V5d29yZCA9IHJlYWRVbnRpbChsaW5lLCBcIiBcIiwgY2hhckl4KTtcbi8vICAgICBjaGFySXggKz0ga2V5d29yZC5sZW5ndGg7XG5cbi8vICAgICBpZihrZXl3b3JkWzBdID09PSBcIn5cIiB8fCBrZXl3b3JkWzBdID09PSBcIiVcIikgeyAvLyBIYW5kbGUgYmluZGluZ1xuLy8gICAgICAgY2hhckl4IC09IGtleXdvcmQubGVuZ3RoIC0gMTtcbi8vICAgICAgIGxldCBraW5kID0ga2V5d29yZFswXSA9PT0gXCJ+XCIgPyBcInBsYW5cIiA6IFwicXVlcnlcIjtcbi8vICAgICAgIGlmKCFwYXJlbnQuYmluZGluZykge1xuLy8gICAgICAgICBwYXJlbnQuYmluZGluZyA9IGxpbmUuc2xpY2UoY2hhckl4KTtcbi8vICAgICAgICAgcGFyZW50LmJpbmRpbmdLaW5kID0ga2luZDtcbi8vICAgICAgIH0gZWxzZSBpZihraW5kID09PSBwYXJlbnQuYmluZGluZ0tpbmQpIHBhcmVudC5iaW5kaW5nICs9IFwiXFxuXCIgKyBsaW5lLnNsaWNlKGNoYXJJeCk7XG4vLyAgICAgICBlbHNlIHtcbi8vICAgICAgICAgZXJyb3JzLnB1c2gobmV3IFBhcnNlRXJyb3IoYFVJIG11c3QgYmUgYm91bmQgdG8gYSBzaW5nbGUgdHlwZSBvZiBxdWVyeS5gLCBsaW5lLCBsaW5lSXgpKTtcbi8vICAgICAgICAgY29udGludWU7XG4vLyAgICAgICB9XG4vLyAgICAgICBjaGFySXggPSBsaW5lLmxlbmd0aDtcblxuLy8gICAgIH0gZWxzZSBpZihrZXl3b3JkWzBdID09PSBcIkBcIikgeyAvLyBIYW5kbGUgZXZlbnRcbi8vICAgICAgIGNoYXJJeCAtPSBrZXl3b3JkLmxlbmd0aCAtIDE7XG4vLyAgICAgICBsZXQgZXJyO1xuLy8gICAgICAgd2hpbGUobGluZVtjaGFySXhdID09PSBcIiBcIikgY2hhckl4Kys7XG4vLyAgICAgICBsZXQgbGFzdEl4ID0gY2hhckl4O1xuLy8gICAgICAgbGV0IGV2ZW50UmF3ID0gcmVhZFVudGlsKGxpbmUsIFwie1wiLCBjaGFySXgpO1xuLy8gICAgICAgY2hhckl4ICs9IGV2ZW50UmF3Lmxlbmd0aDtcbi8vICAgICAgIGxldCBldmVudCA9IGV2ZW50UmF3LnRyaW0oKTtcblxuLy8gICAgICAgaWYoIWV2ZW50KSBlcnIgPSBuZXcgUGFyc2VFcnJvcihgVUkgZXZlbnQgbXVzdCBzcGVjaWZ5IGEgdmFsaWQgZXZlbnQgbmFtZWAsIGxpbmUsIGxpbmVJeCwgbGFzdEl4LCBldmVudFJhdy5sZW5ndGgpO1xuLy8gICAgICAgbGV0IHN0YXRlO1xuLy8gICAgICAgW3N0YXRlLCBjaGFySXhdID0gZ2V0TWFwQXJncyhsaW5lLCBsaW5lSXgsIGNoYXJJeCk7XG4vLyAgICAgICBpZihzdGF0ZSBpbnN0YW5jZW9mIEVycm9yICYmICFlcnIpIGVyciA9IHN0YXRlO1xuLy8gICAgICAgaWYoZXJyKSB7XG4vLyAgICAgICAgIGVycm9ycy5wdXNoKGVycik7XG4vLyAgICAgICAgIGxpbmVJeCsrO1xuLy8gICAgICAgICBjb250aW51ZTtcbi8vICAgICAgIH1cblxuLy8gICAgICAgaWYoIXBhcmVudC5ldmVudHMpIHBhcmVudC5ldmVudHMgPSB7fTtcbi8vICAgICAgIHBhcmVudC5ldmVudHNbZXZlbnRdID0gc3RhdGU7XG5cbi8vICAgICB9IGVsc2UgaWYoa2V5d29yZFswXSA9PT0gXCI+XCIpIHsgLy8gSGFuZGxlIGVtYmVkXG4vLyAgICAgICBjaGFySXggLT0ga2V5d29yZC5sZW5ndGggLSAxO1xuLy8gICAgICAgbGV0IGVycjtcbi8vICAgICAgIHdoaWxlKGxpbmVbY2hhckl4XSA9PT0gXCIgXCIpIGNoYXJJeCsrO1xuLy8gICAgICAgbGV0IGxhc3RJeCA9IGNoYXJJeDtcbi8vICAgICAgIGxldCBlbWJlZElkUmF3ID0gcmVhZFVudGlsKGxpbmUsIFwie1wiLCBjaGFySXgpO1xuLy8gICAgICAgY2hhckl4ICs9IGVtYmVkSWRSYXcubGVuZ3RoO1xuLy8gICAgICAgbGV0IGVtYmVkSWQgPSBlbWJlZElkUmF3LnRyaW0oKTtcblxuLy8gICAgICAgaWYoIWVtYmVkSWQpIGVyciA9IG5ldyBQYXJzZUVycm9yKGBVSSBlbWJlZCBtdXN0IHNwZWNpZnkgYSB2YWxpZCBlbGVtZW50IGlkYCwgbGluZSwgbGluZUl4LCBsYXN0SXgsIGVtYmVkSWRSYXcubGVuZ3RoKTtcbi8vICAgICAgIGxldCBzY29wZTtcbi8vICAgICAgIFtzY29wZSA9IHt9LCBjaGFySXhdID0gZ2V0TWFwQXJncyhsaW5lLCBsaW5lSXgsIGNoYXJJeCk7XG4vLyAgICAgICBpZihzY29wZSBpbnN0YW5jZW9mIEVycm9yICYmICFlcnIpIGVyciA9IHNjb3BlO1xuLy8gICAgICAgaWYoZXJyKSB7XG4vLyAgICAgICAgIGVycm9ycy5wdXNoKGVycik7XG4vLyAgICAgICAgIGxpbmVJeCsrO1xuLy8gICAgICAgICBjb250aW51ZTtcbi8vICAgICAgIH1cblxuLy8gICAgICAgbGV0IGVsZW0gPSB7ZW1iZWRkZWQ6IHNjb3BlLCBpZDogZW1iZWRJZH07XG4vLyAgICAgICBpZighcGFyZW50LmNoaWxkcmVuKSBwYXJlbnQuY2hpbGRyZW4gPSBbXTtcbi8vICAgICAgIHBhcmVudC5jaGlsZHJlbi5wdXNoKGVsZW0pO1xuLy8gICAgICAgc3RhY2sucHVzaCh7aW5kZW50LCBlbGVtfSk7XG5cbi8vICAgICB9IGVsc2UgeyAvLyBIYW5kbGUgZWxlbWVudFxuLy8gICAgICAgbGV0IGVycjtcbi8vICAgICAgIGlmKCFrZXl3b3JkKSBlcnIgPSBuZXcgUGFyc2VFcnJvcihgVUkgZWxlbWVudCBtdXN0IHNwZWNpZnkgYSB2YWxpZCB0YWcgbmFtZWAsIGxpbmUsIGxpbmVJeCwgY2hhckl4LCAwKTtcbi8vICAgICAgIHdoaWxlKGxpbmVbY2hhckl4XSA9PT0gXCIgXCIpIGNoYXJJeCsrO1xuLy8gICAgICAgbGV0IGNsYXNzZXNSYXcgPSByZWFkVW50aWwobGluZSwgXCJ7XCIsIGNoYXJJeCk7XG4vLyAgICAgICBjaGFySXggKz0gY2xhc3Nlc1Jhdy5sZW5ndGg7XG4vLyAgICAgICBsZXQgY2xhc3NlcyA9IGNsYXNzZXNSYXcudHJpbSgpO1xuXG4vLyAgICAgICBsZXQgYXR0cmlidXRlcztcbi8vICAgICAgIFthdHRyaWJ1dGVzID0ge30sIGNoYXJJeF0gPSBnZXRNYXBBcmdzKGxpbmUsIGxpbmVJeCwgY2hhckl4KTtcbi8vICAgICAgIGlmKGF0dHJpYnV0ZXMgaW5zdGFuY2VvZiBFcnJvciAmJiAhZXJyKSBlcnIgPSBhdHRyaWJ1dGVzO1xuLy8gICAgICAgaWYoZXJyKSB7XG4vLyAgICAgICAgIGVycm9ycy5wdXNoKGVycik7XG4vLyAgICAgICAgIGxpbmVJeCsrO1xuLy8gICAgICAgICBjb250aW51ZTtcbi8vICAgICAgIH1cbi8vICAgICAgIGF0dHJpYnV0ZXNbXCJ0XCJdID0ga2V5d29yZDtcbi8vICAgICAgIGlmKGNsYXNzZXMpIGF0dHJpYnV0ZXNbXCJjXCJdID0gY2xhc3Nlcztcbi8vICAgICAgIGxldCBlbGVtOlVJRWxlbSA9IHtpZDogYXR0cmlidXRlc1tcImlkXCJdLCBhdHRyaWJ1dGVzfTtcbi8vICAgICAgIGlmKCFwYXJlbnQuY2hpbGRyZW4pIHBhcmVudC5jaGlsZHJlbiA9IFtdO1xuLy8gICAgICAgcGFyZW50LmNoaWxkcmVuLnB1c2goZWxlbSk7XG4vLyAgICAgICBzdGFjay5wdXNoKHtpbmRlbnQsIGVsZW19KTtcbi8vICAgICB9XG5cbi8vICAgICBsaW5lSXgrKztcbi8vICAgfVxuXG4vLyAgIGlmKGVycm9ycy5sZW5ndGgpIHtcbi8vICAgICBmb3IobGV0IGVyciBvZiBlcnJvcnMpIHtcbi8vICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbi8vICAgICB9XG4vLyAgIH1cbi8vICAgcmV0dXJuIHJvb3Q7XG4vLyB9XG5cblxuLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuLy8gRXZlIERTTCBQYXJzZXJcbi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbmVudW0gVE9LRU5fVFlQRSB7IEVYUFIsIElERU5USUZJRVIsIEtFWVdPUkQsIFNUUklORywgTElURVJBTCB9O1xuZXhwb3J0IGNsYXNzIFRva2VuIHtcbiAgc3RhdGljIFRZUEUgPSBUT0tFTl9UWVBFO1xuICBzdGF0aWMgaWRlbnRpZmllcih2YWx1ZTpzdHJpbmcsIGxpbmVJeD86IG51bWJlciwgY2hhckl4PzogbnVtYmVyKSB7XG4gICAgcmV0dXJuIG5ldyBUb2tlbihUb2tlbi5UWVBFLklERU5USUZJRVIsIHZhbHVlLCBsaW5lSXgsIGNoYXJJeCk7XG4gIH1cbiAgc3RhdGljIGtleXdvcmQodmFsdWU6c3RyaW5nLCBsaW5lSXg/OiBudW1iZXIsIGNoYXJJeD86IG51bWJlcikge1xuICAgIHJldHVybiBuZXcgVG9rZW4oVG9rZW4uVFlQRS5LRVlXT1JELCB2YWx1ZSwgbGluZUl4LCBjaGFySXgpO1xuICB9XG4gIHN0YXRpYyBzdHJpbmcodmFsdWU6c3RyaW5nLCBsaW5lSXg/OiBudW1iZXIsIGNoYXJJeD86IG51bWJlcikge1xuICAgIHJldHVybiBuZXcgVG9rZW4oVG9rZW4uVFlQRS5TVFJJTkcsIHZhbHVlLCBsaW5lSXgsIGNoYXJJeCk7XG4gIH1cbiAgc3RhdGljIGxpdGVyYWwodmFsdWU6YW55LCBsaW5lSXg/OiBudW1iZXIsIGNoYXJJeD86IG51bWJlcikge1xuICAgIHJldHVybiBuZXcgVG9rZW4oVG9rZW4uVFlQRS5MSVRFUkFMLCB2YWx1ZSwgbGluZUl4LCBjaGFySXgpO1xuICB9XG5cbiAgY29uc3RydWN0b3IocHVibGljIHR5cGU/OiBUT0tFTl9UWVBFLCBwdWJsaWMgdmFsdWU/OiBhbnksIHB1YmxpYyBsaW5lSXg/OiBudW1iZXIsIHB1YmxpYyBjaGFySXg/OiBudW1iZXIpIHt9XG4gIHRvU3RyaW5nKCkge1xuICAgIGlmKHRoaXMudHlwZSA9PT0gVG9rZW4uVFlQRS5LRVlXT1JEKSByZXR1cm4gYDoke3RoaXMudmFsdWV9YDtcbiAgICBlbHNlIGlmKHRoaXMudHlwZSA9PT0gVG9rZW4uVFlQRS5TVFJJTkcpIHJldHVybiBgXCIke3RoaXMudmFsdWV9XCJgO1xuICAgIGVsc2UgcmV0dXJuIHRoaXMudmFsdWUudG9TdHJpbmcoKTtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgU2V4cHIge1xuICBzdGF0aWMgbGlzdCh2YWx1ZTooVG9rZW58U2V4cHIpW10gPSBbXSwgbGluZUl4PzogbnVtYmVyLCBjaGFySXg/OiBudW1iZXIsIHN5bnRheD86IGJvb2xlYW4pIHtcbiAgICB2YWx1ZSA9IHZhbHVlLnNsaWNlKCk7XG4gICAgdmFsdWUudW5zaGlmdChUb2tlbi5pZGVudGlmaWVyKFwibGlzdFwiLCBsaW5lSXgsIGNoYXJJeCA/IGNoYXJJeCArIDEgOiB1bmRlZmluZWQpKTtcbiAgICByZXR1cm4gbmV3IFNleHByKHZhbHVlLCBsaW5lSXgsIGNoYXJJeCwgc3ludGF4ID8gXCJsaXN0XCIgOiB1bmRlZmluZWQpO1xuICB9XG4gIHN0YXRpYyBoYXNoKHZhbHVlOihUb2tlbnxTZXhwcilbXSA9IFtdLCBsaW5lSXg/OiBudW1iZXIsIGNoYXJJeD86IG51bWJlciwgc3ludGF4PzogYm9vbGVhbikge1xuICAgIHZhbHVlID0gdmFsdWUuc2xpY2UoKTtcbiAgICB2YWx1ZS51bnNoaWZ0KFRva2VuLmlkZW50aWZpZXIoXCJoYXNoXCIsIGxpbmVJeCwgY2hhckl4ID8gY2hhckl4ICsgMSA6IHVuZGVmaW5lZCkpO1xuICAgIHJldHVybiBuZXcgU2V4cHIodmFsdWUsIGxpbmVJeCwgY2hhckl4LCBzeW50YXggPyBcImhhc2hcIiA6IHVuZGVmaW5lZCk7XG4gIH1cbiAgc3RhdGljIGFzU2V4cHJzKHZhbHVlczooVG9rZW58U2V4cHIpW10pOlNleHByW10ge1xuICAgIGZvcihsZXQgcmF3IG9mIHZhbHVlcykge1xuICAgICBpZighKHJhdyBpbnN0YW5jZW9mIFNleHByKSkgdGhyb3cgbmV3IFBhcnNlRXJyb3IoYEFsbCB0b3AgbGV2ZWwgZW50cmllcyBtdXN0IGJlIGV4cHJlc3Npb25zIChnb3QgJHtyYXd9KWAsIHVuZGVmaW5lZCwgcmF3LmxpbmVJeCwgcmF3LmNoYXJJeCk7XG4gICAgICBlbHNlIHtcbiAgICAgICAgbGV0IG9wID0gcmF3Lm9wZXJhdG9yO1xuICAgICAgICBpZihvcC50eXBlICE9PSBUb2tlbi5UWVBFLklERU5USUZJRVIpXG4gICAgICAgICAgdGhyb3cgbmV3IFBhcnNlRXJyb3IoYEFsbCBleHByZXNzaW9ucyBtdXN0IGJlZ2luIHdpdGggYW4gaWRlbnRpZmllcmAsIHVuZGVmaW5lZCwgcmF3LmxpbmVJeCwgcmF3LmNoYXJJeCk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiA8U2V4cHJbXT52YWx1ZXM7XG4gIH1cblxuICBwdWJsaWMgdHlwZSA9IFRva2VuLlRZUEUuRVhQUjtcbiAgcHVibGljIHZhbHVlOihUb2tlbnxTZXhwcilbXTtcblxuICBjb25zdHJ1Y3Rvcih2YWw/OiAoVG9rZW58U2V4cHIpW10sIHB1YmxpYyBsaW5lSXg/OiBudW1iZXIsIHB1YmxpYyBjaGFySXg/OiBudW1iZXIsIHB1YmxpYyBzeW50YXggPSBcImV4cHJcIikge1xuICAgIGlmKHZhbCkgdGhpcy52YWx1ZSA9IHZhbC5zbGljZSgpO1xuICB9XG4gIHRvU3RyaW5nKCkge1xuICAgIGxldCBjb250ZW50ID0gdGhpcy52YWx1ZSAmJiB0aGlzLnZhbHVlLm1hcCgodG9rZW4pID0+IHRva2VuLnRvU3RyaW5nKCkpLmpvaW4oXCIgXCIpO1xuICAgIGxldCBhcmdzQ29udGVudCA9IHRoaXMudmFsdWUgJiYgdGhpcy5hcmd1bWVudHMubWFwKCh0b2tlbikgPT4gdG9rZW4udG9TdHJpbmcoKSkuam9pbihcIiBcIik7XG4gICAgaWYodGhpcy5zeW50YXggPT09IFwiaGFzaFwiKSByZXR1cm4gYHske2FyZ3NDb250ZW50fX1gO1xuICAgIGVsc2UgaWYodGhpcy5zeW50YXggPT09IFwibGlzdFwiKSByZXR1cm4gYFske2FyZ3NDb250ZW50fV1gO1xuICAgIGVsc2UgcmV0dXJuIGAoJHtjb250ZW50fSlgO1xuICB9XG5cbiAgcHVzaCh2YWw6VG9rZW58U2V4cHIpIHtcbiAgICB0aGlzLnZhbHVlID0gdGhpcy52YWx1ZSB8fCBbXTtcbiAgICByZXR1cm4gdGhpcy52YWx1ZS5wdXNoKHZhbCk7XG4gIH1cbiAgbnRoKG4sIHZhbD86VG9rZW58U2V4cHIpIHtcbiAgICBpZih2YWwpIHtcbiAgICAgIHRoaXMudmFsdWUgPSB0aGlzLnZhbHVlIHx8IFtdO1xuICAgICAgcmV0dXJuIHRoaXMudmFsdWVbbl0gPSB2YWw7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLnZhbHVlICYmIHRoaXMudmFsdWVbbl07XG4gIH1cbiAgZ2V0IG9wZXJhdG9yKCkge1xuICAgIHJldHVybiB0aGlzLnZhbHVlICYmIHRoaXMudmFsdWVbMF07XG4gIH1cbiAgc2V0IG9wZXJhdG9yKG9wOiBUb2tlbnxTZXhwcikge1xuICAgIHRoaXMudmFsdWUgPSB0aGlzLnZhbHVlIHx8IFtdO1xuICAgIHRoaXMudmFsdWVbMF0gPSBvcDtcbiAgfVxuICBnZXQgYXJndW1lbnRzKCkge1xuICAgIHJldHVybiB0aGlzLnZhbHVlICYmIHRoaXMudmFsdWUuc2xpY2UoMSk7XG4gIH1cbiAgc2V0IGFyZ3VtZW50cyhhcmdzOiAoVG9rZW58U2V4cHIpW10pIHtcbiAgICB0aGlzLnZhbHVlID0gdGhpcy52YWx1ZSB8fCBbXTtcbiAgICB0aGlzLnZhbHVlLmxlbmd0aCA9IDE7XG4gICAgdGhpcy52YWx1ZS5wdXNoLmFwcGx5KHRoaXMudmFsdWUsIGFyZ3MpO1xuICB9XG4gIGdldCBsZW5ndGgoKSB7XG4gICAgcmV0dXJuIHRoaXMudmFsdWUgJiYgdGhpcy52YWx1ZS5sZW5ndGg7XG4gIH1cbn1cblxuY29uc3QgVE9LRU5fVE9fVFlQRSA9IHtcbiAgXCIoXCI6IFwiZXhwclwiLFxuICBcIilcIjogXCJleHByXCIsXG4gIFwiW1wiOiBcImxpc3RcIixcbiAgXCJdXCI6IFwibGlzdFwiLFxuICBcIntcIjogXCJoYXNoXCIsXG4gIFwifVwiOiBcImhhc2hcIlxufTtcblxubGV0IGh5Z2llbmljU3ltYm9sQ291bnRlciA9IDA7XG5cbmV4cG9ydCBmdW5jdGlvbiByZWFkU2V4cHJzKHRleHQ6c3RyaW5nKTpTZXhwciB7XG4gIGxldCByb290ID0gU2V4cHIubGlzdCgpO1xuICBsZXQgdG9rZW46VG9rZW47XG4gIGxldCBzZXhwcjpTZXhwciA9IHJvb3Q7XG4gIGxldCBzZXhwcnM6U2V4cHJbXSA9IFtyb290XTtcblxuICBsZXQgbGluZXMgPSB0ZXh0LnNwbGl0KFwiXFxuXCIpO1xuICBsZXQgbGluZUl4ID0gMDtcbiAgbGV0IG1vZGU6c3RyaW5nO1xuICBmb3IobGV0IGxpbmUgb2YgbGluZXMpIHtcbiAgICBsZXQgbGluZSA9IGxpbmVzW2xpbmVJeF07XG4gICAgbGV0IGNoYXJJeCA9IDA7XG5cbiAgICBpZihtb2RlID09PSBcInN0cmluZ1wiKSB0b2tlbi52YWx1ZSArPSBcIlxcblwiO1xuXG4gICAgd2hpbGUoY2hhckl4IDwgbGluZS5sZW5ndGgpIHtcbiAgICAgIGlmKG1vZGUgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgaWYobGluZVtjaGFySXhdID09PSBcIlxcXCJcIiAmJiBsaW5lW2NoYXJJeCAtIDFdICE9PSBcIlxcXFxcIikge1xuICAgICAgICAgIHNleHByLnB1c2godG9rZW4pO1xuICAgICAgICAgIHRva2VuID0gbW9kZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgICBjaGFySXgrKztcblxuICAgICAgICB9IGVsc2UgdG9rZW4udmFsdWUgKz0gbGluZVtjaGFySXgrK107XG5cbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG5cbiAgICAgIGxldCBwYWRkaW5nID0gcmVhZFdoaWxlKGxpbmUsIC9cXHMvLCBjaGFySXgpO1xuICAgICAgY2hhckl4ICs9IHBhZGRpbmcubGVuZ3RoO1xuICAgICAgaWYocGFkZGluZy5sZW5ndGgpIHtcbiAgICAgICAgaWYodG9rZW4pIHNleHByLnB1c2godG9rZW4pO1xuICAgICAgICB0b2tlbiA9IHVuZGVmaW5lZDtcbiAgICAgIH1cbiAgICAgIGlmKGNoYXJJeCA+PSBsaW5lLmxlbmd0aCkgY29udGludWU7XG5cbiAgICAgIGlmKGxpbmVbY2hhckl4XSA9PT0gXCI7XCIpIHtcbiAgICAgICAgY2hhckl4ID0gbGluZS5sZW5ndGg7XG5cbiAgICAgIH0gZWxzZSBpZihsaW5lW2NoYXJJeF0gPT09IFwiXFxcIlwiKSB7XG4gICAgICAgIGlmKCFzZXhwci5sZW5ndGgpIHRocm93IG5ldyBQYXJzZUVycm9yKGBMaXRlcmFsIG11c3QgYmUgYW4gYXJndW1lbnQgaW4gYSBzZXhwci5gLCBsaW5lLCBsaW5lSXgsIGNoYXJJeCk7XG4gICAgICAgIG1vZGUgPSBcInN0cmluZ1wiO1xuICAgICAgICB0b2tlbiA9IFRva2VuLnN0cmluZyhcIlwiLCBsaW5lSXgsIGNoYXJJeCk7XG4gICAgICAgIGNoYXJJeCsrO1xuXG4gICAgICB9IGVsc2UgaWYobGluZVtjaGFySXhdID09PSBcIjpcIikge1xuICAgICAgICBpZighc2V4cHIubGVuZ3RoKSB0aHJvdyBuZXcgUGFyc2VFcnJvcihgTGl0ZXJhbCBtdXN0IGJlIGFuIGFyZ3VtZW50IGluIGEgc2V4cHIuYCwgbGluZSwgbGluZUl4LCBjaGFySXgpO1xuICAgICAgICBsZXQga2V5d29yZCA9IHJlYWRVbnRpbEFueShsaW5lLCBbXCIgXCIsIFwiKVwiLCBcIl1cIiwgXCJ9XCJdLCArK2NoYXJJeCk7XG4gICAgICAgIHNleHByLnB1c2goVG9rZW4ua2V5d29yZChrZXl3b3JkLCBsaW5lSXgsIGNoYXJJeCAtIDEpKTtcbiAgICAgICAgY2hhckl4ICs9IGtleXdvcmQubGVuZ3RoO1xuXG4gICAgICB9IGVsc2UgaWYobGluZVtjaGFySXhdID09PSBcIihcIiB8fCBsaW5lW2NoYXJJeF0gPT09IFwiW1wiIHx8IGxpbmVbY2hhckl4XSA9PT0gXCJ7XCIpIHtcbiAgICAgICAgaWYodG9rZW4pIHRocm93IG5ldyBQYXJzZUVycm9yKGBTZXhwciBhcmd1bWVudHMgbXVzdCBiZSBzcGFjZSBzZXBhcmF0ZWQuYCwgbGluZSwgbGluZUl4LCBjaGFySXgpO1xuICAgICAgICBsZXQgdHlwZSA9IFRPS0VOX1RPX1RZUEVbbGluZVtjaGFySXhdXTtcbiAgICAgICAgaWYodHlwZSA9PT0gXCJoYXNoXCIpIHNleHByID0gU2V4cHIuaGFzaCh1bmRlZmluZWQsIGxpbmVJeCwgY2hhckl4KTtcbiAgICAgICAgZWxzZSBpZih0eXBlID09PSBcImxpc3RcIikgc2V4cHIgPSBTZXhwci5saXN0KHVuZGVmaW5lZCwgbGluZUl4LCBjaGFySXgpO1xuICAgICAgICBlbHNlIHNleHByID0gbmV3IFNleHByKHVuZGVmaW5lZCwgbGluZUl4LCBjaGFySXgpO1xuICAgICAgICBzZXhwci5zeW50YXggPSB0eXBlO1xuICAgICAgICBzZXhwcnMucHVzaChzZXhwcik7XG4gICAgICAgIGNoYXJJeCsrO1xuXG4gICAgICB9IGVsc2UgaWYobGluZVtjaGFySXhdID09PSBcIilcIiB8fCBsaW5lW2NoYXJJeF0gPT09IFwiXVwiIHx8IGxpbmVbY2hhckl4XSA9PT0gXCJ9XCIpIHtcbiAgICAgICAgbGV0IGNoaWxkID0gc2V4cHJzLnBvcCgpO1xuICAgICAgICBsZXQgdHlwZSA9IFRPS0VOX1RPX1RZUEVbbGluZVtjaGFySXhdXTtcbiAgICAgICAgaWYoY2hpbGQuc3ludGF4ICE9PSB0eXBlKSB0aHJvdyBuZXcgUGFyc2VFcnJvcihgTXVzdCB0ZXJtaW5hdGUgJHtjaGlsZC5zeW50YXh9IGJlZm9yZSB0ZXJtaW5hdGluZyAke3R5cGV9YCwgbGluZSwgbGluZUl4LCBjaGFySXgpO1xuICAgICAgICBzZXhwciA9IHNleHByc1tzZXhwcnMubGVuZ3RoIC0gMV07XG4gICAgICAgIGlmKCFzZXhwcikgdGhyb3cgbmV3IFBhcnNlRXJyb3IoYFRvbyBtYW55IGNsb3NpbmcgcGFyZW5zYCwgbGluZSwgbGluZUl4LCBjaGFySXgpO1xuICAgICAgICBzZXhwci5wdXNoKGNoaWxkKTtcbiAgICAgICAgY2hhckl4Kys7XG5cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGxldCBsaXRlcmFsID0gcmVhZFVudGlsQW55KGxpbmUsIFtcIiBcIiwgXCIpXCIsIFwiXVwiLCBcIn1cIl0sIGNoYXJJeCk7XG4gICAgICAgIGxldCBsZW5ndGggPSBsaXRlcmFsLmxlbmd0aDtcbiAgICAgICAgbGl0ZXJhbCA9IGNvZXJjZUlucHV0KGxpdGVyYWwpO1xuICAgICAgICBsZXQgdHlwZSA9IHR5cGVvZiBsaXRlcmFsID09PSBcInN0cmluZ1wiID8gXCJpZGVudGlmaWVyXCIgOiBcImxpdGVyYWxcIjtcbiAgICAgICAgaWYoIXNleHByLmxlbmd0aCAmJiB0eXBlICE9PSBcImlkZW50aWZpZXJcIikgdGhyb3cgbmV3IFBhcnNlRXJyb3IoYEV4cHIgbXVzdCBiZWdpbiB3aXRoIGlkZW50aWZpZXIuYCwgbGluZSwgbGluZUl4LCBjaGFySXgpO1xuICAgICAgICBpZih0eXBlID09PSBcImlkZW50aWZpZXJcIikge1xuICAgICAgICAgIGxldCBkb3RJeCA9IGxpdGVyYWwuaW5kZXhPZihcIi5cIik7XG4gICAgICAgICAgaWYoZG90SXggIT09IC0xKSB7XG4gICAgICAgICAgICBsZXQgY2hpbGQ6U2V4cHIgPSBuZXcgU2V4cHIoW1xuICAgICAgICAgICAgICBUb2tlbi5pZGVudGlmaWVyKFwiZ2V0XCIsIGxpbmVJeCwgY2hhckl4ICsgMSksXG4gICAgICAgICAgICAgIFRva2VuLmlkZW50aWZpZXIobGl0ZXJhbC5zbGljZSgwLCBkb3RJeCksIGxpbmVJeCwgY2hhckl4ICsgMyksXG4gICAgICAgICAgICAgIFRva2VuLnN0cmluZyhsaXRlcmFsLnNsaWNlKGRvdEl4ICsgMSksIGxpbmVJeCwgY2hhckl4ICsgNSArIGRvdEl4KVxuICAgICAgICAgICAgXSwgbGluZUl4LCBjaGFySXgpO1xuICAgICAgICAgICAgc2V4cHIucHVzaChjaGlsZCk7XG5cbiAgICAgICAgICB9IGVsc2Ugc2V4cHIucHVzaChUb2tlbi5pZGVudGlmaWVyKGxpdGVyYWwsIGxpbmVJeCwgY2hhckl4KSk7XG5cbiAgICAgICAgfSBlbHNlIHNleHByLnB1c2goVG9rZW4ubGl0ZXJhbChsaXRlcmFsLCBsaW5lSXgsIGNoYXJJeCkpO1xuICAgICAgICBjaGFySXggKz0gbGVuZ3RoO1xuICAgICAgfVxuICAgIH1cbiAgICBsaW5lSXgrKztcbiAgfVxuICBpZih0b2tlbikgdGhyb3cgbmV3IFBhcnNlRXJyb3IoYFVudGVybWluYXRlZCAke1RPS0VOX1RZUEVbdG9rZW4udHlwZV19IHRva2VuYCwgbGluZXNbbGluZUl4IC0gMV0sIGxpbmVJeCAtIDEpO1xuICBsZXQgbGFzdEl4ID0gbGluZXMubGVuZ3RoIC0gMTtcbiAgaWYoc2V4cHJzLmxlbmd0aCA+IDEpIHRocm93IG5ldyBQYXJzZUVycm9yKGBUb28gZmV3IGNsb3NpbmcgcGFyZW5zYCwgbGluZXNbbGFzdEl4XSwgbGFzdEl4LCBsaW5lc1tsYXN0SXhdLmxlbmd0aCk7XG5cbiAgcmV0dXJuIHJvb3Q7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBtYWNyb2V4cGFuZERTTChzZXhwcjpTZXhwcik6U2V4cHIge1xuICAvLyBAVE9ETzogSW1wbGVtZW50IG1lLlxuICBsZXQgb3AgPSBzZXhwci5vcGVyYXRvcjtcbiAgaWYob3AudmFsdWUgPT09IFwiZWF2XCIpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJAVE9ETzogSW1wbGVtZW50IG1lIVwiKTtcblxuICB9IGVsc2UgaWYob3AudmFsdWUgPT09IFwib25lLW9mXCIpIHtcbiAgICAvLyAob25lLW9mIChxdWVyeSAuLi5ib2R5KSAocXVlcnkgLi4uYm9keSkgLi4uKSA9PlxuICAgIC8vICh1bmlvblxuICAgIC8vICAgKGRlZiBxMSAocXVlcnkgLi4uYm9keTEpKVxuICAgIC8vICAgKGRlZiBxMiAocXVlcnkgKG5lZ2F0ZSBxMSkgLi4uYm9keTIpKSlcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJAVE9ETzogSW1wbGVtZW50IG1lIVwiKTtcblxuICB9IGVsc2UgaWYob3AudmFsdWUgPT09IFwibmVnYXRlXCIpIHtcbiAgICBpZihzZXhwci5sZW5ndGggPiAyKSB0aHJvdyBuZXcgUGFyc2VFcnJvcihgTmVnYXRlIG9ubHkgdGFrZXMgYSBzaW5nbGUgYm9keWAsIHVuZGVmaW5lZCwgc2V4cHIubGluZUl4LCBzZXhwci5jaGFySXgpO1xuICAgIGxldCBzZWxlY3QgPSBtYWNyb2V4cGFuZERTTChTZXhwci5hc1NleHBycyhzZXhwci5hcmd1bWVudHMpWzBdKTtcbiAgICBzZWxlY3QucHVzaChUb2tlbi5rZXl3b3JkKFwiJCRuZWdhdGVkXCIpKTtcbiAgICBzZWxlY3QucHVzaChUb2tlbi5saXRlcmFsKHRydWUpKTtcbiAgICByZXR1cm4gc2VsZWN0O1xuXG4gIH0gZWxzZSBpZihbXCJoYXNoXCIsIFwibGlzdFwiLCBcImdldFwiLCBcImRlZlwiLCBcInF1ZXJ5XCIsIFwidW5pb25cIiwgXCJzZWxlY3RcIiwgXCJtZW1iZXJcIiwgXCJwcm9qZWN0IVwiLCBcImluc2VydCFcIiwgXCJyZW1vdmUhXCIsIFwibG9hZCFcIl0uaW5kZXhPZihvcC52YWx1ZSkgPT09IC0xKSB7XG4gICAgLy8gKGZvby1iYXIgOmEgNSkgPT4gKHNlbGVjdCBcImZvbyBiYXJcIiA6YSA1KVxuICAgIGxldCBzb3VyY2UgPSBvcDtcbiAgICBzb3VyY2UudHlwZSA9IFRva2VuLlRZUEUuU1RSSU5HO1xuICAgIHNvdXJjZS52YWx1ZSA9IHNvdXJjZS52YWx1ZS5yZXBsYWNlKC8oLj8pLSguKS9nLCBcIiQxICQyXCIpO1xuICAgIGxldCBhcmdzID0gc2V4cHIuYXJndW1lbnRzO1xuICAgIGFyZ3MudW5zaGlmdChzb3VyY2UpO1xuICAgIHNleHByLmFyZ3VtZW50cyA9IGFyZ3M7XG4gICAgc2V4cHIub3BlcmF0b3IgPSBUb2tlbi5pZGVudGlmaWVyKFwic2VsZWN0XCIpO1xuICB9XG4gIHJldHVybiBzZXhwcjtcbn1cbmVudW0gVkFMVUUgeyBOVUxMLCBTQ0FMQVIsIFNFVCwgVklFVyB9O1xuZXhwb3J0IHR5cGUgQXJ0aWZhY3RzID0ge2NoYW5nZXNldD86IHJ1bnRpbWUuRGlmZiwgdmlld3M6IHtbcXVlcnk6c3RyaW5nXTogcnVudGltZS5RdWVyeXxydW50aW1lLlVuaW9ufX07XG50eXBlIFZhcmlhYmxlID0ge25hbWU6IHN0cmluZywgdHlwZTogVkFMVUUsIHN0YXRpYz86IGJvb2xlYW4sIHZhbHVlPzogYW55LCBwcm9qZWN0aW9uPzogc3RyaW5nLCBjb25zdHJhaW50czogW3N0cmluZywgc3RyaW5nXVtdfTtcbnR5cGUgVmFyaWFibGVDb250ZXh0ID0gVmFyaWFibGVbXTtcblxuZXhwb3J0IGZ1bmN0aW9uIHBhcnNlRFNMKHRleHQ6c3RyaW5nKTpBcnRpZmFjdHMge1xuICBsZXQgYXJ0aWZhY3RzOkFydGlmYWN0cyA9IHt2aWV3czoge319O1xuICBsZXQgbGluZXMgPSB0ZXh0LnNwbGl0KFwiXFxuXCIpO1xuICBsZXQgcm9vdCA9IHJlYWRTZXhwcnModGV4dCk7XG5cbiAgZm9yKGxldCByYXcgb2YgU2V4cHIuYXNTZXhwcnMocm9vdC5hcmd1bWVudHMpKSBwYXJzZURTTFNleHByKHJhdywgYXJ0aWZhY3RzKTtcbiAgcmV0dXJuIGFydGlmYWN0cztcbn1cblxudHlwZSBTZXhwclJlc3VsdCA9IHt0eXBlOlZBTFVFLCB2YWx1ZT86YW55LCBwcm9qZWN0ZWQ/OmFueSwgY29udGV4dD86YW55LCBtYXBwaW5ncz86YW55LCBhZ2dyZWdhdGVkPzpib29sZWFufTtcbmZ1bmN0aW9uIHBhcnNlRFNMU2V4cHIocmF3OlNleHByLCBhcnRpZmFjdHM6QXJ0aWZhY3RzLCBjb250ZXh0PzpWYXJpYWJsZUNvbnRleHQsIHBhcmVudD86cnVudGltZS5RdWVyeXxydW50aW1lLlVuaW9uLCByZXN1bHRWYXJpYWJsZT86c3RyaW5nKTpTZXhwclJlc3VsdCB7XG4gIGlmKHBhcmVudCBpbnN0YW5jZW9mIHJ1bnRpbWUuUXVlcnkpIHZhciBxdWVyeSA9IHBhcmVudDtcbiAgZWxzZSB2YXIgdW5pb24gPSA8cnVudGltZS5Vbmlvbj5wYXJlbnQ7XG4gIGxldCBzZXhwciA9IG1hY3JvZXhwYW5kRFNMKHJhdyk7XG4gIGxldCBvcCA9IHNleHByLm9wZXJhdG9yO1xuICBpZihvcC50eXBlICE9PSBUb2tlbi5UWVBFLklERU5USUZJRVIpXG4gICAgdGhyb3cgbmV3IFBhcnNlRXJyb3IoYEV2YWx1YXRlZCBzZXhwciBtdXN0IGJlZ2luIHdpdGggYW4gaWRlbnRpZmllciAoJyR7b3B9JyBpcyBhICR7VG9rZW4uVFlQRVtvcC50eXBlXX0pYCwgXCJcIiwgcmF3LmxpbmVJeCwgcmF3LmNoYXJJeCk7XG5cbiAgaWYob3AudmFsdWUgPT09IFwibGlzdFwiKSB7XG4gICAgbGV0IHskJGJvZHl9ID0gcGFyc2VBcmd1bWVudHMoc2V4cHIsIHVuZGVmaW5lZCwgXCIkJGJvZHlcIik7XG4gICAgcmV0dXJuIHt0eXBlOiBWQUxVRS5TQ0FMQVIsIHZhbHVlOiAoPGFueT4kJGJvZHkpLm1hcCgodG9rZW4sIGl4KSA9PiByZXNvbHZlVG9rZW5WYWx1ZShgbGlzdCBpdGVtICR7aXh9YCwgdG9rZW4sIGNvbnRleHQpKX07XG4gIH1cbiAgaWYob3AudmFsdWUgPT09IFwiaGFzaFwiKSB7XG4gICAgbGV0IGFyZ3MgPSBwYXJzZUFyZ3VtZW50cyhzZXhwcik7XG4gICAgZm9yKGxldCBhcmcgaW4gYXJncykgYXJnc1thcmddID0gcmVzb2x2ZVRva2VuVmFsdWUoYGhhc2ggaXRlbSAke2FyZ31gLCBhcmdzW2FyZ10sIGNvbnRleHQpO1xuICAgIHJldHVybiB7dHlwZTogVkFMVUUuU0VULCB2YWx1ZTogYXJnc307XG4gIH1cblxuICBpZihvcC52YWx1ZSA9PT0gXCJpbnNlcnQhXCIpIHtcbiAgICAgIGxldCBjaGFuZ2VzZXQgPSBhcnRpZmFjdHMuY2hhbmdlc2V0IHx8IGV2ZS5kaWZmKCk7XG4gICAgICBmb3IobGV0IGFyZyBvZiBzZXhwci5hcmd1bWVudHMpIHtcbiAgICAgICAgICBsZXQgdGFibGUgPSBhcmcudmFsdWVbMF07XG4gICAgICAgICAgbGV0IGZhY3QgPSB7fTtcbiAgICAgICAgICBmb3IobGV0IGl4ID0gMTsgaXggPCBhcmcudmFsdWUubGVuZ3RoOyBpeCArPSAyKSB7XG4gICAgICAgICAgICAgIGxldCBrZXkgPSBhcmcudmFsdWVbaXhdO1xuICAgICAgICAgICAgICBsZXQgdmFsdWUgPSBhcmcudmFsdWVbaXgrMV07XG4gICAgICAgICAgICAgIGZhY3Rba2V5LnZhbHVlXSA9IHZhbHVlLnZhbHVlO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjaGFuZ2VzZXQuYWRkKHRhYmxlLnZhbHVlLCBmYWN0KTtcbiAgICAgIH1cbiAgICAgIGFydGlmYWN0cy5jaGFuZ2VzZXQgPSBjaGFuZ2VzZXQ7XG4gICAgICByZXR1cm47XG4gIH1cblxuICBpZihvcC52YWx1ZSA9PT0gXCJyZW1vdmUhXCIpIHtcbiAgICAgIGxldCBjaGFuZ2VzZXQgPSBhcnRpZmFjdHMuY2hhbmdlc2V0IHx8IGV2ZS5kaWZmKCk7XG4gICAgICBmb3IobGV0IGFyZyBvZiBzZXhwci5hcmd1bWVudHMpIHtcbiAgICAgICAgICBsZXQgdGFibGUgPSBhcmcudmFsdWVbMF07XG4gICAgICAgICAgbGV0IGZhY3QgPSB7fTtcbiAgICAgICAgICBmb3IobGV0IGl4ID0gMTsgaXggPCBhcmcudmFsdWUubGVuZ3RoOyBpeCArPSAyKSB7XG4gICAgICAgICAgICAgIGxldCBrZXkgPSBhcmcudmFsdWVbaXhdO1xuICAgICAgICAgICAgICBsZXQgdmFsdWUgPSBhcmcudmFsdWVbaXgrMV07XG4gICAgICAgICAgICAgIGZhY3Rba2V5LnZhbHVlXSA9IHZhbHVlLnZhbHVlO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjaGFuZ2VzZXQucmVtb3ZlKHRhYmxlLnZhbHVlLCBmYWN0KTtcbiAgICAgIH1cbiAgICAgIGFydGlmYWN0cy5jaGFuZ2VzZXQgPSBjaGFuZ2VzZXQ7XG4gICAgICByZXR1cm47XG4gIH1cblxuICBpZihvcC52YWx1ZSA9PT0gXCJsb2FkIVwiKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCIobG9hZCEgLi4pIGhhcyBub3QgYmVlbiBpbXBsZW1lbnRlZCB5ZXRcIik7XG4gIH1cblxuICBpZihvcC52YWx1ZSA9PT0gXCJxdWVyeVwiKSB7XG4gICAgbGV0IG5ldWVDb250ZXh0OlZhcmlhYmxlQ29udGV4dCA9IFtdO1xuICAgIGxldCB7JCR2aWV3LCAkJG5lZ2F0ZWQsICQkYm9keX0gPSBwYXJzZUFyZ3VtZW50cyhzZXhwciwgdW5kZWZpbmVkLCBcIiQkYm9keVwiKTtcbiAgICBsZXQgcXVlcnlJZCA9ICQkdmlldyA/IHJlc29sdmVUb2tlblZhbHVlKFwidmlld1wiLCAkJHZpZXcsIGNvbnRleHQsIFZBTFVFLlNDQUxBUikgOiB1dWlkKCk7XG4gICAgbGV0IG5ldWUgPSBuZXcgcnVudGltZS5RdWVyeShldmUsIHF1ZXJ5SWQpO1xuICAgIG5ldWVbXCJkaXNwbGF5TmFtZVwiXSA9IHNleHByLnRvU3RyaW5nKCk7XG4gICAgaWYoREVCVUcuaW5zdHJ1bWVudFF1ZXJ5KSBpbnN0cnVtZW50UXVlcnkobmV1ZSwgREVCVUcuaW5zdHJ1bWVudFF1ZXJ5KTtcbiAgICBhcnRpZmFjdHMudmlld3NbcXVlcnlJZF0gPSBuZXVlO1xuICAgIGxldCBhZ2dyZWdhdGVkID0gZmFsc2U7XG4gICAgZm9yKGxldCByYXcgb2YgU2V4cHIuYXNTZXhwcnMoPGFueT4kJGJvZHkpKSB7XG4gICAgICBsZXQgc3RhdGUgPSBwYXJzZURTTFNleHByKHJhdywgYXJ0aWZhY3RzLCBuZXVlQ29udGV4dCwgbmV1ZSk7XG4gICAgICBpZihzdGF0ZSAmJiBzdGF0ZS5hZ2dyZWdhdGVkKSBhZ2dyZWdhdGVkID0gdHJ1ZTtcbiAgICB9XG5cbiAgICBsZXQgcHJvamVjdGlvbk1hcCA9IG5ldWUucHJvamVjdGlvbk1hcDtcbiAgICBsZXQgcHJvamVjdGVkID0gdHJ1ZTtcbiAgICBpZighcHJvamVjdGlvbk1hcCkge1xuICAgICAgcHJvamVjdGlvbk1hcCA9IHt9O1xuICAgICAgcHJvamVjdGVkID0gZmFsc2U7XG4gICAgICBmb3IobGV0IHZhcmlhYmxlIG9mIG5ldWVDb250ZXh0KSBwcm9qZWN0aW9uTWFwW3ZhcmlhYmxlLm5hbWVdID0gdmFyaWFibGUudmFsdWU7XG4gICAgfVxuICAgIGlmKE9iamVjdC5rZXlzKHByb2plY3Rpb25NYXApLmxlbmd0aCkgbmV1ZS5wcm9qZWN0KHByb2plY3Rpb25NYXApO1xuXG4gICAgLy8gSm9pbiBzdWJxdWVyeSB0byBwYXJlbnQuXG4gICAgaWYocGFyZW50KSB7XG4gICAgICBsZXQgc2VsZWN0ID0gbmV3IFNleHByKFtUb2tlbi5pZGVudGlmaWVyKHF1ZXJ5ID8gXCJzZWxlY3RcIiA6IFwibWVtYmVyXCIpLCBUb2tlbi5zdHJpbmcocXVlcnlJZCldLCByYXcubGluZUl4LCByYXcuY2hhckl4KTtcbiAgICAgIGxldCBncm91cHMgPSBbXTtcblxuICAgICAgZm9yKGxldCB2YXJpYWJsZSBvZiBuZXVlQ29udGV4dCkge1xuICAgICAgICBpZihwcm9qZWN0ZWQgJiYgIXZhcmlhYmxlLnByb2plY3Rpb24pIGNvbnRpbnVlO1xuICAgICAgICBsZXQgZmllbGQgPSB2YXJpYWJsZS5wcm9qZWN0aW9uIHx8IHZhcmlhYmxlLm5hbWU7XG4gICAgICAgIHNlbGVjdC5wdXNoKFRva2VuLmtleXdvcmQoZmllbGQpKTtcbiAgICAgICAgaWYocXVlcnkpIHNlbGVjdC5wdXNoKFRva2VuLmlkZW50aWZpZXIodmFyaWFibGUubmFtZSkpO1xuICAgICAgICBlbHNlIHNlbGVjdC5wdXNoKFNleHByLmxpc3QoW1Rva2VuLnN0cmluZyhmaWVsZCldKSk7XG5cbiAgICAgICAgaWYoY29udGV4dCkge1xuICAgICAgICAgIGZvcihsZXQgcGFyZW50VmFyIG9mIGNvbnRleHQpIHtcbiAgICAgICAgICAgIGlmKHBhcmVudFZhci5uYW1lID09PSB2YXJpYWJsZS5uYW1lKSBncm91cHMucHVzaCh2YXJpYWJsZS52YWx1ZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmKCQkbmVnYXRlZCkge1xuICAgICAgICBzZWxlY3QucHVzaChUb2tlbi5rZXl3b3JkKFwiJCRuZWdhdGVkXCIpKTtcbiAgICAgICAgc2VsZWN0LnB1c2goJCRuZWdhdGVkKTtcbiAgICAgIH1cbiAgICAgIGlmKGdyb3Vwcy5sZW5ndGggJiYgYWdncmVnYXRlZCkgbmV1ZS5ncm91cChncm91cHMpO1xuICAgICAgcGFyc2VEU0xTZXhwcihzZWxlY3QsIGFydGlmYWN0cywgY29udGV4dCwgcGFyZW50KTtcbiAgICB9XG5cbiAgICByZXR1cm4ge3ZhbHVlOiBxdWVyeUlkLCB0eXBlOiBWQUxVRS5WSUVXLCBwcm9qZWN0ZWQsIGNvbnRleHQ6IG5ldWVDb250ZXh0fTtcbiAgfVxuXG4gIGlmKG9wLnZhbHVlID09PSBcInVuaW9uXCIpIHtcbiAgICBsZXQgeyQkdmlldywgJCRib2R5LCAkJG5lZ2F0ZWR9ID0gcGFyc2VBcmd1bWVudHMoc2V4cHIsIHVuZGVmaW5lZCwgXCIkJGJvZHlcIik7XG4gICAgbGV0IHVuaW9uSWQgPSAkJHZpZXcgPyByZXNvbHZlVG9rZW5WYWx1ZShcInZpZXdcIiwgJCR2aWV3LCBjb250ZXh0LCBWQUxVRS5TQ0FMQVIpIDogdXVpZCgpO1xuICAgIGxldCBuZXVlID0gbmV3IHJ1bnRpbWUuVW5pb24oZXZlLCB1bmlvbklkKTtcbiAgICBpZihERUJVRy5pbnN0cnVtZW50UXVlcnkpIGluc3RydW1lbnRRdWVyeShuZXVlLCBERUJVRy5pbnN0cnVtZW50UXVlcnkpO1xuICAgIGFydGlmYWN0cy52aWV3c1t1bmlvbklkXSA9IG5ldWU7XG4gICAgbGV0IG1hcHBpbmdzID0ge307XG4gICAgZm9yKGxldCByYXcgb2YgU2V4cHIuYXNTZXhwcnMoPGFueT4kJGJvZHkpKSB7XG4gICAgICBsZXQgY2hpbGQgPSBtYWNyb2V4cGFuZERTTChyYXcpO1xuICAgICAgaWYoY2hpbGQub3BlcmF0b3IudmFsdWUgIT09IFwicXVlcnlcIiAmJiBjaGlsZC5vcGVyYXRvci52YWx1ZSAhPT0gXCJ1bmlvblwiKVxuICAgICAgICB0aHJvdyBuZXcgUGFyc2VFcnJvcihcIlVuaW9ucyBtYXkgb25seSBjb250YWluIHF1ZXJpZXNcIiwgXCJcIiwgcmF3LmxpbmVJeCwgcmF3LmNoYXJJeCk7XG4gICAgICBsZXQgcmVzID0gcGFyc2VEU0xTZXhwcihjaGlsZCwgYXJ0aWZhY3RzLCBjb250ZXh0LCBuZXVlKTtcbiAgICAgIGZvcihsZXQgdmFyaWFibGUgb2YgcmVzLmNvbnRleHQpIHtcbiAgICAgICAgaWYocmVzLnByb2plY3RlZCAmJiAhdmFyaWFibGUucHJvamVjdGlvbikgY29udGludWU7XG4gICAgICAgIGxldCBmaWVsZCA9IHZhcmlhYmxlLnByb2plY3Rpb24gfHwgdmFyaWFibGUubmFtZTtcbiAgICAgICAgaWYoIW1hcHBpbmdzW2ZpZWxkXSkgbWFwcGluZ3NbZmllbGRdID0ge307XG4gICAgICAgIG1hcHBpbmdzW2ZpZWxkXVt2YXJpYWJsZS5uYW1lXSA9IHRydWU7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gSm9pbiBzdWJ1bmlvbiB0byBwYXJlbnRcbiAgICBpZihwYXJlbnQpIHtcbiAgICAgIGxldCBzZWxlY3QgPSBuZXcgU2V4cHIoW1Rva2VuLmlkZW50aWZpZXIocXVlcnkgPyBcInNlbGVjdFwiIDogXCJtZW1iZXJcIiksIFRva2VuLnN0cmluZyh1bmlvbklkKV0sIHJhdy5saW5lSXgsIHJhdy5jaGFySXgpO1xuICAgICAgIGZvcihsZXQgZmllbGQgaW4gbWFwcGluZ3MpIHtcbiAgICAgICAgIGxldCBtYXBwaW5nVmFyaWFibGVzID0gT2JqZWN0LmtleXMobWFwcGluZ3NbZmllbGRdKTtcbiAgICAgICAgIGlmKG1hcHBpbmdWYXJpYWJsZXMubGVuZ3RoID4gMSlcbiAgICAgICAgICB0aHJvdyBuZXcgUGFyc2VFcnJvcihcbiAgICAgICAgICAgIGBBbGwgdmFyaWFibGVzIHByb2plY3RlZCB0byBhIHNpbmdsZSB1bmlvbiBmaWVsZCBtdXN0IGhhdmUgdGhlIHNhbWUgbmFtZS4gRmllbGQgJyR7ZmllbGR9JyBoYXMgJHttYXBwaW5nVmFyaWFibGVzLmxlbmd0aH0gZmllbGRzICgke21hcHBpbmdWYXJpYWJsZXMuam9pbihcIiwgXCIpfSlgLCBcIlwiLCByYXcubGluZUl4LCByYXcuY2hhckl4KTtcbiAgICAgICAgc2VsZWN0LnB1c2goVG9rZW4ua2V5d29yZChmaWVsZCkpO1xuICAgICAgICBzZWxlY3QucHVzaChUb2tlbi5pZGVudGlmaWVyKG1hcHBpbmdWYXJpYWJsZXNbMF0pKTtcbiAgICAgIH1cblxuICAgICAgY29uc29sZS5sb2coXCJ1bmlvbiBzZWxlY3RcIiwgc2VsZWN0LnRvU3RyaW5nKCkpO1xuICAgICAgcGFyc2VEU0xTZXhwcihzZWxlY3QsIGFydGlmYWN0cywgY29udGV4dCwgcGFyZW50KTtcbiAgICB9XG5cbiAgICByZXR1cm4ge3R5cGU6IFZBTFVFLlZJRVcsIHZhbHVlOiB1bmlvbklkLCBtYXBwaW5nc307XG4gIH1cblxuICBpZihvcC52YWx1ZSA9PT0gXCJtZW1iZXJcIikge1xuICAgIGlmKCF1bmlvbikgdGhyb3cgbmV3IFBhcnNlRXJyb3IoYENhbm5vdCBhZGQgbWVtYmVyIHRvIG5vbi11bmlvbiBwYXJlbnRgLCBcIlwiLCByYXcubGluZUl4LCByYXcuY2hhckl4KTtcbiAgICBsZXQgYXJncyA9IHBhcnNlQXJndW1lbnRzKHNleHByLCBbXCIkJHZpZXdcIl0pO1xuICAgIGxldCB7JCR2aWV3LCAkJG5lZ2F0ZWR9ID0gYXJncztcbiAgICBsZXQgdmlldyA9IHJlc29sdmVUb2tlblZhbHVlKFwidmlld1wiLCAkJHZpZXcsIGNvbnRleHQsIFZBTFVFLlNDQUxBUik7XG4gICAgaWYodmlldyA9PT0gdW5kZWZpbmVkKSB0aHJvdyBuZXcgUGFyc2VFcnJvcihcIk11c3Qgc3BlY2lmeSBhIHZpZXcgdG8gYmUgdW5pb25lZFwiLCBcIlwiLCByYXcubGluZUl4LCByYXcuY2hhckl4KTtcblxuICAgIGxldCBqb2luID0ge307XG4gICAgZm9yKGxldCBhcmcgaW4gYXJncykge1xuICAgICAgaWYoYXJnID09PSBcIiQkdmlld1wiIHx8IGFyZyA9PT0gXCIkJG5lZ2F0ZWRcIikgY29udGludWU7XG4gICAgICBqb2luW2FyZ10gPSByZXNvbHZlVG9rZW5WYWx1ZShcIm1lbWJlciBmaWVsZFwiLCBhcmdzW2FyZ10sIGNvbnRleHQpO1xuICAgIH1cbiAgICBpZihydW50aW1lLlF1ZXJ5RnVuY3Rpb25zW3ZpZXddKSB0aHJvdyBuZXcgUGFyc2VFcnJvcihgQ2Fubm90IHVuaW9uIHByaW1pdGl2ZSB2aWV3ICcke3ZpZXd9J2AsIFwiXCIsIHJhdy5saW5lSXgsIHJhdy5jaGFySXgpO1xuICAgIHVuaW9uLnVuaW9uKHZpZXcsIGpvaW4pO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGlmKCFwYXJlbnQpIHRocm93IG5ldyBQYXJzZUVycm9yKGBOb24tcXVlcnkgb3IgdW5pb24gc2V4cHJzIG11c3QgYmUgY29udGFpbmVkIHdpdGhpbiBhIHF1ZXJ5IG9yIHVuaW9uYCwgXCJcIiwgcmF3LmxpbmVJeCwgcmF3LmNoYXJJeCk7XG5cbiAgaWYob3AudmFsdWUgPT09IFwic2VsZWN0XCIpIHtcbiAgICBpZighcXVlcnkpIHRocm93IG5ldyBQYXJzZUVycm9yKGBDYW5ub3QgYWRkIHNlbGVjdCB0byBub24tcXVlcnkgcGFyZW50YCwgXCJcIiwgcmF3LmxpbmVJeCwgcmF3LmNoYXJJeCk7XG4gICAgbGV0IHNlbGVjdElkID0gdXVpZCgpO1xuICAgIGxldCAkJHZpZXcgPSBnZXRBcmd1bWVudChzZXhwciwgXCIkJHZpZXdcIiwgW1wiJCR2aWV3XCJdKTtcbiAgICBsZXQgdmlldyA9IHJlc29sdmVUb2tlblZhbHVlKFwidmlld1wiLCAkJHZpZXcsIGNvbnRleHQsIFZBTFVFLlNDQUxBUik7XG4gICAgaWYodmlldyA9PT0gdW5kZWZpbmVkKSB0aHJvdyBuZXcgUGFyc2VFcnJvcihcIk11c3Qgc3BlY2lmeSBhIHZpZXcgdG8gYmUgc2VsZWN0ZWRcIiwgXCJcIiwgcmF3LmxpbmVJeCwgcmF3LmNoYXJJeCk7XG4gICAgbGV0IHByaW1pdGl2ZSA9IHJ1bnRpbWUuUXVlcnlGdW5jdGlvbnNbdmlld11cbiAgICAvL0BUT0RPOiBNb3ZlIHRoaXMgdG8gYW4gZXZlIHRhYmxlIHRvIGFsbG93IHVzZXIgZGVmaW5lZCBkZWZhdWx0c1xuICAgIGxldCBhcmdzID0gcGFyc2VBcmd1bWVudHMoc2V4cHIsIFtcIiQkdmlld1wiXS5jb25jYXQoZ2V0RGVmYXVsdHModmlldykpKTtcbiAgICBsZXQgeyQkbmVnYXRlZH0gPSBhcmdzO1xuXG4gICAgbGV0IGpvaW4gPSB7fTtcbiAgICBmb3IobGV0IGFyZyBpbiBhcmdzKSB7XG4gICAgICBsZXQgdmFsdWUgPSBhcmdzW2FyZ107XG4gICAgICBsZXQgdmFyaWFibGU7XG4gICAgICBpZihhcmcgPT09IFwiJCR2aWV3XCIgfHwgYXJnID09PSBcIiQkbmVnYXRlZFwiKSBjb250aW51ZTtcblxuICAgICAgaWYodmFsdWUgaW5zdGFuY2VvZiBUb2tlbiAmJiB2YWx1ZS50eXBlICE9PSBUb2tlbi5UWVBFLklERU5USUZJRVIpIHtcbiAgICAgICAgam9pblthcmddID0gYXJnc1thcmddLnZhbHVlO1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cblxuICAgICAgaWYodmFsdWUgaW5zdGFuY2VvZiBTZXhwcikge1xuICAgICAgICBsZXQgcmVzdWx0ID0gcGFyc2VEU0xTZXhwcih2YWx1ZSwgYXJ0aWZhY3RzLCBjb250ZXh0LCBwYXJlbnQsIGAkJHRlbXAtJHtoeWdpZW5pY1N5bWJvbENvdW50ZXIrK30tJHthcmd9YCk7XG4gICAgICAgIGlmKCFyZXN1bHQgfHwgcmVzdWx0LnR5cGUgPT09IFZBTFVFLk5VTEwpIHRocm93IG5ldyBFcnJvcihgQ2Fubm90IHNldCBwYXJhbWV0ZXIgJyR7YXJnfScgdG8gbnVsbCB2YWx1ZSAnJHt2YWx1ZS50b1N0cmluZygpfSdgKTtcbiAgICAgICAgaWYocmVzdWx0LnR5cGUgPT09IFZBTFVFLlZJRVcpIHtcbiAgICAgICAgICBsZXQgdmlldyA9IHJlc3VsdC52YWx1ZTtcbiAgICAgICAgICBsZXQgcmVzdWx0RmllbGQgPSBnZXRSZXN1bHQodmlldyk7XG4gICAgICAgICAgaWYoIXJlc3VsdEZpZWxkKSB0aHJvdyBuZXcgRXJyb3IoYENhbm5vdCBzZXQgcGFyYW1ldGVyICcke2FyZ30nIHRvIHNlbGVjdCB3aXRob3V0IGRlZmF1bHQgcmVzdWx0IGZpZWxkYCk7XG4gICAgICAgICAgZm9yKGxldCBjdXJWYXIgb2YgY29udGV4dCkge1xuICAgICAgICAgICAgZm9yKGxldCBjb25zdHJhaW50IG9mIGN1clZhci5jb25zdHJhaW50cykge1xuICAgICAgICAgICAgICBpZihjb25zdHJhaW50WzBdID09PSB2aWV3ICYmIGNvbnN0cmFpbnRbMV0gPT09IHJlc3VsdEZpZWxkKSB7XG4gICAgICAgICAgICAgICAgdmFyaWFibGUgPSBjdXJWYXI7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB2YXJpYWJsZSA9IGdldERTTFZhcmlhYmxlKHZhbHVlLnZhbHVlLCBjb250ZXh0KTtcblxuICAgICAgaWYodmFyaWFibGUpIHtcbiAgICAgICAgam9pblthcmddID0gdmFyaWFibGUudmFsdWU7XG4gICAgICAgIHZhcmlhYmxlLmNvbnN0cmFpbnRzLnB1c2goW3ZpZXcsIGFyZ10pO1xuICAgICAgfVxuICAgICAgZWxzZSBpZigkJG5lZ2F0ZWQgJiYgJCRuZWdhdGVkLnZhbHVlKVxuICAgICAgICB0aHJvdyBuZXcgUGFyc2VFcnJvcihgQ2Fubm90IGJpbmQgZmllbGQgaW4gbmVnYXRlZCBzZWxlY3QgdG8gdW5kZWZpbmVkIHZhcmlhYmxlICcke3ZhbHVlLnZhbHVlfSdgLCBcIlwiLCByYXcubGluZUl4LCByYXcuY2hhckl4KTtcbiAgICAgIGVsc2UgY29udGV4dC5wdXNoKHtuYW1lOiB2YWx1ZS52YWx1ZSwgdHlwZTogVkFMVUUuU0NBTEFSLCB2YWx1ZTogW3NlbGVjdElkLCBhcmddLCBjb25zdHJhaW50czogW1t2aWV3LCBhcmddXX0pOyAvLyBAVE9ETzogZG9lcyB0aGlzIG5vdCBuZWVkIHRvIGFkZCB0byB0aGUgam9pbiBtYXA/XG4gICAgfVxuXG4gICAgbGV0IHJlc3VsdEZpZWxkID0gZ2V0UmVzdWx0KHZpZXcpO1xuICAgIGlmKHJlc3VsdFZhcmlhYmxlICYmIHJlc3VsdEZpZWxkICYmICFqb2luW3Jlc3VsdEZpZWxkXSkge1xuICAgICAgam9pbltyZXN1bHRGaWVsZF0gPSBbc2VsZWN0SWQsIHJlc3VsdEZpZWxkXTtcbiAgICAgIGNvbnRleHQucHVzaCh7bmFtZTogcmVzdWx0VmFyaWFibGUsIHR5cGU6IFZBTFVFLlNDQUxBUiwgdmFsdWU6IFtzZWxlY3RJZCwgcmVzdWx0RmllbGRdLCBjb25zdHJhaW50czogW1t2aWV3LCByZXN1bHRGaWVsZF1dfSk7XG4gICAgfVxuXG4gICAgaWYocHJpbWl0aXZlKSB7XG4gICAgICBpZigkJG5lZ2F0ZWQpIHtcbiAgICAgICAgaWYocHJpbWl0aXZlLmludmVyc2UpIHZpZXcgPSBwcmltaXRpdmUuaW52ZXJzZTtcbiAgICAgICAgZWxzZSB0aHJvdyBuZXcgUGFyc2VFcnJvcihgQ2Fubm90IGludmVydCBwcmltaXRpdmUgY2FsY3VsYXRpb24gJyR7dmlld30nYCwgXCJcIiwgcmF3LmxpbmVJeCwgcmF3LmNoYXJJeCk7XG4gICAgICB9XG4gICAgICBpZihwcmltaXRpdmUuYWdncmVnYXRlKSBxdWVyeS5hZ2dyZWdhdGUodmlldywgam9pbiwgc2VsZWN0SWQpO1xuICAgICAgZWxzZSBxdWVyeS5jYWxjdWxhdGUodmlldywgam9pbiwgc2VsZWN0SWQpO1xuICAgIH0gZWxzZSBpZigkJG5lZ2F0ZWQpIHF1ZXJ5LmRlc2VsZWN0KHZpZXcsIGpvaW4pO1xuICAgIGVsc2UgcXVlcnkuc2VsZWN0KHZpZXcsIGpvaW4sIHNlbGVjdElkKTtcbiAgICByZXR1cm4ge1xuICAgICAgdHlwZTogVkFMVUUuVklFVyxcbiAgICAgIHZhbHVlOiB2aWV3LFxuICAgICAgYWdncmVnYXRlZDogcHJpbWl0aXZlICYmIHByaW1pdGl2ZS5hZ2dyZWdhdGVcbiAgICB9O1xuICB9XG5cbiAgaWYob3AudmFsdWUgPT09IFwicHJvamVjdCFcIikge1xuICAgIGxldCBhcmdzID0gcGFyc2VBcmd1bWVudHMoc2V4cHIsIFtcIiQkdmlld1wiXSk7XG4gICAgbGV0IHskJHZpZXcsICQkbmVnYXRlZH0gPSBhcmdzO1xuXG4gICAgbGV0IHByb2plY3Rpb25NYXAgPSB7fTtcbiAgICBmb3IobGV0IGFyZyBpbiBhcmdzKSB7XG4gICAgICBsZXQgdmFsdWUgPSBhcmdzW2FyZ107XG4gICAgICBpZihhcmcgPT09IFwiJCR2aWV3XCIgfHwgYXJnID09PSBcIiQkbmVnYXRlZFwiKSBjb250aW51ZTtcbiAgICAgIGlmKHZhbHVlLnR5cGUgIT09IFRva2VuLlRZUEUuSURFTlRJRklFUikge1xuICAgICAgICBwcm9qZWN0aW9uTWFwW2FyZ10gPSBhcmdzW2FyZ10udmFsdWU7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuXG4gICAgICBsZXQgdmFyaWFibGUgPSBnZXREU0xWYXJpYWJsZSh2YWx1ZS52YWx1ZSwgY29udGV4dCk7XG4gICAgICBpZih2YXJpYWJsZSkge1xuICAgICAgICBpZih2YXJpYWJsZS5zdGF0aWMpIHByb2plY3Rpb25NYXBbYXJnXSA9IHZhcmlhYmxlLnZhbHVlO1xuICAgICAgICBlbHNlIGlmKCEkJHZpZXcpIHtcbiAgICAgICAgICB2YXJpYWJsZS5wcm9qZWN0aW9uID0gYXJnO1xuICAgICAgICAgIHByb2plY3Rpb25NYXBbYXJnXSA9IHZhcmlhYmxlLnZhbHVlO1xuICAgICAgICB9IGVsc2UgcHJvamVjdGlvbk1hcFthcmddID0gW3ZhcmlhYmxlLm5hbWVdO1xuICAgICAgfSBlbHNlIHRocm93IG5ldyBQYXJzZUVycm9yKGBDYW5ub3QgYmluZCBwcm9qZWN0ZWQgZmllbGQgdG8gdW5kZWZpbmVkIHZhcmlhYmxlICcke3ZhbHVlLnZhbHVlfSdgLCBcIlwiLCByYXcubGluZUl4LCByYXcuY2hhckl4KTtcbiAgICB9XG5cbiAgICBsZXQgdmlldyA9IHJlc29sdmVUb2tlblZhbHVlKFwidmlld1wiLCAkJHZpZXcsIGNvbnRleHQsIFZBTFVFLlNDQUxBUik7XG4gICAgaWYodmlldyA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICBpZihxdWVyeS5wcm9qZWN0aW9uTWFwKSB0aHJvdyBuZXcgUGFyc2VFcnJvcihcIlF1ZXJ5IGNhbiBvbmx5IHNlbGYtcHJvamVjdCBvbmNlXCIsIFwiXCIsIHJhdy5saW5lSXgsIHJhdy5jaGFySXgpO1xuICAgICAgaWYoJCRuZWdhdGVkICYmICQkbmVnYXRlZC52YWx1ZSkgdGhyb3cgbmV3IFBhcnNlRXJyb3IoYENhbm5vdCBuZWdhdGUgc2VsZi1wcm9qZWN0aW9uYCwgXCJcIiwgcmF3LmxpbmVJeCwgcmF3LmNoYXJJeCk7XG4gICAgICAvLyBQcm9qZWN0IHNlbGZcbiAgICAgIHF1ZXJ5LnByb2plY3QocHJvamVjdGlvbk1hcCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGxldCB1bmlvbiA9IDxydW50aW1lLlVuaW9uPmFydGlmYWN0cy52aWV3c1t2aWV3XSB8fCBuZXcgcnVudGltZS5VbmlvbihldmUsIHZpZXcpO1xuICAgICAgaWYoREVCVUcuaW5zdHJ1bWVudFF1ZXJ5ICYmICFhcnRpZmFjdHMudmlld3Nbdmlld10pIGluc3RydW1lbnRRdWVyeSh1bmlvbiwgREVCVUcuaW5zdHJ1bWVudFF1ZXJ5KTtcbiAgICAgIGFydGlmYWN0cy52aWV3c1t2aWV3XSA9IHVuaW9uO1xuXG4gICAgICAvLyBpZigkJG5lZ2F0ZWQgJiYgJCRuZWdhdGVkLnZhbHVlKSB1bmlvbi51bnVuaW9uKHF1ZXJ5SWQsIHByb2plY3Rpb25NYXApO1xuICAgICAgaWYoJCRuZWdhdGVkICYmICQkbmVnYXRlZC52YWx1ZSlcbiAgICAgICAgdGhyb3cgbmV3IFBhcnNlRXJyb3IoYFVuaW9uIHByb2plY3Rpb25zIG1heSBub3QgYmUgbmVnYXRlZCBpbiB0aGUgY3VycmVudCBydW50aW1lYCwgXCJcIiwgcmF3LmxpbmVJeCwgcmF3LmNoYXJJeCk7XG4gICAgICBlbHNlIHVuaW9uLnVuaW9uKHF1ZXJ5Lm5hbWUsIHByb2plY3Rpb25NYXApO1xuICAgIH1cbiAgICByZXR1cm47XG4gIH1cblxuICB0aHJvdyBuZXcgUGFyc2VFcnJvcihgVW5rbm93biBEU0wgb3BlcmF0b3IgJyR7b3AudmFsdWV9J2AsIFwiXCIsIHJhdy5saW5lSXgsIHJhdy5jaGFySXgpO1xufVxuXG5mdW5jdGlvbiByZXNvbHZlVG9rZW5WYWx1ZShuYW1lOnN0cmluZywgdG9rZW46VG9rZW58U2V4cHIsIGNvbnRleHQ6VmFyaWFibGVDb250ZXh0LCB0eXBlPzpWQUxVRSkge1xuICBpZighdG9rZW4pIHJldHVybjtcbiAgaWYodG9rZW4gaW5zdGFuY2VvZiBTZXhwcikgcmV0dXJuIHBhcnNlRFNMU2V4cHIodG9rZW4sIHVuZGVmaW5lZCwgY29udGV4dCk7XG4gIGlmKHRva2VuIGluc3RhbmNlb2YgVG9rZW4gJiYgdG9rZW4udHlwZSA9PT0gVG9rZW4uVFlQRS5JREVOVElGSUVSKSB7XG4gICAgbGV0IHZhcmlhYmxlID0gZ2V0RFNMVmFyaWFibGUodG9rZW4udmFsdWUsIGNvbnRleHQsIFZBTFVFLlNDQUxBUik7XG4gICAgaWYoIXZhcmlhYmxlKSB0aHJvdyBuZXcgRXJyb3IoYENhbm5vdCBiaW5kICR7bmFtZX0gdG8gdW5kZWZpbmVkIHZhcmlhYmxlICcke3Rva2VuLnZhbHVlfSdgKTtcbiAgICBpZighdmFyaWFibGUuc3RhdGljKSB0aHJvdyBuZXcgRXJyb3IoYENhbm5vdCBiaW5kICR7bmFtZX0gdG8gZHluYW1pYyB2YXJpYWJsZSAnJHt0b2tlbi52YWx1ZX0nYCk7XG4gICAgcmV0dXJuIHZhcmlhYmxlLnZhbHVlO1xuICB9XG4gIHJldHVybiB0b2tlbi52YWx1ZTtcbn1cblxuZnVuY3Rpb24gZ2V0RFNMVmFyaWFibGUobmFtZTpzdHJpbmcsIGNvbnRleHQ6VmFyaWFibGVDb250ZXh0LCB0eXBlPzpWQUxVRSk6VmFyaWFibGUge1xuICBpZighY29udGV4dCkgcmV0dXJuO1xuICBmb3IobGV0IHZhcmlhYmxlIG9mIGNvbnRleHQpIHtcbiAgICBpZih2YXJpYWJsZS5uYW1lID09PSBuYW1lKSB7XG4gICAgICBpZih2YXJpYWJsZS5zdGF0aWMgPT09IGZhbHNlKSB0aHJvdyBuZXcgRXJyb3IoYENhbm5vdCBzdGF0aWNhbGx5IGxvb2sgdXAgZHluYW1pYyB2YXJpYWJsZSAnJHtuYW1lfSdgKTtcbiAgICAgIGlmKHR5cGUgIT09IHVuZGVmaW5lZCAmJiB2YXJpYWJsZS50eXBlICE9PSB0eXBlKVxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEV4cGVjdGVkIHZhcmlhYmxlICcke25hbWV9JyB0byBoYXZlIHR5cGUgJyR7dHlwZX0nLCBidXQgaW5zdGVhZCBoYXMgdHlwZSAnJHt2YXJpYWJsZS50eXBlfSdgKTtcbiAgICAgIHJldHVybiB2YXJpYWJsZTtcbiAgICB9XG4gIH1cbn1cblxuZnVuY3Rpb24gZ2V0RGVmYXVsdHModmlldzpzdHJpbmcpOnN0cmluZ1tdIHtcbiAgcmV0dXJuIChydW50aW1lLlF1ZXJ5RnVuY3Rpb25zW3ZpZXddICYmIHJ1bnRpbWUuUXVlcnlGdW5jdGlvbnNbdmlld10ucGFyYW1zKSB8fCBbXTtcbn1cbmZ1bmN0aW9uIGdldFJlc3VsdCh2aWV3OnN0cmluZyk6c3RyaW5nIHtcbiAgcmV0dXJuIHJ1bnRpbWUuUXVlcnlGdW5jdGlvbnNbdmlld10gJiYgcnVudGltZS5RdWVyeUZ1bmN0aW9uc1t2aWV3XS5yZXN1bHQ7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRBcmd1bWVudChyb290OlNleHByLCBwYXJhbTpzdHJpbmcsIGRlZmF1bHRzPzogc3RyaW5nW10pOlRva2VufFNleHByIHtcbiAgbGV0IGl4ID0gMTtcbiAgbGV0IGRlZmF1bHRJeCA9IDA7XG4gIGZvcihsZXQgaXggPSAxLCBjdXIgPSByb290Lm50aChpeCk7IGl4IDwgcm9vdC5sZW5ndGg7IGl4KyspIHtcbiAgICBpZihjdXIudHlwZSA9PT0gVG9rZW4uVFlQRS5LRVlXT1JEKSB7XG4gICAgICBpZihjdXIudmFsdWUgPT09IHBhcmFtKSByZXR1cm4gcm9vdC5udGgoaXggKyAxKTtcbiAgICAgIGVsc2UgaXggKyAxO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZihkZWZhdWx0cyAmJiBkZWZhdWx0SXggPCBkZWZhdWx0cy5sZW5ndGgpIHtcbiAgICAgICAgbGV0IGtleXdvcmQgPSBkZWZhdWx0c1tkZWZhdWx0SXgrK107XG4gICAgICAgIGlmKGtleXdvcmQgPT09IHBhcmFtKSByZXR1cm4gY3VyO1xuICAgICAgICBlbHNlIGl4ICsgMTtcbiAgICAgIH1cbiAgICAgIHRocm93IG5ldyBFcnJvcihgUGFyYW0gJyR7cGFyYW19JyBub3QgaW4gc2V4cHIgJHtyb290LnRvU3RyaW5nKCl9YCk7XG4gICAgfVxuICB9XG4gIHRocm93IG5ldyBFcnJvcihgUGFyYW0gJyR7cGFyYW19JyBub3QgaW4gc2V4cHIgJHtyb290LnRvU3RyaW5nKCl9YCk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBwYXJzZUFyZ3VtZW50cyhyb290OlNleHByLCBkZWZhdWx0cz86c3RyaW5nW10sIHJlc3Q/OnN0cmluZyk6e1trZXl3b3JkOnN0cmluZ106IFRva2VufFNleHByfSB7XG4gIGxldCBhcmdzOmFueSA9IHt9O1xuICBsZXQgZGVmYXVsdEl4ID0gMDtcbiAgbGV0IGtleXdvcmQ7XG4gIGxldCBrd2FyZyA9IGZhbHNlO1xuICBmb3IobGV0IHJhdyBvZiByb290LmFyZ3VtZW50cykge1xuICAgIGlmKHJhdy50eXBlID09PSBUb2tlbi5UWVBFLktFWVdPUkQpIHtcbiAgICAgIGlmKGtleXdvcmQpIHRocm93IG5ldyBFcnJvcihgS2V5d29yZHMgbWF5IG5vdCBiZSB2YWx1ZXMgJyR7cmF3fSdgKTtcbiAgICAgIGVsc2Uga2V5d29yZCA9IHJhdy52YWx1ZTtcbiAgICB9IGVsc2UgaWYoa2V5d29yZCkge1xuICAgICAgaWYoYXJnc1trZXl3b3JkXSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGFyZ3Nba2V5d29yZF0gPSByYXc7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZighKGFyZ3Nba2V5d29yZF0gaW5zdGFuY2VvZiBBcnJheSkpIGFyZ3Nba2V5d29yZF0gPSBbYXJnc1trZXl3b3JkXV07XG4gICAgICAgIGFyZ3Nba2V5d29yZF0ucHVzaChyYXcpO1xuICAgICAgfVxuICAgICAga2V5d29yZCA9IHVuZGVmaW5lZDtcbiAgICAgIGRlZmF1bHRJeCA9IGRlZmF1bHRzID8gZGVmYXVsdHMubGVuZ3RoIDogMDtcbiAgICAgIGt3YXJnID0gdHJ1ZTtcbiAgICB9IGVsc2UgaWYoZGVmYXVsdHMgJiYgZGVmYXVsdEl4IDwgZGVmYXVsdHMubGVuZ3RoKSB7XG4gICAgICBhcmdzW2RlZmF1bHRzW2RlZmF1bHRJeCsrXV0gPSByYXc7XG4gICAgfSBlbHNlIGlmKHJlc3QpIHtcbiAgICAgIGFyZ3NbcmVzdF0gPSBhcmdzW3Jlc3RdIHx8IFtdO1xuICAgICAgYXJnc1tyZXN0XS5wdXNoKHJhdyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmKGt3YXJnKSB0aHJvdyBuZXcgRXJyb3IoXCJDYW5ub3Qgc3BlY2lmeSBhbiBhcmcgYWZ0ZXIgYSBrd2FyZ1wiKTtcbiAgICAgIGVsc2UgaWYoZGVmYXVsdEl4KSB0aHJvdyBuZXcgRXJyb3IoYFRvbyBtYW55IGFyZ3MsIGV4cGVjdGVkOiAke2RlZmF1bHRzLmxlbmd0aH0sIGdvdDogJHtkZWZhdWx0SXggKyAxfWApO1xuICAgICAgZWxzZSB0aHJvdyBuZXcgRXJyb3IoXCJDYW5ub3Qgc3BlY2lmeSBhbiBhcmcgd2l0aG91dCBkZWZhdWx0IGtleXMgc3BlY2lmaWVkXCIpO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBhcmdzO1xufVxuXG5kZWNsYXJlIHZhciBleHBvcnRzO1xuaWYoRU5WID09PSBcImJyb3dzZXJcIikgd2luZG93W1wicGFyc2VyXCJdID0gZXhwb3J0cztcblxuZXhwb3J0IGZ1bmN0aW9uIGluc3RydW1lbnRRdWVyeShxOmFueSwgaW5zdHJ1bWVudD86RnVuY3Rpb258Ym9vbGVhbikge1xuICBsZXQgaW5zdHJ1bWVudGF0aW9uOkZ1bmN0aW9uID0gPEZ1bmN0aW9uPmluc3RydW1lbnQ7XG4gIGlmKCFpbnN0cnVtZW50IHx8IGluc3RydW1lbnQgPT09IHRydWUpIGluc3RydW1lbnRhdGlvbiA9IChmbiwgYXJncykgPT4gY29uc29sZS5sb2coXCIqXCIsIGZuLCBcIjpcIiwgYXJncyk7XG4gIGxldCBrZXlzID0gW107XG4gIGZvcihsZXQga2V5IGluIHEpIGtleXMucHVzaChrZXkpO1xuICBrZXlzLmZvckVhY2goKGZuKSA9PiB7XG4gICAgaWYoIXEuY29uc3RydWN0b3IucHJvdG90eXBlLmhhc093blByb3BlcnR5KGZuKSB8fCB0eXBlb2YgcVtmbl0gIT09IFwiZnVuY3Rpb25cIikgcmV0dXJuO1xuICAgIHZhciBvbGQgPSBxW2ZuXTtcbiAgICBxW2ZuXSA9IGZ1bmN0aW9uKCkge1xuICAgICAgaW5zdHJ1bWVudGF0aW9uKGZuLCBhcmd1bWVudHMpO1xuICAgICAgcmV0dXJuIG9sZC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgIH1cbiAgfSk7XG4gIHJldHVybiBxO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gYXNEaWZmKGl4ZXIsIGFydGlmYWN0czpBcnRpZmFjdHMpIHtcbiAgbGV0IHZpZXdzID0gYXJ0aWZhY3RzLnZpZXdzO1xuICBsZXQgZGlmZiA9IGl4ZXIuZGlmZigpO1xuICBmb3IobGV0IGlkIGluIHZpZXdzKSBkaWZmLm1lcmdlKHZpZXdzW2lkXS5jaGFuZ2VzZXQoZXZlKSk7XG4gIHJldHVybiBkaWZmO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gYXBwbHlBc0RpZmZzKGFydGlmYWN0czpBcnRpZmFjdHMpIHtcbiAgbGV0IHZpZXdzID0gYXJ0aWZhY3RzLnZpZXdzO1xuICBmb3IobGV0IGlkIGluIHZpZXdzKSBldmUuYXBwbHlEaWZmKHZpZXdzW2lkXS5jaGFuZ2VzZXQoZXZlKSk7XG4gIGNvbnNvbGUubG9nKFwiQXBwbGllZCBkaWZmcyBmb3I6XCIpO1xuICBmb3IobGV0IGlkIGluIHZpZXdzKSBjb25zb2xlLmxvZyhcIiAgKiBcIiwgdmlld3NbaWRdIGluc3RhbmNlb2YgcnVudGltZS5RdWVyeSA/IFwiUXVlcnlcIiA6IFwiVW5pb25cIiwgdmlld3NbaWRdLm5hbWUpO1xuICByZXR1cm4gYXJ0aWZhY3RzO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gbG9nQXJ0aWZhY3RzKGFydGlmYWN0czpBcnRpZmFjdHMpIHtcbiAgZm9yKGxldCB2aWV3IGluIGFydGlmYWN0cy52aWV3cykgY29uc29sZS5sb2codmlldywgXCJcXG5cIiwgZXZlLmZpbmQodmlldykpO1xufVxuIiwiaW1wb3J0ICogYXMgYXBwIGZyb20gXCIuL2FwcFwiO1xuaW1wb3J0IHtSZW5kZXJlcn0gZnJvbSBcIi4vbWljcm9SZWFjdFwiO1xuaW1wb3J0IHtjb3B5LCBtZXJnZU9iamVjdH0gZnJvbSBcIi4vdXRpbHNcIjtcbmltcG9ydCAqIGFzIENvZGVNaXJyb3IgZnJvbSBcImNvZGVtaXJyb3JcIjtcbmltcG9ydCAqIGFzIG1hcmtlZCBmcm9tIFwibWFya2VkLWFzdFwiO1xuXG5yZXF1aXJlKFwiY29kZW1pcnJvci9tb2RlL2dmbS9nZm1cIik7XG5yZXF1aXJlKFwiY29kZW1pcnJvci9tb2RlL2Nsb2p1cmUvY2xvanVyZVwiKTtcblxuZGVjbGFyZSB2YXIgdXVpZDtcblxuZnVuY3Rpb24gcmVwbGFjZUFsbChzdHIsIGZpbmQsIHJlcGxhY2UpIHtcbiAgbGV0IHJlZ2V4ID0gbmV3IFJlZ0V4cChmaW5kLnJlcGxhY2UoL1stXFwvXFxcXF4kKis/LigpfFtcXF17fV0vZywgJ1xcXFwkJicpLCAnZycpO1xuICByZXR1cm4gc3RyLnJlcGxhY2UocmVnZXgsIHJlcGxhY2UpO1xufVxuXG5mdW5jdGlvbiB3cmFwV2l0aE1hcmtkb3duKGNtLCB3cmFwcGluZykge1xuICBjbS5vcGVyYXRpb24oKCkgPT4ge1xuICAgIGxldCBmcm9tID0gY20uZ2V0Q3Vyc29yKFwiZnJvbVwiKTtcbiAgICAvLyBpZiB0aGVyZSdzIHNvbWV0aGluZyBzZWxlY3RlZCB3cmFwIGl0XG4gICAgaWYgKGNtLnNvbWV0aGluZ1NlbGVjdGVkKCkpIHtcbiAgICAgIGxldCBzZWxlY3RlZCA9IGNtLmdldFNlbGVjdGlvbigpO1xuICAgICAgbGV0IGNsZWFuZWQgPSByZXBsYWNlQWxsKHNlbGVjdGVkLCB3cmFwcGluZywgXCJcIik7XG4gICAgICBpZiAoc2VsZWN0ZWQuc3Vic3RyaW5nKDAsIHdyYXBwaW5nLmxlbmd0aCkgPT09IHdyYXBwaW5nXG4gICAgICAgICYmIHNlbGVjdGVkLnN1YnN0cmluZyhzZWxlY3RlZC5sZW5ndGggLSB3cmFwcGluZy5sZW5ndGgpID09PSB3cmFwcGluZykge1xuICAgICAgICBjbS5yZXBsYWNlUmFuZ2UoY2xlYW5lZCwgZnJvbSwgY20uZ2V0Q3Vyc29yKFwidG9cIikpO1xuICAgICAgICBjbS5zZXRTZWxlY3Rpb24oZnJvbSwgY20uZ2V0Q3Vyc29yKFwiZnJvbVwiKSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBsZXQgc3RyID0gYCR7d3JhcHBpbmd9JHtjbGVhbmVkfSR7d3JhcHBpbmd9YDtcbiAgICAgICAgY20ucmVwbGFjZVJhbmdlKHN0ciwgZnJvbSwgY20uZ2V0Q3Vyc29yKFwidG9cIikpO1xuICAgICAgICBjbS5zZXRTZWxlY3Rpb24oZnJvbSwgY20uZ2V0Q3Vyc29yKFwiZnJvbVwiKSk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGNtLnJlcGxhY2VSYW5nZShgJHt3cmFwcGluZ30ke3dyYXBwaW5nfWAsIGZyb20pO1xuICAgICAgbGV0IG5ld0xvY2F0aW9uID0geyBsaW5lOiBmcm9tLmxpbmUsIGNoOiBmcm9tLmNoICsgd3JhcHBpbmcubGVuZ3RoIH07XG4gICAgICBjbS5zZXRDdXJzb3IobmV3TG9jYXRpb24pO1xuICAgIH1cbiAgfSlcbn1cblxuZnVuY3Rpb24gcHJlZml4V2l0aE1hcmtkb3duKGNtLCBwcmVmaXgpIHtcbiAgY20ub3BlcmF0aW9uKCgpID0+IHtcbiAgICBsZXQgZnJvbSA9IGNtLmdldEN1cnNvcihcImZyb21cIik7XG4gICAgbGV0IHRvID0gY20uZ2V0Q3Vyc29yKFwidG9cIik7XG4gICAgbGV0IHRvUHJlZml4ID0gW107XG4gICAgZm9yKGxldCBsaW5lSXggPSBmcm9tLmxpbmU7IGxpbmVJeCA8PSB0by5saW5lOyBsaW5lSXgrKykge1xuICAgICAgdmFyIGN1cnJlbnRQcmVmaXggPSBjbS5nZXRSYW5nZSh7bGluZTogbGluZUl4LCBjaDogMH0sIHtsaW5lOiBsaW5lSXgsIGNoOiBwcmVmaXgubGVuZ3RofSk7XG4gICAgICBpZihjdXJyZW50UHJlZml4ICE9PSBwcmVmaXggJiYgY3VycmVudFByZWZpeCAhPT0gXCJcIikge1xuICAgICAgICB0b1ByZWZpeC5wdXNoKGxpbmVJeCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gaWYgZXZlcnl0aGluZyBpbiB0aGUgc2VsZWN0aW9uIGhhcyBiZWVuIHByZWZpeGVkLCB0aGVuIHdlIG5lZWQgdG8gdW5wcmVmaXhcbiAgICBpZih0b1ByZWZpeC5sZW5ndGggPT09IDApIHtcbiAgICAgZm9yKGxldCBsaW5lSXggPSBmcm9tLmxpbmU7IGxpbmVJeCA8PSB0by5saW5lOyBsaW5lSXgrKykge1xuICAgICAgIGNtLnJlcGxhY2VSYW5nZShcIlwiLCB7bGluZTogbGluZUl4LCBjaDogMH0sIHtsaW5lOiBsaW5lSXgsIGNoOiBwcmVmaXgubGVuZ3RofSk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGZvcihsZXQgbGluZUl4IG9mIHRvUHJlZml4KSB7XG4gICAgICAgIGNtLnJlcGxhY2VSYW5nZShwcmVmaXgsIHtsaW5lOiBsaW5lSXgsIGNoOiAwfSk7XG4gICAgICB9XG4gICAgfVxuICB9KTtcbn1cblxudmFyIGRlZmF1bHRLZXlzID0ge1xuICBcIkNtZC1CXCI6IChjbSkgPT4ge1xuICAgIHdyYXBXaXRoTWFya2Rvd24oY20sIFwiKipcIik7XG4gIH0sXG4gIFwiQ21kLUlcIjogKGNtKSA9PiB7XG4gICAgd3JhcFdpdGhNYXJrZG93bihjbSwgXCJfXCIpO1xuICB9LFxufTtcblxuZXhwb3J0IGNsYXNzIFJpY2hUZXh0RWRpdG9yIHtcblxuICBjbUluc3RhbmNlOiBDb2RlTWlycm9yLkVkaXRvcjtcbiAgbWFya3M6IHt9O1xuICB0aW1lb3V0O1xuICBtZXRhOiBhbnk7XG4gIC8vZm9ybWF0IGJhclxuICBmb3JtYXRCYXJEZWxheSA9IDEwMDtcbiAgc2hvd2luZ0Zvcm1hdEJhciA9IGZhbHNlO1xuICBmb3JtYXRCYXJFbGVtZW50OkVsZW1lbnQgPSBudWxsO1xuICAvLyBldmVudHNcbiAgb25VcGRhdGU6IChtZXRhOiBhbnksIGNvbnRlbnQ6IHN0cmluZykgPT4gdm9pZDtcblxuICBjb25zdHJ1Y3Rvcihub2RlLCBvcHRpb25zKSB7XG4gICAgdGhpcy5tYXJrcyA9IHt9O1xuICAgIHRoaXMubWV0YSA9IHt9O1xuICAgIGxldCBleHRyYUtleXMgPSBtZXJnZU9iamVjdChjb3B5KGRlZmF1bHRLZXlzKSwgb3B0aW9ucy5rZXlzIHx8IHt9KTtcbiAgICB0aGlzLmNtSW5zdGFuY2UgPSA8Q29kZU1pcnJvci5FZGl0b3I+Q29kZU1pcnJvcihub2RlLCB7XG4gICAgICBtb2RlOiBcImV2ZVwiLFxuICAgICAgbGluZVdyYXBwaW5nOiB0cnVlLFxuICAgICAgYXV0b0Nsb3NlQnJhY2tldHM6IHRydWUsXG4gICAgICB2aWV3cG9ydE1hcmdpbjogSW5maW5pdHksXG4gICAgICBleHRyYUtleXNcbiAgICB9KTtcbiAgICBsZXQgY20gPSB0aGlzLmNtSW5zdGFuY2U7XG5cbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgY20ub24oXCJjaGFuZ2VzXCIsIChjbSwgY2hhbmdlcykgPT4ge1xuICAgICAgc2VsZi5vbkNoYW5nZXMoY20sIGNoYW5nZXMpO1xuICAgICAgaWYgKHNlbGYub25VcGRhdGUpIHtcbiAgICAgICAgc2VsZi5vblVwZGF0ZShzZWxmLm1ldGEsIGNtLmdldFZhbHVlKCkpO1xuICAgICAgfVxuICAgIH0pO1xuICAgIGNtLm9uKFwiY3Vyc29yQWN0aXZpdHlcIiwgKGNtKSA9PiB7IHNlbGYub25DdXJzb3JBY3Rpdml0eShjbSkgfSk7XG4gICAgY20ub24oXCJtb3VzZWRvd25cIiwgKGNtLCBlKSA9PiB7IHNlbGYub25Nb3VzZURvd24oY20sIGUpIH0pO1xuICAgIGNtLmdldFdyYXBwZXJFbGVtZW50KCkuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNldXBcIiwgKGUpID0+IHtcbiAgICAgIHNlbGYub25Nb3VzZVVwKGNtLCBlKTtcbiAgICB9KTtcbiAgfVxuXG4gIHNob3dGb3JtYXRCYXIoKSB7XG4gICAgLy9AIFRPRE86IHJlLWVuYWJsZSB0aGUgZm9ybWF0IGJhclxuICAgIHJldHVybjtcbiAgICB0aGlzLnNob3dpbmdGb3JtYXRCYXIgPSB0cnVlO1xuICAgIHZhciByZW5kZXJlciA9IG5ldyBSZW5kZXJlcigpO1xuICAgIHZhciBjbSA9IHRoaXMuY21JbnN0YW5jZTtcbiAgICBsZXQgaGVhZCA9IGNtLmdldEN1cnNvcihcImhlYWRcIik7XG4gICAgbGV0IGZyb20gPSBjbS5nZXRDdXJzb3IoXCJmcm9tXCIpO1xuICAgIGxldCB0byA9IGNtLmdldEN1cnNvcihcInRvXCIpO1xuICAgIGxldCBzdGFydCA9IGNtLmN1cnNvckNvb3JkcyhoZWFkLCBcImxvY2FsXCIpO1xuICAgIGxldCB0b3AgPSBzdGFydC5ib3R0b20gKyA1O1xuICAgIGlmKChoZWFkLmxpbmUgPT09IGZyb20ubGluZSAmJiBoZWFkLmNoID09PSBmcm9tLmNoKVxuICAgICAgIHx8IChjbS5jdXJzb3JDb29yZHMoZnJvbSwgXCJsb2NhbFwiKS50b3AgPT09IGNtLmN1cnNvckNvb3Jkcyh0bywgXCJsb2NhbFwiKS50b3ApKSB7XG4gICAgICB0b3AgPSBzdGFydC50b3AgLSA0MDtcbiAgICB9XG4gICAgbGV0IGJhclNpemUgPSAzMDAgLyAyO1xuICAgIHZhciBpdGVtID0ge2M6IFwiZm9ybWF0QmFyXCIsIHN0eWxlOiBgcG9zaXRpb246YWJzb2x1dGU7IGxlZnQ6ICR7c3RhcnQubGVmdCAtIGJhclNpemV9cHg7IHRvcDoke3RvcH1weDtgLCBjaGlsZHJlbjogW1xuICAgICAge2M6IFwiYnV0dG9uIFwiLCB0ZXh0OiBcIkgxXCIsIGNsaWNrOiAoKSA9PiB7IHByZWZpeFdpdGhNYXJrZG93bihjbSwgXCIjIFwiKTsgfX0sXG4gICAgICB7YzogXCJidXR0b24gXCIsIHRleHQ6IFwiSDJcIiwgY2xpY2s6ICgpID0+IHsgcHJlZml4V2l0aE1hcmtkb3duKGNtLCBcIiMjIFwiKTsgfX0sXG4gICAgICB7YzogXCJzZXBcIn0sXG4gICAgICB7YzogXCJidXR0b24gYm9sZFwiLCB0ZXh0OiBcIkJcIiwgY2xpY2s6ICgpID0+IHsgd3JhcFdpdGhNYXJrZG93bihjbSwgXCIqKlwiKTsgfX0sXG4gICAgICB7YzogXCJidXR0b24gaXRhbGljXCIsIHRleHQ6IFwiSVwiLCBjbGljazogKCkgPT4geyB3cmFwV2l0aE1hcmtkb3duKGNtLCBcIl9cIik7IH19LFxuICAgICAge2M6IFwic2VwXCJ9LFxuICAgICAge2M6IFwiYnV0dG9uIFwiLCB0ZXh0OiBcIi1cIiwgY2xpY2s6ICgpID0+IHsgcHJlZml4V2l0aE1hcmtkb3duKGNtLCBcIi0gXCIpOyB9fSxcbiAgICAgIHtjOiBcImJ1dHRvbiBcIiwgdGV4dDogXCIxLlwiLCBjbGljazogKCkgPT4geyBwcmVmaXhXaXRoTWFya2Rvd24oY20sIFwiMS4gXCIpOyB9fSxcbiAgICAgIHtjOiBcImJ1dHRvbiBcIiwgdGV4dDogXCJbIF1cIiwgY2xpY2s6ICgpID0+IHsgcHJlZml4V2l0aE1hcmtkb3duKGNtLCBcIlsgXSBcIik7IH19LFxuICAgICAge2M6IFwic2VwXCJ9LFxuICAgICAge2M6IFwiYnV0dG9uIFwiLCB0ZXh0OiBcImxpbmtcIn0sXG4gICAgXX07XG4gICAgcmVuZGVyZXIucmVuZGVyKFtpdGVtXSk7XG4gICAgbGV0IGVsZW0gPSA8RWxlbWVudD5yZW5kZXJlci5jb250ZW50LmZpcnN0Q2hpbGQ7XG4gICAgdGhpcy5mb3JtYXRCYXJFbGVtZW50ID0gZWxlbTtcbiAgICBjbS5nZXRXcmFwcGVyRWxlbWVudCgpLmFwcGVuZENoaWxkKGVsZW0pO1xuICAgIC8vIHRoaXMuY21JbnN0YW5jZS5hZGRXaWRnZXQocG9zLCBlbGVtKTtcbiAgfVxuXG4gIGhpZGVGb3JtYXRCYXIoKSB7XG4gICAgdGhpcy5zaG93aW5nRm9ybWF0QmFyID0gZmFsc2U7XG4gICAgdGhpcy5mb3JtYXRCYXJFbGVtZW50LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy5mb3JtYXRCYXJFbGVtZW50KTtcbiAgICB0aGlzLmZvcm1hdEJhckVsZW1lbnQgPSBudWxsO1xuICB9XG5cbiAgb25DaGFuZ2VzKGNtLCBjaGFuZ2VzKSB7XG4gICAgbGV0IHNlbGYgPSB0aGlzO1xuICB9XG5cbiAgb25DdXJzb3JBY3Rpdml0eShjbSkge1xuICAgIGlmKHRoaXMuc2hvd2luZ0Zvcm1hdEJhciAmJiAhY20uc29tZXRoaW5nU2VsZWN0ZWQoKSkge1xuICAgICAgdGhpcy5oaWRlRm9ybWF0QmFyKCk7XG4gICAgfVxuICB9XG5cbiAgb25Nb3VzZVVwKGNtLCBlKSB7XG4gICAgaWYoIXRoaXMuc2hvd2luZ0Zvcm1hdEJhcikge1xuICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgY2xlYXJUaW1lb3V0KHRoaXMudGltZW91dCk7XG4gICAgICB0aGlzLnRpbWVvdXQgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgaWYgKGNtLnNvbWV0aGluZ1NlbGVjdGVkKCkpIHtcbiAgICAgICAgICBzZWxmLnNob3dGb3JtYXRCYXIoKTtcbiAgICAgICAgfVxuICAgICAgfSwgdGhpcy5mb3JtYXRCYXJEZWxheSk7XG4gICAgfVxuICB9XG5cbiAgb25Nb3VzZURvd24oY20sIGUpIHtcbiAgICBsZXQgY3Vyc29yID0gY20uY29vcmRzQ2hhcih7IGxlZnQ6IGUuY2xpZW50WCwgdG9wOiBlLmNsaWVudFkgfSk7XG4gICAgbGV0IHBvcyA9IGNtLmluZGV4RnJvbVBvcyhjdXJzb3IpO1xuICAgIGxldCBtYXJrcyA9IGNtLmZpbmRNYXJrc0F0KGN1cnNvcik7XG4gIH1cblxuICBhZGRNYXJrKHBhbmVJZCwgY2VsbCwgZnJvbSwgdG8sIG1hcms/KSB7XG4gICAgbGV0IGNtOmFueSA9IHRoaXMuY21JbnN0YW5jZTtcbiAgICBsZXQgY2VsbElkID0gY2VsbC5pZDtcbiAgICBsZXQgZG9tO1xuICAgIGlmKCFtYXJrKSB7XG4gICAgICBkb20gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgZG9tLmlkID0gYCR7cGFuZUlkfXwke2NlbGxJZH18Y29udGFpbmVyYDtcbiAgICB9IGVsc2Uge1xuICAgICAgZG9tID0gbWFyay5yZXBsYWNlZFdpdGg7XG4gICAgICBtYXJrLmNsZWFyKCk7XG4gICAgfVxuICAgIGxldCBuZXdNYXJrID0gY20ubWFya1RleHQoY20ucG9zRnJvbUluZGV4KGZyb20pLCBjbS5wb3NGcm9tSW5kZXgodG8pLCB7cmVwbGFjZWRXaXRoOiBkb219KTtcbiAgICBuZXdNYXJrLmNlbGwgPSBjZWxsO1xuICAgIGRvbVtcIm1hcmtcIl0gPSBuZXdNYXJrO1xuICAgIHRoaXMubWFya3NbY2VsbElkXSA9IG5ld01hcms7XG4gIH1cblxufVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRWRpdG9yKG5vZGUsIGVsZW0pIHtcbiAgbGV0IG9wdGlvbnMgPSBlbGVtLm9wdGlvbnMgfHwge307XG4gIGxldCBlZGl0b3IgPSBub2RlLmVkaXRvcjtcbiAgbGV0IGNtOmFueTtcbiAgaWYgKCFlZGl0b3IpIHtcbiAgICBlZGl0b3IgPSBub2RlLmVkaXRvciA9IG5ldyBSaWNoVGV4dEVkaXRvcihub2RlLCBvcHRpb25zKTtcbiAgICBjbSA9IG5vZGUuZWRpdG9yLmNtSW5zdGFuY2U7XG4gICAgaWYoIW9wdGlvbnMubm9Gb2N1cykge1xuICAgICAgY20uZm9jdXMoKTtcbiAgICB9XG4gICAgY20ucmVmcmVzaCgpOyAvLyBARklYTUU6IFRoaXMgYWxzbyBuZWVkcyB0byBiZSBjYWxsZWQgYW55IHRpbWUgaXQgaXMgaGlkZGVuIGFuZCBhZGRlZCBhZ2Fpbi5cbiAgfSBlbHNlIHtcbiAgICBjbSA9IG5vZGUuZWRpdG9yLmNtSW5zdGFuY2U7XG4gIH1cbiAgZWRpdG9yLm9uVXBkYXRlID0gZWxlbS5vblVwZGF0ZTtcbiAgZWRpdG9yLm1ldGEgPSBlbGVtLm1ldGEgfHwgZWRpdG9yLm1ldGE7XG4gIGxldCBkb2MgPSBjbS5nZXREb2MoKTtcbiAgaWYgKGRvYy5nZXRWYWx1ZSgpICE9PSBlbGVtLnZhbHVlKSB7XG4gICAgZG9jLnNldFZhbHVlKGVsZW0udmFsdWUgfHwgXCJcIik7XG4gICAgZG9jLmNsZWFySGlzdG9yeSgpO1xuICB9XG4gIGlmKGVsZW0uY2VsbHMpIHtcbiAgICBjbS5vcGVyYXRpb24oKCkgPT4ge1xuICAgICAgbGV0IGNlbGxJZHMgPSB7fTtcbiAgICAgIGZvcihsZXQgY2VsbCBvZiBlbGVtLmNlbGxzKSB7XG4gICAgICAgIGNlbGxJZHNbY2VsbC5pZF0gPSB0cnVlO1xuICAgICAgICBsZXQgbWFyayA9IGVkaXRvci5tYXJrc1tjZWxsLmlkXTtcbiAgICAgICAgbGV0IGFkZCA9IGZhbHNlO1xuICAgICAgICBpZighbWFyaykge1xuICAgICAgICAgIGFkZCA9IHRydWU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgbGV0IGZvdW5kID0gbWFyay5maW5kKCk7XG4gICAgICAgICAgaWYoIWZvdW5kKSB7XG4gICAgICAgICAgICBhZGQgPSB0cnVlO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBpZiB0aGUgbWFyayBkb2Vzbid0IGNvbnRhaW4gdGhlIGNvcnJlY3QgdGV4dCwgd2UgbmVlZCB0byBudWtlIGl0LlxuICAgICAgICAgICAgbGV0IHtmcm9tLCB0b30gPSBmb3VuZDtcbiAgICAgICAgICAgIGlmKGNtLmdldFJhbmdlKGZyb20sIHRvKSAhPT0gY2VsbC52YWx1ZSB8fCBjZWxsLnN0YXJ0ICE9PSBjbS5pbmRleEZyb21Qb3MoZnJvbSkpIHtcbiAgICAgICAgICAgICAgYWRkID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYoYWRkKSB7XG4gICAgICAgICAgZWRpdG9yLmFkZE1hcmsoZWxlbVtcIm1ldGFcIl0ucGFuZUlkLCBjZWxsLCBjZWxsLnN0YXJ0LCBjZWxsLnN0YXJ0ICsgY2VsbC5sZW5ndGgsIG1hcmspO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBmb3IobGV0IG1hcmtJZCBpbiBlZGl0b3IubWFya3MpIHtcbiAgICAgICAgaWYoIWNlbGxJZHNbbWFya0lkXSkge1xuICAgICAgICAgIGVkaXRvci5tYXJrc1ttYXJrSWRdLmNsZWFyKCk7XG4gICAgICAgICAgZGVsZXRlIGVkaXRvci5tYXJrc1ttYXJrSWRdO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gIH1cbn1cblxuXG5Db2RlTWlycm9yLmRlZmluZU1vZGUoXCJldmVcIiwgZnVuY3Rpb24oKSB7XG4gIHJldHVybiB7XG4gICAgc3RhcnRTdGF0ZTogKCkgPT4ge1xuICAgICAgcmV0dXJuIHt9O1xuICAgIH0sXG4gICAgdG9rZW46IGZ1bmN0aW9uKHN0cmVhbSwgc3RhdGUpIHtcbiAgICAgIGlmKHN0cmVhbS5zb2woKSAmJiBzdHJlYW0ucGVlaygpID09PSBcIiNcIikge1xuICAgICAgICBzdGF0ZS5oZWFkZXIgPSB0cnVlO1xuICAgICAgICBzdHJlYW0uZWF0V2hpbGUoXCIjXCIpO1xuICAgICAgICBzdGF0ZS5oZWFkZXJOdW0gPSBzdHJlYW0uY3VycmVudCgpLmxlbmd0aDtcbiAgICAgICAgcmV0dXJuIGBoZWFkZXItaW5kaWNhdG9yIGhlYWRlci1pbmRpY2F0b3ItJHtzdGF0ZS5oZWFkZXJOdW19YDtcbiAgICAgIH0gZWxzZSBpZihzdGF0ZS5oZWFkZXIpIHtcbiAgICAgICAgc3RyZWFtLnNraXBUb0VuZCgpO1xuICAgICAgICBzdGF0ZS5oZWFkZXIgPSBmYWxzZTtcbiAgICAgICAgcmV0dXJuIGBoZWFkZXIgaGVhZGVyLSR7c3RhdGUuaGVhZGVyTnVtfWA7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzdGF0ZS5oZWFkZXIgPSBmYWxzZTtcbiAgICAgICAgc3RyZWFtLnNraXBUb0VuZCgpO1xuICAgICAgfVxuICAgIH1cbiAgfTtcbn0pO1xuXG5Db2RlTWlycm9yLmRlZmluZU1JTUUoXCJ0ZXh0L3gtZXZlXCIsIFwiZXZlXCIpO1xuIiwiaW1wb3J0IHtFTlYsIHV1aWR9IGZyb20gXCIuL3V0aWxzXCI7XG5cbi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4vLyBSdW50aW1lXG4vLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuZGVjbGFyZSB2YXIgZXhwb3J0cztcbmxldCBydW50aW1lID0gZXhwb3J0cztcblxuZXhwb3J0IHZhciBNQVhfTlVNQkVSID0gOTAwNzE5OTI1NDc0MDk5MTtcbmV4cG9ydCB2YXIgSU5DUkVNRU5UQUwgPSBmYWxzZTtcblxuZnVuY3Rpb24gb2JqZWN0c0lkZW50aWNhbChhOntba2V5OnN0cmluZ106IGFueX0sIGI6e1trZXk6c3RyaW5nXTogYW55fSk6Ym9vbGVhbiB7XG4gIHZhciBhS2V5cyA9IE9iamVjdC5rZXlzKGEpO1xuICBmb3IodmFyIGtleSBvZiBhS2V5cykge1xuICAgIC8vVE9ETzogaGFuZGxlIG5vbi1zY2FsYXIgdmFsdWVzXG4gICAgaWYoYVtrZXldICE9PSBiW2tleV0pIHJldHVybiBmYWxzZTtcbiAgfVxuICByZXR1cm4gdHJ1ZTtcbn1cblxuZnVuY3Rpb24gaW5kZXhPZkZhY3QoaGF5c3RhY2ssIG5lZWRsZSkge1xuICBsZXQgaXggPSAwO1xuICBmb3IobGV0IGZhY3Qgb2YgaGF5c3RhY2spIHtcbiAgICBpZihmYWN0Ll9faWQgPT09IG5lZWRsZS5fX2lkKSB7XG4gICAgICByZXR1cm4gaXg7XG4gICAgfVxuICAgIGl4Kys7XG4gIH1cbiAgcmV0dXJuIC0xO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcmVtb3ZlRmFjdChoYXlzdGFjaywgbmVlZGxlKSB7XG4gIGxldCBpeCA9IGluZGV4T2ZGYWN0KGhheXN0YWNrLCBuZWVkbGUpO1xuICBpZihpeCA+IC0xKSBoYXlzdGFjay5zcGxpY2UoaXgsIDEpO1xuICByZXR1cm4gaGF5c3RhY2s7XG59XG5cbmZ1bmN0aW9uIGRpZmZBZGRzQW5kUmVtb3ZlcyhhZGRzLCByZW1vdmVzKSB7XG4gIGxldCBsb2NhbEhhc2ggPSB7fTtcbiAgbGV0IGhhc2hUb0ZhY3QgPSB7fTtcbiAgbGV0IGhhc2hlcyA9IFtdO1xuICBmb3IobGV0IGFkZCBvZiBhZGRzKSB7XG4gICAgbGV0IGhhc2ggPSBhZGQuX19pZDtcbiAgICBpZihsb2NhbEhhc2hbaGFzaF0gPT09IHVuZGVmaW5lZCkge1xuICAgICAgbG9jYWxIYXNoW2hhc2hdID0gMTtcbiAgICAgIGhhc2hUb0ZhY3RbaGFzaF0gPSBhZGQ7XG4gICAgICBoYXNoZXMucHVzaChoYXNoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgbG9jYWxIYXNoW2hhc2hdKys7XG4gICAgfVxuICAgIGFkZC5fX2lkID0gaGFzaDtcbiAgfVxuICBmb3IobGV0IHJlbW92ZSBvZiByZW1vdmVzKSB7XG4gICAgbGV0IGhhc2ggPSByZW1vdmUuX19pZDtcbiAgICBpZihsb2NhbEhhc2hbaGFzaF0gPT09IHVuZGVmaW5lZCkge1xuICAgICAgbG9jYWxIYXNoW2hhc2hdID0gLTE7XG4gICAgICBoYXNoVG9GYWN0W2hhc2hdID0gcmVtb3ZlO1xuICAgICAgaGFzaGVzLnB1c2goaGFzaCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGxvY2FsSGFzaFtoYXNoXS0tO1xuICAgIH1cbiAgICByZW1vdmUuX19pZCA9IGhhc2g7XG4gIH1cbiAgbGV0IHJlYWxBZGRzID0gW107XG4gIGxldCByZWFsUmVtb3ZlcyA9IFtdO1xuICBmb3IobGV0IGhhc2ggb2YgaGFzaGVzKSB7XG4gICAgbGV0IGNvdW50ID0gbG9jYWxIYXNoW2hhc2hdO1xuICAgIGlmKGNvdW50ID4gMCkge1xuICAgICAgbGV0IGZhY3QgPSBoYXNoVG9GYWN0W2hhc2hdO1xuICAgICAgcmVhbEFkZHMucHVzaChmYWN0KTtcbiAgICB9IGVsc2UgaWYoY291bnQgPCAwKSB7XG4gICAgICBsZXQgZmFjdCA9IGhhc2hUb0ZhY3RbaGFzaF07XG4gICAgICByZWFsUmVtb3Zlcy5wdXNoKGZhY3QpO1xuICAgIH1cbiAgfVxuICByZXR1cm4ge2FkZHM6cmVhbEFkZHMsIHJlbW92ZXM6cmVhbFJlbW92ZXN9O1xufVxuXG5mdW5jdGlvbiBnZW5lcmF0ZUVxdWFsaXR5Rm4oa2V5cykge1xuICByZXR1cm4gbmV3IEZ1bmN0aW9uKFwiYVwiLCBcImJcIiwgIGByZXR1cm4gJHtrZXlzLm1hcChmdW5jdGlvbihrZXksIGl4KSB7XG4gICAgaWYoa2V5LmNvbnN0cnVjdG9yID09PSBBcnJheSkge1xuICAgICAgcmV0dXJuIGBhWycke2tleVswXX0nXVsnJHtrZXlbMV19J10gPT09IGJbJyR7a2V5WzBdfSddWycke2tleVsxXX0nXWA7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBgYVtcIiR7a2V5fVwiXSA9PT0gYltcIiR7a2V5fVwiXWA7XG4gICAgfVxuICB9KS5qb2luKFwiICYmIFwiKX07YClcbn1cblxuZnVuY3Rpb24gZ2VuZXJhdGVTdHJpbmdGbihrZXlzKSB7XG4gIGxldCBrZXlTdHJpbmdzID0gW107XG4gIGZvcihsZXQga2V5IG9mIGtleXMpIHtcbiAgICBpZihrZXkuY29uc3RydWN0b3IgPT09IEFycmF5KSB7XG4gICAgICBrZXlTdHJpbmdzLnB1c2goYGFbJyR7a2V5WzBdfSddWycke2tleVsxXX0nXWApO1xuICAgIH0gZWxzZSB7XG4gICAgICBrZXlTdHJpbmdzLnB1c2goYGFbJyR7a2V5fSddYCk7XG4gICAgfVxuICB9XG4gIGxldCBmaW5hbCA9IGtleVN0cmluZ3Muam9pbignICsgXCJ8XCIgKyAnKTtcbiAgcmV0dXJuIG5ldyBGdW5jdGlvbihcImFcIiwgIGByZXR1cm4gJHtmaW5hbH07YCk7XG59XG5cbmZ1bmN0aW9uIGdlbmVyYXRlVW5wcm9qZWN0ZWRTb3J0ZXJDb2RlKHVucHJvamVjdGVkU2l6ZSwgc29ydHMpIHtcbiAgbGV0IGNvbmRpdGlvbnMgPSBbXTtcbiAgbGV0IHBhdGggPSBbXTtcbiAgbGV0IGRpc3RhbmNlID0gdW5wcm9qZWN0ZWRTaXplO1xuICBmb3IobGV0IHNvcnQgb2Ygc29ydHMpIHtcbiAgICBsZXQgY29uZGl0aW9uID0gXCJcIjtcbiAgICBmb3IobGV0IHByZXYgb2YgcGF0aCkge1xuICAgICAgbGV0IFt0YWJsZSwga2V5XSA9IHByZXY7XG4gICAgICBjb25kaXRpb24gKz0gYHVucHJvamVjdGVkW2otJHtkaXN0YW5jZSAtIHRhYmxlfV1bJyR7a2V5fSddID09PSBpdGVtJHt0YWJsZX1bJyR7a2V5fSddICYmIGA7XG4gICAgfVxuICAgIGxldCBbdGFibGUsIGtleSwgZGlyXSA9IHNvcnQ7XG4gICAgbGV0IG9wID0gXCI+XCI7XG4gICAgaWYoZGlyID09PSBcImRlc2NlbmRpbmdcIikge1xuICAgICAgb3AgPSBcIjxcIjtcbiAgICB9XG4gICAgY29uZGl0aW9uICs9IGB1bnByb2plY3RlZFtqLSR7ZGlzdGFuY2UgLSB0YWJsZX1dWycke2tleX0nXSAke29wfSBpdGVtJHt0YWJsZX1bJyR7a2V5fSddYDtcbiAgICBjb25kaXRpb25zLnB1c2goY29uZGl0aW9uKTtcbiAgICBwYXRoLnB1c2goc29ydCk7XG4gIH1cbiAgbGV0IGl0ZW1zID0gW107XG4gIGxldCByZXBvc2l0aW9uZWQgPSBbXTtcbiAgbGV0IGl0ZW1Bc3NpZ25tZW50cyA9IFtdO1xuICBmb3IobGV0IGl4ID0gMDsgaXggPCBkaXN0YW5jZTsgaXgrKykge1xuICAgIGl0ZW1zLnB1c2goYGl0ZW0ke2l4fSA9IHVucHJvamVjdGVkW2orJHtpeH1dYCk7XG4gICAgcmVwb3NpdGlvbmVkLnB1c2goYHVucHJvamVjdGVkW2orJHtpeH1dID0gdW5wcm9qZWN0ZWRbaiAtICR7ZGlzdGFuY2UgLSBpeH1dYCk7XG4gICAgaXRlbUFzc2lnbm1lbnRzLnB1c2goKGB1bnByb2plY3RlZFtqKyR7aXh9XSA9IGl0ZW0ke2l4fWApKTtcbiAgfVxuICByZXR1cm4gYGZvciAodmFyIGkgPSAwLCBsZW4gPSB1bnByb2plY3RlZC5sZW5ndGg7IGkgPCBsZW47IGkgKz0gJHtkaXN0YW5jZX0pIHtcbiAgICAgIHZhciBqID0gaSwgJHtpdGVtcy5qb2luKFwiLCBcIil9O1xuICAgICAgZm9yKDsgaiA+ICR7ZGlzdGFuY2UgLSAxfSAmJiAoJHtjb25kaXRpb25zLmpvaW4oXCIgfHwgXCIpfSk7IGogLT0gJHtkaXN0YW5jZX0pIHtcbiAgICAgICAgJHtyZXBvc2l0aW9uZWQuam9pbihcIjtcXG5cIil9XG4gICAgICB9XG4gICAgICAke2l0ZW1Bc3NpZ25tZW50cy5qb2luKFwiO1xcblwiKX1cbiAgfWA7XG59XG5cbmZ1bmN0aW9uIGdlbmVyYXRlQ29sbGVjdG9yKGtleXMpIHtcbiAgbGV0IGNvZGUgPSBgdmFyIHJ1bnRpbWUgPSB0aGlzO1xcbmA7XG4gIGxldCBpeCA9IDA7XG4gIGxldCBjaGVja3MgPSBcIlwiO1xuICBsZXQgcmVtb3ZlcyA9IFwidmFyIGN1ciA9IGluZGV4XCI7XG4gIGZvcihsZXQga2V5IG9mIGtleXMpIHtcbiAgICBpZihrZXkuY29uc3RydWN0b3IgPT09IEFycmF5KSB7XG4gICAgICByZW1vdmVzICs9IGBbcmVtb3ZlWycke2tleVswXX0nXVsnJHtrZXlbMV19J11dYDtcbiAgICB9IGVsc2Uge1xuICAgICAgcmVtb3ZlcyArPSBgW3JlbW92ZVsnJHtrZXl9J11dYDtcbiAgICB9XG4gIH1cbiAgcmVtb3ZlcyArPSBcIjtcXG5ydW50aW1lLnJlbW92ZUZhY3QoY3VyLCByZW1vdmUpO1wiO1xuICBmb3IobGV0IGtleSBvZiBrZXlzKSB7XG4gICAgaXgrKztcbiAgICBpZihrZXkuY29uc3RydWN0b3IgPT09IEFycmF5KSB7XG4gICAgICBjaGVja3MgKz0gYHZhbHVlID0gYWRkWycke2tleVswXX0nXVsnJHtrZXlbMV19J11cXG5gO1xuICAgIH0gZWxzZSB7XG4gICAgICBjaGVja3MgKz0gYHZhbHVlID0gYWRkWycke2tleX0nXVxcbmA7XG4gICAgfVxuICAgIGxldCBwYXRoID0gYGN1cnNvclt2YWx1ZV1gO1xuICAgIGNoZWNrcyArPSBgaWYoISR7cGF0aH0pICR7cGF0aH0gPSBgO1xuICAgIGlmKGl4ID09PSBrZXlzLmxlbmd0aCkge1xuICAgICAgY2hlY2tzICs9IFwiW11cXG5cIjtcbiAgICB9IGVsc2Uge1xuICAgICAgY2hlY2tzICs9IFwie31cXG5cIjtcbiAgICB9XG4gICAgY2hlY2tzICs9IGBjdXJzb3IgPSAke3BhdGh9XFxuYDtcbiAgfVxuICBjb2RlICs9IGBcbmZvcih2YXIgaXggPSAwLCBsZW4gPSByZW1vdmVzLmxlbmd0aDsgaXggPCBsZW47IGl4KyspIHtcbnZhciByZW1vdmUgPSByZW1vdmVzW2l4XTtcbiR7cmVtb3Zlc31cbn1cbmZvcih2YXIgaXggPSAwLCBsZW4gPSBhZGRzLmxlbmd0aDsgaXggPCBsZW47IGl4KyspIHtcbnZhciBhZGQgPSBhZGRzW2l4XTtcbnZhciBjdXJzb3IgPSBpbmRleDtcbnZhciB2YWx1ZTtcbiR7Y2hlY2tzfSAgY3Vyc29yLnB1c2goYWRkKTtcbn1cbnJldHVybiBpbmRleDtgXG4gIHJldHVybiAobmV3IEZ1bmN0aW9uKFwiaW5kZXhcIiwgXCJhZGRzXCIsIFwicmVtb3Zlc1wiLCBjb2RlKSkuYmluZChydW50aW1lKTtcbn1cblxuZnVuY3Rpb24gZ2VuZXJhdGVDb2xsZWN0b3IyKGtleXMpIHtcbiAgbGV0IGhhc2hQYXJ0cyA9IFtdO1xuICBmb3IobGV0IGtleSBvZiBrZXlzKSB7XG4gICAgaWYoa2V5LmNvbnN0cnVjdG9yID09PSBBcnJheSkge1xuICAgICAgaGFzaFBhcnRzLnB1c2goYGFkZFsnJHtrZXlbMF19J11bJyR7a2V5WzFdfSddYCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGhhc2hQYXJ0cy5wdXNoKGBhZGRbJyR7a2V5fSddYCk7XG4gICAgfVxuICB9XG4gIGxldCBjb2RlID0gYFxuICAgIHZhciBpeENhY2hlID0gY2FjaGUuaXg7XG4gICAgdmFyIGlkQ2FjaGUgPSBjYWNoZS5pZDtcbiAgICBmb3IodmFyIGl4ID0gMCwgbGVuID0gcmVtb3Zlcy5sZW5ndGg7IGl4IDwgbGVuOyBpeCsrKSB7XG4gICAgICB2YXIgcmVtb3ZlID0gcmVtb3Zlc1tpeF07XG4gICAgICB2YXIgaWQgPSByZW1vdmUuX19pZDtcbiAgICAgIHZhciBrZXkgPSBpZENhY2hlW2lkXTtcbiAgICAgIHZhciBmYWN0SXggPSBpeENhY2hlW2lkXTtcbiAgICAgIHZhciBmYWN0cyA9IGluZGV4W2tleV07XG4gICAgICAvL3N3YXAgdGhlIGxhc3QgZmFjdCB3aXRoIHRoaXMgb25lIHRvIHByZXZlbnQgaG9sZXNcbiAgICAgIHZhciBsYXN0RmFjdCA9IGZhY3RzLnBvcCgpO1xuICAgICAgaWYobGFzdEZhY3QgJiYgbGFzdEZhY3QuX19pZCAhPT0gcmVtb3ZlLl9faWQpIHtcbiAgICAgICAgZmFjdHNbZmFjdEl4XSA9IGxhc3RGYWN0O1xuICAgICAgICBpeENhY2hlW2xhc3RGYWN0Ll9faWRdID0gZmFjdEl4O1xuICAgICAgfSBlbHNlIGlmKGZhY3RzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICBkZWxldGUgaW5kZXhba2V5XTtcbiAgICAgIH1cbiAgICAgIGRlbGV0ZSBpZENhY2hlW2lkXTtcbiAgICAgIGRlbGV0ZSBpeENhY2hlW2lkXTtcbiAgICB9XG4gICAgZm9yKHZhciBpeCA9IDAsIGxlbiA9IGFkZHMubGVuZ3RoOyBpeCA8IGxlbjsgaXgrKykge1xuICAgICAgdmFyIGFkZCA9IGFkZHNbaXhdO1xuICAgICAgdmFyIGlkID0gYWRkLl9faWQ7XG4gICAgICB2YXIga2V5ID0gaWRDYWNoZVtpZF0gPSAke2hhc2hQYXJ0cy5qb2luKFwiICsgJ3wnICsgXCIpfTtcbiAgICAgIGlmKGluZGV4W2tleV0gPT09IHVuZGVmaW5lZCkgaW5kZXhba2V5XSA9IFtdO1xuICAgICAgdmFyIGFyciA9IGluZGV4W2tleV07XG4gICAgICBpeENhY2hlW2lkXSA9IGFyci5sZW5ndGg7XG4gICAgICBhcnIucHVzaChhZGQpO1xuICAgIH1cbiAgICByZXR1cm4gaW5kZXg7YDtcbiAgICByZXR1cm4gbmV3IEZ1bmN0aW9uKFwiaW5kZXhcIiwgXCJhZGRzXCIsIFwicmVtb3Zlc1wiLCBcImNhY2hlXCIsIGNvZGUpO1xufVxuXG5mdW5jdGlvbiBtZXJnZUFycmF5cyhhcywgYnMpIHtcbiAgbGV0IGl4ID0gYXMubGVuZ3RoO1xuICBsZXQgc3RhcnQgPSBpeDtcbiAgZm9yKGxldCBiIG9mIGJzKSB7XG4gICAgYXNbaXhdID0gYnNbaXggLSBzdGFydF07XG4gICAgaXgrKztcbiAgfVxuICByZXR1cm4gYXM7XG59XG5cbmV4cG9ydCBjbGFzcyBEaWZmIHtcbiAgdGFibGVzO1xuICBsZW5ndGg7XG4gIGl4ZXI7XG4gIG1ldGE7XG4gIGNvbnN0cnVjdG9yKGl4ZXIpIHtcbiAgICB0aGlzLml4ZXIgPSBpeGVyO1xuICAgIHRoaXMudGFibGVzID0ge307XG4gICAgdGhpcy5sZW5ndGggPSAwO1xuICAgIHRoaXMubWV0YSA9IHt9O1xuICB9XG4gIGVuc3VyZVRhYmxlKHRhYmxlKSB7XG4gICAgbGV0IHRhYmxlRGlmZiA9IHRoaXMudGFibGVzW3RhYmxlXTtcbiAgICBpZighdGFibGVEaWZmKSB7XG4gICAgICB0YWJsZURpZmYgPSB0aGlzLnRhYmxlc1t0YWJsZV0gPSB7YWRkczogW10sIHJlbW92ZXM6IFtdfTtcbiAgICB9XG4gICAgcmV0dXJuIHRhYmxlRGlmZjtcbiAgfVxuICBhZGQodGFibGUsIG9iaikge1xuICAgIGxldCB0YWJsZURpZmYgPSB0aGlzLmVuc3VyZVRhYmxlKHRhYmxlKTtcbiAgICB0aGlzLmxlbmd0aCsrO1xuICAgIHRhYmxlRGlmZi5hZGRzLnB1c2gob2JqKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuICBhZGRNYW55KHRhYmxlLCBvYmpzKSB7XG4gICAgbGV0IHRhYmxlRGlmZiA9IHRoaXMuZW5zdXJlVGFibGUodGFibGUpO1xuICAgIHRoaXMubGVuZ3RoICs9IG9ianMubGVuZ3RoO1xuICAgIG1lcmdlQXJyYXlzKHRhYmxlRGlmZi5hZGRzLCBvYmpzKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuICByZW1vdmVGYWN0cyh0YWJsZSwgb2Jqcykge1xuICAgIGxldCB0YWJsZURpZmYgPSB0aGlzLmVuc3VyZVRhYmxlKHRhYmxlKTtcbiAgICB0aGlzLmxlbmd0aCArPSBvYmpzLmxlbmd0aDtcbiAgICBtZXJnZUFycmF5cyh0YWJsZURpZmYucmVtb3Zlcywgb2Jqcyk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cbiAgcmVtb3ZlKHRhYmxlLCBxdWVyeT8pIHtcbiAgICBsZXQgdGFibGVEaWZmID0gdGhpcy5lbnN1cmVUYWJsZSh0YWJsZSk7XG4gICAgbGV0IGZvdW5kID0gdGhpcy5peGVyLmZpbmQodGFibGUsIHF1ZXJ5KTtcbiAgICB0aGlzLmxlbmd0aCArPSBmb3VuZC5sZW5ndGg7XG4gICAgbWVyZ2VBcnJheXModGFibGVEaWZmLnJlbW92ZXMsIGZvdW5kKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuICBtZXJnZShkaWZmKSB7XG4gICAgZm9yKGxldCB0YWJsZSBpbiBkaWZmLnRhYmxlcykge1xuICAgICAgbGV0IHRhYmxlRGlmZiA9IGRpZmYudGFibGVzW3RhYmxlXTtcbiAgICAgIHRoaXMuYWRkTWFueSh0YWJsZSwgdGFibGVEaWZmLmFkZHMpO1xuICAgICAgdGhpcy5yZW1vdmVGYWN0cyh0YWJsZSwgdGFibGVEaWZmLnJlbW92ZXMpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuICByZXZlcnNlKCkge1xuICAgIGxldCByZXZlcnNlZCA9IG5ldyBEaWZmKHRoaXMuaXhlcik7XG4gICAgZm9yKGxldCB0YWJsZSBpbiB0aGlzLnRhYmxlcykge1xuICAgICAgbGV0IGRpZmYgPSB0aGlzLnRhYmxlc1t0YWJsZV07XG4gICAgICByZXZlcnNlZC5hZGRNYW55KHRhYmxlLCBkaWZmLnJlbW92ZXMpO1xuICAgICAgcmV2ZXJzZWQucmVtb3ZlRmFjdHModGFibGUsIGRpZmYuYWRkcyk7XG4gICAgfVxuICAgIHJldHVybiByZXZlcnNlZDtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgSW5kZXhlciB7XG4gIHRhYmxlcztcbiAgZ2xvYmFsQ291bnQ7XG4gIGVkYlRhYmxlcztcbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy50YWJsZXMgPSB7fTtcbiAgICB0aGlzLmdsb2JhbENvdW50ID0gMDtcbiAgICB0aGlzLmVkYlRhYmxlcyA9IHt9O1xuICB9XG4gIGFkZFRhYmxlKG5hbWUsIGtleXMgPSBbXSkge1xuICAgIGxldCB0YWJsZSA9IHRoaXMudGFibGVzW25hbWVdO1xuICAgIGtleXMgPSBrZXlzLmZpbHRlcigoa2V5KSA9PiBrZXkgIT09IFwiX19pZFwiKTtcbiAgICBpZih0YWJsZSAmJiBrZXlzLmxlbmd0aCkge1xuICAgICAgdGFibGUuZmllbGRzID0ga2V5cztcbiAgICAgIHRhYmxlLnN0cmluZ2lmeSA9IGdlbmVyYXRlU3RyaW5nRm4oa2V5cyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRhYmxlID0gdGhpcy50YWJsZXNbbmFtZV0gPSB7dGFibGU6IFtdLCBoYXNoVG9JeDoge30sIGZhY3RIYXNoOiB7fSwgaW5kZXhlczoge30sIHRyaWdnZXJzOiB7fSwgZmllbGRzOiBrZXlzLCBzdHJpbmdpZnk6IGdlbmVyYXRlU3RyaW5nRm4oa2V5cyksIGtleUxvb2t1cDoge319O1xuICAgICAgdGhpcy5lZGJUYWJsZXNbbmFtZV0gPSB0cnVlO1xuICAgIH1cbiAgICBmb3IobGV0IGtleSBvZiBrZXlzKSB7XG4gICAgICBpZihrZXkuY29uc3RydWN0b3IgPT09IEFycmF5KSB7XG4gICAgICAgIHRhYmxlLmtleUxvb2t1cFtrZXlbMF1dID0ga2V5O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGFibGUua2V5TG9va3VwW2tleV0gPSBrZXk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0YWJsZTtcbiAgfVxuICBjbGVhclRhYmxlKG5hbWUpIHtcbiAgICBsZXQgdGFibGUgPSB0aGlzLnRhYmxlc1tuYW1lXTtcbiAgICBpZighdGFibGUpIHJldHVybjtcblxuICAgIHRhYmxlLnRhYmxlID0gW107XG4gICAgdGFibGUuZmFjdEhhc2ggPSB7fTtcbiAgICBmb3IobGV0IGluZGV4TmFtZSBpbiB0YWJsZS5pbmRleGVzKSB7XG4gICAgICB0YWJsZS5pbmRleGVzW2luZGV4TmFtZV0uaW5kZXggPSB7fTtcbiAgICAgIHRhYmxlLmluZGV4ZXNbaW5kZXhOYW1lXS5jYWNoZSA9IHtpZDoge30sIGl4OiB7fX07XG4gICAgfVxuICB9XG4gIHVwZGF0ZVRhYmxlKHRhYmxlSWQsIGFkZHMsIHJlbW92ZXMpIHtcbiAgICBsZXQgdGFibGUgPSB0aGlzLnRhYmxlc1t0YWJsZUlkXTtcbiAgICBpZighdGFibGUgfHwgIXRhYmxlLmZpZWxkcy5sZW5ndGgpIHtcbiAgICAgIGxldCBleGFtcGxlID0gYWRkc1swXSB8fCByZW1vdmVzWzBdO1xuICAgICAgdGFibGUgPSB0aGlzLmFkZFRhYmxlKHRhYmxlSWQsIE9iamVjdC5rZXlzKGV4YW1wbGUpKTtcbiAgICB9XG4gICAgbGV0IHN0cmluZ2lmeSA9IHRhYmxlLnN0cmluZ2lmeTtcbiAgICBsZXQgZmFjdHMgPSB0YWJsZS50YWJsZTtcbiAgICBsZXQgZmFjdEhhc2ggPSB0YWJsZS5mYWN0SGFzaDtcbiAgICBsZXQgaGFzaFRvSXggPSB0YWJsZS5oYXNoVG9JeDtcbiAgICBsZXQgbG9jYWxIYXNoID0ge307XG4gICAgbGV0IGhhc2hUb0ZhY3QgPSB7fTtcbiAgICBsZXQgaGFzaGVzID0gW107XG4gICAgZm9yKGxldCBhZGQgb2YgYWRkcykge1xuICAgICAgbGV0IGhhc2ggPSBhZGQuX19pZCB8fCBzdHJpbmdpZnkoYWRkKTtcbiAgICAgIGlmKGxvY2FsSGFzaFtoYXNoXSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGxvY2FsSGFzaFtoYXNoXSA9IDE7XG4gICAgICAgIGhhc2hUb0ZhY3RbaGFzaF0gPSBhZGQ7XG4gICAgICAgIGhhc2hlcy5wdXNoKGhhc2gpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbG9jYWxIYXNoW2hhc2hdKys7XG4gICAgICB9XG4gICAgICBhZGQuX19pZCA9IGhhc2g7XG4gICAgfVxuICAgIGZvcihsZXQgcmVtb3ZlIG9mIHJlbW92ZXMpIHtcbiAgICAgIGxldCBoYXNoID0gcmVtb3ZlLl9faWQgfHwgc3RyaW5naWZ5KHJlbW92ZSk7XG4gICAgICBpZihsb2NhbEhhc2hbaGFzaF0gPT09IHVuZGVmaW5lZCkge1xuICAgICAgICBsb2NhbEhhc2hbaGFzaF0gPSAtMTtcbiAgICAgICAgaGFzaFRvRmFjdFtoYXNoXSA9IHJlbW92ZTtcbiAgICAgICAgaGFzaGVzLnB1c2goaGFzaCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBsb2NhbEhhc2hbaGFzaF0tLTtcbiAgICAgIH1cbiAgICAgIHJlbW92ZS5fX2lkID0gaGFzaDtcbiAgICB9XG4gICAgbGV0IHJlYWxBZGRzID0gW107XG4gICAgbGV0IHJlYWxSZW1vdmVzID0gW107XG4gICAgZm9yKGxldCBoYXNoIG9mIGhhc2hlcykge1xuICAgICAgbGV0IGNvdW50ID0gbG9jYWxIYXNoW2hhc2hdO1xuICAgICAgaWYoY291bnQgPiAwICYmICFmYWN0SGFzaFtoYXNoXSkge1xuICAgICAgICBsZXQgZmFjdCA9IGhhc2hUb0ZhY3RbaGFzaF07XG4gICAgICAgIHJlYWxBZGRzLnB1c2goZmFjdCk7XG4gICAgICAgIGZhY3RzLnB1c2goZmFjdCk7XG4gICAgICAgIGZhY3RIYXNoW2hhc2hdID0gZmFjdDtcbiAgICAgICAgaGFzaFRvSXhbaGFzaF0gPSBmYWN0cy5sZW5ndGggLSAxO1xuICAgICAgfSBlbHNlIGlmKGNvdW50IDwgMCAmJiBmYWN0SGFzaFtoYXNoXSkge1xuICAgICAgICBsZXQgZmFjdCA9IGhhc2hUb0ZhY3RbaGFzaF07XG4gICAgICAgIGxldCBpeCA9IGhhc2hUb0l4W2hhc2hdO1xuICAgICAgICAvL3N3YXAgdGhlIGxhc3QgZmFjdCB3aXRoIHRoaXMgb25lIHRvIHByZXZlbnQgaG9sZXNcbiAgICAgICAgbGV0IGxhc3RGYWN0ID0gZmFjdHMucG9wKCk7XG4gICAgICAgIGlmKGxhc3RGYWN0ICYmIGxhc3RGYWN0Ll9faWQgIT09IGZhY3QuX19pZCkge1xuICAgICAgICAgIGZhY3RzW2l4XSA9IGxhc3RGYWN0O1xuICAgICAgICAgIGhhc2hUb0l4W2xhc3RGYWN0Ll9faWRdID0gaXg7XG4gICAgICAgIH1cbiAgICAgICAgcmVhbFJlbW92ZXMucHVzaChmYWN0KTtcbiAgICAgICAgZGVsZXRlIGZhY3RIYXNoW2hhc2hdO1xuICAgICAgICBkZWxldGUgaGFzaFRvSXhbaGFzaF07XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB7YWRkczpyZWFsQWRkcywgcmVtb3ZlczpyZWFsUmVtb3Zlc307XG4gIH1cblxuICBjb2xsZWN0b3Ioa2V5cykge1xuICAgIHJldHVybiB7XG4gICAgICBpbmRleDoge30sXG4gICAgICBjYWNoZToge2lkOiB7fSwgaXg6IHt9fSxcbiAgICAgIGhhc2hlcjogZ2VuZXJhdGVTdHJpbmdGbihrZXlzKSxcbiAgICAgIGNvbGxlY3Q6IGdlbmVyYXRlQ29sbGVjdG9yMihrZXlzKSxcbiAgICB9XG4gIH1cbiAgZmFjdFRvSW5kZXgodGFibGUsIGZhY3QpIHtcbiAgICBsZXQga2V5cyA9IE9iamVjdC5rZXlzKGZhY3QpO1xuICAgIGlmKCFrZXlzLmxlbmd0aCkgcmV0dXJuIHRhYmxlLnRhYmxlLnNsaWNlKCk7XG4gICAgbGV0IGluZGV4ID0gdGhpcy5pbmRleCh0YWJsZSwga2V5cyk7XG4gICAgbGV0IHJlc3VsdCA9IGluZGV4LmluZGV4W2luZGV4Lmhhc2hlcihmYWN0KV07XG4gICAgaWYocmVzdWx0KSB7XG4gICAgICByZXR1cm4gcmVzdWx0LnNsaWNlKCk7XG4gICAgfVxuICAgIHJldHVybiBbXTtcbiAgfVxuICBleGVjRGlmZihkaWZmOiBEaWZmKToge3RyaWdnZXJzOiBhbnksIHJlYWxEaWZmczogYW55fSB7XG4gICAgbGV0IHRyaWdnZXJzID0ge307XG4gICAgbGV0IHJlYWxEaWZmcyA9IHt9O1xuICAgIGxldCB0YWJsZUlkcyA9IE9iamVjdC5rZXlzKGRpZmYudGFibGVzKTtcbiAgICBmb3IobGV0IHRhYmxlSWQgb2YgdGFibGVJZHMpIHtcbiAgICAgIGxldCB0YWJsZURpZmYgPSBkaWZmLnRhYmxlc1t0YWJsZUlkXTtcbiAgICAgIGlmKHRhYmxlRGlmZi5hZGRzLmxlbmd0aCA9PT0gMCAmJiB0YWJsZURpZmYucmVtb3Zlcy5sZW5ndGggPT09IDApIGNvbnRpbnVlO1xuICAgICAgbGV0IHJlYWxEaWZmID0gdGhpcy51cGRhdGVUYWJsZSh0YWJsZUlkLCB0YWJsZURpZmYuYWRkcywgdGFibGVEaWZmLnJlbW92ZXMpO1xuICAgICAgLy8gZ28gdGhyb3VnaCBhbGwgdGhlIGluZGV4ZXMgYW5kIHVwZGF0ZSB0aGVtLlxuICAgICAgbGV0IHRhYmxlID0gdGhpcy50YWJsZXNbdGFibGVJZF07XG4gICAgICBsZXQgaW5kZXhlcyA9IE9iamVjdC5rZXlzKHRhYmxlLmluZGV4ZXMpO1xuICAgICAgZm9yKGxldCBpbmRleE5hbWUgb2YgaW5kZXhlcykge1xuICAgICAgICBsZXQgaW5kZXggPSB0YWJsZS5pbmRleGVzW2luZGV4TmFtZV07XG4gICAgICAgIGluZGV4LmNvbGxlY3QoaW5kZXguaW5kZXgsIHJlYWxEaWZmLmFkZHMsIHJlYWxEaWZmLnJlbW92ZXMsIGluZGV4LmNhY2hlKTtcbiAgICAgIH1cbiAgICAgIGxldCBjdXJUcmlnZ2VycyA9IE9iamVjdC5rZXlzKHRhYmxlLnRyaWdnZXJzKTtcbiAgICAgIGZvcihsZXQgdHJpZ2dlck5hbWUgb2YgY3VyVHJpZ2dlcnMpIHtcbiAgICAgICAgbGV0IHRyaWdnZXIgPSB0YWJsZS50cmlnZ2Vyc1t0cmlnZ2VyTmFtZV07XG4gICAgICAgIHRyaWdnZXJzW3RyaWdnZXJOYW1lXSA9IHRyaWdnZXI7XG4gICAgICB9XG4gICAgICByZWFsRGlmZnNbdGFibGVJZF0gPSByZWFsRGlmZjtcbiAgICB9XG4gICAgcmV0dXJuIHt0cmlnZ2VycywgcmVhbERpZmZzfTtcbiAgfVxuICBleGVjVHJpZ2dlcih0cmlnZ2VyKSB7XG4gICAgbGV0IHRhYmxlID0gdGhpcy50YWJsZSh0cmlnZ2VyLm5hbWUpXG4gICAgLy8gc2luY2Ugdmlld3MgbWlnaHQgYmUgY2hhbmdlZCBkdXJpbmcgdGhlIHRyaWdnZXJpbmcgcHJvY2Vzcywgd2Ugd2FudCB0byBmYXZvclxuICAgIC8vIGp1c3QgdXNpbmcgdGhlIHZpZXcgaXRzZWxmIGFzIHRoZSB0cmlnZ2VyIGlmIGl0IGlzIG9uZS4gT3RoZXJ3aXNlLCB3ZSB1c2UgdGhlXG4gICAgLy8gdHJpZ2dlcidzIGV4ZWMgZnVuY3Rpb24uIFRoaXMgZW5zdXJlcyB0aGF0IGlmIGEgdmlldyBpcyByZWNvbXBpbGVkIGFuZCBhZGRlZFxuICAgIC8vIHRoYXQgYW55IGFscmVhZHkgcXVldWVkIHRyaWdnZXJzIHdpbGwgdXNlIHRoZSB1cGRhdGVkIHZlcnNpb24gb2YgdGhlIHZpZXcgaW5zdGVhZFxuICAgIC8vIG9mIHRoZSBvbGQgcXVldWVkIG9uZS5cbiAgICBsZXQge3Jlc3VsdHMgPSB1bmRlZmluZWQsIHVucHJvamVjdGVkID0gdW5kZWZpbmVkfSA9ICh0YWJsZS52aWV3ID8gdGFibGUudmlldy5leGVjKCkgOiB0cmlnZ2VyLmV4ZWModGhpcykpIHx8IHt9O1xuICAgIGlmKCFyZXN1bHRzKSByZXR1cm47XG4gICAgbGV0IHByZXZSZXN1bHRzID0gdGFibGUuZmFjdEhhc2g7XG4gICAgbGV0IHByZXZIYXNoZXMgPSBPYmplY3Qua2V5cyhwcmV2UmVzdWx0cyk7XG4gICAgdGFibGUudW5wcm9qZWN0ZWQgPSB1bnByb2plY3RlZDtcbiAgICBpZihyZXN1bHRzKSB7XG4gICAgICBsZXQgZGlmZiA9IG5ldyBEaWZmKHRoaXMpO1xuICAgICAgdGhpcy5jbGVhclRhYmxlKHRyaWdnZXIubmFtZSk7XG4gICAgICBkaWZmLmFkZE1hbnkodHJpZ2dlci5uYW1lLCByZXN1bHRzKTtcbiAgICAgIGxldCB7dHJpZ2dlcnN9ID0gdGhpcy5leGVjRGlmZihkaWZmKTtcbiAgICAgIGxldCBuZXdIYXNoZXMgPSB0YWJsZS5mYWN0SGFzaDtcbiAgICAgIGlmKHByZXZIYXNoZXMubGVuZ3RoID09PSBPYmplY3Qua2V5cyhuZXdIYXNoZXMpLmxlbmd0aCkge1xuICAgICAgICBsZXQgc2FtZSA9IHRydWU7XG4gICAgICAgIGZvcihsZXQgaGFzaCBvZiBwcmV2SGFzaGVzKSB7XG4gICAgICAgICAgaWYoIW5ld0hhc2hlc1toYXNoXSkge1xuICAgICAgICAgICAgc2FtZSA9IGZhbHNlO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBzYW1lID8gdW5kZWZpbmVkIDogdHJpZ2dlcnM7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gdHJpZ2dlcnM7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybjtcbiAgfVxuICB0cmFuc2l0aXZlbHlDbGVhclRyaWdnZXJzKHN0YXJ0aW5nVHJpZ2dlcnMpIHtcbiAgICBsZXQgY2xlYXJlZCA9IHt9O1xuICAgIGxldCByZW1haW5pbmcgPSBPYmplY3Qua2V5cyhzdGFydGluZ1RyaWdnZXJzKTtcblxuICAgIGZvcihsZXQgaXggPSAwOyBpeCA8IHJlbWFpbmluZy5sZW5ndGg7IGl4KyspIHtcbiAgICAgIGxldCB0cmlnZ2VyID0gcmVtYWluaW5nW2l4XTtcbiAgICAgIGlmKGNsZWFyZWRbdHJpZ2dlcl0pIGNvbnRpbnVlO1xuICAgICAgdGhpcy5jbGVhclRhYmxlKHRyaWdnZXIpO1xuICAgICAgY2xlYXJlZFt0cmlnZ2VyXSA9IHRydWU7XG4gICAgICByZW1haW5pbmcucHVzaC5hcHBseShyZW1haW5pbmcsIE9iamVjdC5rZXlzKHRoaXMudGFibGUodHJpZ2dlcikudHJpZ2dlcnMpKTtcbiAgICAgIC8vIGNvbnNvbGUubG9nKFwiQ0xFQVJFRDogXCIsIHRyaWdnZXIpO1xuICAgIH1cbiAgICByZXR1cm4gY2xlYXJlZDtcbiAgfVxuICBleGVjVHJpZ2dlcnModHJpZ2dlcnMpIHtcbiAgICBsZXQgbmV3VHJpZ2dlcnMgPSB7fTtcbiAgICBsZXQgcmV0cmlnZ2VyID0gZmFsc2U7XG4gICAgZm9yKGxldCB0cmlnZ2VyTmFtZSBpbiB0cmlnZ2Vycykge1xuICAgICAgLy8gY29uc29sZS5sb2coXCJDYWxsaW5nOlwiLCB0cmlnZ2VyTmFtZSk7XG4gICAgICBsZXQgdHJpZ2dlciA9IHRyaWdnZXJzW3RyaWdnZXJOYW1lXTtcbiAgICAgIGxldCBuZXh0Um91bmQgPSB0aGlzLmV4ZWNUcmlnZ2VyKHRyaWdnZXIpO1xuICAgICAgaWYobmV4dFJvdW5kKSB7XG4gICAgICAgIHJldHJpZ2dlciA9IHRydWU7XG4gICAgICAgIGZvcihsZXQgdHJpZ2dlciBpbiBuZXh0Um91bmQpIHtcbiAgICAgICAgICAvLyBjb25zb2xlLmxvZyhcIlF1ZXVpbmc6XCIsIHRyaWdnZXIpO1xuICAgICAgICAgIG5ld1RyaWdnZXJzW3RyaWdnZXJdID0gbmV4dFJvdW5kW3RyaWdnZXJdO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIGlmKHJldHJpZ2dlcikge1xuICAgICAgcmV0dXJuIG5ld1RyaWdnZXJzO1xuICAgIH1cbiAgfVxuICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvLyBJbmRleGVyIFB1YmxpYyBBUElcbiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgZGVsZXRlREIoKSB7XG4gICAgZm9yKGxldCB0YWJsZSBpbiB0aGlzLnRhYmxlcykge1xuICAgICAgdGhpcy5yZW1vdmVWaWV3KHRhYmxlKTtcbiAgICAgIHRoaXMuY2xlYXJUYWJsZSh0YWJsZSk7XG4gICAgfVxuICB9XG4gIHNlcmlhbGl6ZShhc09iamVjdD8pIHtcbiAgICBsZXQgZHVtcCA9IHt9O1xuICAgIGZvcihsZXQgdGFibGVOYW1lIGluIHRoaXMudGFibGVzKSB7XG4gICAgICBsZXQgdGFibGUgPSB0aGlzLnRhYmxlc1t0YWJsZU5hbWVdO1xuICAgICAgaWYoIXRhYmxlLmlzVmlldykge1xuICAgICAgICBkdW1wW3RhYmxlTmFtZV0gPSB0YWJsZS50YWJsZTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYoYXNPYmplY3QpIHtcbiAgICAgIHJldHVybiBkdW1wO1xuICAgIH1cbiAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkoZHVtcCk7XG4gIH1cbiAgbG9hZChzZXJpYWxpemVkKSB7XG4gICAgbGV0IGR1bXAgPSBKU09OLnBhcnNlKHNlcmlhbGl6ZWQpO1xuICAgIGxldCBkaWZmID0gdGhpcy5kaWZmKCk7XG4gICAgZm9yKGxldCB0YWJsZU5hbWUgaW4gZHVtcCkge1xuICAgICAgZGlmZi5hZGRNYW55KHRhYmxlTmFtZSwgZHVtcFt0YWJsZU5hbWVdKTtcbiAgICB9XG4gICAgaWYoSU5DUkVNRU5UQUwpIHtcbiAgICAgIHRoaXMuYXBwbHlEaWZmSW5jcmVtZW50YWwoZGlmZik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuYXBwbHlEaWZmKGRpZmYpO1xuICAgIH1cbiAgfVxuICBkaWZmKCkge1xuICAgIHJldHVybiBuZXcgRGlmZih0aGlzKTtcbiAgfVxuICBhcHBseURpZmYoZGlmZjpEaWZmKSB7XG4gICAgaWYoSU5DUkVNRU5UQUwpIHtcbiAgICAgIHJldHVybiB0aGlzLmFwcGx5RGlmZkluY3JlbWVudGFsKGRpZmYpO1xuICAgIH1cbiAgICBsZXQge3RyaWdnZXJzLCByZWFsRGlmZnN9ID0gdGhpcy5leGVjRGlmZihkaWZmKTtcbiAgICBsZXQgY2xlYXJlZDtcbiAgICBsZXQgcm91bmQgPSAwO1xuICAgIGlmKHRyaWdnZXJzKSBjbGVhcmVkID0gdGhpcy50cmFuc2l0aXZlbHlDbGVhclRyaWdnZXJzKHRyaWdnZXJzKTtcbiAgICB3aGlsZSh0cmlnZ2Vycykge1xuICAgICAgZm9yKGxldCB0cmlnZ2VyIGluIHRyaWdnZXJzKSB7XG4gICAgICAgIGNsZWFyZWRbdHJpZ2dlcl0gPSBmYWxzZTtcbiAgICAgIH1cbiAgICAgIC8vIGNvbnNvbGUuZ3JvdXAoYFJPVU5EICR7cm91bmR9YCk7XG4gICAgICB0cmlnZ2VycyA9IHRoaXMuZXhlY1RyaWdnZXJzKHRyaWdnZXJzKTtcbiAgICAgIHJvdW5kKys7XG4gICAgICAvLyBjb25zb2xlLmdyb3VwRW5kKCk7XG4gICAgfVxuICAgIGZvcihsZXQgdHJpZ2dlciBvZiBPYmplY3Qua2V5cyhjbGVhcmVkKSkge1xuICAgICAgaWYoIWNsZWFyZWRbdHJpZ2dlcl0pIGNvbnRpbnVlO1xuICAgICAgbGV0IHZpZXcgPSB0aGlzLnRhYmxlKHRyaWdnZXIpLnZpZXc7XG4gICAgICBpZih2aWV3KSB7XG4gICAgICAgIHRoaXMuZXhlY1RyaWdnZXIodmlldyk7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIHRhYmxlKHRhYmxlSWQpIHtcbiAgICBsZXQgdGFibGUgPSB0aGlzLnRhYmxlc1t0YWJsZUlkXTtcbiAgICBpZih0YWJsZSkgcmV0dXJuIHRhYmxlO1xuICAgIHJldHVybiB0aGlzLmFkZFRhYmxlKHRhYmxlSWQpO1xuICB9XG4gIGluZGV4KHRhYmxlT3JJZDpzdHJpbmd8e30sIGtleXM6YW55W10pIHtcbiAgICBsZXQgdGFibGU7XG4gICAgaWYodHlwZW9mIHRhYmxlT3JJZCA9PT0gXCJzdHJpbmdcIikgdGFibGUgPSB0aGlzLnRhYmxlKHRhYmxlT3JJZCk7XG4gICAgZWxzZSB0YWJsZSA9IHRhYmxlT3JJZDtcbiAgICBrZXlzLnNvcnQoKTtcbiAgICBsZXQgaW5kZXhOYW1lID0ga2V5cy5maWx0ZXIoKGtleSkgPT4ga2V5ICE9PSBcIl9faWRcIikuam9pbihcInxcIik7XG4gICAgbGV0IGluZGV4ID0gdGFibGUuaW5kZXhlc1tpbmRleE5hbWVdO1xuICAgIGlmKCFpbmRleCkge1xuICAgICAgbGV0IHRhYmxlS2V5cyA9IFtdO1xuICAgICAgZm9yKGxldCBrZXkgb2Yga2V5cykge1xuICAgICAgICB0YWJsZUtleXMucHVzaCh0YWJsZS5rZXlMb29rdXBba2V5XSB8fCBrZXkpO1xuICAgICAgfVxuICAgICAgaW5kZXggPSB0YWJsZS5pbmRleGVzW2luZGV4TmFtZV0gPSB0aGlzLmNvbGxlY3Rvcih0YWJsZUtleXMpO1xuICAgICAgaW5kZXguY29sbGVjdChpbmRleC5pbmRleCwgdGFibGUudGFibGUsIFtdLCBpbmRleC5jYWNoZSk7XG4gICAgfVxuICAgIHJldHVybiBpbmRleDtcbiAgfVxuICBmaW5kKHRhYmxlSWQsIHF1ZXJ5Pykge1xuICAgIGxldCB0YWJsZSA9IHRoaXMudGFibGVzW3RhYmxlSWRdO1xuICAgIGlmKCF0YWJsZSkge1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH0gZWxzZSBpZighcXVlcnkpIHtcbiAgICAgIHJldHVybiB0YWJsZS50YWJsZS5zbGljZSgpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gdGhpcy5mYWN0VG9JbmRleCh0YWJsZSwgcXVlcnkpO1xuICAgIH1cbiAgfVxuICBmaW5kT25lKHRhYmxlSWQsIHF1ZXJ5Pykge1xuICAgIHJldHVybiB0aGlzLmZpbmQodGFibGVJZCwgcXVlcnkpWzBdO1xuICB9XG4gIHF1ZXJ5KG5hbWUgPSBcInVua25vd25cIikge1xuICAgIHJldHVybiBuZXcgUXVlcnkodGhpcywgbmFtZSk7XG4gIH1cbiAgdW5pb24obmFtZSkge1xuICAgIHJldHVybiBuZXcgVW5pb24odGhpcywgbmFtZSk7XG4gIH1cbiAgdHJpZ2dlcihuYW1lOnN0cmluZywgdGFibGU6c3RyaW5nfHN0cmluZ1tdLCBleGVjOihpeGVyOkluZGV4ZXIpID0+IHZvaWQsIGV4ZWNJbmNyZW1lbnRhbD86KGNoYW5nZXM6YW55KSA9PiBhbnkpIHtcbiAgICBsZXQgdGFibGVzID0gKHR5cGVvZiB0YWJsZSA9PT0gXCJzdHJpbmdcIikgPyBbdGFibGVdIDogdGFibGU7XG4gICAgbGV0IHRyaWdnZXIgPSB7bmFtZSwgdGFibGVzLCBleGVjLCBleGVjSW5jcmVtZW50YWx9O1xuICAgIGZvcihsZXQgdGFibGVJZCBvZiB0YWJsZXMpIHtcbiAgICAgIGxldCB0YWJsZSA9IHRoaXMudGFibGUodGFibGVJZCk7XG4gICAgICB0YWJsZS50cmlnZ2Vyc1tuYW1lXSA9IHRyaWdnZXI7XG4gICAgfVxuICAgIGlmKCFJTkNSRU1FTlRBTCkge1xuICAgICAgbGV0IG5leHRSb3VuZCA9IHRoaXMuZXhlY1RyaWdnZXIodHJpZ2dlcik7XG4gICAgICB3aGlsZShuZXh0Um91bmQpIHtcbiAgICAgICAgbmV4dFJvdW5kID0gdGhpcy5leGVjVHJpZ2dlcnMobmV4dFJvdW5kKTtcbiAgICAgIH07XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmKCF0YWJsZXMubGVuZ3RoKSB7IHJldHVybiBleGVjKHRoaXMpOyB9XG4gICAgICBsZXQgaW5pdGlhbCA9IHtbdGFibGVzWzBdXToge2FkZHM6IHRoaXMudGFibGVzW3RhYmxlc1swXV0udGFibGUsIHJlbW92ZXM6IFtdfX07XG4gICAgICBsZXQge3RyaWdnZXJzLCBjaGFuZ2VzfSA9IHRoaXMuZXhlY1RyaWdnZXJJbmNyZW1lbnRhbCh0cmlnZ2VyLCBpbml0aWFsKTtcbiAgICAgIHdoaWxlKHRyaWdnZXJzKSB7XG4gICAgICAgIGxldCByZXN1bHRzID0gdGhpcy5leGVjVHJpZ2dlcnNJbmNyZW1lbnRhbCh0cmlnZ2VycywgY2hhbmdlcyk7XG4gICAgICAgIGlmKCFyZXN1bHRzKSBicmVha1xuICAgICAgICB0cmlnZ2VycyA9IHJlc3VsdHMudHJpZ2dlcnM7XG4gICAgICAgIGNoYW5nZXMgPSByZXN1bHRzLmNoYW5nZXM7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgYXNWaWV3KHF1ZXJ5OlF1ZXJ5fFVuaW9uKSB7XG4gICAgbGV0IG5hbWUgPSBxdWVyeS5uYW1lO1xuICAgIGlmKHRoaXMudGFibGVzW25hbWVdKSB7XG4gICAgICB0aGlzLnJlbW92ZVZpZXcobmFtZSk7XG4gICAgfVxuICAgIGxldCB2aWV3ID0gdGhpcy50YWJsZShuYW1lKTtcbiAgICB0aGlzLmVkYlRhYmxlc1tuYW1lXSA9IGZhbHNlO1xuICAgIHZpZXcudmlldyA9IHF1ZXJ5O1xuICAgIHZpZXcuaXNWaWV3ID0gdHJ1ZTtcbiAgICB0aGlzLnRyaWdnZXIobmFtZSwgcXVlcnkudGFibGVzLCBxdWVyeS5leGVjLmJpbmQocXVlcnkpLCBxdWVyeS5leGVjSW5jcmVtZW50YWwuYmluZChxdWVyeSkpO1xuICB9XG4gIHJlbW92ZVZpZXcoaWQ6c3RyaW5nKSB7XG4gICAgZm9yKGxldCB0YWJsZSBvZiB0aGlzLnRhYmxlcykge1xuICAgICAgZGVsZXRlIHRhYmxlLnRyaWdnZXJzW2lkXTtcbiAgICB9XG4gIH1cbiAgdG90YWxGYWN0cygpIHtcbiAgICBsZXQgdG90YWwgPSAwO1xuICAgIGZvcihsZXQgdGFibGVOYW1lIGluIHRoaXMudGFibGVzKSB7XG4gICAgICB0b3RhbCArPSB0aGlzLnRhYmxlc1t0YWJsZU5hbWVdLnRhYmxlLmxlbmd0aDtcbiAgICB9XG4gICAgcmV0dXJuIHRvdGFsO1xuICB9XG4gIGZhY3RzUGVyVGFibGUoKSB7XG4gICAgbGV0IGluZm8gPSB7fTtcbiAgICBmb3IobGV0IHRhYmxlTmFtZSBpbiB0aGlzLnRhYmxlcykge1xuICAgICAgaW5mb1t0YWJsZU5hbWVdID0gdGhpcy50YWJsZXNbdGFibGVOYW1lXS50YWJsZS5sZW5ndGg7XG4gICAgfVxuICAgIHJldHVybiBpbmZvO1xuICB9XG5cbiAgYXBwbHlEaWZmSW5jcmVtZW50YWwoZGlmZjpEaWZmKSB7XG4gICAgaWYoZGlmZi5sZW5ndGggPT09IDApIHJldHVybjtcbiAgICAvLyBjb25zb2xlLmxvZyhcIkRJRkYgU0laRTogXCIsIGRpZmYubGVuZ3RoLCBkaWZmKTtcblx0XHRsZXQge3RyaWdnZXJzLCByZWFsRGlmZnN9ID0gdGhpcy5leGVjRGlmZihkaWZmKTtcblx0XHRsZXQgcm91bmQgPSAwO1xuICAgIGxldCBjaGFuZ2VzID0gcmVhbERpZmZzO1xuXHRcdHdoaWxlKHRyaWdnZXJzKSB7XG5cdFx0ICAvLyBjb25zb2xlLmdyb3VwKGBST1VORCAke3JvdW5kfWApO1xuICAgICAgLy8gY29uc29sZS5sb2coXCJDSEFOR0VTOiBcIiwgY2hhbmdlcyk7XG5cdFx0ICBsZXQgcmVzdWx0cyA9IHRoaXMuZXhlY1RyaWdnZXJzSW5jcmVtZW50YWwodHJpZ2dlcnMsIGNoYW5nZXMpO1xuICAgICAgLy8gY29uc29sZS5ncm91cEVuZCgpO1xuICAgICAgaWYoIXJlc3VsdHMpIGJyZWFrXG4gICAgICB0cmlnZ2VycyA9IHJlc3VsdHMudHJpZ2dlcnM7XG4gICAgICBjaGFuZ2VzID0gcmVzdWx0cy5jaGFuZ2VzXG5cdFx0ICByb3VuZCsrO1xuXHRcdH1cblx0fVxuXG4gIGV4ZWNUcmlnZ2VySW5jcmVtZW50YWwodHJpZ2dlciwgY2hhbmdlcyk6YW55IHtcbiAgICBsZXQgdGFibGUgPSB0aGlzLnRhYmxlKHRyaWdnZXIubmFtZSk7XG4gICAgbGV0IGFkZHMsIHByb3ZlbmFuY2UsIHJlbW92ZXMsIGluZm87XG4gICAgaWYodHJpZ2dlci5leGVjSW5jcmVtZW50YWwpIHtcbiAgICAgIGluZm8gPSB0cmlnZ2VyLmV4ZWNJbmNyZW1lbnRhbChjaGFuZ2VzLCB0YWJsZSkgfHwge307XG4gICAgICBhZGRzID0gaW5mby5hZGRzO1xuICAgICAgcmVtb3ZlcyA9IGluZm8ucmVtb3ZlcztcbiAgICB9IGVsc2Uge1xuICAgICAgdHJpZ2dlci5leGVjKCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGxldCBkaWZmID0gbmV3IHJ1bnRpbWUuRGlmZih0aGlzKTtcbiAgICBpZihhZGRzLmxlbmd0aCkge1xuICAgICAgZGlmZi5hZGRNYW55KHRyaWdnZXIubmFtZSwgYWRkcyk7XG4gICAgfVxuICAgIGlmKHJlbW92ZXMubGVuZ3RoKSB7XG4gICAgICBkaWZmLnJlbW92ZUZhY3RzKHRyaWdnZXIubmFtZSwgcmVtb3Zlcyk7XG4gICAgfVxuICAgIGxldCB1cGRhdGVkID0gdGhpcy5leGVjRGlmZihkaWZmKTtcbiAgICBsZXQge3JlYWxEaWZmc30gPSB1cGRhdGVkO1xuICAgIGlmKHJlYWxEaWZmc1t0cmlnZ2VyLm5hbWVdICYmIChyZWFsRGlmZnNbdHJpZ2dlci5uYW1lXS5hZGRzLmxlbmd0aCB8fCByZWFsRGlmZnNbdHJpZ2dlci5uYW1lXS5yZW1vdmVzKSkge1xuICAgICAgcmV0dXJuIHtjaGFuZ2VzOiByZWFsRGlmZnNbdHJpZ2dlci5uYW1lXSwgdHJpZ2dlcnM6IHVwZGF0ZWQudHJpZ2dlcnN9O1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4ge307XG4gICAgfVxuICB9XG5cbiAgZXhlY1RyaWdnZXJzSW5jcmVtZW50YWwodHJpZ2dlcnMsIGNoYW5nZXMpIHtcbiAgICBsZXQgbmV3VHJpZ2dlcnMgPSB7fTtcbiAgICBsZXQgbmV4dENoYW5nZXMgPSB7fTtcbiAgICBsZXQgcmV0cmlnZ2VyID0gZmFsc2U7XG4gICAgbGV0IHRyaWdnZXJLZXlzID0gT2JqZWN0LmtleXModHJpZ2dlcnMpO1xuICAgIGZvcihsZXQgdHJpZ2dlck5hbWUgb2YgdHJpZ2dlcktleXMpIHtcbiAgICAgIC8vIGNvbnNvbGUubG9nKFwiQ2FsbGluZzpcIiwgdHJpZ2dlck5hbWUpO1xuICAgICAgbGV0IHRyaWdnZXIgPSB0cmlnZ2Vyc1t0cmlnZ2VyTmFtZV07XG4gICAgICBsZXQgbmV4dFJvdW5kID0gdGhpcy5leGVjVHJpZ2dlckluY3JlbWVudGFsKHRyaWdnZXIsIGNoYW5nZXMpO1xuICAgICAgaWYobmV4dFJvdW5kICYmIG5leHRSb3VuZC5jaGFuZ2VzKSB7XG4gICAgICAgIG5leHRDaGFuZ2VzW3RyaWdnZXJOYW1lXSA9IG5leHRSb3VuZC5jaGFuZ2VzO1xuICAgICAgICBpZihuZXh0Um91bmQudHJpZ2dlcnMpIHtcblxuICAgICAgICAgIGxldCBuZXh0Um91bmRLZXlzID0gT2JqZWN0LmtleXMobmV4dFJvdW5kLnRyaWdnZXJzKTtcbiAgICAgICAgICBmb3IobGV0IHRyaWdnZXIgb2YgbmV4dFJvdW5kS2V5cykge1xuICAgICAgICAgICAgaWYodHJpZ2dlciAmJiBuZXh0Um91bmQudHJpZ2dlcnNbdHJpZ2dlcl0pIHtcbiAgICAgICAgICAgICAgcmV0cmlnZ2VyID0gdHJ1ZTtcbiAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coXCJRdWV1aW5nOlwiLCB0cmlnZ2VyKTtcbiAgICAgICAgICAgICAgbmV3VHJpZ2dlcnNbdHJpZ2dlcl0gPSBuZXh0Um91bmQudHJpZ2dlcnNbdHJpZ2dlcl07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIGlmKHJldHJpZ2dlcikge1xuICAgICAgcmV0dXJuIHtjaGFuZ2VzOiBuZXh0Q2hhbmdlcywgdHJpZ2dlcnM6IG5ld1RyaWdnZXJzfTtcbiAgICB9XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGFkZFByb3ZlbmFuY2VUYWJsZShpeGVyKSB7XG4gIGxldCB0YWJsZSA9IGl4ZXIuYWRkVGFibGUoXCJwcm92ZW5hbmNlXCIsIFtcInRhYmxlXCIsIFtcInJvd1wiLCBcIl9faWRcIl0sIFwicm93IGluc3RhbmNlXCIsIFwic291cmNlXCIsIFtcInNvdXJjZSByb3dcIiwgXCJfX2lkXCJdXSk7XG4gIC8vIGdlbmVyYXRlIHNvbWUgaW5kZXhlcyB0aGF0IHdlIGtub3cgd2UncmUgZ29pbmcgdG8gbmVlZCB1cGZyb250XG4gIGl4ZXIuaW5kZXgoXCJwcm92ZW5hbmNlXCIsIFtcInRhYmxlXCIsIFwicm93XCJdKTtcbiAgaXhlci5pbmRleChcInByb3ZlbmFuY2VcIiwgW1widGFibGVcIiwgXCJyb3cgaW5zdGFuY2VcIl0pO1xuICBpeGVyLmluZGV4KFwicHJvdmVuYW5jZVwiLCBbXCJ0YWJsZVwiLCBcInNvdXJjZVwiLCBcInNvdXJjZSByb3dcIl0pO1xuICBpeGVyLmluZGV4KFwicHJvdmVuYW5jZVwiLCBbXCJ0YWJsZVwiXSk7XG4gIHJldHVybiBpeGVyO1xufVxuXG5mdW5jdGlvbiBtYXBwaW5nVG9EaWZmKGRpZmYsIGFjdGlvbiwgbWFwcGluZywgYWxpYXNlcywgcmV2ZXJzZUxvb2t1cCkge1xuICBmb3IobGV0IGZyb20gaW4gbWFwcGluZykge1xuICAgIGxldCB0byA9IG1hcHBpbmdbZnJvbV07XG4gICAgaWYodG8uY29uc3RydWN0b3IgPT09IEFycmF5KSB7XG4gICAgICBsZXQgc291cmNlID0gdG9bMF07XG4gICAgICBpZih0eXBlb2Ygc291cmNlID09PSBcIm51bWJlclwiKSB7XG4gICAgICAgIHNvdXJjZSA9IGFsaWFzZXNbcmV2ZXJzZUxvb2t1cFtzb3VyY2VdXTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHNvdXJjZSA9IGFsaWFzZXNbc291cmNlXTtcbiAgICAgIH1cbiAgICAgIGRpZmYuYWRkKFwiYWN0aW9uIG1hcHBpbmdcIiwge2FjdGlvbiwgZnJvbSwgXCJ0byBzb3VyY2VcIjogc291cmNlLCBcInRvIGZpZWxkXCI6IHRvWzFdfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGRpZmYuYWRkKFwiYWN0aW9uIG1hcHBpbmcgY29uc3RhbnRcIiwge2FjdGlvbiwgZnJvbSwgdmFsdWU6IHRvfSk7XG4gICAgfVxuICB9XG4gIHJldHVybiBkaWZmO1xufVxuXG5leHBvcnQgdmFyIFF1ZXJ5RnVuY3Rpb25zID0ge31cbnZhciBTVFJJUF9DT01NRU5UUyA9IC8oKFxcL1xcLy4qJCl8KFxcL1xcKltcXHNcXFNdKj9cXCpcXC8pKS9tZztcbnZhciBBUkdVTUVOVF9OQU1FUyA9IC8oW15cXHMsXSspL2c7XG5mdW5jdGlvbiBnZXRQYXJhbU5hbWVzKGZ1bmMpIHtcbiAgdmFyIGZuU3RyID0gZnVuYy50b1N0cmluZygpLnJlcGxhY2UoU1RSSVBfQ09NTUVOVFMsICcnKTtcbiAgdmFyIHJlc3VsdCA9IGZuU3RyLnNsaWNlKGZuU3RyLmluZGV4T2YoJygnKSsxLCBmblN0ci5pbmRleE9mKCcpJykpLm1hdGNoKEFSR1VNRU5UX05BTUVTKTtcbiAgaWYocmVzdWx0ID09PSBudWxsKVxuICAgIHJlc3VsdCA9IFtdO1xuICByZXR1cm4gcmVzdWx0O1xufVxuZXhwb3J0IGZ1bmN0aW9uIGRlZmluZShuYW1lLCBvcHRzLCBmdW5jKSB7XG4gIGxldCBwYXJhbXMgPSBnZXRQYXJhbU5hbWVzKGZ1bmMpO1xuICBvcHRzLm5hbWUgPSBuYW1lO1xuICBvcHRzLnBhcmFtcyA9IHBhcmFtcztcbiAgb3B0cy5mdW5jID0gZnVuYztcbiAgUXVlcnlGdW5jdGlvbnNbbmFtZV0gPSBvcHRzO1xufVxuXG5leHBvcnQgY2xhc3MgUXVlcnkge1xuICB0YWJsZXM7XG4gIGpvaW5zO1xuICBkaXJ0eTtcbiAgY29tcGlsZWQ7XG4gIGl4ZXI7XG4gIGFsaWFzZXM7XG4gIGZ1bmNzO1xuICBuYW1lO1xuICBwcm9qZWN0aW9uTWFwO1xuICBsaW1pdEluZm87XG4gIGdyb3VwcztcbiAgc29ydHM7XG4gIGFnZ3JlZ2F0ZXM7XG4gIHVucHJvamVjdGVkU2l6ZTtcbiAgaGFzT3JkaW5hbDtcbiAgaW5jcmVtZW50YWxSb3dGaW5kZXI7XG5cbiAgc3RhdGljIHJlbW92ZSh2aWV3OiBzdHJpbmcsIGl4ZXI6SW5kZXhlcikge1xuICAgIGxldCBkaWZmID0gaXhlci5kaWZmKCk7XG4gICAgZGlmZi5yZW1vdmUoXCJ2aWV3XCIsIHt2aWV3fSk7XG4gICAgZm9yKGxldCBhY3Rpb25JdGVtIG9mIGl4ZXIuZmluZChcImFjdGlvblwiLCB7dmlld30pKSB7XG4gICAgICBsZXQgYWN0aW9uID0gYWN0aW9uSXRlbS5hY3Rpb247XG4gICAgICBkaWZmLnJlbW92ZShcImFjdGlvblwiLCB7YWN0aW9ufSk7XG4gICAgICBkaWZmLnJlbW92ZShcImFjdGlvbiBzb3VyY2VcIiwge2FjdGlvbn0pO1xuICAgICAgZGlmZi5yZW1vdmUoXCJhY3Rpb24gbWFwcGluZ1wiLCB7YWN0aW9ufSk7XG4gICAgICBkaWZmLnJlbW92ZShcImFjdGlvbiBtYXBwaW5nIGNvbnN0YW50XCIsIHthY3Rpb259KTtcbiAgICAgIGRpZmYucmVtb3ZlKFwiYWN0aW9uIG1hcHBpbmcgc29ydGVkXCIsIHthY3Rpb259KTtcbiAgICAgIGRpZmYucmVtb3ZlKFwiYWN0aW9uIG1hcHBpbmcgbGltaXRcIiwge2FjdGlvbn0pO1xuICAgIH1cbiAgICByZXR1cm4gZGlmZjtcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKGl4ZXIsIG5hbWUgPSBcInVua25vd25cIikge1xuICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgdGhpcy5peGVyID0gaXhlcjtcbiAgICB0aGlzLmRpcnR5ID0gdHJ1ZTtcbiAgICB0aGlzLnRhYmxlcyA9IFtdO1xuICAgIHRoaXMuam9pbnMgPSBbXTtcbiAgICB0aGlzLmFsaWFzZXMgPSB7fTtcbiAgICB0aGlzLmZ1bmNzID0gW107XG4gICAgdGhpcy5hZ2dyZWdhdGVzID0gW107XG4gICAgdGhpcy51bnByb2plY3RlZFNpemUgPSAwO1xuICAgIHRoaXMuaGFzT3JkaW5hbCA9IGZhbHNlO1xuICB9XG4gIGNoYW5nZXNldChpeGVyOkluZGV4ZXIpIHtcbiAgICBsZXQgZGlmZiA9IGl4ZXIuZGlmZigpO1xuICAgIGxldCBhbGlhc2VzID0ge307XG4gICAgbGV0IHJldmVyc2VMb29rdXAgPSB7fTtcbiAgICBmb3IobGV0IGFsaWFzIGluIHRoaXMuYWxpYXNlcykge1xuICAgICAgcmV2ZXJzZUxvb2t1cFt0aGlzLmFsaWFzZXNbYWxpYXNdXSA9IGFsaWFzO1xuICAgIH1cbiAgICBsZXQgdmlldyA9IHRoaXMubmFtZTtcbiAgICBkaWZmLmFkZChcInZpZXdcIiwge3ZpZXcsIGtpbmQ6IFwicXVlcnlcIn0pO1xuICAgIC8vam9pbnNcbiAgICBmb3IobGV0IGpvaW4gb2YgdGhpcy5qb2lucykge1xuICAgICAgbGV0IGFjdGlvbiA9IHV1aWQoKTtcbiAgICAgIGFsaWFzZXNbam9pbi5hc10gPSBhY3Rpb247XG4gICAgICBpZigham9pbi5uZWdhdGVkKSB7XG4gICAgICAgIGRpZmYuYWRkKFwiYWN0aW9uXCIsIHt2aWV3LCBhY3Rpb24sIGtpbmQ6IFwic2VsZWN0XCIsIGl4OiBqb2luLml4fSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBkaWZmLmFkZChcImFjdGlvblwiLCB7dmlldywgYWN0aW9uLCBraW5kOiBcImRlc2VsZWN0XCIsIGl4OiBqb2luLml4fSk7XG4gICAgICB9XG4gICAgICBkaWZmLmFkZChcImFjdGlvbiBzb3VyY2VcIiwge2FjdGlvbiwgXCJzb3VyY2Ugdmlld1wiOiBqb2luLnRhYmxlfSk7XG4gICAgICBtYXBwaW5nVG9EaWZmKGRpZmYsIGFjdGlvbiwgam9pbi5qb2luLCBhbGlhc2VzLCByZXZlcnNlTG9va3VwKTtcbiAgICB9XG4gICAgLy9mdW5jdGlvbnNcbiAgICBmb3IobGV0IGZ1bmMgb2YgdGhpcy5mdW5jcykge1xuICAgICAgbGV0IGFjdGlvbiA9IHV1aWQoKTtcbiAgICAgIGFsaWFzZXNbZnVuYy5hc10gPSBhY3Rpb247XG4gICAgICBkaWZmLmFkZChcImFjdGlvblwiLCB7dmlldywgYWN0aW9uLCBraW5kOiBcImNhbGN1bGF0ZVwiLCBpeDogZnVuYy5peH0pO1xuICAgICAgZGlmZi5hZGQoXCJhY3Rpb24gc291cmNlXCIsIHthY3Rpb24sIFwic291cmNlIHZpZXdcIjogZnVuYy5uYW1lfSk7XG4gICAgICBtYXBwaW5nVG9EaWZmKGRpZmYsIGFjdGlvbiwgZnVuYy5hcmdzLCBhbGlhc2VzLCByZXZlcnNlTG9va3VwKTtcbiAgICB9XG4gICAgLy9hZ2dyZWdhdGVzXG4gICAgZm9yKGxldCBhZ2cgb2YgdGhpcy5hZ2dyZWdhdGVzKSB7XG4gICAgICBsZXQgYWN0aW9uID0gdXVpZCgpO1xuICAgICAgYWxpYXNlc1thZ2cuYXNdID0gYWN0aW9uO1xuICAgICAgZGlmZi5hZGQoXCJhY3Rpb25cIiwge3ZpZXcsIGFjdGlvbiwga2luZDogXCJhZ2dyZWdhdGVcIiwgaXg6IGFnZy5peH0pO1xuICAgICAgZGlmZi5hZGQoXCJhY3Rpb24gc291cmNlXCIsIHthY3Rpb24sIFwic291cmNlIHZpZXdcIjogYWdnLm5hbWV9KTtcbiAgICAgIG1hcHBpbmdUb0RpZmYoZGlmZiwgYWN0aW9uLCBhZ2cuYXJncywgYWxpYXNlcywgcmV2ZXJzZUxvb2t1cCk7XG4gICAgfVxuICAgIC8vc29ydFxuICAgIGlmKHRoaXMuc29ydHMpIHtcbiAgICAgIGxldCBhY3Rpb24gPSB1dWlkKCk7XG4gICAgICBkaWZmLmFkZChcImFjdGlvblwiLCB7dmlldywgYWN0aW9uLCBraW5kOiBcInNvcnRcIiwgaXg6IE1BWF9OVU1CRVJ9KTtcbiAgICAgIGxldCBpeCA9IDA7XG4gICAgICBmb3IobGV0IHNvcnQgb2YgdGhpcy5zb3J0cykge1xuICAgICAgICBsZXQgW3NvdXJjZSwgZmllbGQsIGRpcmVjdGlvbl0gPSBzb3J0O1xuICAgICAgICBpZih0eXBlb2Ygc291cmNlID09PSBcIm51bWJlclwiKSB7XG4gICAgICAgICAgc291cmNlID0gYWxpYXNlc1tyZXZlcnNlTG9va3VwW3NvdXJjZV1dO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHNvdXJjZSA9IGFsaWFzZXNbc291cmNlXTtcbiAgICAgICAgfVxuICAgICAgICBkaWZmLmFkZChcImFjdGlvbiBtYXBwaW5nIHNvcnRlZFwiLCB7YWN0aW9uLCBpeCwgc291cmNlLCBmaWVsZCwgZGlyZWN0aW9ufSk7XG4gICAgICAgIGl4Kys7XG4gICAgICB9XG4gICAgfVxuICAgIC8vZ3JvdXBcbiAgICBpZih0aGlzLmdyb3Vwcykge1xuICAgICAgbGV0IGFjdGlvbiA9IHV1aWQoKTtcbiAgICAgIGRpZmYuYWRkKFwiYWN0aW9uXCIsIHt2aWV3LCBhY3Rpb24sIGtpbmQ6IFwiZ3JvdXBcIiwgaXg6IE1BWF9OVU1CRVJ9KTtcbiAgICAgIGxldCBpeCA9IDA7XG4gICAgICBmb3IobGV0IGdyb3VwIG9mIHRoaXMuZ3JvdXBzKSB7XG4gICAgICAgIGxldCBbc291cmNlLCBmaWVsZF0gPSBncm91cDtcbiAgICAgICAgaWYodHlwZW9mIHNvdXJjZSA9PT0gXCJudW1iZXJcIikge1xuICAgICAgICAgIHNvdXJjZSA9IGFsaWFzZXNbcmV2ZXJzZUxvb2t1cFtzb3VyY2VdXTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBzb3VyY2UgPSBhbGlhc2VzW3NvdXJjZV07XG4gICAgICAgIH1cbiAgICAgICAgZGlmZi5hZGQoXCJhY3Rpb24gbWFwcGluZyBzb3J0ZWRcIiwge2FjdGlvbiwgaXgsIHNvdXJjZSwgZmllbGQsIGRpcmVjdGlvbjogXCJhc2NlbmRpbmdcIn0pO1xuICAgICAgICBpeCsrO1xuICAgICAgfVxuICAgIH1cbiAgICAvL2xpbWl0XG4gICAgaWYodGhpcy5saW1pdEluZm8pIHtcbiAgICAgIGxldCBhY3Rpb24gPSB1dWlkKCk7XG4gICAgICBkaWZmLmFkZChcImFjdGlvblwiLCB7dmlldywgYWN0aW9uLCBraW5kOiBcImxpbWl0XCIsIGl4OiBNQVhfTlVNQkVSfSk7XG4gICAgICBmb3IobGV0IGxpbWl0VHlwZSBpbiB0aGlzLmxpbWl0SW5mbykge1xuICAgICAgICBkaWZmLmFkZChcImFjdGlvbiBtYXBwaW5nIGxpbWl0XCIsIHthY3Rpb24sIFwibGltaXQgdHlwZVwiOiBsaW1pdFR5cGUsIHZhbHVlOiB0aGlzLmxpbWl0SW5mb1tsaW1pdFR5cGVdfSk7XG4gICAgICB9XG4gICAgfVxuICAgIC8vcHJvamVjdGlvblxuICAgIGlmKHRoaXMucHJvamVjdGlvbk1hcCkge1xuICAgICAgbGV0IGFjdGlvbiA9IHV1aWQoKTtcbiAgICAgIGRpZmYuYWRkKFwiYWN0aW9uXCIsIHt2aWV3LCBhY3Rpb24sIGtpbmQ6IFwicHJvamVjdFwiLCBpeDogTUFYX05VTUJFUn0pO1xuICAgICAgbWFwcGluZ1RvRGlmZihkaWZmLCBhY3Rpb24sIHRoaXMucHJvamVjdGlvbk1hcCwgYWxpYXNlcywgcmV2ZXJzZUxvb2t1cCk7XG4gICAgfVxuICAgIHJldHVybiBkaWZmO1xuICB9XG4gIHZhbGlkYXRlRmllbGRzKHRhYmxlTmFtZSwgam9pbk9iamVjdCkge1xuICAgIGxldCB0YWJsZSA9IHRoaXMuaXhlci50YWJsZSh0YWJsZU5hbWUpO1xuICAgIGZvciAobGV0IGZpZWxkIGluIGpvaW5PYmplY3QpIHtcbiAgICAgIGlmICh0YWJsZS5maWVsZHMubGVuZ3RoICYmICF0YWJsZS5rZXlMb29rdXBbZmllbGRdKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgVGFibGUgJyR7dGFibGVOYW1lfScgZG9lc24ndCBoYXZlIGEgZmllbGQgJyR7ZmllbGR9Jy5cXG5cXG5BdmFpbGFibGUgZmllbGRzOiAke3RhYmxlLmZpZWxkcy5qb2luKFwiLCBcIil9YCk7XG4gICAgICB9XG4gICAgICBsZXQgam9pbkluZm8gPSBqb2luT2JqZWN0W2ZpZWxkXTtcbiAgICAgIGlmKGpvaW5JbmZvLmNvbnN0cnVjdG9yID09PSBBcnJheSkge1xuICAgICAgICBsZXQgW2pvaW5OdW1iZXIsIHJlZmVyZW5jZWRGaWVsZF0gPSBqb2luSW5mbztcbiAgICAgICAgaWYgKHR5cGVvZiBqb2luTnVtYmVyICE9PSBcIm51bWJlclwiKSB7XG4gICAgICAgICAgam9pbk51bWJlciA9IHRoaXMuYWxpYXNlc1tqb2luTnVtYmVyXTtcbiAgICAgICAgfVxuICAgICAgICBsZXQgam9pbiA9IHRoaXMuam9pbnNbam9pbk51bWJlcl07XG4gICAgICAgIGlmIChqb2luICYmIGpvaW4uaXggPT09IGpvaW5OdW1iZXIpIHtcbiAgICAgICAgICBsZXQgcmVmZXJlbmNlZFRhYmxlID0gdGhpcy5peGVyLnRhYmxlKGpvaW4udGFibGUpO1xuICAgICAgICAgIGlmICghcmVmZXJlbmNlZFRhYmxlLmZpZWxkcy5sZW5ndGgpIGNvbnRpbnVlO1xuICAgICAgICAgIGlmICghcmVmZXJlbmNlZFRhYmxlLmtleUxvb2t1cFtyZWZlcmVuY2VkRmllbGRdKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFRhYmxlICcke2pvaW4udGFibGV9JyBkb2Vzbid0IGhhdmUgYSBmaWVsZCAnJHtyZWZlcmVuY2VkRmllbGR9Jy5cXG5cXG5BdmFpbGFibGUgZmllbGRzOiAke3JlZmVyZW5jZWRUYWJsZS5maWVsZHMuam9pbihcIiwgXCIpfWApO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuICBzZWxlY3QodGFibGUsIGpvaW4sIGFzPykge1xuICAgIHRoaXMuZGlydHkgPSB0cnVlO1xuICAgIGlmKGFzKSB7XG4gICAgICB0aGlzLmFsaWFzZXNbYXNdID0gT2JqZWN0LmtleXModGhpcy5hbGlhc2VzKS5sZW5ndGg7XG4gICAgfVxuICAgIHRoaXMudW5wcm9qZWN0ZWRTaXplKys7XG4gICAgdGhpcy50YWJsZXMucHVzaCh0YWJsZSk7XG4gICAgdGhpcy52YWxpZGF0ZUZpZWxkcyh0YWJsZSwgam9pbik7XG4gICAgdGhpcy5qb2lucy5wdXNoKHtuZWdhdGVkOiBmYWxzZSwgdGFibGUsIGpvaW4sIGFzLCBpeDogdGhpcy5hbGlhc2VzW2FzXX0pO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG4gIGRlc2VsZWN0KHRhYmxlLCBqb2luKSB7XG4gICAgdGhpcy5kaXJ0eSA9IHRydWU7XG4gICAgdGhpcy50YWJsZXMucHVzaCh0YWJsZSk7XG4gICAgdGhpcy52YWxpZGF0ZUZpZWxkcyh0YWJsZSwgam9pbik7XG4gICAgdGhpcy5qb2lucy5wdXNoKHtuZWdhdGVkOiB0cnVlLCB0YWJsZSwgam9pbiwgaXg6IHRoaXMuam9pbnMubGVuZ3RoICogMTAwMH0pO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG4gIGNhbGN1bGF0ZShmdW5jTmFtZSwgYXJncywgYXM/KSB7XG4gICAgdGhpcy5kaXJ0eSA9IHRydWU7XG4gICAgaWYoYXMpIHtcbiAgICAgIHRoaXMuYWxpYXNlc1thc10gPSBPYmplY3Qua2V5cyh0aGlzLmFsaWFzZXMpLmxlbmd0aDtcbiAgICB9XG4gICAgaWYoIVF1ZXJ5RnVuY3Rpb25zW2Z1bmNOYW1lXS5maWx0ZXIpIHtcbiAgICAgIHRoaXMudW5wcm9qZWN0ZWRTaXplKys7XG4gICAgfVxuICAgIHRoaXMuZnVuY3MucHVzaCh7bmFtZTogZnVuY05hbWUsIGFyZ3MsIGFzLCBpeDogdGhpcy5hbGlhc2VzW2FzXX0pO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG4gIHByb2plY3QocHJvamVjdGlvbk1hcCkge1xuICAgIHRoaXMucHJvamVjdGlvbk1hcCA9IHByb2plY3Rpb25NYXA7XG4gICAgdGhpcy52YWxpZGF0ZUZpZWxkcyh1bmRlZmluZWQsIHByb2plY3Rpb25NYXApO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG4gIGdyb3VwKGdyb3Vwcykge1xuICAgIHRoaXMuZGlydHkgPSB0cnVlO1xuICAgIGlmKGdyb3Vwc1swXSAmJiBncm91cHNbMF0uY29uc3RydWN0b3IgPT09IEFycmF5KSB7XG4gICAgICB0aGlzLmdyb3VwcyA9IGdyb3VwcztcbiAgICB9IGVsc2Uge1xuICAgICAgaWYoIXRoaXMuZ3JvdXBzKSB0aGlzLmdyb3VwcyA9IFtdO1xuICAgICAgdGhpcy5ncm91cHMucHVzaChncm91cHMpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuICBzb3J0KHNvcnRzKSB7XG4gICAgdGhpcy5kaXJ0eSA9IHRydWU7XG4gICAgaWYoc29ydHNbMF0gJiYgc29ydHNbMF0uY29uc3RydWN0b3IgPT09IEFycmF5KSB7XG4gICAgICB0aGlzLnNvcnRzID0gc29ydHM7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmKCF0aGlzLnNvcnRzKSB0aGlzLnNvcnRzID0gW107XG4gICAgICB0aGlzLnNvcnRzLnB1c2goc29ydHMpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuICBsaW1pdChsaW1pdEluZm86YW55KSB7XG4gICAgdGhpcy5kaXJ0eSA9IHRydWU7XG4gICAgaWYoIXRoaXMubGltaXRJbmZvKSB7XG4gICAgICB0aGlzLmxpbWl0SW5mbyA9IHt9O1xuICAgIH1cbiAgICBmb3IobGV0IGtleSBpbiBsaW1pdEluZm8pIHtcbiAgICAgIHRoaXMubGltaXRJbmZvW2tleV0gPSBsaW1pdEluZm9ba2V5XTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cbiAgYWdncmVnYXRlKGZ1bmNOYW1lLCBhcmdzLCBhcz8pIHtcbiAgICB0aGlzLmRpcnR5ID0gdHJ1ZTtcbiAgICBpZihhcykge1xuICAgICAgdGhpcy5hbGlhc2VzW2FzXSA9IE9iamVjdC5rZXlzKHRoaXMuYWxpYXNlcykubGVuZ3RoO1xuICAgIH1cbiAgICB0aGlzLnVucHJvamVjdGVkU2l6ZSsrO1xuICAgIHRoaXMuYWdncmVnYXRlcy5wdXNoKHtuYW1lOiBmdW5jTmFtZSwgYXJncywgYXMsIGl4OiB0aGlzLmFsaWFzZXNbYXNdfSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cbiAgb3JkaW5hbCgpIHtcbiAgICB0aGlzLmRpcnR5ID0gdHJ1ZTtcbiAgICB0aGlzLmhhc09yZGluYWwgPSB0cnVlO1xuICAgIHRoaXMudW5wcm9qZWN0ZWRTaXplKys7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cbiAgYXBwbHlBbGlhc2VzKGpvaW5NYXApIHtcbiAgICBmb3IobGV0IGZpZWxkIGluIGpvaW5NYXApIHtcbiAgICAgIGxldCBqb2luSW5mbyA9IGpvaW5NYXBbZmllbGRdO1xuICAgICAgaWYoam9pbkluZm8uY29uc3RydWN0b3IgIT09IEFycmF5IHx8IHR5cGVvZiBqb2luSW5mb1swXSA9PT0gXCJudW1iZXJcIikgY29udGludWU7XG4gICAgICBsZXQgam9pblRhYmxlID0gam9pbkluZm9bMF07XG4gICAgICBpZihqb2luVGFibGUgPT09IFwib3JkaW5hbFwiKSB7XG4gICAgICAgIGpvaW5JbmZvWzBdID0gdGhpcy51bnByb2plY3RlZFNpemUgLSAxO1xuICAgICAgfSBlbHNlIGlmKHRoaXMuYWxpYXNlc1tqb2luVGFibGVdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgam9pbkluZm9bMF0gPSB0aGlzLmFsaWFzZXNbam9pblRhYmxlXTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkludmFsaWQgYWxpYXMgdXNlZDogXCIgKyBqb2luVGFibGUpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICB0b0FTVCgpIHtcbiAgICBsZXQgY3Vyc29yID0ge3R5cGU6IFwicXVlcnlcIixcbiAgICAgICAgICAgICAgICAgIGNoaWxkcmVuOiBbXX07XG4gICAgbGV0IHJvb3QgPSBjdXJzb3I7XG4gICAgbGV0IHJlc3VsdHMgPSBbXTtcbiAgICAvLyBieSBkZWZhdWx0IHRoZSBvbmx5IHRoaW5nIHdlIHJldHVybiBhcmUgdGhlIHVucHJvamVjdGVkIHJlc3VsdHNcbiAgICBsZXQgcmV0dXJucyA9IFtcInVucHJvamVjdGVkXCIsIFwicHJvdmVuYW5jZVwiXTtcblxuICAgIC8vIHdlIG5lZWQgYW4gYXJyYXkgdG8gc3RvcmUgb3VyIHVucHJvamVjdGVkIHJlc3VsdHNcbiAgICByb290LmNoaWxkcmVuLnB1c2goe3R5cGU6IFwiZGVjbGFyYXRpb25cIiwgdmFyOiBcInVucHJvamVjdGVkXCIsIHZhbHVlOiBcIltdXCJ9KTtcbiAgICByb290LmNoaWxkcmVuLnB1c2goe3R5cGU6IFwiZGVjbGFyYXRpb25cIiwgdmFyOiBcInByb3ZlbmFuY2VcIiwgdmFsdWU6IFwiW11cIn0pO1xuICAgIHJvb3QuY2hpbGRyZW4ucHVzaCh7dHlwZTogXCJkZWNsYXJhdGlvblwiLCB2YXI6IFwicHJvamVjdGVkXCIsIHZhbHVlOiBcInt9XCJ9KTtcblxuICAgIC8vIHJ1biB0aHJvdWdoIGVhY2ggdGFibGUgbmVzdGVkIGluIHRoZSBvcmRlciB0aGV5IHdlcmUgZ2l2ZW4gZG9pbmcgcGFpcndpc2VcbiAgICAvLyBqb2lucyBhbG9uZyB0aGUgd2F5LlxuICAgIGZvcihsZXQgam9pbiBvZiB0aGlzLmpvaW5zKSB7XG4gICAgICBsZXQge3RhYmxlLCBpeCwgbmVnYXRlZH0gPSBqb2luO1xuICAgICAgbGV0IGN1ciA9IHtcbiAgICAgICAgdHlwZTogXCJzZWxlY3RcIixcbiAgICAgICAgdGFibGUsXG4gICAgICAgIHBhc3NlZDogaXggPT09IDAsXG4gICAgICAgIGl4LFxuICAgICAgICBuZWdhdGVkLFxuICAgICAgICBjaGlsZHJlbjogW10sXG4gICAgICAgIGpvaW46IGZhbHNlLFxuICAgICAgfTtcbiAgICAgIC8vIHdlIG9ubHkgd2FudCB0byBlYXQgdGhlIGNvc3Qgb2YgZGVhbGluZyB3aXRoIGluZGV4ZXNcbiAgICAgIC8vIGlmIHdlIGFyZSBhY3R1YWxseSBqb2luaW5nIG9uIHNvbWV0aGluZ1xuICAgICAgbGV0IGpvaW5NYXAgPSBqb2luLmpvaW47XG4gICAgICB0aGlzLmFwcGx5QWxpYXNlcyhqb2luTWFwKTtcbiAgICAgIGlmKGpvaW5NYXAgJiYgT2JqZWN0LmtleXMoam9pbk1hcCkubGVuZ3RoICE9PSAwKSB7XG4gICAgICAgIHJvb3QuY2hpbGRyZW4udW5zaGlmdCh7dHlwZTogXCJkZWNsYXJhdGlvblwiLCB2YXI6IGBxdWVyeSR7aXh9YCwgdmFsdWU6IFwie31cIn0pO1xuICAgICAgICBjdXIuam9pbiA9IGpvaW5NYXA7XG4gICAgICB9XG4gICAgICBjdXJzb3IuY2hpbGRyZW4ucHVzaChjdXIpO1xuICAgICAgaWYoIW5lZ2F0ZWQpIHtcbiAgICAgICAgcmVzdWx0cy5wdXNoKHt0eXBlOiBcInNlbGVjdFwiLCBpeH0pO1xuICAgICAgfVxuXG4gICAgICBjdXJzb3IgPSBjdXI7XG4gICAgfVxuICAgIC8vIGF0IHRoZSBib3R0b20gb2YgdGhlIGpvaW5zLCB3ZSBjYWxjdWxhdGUgYWxsIHRoZSBmdW5jdGlvbnMgYmFzZWQgb24gdGhlIHZhbHVlc1xuICAgIC8vIGNvbGxlY3RlZFxuICAgIGZvcihsZXQgZnVuYyBvZiB0aGlzLmZ1bmNzKSB7XG4gICAgICBsZXQge2FyZ3MsIG5hbWUsIGl4fSA9IGZ1bmM7XG4gICAgICBsZXQgZnVuY0luZm8gPSBRdWVyeUZ1bmN0aW9uc1tuYW1lXTtcbiAgICAgIHRoaXMuYXBwbHlBbGlhc2VzKGFyZ3MpO1xuICAgICAgcm9vdC5jaGlsZHJlbi51bnNoaWZ0KHt0eXBlOiBcImZ1bmN0aW9uRGVjbGFyYXRpb25cIiwgaXgsIGluZm86IGZ1bmNJbmZvfSk7XG4gICAgICBpZihmdW5jSW5mby5tdWx0aSB8fCBmdW5jSW5mby5maWx0ZXIpIHtcbiAgICAgICAgbGV0IG5vZGUgPSB7dHlwZTogXCJmdW5jdGlvbkNhbGxNdWx0aVJldHVyblwiLCBpeCwgYXJncywgaW5mbzogZnVuY0luZm8sIGNoaWxkcmVuOiBbXX07XG4gICAgICAgIGN1cnNvci5jaGlsZHJlbi5wdXNoKG5vZGUpO1xuICAgICAgICBjdXJzb3IgPSBub2RlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY3Vyc29yLmNoaWxkcmVuLnB1c2goe3R5cGU6IFwiZnVuY3Rpb25DYWxsXCIsIGl4LCBhcmdzLCBpbmZvOiBmdW5jSW5mbywgY2hpbGRyZW46IFtdfSk7XG4gICAgICB9XG4gICAgICBpZighZnVuY0luZm8ubm9SZXR1cm4gJiYgIWZ1bmNJbmZvLmZpbHRlcikge1xuICAgICAgICByZXN1bHRzLnB1c2goe3R5cGU6IFwiZnVuY3Rpb25cIiwgaXh9KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBub3cgdGhhdCB3ZSdyZSBhdCB0aGUgYm90dG9tIG9mIHRoZSBqb2luLCBzdG9yZSB0aGUgdW5wcm9qZWN0ZWQgcmVzdWx0XG4gICAgY3Vyc29yLmNoaWxkcmVuLnB1c2goe3R5cGU6IFwicmVzdWx0XCIsIHJlc3VsdHN9KTtcblxuICAgIC8vQWdncmVnYXRpb25cbiAgICAvL3NvcnQgdGhlIHVucHJvamVjdGVkIHJlc3VsdHMgYmFzZWQgb24gZ3JvdXBpbmdzIGFuZCB0aGUgZ2l2ZW4gc29ydHNcbiAgICBsZXQgc29ydHMgPSBbXTtcbiAgICBsZXQgYWxyZWFkeVNvcnRlZCA9IHt9O1xuICAgIGlmKHRoaXMuZ3JvdXBzKSB7XG4gICAgICB0aGlzLmFwcGx5QWxpYXNlcyh0aGlzLmdyb3Vwcyk7XG4gICAgICBmb3IobGV0IGdyb3VwIG9mIHRoaXMuZ3JvdXBzKSB7XG4gICAgICAgIGxldCBbdGFibGUsIGZpZWxkXSA9IGdyb3VwO1xuICAgICAgICBzb3J0cy5wdXNoKGdyb3VwKTtcbiAgICAgICAgYWxyZWFkeVNvcnRlZFtgJHt0YWJsZX18JHtmaWVsZH1gXSA9IHRydWU7XG4gICAgICB9XG4gICAgfVxuICAgIGlmKHRoaXMuc29ydHMpIHtcbiAgICAgIHRoaXMuYXBwbHlBbGlhc2VzKHRoaXMuc29ydHMpO1xuICAgICAgZm9yKGxldCBzb3J0IG9mIHRoaXMuc29ydHMpIHtcbiAgICAgICAgbGV0IFt0YWJsZSwgZmllbGRdID0gc29ydDtcbiAgICAgICAgaWYoIWFscmVhZHlTb3J0ZWRbYCR7dGFibGV9fCR7ZmllbGR9YF0pIHtcbiAgICAgICAgICBzb3J0cy5wdXNoKHNvcnQpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHZhciBzaXplID0gdGhpcy51bnByb2plY3RlZFNpemU7XG4gICAgaWYoc29ydHMubGVuZ3RoKSB7XG4gICAgICByb290LmNoaWxkcmVuLnB1c2goe3R5cGU6IFwic29ydFwiLCBzb3J0cywgc2l6ZSwgY2hpbGRyZW46IFtdfSk7XG4gICAgfVxuICAgIC8vdGhlbiB3ZSBuZWVkIHRvIHJ1biB0aHJvdWdoIHRoZSBzb3J0ZWQgaXRlbXMgYW5kIGRvIHRoZSBhZ2dyZWdhdGUgYXMgYSBmb2xkLlxuICAgIGlmKHRoaXMuYWdncmVnYXRlcy5sZW5ndGggfHwgc29ydHMubGVuZ3RoIHx8IHRoaXMubGltaXRJbmZvIHx8IHRoaXMuaGFzT3JkaW5hbCkge1xuICAgICAgLy8gd2UgbmVlZCB0byBzdG9yZSBncm91cCBpbmZvIGZvciBwb3N0IHByb2Nlc3Npbmcgb2YgdGhlIHVucHJvamVjdGVkIHJlc3VsdHNcbiAgICAgIC8vIHRoaXMgd2lsbCBpbmRpY2F0ZSB3aGF0IGdyb3VwIG51bWJlciwgaWYgYW55LCB0aGF0IGVhY2ggdW5wcm9qZWN0ZWQgcmVzdWx0IGJlbG9uZ3MgdG9cbiAgICAgIHJvb3QuY2hpbGRyZW4udW5zaGlmdCh7dHlwZTogXCJkZWNsYXJhdGlvblwiLCB2YXI6IFwiZ3JvdXBJbmZvXCIsIHZhbHVlOiBcIltdXCJ9KTtcbiAgICAgIHJldHVybnMucHVzaChcImdyb3VwSW5mb1wiKTtcbiAgICAgIGxldCBhZ2dyZWdhdGVDaGlsZHJlbiA9IFtdO1xuICAgICAgZm9yKGxldCBmdW5jIG9mIHRoaXMuYWdncmVnYXRlcykge1xuICAgICAgICBsZXQge2FyZ3MsIG5hbWUsIGl4fSA9IGZ1bmM7XG4gICAgICAgIGxldCBmdW5jSW5mbyA9IFF1ZXJ5RnVuY3Rpb25zW25hbWVdO1xuICAgICAgICB0aGlzLmFwcGx5QWxpYXNlcyhhcmdzKTtcbiAgICAgICAgcm9vdC5jaGlsZHJlbi51bnNoaWZ0KHt0eXBlOiBcImZ1bmN0aW9uRGVjbGFyYXRpb25cIiwgaXgsIGluZm86IGZ1bmNJbmZvfSk7XG4gICAgICAgIGFnZ3JlZ2F0ZUNoaWxkcmVuLnB1c2goe3R5cGU6IFwiZnVuY3Rpb25DYWxsXCIsIGl4LCByZXN1bHRzSXg6IHJlc3VsdHMubGVuZ3RoLCBhcmdzLCBpbmZvOiBmdW5jSW5mbywgdW5wcm9qZWN0ZWQ6IHRydWUsIGNoaWxkcmVuOiBbXX0pO1xuICAgICAgICByZXN1bHRzLnB1c2goe3R5cGU6IFwicGxhY2Vob2xkZXJcIn0pO1xuICAgICAgfVxuICAgICAgaWYodGhpcy5oYXNPcmRpbmFsID09PSB0cnVlKSB7XG4gICAgICAgIGFnZ3JlZ2F0ZUNoaWxkcmVuLnB1c2goe3R5cGU6IFwib3JkaW5hbFwifSk7XG4gICAgICAgIHJlc3VsdHMucHVzaCh7dHlwZTogXCJwbGFjZWhvbGRlclwifSk7XG4gICAgICB9XG4gICAgICBsZXQgYWdncmVnYXRlID0ge3R5cGU6IFwiYWdncmVnYXRlIGxvb3BcIiwgZ3JvdXBzOiB0aGlzLmdyb3VwcywgbGltaXQ6IHRoaXMubGltaXRJbmZvLCBzaXplLCBjaGlsZHJlbjogYWdncmVnYXRlQ2hpbGRyZW59O1xuICAgICAgcm9vdC5jaGlsZHJlbi5wdXNoKGFnZ3JlZ2F0ZSk7XG4gICAgICBjdXJzb3IgPSBhZ2dyZWdhdGU7XG4gICAgfVxuXG5cbiAgICBpZih0aGlzLnByb2plY3Rpb25NYXApIHtcbiAgICAgIHRoaXMuYXBwbHlBbGlhc2VzKHRoaXMucHJvamVjdGlvbk1hcCk7XG4gICAgICByb290LmNoaWxkcmVuLnVuc2hpZnQoe3R5cGU6IFwiZGVjbGFyYXRpb25cIiwgdmFyOiBcInJlc3VsdHNcIiwgdmFsdWU6IFwiW11cIn0pO1xuICAgICAgaWYoSU5DUkVNRU5UQUwpIHtcbiAgICAgICAgY3Vyc29yLmNoaWxkcmVuLnB1c2goe3R5cGU6IFwicHJvdmVuYW5jZVwifSk7XG4gICAgICB9XG4gICAgICBjdXJzb3IuY2hpbGRyZW4ucHVzaCh7dHlwZTogXCJwcm9qZWN0aW9uXCIsIHByb2plY3Rpb25NYXA6IHRoaXMucHJvamVjdGlvbk1hcCwgdW5wcm9qZWN0ZWQ6IHRoaXMuYWdncmVnYXRlcy5sZW5ndGh9KTtcbiAgICAgIHJldHVybnMucHVzaChcInJlc3VsdHNcIik7XG4gICAgfVxuXG4gICAgcm9vdC5jaGlsZHJlbi5wdXNoKHt0eXBlOiBcInJldHVyblwiLCB2YXJzOiByZXR1cm5zfSk7XG4gICAgcmV0dXJuIHJvb3Q7XG4gIH1cbiAgY29tcGlsZVBhcmFtU3RyaW5nKGZ1bmNJbmZvLCBhcmdzLCB1bnByb2plY3RlZCA9IGZhbHNlKSB7XG4gICAgbGV0IGNvZGUgPSBcIlwiO1xuICAgIGxldCBwYXJhbXMgPSBmdW5jSW5mby5wYXJhbXM7XG4gICAgaWYodW5wcm9qZWN0ZWQpIHBhcmFtcyA9IHBhcmFtcy5zbGljZSgxKTtcbiAgICBmb3IobGV0IHBhcmFtIG9mIHBhcmFtcykge1xuICAgICAgbGV0IGFyZyA9IGFyZ3NbcGFyYW1dO1xuICAgICAgbGV0IGFyZ0NvZGU7XG4gICAgICBpZihhcmcuY29uc3RydWN0b3IgPT09IEFycmF5KSB7XG4gICAgICAgIGxldCBwcm9wZXJ0eSA9IFwiXCI7XG4gICAgICAgIGlmKGFyZ1sxXSkge1xuICAgICAgICAgIHByb3BlcnR5ID0gYFsnJHthcmdbMV19J11gO1xuICAgICAgICB9XG4gICAgICAgIGlmKCF1bnByb2plY3RlZCkge1xuICAgICAgICAgIGFyZ0NvZGUgPSBgcm93JHthcmdbMF19JHtwcm9wZXJ0eX1gO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGFyZ0NvZGUgPSBgdW5wcm9qZWN0ZWRbaXggKyAke2FyZ1swXX1dJHtwcm9wZXJ0eX1gO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBhcmdDb2RlID0gSlNPTi5zdHJpbmdpZnkoYXJnKTtcbiAgICAgIH1cbiAgICAgIGNvZGUgKz0gYCR7YXJnQ29kZX0sIGA7XG4gICAgfVxuICAgIHJldHVybiBjb2RlLnN1YnN0cmluZygwLGNvZGUubGVuZ3RoIC0gMik7XG4gIH1cbiAgY29tcGlsZUFTVChyb290KSB7XG4gICAgbGV0IGNvZGUgPSBcIlwiO1xuICAgIGxldCB0eXBlID0gcm9vdC50eXBlO1xuICAgIHN3aXRjaCh0eXBlKSB7XG4gICAgICBjYXNlIFwicXVlcnlcIjpcbiAgICAgICAgZm9yKHZhciBjaGlsZCBvZiByb290LmNoaWxkcmVuKSB7XG4gICAgICAgICAgY29kZSArPSB0aGlzLmNvbXBpbGVBU1QoY2hpbGQpO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcImRlY2xhcmF0aW9uXCI6XG4gICAgICAgIGNvZGUgKz0gYHZhciAke3Jvb3QudmFyfSA9ICR7cm9vdC52YWx1ZX07XFxuYDtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwiZnVuY3Rpb25EZWNsYXJhdGlvblwiOlxuICAgICAgICBjb2RlICs9IGB2YXIgZnVuYyR7cm9vdC5peH0gPSBRdWVyeUZ1bmN0aW9uc1snJHtyb290LmluZm8ubmFtZX0nXS5mdW5jO1xcbmA7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcImZ1bmN0aW9uQ2FsbFwiOlxuICAgICAgICB2YXIgaXggPSByb290Lml4O1xuICAgICAgICB2YXIgcHJldiA9IFwiXCI7XG4gICAgICAgIGlmKHJvb3QudW5wcm9qZWN0ZWQpIHtcbiAgICAgICAgICBwcmV2ID0gYHJvdyR7aXh9YDtcbiAgICAgICAgICBpZihyb290LmluZm8ucGFyYW1zLmxlbmd0aCA+IDEpIHByZXYgKz0gXCIsXCJcbiAgICAgICAgfVxuICAgICAgICBjb2RlICs9IGB2YXIgcm93JHtpeH0gPSBmdW5jJHtpeH0oJHtwcmV2fSR7dGhpcy5jb21waWxlUGFyYW1TdHJpbmcocm9vdC5pbmZvLCByb290LmFyZ3MsIHJvb3QudW5wcm9qZWN0ZWQpfSk7XFxuYDtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwiZnVuY3Rpb25DYWxsTXVsdGlSZXR1cm5cIjpcbiAgICAgICAgdmFyIGl4ID0gcm9vdC5peDtcbiAgICAgICAgY29kZSArPSBgdmFyIHJvd3Mke2l4fSA9IGZ1bmMke2l4fSgke3RoaXMuY29tcGlsZVBhcmFtU3RyaW5nKHJvb3QuaW5mbywgcm9vdC5hcmdzKX0pO1xcbmA7XG4gICAgICAgIGNvZGUgKz0gYGZvcih2YXIgZnVuY1Jlc3VsdEl4JHtpeH0gPSAwLCBmdW5jTGVuJHtpeH0gPSByb3dzJHtpeH0ubGVuZ3RoOyBmdW5jUmVzdWx0SXgke2l4fSA8IGZ1bmNMZW4ke2l4fTsgZnVuY1Jlc3VsdEl4JHtpeH0rKykge1xcbmBcbiAgICAgICAgY29kZSArPSBgdmFyIHJvdyR7aXh9ID0gcm93cyR7aXh9W2Z1bmNSZXN1bHRJeCR7aXh9XTtcXG5gO1xuICAgICAgICBmb3IodmFyIGNoaWxkIG9mIHJvb3QuY2hpbGRyZW4pIHtcbiAgICAgICAgICBjb2RlICs9IHRoaXMuY29tcGlsZUFTVChjaGlsZCk7XG4gICAgICAgIH1cbiAgICAgICAgY29kZSArPSBcIn1cXG5cIjtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwic2VsZWN0XCI6XG4gICAgICAgIHZhciBpeCA9IHJvb3QuaXg7XG4gICAgICAgIGlmKHJvb3QucGFzc2VkKSB7XG4gICAgICAgICAgY29kZSArPSBgdmFyIHJvd3Mke2l4fSA9IHJvb3RSb3dzO1xcbmA7XG4gICAgICAgIH0gZWxzZSBpZihyb290LmpvaW4pIHtcbiAgICAgICAgICBmb3IobGV0IGtleSBpbiByb290LmpvaW4pIHtcbiAgICAgICAgICAgIGxldCBtYXBwaW5nID0gcm9vdC5qb2luW2tleV07XG4gICAgICAgICAgICBpZihtYXBwaW5nLmNvbnN0cnVjdG9yID09PSBBcnJheSkge1xuICAgICAgICAgICAgICBsZXQgW3RhYmxlSXgsIHZhbHVlXSA9IG1hcHBpbmc7XG4gICAgICAgICAgICAgIGNvZGUgKz0gYHF1ZXJ5JHtpeH1bJyR7a2V5fSddID0gcm93JHt0YWJsZUl4fVsnJHt2YWx1ZX0nXTtcXG5gO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgY29kZSArPSBgcXVlcnkke2l4fVsnJHtrZXl9J10gPSAke0pTT04uc3RyaW5naWZ5KG1hcHBpbmcpfTtcXG5gO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBjb2RlICs9IGB2YXIgcm93cyR7aXh9ID0gaXhlci5mYWN0VG9JbmRleChpeGVyLnRhYmxlKCcke3Jvb3QudGFibGV9JyksIHF1ZXJ5JHtpeH0pO1xcbmA7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29kZSArPSBgdmFyIHJvd3Mke2l4fSA9IGl4ZXIudGFibGUoJyR7cm9vdC50YWJsZX0nKS50YWJsZTtcXG5gO1xuICAgICAgICB9XG4gICAgICAgIGlmKCFyb290Lm5lZ2F0ZWQpIHtcbiAgICAgICAgICBjb2RlICs9IGBmb3IodmFyIHJvd0l4JHtpeH0gPSAwLCByb3dzTGVuJHtpeH0gPSByb3dzJHtpeH0ubGVuZ3RoOyByb3dJeCR7aXh9IDwgcm93c0xlbiR7aXh9OyByb3dJeCR7aXh9KyspIHtcXG5gXG4gICAgICAgICAgY29kZSArPSBgdmFyIHJvdyR7aXh9ID0gcm93cyR7aXh9W3Jvd0l4JHtpeH1dO1xcbmA7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29kZSArPSBgaWYoIXJvd3Mke2l4fS5sZW5ndGgpIHtcXG5gXG4gICAgICAgIH1cbiAgICAgICAgZm9yKHZhciBjaGlsZCBvZiByb290LmNoaWxkcmVuKSB7XG4gICAgICAgICAgY29kZSArPSB0aGlzLmNvbXBpbGVBU1QoY2hpbGQpO1xuICAgICAgICB9XG4gICAgICAgIGNvZGUgKz0gXCJ9XFxuXCI7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcInJlc3VsdFwiOlxuICAgICAgICB2YXIgcmVzdWx0cyA9IFtdO1xuICAgICAgICBmb3IodmFyIHJlc3VsdCBvZiByb290LnJlc3VsdHMpIHtcbiAgICAgICAgICBpZihyZXN1bHQudHlwZSA9PT0gXCJwbGFjZWhvbGRlclwiKSB7XG4gICAgICAgICAgICByZXN1bHRzLnB1c2goXCJ1bmRlZmluZWRcIik7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGxldCBpeCA9IHJlc3VsdC5peDtcbiAgICAgICAgICAgIHJlc3VsdHMucHVzaChgcm93JHtpeH1gKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY29kZSArPSBgdW5wcm9qZWN0ZWQucHVzaCgke3Jlc3VsdHMuam9pbihcIiwgXCIpfSk7XFxuYDtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwic29ydFwiOlxuICAgICAgICBjb2RlICs9IGdlbmVyYXRlVW5wcm9qZWN0ZWRTb3J0ZXJDb2RlKHJvb3Quc2l6ZSwgcm9vdC5zb3J0cykrXCJcXG5cIjtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwiYWdncmVnYXRlIGxvb3BcIjpcbiAgICAgICAgdmFyIHByb2plY3Rpb24gPSBcIlwiO1xuICAgICAgICB2YXIgYWdncmVnYXRlQ2FsbHMgPSBbXTtcbiAgICAgICAgdmFyIGFnZ3JlZ2F0ZVN0YXRlcyA9IFtdO1xuICAgICAgICB2YXIgYWdncmVnYXRlUmVzZXRzID0gW107XG4gICAgICAgIHZhciB1bnByb2plY3RlZCA9IHt9O1xuICAgICAgICB2YXIgb3JkaW5hbDpzdHJpbmd8Ym9vbGVhbiA9IGZhbHNlO1xuICAgICAgICB2YXIgcHJvdmVuYW5jZUNvZGU7XG4gICAgICAgIGZvcihsZXQgYWdnIG9mIHJvb3QuY2hpbGRyZW4pIHtcbiAgICAgICAgICBpZihhZ2cudHlwZSA9PT0gXCJmdW5jdGlvbkNhbGxcIikge1xuICAgICAgICAgICAgdW5wcm9qZWN0ZWRbYWdnLml4XSA9IHRydWU7XG4gICAgICAgICAgICBsZXQgY29tcGlsZWQgPSB0aGlzLmNvbXBpbGVBU1QoYWdnKTtcbiAgICAgICAgICAgIGNvbXBpbGVkICs9IGBcXG51bnByb2plY3RlZFtpeCArICR7YWdnLnJlc3VsdHNJeH1dID0gcm93JHthZ2cuaXh9O1xcbmA7XG4gICAgICAgICAgICBhZ2dyZWdhdGVDYWxscy5wdXNoKGNvbXBpbGVkKTtcbiAgICAgICAgICAgIGFnZ3JlZ2F0ZVN0YXRlcy5wdXNoKGB2YXIgcm93JHthZ2cuaXh9ID0ge307YCk7XG4gICAgICAgICAgICBhZ2dyZWdhdGVSZXNldHMucHVzaChgcm93JHthZ2cuaXh9ID0ge307YCk7XG4gICAgICAgICAgfSBlbHNlIGlmKGFnZy50eXBlID09PSBcInByb2plY3Rpb25cIikge1xuICAgICAgICAgICAgYWdnLnVucHJvamVjdGVkID0gdW5wcm9qZWN0ZWQ7XG4gICAgICAgICAgICBwcm9qZWN0aW9uID0gdGhpcy5jb21waWxlQVNUKGFnZyk7XG4gICAgICAgICAgfSBlbHNlIGlmKGFnZy50eXBlID09PSBcIm9yZGluYWxcIikge1xuICAgICAgICAgICAgb3JkaW5hbCA9IGB1bnByb2plY3RlZFtpeCske3RoaXMudW5wcm9qZWN0ZWRTaXplIC0gMX1dID0gcmVzdWx0Q291bnQ7XFxuYDtcbiAgICAgICAgICB9IGVsc2UgaWYoYWdnLnR5cGUgPT09IFwicHJvdmVuYW5jZVwiKSB7XG4gICAgICAgICAgICBwcm92ZW5hbmNlQ29kZSA9IHRoaXMuY29tcGlsZUFTVChhZ2cpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB2YXIgYWdncmVnYXRlQ2FsbHNDb2RlID0gYWdncmVnYXRlQ2FsbHMuam9pbihcIlwiKTtcblxuICAgICAgICB2YXIgZGlmZmVyZW50R3JvdXBDaGVja3MgPSBbXTtcbiAgICAgICAgdmFyIGdyb3VwQ2hlY2sgPSBgZmFsc2VgO1xuICAgICAgICBpZihyb290Lmdyb3Vwcykge1xuICAgICAgICAgIGZvcihsZXQgZ3JvdXAgb2Ygcm9vdC5ncm91cHMpIHtcbiAgICAgICAgICAgIGxldCBbdGFibGUsIGZpZWxkXSA9IGdyb3VwO1xuICAgICAgICAgICAgZGlmZmVyZW50R3JvdXBDaGVja3MucHVzaChgdW5wcm9qZWN0ZWRbbmV4dEl4ICsgJHt0YWJsZX1dWycke2ZpZWxkfSddICE9PSB1bnByb2plY3RlZFtpeCArICR7dGFibGV9XVsnJHtmaWVsZH0nXWApO1xuICAgICAgICAgIH1cbiAgICAgICAgICBncm91cENoZWNrID0gYCgke2RpZmZlcmVudEdyb3VwQ2hlY2tzLmpvaW4oXCIgfHwgXCIpfSlgO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIHJlc3VsdHNDaGVjayA9IFwiXCI7XG4gICAgICAgIGlmKHJvb3QubGltaXQgJiYgcm9vdC5saW1pdC5yZXN1bHRzKSB7XG4gICAgICAgICAgbGV0IGxpbWl0VmFsdWUgPSByb290LmxpbWl0LnJlc3VsdHM7XG4gICAgICAgICAgbGV0IG9mZnNldCA9IHJvb3QubGltaXQub2Zmc2V0O1xuICAgICAgICAgIGlmKG9mZnNldCkge1xuICAgICAgICAgICAgbGltaXRWYWx1ZSArPSBvZmZzZXQ7XG4gICAgICAgICAgICBwcm9qZWN0aW9uID0gYGlmKHJlc3VsdENvdW50ID49ICR7b2Zmc2V0fSkge1xuICAgICAgICAgICAgICAke3Byb2plY3Rpb259XG4gICAgICAgICAgICB9YDtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmVzdWx0c0NoZWNrID0gYGlmKHJlc3VsdENvdW50ID09PSAke2xpbWl0VmFsdWV9KSBicmVhaztgO1xuICAgICAgICB9XG4gICAgICAgIHZhciBncm91cExpbWl0Q2hlY2sgPSBcIlwiO1xuICAgICAgICBpZihyb290LmxpbWl0ICYmIHJvb3QubGltaXQucGVyR3JvdXAgJiYgcm9vdC5ncm91cHMpIHtcbiAgICAgICAgICBsZXQgbGltaXRWYWx1ZSA9IHJvb3QubGltaXQucGVyR3JvdXA7XG4gICAgICAgICAgbGV0IG9mZnNldCA9IHJvb3QubGltaXQub2Zmc2V0O1xuICAgICAgICAgIGlmKG9mZnNldCkge1xuICAgICAgICAgICAgbGltaXRWYWx1ZSArPSBvZmZzZXQ7XG4gICAgICAgICAgICBhZ2dyZWdhdGVDYWxsc0NvZGUgPSBgaWYocGVyR3JvdXBDb3VudCA+PSAke29mZnNldH0pIHtcbiAgICAgICAgICAgICAgJHthZ2dyZWdhdGVDYWxsc0NvZGV9XG4gICAgICAgICAgICB9YDtcbiAgICAgICAgICB9XG4gICAgICAgICAgZ3JvdXBMaW1pdENoZWNrID0gYGlmKHBlckdyb3VwQ291bnQgPT09ICR7bGltaXRWYWx1ZX0pIHtcbiAgICAgICAgICAgIHdoaWxlKCFkaWZmZXJlbnRHcm91cCkge1xuICAgICAgICAgICAgICBuZXh0SXggKz0gJHtyb290LnNpemV9O1xuICAgICAgICAgICAgICBpZihuZXh0SXggPj0gbGVuKSBicmVhaztcbiAgICAgICAgICAgICAgZ3JvdXBJbmZvW25leHRJeF0gPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgIGRpZmZlcmVudEdyb3VwID0gJHtncm91cENoZWNrfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9YDtcbiAgICAgICAgfVxuICAgICAgICB2YXIgZ3JvdXBEaWZmZXJlbmNlID0gXCJcIjtcbiAgICAgICAgdmFyIGdyb3VwSW5mbyA9IFwiXCI7XG4gICAgICAgIGlmKHRoaXMuZ3JvdXBzKSB7XG4gICAgICAgICAgZ3JvdXBJbmZvID0gXCJncm91cEluZm9baXhdID0gcmVzdWx0Q291bnQ7XCI7XG4gICAgICAgICAgbGV0IGdyb3VwUHJvamVjdGlvbiA9IGAke3Byb2plY3Rpb259cmVzdWx0Q291bnQrKztgXG4gICAgICAgICAgaWYocm9vdC5saW1pdCAmJiByb290LmxpbWl0Lm9mZnNldCkge1xuICAgICAgICAgICAgZ3JvdXBQcm9qZWN0aW9uID0gYGlmKHBlckdyb3VwQ291bnQgPiAke3Jvb3QubGltaXQub2Zmc2V0fSkge1xuICAgICAgICAgICAgICAke2dyb3VwUHJvamVjdGlvbn1cbiAgICAgICAgICAgIH1gO1xuICAgICAgICAgICAgZ3JvdXBJbmZvID0gYGlmKHBlckdyb3VwQ291bnQgPj0gJHtyb290LmxpbWl0Lm9mZnNldH0pIHtcbiAgICAgICAgICAgICAgJHtncm91cEluZm99XG4gICAgICAgICAgICB9YDtcbiAgICAgICAgICB9XG4gICAgICAgICAgZ3JvdXBEaWZmZXJlbmNlID0gYFxuICAgICAgICAgIHBlckdyb3VwQ291bnQrK1xuICAgICAgICAgIHZhciBkaWZmZXJlbnRHcm91cCA9ICR7Z3JvdXBDaGVja307XG4gICAgICAgICAgJHtncm91cExpbWl0Q2hlY2t9XG4gICAgICAgICAgaWYoZGlmZmVyZW50R3JvdXApIHtcbiAgICAgICAgICAgICR7Z3JvdXBQcm9qZWN0aW9ufVxuICAgICAgICAgICAgJHthZ2dyZWdhdGVSZXNldHMuam9pbihcIlxcblwiKX1cbiAgICAgICAgICAgIHBlckdyb3VwQ291bnQgPSAwO1xuICAgICAgICAgIH1cXG5gO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGdyb3VwRGlmZmVyZW5jZSA9IFwicmVzdWx0Q291bnQrKztcXG5cIjtcbiAgICAgICAgICBncm91cEluZm8gPSBcImdyb3VwSW5mb1tpeF0gPSAwO1wiXG4gICAgICAgIH1cbiAgICAgICAgLy8gaWYgdGhlcmUgYXJlIG5laXRoZXIgYWdncmVnYXRlcyB0byBjYWxjdWxhdGUgbm9yIGdyb3VwcyB0byBidWlsZCxcbiAgICAgICAgLy8gdGhlbiB3ZSBqdXN0IG5lZWQgdG8gd29ycnkgYWJvdXQgbGltaXRpbmdcbiAgICAgICAgaWYoIXRoaXMuZ3JvdXBzICYmIGFnZ3JlZ2F0ZUNhbGxzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgIGNvZGUgPSBgdmFyIGl4ID0gMDtcbiAgICAgICAgICAgICAgICAgIHZhciByZXN1bHRDb3VudCA9IDA7XG4gICAgICAgICAgICAgICAgICB2YXIgbGVuID0gdW5wcm9qZWN0ZWQubGVuZ3RoO1xuICAgICAgICAgICAgICAgICAgd2hpbGUoaXggPCBsZW4pIHtcbiAgICAgICAgICAgICAgICAgICAgJHtyZXN1bHRzQ2hlY2t9XG4gICAgICAgICAgICAgICAgICAgICR7b3JkaW5hbCB8fCBcIlwifVxuICAgICAgICAgICAgICAgICAgICAke3Byb3ZlbmFuY2VDb2RlfVxuICAgICAgICAgICAgICAgICAgICAke3Byb2plY3Rpb259XG4gICAgICAgICAgICAgICAgICAgIGdyb3VwSW5mb1tpeF0gPSByZXN1bHRDb3VudDtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0Q291bnQrKztcbiAgICAgICAgICAgICAgICAgICAgaXggKz0gJHtyb290LnNpemV9O1xuICAgICAgICAgICAgICAgICAgfVxcbmA7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgY29kZSA9IGB2YXIgcmVzdWx0Q291bnQgPSAwO1xuICAgICAgICAgICAgICAgIHZhciBwZXJHcm91cENvdW50ID0gMDtcbiAgICAgICAgICAgICAgICB2YXIgaXggPSAwO1xuICAgICAgICAgICAgICAgIHZhciBuZXh0SXggPSAwO1xuICAgICAgICAgICAgICAgIHZhciBsZW4gPSB1bnByb2plY3RlZC5sZW5ndGg7XG4gICAgICAgICAgICAgICAgJHthZ2dyZWdhdGVTdGF0ZXMuam9pbihcIlxcblwiKX1cbiAgICAgICAgICAgICAgICB3aGlsZShpeCA8IGxlbikge1xuICAgICAgICAgICAgICAgICAgJHthZ2dyZWdhdGVDYWxsc0NvZGV9XG4gICAgICAgICAgICAgICAgICAke2dyb3VwSW5mb31cbiAgICAgICAgICAgICAgICAgICR7b3JkaW5hbCB8fCBcIlwifVxuICAgICAgICAgICAgICAgICAgJHtwcm92ZW5hbmNlQ29kZX1cbiAgICAgICAgICAgICAgICAgIGlmKGl4ICsgJHtyb290LnNpemV9ID09PSBsZW4pIHtcbiAgICAgICAgICAgICAgICAgICAgJHtwcm9qZWN0aW9ufVxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIG5leHRJeCArPSAke3Jvb3Quc2l6ZX07XG4gICAgICAgICAgICAgICAgICAke2dyb3VwRGlmZmVyZW5jZX1cbiAgICAgICAgICAgICAgICAgICR7cmVzdWx0c0NoZWNrfVxuICAgICAgICAgICAgICAgICAgaXggPSBuZXh0SXg7XG4gICAgICAgICAgICAgICAgfVxcbmA7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcInByb2plY3Rpb25cIjpcbiAgICAgICAgdmFyIHByb2plY3RlZFZhcnMgPSBbXTtcbiAgICAgICAgdmFyIGlkU3RyaW5nUGFydHMgPSBbXTtcbiAgICAgICAgZm9yKGxldCBuZXdGaWVsZCBpbiByb290LnByb2plY3Rpb25NYXApIHtcbiAgICAgICAgICBsZXQgbWFwcGluZyA9IHJvb3QucHJvamVjdGlvbk1hcFtuZXdGaWVsZF07XG4gICAgICAgICAgbGV0IHZhbHVlID0gXCJcIjtcbiAgICAgICAgICBpZihtYXBwaW5nLmNvbnN0cnVjdG9yID09PSBBcnJheSkge1xuICAgICAgICAgICAgaWYobWFwcGluZ1sxXSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgIHZhbHVlID0gYHVucHJvamVjdGVkW2l4ICsgJHttYXBwaW5nWzBdfV1gO1xuICAgICAgICAgICAgfSBlbHNlIGlmKCFyb290LnVucHJvamVjdGVkIHx8IHJvb3QudW5wcm9qZWN0ZWRbbWFwcGluZ1swXV0pIHtcbiAgICAgICAgICAgICAgdmFsdWUgPSBgcm93JHttYXBwaW5nWzBdfVsnJHttYXBwaW5nWzFdfSddYDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHZhbHVlID0gYHVucHJvamVjdGVkW2l4ICsgJHttYXBwaW5nWzBdfV1bJyR7bWFwcGluZ1sxXX0nXWA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHZhbHVlID0gSlNPTi5zdHJpbmdpZnkobWFwcGluZyk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHByb2plY3RlZFZhcnMucHVzaChgcHJvamVjdGVkWycke25ld0ZpZWxkLnJlcGxhY2UoLycvZywgXCJcXFxcJ1wiKX0nXSA9ICR7dmFsdWV9YCk7XG4gICAgICAgICAgaWRTdHJpbmdQYXJ0cy5wdXNoKHZhbHVlKTtcbiAgICAgICAgfVxuICAgICAgICBjb2RlICs9IHByb2plY3RlZFZhcnMuam9pbihcIjtcXG5cIikgKyBcIlxcblwiO1xuICAgICAgICBjb2RlICs9IGBwcm9qZWN0ZWQuX19pZCA9ICR7aWRTdHJpbmdQYXJ0cy5qb2luKGAgKyBcInxcIiArIGApfTtcXG5gO1xuICAgICAgICBjb2RlICs9IGByZXN1bHRzLnB1c2gocHJvamVjdGVkKTtcXG5gO1xuICAgICAgICBjb2RlICs9IGBwcm9qZWN0ZWQgPSB7fTtcXG5gO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJwcm92ZW5hbmNlXCI6XG4gICAgICAgIHZhciBwcm92ZW5hbmNlID0gXCJ2YXIgcHJvdmVuYW5jZV9faWQgPSAnJztcXG5cIjtcbiAgICAgICAgdmFyIGlkcyA9IFtdO1xuICAgICAgICBmb3IobGV0IGpvaW4gb2YgdGhpcy5qb2lucykge1xuICAgICAgICAgIGlmKGpvaW4ubmVnYXRlZCkgY29udGludWU7XG4gICAgICAgICAgcHJvdmVuYW5jZSArPSBgcHJvdmVuYW5jZV9faWQgPSB0YWJsZUlkICsgJ3wnICsgcHJvamVjdGVkLl9faWQgKyAnfCcgKyByb3dJbnN0YW5jZSArICd8JHtqb2luLnRhYmxlfXwnICsgcm93JHtqb2luLml4fS5fX2lkOyBcXG5gO1xuICAgICAgICAgIHByb3ZlbmFuY2UgKz0gYHByb3ZlbmFuY2UucHVzaCh7dGFibGU6IHRhYmxlSWQsIHJvdzogcHJvamVjdGVkLCBcInJvdyBpbnN0YW5jZVwiOiByb3dJbnN0YW5jZSwgc291cmNlOiBcIiR7am9pbi50YWJsZX1cIiwgXCJzb3VyY2Ugcm93XCI6IHJvdyR7am9pbi5peH19KTtcXG5gO1xuICAgICAgICAgIGlkcy5wdXNoKGByb3cke2pvaW4uaXh9Ll9faWRgKTtcbiAgICAgICAgfVxuICAgICAgICBjb2RlID0gYHZhciByb3dJbnN0YW5jZSA9ICR7aWRzLmpvaW4oXCIgKyAnfCcgKyBcIil9O1xuICAgICAgICAke3Byb3ZlbmFuY2V9YDtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwicmV0dXJuXCI6XG4gICAgICAgIHZhciByZXR1cm5zID0gW107XG4gICAgICAgIGZvcihsZXQgY3VyVmFyIG9mIHJvb3QudmFycykge1xuICAgICAgICAgIHJldHVybnMucHVzaChgJHtjdXJWYXJ9OiAke2N1clZhcn1gKTtcbiAgICAgICAgfVxuICAgICAgICBjb2RlICs9IGByZXR1cm4geyR7cmV0dXJucy5qb2luKFwiLCBcIil9fTtgO1xuICAgICAgICBicmVhaztcbiAgICB9XG4gICAgcmV0dXJuIGNvZGU7XG4gIH1cbiAgLy8gZ2l2ZW4gYSBzZXQgb2YgY2hhbmdlcyBhbmQgYSBqb2luIG9yZGVyLCBkZXRlcm1pbmUgdGhlIHJvb3QgZmFjdHMgdGhhdCBuZWVkXG4gIC8vIHRvIGJlIGpvaW5lZCBhZ2FpbiB0byBjb3ZlciBhbGwgdGhlIGFkZHNcbiAgcmV2ZXJzZUpvaW4oam9pbnMpIHtcbiAgICBsZXQgY2hhbmdlZCA9IGpvaW5zWzBdO1xuICAgIGxldCByZXZlcnNlSm9pbk1hcCA9IHt9O1xuICAgIC8vIGNvbGxlY3QgYWxsIHRoZSBjb25zdHJhaW50cyBhbmQgcmV2ZXJzZSB0aGVtXG4gICAgZm9yIChsZXQgam9pbiBvZiBqb2lucykge1xuICAgICAgZm9yIChsZXQga2V5IGluIGpvaW4uam9pbikge1xuICAgICAgICBsZXQgW3NvdXJjZSwgZmllbGRdID0gam9pbi5qb2luW2tleV07XG4gICAgICAgIGlmIChzb3VyY2UgPD0gY2hhbmdlZC5peCkge1xuICAgICAgICAgIGlmICghcmV2ZXJzZUpvaW5NYXBbc291cmNlXSkge1xuICAgICAgICAgICAgcmV2ZXJzZUpvaW5NYXBbc291cmNlXSA9IHt9O1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZighcmV2ZXJzZUpvaW5NYXBbc291cmNlXVtmaWVsZF0pIHJldmVyc2VKb2luTWFwW3NvdXJjZV1bZmllbGRdID0gW2pvaW4uaXgsIGtleV07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgdmFyIHJlY3Vyc2UgPSAoam9pbnMsIGpvaW5JeCkgPT4ge1xuICAgICAgdmFyIGNvZGUgPSBcIlwiO1xuICAgICAgaWYgKGpvaW5JeCA+PSBqb2lucy5sZW5ndGgpIHtcbiAgICAgICAgcmV0dXJuIFwib3RoZXJzLnB1c2gocm93MClcIjtcbiAgICAgIH1cbiAgICAgIGxldCB7dGFibGUsIGl4LCBuZWdhdGVkfSA9IGpvaW5zW2pvaW5JeF07XG4gICAgICBsZXQgam9pbk1hcCA9IGpvaW5zW2pvaW5JeF0uam9pbjtcbiAgICAgIC8vIHdlIG9ubHkgY2FyZSBhYm91dCB0aGlzIGd1eSBpZiBoZSdzIGpvaW5lZCB3aXRoIGF0IGxlYXN0IG9uZSB0aGluZ1xuICAgICAgaWYgKCFyZXZlcnNlSm9pbk1hcFtpeF0gJiYgam9pbkl4IDwgam9pbnMubGVuZ3RoIC0gMSkgcmV0dXJuIHJlY3Vyc2Uoam9pbnMsIGpvaW5JeCArIDEpO1xuICAgICAgZWxzZSBpZighcmV2ZXJzZUpvaW5NYXApIHJldHVybiBcIlwiO1xuICAgICAgbGV0IG1hcHBpbmdzID0gW107XG4gICAgICBmb3IgKGxldCBrZXkgaW4gcmV2ZXJzZUpvaW5NYXBbaXhdKSB7XG4gICAgICAgIGxldCBbc291cmNlSXgsIGZpZWxkXSA9IHJldmVyc2VKb2luTWFwW2l4XVtrZXldO1xuICAgICAgICBpZihzb3VyY2VJeCA9PT0gY2hhbmdlZC5peCB8fCByZXZlcnNlSm9pbk1hcFtzb3VyY2VJeF0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIG1hcHBpbmdzLnB1c2goYCcke2tleX0nOiByb3cke3NvdXJjZUl4fVsnJHtmaWVsZH0nXWApO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBmb3IobGV0IGtleSBpbiBqb2luTWFwKSB7XG4gICAgICAgIGxldCB2YWx1ZSA9IGpvaW5NYXBba2V5XTtcbiAgICAgICAgaWYodmFsdWUuY29uc3RydWN0b3IgIT09IEFycmF5KSB7XG4gICAgICAgICAgbWFwcGluZ3MucHVzaChgJyR7a2V5fSc6ICR7SlNPTi5zdHJpbmdpZnkodmFsdWUpfWApO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAobmVnYXRlZCkge1xuICAgICAgICAvL0BUT0RPOiBkZWFsIHdpdGggbmVnYXRpb247XG4gICAgICB9XG4gICAgICBjb2RlICs9IGBcbiAgICAgICAgICAgIHZhciByb3dzJHtpeH0gPSBldmUuZmluZCgnJHt0YWJsZX0nLCB7JHttYXBwaW5ncy5qb2luKFwiLCBcIikgfX0pO1xuICAgICAgICAgICAgZm9yKHZhciByb3dzSXgke2l4fSA9IDAsIHJvd3NMZW4ke2l4fSA9IHJvd3Mke2l4fS5sZW5ndGg7IHJvd3NJeCR7aXh9IDwgcm93c0xlbiR7aXh9OyByb3dzSXgke2l4fSsrKSB7XG4gICAgICAgICAgICAgICAgdmFyIHJvdyR7aXh9ID0gcm93cyR7aXh9W3Jvd3NJeCR7aXh9XTtcbiAgICAgICAgICAgICAgICAke3JlY3Vyc2Uoam9pbnMsIGpvaW5JeCArIDEpIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGA7XG4gICAgICByZXR1cm4gY29kZTtcbiAgICB9XG4gICAgcmV0dXJuIHJlY3Vyc2Uoam9pbnMsIDEpO1xuXHR9XG4gIGNvbXBpbGVJbmNyZW1lbnRhbFJvd0ZpbmRlckNvZGUoKSB7XG4gICAgICBsZXQgY29kZSA9IFwidmFyIG90aGVycyA9IFtdO1xcblwiO1xuICAgICAgbGV0IHJldmVyc2VkID0gdGhpcy5qb2lucy5zbGljZSgpLnJldmVyc2UoKTtcbiAgICAgIGxldCBjaGVja3MgPSBbXTtcbiAgICAgIGxldCBpeCA9IDA7XG4gICAgICBmb3IgKGxldCBqb2luIG9mIHJldmVyc2VkKSB7XG4gICAgICAgICAgLy8gd2UgZG9uJ3Qgd2FudCB0byBkbyB0aGlzIGZvciB0aGUgcm9vdFxuICAgICAgICAgIGlmIChpeCA9PT0gcmV2ZXJzZWQubGVuZ3RoIC0gMSkgYnJlYWs7XG4gICAgICAgICAgY2hlY2tzLnB1c2goYFxuXHRcdFx0aWYoY2hhbmdlc1tcIiR7am9pbi50YWJsZX1cIl0gJiYgY2hhbmdlc1tcIiR7am9pbi50YWJsZX1cIl0uYWRkcykge1xuICAgICAgICAgICAgICAgIHZhciBjdXJDaGFuZ2VzJHtqb2luLml4fSA9IGNoYW5nZXNbXCIke2pvaW4udGFibGV9XCJdLmFkZHM7XG4gICAgICAgICAgICAgICAgZm9yKHZhciBjaGFuZ2VJeCR7am9pbi5peH0gPSAwLCBjaGFuZ2VMZW4ke2pvaW4uaXh9ID0gY3VyQ2hhbmdlcyR7am9pbi5peH0ubGVuZ3RoOyBjaGFuZ2VJeCR7am9pbi5peH0gPCBjaGFuZ2VMZW4ke2pvaW4uaXh9OyBjaGFuZ2VJeCR7am9pbi5peH0rKykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgcm93JHtqb2luLml4fSA9IGN1ckNoYW5nZXMke2pvaW4uaXh9W2NoYW5nZUl4JHtqb2luLml4fV07XG5cdFx0XHRcdFx0JHt0aGlzLnJldmVyc2VKb2luKHJldmVyc2VkLnNsaWNlKGl4KSl9XG5cdFx0XHRcdH1cblx0XHRcdH1gKTtcbiAgICAgICAgICBpeCsrO1xuICAgICAgfVxuICAgICAgY29kZSArPSBjaGVja3Muam9pbihcIiBlbHNlXCIpO1xuICAgICAgdmFyIGxhc3QgPSByZXZlcnNlZFtpeF07XG4gICAgICBjb2RlICs9IGBcblx0XHRcdGlmKGNoYW5nZXNbXCIke2xhc3QudGFibGV9XCJdICYmIGNoYW5nZXNbXCIke2xhc3QudGFibGV9XCJdLmFkZHMpIHtcbiAgICAgICAgICAgICAgICB2YXIgY3VyQ2hhbmdlcyA9IGNoYW5nZXNbXCIke2xhc3QudGFibGV9XCJdLmFkZHM7XG5cdFx0XHRcdGZvcih2YXIgY2hhbmdlSXggPSAwLCBjaGFuZ2VMZW4gPSBjdXJDaGFuZ2VzLmxlbmd0aDsgY2hhbmdlSXggPCBjaGFuZ2VMZW47IGNoYW5nZUl4KyspIHtcblx0XHRcdFx0XHRvdGhlcnMucHVzaChjdXJDaGFuZ2VzW2NoYW5nZUl4XSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHRcdHJldHVybiBvdGhlcnM7YDtcbiAgICAgIHJldHVybiBjb2RlO1xuICB9XG4gIGluY3JlbWVudGFsUmVtb3ZlKGNoYW5nZXMpIHtcbiAgICBsZXQgaXhlciA9IHRoaXMuaXhlcjtcbiAgICBsZXQgcm93c1RvUG9zdENoZWNrID0gW107XG4gICAgbGV0IHByb3ZlbmFuY2VEaWZmID0gdGhpcy5peGVyLmRpZmYoKTtcbiAgICBsZXQgcmVtb3ZlcyA9IFtdO1xuICAgIGxldCBpbmRleGVzID0gaXhlci50YWJsZShcInByb3ZlbmFuY2VcIikuaW5kZXhlcztcbiAgICBsZXQgc291cmNlUm93TG9va3VwID0gaW5kZXhlc1tcInNvdXJjZXxzb3VyY2Ugcm93fHRhYmxlXCJdLmluZGV4O1xuICAgIGxldCByb3dJbnN0YW5jZUxvb2t1cCA9IGluZGV4ZXNbXCJyb3cgaW5zdGFuY2V8dGFibGVcIl0uaW5kZXg7XG4gICAgbGV0IHRhYmxlUm93TG9va3VwID0gaW5kZXhlc1tcInJvd3x0YWJsZVwiXS5pbmRleDtcbiAgICBsZXQgcHJvdmVuYW5jZVJlbW92ZXMgPSBbXTtcbiAgICBsZXQgdmlzaXRlZCA9IHt9XG4gICAgZm9yKGxldCBqb2luIG9mIHRoaXMuam9pbnMpIHtcbiAgICAgIGxldCBjaGFuZ2UgPSBjaGFuZ2VzW2pvaW4udGFibGVdO1xuICAgICAgaWYoIXZpc2l0ZWRbam9pbi50YWJsZV0gJiYgY2hhbmdlICYmIGNoYW5nZS5yZW1vdmVzLmxlbmd0aCkge1xuICAgICAgICB2aXNpdGVkW2pvaW4udGFibGVdID0gdHJ1ZTtcbiAgICAgICAgZm9yKGxldCByZW1vdmUgb2YgY2hhbmdlLnJlbW92ZXMpIHtcbiAgICAgICAgICBsZXQgcHJvdmVuYW5jZXMgPSBzb3VyY2VSb3dMb29rdXBbam9pbi50YWJsZSArICd8JyArIHJlbW92ZS5fX2lkICsgJ3wnICsgdGhpcy5uYW1lXVxuICAgICAgICAgIGlmKHByb3ZlbmFuY2VzKSB7XG4gICAgICAgICAgICBmb3IobGV0IHByb3ZlbmFuY2Ugb2YgcHJvdmVuYW5jZXMpIHtcbiAgICAgICAgICAgICAgaWYoIXZpc2l0ZWRbcHJvdmVuYW5jZVtcInJvdyBpbnN0YW5jZVwiXV0pIHtcbiAgICAgICAgICAgICAgICB2aXNpdGVkW3Byb3ZlbmFuY2VbXCJyb3cgaW5zdGFuY2VcIl1dID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBsZXQgcmVsYXRlZFByb3ZlbmFuY2UgPSByb3dJbnN0YW5jZUxvb2t1cFtwcm92ZW5hbmNlW1wicm93IGluc3RhbmNlXCJdICsgJ3wnICsgcHJvdmVuYW5jZS50YWJsZV07XG4gICAgICAgICAgICAgICAgZm9yKGxldCByZWxhdGVkIG9mIHJlbGF0ZWRQcm92ZW5hbmNlKSB7XG4gICAgICAgICAgICAgICAgICBwcm92ZW5hbmNlUmVtb3Zlcy5wdXNoKHJlbGF0ZWQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICByb3dzVG9Qb3N0Q2hlY2sucHVzaChwcm92ZW5hbmNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcHJvdmVuYW5jZURpZmYucmVtb3ZlRmFjdHMoXCJwcm92ZW5hbmNlXCIsIHByb3ZlbmFuY2VSZW1vdmVzKTtcbiAgICBpeGVyLmFwcGx5RGlmZkluY3JlbWVudGFsKHByb3ZlbmFuY2VEaWZmKTtcbiAgICBsZXQgaXNFZGIgPSBpeGVyLmVkYlRhYmxlcztcbiAgICBmb3IobGV0IHJvdyBvZiByb3dzVG9Qb3N0Q2hlY2spIHtcbiAgICAgIGxldCBzdXBwb3J0cyA9IHRhYmxlUm93TG9va3VwW3Jvdy5yb3cuX19pZCArICd8JyArIHJvdy50YWJsZV07XG4gICAgICBpZighc3VwcG9ydHMgfHwgc3VwcG9ydHMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJlbW92ZXMucHVzaChyb3cucm93KTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHJlbW92ZXM7XG4gIH1cbiAgY2FuQmVJbmNyZW1lbnRhbCgpIHtcbiAgICBpZih0aGlzLmFnZ3JlZ2F0ZXMubGVuZ3RoKSByZXR1cm4gZmFsc2U7XG4gICAgaWYodGhpcy5zb3J0cykgcmV0dXJuIGZhbHNlO1xuICAgIGlmKHRoaXMuZ3JvdXBzKSByZXR1cm4gZmFsc2U7XG4gICAgaWYodGhpcy5saW1pdEluZm8pIHJldHVybiBmYWxzZTtcbiAgICBmb3IobGV0IGpvaW4gb2YgdGhpcy5qb2lucykge1xuICAgICAgaWYoam9pbi5uZWdhdGVkKSByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGlmKCF0aGlzLmpvaW5zLmxlbmd0aCkgcmV0dXJuIGZhbHNlO1xuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIGNvbXBpbGUoKSB7XG4gICAgbGV0IGFzdCA9IHRoaXMudG9BU1QoKTtcbiAgICBsZXQgY29kZSA9IHRoaXMuY29tcGlsZUFTVChhc3QpO1xuICAgIHRoaXMuY29tcGlsZWQgPSBuZXcgRnVuY3Rpb24oXCJpeGVyXCIsIFwiUXVlcnlGdW5jdGlvbnNcIiwgXCJ0YWJsZUlkXCIsIFwicm9vdFJvd3NcIiwgY29kZSk7XG4gICAgaWYodGhpcy5jYW5CZUluY3JlbWVudGFsKCkpIHtcbiAgICAgIHRoaXMuaW5jcmVtZW50YWxSb3dGaW5kZXIgPSBuZXcgRnVuY3Rpb24oXCJjaGFuZ2VzXCIsIHRoaXMuY29tcGlsZUluY3JlbWVudGFsUm93RmluZGVyQ29kZSgpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5pbmNyZW1lbnRhbFJvd0ZpbmRlciA9IHVuZGVmaW5lZDtcbiAgICB9XG4gICAgdGhpcy5kaXJ0eSA9IGZhbHNlO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG4gIGV4ZWMoKSB7XG4gICAgaWYodGhpcy5kaXJ0eSkge1xuICAgICAgdGhpcy5jb21waWxlKCk7XG4gICAgfVxuICAgIGxldCByb290ID0gdGhpcy5qb2luc1swXTtcbiAgICBsZXQgcm93cztcbiAgICBpZihyb290KSB7XG4gICAgICByb3dzID0gdGhpcy5peGVyLmZpbmQocm9vdC50YWJsZSwgcm9vdC5qb2luKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcm93cyA9IFtdO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5jb21waWxlZCh0aGlzLml4ZXIsIFF1ZXJ5RnVuY3Rpb25zLCB0aGlzLm5hbWUsIHJvd3MpO1xuICB9XG4gIGV4ZWNJbmNyZW1lbnRhbChjaGFuZ2VzLCB0YWJsZSk6IHtwcm92ZW5hbmNlOiBhbnlbXSwgYWRkczogYW55W10sIHJlbW92ZXM6IGFueVtdfSB7XG4gICAgaWYodGhpcy5kaXJ0eSkge1xuICAgICAgdGhpcy5jb21waWxlKCk7XG4gICAgfVxuICAgIGlmKHRoaXMuaW5jcmVtZW50YWxSb3dGaW5kZXIpIHtcbiAgICAgIGxldCBwb3RlbnRpYWxSb3dzID0gdGhpcy5pbmNyZW1lbnRhbFJvd0ZpbmRlcihjaGFuZ2VzKTtcbiAgICAgIC8vIGlmIHRoZSByb290IHNlbGVjdCBoYXMgc29tZSBjb25zdGFudCBmaWx0ZXJzLCB0aGVuXG4gICAgICAvLyB0aGUgYWJvdmUgcm93cyBuZWVkIHRvIGJlIGZpbHRlcmVkIGRvd24gdG8gb25seSB0aG9zZSB0aGF0XG4gICAgICAvLyBtYXRjaC5cbiAgICAgIGxldCByb3dzID0gW107XG4gICAgICBsZXQgcm9vdCA9IHRoaXMuam9pbnNbMF07XG4gICAgICBsZXQgcm9vdEtleXMgPSBPYmplY3Qua2V5cyhyb290LmpvaW4pO1xuICAgICAgaWYocm9vdEtleXMubGVuZ3RoID4gMCkge1xuICAgICAgICByb3dMb29wOiBmb3IobGV0IHJvdyBvZiBwb3RlbnRpYWxSb3dzKSB7XG4gICAgICAgICAgZm9yKGxldCBrZXkgb2Ygcm9vdEtleXMpIHtcbiAgICAgICAgICAgIGlmKHJvd1trZXldICE9PSByb290LmpvaW5ba2V5XSkgY29udGludWUgcm93TG9vcDtcbiAgICAgICAgICB9XG4gICAgICAgICAgcm93cy5wdXNoKHJvdyk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJvd3MgPSBwb3RlbnRpYWxSb3dzO1xuICAgICAgfVxuICAgICAgbGV0IHJlc3VsdHMgPSB0aGlzLmNvbXBpbGVkKHRoaXMuaXhlciwgUXVlcnlGdW5jdGlvbnMsIHRoaXMubmFtZSwgcm93cyk7XG4gICAgICBsZXQgYWRkcyA9IFtdO1xuICAgICAgbGV0IHByZXZIYXNoZXMgPSB0YWJsZS5mYWN0SGFzaDtcbiAgICAgIGxldCBwcmV2S2V5cyA9IE9iamVjdC5rZXlzKHByZXZIYXNoZXMpO1xuICAgICAgbGV0IHN1Z2dlc3RlZFJlbW92ZXMgPSB0aGlzLmluY3JlbWVudGFsUmVtb3ZlKGNoYW5nZXMpO1xuICAgICAgbGV0IHJlYWxEaWZmID0gZGlmZkFkZHNBbmRSZW1vdmVzKHJlc3VsdHMucmVzdWx0cywgc3VnZ2VzdGVkUmVtb3Zlcyk7XG4gICAgICBmb3IobGV0IHJlc3VsdCBvZiByZWFsRGlmZi5hZGRzKSB7XG4gICAgICAgIGxldCBpZCA9IHJlc3VsdC5fX2lkO1xuICAgICAgICBpZihwcmV2SGFzaGVzW2lkXSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgYWRkcy5wdXNoKHJlc3VsdCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGxldCBkaWZmID0gdGhpcy5peGVyLmRpZmYoKTtcbiAgICAgIGRpZmYuYWRkTWFueShcInByb3ZlbmFuY2VcIiwgcmVzdWx0cy5wcm92ZW5hbmNlKTtcbiAgICAgIHRoaXMuaXhlci5hcHBseURpZmZJbmNyZW1lbnRhbChkaWZmKTtcbiAgICAgIC8vIGNvbnNvbGUubG9nKFwiSU5DIFBST1YgRElGRlwiLCB0aGlzLm5hbWUsIGRpZmYubGVuZ3RoKTtcbiAgICAgIHJldHVybiB7cHJvdmVuYW5jZTogcmVzdWx0cy5wcm92ZW5hbmNlLCBhZGRzLCByZW1vdmVzOiByZWFsRGlmZi5yZW1vdmVzfTtcbiAgICB9IGVsc2Uge1xuICAgICAgbGV0IHJlc3VsdHMgPSB0aGlzLmV4ZWMoKTtcbiAgICAgIGxldCBhZGRzID0gW107XG4gICAgICBsZXQgcmVtb3ZlcyA9IFtdO1xuICAgICAgbGV0IHByZXZIYXNoZXMgPSB0YWJsZS5mYWN0SGFzaDtcbiAgICAgIGxldCBwcmV2S2V5cyA9IE9iamVjdC5rZXlzKHByZXZIYXNoZXMpO1xuICAgICAgbGV0IG5ld0hhc2hlcyA9IHt9O1xuICAgICAgZm9yKGxldCByZXN1bHQgb2YgcmVzdWx0cy5yZXN1bHRzKSB7XG4gICAgICAgIGxldCBpZCA9IHJlc3VsdC5fX2lkO1xuICAgICAgICBuZXdIYXNoZXNbaWRdID0gcmVzdWx0O1xuICAgICAgICBpZihwcmV2SGFzaGVzW2lkXSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgYWRkcy5wdXNoKHJlc3VsdCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGZvcihsZXQgaGFzaCBvZiBwcmV2S2V5cykge1xuICAgICAgICBsZXQgdmFsdWUgPSBuZXdIYXNoZXNbaGFzaF07XG4gICAgICAgIGlmKHZhbHVlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgcmVtb3Zlcy5wdXNoKHByZXZIYXNoZXNbaGFzaF0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBsZXQgcmVhbERpZmYgPSBkaWZmQWRkc0FuZFJlbW92ZXMoYWRkcywgcmVtb3Zlcyk7XG4gICAgICBsZXQgZGlmZiA9IHRoaXMuaXhlci5kaWZmKCk7XG4gICAgICBkaWZmLnJlbW92ZShcInByb3ZlbmFuY2VcIiwge3RhYmxlOiB0aGlzLm5hbWV9KTtcbiAgICAgIGRpZmYuYWRkTWFueShcInByb3ZlbmFuY2VcIiwgcmVzdWx0cy5wcm92ZW5hbmNlKTtcbiAgICAgIHRoaXMuaXhlci5hcHBseURpZmZJbmNyZW1lbnRhbChkaWZmKTtcbiAgICAgIC8vIGNvbnNvbGUubG9nKFwiRlVMTCBQUk9WIFNJWkVcIiwgdGhpcy5uYW1lLCBkaWZmLmxlbmd0aCk7XG4gICAgICByZXR1cm4ge3Byb3ZlbmFuY2U6IHJlc3VsdHMucHJvdmVuYW5jZSwgYWRkczogcmVhbERpZmYuYWRkcywgcmVtb3ZlczogcmVhbERpZmYucmVtb3Zlc307XG4gICAgfVxuICB9XG4gIGRlYnVnKCkge1xuICAgIGNvbnNvbGUubG9nKHRoaXMuY29tcGlsZUFTVCh0aGlzLnRvQVNUKCkpKTtcbiAgICBjb25zb2xlLnRpbWUoXCJleGVjXCIpO1xuICAgIHZhciByZXN1bHRzID0gdGhpcy5leGVjKCk7XG4gICAgY29uc29sZS50aW1lRW5kKFwiZXhlY1wiKTtcbiAgICBjb25zb2xlLmxvZyhyZXN1bHRzKTtcbiAgICByZXR1cm4gcmVzdWx0cztcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgVW5pb24ge1xuICBuYW1lO1xuICB0YWJsZXM7XG4gIHNvdXJjZXM7XG4gIGlzU3RhdGVmdWw7XG4gIGhhc2hlcjtcbiAgZGlydHk7XG4gIHByZXY7XG4gIGNvbXBpbGVkO1xuICBpeGVyO1xuICBjb25zdHJ1Y3RvcihpeGVyLCBuYW1lID0gXCJ1bmtub3duXCIpIHtcbiAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgIHRoaXMuaXhlciA9IGl4ZXI7XG4gICAgdGhpcy50YWJsZXMgPSBbXTtcbiAgICB0aGlzLnNvdXJjZXMgPSBbXTtcbiAgICB0aGlzLmlzU3RhdGVmdWwgPSBmYWxzZTtcbiAgICB0aGlzLnByZXYgPSB7cmVzdWx0czogW10sIGhhc2hlczoge319O1xuICAgIHRoaXMuZGlydHkgPSB0cnVlO1xuICB9XG4gIGNoYW5nZXNldChpeGVyOkluZGV4ZXIpIHtcbiAgICBsZXQgZGlmZiA9IGl4ZXIuZGlmZigpO1xuICAgIGRpZmYuYWRkKFwidmlld1wiLCB7dmlldzogdGhpcy5uYW1lLCBraW5kOiBcInVuaW9uXCJ9KTtcbiAgICBmb3IobGV0IHNvdXJjZSBvZiB0aGlzLnNvdXJjZXMpIHtcbiAgICAgIGlmKHNvdXJjZS50eXBlID09PSBcIitcIikge1xuICAgICAgICBsZXQgYWN0aW9uID0gdXVpZCgpO1xuICAgICAgICBkaWZmLmFkZChcImFjdGlvblwiLCB7dmlldzogdGhpcy5uYW1lLCBhY3Rpb24sIGtpbmQ6IFwidW5pb25cIiwgIGl4OiAwfSk7XG4gICAgICAgIGRpZmYuYWRkKFwiYWN0aW9uIHNvdXJjZVwiLCB7YWN0aW9uLCBcInNvdXJjZSB2aWV3XCI6IHNvdXJjZS50YWJsZX0pO1xuICAgICAgICBmb3IobGV0IGZpZWxkIGluIHNvdXJjZS5tYXBwaW5nKSB7XG4gICAgICAgICAgbGV0IG1hcHBlZCA9IHNvdXJjZS5tYXBwaW5nW2ZpZWxkXTtcbiAgICAgICAgICBpZihtYXBwZWQuY29uc3RydWN0b3IgPT09IEFycmF5KSBkaWZmLmFkZChcImFjdGlvbiBtYXBwaW5nXCIsIHthY3Rpb24sIGZyb206IGZpZWxkLCBcInRvIHNvdXJjZVwiOiBzb3VyY2UudGFibGUsIFwidG8gZmllbGRcIjogbWFwcGVkWzBdfSlcbiAgICAgICAgICBlbHNlIGRpZmYuYWRkKFwiYWN0aW9uIG1hcHBpbmcgY29uc3RhbnRcIiwge2FjdGlvbiwgZnJvbTogZmllbGQsIHZhbHVlOiBtYXBwZWR9KTtcbiAgICAgICAgfVxuXG4gICAgICB9IGVsc2UgdGhyb3cgbmV3IEVycm9yKGBVbmtub3duIHNvdXJjZSB0eXBlOiAnJHtzb3VyY2UudHlwZX0nYCk7XG4gICAgfVxuICAgIHJldHVybiBkaWZmO1xuICB9XG4gIGVuc3VyZUhhc2hlcihtYXBwaW5nKSB7XG4gICAgaWYoIXRoaXMuaGFzaGVyKSB7XG4gICAgICB0aGlzLmhhc2hlciA9IGdlbmVyYXRlU3RyaW5nRm4oT2JqZWN0LmtleXMobWFwcGluZykpO1xuICAgIH1cbiAgfVxuICB1bmlvbih0YWJsZU5hbWUsIG1hcHBpbmcpIHtcbiAgICB0aGlzLmRpcnR5ID0gdHJ1ZTtcbiAgICB0aGlzLmVuc3VyZUhhc2hlcihtYXBwaW5nKTtcbiAgICB0aGlzLnRhYmxlcy5wdXNoKHRhYmxlTmFtZSk7XG4gICAgdGhpcy5zb3VyY2VzLnB1c2goe3R5cGU6IFwiK1wiLCB0YWJsZTogdGFibGVOYW1lLCBtYXBwaW5nfSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cbiAgdG9BU1QoKSB7XG4gICAgbGV0IHJvb3QgPSB7dHlwZTogXCJ1bmlvblwiLCBjaGlsZHJlbjogW119O1xuICAgIHJvb3QuY2hpbGRyZW4ucHVzaCh7dHlwZTogXCJkZWNsYXJhdGlvblwiLCB2YXI6IFwicmVzdWx0c1wiLCB2YWx1ZTogXCJbXVwifSk7XG4gICAgcm9vdC5jaGlsZHJlbi5wdXNoKHt0eXBlOiBcImRlY2xhcmF0aW9uXCIsIHZhcjogXCJwcm92ZW5hbmNlXCIsIHZhbHVlOiBcIltdXCJ9KTtcblxuICAgIGxldCBoYXNoZXNWYWx1ZSA9IFwie31cIjtcbiAgICBpZih0aGlzLmlzU3RhdGVmdWwpIHtcbiAgICAgICAgaGFzaGVzVmFsdWUgPSBcInByZXZIYXNoZXNcIjtcbiAgICB9XG4gICAgcm9vdC5jaGlsZHJlbi5wdXNoKHt0eXBlOiBcImRlY2xhcmF0aW9uXCIsIHZhcjogXCJoYXNoZXNcIiwgdmFsdWU6IGhhc2hlc1ZhbHVlfSk7XG5cbiAgICBsZXQgaXggPSAwO1xuICAgIGZvcihsZXQgc291cmNlIG9mIHRoaXMuc291cmNlcykge1xuICAgICAgbGV0IGFjdGlvbjtcbiAgICAgIGlmKHNvdXJjZS50eXBlID09PSBcIitcIikge1xuICAgICAgICBhY3Rpb24gPSB7dHlwZTogXCJyZXN1bHRcIiwgaXgsIGNoaWxkcmVuOiBbe3R5cGU6IFwicHJvdmVuYW5jZVwiLCBzb3VyY2UsIGl4fV19O1xuICAgICAgfVxuICAgICAgcm9vdC5jaGlsZHJlbi5wdXNoKHtcbiAgICAgICAgdHlwZTogXCJzb3VyY2VcIixcbiAgICAgICAgaXgsXG4gICAgICAgIHRhYmxlOiBzb3VyY2UudGFibGUsXG4gICAgICAgIG1hcHBpbmc6IHNvdXJjZS5tYXBwaW5nLFxuICAgICAgICBjaGlsZHJlbjogW2FjdGlvbl0sXG4gICAgICB9KTtcbiAgICAgIGl4Kys7XG4gICAgfVxuICAgIHJvb3QuY2hpbGRyZW4ucHVzaCh7dHlwZTogXCJoYXNoZXNUb1Jlc3VsdHNcIn0pO1xuICAgIHJvb3QuY2hpbGRyZW4ucHVzaCh7dHlwZTogXCJyZXR1cm5cIiwgdmFyczogW1wicmVzdWx0c1wiLCBcImhhc2hlc1wiLCBcInByb3ZlbmFuY2VcIl19KTtcbiAgICByZXR1cm4gcm9vdDtcbiAgfVxuICBjb21waWxlQVNUKHJvb3QpIHtcbiAgICBsZXQgY29kZSA9IFwiXCI7XG4gICAgbGV0IHR5cGUgPSByb290LnR5cGU7XG4gICAgc3dpdGNoKHR5cGUpIHtcbiAgICAgIGNhc2UgXCJ1bmlvblwiOlxuICAgICAgICBmb3IodmFyIGNoaWxkIG9mIHJvb3QuY2hpbGRyZW4pIHtcbiAgICAgICAgICBjb2RlICs9IHRoaXMuY29tcGlsZUFTVChjaGlsZCk7XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwiZGVjbGFyYXRpb25cIjpcbiAgICAgICAgY29kZSArPSBgdmFyICR7cm9vdC52YXJ9ID0gJHtyb290LnZhbHVlfTtcXG5gO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJzb3VyY2VcIjpcbiAgICAgICAgdmFyIGl4ID0gcm9vdC5peDtcbiAgICAgICAgbGV0IG1hcHBpbmdJdGVtcyA9IFtdO1xuICAgICAgICBmb3IobGV0IGtleSBpbiByb290Lm1hcHBpbmcpIHtcbiAgICAgICAgICBsZXQgbWFwcGluZyA9IHJvb3QubWFwcGluZ1trZXldO1xuICAgICAgICAgIGxldCB2YWx1ZTtcbiAgICAgICAgICBpZihtYXBwaW5nLmNvbnN0cnVjdG9yID09PSBBcnJheSAmJiBtYXBwaW5nLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgICAgbGV0IFtmaWVsZF0gPSBtYXBwaW5nO1xuICAgICAgICAgICAgdmFsdWUgPSBgc291cmNlUm93JHtpeH1bJyR7ZmllbGR9J11gO1xuICAgICAgICAgIH0gZWxzZSBpZihtYXBwaW5nLmNvbnN0cnVjdG9yID09PSBBcnJheSAmJiBtYXBwaW5nLmxlbmd0aCA9PT0gMikge1xuICAgICAgICAgICAgbGV0IFtfLCBmaWVsZF0gPSBtYXBwaW5nO1xuICAgICAgICAgICAgdmFsdWUgPSBgc291cmNlUm93JHtpeH1bJyR7ZmllbGR9J11gO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB2YWx1ZSA9IEpTT04uc3RyaW5naWZ5KG1hcHBpbmcpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBtYXBwaW5nSXRlbXMucHVzaChgJyR7a2V5fSc6ICR7dmFsdWV9YClcbiAgICAgICAgfVxuICAgICAgICBjb2RlICs9IGB2YXIgc291cmNlUm93cyR7aXh9ID0gY2hhbmdlc1snJHtyb290LnRhYmxlLnJlcGxhY2UoLycvZywgXCJcXFxcJ1wiKX0nXTtcXG5gO1xuICAgICAgICBjb2RlICs9IGBmb3IodmFyIHJvd0l4JHtpeH0gPSAwLCByb3dzTGVuJHtpeH0gPSBzb3VyY2VSb3dzJHtpeH0ubGVuZ3RoOyByb3dJeCR7aXh9IDwgcm93c0xlbiR7aXh9OyByb3dJeCR7aXh9KyspIHtcXG5gXG4gICAgICAgIGNvZGUgKz0gYHZhciBzb3VyY2VSb3cke2l4fSA9IHNvdXJjZVJvd3Mke2l4fVtyb3dJeCR7aXh9XTtcXG5gO1xuICAgICAgICBjb2RlICs9IGB2YXIgbWFwcGVkUm93JHtpeH0gPSB7JHttYXBwaW5nSXRlbXMuam9pbihcIiwgXCIpfX07XFxuYFxuICAgICAgICBmb3IodmFyIGNoaWxkIG9mIHJvb3QuY2hpbGRyZW4pIHtcbiAgICAgICAgICBjb2RlICs9IHRoaXMuY29tcGlsZUFTVChjaGlsZCk7XG4gICAgICAgIH1cbiAgICAgICAgY29kZSArPSBcIn1cXG5cIjtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwicmVzdWx0XCI6XG4gICAgICAgIHZhciBpeCA9IHJvb3QuaXg7XG4gICAgICAgIGNvZGUgKz0gYHZhciBoYXNoJHtpeH0gPSBoYXNoZXIobWFwcGVkUm93JHtpeH0pO1xcbmA7XG4gICAgICAgIGNvZGUgKz0gYG1hcHBlZFJvdyR7aXh9Ll9faWQgPSBoYXNoJHtpeH07XFxuYDtcbiAgICAgICAgY29kZSArPSBgaGFzaGVzW2hhc2gke2l4fV0gPSBtYXBwZWRSb3cke2l4fTtcXG5gO1xuICAgICAgICBmb3IodmFyIGNoaWxkIG9mIHJvb3QuY2hpbGRyZW4pIHtcbiAgICAgICAgICBjb2RlICs9IHRoaXMuY29tcGlsZUFTVChjaGlsZCk7XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwicmVtb3ZlUmVzdWx0XCI6XG4gICAgICAgIHZhciBpeCA9IHJvb3QuaXg7XG4gICAgICAgIGNvZGUgKz0gYGhhc2hlc1toYXNoZXIobWFwcGVkUm93JHtpeH0pXSA9IGZhbHNlO1xcbmA7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcImhhc2hlc1RvUmVzdWx0c1wiOlxuICAgICAgICBjb2RlICs9IFwidmFyIGhhc2hLZXlzID0gT2JqZWN0LmtleXMoaGFzaGVzKTtcXG5cIjtcbiAgICAgICAgY29kZSArPSBcImZvcih2YXIgaGFzaEtleUl4ID0gMCwgaGFzaEtleUxlbiA9IGhhc2hLZXlzLmxlbmd0aDsgaGFzaEtleUl4IDwgaGFzaEtleUxlbjsgaGFzaEtleUl4KyspIHtcXG5cIjtcbiAgICAgICAgY29kZSArPSBcInZhciBjdXJIYXNoS2V5ID0gaGFzaEtleXNbaGFzaEtleUl4XTtcIlxuICAgICAgICBjb2RlICs9IFwidmFyIHZhbHVlID0gaGFzaGVzW2N1ckhhc2hLZXldO1xcblwiO1xuICAgICAgICBjb2RlICs9IFwiaWYodmFsdWUgIT09IGZhbHNlKSB7XFxuXCI7XG4gICAgICAgIGNvZGUgKz0gXCJ2YWx1ZS5fX2lkID0gY3VySGFzaEtleTtcXG5cIjtcbiAgICAgICAgY29kZSArPSBcInJlc3VsdHMucHVzaCh2YWx1ZSk7XFxuXCI7XG4gICAgICAgIGNvZGUgKz0gXCJ9XFxuXCI7XG4gICAgICAgIGNvZGUgKz0gXCJ9XFxuXCI7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcInByb3ZlbmFuY2VcIjpcbiAgICAgICAgdmFyIHNvdXJjZSA9IHJvb3Quc291cmNlLnRhYmxlO1xuICAgICAgICB2YXIgaXggPSByb290Lml4O1xuICAgICAgICB2YXIgcHJvdmVuYW5jZSA9IFwidmFyIHByb3ZlbmFuY2VfX2lkID0gJyc7XFxuXCI7XG4gICAgICAgIHByb3ZlbmFuY2UgKz0gYHByb3ZlbmFuY2VfX2lkID0gJyR7dGhpcy5uYW1lLnJlcGxhY2UoLycvZywgXCJcXFxcJ1wiKX18JyArIG1hcHBlZFJvdyR7aXh9Ll9faWQgKyAnfCcgKyByb3dJbnN0YW5jZSArICd8JHtzb3VyY2UucmVwbGFjZSgvJy9nLCBcIlxcXFwnXCIpfXwnICsgc291cmNlUm93JHtpeH0uX19pZDsgXFxuYDtcbiAgICAgICAgcHJvdmVuYW5jZSArPSBgcHJvdmVuYW5jZS5wdXNoKHt0YWJsZTogJyR7dGhpcy5uYW1lLnJlcGxhY2UoLycvZywgXCJcXFxcJ1wiKX0nLCByb3c6IG1hcHBlZFJvdyR7aXh9LCBcInJvdyBpbnN0YW5jZVwiOiByb3dJbnN0YW5jZSwgc291cmNlOiBcIiR7c291cmNlLnJlcGxhY2UoLycvZywgXCJcXFxcJ1wiKX1cIiwgXCJzb3VyY2Ugcm93XCI6IHNvdXJjZVJvdyR7aXh9fSk7XFxuYDtcbiAgICAgICAgY29kZSA9IGB2YXIgcm93SW5zdGFuY2UgPSBcIiR7c291cmNlLnJlcGxhY2UoLycvZywgXCJcXFxcJ1wiKX18XCIgKyBtYXBwZWRSb3cke2l4fS5fX2lkO1xuICAgICAgICAke3Byb3ZlbmFuY2V9YDtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwicmV0dXJuXCI6XG4gICAgICAgIGNvZGUgKz0gYHJldHVybiB7JHtyb290LnZhcnMubWFwKChuYW1lKSA9PiBgJHtuYW1lfTogJHtuYW1lfWApLmpvaW4oXCIsIFwiKX19O2A7XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgICByZXR1cm4gY29kZTtcbiAgfVxuICBjb21waWxlKCkge1xuICAgIGxldCBhc3QgPSB0aGlzLnRvQVNUKCk7XG4gICAgbGV0IGNvZGUgPSB0aGlzLmNvbXBpbGVBU1QoYXN0KTtcbiAgICB0aGlzLmNvbXBpbGVkID0gbmV3IEZ1bmN0aW9uKFwiaXhlclwiLCBcImhhc2hlclwiLCBcImNoYW5nZXNcIiwgY29kZSk7XG4gICAgdGhpcy5kaXJ0eSA9IGZhbHNlO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG4gIGRlYnVnKCkge1xuICAgIGxldCBjb2RlID0gdGhpcy5jb21waWxlQVNUKHRoaXMudG9BU1QoKSk7XG4gICAgY29uc29sZS5sb2coY29kZSk7XG4gICAgcmV0dXJuIGNvZGU7XG4gIH1cbiAgZXhlYygpIHtcbiAgICBpZih0aGlzLmRpcnR5KSB7XG4gICAgICB0aGlzLmNvbXBpbGUoKTtcbiAgICB9XG4gICAgbGV0IGNoYW5nZXMgPSB7fVxuICAgIGZvcihsZXQgc291cmNlIG9mIHRoaXMuc291cmNlcykge1xuICAgICAgY2hhbmdlc1tzb3VyY2UudGFibGVdID0gdGhpcy5peGVyLnRhYmxlKHNvdXJjZS50YWJsZSkudGFibGU7XG4gICAgfVxuICAgIGxldCByZXN1bHRzID0gdGhpcy5jb21waWxlZCh0aGlzLml4ZXIsIHRoaXMuaGFzaGVyLCBjaGFuZ2VzKTtcbiAgICByZXR1cm4gcmVzdWx0cztcbiAgfVxuICBpbmNyZW1lbnRhbFJlbW92ZShjaGFuZ2VzKSB7XG4gICAgbGV0IGl4ZXIgPSB0aGlzLml4ZXI7XG4gICAgbGV0IHJvd3NUb1Bvc3RDaGVjayA9IFtdO1xuICAgIGxldCBwcm92ZW5hbmNlRGlmZiA9IHRoaXMuaXhlci5kaWZmKCk7XG4gICAgbGV0IHJlbW92ZXMgPSBbXTtcbiAgICBsZXQgaW5kZXhlcyA9IGl4ZXIudGFibGUoXCJwcm92ZW5hbmNlXCIpLmluZGV4ZXM7XG4gICAgbGV0IHNvdXJjZVJvd0xvb2t1cCA9IGluZGV4ZXNbXCJzb3VyY2V8c291cmNlIHJvd3x0YWJsZVwiXS5pbmRleDtcbiAgICBsZXQgcm93SW5zdGFuY2VMb29rdXAgPSBpbmRleGVzW1wicm93IGluc3RhbmNlfHRhYmxlXCJdLmluZGV4O1xuICAgIGxldCB0YWJsZVJvd0xvb2t1cCA9IGluZGV4ZXNbXCJyb3d8dGFibGVcIl0uaW5kZXg7XG4gICAgbGV0IHByb3ZlbmFuY2VSZW1vdmVzID0gW107XG4gICAgbGV0IHZpc2l0ZWQgPSB7fVxuICAgIGZvcihsZXQgc291cmNlIG9mIHRoaXMuc291cmNlcykge1xuICAgICAgbGV0IGNoYW5nZSA9IGNoYW5nZXNbc291cmNlLnRhYmxlXTtcbiAgICAgIGlmKCF2aXNpdGVkW3NvdXJjZS50YWJsZV0gJiYgY2hhbmdlICYmIGNoYW5nZS5yZW1vdmVzLmxlbmd0aCkge1xuICAgICAgICB2aXNpdGVkW3NvdXJjZS50YWJsZV0gPSB0cnVlO1xuICAgICAgICBmb3IobGV0IHJlbW92ZSBvZiBjaGFuZ2UucmVtb3Zlcykge1xuICAgICAgICAgIGxldCBwcm92ZW5hbmNlcyA9IHNvdXJjZVJvd0xvb2t1cFtzb3VyY2UudGFibGUgKyAnfCcgKyByZW1vdmUuX19pZCArICd8JyArIHRoaXMubmFtZV1cbiAgICAgICAgICBpZihwcm92ZW5hbmNlcykge1xuICAgICAgICAgICAgZm9yKGxldCBwcm92ZW5hbmNlIG9mIHByb3ZlbmFuY2VzKSB7XG4gICAgICAgICAgICAgIGlmKCF2aXNpdGVkW3Byb3ZlbmFuY2VbXCJyb3cgaW5zdGFuY2VcIl1dKSB7XG4gICAgICAgICAgICAgICAgdmlzaXRlZFtwcm92ZW5hbmNlW1wicm93IGluc3RhbmNlXCJdXSA9IHRydWU7XG4gICAgICAgICAgICAgICAgbGV0IHJlbGF0ZWRQcm92ZW5hbmNlID0gcm93SW5zdGFuY2VMb29rdXBbcHJvdmVuYW5jZVtcInJvdyBpbnN0YW5jZVwiXSArICd8JyArIHByb3ZlbmFuY2UudGFibGVdO1xuICAgICAgICAgICAgICAgIGZvcihsZXQgcmVsYXRlZCBvZiByZWxhdGVkUHJvdmVuYW5jZSkge1xuICAgICAgICAgICAgICAgICAgcHJvdmVuYW5jZVJlbW92ZXMucHVzaChyZWxhdGVkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgcm93c1RvUG9zdENoZWNrLnB1c2gocHJvdmVuYW5jZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHByb3ZlbmFuY2VEaWZmLnJlbW92ZUZhY3RzKFwicHJvdmVuYW5jZVwiLCBwcm92ZW5hbmNlUmVtb3Zlcyk7XG4gICAgaXhlci5hcHBseURpZmZJbmNyZW1lbnRhbChwcm92ZW5hbmNlRGlmZik7XG4gICAgbGV0IGlzRWRiID0gaXhlci5lZGJUYWJsZXM7XG4gICAgZm9yKGxldCByb3cgb2Ygcm93c1RvUG9zdENoZWNrKSB7XG4gICAgICBsZXQgc3VwcG9ydHMgPSB0YWJsZVJvd0xvb2t1cFtyb3cucm93Ll9faWQgKyAnfCcgKyByb3cudGFibGVdO1xuICAgICAgaWYoIXN1cHBvcnRzIHx8IHN1cHBvcnRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZW1vdmVzLnB1c2gocm93LnJvdyk7XG4gICAgICB9IGVsc2UgaWYodGhpcy5zb3VyY2VzLmxlbmd0aCA+IDIpIHtcbiAgICAgICAgbGV0IHN1cHBvcnRzVG9SZW1vdmUgPSBbXTtcbiAgICAgICAgLy8gb3RoZXJ3aXNlIGlmIHRoZXJlIGFyZSBzdXBwb3J0cywgdGhlbiB3ZSBuZWVkIHRvIHdhbGsgdGhlIHN1cHBvcnRcbiAgICAgICAgLy8gZ3JhcGggYmFja3dhcmRzIGFuZCBtYWtlIHN1cmUgZXZlcnkgc3VwcG9ydGluZyByb3cgdGVybWluYXRlcyBhdCBhblxuICAgICAgICAvLyBlZGIgdmFsdWUuIElmIG5vdCwgdGhlbiB0aGF0IHN1cHBvcnQgYWxzbyBuZWVkcyB0byBiZSByZW1vdmVkXG4gICAgICAgIGZvcihsZXQgc3VwcG9ydCBvZiBzdXBwb3J0cykge1xuICAgICAgICAgIC8vIGlmIHRoZSBzdXBwb3J0IGlzIGFscmVhZHkgYW4gZWRiLCB3ZSdyZSBnb29kIHRvIGdvLlxuICAgICAgICAgIGlmKGlzRWRiW3N1cHBvcnQuc291cmNlXSkgY29udGludWU7XG4gICAgICAgICAgaWYoIXRhYmxlUm93TG9va3VwW3N1cHBvcnRbXCJzb3VyY2Ugcm93XCJdLl9faWQgKyAnfCcgKyBzdXBwb3J0LnNvdXJjZV0pIHtcbiAgICAgICAgICAgIHN1cHBvcnRzVG9SZW1vdmUucHVzaChzdXBwb3J0KTtcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgICAvLyBnZXQgYWxsIHRoZSBzdXBwb3J0cyBmb3IgdGhpcyBzdXBwb3J0XG4gICAgICAgICAgbGV0IG5vZGVzID0gdGFibGVSb3dMb29rdXBbc3VwcG9ydFtcInNvdXJjZSByb3dcIl0uX19pZCArICd8JyArIHN1cHBvcnQuc291cmNlXS5zbGljZSgpO1xuICAgICAgICAgIGxldCBub2RlSXggPSAwO1xuICAgICAgICAgIC8vIGl0ZXJhdGUgdGhyb3VnaCBhbGwgdGhlIG5vZGVzLCBpZiB0aGV5IGhhdmUgZnVydGhlciBzdXBwb3J0cyB0aGVuXG4gICAgICAgICAgLy8gYXNzdW1lIHRoaXMgbm9kZSBpcyBvayBhbmQgYWRkIHRob3NlIHN1cHBvcnRzIHRvIHRoZSBsaXN0IG9mIG5vZGVzIHRvXG4gICAgICAgICAgLy8gY2hlY2suIElmIHdlIHJ1biBpbnRvIGEgbm9kZSB3aXRoIG5vIHN1cHBvcnRzIGl0IG11c3QgZWl0aGVyIGJlIGFuIGVkYlxuICAgICAgICAgIC8vIG9yIGl0J3MgdW5zdXBwb3J0ZWQgYW5kIHRoaXMgcm93IGluc3RhbmNlIG5lZWRzIHRvIGJlIHJlbW92ZWQuXG4gICAgICAgICAgd2hpbGUobm9kZUl4IDwgbm9kZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICBsZXQgbm9kZSA9IG5vZGVzW25vZGVJeF07XG4gICAgICAgICAgICBpZihpc0VkYltub2RlLnNvdXJjZV0pIHtcbiAgICAgICAgICAgICAgbm9kZUl4Kys7XG4gICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbGV0IG5vZGVTdXBwb3J0cyA9IHRhYmxlUm93TG9va3VwW25vZGVbXCJzb3VyY2Ugcm93XCJdLl9faWQgKyAnfCcgKyBub2RlLnNvdXJjZV07XG4gICAgICAgICAgICBpZighbm9kZVN1cHBvcnRzIHx8IG5vZGVTdXBwb3J0cy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgc3VwcG9ydHNUb1JlbW92ZS5wdXNoKHN1cHBvcnQpO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGZvcihsZXQgbm9kZVN1cHBvcnQgb2Ygbm9kZVN1cHBvcnRzKSB7XG4gICAgICAgICAgICAgICAgbm9kZXMucHVzaChub2RlU3VwcG9ydCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgbm9kZUl4Kys7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmKHN1cHBvcnRzVG9SZW1vdmUubGVuZ3RoKSB7XG4gICAgICAgICAgLy8gd2UgbmVlZCB0byByZW1vdmUgYWxsIHRoZSBzdXBwb3J0c1xuICAgICAgICAgIGxldCBwcm92ZW5hbmNlUmVtb3ZlcyA9IFtdO1xuICAgICAgICAgIGZvcihsZXQgc3VwcG9ydCBvZiBzdXBwb3J0c1RvUmVtb3ZlKSB7XG4gICAgICAgICAgICBsZXQgcmVsYXRlZFByb3ZlbmFuY2UgPSByb3dJbnN0YW5jZUxvb2t1cFtzdXBwb3J0W1wicm93IGluc3RhbmNlXCJdICsgJ3wnICsgc3VwcG9ydC50YWJsZV07XG4gICAgICAgICAgICBmb3IobGV0IHJlbGF0ZWQgb2YgcmVsYXRlZFByb3ZlbmFuY2UpIHtcbiAgICAgICAgICAgICAgcHJvdmVuYW5jZVJlbW92ZXMucHVzaChyZWxhdGVkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgbGV0IGRpZmYgPSBpeGVyLmRpZmYoKTtcbiAgICAgICAgICBkaWZmLnJlbW92ZUZhY3RzKFwicHJvdmVuYW5jZVwiLCBwcm92ZW5hbmNlUmVtb3Zlcyk7XG4gICAgICAgICAgaXhlci5hcHBseURpZmZJbmNyZW1lbnRhbChkaWZmKTtcbiAgICAgICAgICAvLyBub3cgdGhhdCBhbGwgdGhlIHVuc3VwcG9ydGVkIHByb3ZlbmFuY2VzIGhhdmUgYmVlbiByZW1vdmVkLCBjaGVjayBpZiB0aGVyZSdzIGFueXRoaW5nXG4gICAgICAgICAgLy8gbGVmdC5cbiAgICAgICAgICBpZighdGFibGVSb3dMb29rdXBbcm93LnJvdy5fX2lkICsgJ3wnICsgcm93LnRhYmxlXSB8fCB0YWJsZVJvd0xvb2t1cFtyb3cucm93Ll9faWQgKyAnfCcgKyByb3cudGFibGVdLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmVtb3Zlcy5wdXNoKHJvdy5yb3cpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcmVtb3ZlcztcbiAgfVxuICBleGVjSW5jcmVtZW50YWwoY2hhbmdlcywgdGFibGUpOiB7cHJvdmVuYW5jZTogYW55W10sIGFkZHM6IGFueVtdLCByZW1vdmVzOiBhbnlbXX0ge1xuICAgIGlmKHRoaXMuZGlydHkpIHtcbiAgICAgIHRoaXMuY29tcGlsZSgpO1xuICAgIH1cblxuICAgIGxldCBzb3VyY2VDaGFuZ2VzID0ge31cbiAgICBmb3IobGV0IHNvdXJjZSBvZiB0aGlzLnNvdXJjZXMpIHtcbiAgICAgIGxldCB2YWx1ZTtcbiAgICAgIGlmKCFjaGFuZ2VzW3NvdXJjZS50YWJsZV0pIHtcbiAgICAgICAgdmFsdWUgPSBbXTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhbHVlID0gY2hhbmdlc1tzb3VyY2UudGFibGVdLmFkZHM7XG4gICAgICB9XG4gICAgICBzb3VyY2VDaGFuZ2VzW3NvdXJjZS50YWJsZV0gPSB2YWx1ZTtcbiAgICB9XG4gICAgbGV0IHJlc3VsdHMgPSB0aGlzLmNvbXBpbGVkKHRoaXMuaXhlciwgdGhpcy5oYXNoZXIsIHNvdXJjZUNoYW5nZXMpO1xuICAgIGxldCBhZGRzID0gW107XG4gICAgbGV0IHByZXZIYXNoZXMgPSB0YWJsZS5mYWN0SGFzaDtcbiAgICBsZXQgcHJldktleXMgPSBPYmplY3Qua2V5cyhwcmV2SGFzaGVzKTtcbiAgICBsZXQgc3VnZ2VzdGVkUmVtb3ZlcyA9IHRoaXMuaW5jcmVtZW50YWxSZW1vdmUoY2hhbmdlcyk7XG4gICAgbGV0IHJlYWxEaWZmID0gZGlmZkFkZHNBbmRSZW1vdmVzKHJlc3VsdHMucmVzdWx0cywgc3VnZ2VzdGVkUmVtb3Zlcyk7XG4gICAgZm9yKGxldCByZXN1bHQgb2YgcmVhbERpZmYuYWRkcykge1xuICAgICAgbGV0IGlkID0gcmVzdWx0Ll9faWQ7XG4gICAgICBpZihwcmV2SGFzaGVzW2lkXSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGFkZHMucHVzaChyZXN1bHQpO1xuICAgICAgfVxuICAgIH1cbiAgICBsZXQgZGlmZiA9IHRoaXMuaXhlci5kaWZmKCk7XG4gICAgZGlmZi5hZGRNYW55KFwicHJvdmVuYW5jZVwiLCByZXN1bHRzLnByb3ZlbmFuY2UpO1xuICAgIHRoaXMuaXhlci5hcHBseURpZmZJbmNyZW1lbnRhbChkaWZmKTtcbiAgICByZXR1cm4ge3Byb3ZlbmFuY2U6IHJlc3VsdHMucHJvdmVuYW5jZSwgYWRkcywgcmVtb3ZlczogcmVhbERpZmYucmVtb3Zlc307XG4gIH1cbn1cblxuLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbi8vIEJ1aWx0aW4gUHJpbWl0aXZlc1xuLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxucnVudGltZS5kZWZpbmUoXCJjb3VudFwiLCB7YWdncmVnYXRlOiB0cnVlLCByZXN1bHQ6IFwiY291bnRcIn0sIGZ1bmN0aW9uKHByZXYpIHtcbiAgaWYoIXByZXYuY291bnQpIHtcbiAgICBwcmV2LmNvdW50ID0gMDtcbiAgfVxuICBwcmV2LmNvdW50Kys7XG4gIHJldHVybiBwcmV2O1xufSk7XG5cbnJ1bnRpbWUuZGVmaW5lKFwic3VtXCIsIHthZ2dyZWdhdGU6IHRydWUsIHJlc3VsdDogXCJzdW1cIn0sIGZ1bmN0aW9uKHByZXYsIHZhbHVlKSB7XG4gIGlmKCFwcmV2LnN1bSkge1xuICAgIHByZXYuc3VtID0gMDtcbiAgfVxuICBwcmV2LnN1bSArPSB2YWx1ZTtcbiAgcmV0dXJuIHByZXY7XG59KTtcblxucnVudGltZS5kZWZpbmUoXCJhdmVyYWdlXCIsIHthZ2dyZWdhdGU6IHRydWUsIHJlc3VsdDogXCJhdmVyYWdlXCJ9LCBmdW5jdGlvbihwcmV2LCB2YWx1ZSkge1xuICBpZighcHJldi5zdW0pIHtcbiAgICBwcmV2LnN1bSA9IDA7XG4gICAgcHJldi5jb3VudCA9IDA7XG4gIH1cbiAgcHJldi5jb3VudCsrO1xuICBwcmV2LnN1bSArPSB2YWx1ZTtcbiAgcHJldi5hdmVyYWdlID0gcHJldi5zdW0gLyBwcmV2LmNvdW50O1xuICByZXR1cm4gcHJldjtcbn0pO1xuXG5ydW50aW1lLmRlZmluZShcImxvd2VyY2FzZVwiLCB7cmVzdWx0OiBcInJlc3VsdFwifSwgZnVuY3Rpb24odGV4dCkge1xuICBpZih0eXBlb2YgdGV4dCA9PT0gXCJzdHJpbmdcIikge1xuICAgIHJldHVybiB7cmVzdWx0OiB0ZXh0LnRvTG93ZXJDYXNlKCl9O1xuICB9XG4gIHJldHVybiB7cmVzdWx0OiB0ZXh0fTtcbn0pXG5cbnJ1bnRpbWUuZGVmaW5lKFwiPVwiLCB7ZmlsdGVyOiB0cnVlLCBpbnZlcnNlOiBcIiE9XCJ9LCBmdW5jdGlvbihhLCBiKSB7XG4gIHJldHVybiBhID09PSBiID8gcnVudGltZS5TVUNDRUVEIDogcnVudGltZS5GQUlMO1xufSk7XG5cbnJ1bnRpbWUuZGVmaW5lKFwiIT1cIiwge2ZpbHRlcjogdHJ1ZSwgaW52ZXJzZTogXCI9XCJ9LCBmdW5jdGlvbihhLCBiKSB7XG4gIHJldHVybiBhICE9PSBiID8gcnVudGltZS5TVUNDRUVEIDogcnVudGltZS5GQUlMO1xufSk7XG5cbnJ1bnRpbWUuZGVmaW5lKFwiPlwiLCB7ZmlsdGVyOiB0cnVlLCBpbnZlcnNlOiBcIjw9XCJ9LCBmdW5jdGlvbihhLCBiKSB7XG4gIHJldHVybiBhID4gYiA/IHJ1bnRpbWUuU1VDQ0VFRCA6IHJ1bnRpbWUuRkFJTDtcbn0pO1xuXG5ydW50aW1lLmRlZmluZShcIjxcIiwge2ZpbHRlcjogdHJ1ZSwgaW52ZXJzZTogXCI+PVwifSwgZnVuY3Rpb24oYSwgYikge1xuICByZXR1cm4gYSA8IGIgPyBydW50aW1lLlNVQ0NFRUQgOiBydW50aW1lLkZBSUw7XG59KTtcblxucnVudGltZS5kZWZpbmUoXCI+PVwiLCB7ZmlsdGVyOiB0cnVlLCBpbnZlcnNlOiBcIjxcIn0sIGZ1bmN0aW9uKGEsIGIpIHtcbiAgcmV0dXJuIGEgPj0gYiA/IHJ1bnRpbWUuU1VDQ0VFRCA6IHJ1bnRpbWUuRkFJTDtcbn0pO1xuXG5ydW50aW1lLmRlZmluZShcIjw9XCIsIHtmaWx0ZXI6IHRydWUsIGludmVyc2U6IFwiPlwifSwgZnVuY3Rpb24oYSwgYikge1xuICByZXR1cm4gYSA8PSBiID8gcnVudGltZS5TVUNDRUVEIDogcnVudGltZS5GQUlMO1xufSk7XG5cbnJ1bnRpbWUuZGVmaW5lKFwiK1wiLCB7cmVzdWx0OiBcInJlc3VsdFwifSwgZnVuY3Rpb24oYSwgYikge1xuICByZXR1cm4ge3Jlc3VsdDogYSArIGJ9O1xufSk7XG5cbnJ1bnRpbWUuZGVmaW5lKFwiLVwiLCB7cmVzdWx0OiBcInJlc3VsdFwifSwgZnVuY3Rpb24oYSwgYikge1xuICByZXR1cm4ge3Jlc3VsdDogYSAtIGJ9O1xufSk7XG5cbnJ1bnRpbWUuZGVmaW5lKFwiKlwiLCB7cmVzdWx0OiBcInJlc3VsdFwifSwgZnVuY3Rpb24oYSwgYikge1xuICByZXR1cm4ge3Jlc3VsdDogYSAqIGJ9O1xufSk7XG5cbnJ1bnRpbWUuZGVmaW5lKFwiL1wiLCB7cmVzdWx0OiBcInJlc3VsdFwifSwgZnVuY3Rpb24oYSwgYikge1xuICByZXR1cm4ge3Jlc3VsdDogYSAvIGJ9O1xufSk7XG5cbnJ1bnRpbWUuZGVmaW5lKFwiXlwiLCB7cmVzdWx0OiBcInJlc3VsdFwifSwgZnVuY3Rpb24oYSwgYikge1xuICByZXR1cm4ge3Jlc3VsdDogTWF0aC5wb3coYSxiKX07XG59KTtcblxuLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbi8vIEFTVCBhbmQgY29tcGlsZXJcbi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbi8vIHZpZXc6IHZpZXcsIGtpbmRbdW5pb258cXVlcnl8dGFibGVdXG4vLyBhY3Rpb246IHZpZXcsIGFjdGlvbiwga2luZFtzZWxlY3R8Y2FsY3VsYXRlfHByb2plY3R8dW5pb258dW51bmlvbnxzdGF0ZWZ1bHxsaW1pdHxzb3J0fGdyb3VwfGFnZ3JlZ2F0ZV0sIGl4XG4vLyBhY3Rpb24gc291cmNlOiBhY3Rpb24sIHNvdXJjZSB2aWV3XG4vLyBhY3Rpb24gbWFwcGluZzogYWN0aW9uLCBmcm9tLCB0byBzb3VyY2UsIHRvIGZpZWxkXG4vLyBhY3Rpb24gbWFwcGluZyBjb25zdGFudDogYWN0aW9uLCBmcm9tLCB2YWx1ZVxuXG5mdW5jdGlvbiBhZGRSZWNvbXBpbGVUcmlnZ2VycyhldmUpIHtcblxuICB2YXIgcmVjb21waWxlVHJpZ2dlciA9IHtcbiAgICBleGVjOiAoaXhlcikgPT4ge1xuICAgICAgZm9yKGxldCB2aWV3IG9mIGl4ZXIuZmluZChcInZpZXdcIikpIHtcbiAgICAgICAgaWYodmlldy5raW5kID09PSBcInRhYmxlXCIpIGNvbnRpbnVlO1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGxldCBxdWVyeSA9IGNvbXBpbGUoaXhlciwgdmlldy52aWV3KTtcbiAgICAgICAgICBpeGVyLmFzVmlldyhxdWVyeSk7XG4gICAgICAgIH0gY2F0Y2goZSkge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJCQUQgUVVFUlkgSU4gVEhFIERCIDooXCIpO1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJWaWV3IElkOiBcIiArIHZpZXcudmlldyk7XG4gICAgICAgICAgY29uc29sZS5sb2coZS5zdGFjayk7XG4gICAgICAgICAgaXhlci5hcHBseURpZmYoUXVlcnkucmVtb3ZlKHZpZXcudmlldywgaXhlcikpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4ge307XG4gICAgfVxuICB9XG5cbiAgZXZlLmFkZFRhYmxlKFwidmlld1wiLCBbXCJ2aWV3XCIsIFwia2luZFwiXSk7XG4gIGV2ZS5hZGRUYWJsZShcImFjdGlvblwiLCBbXCJ2aWV3XCIsIFwiYWN0aW9uXCIsIFwia2luZFwiLCBcIml4XCJdKTtcbiAgZXZlLmFkZFRhYmxlKFwiYWN0aW9uIHNvdXJjZVwiLCBbXCJhY3Rpb25cIiwgXCJzb3VyY2Ugdmlld1wiXSk7XG4gIGV2ZS5hZGRUYWJsZShcImFjdGlvbiBtYXBwaW5nXCIsIFtcImFjdGlvblwiLCBcImZyb21cIiwgXCJ0byBzb3VyY2VcIiwgXCJ0byBmaWVsZFwiXSk7XG4gIGV2ZS5hZGRUYWJsZShcImFjdGlvbiBtYXBwaW5nIGNvbnN0YW50XCIsIFtcImFjdGlvblwiLCBcImZyb21cIiwgXCJ2YWx1ZVwiXSk7XG4gIGV2ZS5hZGRUYWJsZShcImFjdGlvbiBtYXBwaW5nIHNvcnRlZFwiLCBbXCJhY3Rpb25cIiwgXCJpeFwiLCBcInNvdXJjZVwiLCBcImZpZWxkXCIsIFwiZGlyZWN0aW9uXCJdKTtcbiAgZXZlLmFkZFRhYmxlKFwiYWN0aW9uIG1hcHBpbmcgbGltaXRcIiwgW1wiYWN0aW9uXCIsIFwibGltaXQgdHlwZVwiLCBcInZhbHVlXCJdKTtcblxuICBldmUudGFibGUoXCJ2aWV3XCIpLnRyaWdnZXJzW1wicmVjb21waWxlXCJdID0gcmVjb21waWxlVHJpZ2dlcjtcbiAgZXZlLnRhYmxlKFwiYWN0aW9uXCIpLnRyaWdnZXJzW1wicmVjb21waWxlXCJdID0gcmVjb21waWxlVHJpZ2dlcjtcbiAgZXZlLnRhYmxlKFwiYWN0aW9uIHNvdXJjZVwiKS50cmlnZ2Vyc1tcInJlY29tcGlsZVwiXSA9IHJlY29tcGlsZVRyaWdnZXI7XG4gIGV2ZS50YWJsZShcImFjdGlvbiBtYXBwaW5nXCIpLnRyaWdnZXJzW1wicmVjb21waWxlXCJdID0gcmVjb21waWxlVHJpZ2dlcjtcbiAgZXZlLnRhYmxlKFwiYWN0aW9uIG1hcHBpbmcgY29uc3RhbnRcIikudHJpZ2dlcnNbXCJyZWNvbXBpbGVcIl0gPSByZWNvbXBpbGVUcmlnZ2VyO1xuICBldmUudGFibGUoXCJhY3Rpb24gbWFwcGluZyBzb3J0ZWRcIikudHJpZ2dlcnNbXCJyZWNvbXBpbGVcIl0gPSByZWNvbXBpbGVUcmlnZ2VyO1xuICBldmUudGFibGUoXCJhY3Rpb24gbWFwcGluZyBsaW1pdFwiKS50cmlnZ2Vyc1tcInJlY29tcGlsZVwiXSA9IHJlY29tcGlsZVRyaWdnZXI7XG5cbiAgcmV0dXJuIGV2ZTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNvbXBpbGUoaXhlciwgdmlld0lkKSB7XG4gIGxldCB2aWV3ID0gaXhlci5maW5kT25lKFwidmlld1wiLCB7dmlldzogdmlld0lkfSk7XG4gIGlmKCF2aWV3KSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBObyB2aWV3IGZvdW5kIGZvciAke3ZpZXdJZH0uYCk7XG4gIH1cbiAgbGV0IGNvbXBpbGVkID0gaXhlclt2aWV3LmtpbmRdKHZpZXdJZCk7XG4gIGxldCBhY3Rpb25zID0gaXhlci5maW5kKFwiYWN0aW9uXCIsIHt2aWV3OiB2aWV3SWR9KTtcbiAgaWYoIWFjdGlvbnMpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYFZpZXcgJHt2aWV3SWR9IGhhcyBubyBhY3Rpb25zLmApO1xuICB9XG4gIC8vIHNvcnQgYWN0aW9ucyBieSBpeFxuICBhY3Rpb25zLnNvcnQoKGEsIGIpID0+IGEuaXggLSBiLml4KTtcbiAgZm9yKGxldCBhY3Rpb24gb2YgYWN0aW9ucykge1xuICAgIGxldCBhY3Rpb25LaW5kID0gYWN0aW9uLmtpbmQ7XG4gICAgaWYoYWN0aW9uS2luZCA9PT0gXCJsaW1pdFwiKSB7XG4gICAgICBsZXQgbGltaXQgPSB7fTtcbiAgICAgIGZvcihsZXQgbGltaXRNYXBwaW5nIG9mIGl4ZXIuZmluZChcImFjdGlvbiBtYXBwaW5nIGxpbWl0XCIsIHthY3Rpb246IGFjdGlvbi5hY3Rpb259KSkge1xuICAgICAgICBsaW1pdFtsaW1pdE1hcHBpbmdbXCJsaW1pdCB0eXBlXCJdXSA9IGxpbWl0TWFwcGluZ1tcInZhbHVlXCJdO1xuICAgICAgfVxuICAgICAgY29tcGlsZWQubGltaXQobGltaXQpO1xuICAgIH0gZWxzZSBpZihhY3Rpb25LaW5kID09PSBcInNvcnRcIiB8fCBhY3Rpb25LaW5kID09PSBcImdyb3VwXCIpIHtcbiAgICAgIGxldCBzb3J0ZWQgPSBbXTtcbiAgICAgIGxldCBtYXBwaW5ncyA9IGl4ZXIuZmluZChcImFjdGlvbiBtYXBwaW5nIHNvcnRlZFwiLCB7YWN0aW9uOiBhY3Rpb24uYWN0aW9ufSk7XG4gICAgICBtYXBwaW5ncy5zb3J0KChhLCBiKSA9PiBhLml4IC0gYi5peCk7XG4gICAgICBmb3IobGV0IG1hcHBpbmcgb2YgbWFwcGluZ3MpIHtcbiAgICAgICAgc29ydGVkLnB1c2goW21hcHBpbmdbXCJzb3VyY2VcIl0sIG1hcHBpbmdbXCJmaWVsZFwiXSwgbWFwcGluZ1tcImRpcmVjdGlvblwiXV0pO1xuICAgICAgfVxuICAgICAgaWYoc29ydGVkLmxlbmd0aCkge1xuICAgICAgICBjb21waWxlZFthY3Rpb25LaW5kXShzb3J0ZWQpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGAke2FjdGlvbktpbmR9IHdpdGhvdXQgYW55IG1hcHBpbmdzOiAke2FjdGlvbi5hY3Rpb259YClcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgbGV0IG1hcHBpbmdzID0gaXhlci5maW5kKFwiYWN0aW9uIG1hcHBpbmdcIiwge2FjdGlvbjogYWN0aW9uLmFjdGlvbn0pO1xuICAgICAgbGV0IG1hcHBpbmdPYmplY3QgPSB7fTtcbiAgICAgIGZvcihsZXQgbWFwcGluZyBvZiBtYXBwaW5ncykge1xuICAgICAgICBsZXQgc291cmNlID0gbWFwcGluZ1tcInRvIHNvdXJjZVwiXTtcbiAgICAgICAgbGV0IGZpZWxkID0gbWFwcGluZ1tcInRvIGZpZWxkXCJdO1xuICAgICAgICBpZihhY3Rpb25LaW5kID09PSBcInVuaW9uXCIgfHwgYWN0aW9uS2luZCA9PT0gXCJ1bnVuaW9uXCIpIHtcbiAgICAgICAgICBtYXBwaW5nT2JqZWN0W21hcHBpbmcuZnJvbV0gPSBbZmllbGRdO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIG1hcHBpbmdPYmplY3RbbWFwcGluZy5mcm9tXSA9IFtzb3VyY2UsIGZpZWxkXTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgbGV0IGNvbnN0YW50cyA9IGl4ZXIuZmluZChcImFjdGlvbiBtYXBwaW5nIGNvbnN0YW50XCIsIHthY3Rpb246IGFjdGlvbi5hY3Rpb259KTtcbiAgICAgIGZvcihsZXQgY29uc3RhbnQgb2YgY29uc3RhbnRzKSB7XG4gICAgICAgIG1hcHBpbmdPYmplY3RbY29uc3RhbnQuZnJvbV0gPSBjb25zdGFudC52YWx1ZTtcbiAgICAgIH1cbiAgICAgIGxldCBzb3VyY2UgPSBpeGVyLmZpbmRPbmUoXCJhY3Rpb24gc291cmNlXCIsIHthY3Rpb246IGFjdGlvbi5hY3Rpb259KTtcbiAgICAgIGlmKCFzb3VyY2UgJiYgYWN0aW9uS2luZCAhPT0gXCJwcm9qZWN0XCIpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGAke2FjdGlvbktpbmR9IGFjdGlvbiB3aXRob3V0IGEgc291cmNlIGluICcke3ZpZXdJZH0nYCk7XG4gICAgICB9XG4gICAgICBpZihhY3Rpb25LaW5kICE9PSBcInByb2plY3RcIikge1xuICAgICAgICBjb21waWxlZFthY3Rpb25LaW5kXShzb3VyY2VbXCJzb3VyY2Ugdmlld1wiXSwgbWFwcGluZ09iamVjdCwgYWN0aW9uLmFjdGlvbik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb21waWxlZFthY3Rpb25LaW5kXShtYXBwaW5nT2JqZWN0KTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmV0dXJuIGNvbXBpbGVkO1xufVxuXG4vLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuLy8gUHVibGljIEFQSVxuLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuZXhwb3J0IGNvbnN0IFNVQ0NFRUQgPSBbe3N1Y2Nlc3M6IHRydWV9XTtcbmV4cG9ydCBjb25zdCBGQUlMID0gW107XG5cbmV4cG9ydCBmdW5jdGlvbiBpbmRleGVyKCkge1xuICBsZXQgaXhlciA9IG5ldyBJbmRleGVyKCk7XG4gIGFkZFByb3ZlbmFuY2VUYWJsZShpeGVyKTtcbiAgYWRkUmVjb21waWxlVHJpZ2dlcnMoaXhlcik7XG4gIHJldHVybiBpeGVyO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY2xlYXJBbGxRdWVyaWVzKGV2ZSkge1xuICBsZXQgZmluYWxEaWZmID0gZXZlLmRpZmYoKTtcbiAgZm9yKGxldCBxdWVyeSBvZiBldmUuZmluZChcInF1ZXJ5IHRvIGlkXCIpKSB7XG4gICAgZmluYWxEaWZmLm1lcmdlKFF1ZXJ5LnJlbW92ZShxdWVyeS5pZCwgZXZlKSk7XG4gIH1cbiAgZmluYWxEaWZmLnJlbW92ZShcInF1ZXJ5IHRvIGlkXCIsIHt9KTtcbiAgZXZlLmFwcGx5RGlmZihmaW5hbERpZmYpO1xufVxuXG5pZihFTlYgPT09IFwiYnJvd3NlclwiKSB3aW5kb3dbXCJydW50aW1lXCJdID0gZXhwb3J0cztcbiIsImRlY2xhcmUgdmFyIHBsdXJhbGl6ZTsgLy8gQFRPRE86IGltcG9ydCBtZS5cblxuaW1wb3J0IHtwYXJzZSBhcyBtYXJrZWQsIFJlbmRlcmVyIGFzIE1hcmtlZFJlbmRlcmVyfSBmcm9tIFwiLi4vdmVuZG9yL21hcmtlZFwiO1xuaW1wb3J0ICogYXMgQ29kZU1pcnJvciBmcm9tIFwiY29kZW1pcnJvclwiO1xuaW1wb3J0IHtjb3B5LCB1dWlkLCBjb2VyY2VJbnB1dCwgYnVpbHRpbklkLCBhdXRvRm9jdXMsIEtFWVMsIG1lcmdlT2JqZWN0LCBzZXRFbmRPZkNvbnRlbnRFZGl0YWJsZSwgc2x1Z2lmeSwgbG9jYXRpb24gYXMgZ2V0TG9jYXRpb259IGZyb20gXCIuL3V0aWxzXCI7XG5pbXBvcnQge0RpZmYsIFF1ZXJ5fSBmcm9tIFwiLi9ydW50aW1lXCI7XG5pbXBvcnQge0VsZW1lbnQsIEhhbmRsZXIsIFJlbmRlckhhbmRsZXIsIFJlbmRlcmVyfSBmcm9tIFwiLi9taWNyb1JlYWN0XCI7XG5pbXBvcnQge2NyZWF0ZUVkaXRvcn0gZnJvbSBcIi4vcmljaFRleHRFZGl0b3JcIjtcbmltcG9ydCAqIGFzIHVpdGsgZnJvbSBcIi4vdWl0a1wiO1xuaW1wb3J0IHtuYXZpZ2F0ZSwgcHJldmVudERlZmF1bHR9IGZyb20gXCIuL3VpdGtcIjtcbmltcG9ydCB7ZXZlLCBldmVMb2NhbFN0b3JhZ2VLZXksIGhhbmRsZSBhcyBhcHBIYW5kbGUsIGRpc3BhdGNoLCBhY3RpdmVTZWFyY2hlcywgcmVuZGVyZXJ9IGZyb20gXCIuL2FwcFwiO1xuaW1wb3J0IHtwYXJzZURTTH0gZnJvbSBcIi4vcGFyc2VyXCI7XG5pbXBvcnQge3BhcnNlIGFzIG5scGFyc2UsIG5vcm1hbGl6ZVN0cmluZywgSW50ZW50cywgRnVuY3Rpb25UeXBlcywgTm9kZVR5cGVzLCBSZXN1bHQgYXMgTkxSZXN1bHR9IGZyb20gXCIuL05MUXVlcnlQYXJzZXJcIjtcblxuZGVjbGFyZSB2YXIgZ2E7XG5cbmV4cG9ydCBlbnVtIFBBTkUgeyBGVUxMLCBXSU5ET1csIFBPUE9VVCB9O1xuZW51bSBCTE9DSyB7IFRFWFQsIFBST0pFQ1RJT04gfTtcblxuLy8gQmVjYXVzZSBodG1sNSBpcyBmdWxsIG9mIGJyb2tlbiBwcm9taXNlcyBhbmQgYnJva2VuIGRyZWFtc1xudmFyIHBvcG91dEhpc3RvcnkgPSBbXTtcblxuLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbi8vIFN0YXRlXG4vLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuZXhwb3J0IGxldCB1aVN0YXRlOntcbiAgd2lkZ2V0OiB7XG4gICAgc2VhcmNoOiB7W3BhbmVJZDpzdHJpbmddOiB7dmFsdWU6c3RyaW5nLCBwbGFuPzpib29sZWFuLCBmb2N1c2VkPzpib29sZWFuLCBzdWJtaXR0ZWQ/OnN0cmluZ319LFxuICAgIHRhYmxlOiB7W2tleTpzdHJpbmddOiB7c29ydEZpZWxkOnN0cmluZywgc29ydERpcmVjdGlvbjpudW1iZXIsIGFkZGVycz86e31bXSwgY2hhbmdlcz86IHtmaWVsZDogc3RyaW5nLCBwcmV2OiBhbnksIHJvdzp7fSwgdmFsdWU6IGFueX1bXX19LFxuICAgIGNvbGxhcHNpYmxlOiB7W2tleTpzdHJpbmddOiB7b3Blbjpib29sZWFufX1cbiAgICBhdHRyaWJ1dGVzOiBhbnksXG4gICAgY2FyZDoge1trZXk6IHN0cmluZ106IGFueX0sXG4gIH0sXG4gIHBhbmU6IHtbcGFuZUlkOnN0cmluZ106IHtzZXR0aW5nczogYm9vbGVhbn19LFxuICBwcm9tcHQ6IHtvcGVuOiBib29sZWFuLCBwYW5lSWQ/OiBzdHJpbmcsIHByb21wdD86IChwYW5lSWQ/OnN0cmluZykgPT4gRWxlbWVudH0sXG59ID0ge1xuICB3aWRnZXQ6IHtcbiAgICBzZWFyY2g6IHt9LFxuICAgIHRhYmxlOiB7fSxcbiAgICBjb2xsYXBzaWJsZToge30sXG4gICAgYXR0cmlidXRlczoge30sXG4gICAgY2FyZDoge30sXG4gIH0sXG4gIHBhbmU6IHt9LFxuICBwcm9tcHQ6IHtvcGVuOiBmYWxzZSwgcGFuZUlkOiB1bmRlZmluZWQsIHByb21wdDogdW5kZWZpbmVkfSxcbn07XG5cbi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4vLyBVdGlsc1xuLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbi8vIEBOT1RFOiBpZHMgbXVzdCBub3QgY29udGFpbiB3aGl0ZXNwYWNlXG5leHBvcnQgZnVuY3Rpb24gYXNFbnRpdHkocmF3OnN0cmluZ3xudW1iZXIpOnN0cmluZyB7XG4gIGxldCBjbGVhbmVkID0gcmF3ICYmIChcIlwiK3JhdykudHJpbSgpO1xuICBpZighY2xlYW5lZCkgcmV0dXJuO1xuXG4gIGlmKGV2ZS5maW5kT25lKFwiZW50aXR5XCIsIHtlbnRpdHk6IGNsZWFuZWR9KSkgcmV0dXJuIGNsZWFuZWQ7XG4gIGNsZWFuZWQgPSBub3JtYWxpemVTdHJpbmcoY2xlYW5lZCk7XG4gIGlmKGV2ZS5maW5kT25lKFwiZW50aXR5XCIsIHtlbnRpdHk6IGNsZWFuZWR9KSkgcmV0dXJuIGNsZWFuZWQ7IC8vIFRoaXMgY2FuIGJlIHJlbW92ZWQgaWYgd2UgcmVtb3ZlIGNhcHMgZnJvbSBpZHMuIFVVSUR2NCBkb2VzIG5vdCB1c2UgY2FwcyBpbiBpZHNcbiAgbGV0IHtpZCA9IHVuZGVmaW5lZH0gPSBldmUuZmluZE9uZShcImluZGV4IG5hbWVcIiwge25hbWU6IGNsZWFuZWR9KSB8fCB7fTtcbiAgcmV0dXJuIGlkO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gc2V0VVJMKHBhbmVJZDpzdHJpbmcsIGNvbnRhaW5zOnN0cmluZywgcmVwbGFjZT86Ym9vbGVhbikge1xuICBsZXQgbmFtZSA9IHVpdGsucmVzb2x2ZU5hbWUoY29udGFpbnMpO1xuICBpZihwYW5lSWQgIT09IFwicDFcIikgcmV0dXJuOyAvLyBAVE9ETzogTWFrZSB0aGlzIGEgY29uc3RhbnRcbiAgXG4gIGxldCB1cmw7XG4gIGlmKGNvbnRhaW5zLmxlbmd0aCA9PT0gMCkgdXJsID0gXCIjXCI7XG4gIGVsc2UgaWYobmFtZSA9PT0gY29udGFpbnMpIHVybCA9IGAjL3NlYXJjaC8ke3NsdWdpZnkoY29udGFpbnMpfWA7XG4gIGVsc2UgdXJsID0gYCMvJHtzbHVnaWZ5KG5hbWUpfS8ke3NsdWdpZnkoY29udGFpbnMpfWA7XG4gIGxldCBzdGF0ZSA9IHtwYW5lSWQsIGNvbnRhaW5zfTtcbiAgd2luZG93W1wic3RhdGVzXCJdID0gd2luZG93W1wic3RhdGVzXCJdIHx8IFtdO1xuICB3aW5kb3dbXCJzdGF0ZXNcIl0ucHVzaChzdGF0ZSk7XG5cbiAgaWYocmVwbGFjZSkgd2luZG93Lmhpc3RvcnkucmVwbGFjZVN0YXRlKHN0YXRlLCBudWxsLCB1cmwpO1xuICBlbHNlIHdpbmRvdy5oaXN0b3J5LnB1c2hTdGF0ZShzdGF0ZSwgbnVsbCwgdXJsKTtcblxuICBoaXN0b3J5U3RhdGUgPSBzdGF0ZTtcbiAgaGlzdG9yeVVSTCA9IHVybDtcbiAgZ2EoJ3NlbmQnLCAncGFnZXZpZXcnLCB7XG4gICAgJ3BhZ2UnOiBsb2NhdGlvbi5wYXRobmFtZSArIGxvY2F0aW9uLnNlYXJjaCAgKyBsb2NhdGlvbi5oYXNoXG4gIH0pO1xufVxuXG5mdW5jdGlvbiBpbmZlclJlcHJlc2VudGF0aW9uKHNlYXJjaDpzdHJpbmd8bnVtYmVyLCBiYXNlUGFyYW1zOnt9ID0ge30pOntyZXA6c3RyaW5nLCBwYXJhbXM6e319IHtcbiAgbGV0IHBhcmFtcyA9IGNvcHkoYmFzZVBhcmFtcyk7XG4gIGxldCBlbnRpdHlJZCA9IGFzRW50aXR5KHNlYXJjaCk7XG4gIGxldCBjbGVhbmVkID0gKHNlYXJjaCAmJiAoXCJcIitzZWFyY2gpLnRyaW0oKS50b0xvd2VyQ2FzZSgpKSB8fCBcIlwiO1xuICBpZihlbnRpdHlJZCB8fCBjbGVhbmVkLmxlbmd0aCA9PT0gMCkge1xuICAgIGxldCByZXAgPSBcImVudGl0eVwiO1xuICAgIHBhcmFtcy5lbnRpdHkgPSBlbnRpdHlJZCB8fCBidWlsdGluSWQoXCJob21lXCIpO1xuICAgIGlmKHBhcmFtcy5lbnRpdHkgPT09IGJ1aWx0aW5JZChcImhvbWVcIikpIHtcbiAgICAgIHJlcCA9IFwiZGlyZWN0b3J5XCI7XG4gICAgICAvLyBwYXJhbXMudW53cmFwcGVkID0gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuIHtyZXAsIHBhcmFtc307XG4gIH1cblxuICBsZXQgW3Jhd0NvbnRlbnQsIHJhd1BhcmFtc10gPSBjbGVhbmVkLnNwbGl0KFwifFwiKTtcbiAgbGV0IHBhcnNlZFBhcmFtcyA9IGdldENlbGxQYXJhbXMocmF3Q29udGVudCwgcmF3UGFyYW1zKTtcbiAgcGFyYW1zID0gbWVyZ2VPYmplY3QocGFyYW1zLCBwYXJzZWRQYXJhbXMpO1xuICBpZihwYXJhbXMucmVwID09PSBcInRhYmxlXCIpIHtcbiAgICBwYXJhbXMuc2VhcmNoID0gY2xlYW5lZDtcbiAgfVxuICByZXR1cm4ge3JlcDogcGFyYW1zLnJlcCwgcGFyYW1zfTtcbn1cblxuZnVuY3Rpb24gc3RhdGljT3JNYXBwZWRUYWJsZShzZWFyY2g6c3RyaW5nLCBwYXJhbXMpIHtcbiAgbGV0IHBhcnNlZCA9IHNhZmVOTFBhcnNlKHNlYXJjaCk7XG4gIGxldCB0b3BQYXJzZSA9IHBhcnNlZFswXTtcbiAgY29uc29sZS5sb2codG9wUGFyc2UpO1xuICBwYXJhbXMucmVwID0gXCJ0YWJsZVwiO1xuICBwYXJhbXMuc2VhcmNoID0gc2VhcmNoO1xuICAvLyBATk9URTogVGhpcyByZXF1aXJlcyB0aGUgZmlyc3QgcHJvamVjdCB0byBiZSB0aGUgbWFpbiByZXN1bHQgb2YgdGhlIHNlYXJjaFxuICBwYXJhbXMuZmllbGRzID0gdG9wUGFyc2UucXVlcnkucHJvamVjdHNbMF0uZmllbGRzLm1hcCgoZmllbGQpID0+IGZpZWxkLm5hbWUpO1xuICBwYXJhbXMuZ3JvdXBzID0gdG9wUGFyc2UuY29udGV4dC5ncm91cGluZ3MubWFwKChncm91cCkgPT4ge1xuICAgIC8vIEBGSVhNRTogVGhpcyBuZWVkcyB0byByZWFsbHkgY29tZSBvZmYgdGhlIGdyb3VwIGl0c2VsZi5cbiAgICBpZihncm91cC5hdHRyaWJ1dGUpIHJldHVybiBncm91cC5hdHRyaWJ1dGUucHJvamVjdGVkQXM7XG4gICAgaWYoZ3JvdXAuZW50aXR5KSByZXR1cm4gZ3JvdXAuZW50aXR5LnByb2plY3RlZEFzO1xuICAgIGlmKGdyb3VwLmNvbGxlY3Rpb24pIHJldHVybiBncm91cC5jb2xsZWN0aW9uLnByb2plY3RlZEFzO1xuICAgIGlmKGdyb3VwLmZ4bikgcmV0dXJuIGdyb3VwLmZ4bi5wcm9qZWN0ZWRBcztcbiAgICBlbHNlIHJldHVybiBncm91cC5uYW1lO1xuICB9KTtcbiAgLy9wYXJhbXMuZmllbGRzID0gdWl0ay5nZXRGaWVsZHMoe2V4YW1wbGU6IHJlc3VsdHNbMF0sIGJsYWNrbGlzdDogW1wiX19pZFwiXX0pO1xuXG4gIGlmKCF0b3BQYXJzZSB8fCB0b3BQYXJzZS5pbnRlbnQgIT09IEludGVudHMuUVVFUlkpIHJldHVybiBwYXJhbXM7XG5cbiAgLy8gTXVzdCBub3QgY29udGFpbiBhbnkgcHJpbWl0aXZlIHJlbGF0aW9uc1xuICBsZXQgZWRpdGFibGUgPSB0cnVlO1xuICBsZXQgc3ViamVjdDtcbiAgbGV0IGVudGl0eTtcbiAgbGV0IGZpZWxkTWFwOntbZmllbGQ6c3RyaW5nXTogc3RyaW5nfSA9IHt9O1xuICBsZXQgY29sbGVjdGlvbnM6c3RyaW5nW10gPSBbXTtcbiAgZm9yKGxldCBjdHggaW4gdG9wUGFyc2UuY29udGV4dCkge1xuICAgIGlmKGN0eCA9PT0gXCJhdHRyaWJ1dGVzXCIgfHwgY3R4ID09PSBcImVudGl0aWVzXCIgfHwgY3R4ID09PSBcImNvbGxlY3Rpb25zXCIpIGNvbnRpbnVlO1xuICAgIGZvcihsZXQgbm9kZSBvZiB0b3BQYXJzZS5jb250ZXh0W2N0eF0pIHtcbiAgICAgIGlmKG5vZGUuZnhuICYmIG5vZGUuZnhuLnByb2plY3QpIHtcbiAgICAgICAgZWRpdGFibGUgPSBmYWxzZTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIFxuICAvLyBOdW1iZXIgb2Ygc3ViamVjdHMgKHByb2plY3RlZCBlbnRpdGllcyBvciBjb2xsZWN0aW9ucykgbXVzdCBiZSAxLlxuICBpZihlZGl0YWJsZSkge1xuICAgIGZvcihsZXQgbm9kZSBvZiB0b3BQYXJzZS5jb250ZXh0LmNvbGxlY3Rpb25zKSB7XG4gICAgICBsZXQgY29sbCA9IG5vZGUuY29sbGVjdGlvbjtcbiAgICAgIGlmKGNvbGwucHJvamVjdCkge1xuICAgICAgICBpZihzdWJqZWN0KSB7XG4gICAgICAgICAgZWRpdGFibGUgPSBmYWxzZTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBzdWJqZWN0ID0gY29sbC5wcm9qZWN0ZWRBcztcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgY29sbGVjdGlvbnMucHVzaChjb2xsLmlkKTtcbiAgICB9XG4gIH1cbiAgaWYoZWRpdGFibGUpIHtcbiAgICBmb3IobGV0IG5vZGUgb2YgdG9wUGFyc2UuY29udGV4dC5lbnRpdGllcykge1xuICAgICAgbGV0IGVudCA9IG5vZGUuZW50aXR5O1xuICAgICAgaWYoZW50LnByb2plY3QpIHtcbiAgICAgICAgaWYoc3ViamVjdCkge1xuICAgICAgICAgIGVkaXRhYmxlID0gZmFsc2U7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgc3ViamVjdCA9IGVudC5wcm9qZWN0ZWRBcztcbiAgICAgICAgICBlbnRpdHkgPSBlbnQuaWQ7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBpZihlZGl0YWJsZSkge1xuICAgIGZvcihsZXQgbm9kZSBvZiB0b3BQYXJzZS5jb250ZXh0LmF0dHJpYnV0ZXMpIHtcbiAgICAgIGxldCBhdHRyID0gbm9kZS5hdHRyaWJ1dGU7XG4gICAgICBpZihhdHRyLnByb2plY3QpIHtcbiAgICAgICAgZmllbGRNYXBbYXR0ci5wcm9qZWN0ZWRBc10gPSBhdHRyLmlkO1xuICAgICAgfVxuICAgIH1cbiAgICBpZihlbnRpdHkgJiYgT2JqZWN0LmtleXMoZmllbGRNYXApLmxlbmd0aCAhPT0gMSkgZWRpdGFibGUgPSBmYWxzZTtcbiAgfVxuXG4gIGlmKGVkaXRhYmxlKSB7XG4gICAgcGFyYW1zLnJlcCA9IFwibWFwcGVkVGFibGVcIjtcbiAgICBwYXJhbXMuc3ViamVjdCA9IHN1YmplY3Q7XG4gICAgcGFyYW1zLmVudGl0eSA9IGVudGl0eTtcbiAgICBwYXJhbXMuZmllbGRNYXAgPSBmaWVsZE1hcDtcbiAgICBwYXJhbXMuY29sbGVjdGlvbnMgPSBjb2xsZWN0aW9ucztcbiAgICBjb25zb2xlLmxvZyhcIk1BUFBFRCBQQVJBTVNcIiwgcGFyYW1zKTtcbiAgICByZXR1cm4gcGFyYW1zO1xuICB9XG5cbiAgcmV0dXJuIHBhcmFtcztcbn1cblxuZnVuY3Rpb24gc2FmZU5MUGFyc2UocXVlcnkpOk5MUmVzdWx0W10ge1xuICB0cnkge1xuICAgIHJldHVybiBubHBhcnNlKHF1ZXJ5KTtcbiAgfSBjYXRjaChlKSB7XG4gICAgY29uc29sZS5lcnJvcihcIk5MUGFyc2UgZXJyb3JcIik7XG4gICAgY29uc29sZS5lcnJvcihlKTtcbiAgICByZXR1cm4gWzxOTFJlc3VsdD48YW55PntpbnRlbnQ6IEludGVudHMuTk9SRVNVTFQsIGNvbnRleHQ6IHt9LCBxdWVyeToge30sIHByb2plY3RzOiB7fX1dO1xuICB9XG59XG5cbi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4vLyBEaXNwYXRjaGVzXG4vLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG5hcHBIYW5kbGUoXCJ1aSB1cGRhdGUgc2VhcmNoXCIsIChjaGFuZ2VzOiBEaWZmLCB7cGFuZUlkLCB2YWx1ZX0pID0+IHtcbiAgbGV0IHN0YXRlID0gdWlTdGF0ZS53aWRnZXQuc2VhcmNoW3BhbmVJZF0gPSB1aVN0YXRlLndpZGdldC5zZWFyY2hbcGFuZUlkXSB8fCB7dmFsdWV9O1xuICBzdGF0ZS52YWx1ZSA9IHZhbHVlO1xufSlcblxuYXBwSGFuZGxlKFwidWkgZm9jdXMgc2VhcmNoXCIsIChjaGFuZ2VzOkRpZmYsIHtwYW5lSWQsIHZhbHVlfTp7cGFuZUlkOnN0cmluZywgdmFsdWU6c3RyaW5nfSkgPT4ge1xuICBsZXQgc3RhdGUgPSB1aVN0YXRlLndpZGdldC5zZWFyY2hbcGFuZUlkXSA9IHVpU3RhdGUud2lkZ2V0LnNlYXJjaFtwYW5lSWRdIHx8IHt2YWx1ZX07XG4gIHN0YXRlLmZvY3VzZWQgPSB0cnVlO1xufSk7XG5cblxuLy8gQFRPRE86IGFic3RyYWN0IChzZWFyY2gpID0+IHtyZXAsIHBhcmFtc30gZm4gYW5kIHVzZSBpdCB0byBpbmZlciB7cmVwLCBwYXJhbXN9IGZvciBzZXQgcGFuZSBhbmQgc2V0IHBvcG91dC5cbi8vIEBUT0RPOiBVcGRhdGUgcGFuZShwYW5lSWQpIHRvIHRha2UgdGhlIGFjdHVhbCBwYW5lIGZhY3Qgc28gaXQncyBub3QgdGllZCB0byB0aGUgREIuXG4vLyBAVE9ETzogVXBkYXRlIHBhbmUocGFuZSkgdG8ganVzdCBkaXJlY3RseSBjYWxsIHJlcHJlc2VudCB3aXRoIHRoZSBwYW5lJ3MgZmFjdHMuXG5cblxuYXBwSGFuZGxlKFwic2V0IHBhbmVcIiwgKGNoYW5nZXM6RGlmZiwgaW5mbzp7cGFuZUlkOnN0cmluZywga2luZD86UEFORSwgcmVwPzpzdHJpbmcsIGNvbnRhaW5zPzpzdHJpbmd8bnVtYmVyLCBwYXJhbXM/OnN0cmluZ3x7fSwgcG9wU3RhdGU/OmJvb2xlYW59KSA9PiB7XG4gIC8vIEluZmVyIHZhbGlkIHJlcCBhbmQgcGFyYW1zIGlmIHNlYXJjaCBoYXMgY2hhbmdlZFxuICBpZihpbmZvLmNvbnRhaW5zICE9PSB1bmRlZmluZWQgJiYgIWluZm8ucmVwKSB7XG4gICAgbGV0IGluZmVycmVkID0gaW5mZXJSZXByZXNlbnRhdGlvbihpbmZvLmNvbnRhaW5zLCB0eXBlb2YgaW5mby5wYXJhbXMgPT09IFwic3RyaW5nXCIgPyBwYXJzZVBhcmFtcyg8c3RyaW5nPmluZm8ucGFyYW1zKSA6IGluZm8ucGFyYW1zKTtcbiAgICBpbmZvLnJlcCA9IGluZmVycmVkLnJlcDtcbiAgICBpbmZvLnBhcmFtcyA9IGluZmVycmVkLnBhcmFtcztcbiAgICBpZighaW5mby5yZXApIHRocm93IG5ldyBFcnJvcihgQ291bGQgbm90IGluZmVyIGEgdmFsaWQgcmVwcmVzZW50YXRpb24gZm9yIHNlYXJjaCAnJHtpbmZvLmNvbnRhaW5zfScgaW4gcGFuZSAnJHtpbmZvLnBhbmVJZH0nYCk7XG4gIH1cblxuICAvLyBGaWxsIG1pc3NpbmcgcHJvcGVydGllcyBmcm9tIHRoZSBwcmV2aW91cyBmYWN0LCBpZiBwcmVzZW50XG4gIGxldCBwcmV2ID0gZXZlLmZpbmRPbmUoXCJ1aSBwYW5lXCIsIHtwYW5lOiBpbmZvLnBhbmVJZH0pIHx8IHt9O1xuICBsZXQge3BhbmVJZCwga2luZCA9IHByZXYua2luZCwgcmVwID0gcHJldi5yZXAsIGNvbnRhaW5zOnJhdyA9IHByZXYuY29udGFpbnMsIHBhcmFtczpyYXdQYXJhbXMgPSBwcmV2LnBhcmFtcywgcG9wU3RhdGUgPSBmYWxzZX0gPSBpbmZvO1xuICBpZihraW5kID09PSB1bmRlZmluZWQgfHwgcmVwID09IHVuZGVmaW5lZCB8fCByYXcgPT09IHVuZGVmaW5lZCB8fCByYXdQYXJhbXMgPT09IHVuZGVmaW5lZCkge1xuICAgIHRocm93IG5ldyBFcnJvcihgQ2Fubm90IGNyZWF0ZSBuZXcgcGFuZSB3aXRob3V0IGFsbCBwYXJhbWV0ZXJzIHNwZWNpZmllZCBmb3IgcGFuZSAnJHtwYW5lSWR9J2ApO1xuICB9XG4gIFxuICBsZXQgY29udGFpbnMgPSBhc0VudGl0eShyYXcpIHx8IChcIlwiK3JhdykudHJpbSgpO1xuICBsZXQgcGFyYW1zID0gdHlwZW9mIHJhd1BhcmFtcyA9PT0gXCJvYmplY3RcIiA/IHN0cmluZ2lmeVBhcmFtcyhyYXdQYXJhbXMpIDogcmF3UGFyYW1zIHx8IFwiXCI7XG4gIGxldCBzdGF0ZSA9IHVpU3RhdGUud2lkZ2V0LnNlYXJjaFtwYW5lSWRdID0gdWlTdGF0ZS53aWRnZXQuc2VhcmNoW3BhbmVJZF0gfHwge3ZhbHVlOiBjb250YWlucywgZm9jdXNlZDogZmFsc2V9O1xuICBzdGF0ZS52YWx1ZSA9IGNvbnRhaW5zO1xuICBzdGF0ZS5mb2N1c2VkID0gZmFsc2U7XG4gIGRpc3BhdGNoKFwicmVtb3ZlIHBhbmVcIiwge3BhbmVJZH0sIGNoYW5nZXMpO1xuICBjaGFuZ2VzLmFkZChcInVpIHBhbmVcIiwge3BhbmU6cGFuZUlkLCBraW5kLCByZXAsIGNvbnRhaW5zLCBwYXJhbXN9KTtcblxuICAvLyBAVE9ETzogTWFrZSBcInAxXCIgYSBjb25zdGFudFxuICBpZihwYW5lSWQgPT09IFwicDFcIikge1xuICAgIHBvcG91dEhpc3RvcnkgPSBbXTtcbiAgICBpZighcG9wU3RhdGUpIHNldFVSTChwYW5lSWQsIGNvbnRhaW5zKTtcbiAgfVxufSk7XG5cbmFwcEhhbmRsZShcInJlbW92ZSBwYW5lXCIsIChjaGFuZ2VzOkRpZmYsIHtwYW5lSWR9OntwYW5lSWQ6c3RyaW5nfSkgPT4ge1xuICBsZXQgY2hpbGRyZW4gPSBldmUuZmluZChcInVpIHBhbmUgcGFyZW50XCIsIHtwYXJlbnQ6IHBhbmVJZH0pO1xuICBmb3IobGV0IHtwYW5lOmNoaWxkfSBvZiBjaGlsZHJlbikge1xuICAgIGRpc3BhdGNoKFwicmVtb3ZlIHBhbmVcIiwge3BhbmVJZDogY2hpbGR9LCBjaGFuZ2VzKTtcbiAgfVxuICBjaGFuZ2VzLnJlbW92ZShcInVpIHBhbmVcIiwge3BhbmU6IHBhbmVJZH0pXG4gICAgLnJlbW92ZShcInVpIHBhbmUgcG9zaXRpb25cIiwge3BhbmU6IHBhbmVJZH0pXG4gICAgLnJlbW92ZShcInVpIHBhbmUgcGFyZW50XCIsIHtwYXJlbnQ6IHBhbmVJZH0pXG4gICAgLnJlbW92ZShcInVpIHBhbmUgcGFyZW50XCIsIHtwYW5lOiBwYW5lSWR9KTtcbn0pO1xuXG5hcHBIYW5kbGUoXCJzZXQgcG9wb3V0XCIsIChjaGFuZ2VzOkRpZmYsIGluZm86e3BhcmVudElkOnN0cmluZywgcmVwPzpzdHJpbmcsIGNvbnRhaW5zPzpzdHJpbmd8bnVtYmVyLCBwYXJhbXM/OnN0cmluZ3x7fSwgeDpzdHJpbmd8bnVtYmVyLCB5OnN0cmluZ3xudW1iZXIsIHBvcFN0YXRlPzpib29sZWFufSkgPT4ge1xuICAvLyBSZWN5Y2xlIHRoZSBwYXJlbnQncyBleGlzdGluZyBwb3BvdXQgaWYgaXQgZXhpc3RzLCBvdGhlcndpc2UgY3JlYXRlIGEgbmV3IG9uZVxuICBsZXQgcGFyZW50SWQgPSBpbmZvLnBhcmVudElkO1xuICBsZXQgcGFuZUlkID0gdXVpZCgpO1xuICBsZXQgY2hpbGRyZW4gPSBldmUuZmluZChcInVpIHBhbmUgcGFyZW50XCIsIHtwYXJlbnQ6IHBhcmVudElkfSk7XG4gIGxldCBwYXJlbnQgPSBldmUuZmluZE9uZShcInVpIHBhbmVcIiwge3BhbmU6IHBhcmVudElkfSk7XG4gIHZhciByZXVzaW5nID0gZmFsc2U7XG4gIC8vIGlmKHBhcmVudCAmJiBwYXJlbnQua2luZCA9PT0gUEFORS5QT1BPVVQpIHtcbiAgLy8gICByZXVzaW5nID0gdHJ1ZTtcbiAgLy8gICBwYW5lSWQgPSBwYXJlbnRJZDtcbiAgLy8gICBwYXJlbnRJZCA9IGV2ZS5maW5kT25lKFwidWkgcGFuZSBwYXJlbnRcIiwge3BhbmU6IHBhcmVudElkfSkucGFyZW50O1xuICAvLyB9IGVsc2UgXG4gICAgaWYoY2hpbGRyZW4ubGVuZ3RoKSB7XG4gICAgLy9jaGVjayBpZiB0aGVyZSBpcyBhbHJlYWR5IGEgY2hpbGQgcG9wb3V0XG4gICAgZm9yKGxldCBjaGlsZFJlbCBvZiBjaGlsZHJlbikge1xuICAgICAgbGV0IGNoaWxkID0gZXZlLmZpbmRPbmUoXCJ1aSBwYW5lXCIsIHtwYW5lOiBjaGlsZFJlbC5wYW5lfSk7XG4gICAgICBpZihjaGlsZC5raW5kID09PSBQQU5FLlBPUE9VVCkge1xuICAgICAgICBwYW5lSWQgPSBjaGlsZC5wYW5lO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvLyBJbmZlciB2YWxpZCByZXAgYW5kIHBhcmFtcyBpZiBzZWFyY2ggaGFzIGNoYW5nZWRcbiAgaWYoaW5mby5jb250YWlucyAmJiAhaW5mby5yZXApIHtcbiAgICBsZXQgaW5mZXJyZWQgPSBpbmZlclJlcHJlc2VudGF0aW9uKGluZm8uY29udGFpbnMsIHR5cGVvZiBpbmZvLnBhcmFtcyA9PT0gXCJzdHJpbmdcIiA/IHBhcnNlUGFyYW1zKDxzdHJpbmc+aW5mby5wYXJhbXMpIDogaW5mby5wYXJhbXMpO1xuICAgIGluZm8ucmVwID0gaW5mZXJyZWQucmVwO1xuICAgIGluZm8ucGFyYW1zID0gaW5mZXJyZWQucGFyYW1zO1xuICAgIGlmKCFpbmZvLnJlcCkgdGhyb3cgbmV3IEVycm9yKGBDb3VsZCBub3QgaW5mZXIgYSB2YWxpZCByZXByZXNlbnRhdGlvbiBmb3Igc2VhcmNoICcke2luZm8uY29udGFpbnN9JyBpbiBwb3BvdXQgJyR7cGFuZUlkfSdgKTtcbiAgfVxuXG4gIC8vIEZpbGwgbWlzc2luZyBwcm9wZXJ0aWVzIGZyb20gdGhlIHByZXZpb3VzIGZhY3QsIGlmIHByZXNlbnRcbiAgbGV0IHByZXYgPSBldmUuZmluZE9uZShcInVpIHBhbmVcIiwge3BhbmU6IHBhbmVJZH0pIHx8IHt9O1xuICBsZXQgcHJldlBvcyA9IGV2ZS5maW5kT25lKFwidWkgcGFuZSBwb3NpdGlvblwiLCB7cGFuZTogcGFuZUlkfSkgfHwge307XG4gIGxldCB7cmVwID0gcHJldi5yZXAsIGNvbnRhaW5zOnJhdyA9IHByZXYuY29udGFpbnMsIHBhcmFtczpyYXdQYXJhbXMgPSBwcmV2LnBhcmFtcywgeCA9IHByZXZQb3MueCwgeSA9IHByZXZQb3MueSwgcG9wU3RhdGUgPSBmYWxzZX0gPSBpbmZvO1xuICBpZihyZXAgPT09IHVuZGVmaW5lZCB8fCByYXcgPT09IHVuZGVmaW5lZCB8fCByYXdQYXJhbXMgPT09IHVuZGVmaW5lZCB8fCB4ID09PSB1bmRlZmluZWQgfHwgeSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBDYW5ub3QgY3JlYXRlIG5ldyBwb3BvdXQgd2l0aG91dCBhbGwgcGFyYW1ldGVycyBzcGVjaWZpZWQgZm9yIHBhbmUgJyR7cGFuZUlkfSdgKTtcbiAgfVxuXG4gIGlmKHJldXNpbmcpIHtcbiAgICB4ID0gcHJldlBvcy54O1xuICAgIHkgPSBwcmV2UG9zLnk7XG4gIH1cblxuICBsZXQgcGFyYW1zID0gdHlwZW9mIHJhd1BhcmFtcyA9PT0gXCJzdHJpbmdcIiA/IHJhd1BhcmFtcyA6IHN0cmluZ2lmeVBhcmFtcyhyYXdQYXJhbXMpO1xuICBsZXQgY29udGFpbnMgPSBhc0VudGl0eShyYXcpIHx8IChcIlwiK3JhdykudHJpbSgpO1xuXG4gIGlmKCFwb3BTdGF0ZSAmJiBwcmV2LnBhbmUpIHBvcG91dEhpc3RvcnkucHVzaCh7cmVwOiBwcmV2LnJlcCwgY29udGFpbnM6IHByZXYuY29udGFpbnMsIHBhcmFtczogcHJldi5wYXJhbXMsIHg6IHByZXZQb3MueCwgeTogcHJldlBvcy55fSk7XG4gIGRpc3BhdGNoKFwicmVtb3ZlIHBhbmVcIiwge3BhbmVJZH0sIGNoYW5nZXMpO1xuICBjaGFuZ2VzLmFkZChcInVpIHBhbmVcIiwge3BhbmU6IHBhbmVJZCwga2luZDogUEFORS5QT1BPVVQsIHJlcCwgY29udGFpbnMsIHBhcmFtc30pXG4gICAgLmFkZChcInVpIHBhbmUgcGFyZW50XCIsIHtwYXJlbnQ6IHBhcmVudElkLCBwYW5lOiBwYW5lSWR9KVxuICAgIC5hZGQoXCJ1aSBwYW5lIHBvc2l0aW9uXCIsIHtwYW5lOiBwYW5lSWQsIHgsIHl9KTtcbn0pO1xuXG4vLyBAVE9ETzogdGFrZSBwYXJlbnRJZFxuYXBwSGFuZGxlKFwicmVtb3ZlIHBvcHVwXCIsIChjaGFuZ2VzOkRpZmYsIHt9Ont9KSA9PiB7XG4gIGxldCBwb3B1cCA9IGV2ZS5maW5kT25lKFwidWkgcGFuZVwiLCB7a2luZDogUEFORS5QT1BPVVR9KTtcbiAgaWYocG9wdXApIGRpc3BhdGNoKFwicmVtb3ZlIHBhbmVcIiwge3BhbmVJZDogcG9wdXAucGFuZX0sIGNoYW5nZXMpO1xuICBwb3BvdXRIaXN0b3J5ID0gW107XG59KTtcblxuYXBwSGFuZGxlKFwiY2xvc2UgY2FyZFwiLCAoY2hhbmdlcywge3BhbmVJZH0pID0+IHtcbiAgaWYoZXZlLmZpbmRPbmUoXCJ1aSBwYW5lXCIsIHtwYW5lOiBwYW5lSWR9KS5raW5kID09PSBQQU5FLkZVTEwpIHtcbiAgICBjaGFuZ2VzLmRpc3BhdGNoKFwic2V0IHBhbmVcIiwge3BhbmVJZCwgY29udGFpbnM6IFwiXCJ9KTtcbiAgfSBlbHNlIHtcbiAgICBjaGFuZ2VzLmRpc3BhdGNoKFwicmVtb3ZlIHBhbmVcIiwge3BhbmVJZH0pO1xuICB9XG59KTtcblxuYXBwSGFuZGxlKFwidWkgdG9nZ2xlIHNlYXJjaCBwbGFuXCIsIChjaGFuZ2VzOkRpZmYsIHtwYW5lSWR9OntwYW5lSWQ6c3RyaW5nfSkgPT4ge1xuICBsZXQgc3RhdGUgPSB1aVN0YXRlLndpZGdldC5zZWFyY2hbcGFuZUlkXSA9IHVpU3RhdGUud2lkZ2V0LnNlYXJjaFtwYW5lSWRdIHx8IHt2YWx1ZTogXCJcIn07XG4gIHN0YXRlLnBsYW4gPSAhc3RhdGUucGxhbjtcbn0pO1xuXG5hcHBIYW5kbGUoXCJhZGQgc291cmNlZCBlYXZcIiwgKGNoYW5nZXMsIGVhdjp7ZW50aXR5OnN0cmluZywgYXR0cmlidXRlOnN0cmluZywgdmFsdWU6c3RyaW5nfG51bWJlciwgc291cmNlOnN0cmluZywgZm9yY2VFbnRpdHk6IGJvb2xlYW59KSA9PiB7XG4gIGxldCB7ZW50aXR5LCBhdHRyaWJ1dGU6YXR0ck5hbWUsIHZhbHVlLCBzb3VyY2UsIGZvcmNlRW50aXR5fSA9IGVhdjtcbiAgaWYoIXNvdXJjZSkge1xuICAgIHNvdXJjZSA9IHV1aWQoKTtcbiAgfVxuICBsZXQgYXR0cmlidXRlID0gbm9ybWFsaXplU3RyaW5nKGF0dHJOYW1lKTtcbiAgbGV0IHZhbHVlSWQgPSBhc0VudGl0eSh2YWx1ZSk7XG4gIGxldCBjb2VyY2VkID0gY29lcmNlSW5wdXQodmFsdWUpO1xuICBsZXQgc3RyVmFsdWUgPSB2YWx1ZS50b1N0cmluZygpLnRyaW0oKTtcbiAgaWYodmFsdWVJZCkge1xuICAgIHZhbHVlID0gdmFsdWVJZDtcbiAgfSBlbHNlIGlmKHN0clZhbHVlWzBdID09PSAnXCInICYmIHN0clZhbHVlW3N0clZhbHVlLmxlbmd0aCAtIDFdID09PSAnXCInKSB7XG4gICAgdmFsdWUgPSBKU09OLnBhcnNlKHN0clZhbHVlKTtcbiAgfSBlbHNlIGlmKHR5cGVvZiBjb2VyY2VkID09PSBcIm51bWJlclwiKSB7XG4gICAgdmFsdWUgPSBjb2VyY2VkO1xuICB9IGVsc2UgaWYoZm9yY2VFbnRpdHkgfHwgYXR0cmlidXRlID09PSBcImlzIGFcIikge1xuICAgIGxldCBuZXdFbnRpdHkgPSB1dWlkKCk7XG4gICAgbGV0IHBhZ2VJZCA9IHV1aWQoKTtcbiAgICBjaGFuZ2VzLmRpc3BhdGNoKFwiY3JlYXRlIHBhZ2VcIiwge3BhZ2U6IHBhZ2VJZCwgIGNvbnRlbnQ6IFwiXCJ9KVxuICAgICAgICAgICAuZGlzcGF0Y2goXCJjcmVhdGUgZW50aXR5XCIsIHtlbnRpdHk6IG5ld0VudGl0eSwgbmFtZTogc3RyVmFsdWUsIHBhZ2U6IHBhZ2VJZH0pO1xuICAgIHZhbHVlID0gbmV3RW50aXR5O1xuICB9IGVsc2Uge1xuICAgIHZhbHVlID0gY29lcmNlZDtcbiAgfVxuICBjaGFuZ2VzLmFkZChcInNvdXJjZWQgZWF2XCIsIHtlbnRpdHksIGF0dHJpYnV0ZSwgdmFsdWUsIHNvdXJjZX0pXG4gICAgLnJlbW92ZShcImRpc3BsYXkgbmFtZVwiLCB7aWQ6IGF0dHJpYnV0ZX0pXG4gICAgLmFkZChcImRpc3BsYXkgbmFtZVwiLCB7aWQ6IGF0dHJpYnV0ZSwgbmFtZTogYXR0ck5hbWV9KTtcbn0pO1xuXG5hcHBIYW5kbGUoXCJyZW1vdmUgc291cmNlZCBlYXZcIiwgKGNoYW5nZXM6RGlmZiwgZWF2OntlbnRpdHk6c3RyaW5nLCBzb3VyY2U6c3RyaW5nfSkgPT4ge1xuICAgIGNoYW5nZXMucmVtb3ZlKFwic291cmNlZCBlYXZcIiwgZWF2KTtcbn0pO1xuIFxuYXBwSGFuZGxlKFwidXBkYXRlIHBhZ2VcIiwgKGNoYW5nZXM6RGlmZiwge3BhZ2UsIGNvbnRlbnR9OiB7cGFnZTogc3RyaW5nLCBjb250ZW50OiBzdHJpbmd9KSA9PiB7XG4gIGNoYW5nZXMucmVtb3ZlKFwicGFnZSBjb250ZW50XCIsIHtwYWdlfSk7XG4gIGNoYW5nZXMuYWRkKFwicGFnZSBjb250ZW50XCIsIHtwYWdlLCBjb250ZW50fSk7XG4gIC8vIGxldCB0cmltbWVkID0gY29udGVudC50cmltKCk7XG4gIC8vIGxldCBlbmRJeCA9IHRyaW1tZWQuaW5kZXhPZihcIlxcblwiKTtcbiAgLy8gbGV0IG5hbWUgPSB0cmltbWVkLnNsaWNlKDEsIGVuZEl4ICE9PSAtMSA/IGVuZEl4IDogdW5kZWZpbmVkKS50cmltKCk7XG4gIC8vIGxldCB7ZW50aXR5fSA9IGV2ZS5maW5kT25lKFwiZW50aXR5IHBhZ2VcIiwge3BhZ2V9KTtcbiAgLy8gbGV0IHtuYW1lOnByZXZOYW1lID0gdW5kZWZpbmVkfSA9IGV2ZS5maW5kT25lKFwiZGlzcGxheSBuYW1lXCIsIHtpZDogZW50aXR5fSkgfHwge307XG4gIC8vIGlmKG5hbWUgIT09IHByZXZOYW1lKSB7XG4gIC8vICAgY2hhbmdlcy5yZW1vdmUoXCJkaXNwbGF5IG5hbWVcIiwge2lkOiBlbnRpdHksIG5hbWU6IHByZXZOYW1lfSk7XG4gIC8vICAgY2hhbmdlcy5hZGQoXCJkaXNwbGF5IG5hbWVcIiwge2lkOiBlbnRpdHksIG5hbWV9KTtcbiAgLy8gICBsZXQgcGFydHMgPSBnZXRMb2NhdGlvbigpLnNwbGl0KFwiL1wiKTtcbiAgLy8gICBpZihwYXJ0cy5sZW5ndGggPiAyICYmIHBhcnRzWzJdLnJlcGxhY2UoL18vZ2ksIFwiIFwiKSA9PT0gZW50aXR5KSB7XG4gIC8vICAgICB3aW5kb3cuaGlzdG9yeS5yZXBsYWNlU3RhdGUod2luZG93Lmhpc3Rvcnkuc3RhdGUsIG51bGwsIGAvJHtzbHVnaWZ5KG5hbWUpfS8ke3NsdWdpZnkoZW50aXR5KX1gKTtcbiAgLy8gICB9XG4gIC8vIH1cbn0pO1xuYXBwSGFuZGxlKFwiY3JlYXRlIGVudGl0eVwiLCAoY2hhbmdlczpEaWZmLCB7ZW50aXR5LCBwYWdlLCBuYW1lID0gXCJVbnRpdGxlZFwifSkgPT4ge1xuICBjaGFuZ2VzXG4gICAgLmFkZChcImVudGl0eSBwYWdlXCIsIHtlbnRpdHksIHBhZ2V9KVxuICAgIC5hZGQoXCJkaXNwbGF5IG5hbWVcIiwge2lkOiBlbnRpdHksIG5hbWV9KTtcbn0pO1xuYXBwSGFuZGxlKFwiY3JlYXRlIHBhZ2VcIiwgKGNoYW5nZXM6RGlmZiwge3BhZ2UsIGNvbnRlbnQgPSB1bmRlZmluZWR9OiB7cGFnZTogc3RyaW5nLCBjb250ZW50PzpzdHJpbmd9KSA9PiB7XG4gIGlmKGNvbnRlbnQgPT09IHVuZGVmaW5lZCkgY29udGVudCA9IFwiVGhpcyBwYWdlIGlzIGVtcHR5LiBUeXBlIHNvbWV0aGluZyB0byBhZGQgc29tZSBjb250ZW50IVwiO1xuICBjaGFuZ2VzLmFkZChcInBhZ2UgY29udGVudFwiLCB7cGFnZSwgY29udGVudH0pO1xufSk7XG5hcHBIYW5kbGUoXCJjcmVhdGUgcXVlcnlcIiwgKGNoYW5nZXM6RGlmZiwge2lkLCBjb250ZW50fSkgPT4ge1xuICBsZXQgcGFnZSA9IHV1aWQoKTtcbiAgY2hhbmdlc1xuICAgIC5hZGQoXCJwYWdlIGNvbnRlbnRcIiwge3BhZ2UsIGNvbnRlbnQ6IGAjJHtjb250ZW50fSBxdWVyeWB9KVxuICAgIC5hZGQoXCJlbnRpdHkgcGFnZVwiLCB7aWQsIHBhZ2V9KVxuICAgIC5hZGQoXCJkaXNwbGF5IG5hbWVcIiwge2lkLCBjb250ZW50fSlcbiAgICAuYWRkKFwic291cmNlZCBlYXZcIiwge2VudGl0eTogaWQsIGF0dHJpYnV0ZTogXCJpcyBhXCIsIHZhbHVlOiBidWlsdGluSWQoXCJxdWVyeVwiKX0pXG4gICAgLmFkZChcInNvdXJjZWQgZWF2XCIsIHtlbnRpdHk6IGlkLCBhdHRyaWJ1dGU6IFwiY29udGVudFwiLCB2YWx1ZTogY29udGVudH0pO1xuICBsZXQgYXJ0aWZhY3RzID0gcGFyc2VEU0woY29udGVudCk7XG4gIGlmKGFydGlmYWN0cy5jaGFuZ2VzZXQpIGNoYW5nZXMubWVyZ2UoYXJ0aWZhY3RzLmNoYW5nZXNldCk7XG4gIGZvcihsZXQgdmlld0lkIGluIGFydGlmYWN0cy52aWV3cykge1xuICAgIGNoYW5nZXMuYWRkKFwic291cmNlZCBlYXZcIiwge2VudGl0eTogaWQsIGF0dHJpYnV0ZTogXCJhcnRpZmFjdFwiLCB2YWx1ZTogdmlld0lkfSk7XG4gICAgbGV0IG5hbWUgPSBhcnRpZmFjdHMudmlld3Nbdmlld0lkXVtcImRpc3BsYXlOYW1lXCJdO1xuICAgIGlmKCFldmUuZmluZE9uZShcImRpc3BsYXkgbmFtZVwiLCB7aWQ6IHZpZXdJZH0pICYmIG5hbWUpIGNoYW5nZXMuYWRkKFwiZGlzcGxheSBuYW1lXCIsIHtpZDogdmlld0lkLCBuYW1lfSk7XG4gICAgY2hhbmdlcy5tZXJnZShhcnRpZmFjdHMudmlld3Nbdmlld0lkXS5jaGFuZ2VzZXQoZXZlKSk7XG4gIH1cbn0pO1xuXG5hcHBIYW5kbGUoXCJpbnNlcnQgcXVlcnlcIiwgKGNoYW5nZXM6RGlmZiwge3F1ZXJ5fSkgPT4ge1xuICBxdWVyeSA9IHF1ZXJ5LnRyaW0oKS50b0xvd2VyQ2FzZSgpO1xuICBsZXQgcGFyc2VkID0gc2FmZU5MUGFyc2UocXVlcnkpO1xuICBsZXQgdG9wUGFyc2UgPSBwYXJzZWRbMF07XG4gIGlmKGV2ZS5maW5kT25lKFwicXVlcnkgdG8gaWRcIiwge3F1ZXJ5fSkpIHJldHVybjtcbiAgaWYodG9wUGFyc2UuaW50ZW50ID09PSBJbnRlbnRzLlFVRVJZKSB7XG4gICAgbGV0IGFydGlmYWN0cyA9IHBhcnNlRFNMKHBhcnNlZFswXS5xdWVyeS50b1N0cmluZygpKTtcbiAgICBpZihhcnRpZmFjdHMuY2hhbmdlc2V0KSBjaGFuZ2VzLm1lcmdlKGFydGlmYWN0cy5jaGFuZ2VzZXQpO1xuICAgIHZhciByb290SWQ7XG4gICAgZm9yKGxldCB2aWV3SWQgaW4gYXJ0aWZhY3RzLnZpZXdzKSB7XG4gICAgICBpZighcm9vdElkKSByb290SWQgPSB2aWV3SWQ7XG4gICAgICBsZXQgbmFtZSA9IGFydGlmYWN0cy52aWV3c1t2aWV3SWRdW1wiZGlzcGxheU5hbWVcIl07XG4gICAgICBpZighZXZlLmZpbmRPbmUoXCJkaXNwbGF5IG5hbWVcIiwge2lkOiB2aWV3SWR9KSAmJiBuYW1lKSBjaGFuZ2VzLmFkZChcImRpc3BsYXkgbmFtZVwiLCB7aWQ6IHZpZXdJZCwgbmFtZX0pO1xuICAgICAgY2hhbmdlcy5tZXJnZShhcnRpZmFjdHMudmlld3Nbdmlld0lkXS5jaGFuZ2VzZXQoZXZlKSk7XG4gICAgfVxuICAgIGNoYW5nZXMuYWRkKFwicXVlcnkgdG8gaWRcIiwge3F1ZXJ5LCBpZDogcm9vdElkfSlcbiAgfVxufSk7XG5cbmFwcEhhbmRsZShcImhhbmRsZSBzZXRBdHRyaWJ1dGUgaW4gYSBzZWFyY2hcIiwgKGNoYW5nZXM6RGlmZiwge2F0dHJpYnV0ZSwgZW50aXR5LCB2YWx1ZSwgcmVwbGFjZX0pID0+IHtcbiAgaWYocmVwbGFjZSkge1xuICAgIC8vY2hlY2sgaWYgdGhlcmUncyBhIGdlbmVyYXRvciwgaWYgc28sIHJlbW92ZSB0aGF0LlxuICAgIGxldCBnZW5lcmF0ZWQgPSBldmUuZmluZChcImdlbmVyYXRlZCBlYXZcIiwge2VudGl0eSwgYXR0cmlidXRlfSk7XG4gICAgaWYoZ2VuZXJhdGVkLmxlbmd0aCkge1xuICAgICAgZm9yKGxldCBnZW4gb2YgZ2VuZXJhdGVkKSB7XG4gICAgICAgIGNoYW5nZXMubWVyZ2UoZGlzcGF0Y2goXCJyZW1vdmUgYXR0cmlidXRlIGdlbmVyYXRpbmcgcXVlcnlcIiwge2Vhdjoge2VudGl0eSwgYXR0cmlidXRlfSwgdmlldzogZ2VuW1wic291cmNlXCJdfSkpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBjaGFuZ2VzLnJlbW92ZShcInNvdXJjZWQgZWF2XCIsIHtlbnRpdHksIGF0dHJpYnV0ZX0pXG4gICAgfVxuICB9XG4gIGNoYW5nZXMubWVyZ2UoZGlzcGF0Y2goXCJhZGQgc291cmNlZCBlYXZcIiwge2VudGl0eSwgYXR0cmlidXRlLCB2YWx1ZSwgZm9yY2VFbnRpdHk6IHRydWV9KSk7XG59KTtcblxuZnVuY3Rpb24gZGlzcGF0Y2hTZWFyY2hTZXRBdHRyaWJ1dGVzKHF1ZXJ5LCBjaGFpbj8pIHtcbiAgaWYoIWNoYWluKSB7XG4gICAgY2hhaW4gPSBkaXNwYXRjaCgpO1xuICB9XG4gIGxldCBwYXJzZWQgPSBzYWZlTkxQYXJzZShxdWVyeSk7XG4gIGxldCB0b3BQYXJzZSA9IHBhcnNlZFswXTtcbiAgbGV0IGlzU2V0U2VhcmNoID0gZmFsc2U7XG4gIGlmKHRvcFBhcnNlLmludGVudCA9PT0gSW50ZW50cy5JTlNFUlQpIHtcbiAgICAvLyBkZWJ1Z2dlcjtcbiAgICBsZXQgYXR0cmlidXRlcyA9IFtdO1xuICAgIGZvcihsZXQgaW5zZXJ0IG9mIHRvcFBhcnNlLmluc2VydHMpIHtcbiAgICAgIC8vIEBUT0RPOiBOTFAgbmVlZHMgdG8gdGVsbCB1cyB3aGV0aGVyIHdlJ3JlIHN1cHBvc2VkIHRvIG1vZGlmeSB0aGlzIGF0dHJpYnV0ZVxuICAgICAgLy8gb3IgaWYgd2UncmUganVzdCBhZGRpbmcgYSBuZXcgZWF2IGZvciBpdC5cbiAgICAgIGxldCByZXBsYWNlID0gdHJ1ZTtcbiAgICAgIGxldCBlbnRpdHkgPSBpbnNlcnQuZW50aXR5LmVudGl0eS5pZDtcbiAgICAgIGxldCBhdHRyaWJ1dGU7XG4gICAgICBpZihpbnNlcnQuYXR0cmlidXRlLmF0dHJpYnV0ZSkge1xuICAgICAgICBhdHRyaWJ1dGUgPSBpbnNlcnQuYXR0cmlidXRlLmF0dHJpYnV0ZS5kaXNwbGF5TmFtZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGF0dHJpYnV0ZSA9IGluc2VydC5hdHRyaWJ1dGUubmFtZTtcbiAgICAgIH1cbiAgICAgIGxldCB2YWx1ZTtcbiAgICAgIGlmKGluc2VydC52YWx1ZS50eXBlID09PSBOb2RlVHlwZXMuRU5USVRZKSB7XG4gICAgICAgIGxldCBsb2NhbFZhbHVlID0gPGFueT5pbnNlcnQudmFsdWU7XG4gICAgICAgIHZhbHVlID0gbG9jYWxWYWx1ZS5lbnRpdHkuaWQ7XG4gICAgICB9IGVsc2UgaWYoaW5zZXJ0LnZhbHVlLnR5cGUgPT09IE5vZGVUeXBlcy5OVU1CRVIgfHwgaW5zZXJ0LnZhbHVlLnR5cGUgPT09IE5vZGVUeXBlcy5TVFJJTkcgfHwgaW5zZXJ0LnZhbHVlLnR5cGUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICBsZXQgbG9jYWxWYWx1ZSA9IDxhbnk+aW5zZXJ0LnZhbHVlO1xuICAgICAgICB2YWx1ZSA9IGxvY2FsVmFsdWUubmFtZTtcbiAgICAgIH1cbiAgICAgIGlmKHZhbHVlID09PSB1bmRlZmluZWQpIGNvbnRpbnVlO1xuICAgICAgY2hhaW4uZGlzcGF0Y2goXCJoYW5kbGUgc2V0QXR0cmlidXRlIGluIGEgc2VhcmNoXCIsIHtlbnRpdHksIGF0dHJpYnV0ZSwgdmFsdWUsIHJlcGxhY2V9KTtcbiAgICAgIGF0dHJpYnV0ZXMucHVzaChgJHthdHRyaWJ1dGV9YCk7XG4gICAgfVxuICAgIHF1ZXJ5ID0gYXR0cmlidXRlcy5qb2luKFwiIGFuZCBcIik7XG4gICAgaXNTZXRTZWFyY2ggPSB0cnVlO1xuICB9XG4gIHJldHVybiB7Y2hhaW4sIHF1ZXJ5LCBpc1NldFNlYXJjaH07XG59XG5cbi8vIEBUT0RPOiB0aGVyZSdzIGEgbG90IG9mIGR1cGxpY2F0aW9uIGJldHdlZW4gaW5zZXJ0IHF1ZXJ5LCBjcmVhdGUgcXVlcnksIGFuZCBpbnNlcnQgaW1wbGljYXRpb25cbmFwcEhhbmRsZShcImluc2VydCBpbXBsaWNhdGlvblwiLCAoY2hhbmdlczpEaWZmLCB7cXVlcnl9KSA9PiB7XG4gIGxldCBhcnRpZmFjdHMgPSBwYXJzZURTTChxdWVyeSk7XG4gIGlmKGFydGlmYWN0cy5jaGFuZ2VzZXQpIGNoYW5nZXMubWVyZ2UoYXJ0aWZhY3RzLmNoYW5nZXNldCk7XG4gIGZvcihsZXQgdmlld0lkIGluIGFydGlmYWN0cy52aWV3cykge1xuICAgIGxldCBuYW1lID0gYXJ0aWZhY3RzLnZpZXdzW3ZpZXdJZF1bXCJkaXNwbGF5TmFtZVwiXTtcbiAgICBpZighZXZlLmZpbmRPbmUoXCJkaXNwbGF5IG5hbWVcIiwge2lkOiB2aWV3SWR9KSAmJiBuYW1lKSBjaGFuZ2VzLmFkZChcImRpc3BsYXkgbmFtZVwiLCB7aWQ6IHZpZXdJZCwgbmFtZX0pO1xuICAgIGNoYW5nZXMubWVyZ2UoYXJ0aWZhY3RzLnZpZXdzW3ZpZXdJZF0uY2hhbmdlc2V0KGV2ZSkpO1xuICB9XG59KVxuXG5hcHBIYW5kbGUoXCJyZW1vdmUgZW50aXR5IGF0dHJpYnV0ZVwiLCAoY2hhbmdlczpEaWZmLCB7ZW50aXR5LCBhdHRyaWJ1dGUsIHZhbHVlfSkgPT4ge1xuICBjaGFuZ2VzLnJlbW92ZShcInNvdXJjZWQgZWF2XCIsIHtlbnRpdHksIGF0dHJpYnV0ZSwgdmFsdWV9KTtcbiAgLy8gQEZJWE1FOiBNYWtlIGVtYmVkcyBhdXRvLWdjIHRoZW1zZWx2ZXMgd2hlbiBpbnZhbGlkYXRlZC5cbn0pO1xuYXBwSGFuZGxlKFwidXBkYXRlIGVudGl0eSBhdHRyaWJ1dGVcIiwgKGNoYW5nZXM6RGlmZiwge2VudGl0eSwgYXR0cmlidXRlLCBwcmV2LCB2YWx1ZX0pID0+IHtcbiAgLy8gQEZJWE1FOiBwcm9wZXIgdW5pcXVlIHNvdXJjZSBpZFxuICBsZXQge3NvdXJjZSA9IFwiPGdsb2JhbD5cIn0gPSBldmUuZmluZE9uZShcInNvdXJjZWQgZWF2XCIsIHtlbnRpdHksIGF0dHJpYnV0ZSwgdmFsdWU6IHByZXZ9KSB8fCB7fTtcbiAgaWYocHJldiAhPT0gdW5kZWZpbmVkKSBjaGFuZ2VzLnJlbW92ZShcInNvdXJjZWQgZWF2XCIsIHtlbnRpdHksIGF0dHJpYnV0ZSwgdmFsdWU6IHByZXZ9KTtcbiAgY2hhbmdlcy5hZGQoXCJzb3VyY2VkIGVhdlwiLCB7ZW50aXR5LCBhdHRyaWJ1dGUsIHZhbHVlLCBzb3VyY2V9KTtcbn0pO1xuYXBwSGFuZGxlKFwicmVuYW1lIGVudGl0eSBhdHRyaWJ1dGVcIiwgKGNoYW5nZXM6RGlmZiwge2VudGl0eSwgYXR0cmlidXRlOmF0dHJOYW1lLCBwcmV2LCB2YWx1ZX0pID0+IHtcbiAgLy8gQEZJWE1FOiBwcm9wZXIgdW5pcXVlIHNvdXJjZSBpZFxuICBsZXQge3NvdXJjZSA9IFwiPGdsb2JhbD5cIn0gPSBldmUuZmluZE9uZShcInNvdXJjZWQgZWF2XCIsIHtlbnRpdHksIGF0dHJpYnV0ZTogcHJldiwgdmFsdWV9KSB8fCB7fTtcbiAgbGV0IGF0dHJpYnV0ZSA9IG5vcm1hbGl6ZVN0cmluZyhhdHRyTmFtZSk7XG4gIGlmKHByZXYgIT09IHVuZGVmaW5lZCkge1xuICAgIGNoYW5nZXMucmVtb3ZlKFwic291cmNlZCBlYXZcIiwge2VudGl0eSwgYXR0cmlidXRlOiBwcmV2LCB2YWx1ZX0pXG4gICAgICAucmVtb3ZlKFwiZGlzcGxheSBuYW1lXCIsIHtpZDogcHJldn0pO1xuICB9XG4gIGNoYW5nZXMuYWRkKFwic291cmNlZCBlYXZcIiwge2VudGl0eSwgYXR0cmlidXRlLCB2YWx1ZSwgc291cmNlfSlcbiAgICAuYWRkKFwiZGlzcGxheSBuYW1lXCIsIHtpZDogYXR0cmlidXRlLCBuYW1lOiBhdHRyTmFtZX0pO1xufSk7XG5hcHBIYW5kbGUoXCJzb3J0IHRhYmxlXCIsIChjaGFuZ2VzOkRpZmYsIHtzdGF0ZSwgZmllbGQsIGRpcmVjdGlvbn0pID0+IHtcbiAgaWYoZmllbGQgIT09IHVuZGVmaW5lZCkge1xuICAgIHN0YXRlLnNvcnRGaWVsZCA9IGZpZWxkO1xuICAgIHN0YXRlLnNvcnREaXJlY3Rpb24gPSAxO1xuICB9XG4gIGlmKGRpcmVjdGlvbiAhPT0gdW5kZWZpbmVkKSBzdGF0ZS5zb3J0RGlyZWN0aW9uID0gZGlyZWN0aW9uO1xufSk7XG5hcHBIYW5kbGUoXCJ0b2dnbGUgc2V0dGluZ3NcIiwgKGNoYW5nZXM6RGlmZiwge3BhbmVJZCwgb3BlbiA9IHVuZGVmaW5lZH0pID0+IHtcbiAgbGV0IHN0YXRlID0gdWlTdGF0ZS5wYW5lW3BhbmVJZF0gfHwge3NldHRpbmdzOiBmYWxzZX07XG4gIHN0YXRlLnNldHRpbmdzID0gb3BlbiAhPT0gdW5kZWZpbmVkID8gb3BlbiA6ICFzdGF0ZS5zZXR0aW5ncztcbiAgdWlTdGF0ZS5wYW5lW3BhbmVJZF0gPSBzdGF0ZTtcbn0pO1xuYXBwSGFuZGxlKFwidG9nZ2xlIGNvbGxhcHNlXCIsIChjaGFuZ2VzOkRpZmYsIHtjb2xsYXBzaWJsZSwgb3BlbiA9IHVuZGVmaW5lZH0pID0+IHtcbiAgbGV0IHN0YXRlID0gdWlTdGF0ZS53aWRnZXQuY29sbGFwc2libGVbY29sbGFwc2libGVdIHx8IHtvcGVuOiBmYWxzZX07XG4gIHN0YXRlLm9wZW4gPSBvcGVuICE9PSB1bmRlZmluZWQgPyBvcGVuIDogIXN0YXRlLm9wZW47XG4gIHVpU3RhdGUud2lkZ2V0LmNvbGxhcHNpYmxlW2NvbGxhcHNpYmxlXSA9IHN0YXRlO1xufSk7XG5hcHBIYW5kbGUoXCJ0b2dnbGUgcHJvbXB0XCIsIChjaGFuZ2VzOkRpZmYsIHtwcm9tcHQgPSB1bmRlZmluZWQsIHBhbmVJZCA9IHVuZGVmaW5lZCwgb3BlbiA9IHVuZGVmaW5lZH0pID0+IHtcbiAgbGV0IHN0YXRlID0gdWlTdGF0ZS5wcm9tcHQ7XG4gIGlmKHN0YXRlLnByb21wdCAhPT0gcHJvbXB0KSB7XG4gICAgc3RhdGUucHJvbXB0ID0gcHJvbXB0O1xuICAgIHN0YXRlLm9wZW4gPSBvcGVuICE9PSB1bmRlZmluZWQgPyBvcGVuIDogdHJ1ZTtcbiAgICBzdGF0ZS5wYW5lSWQgPSBwYW5lSWQ7XG4gIH0gZWxzZSB7XG4gICAgc3RhdGUub3BlbiAhPT0gdW5kZWZpbmVkID8gb3BlbiA6ICFzdGF0ZS5vcGVuO1xuICB9XG4gIHVpU3RhdGUucHJvbXB0ID0gc3RhdGU7XG59KTtcbmFwcEhhbmRsZShcInJlbW92ZSBlbnRpdHlcIiwgKGNoYW5nZXM6RGlmZiwge2VudGl0eX0pID0+IHtcbiAgY2hhbmdlcy5yZW1vdmUoXCJzb3VyY2VkIGVhdlwiLCB7ZW50aXR5fSlcbiAgICAucmVtb3ZlKFwiZGlzcGxheSBuYW1lXCIsIHtpZDogZW50aXR5fSlcbiAgICAucmVtb3ZlKFwibWFudWFsIGVhdnNcIiwge2VudGl0eX0pXG4gICAgLnJlbW92ZShcImVudGl0eSBwYWdlXCIsIHtlbnRpdHl9KTtcbn0pO1xuXG4vLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuLy8gV2lraSBDb250YWluZXJzXG4vLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuZXhwb3J0IGZ1bmN0aW9uIHJvb3QoKTpFbGVtZW50IHtcbiAgbGV0IHBhbmVzID0gW107XG4gIGZvcihsZXQge3BhbmU6cGFuZUlkfSBvZiBldmUuZmluZChcInVpIHBhbmVcIiwge2tpbmQ6IFBBTkUuRlVMTH0pKSB7XG4gICAgcGFuZXMucHVzaChwYW5lKHBhbmVJZCkpO1xuICB9XG4gIGlmKHVpU3RhdGUucHJvbXB0Lm9wZW4gJiYgdWlTdGF0ZS5wcm9tcHQucHJvbXB0ICYmICF1aVN0YXRlLnByb21wdC5wYW5lSWQpIHtcbiAgICBwYW5lcy5wdXNoKHtjOiBcInNoYWRlXCIsIGNsaWNrOiBjbG9zZVByb21wdCwgY2hpbGRyZW46IFtcbiAgICAgIHVpU3RhdGUucHJvbXB0LnByb21wdCgpXG4gICAgXX0pO1xuICB9XG4gIGlmKCFsb2NhbFN0b3JhZ2VbXCJoaWRlQmFubmVyXCJdKSB7XG4gICAgcGFuZXMudW5zaGlmdCh7aWQ6IFwiZmVlZGJhY2stYmFubmVyXCIsIGM6IFwiYmFubmVyXCIsIGNoaWxkcmVuOiBbXG4gICAgICB7YzogXCJjb250ZW50XCIsIGNoaWxkcmVuOiBbXG4gICAgICAgIHt0ZXh0OiBcIlRoaXMgaXMgYW4gZWFybHkgcmVsZWFzZSBvZiBFdmUgbWVhbnQgZm9yIFwifSxcbiAgICAgICAge3Q6IFwiYVwiLCBjOiBcImxpbmtcIiwgaHJlZjogXCJodHRwczovL2dyb3Vwcy5nb29nbGUuY29tL2ZvcnVtLyMhZm9ydW0vZXZlLXRhbGtcIiwgdGV4dDogXCJmZWVkYmFja1wifSxcbiAgICAgICAge3RleHQ6IFwiLiBXZSdyZSBzaG9vdGluZyBmb3IgcXVhbGl0eSBvdmVyIHF1YW50aXR5LCBzbyBwbGVhc2UgZG9uJ3QgcG9zdCB0aGlzIHRvIEhOLCBSZWRkaXQsIGV0YywgYnV0IGZlZWwgZnJlZSB0byBzaGFyZSBpdCB3aXRoIGZyaWVuZHMuXCJ9LFxuICAgICAgXX0sXG4gICAgICB7YzogXCJmbGV4LWdyb3cgc3BhY2VyXCJ9LFxuICAgICAge3Q6IFwiYnV0dG9uXCIsIGM6IFwiaW9uLWNsb3NlXCIsIGNsaWNrOiBoaWRlQmFubmVyfVxuICAgIF19KVxuICB9XG4gIHBhbmVzLnVuc2hpZnQoe2M6IFwiZmVlZGJhY2stYmFyXCIsIGNoaWxkcmVuOiBbXG4gICAge3Q6IFwiYVwiLCB0YXJnZXQ6IFwiX2JsYW5rXCIsIGhyZWY6IFwiaHR0cHM6Ly9naXRodWIuY29tL3dpdGhldmUvRXZlL2lzc3Vlc1wiLCB0ZXh0OiBcImJ1Z3NcIn0sXG4gICAge3Q6IFwiYVwiLCB0YXJnZXQ6IFwiX2JsYW5rXCIsIGhyZWY6IFwiaHR0cHM6Ly9ncm91cHMuZ29vZ2xlLmNvbS9mb3J1bS8jIWZvcnVtL2V2ZS10YWxrXCIsIHRleHQ6IFwic3VnZ2VzdGlvbnNcIn0sXG4gICAge3Q6IFwiYVwiLCB0YXJnZXQ6IFwiX2JsYW5rXCIsIGhyZWY6IFwiaHR0cHM6Ly9ncm91cHMuZ29vZ2xlLmNvbS9mb3J1bS8jIWZvcnVtL2V2ZS10YWxrXCIsIHRleHQ6IFwiZGlzY3Vzc2lvblwifSxcbiAgXX0pXG4gIHJldHVybiB7YzogXCJ3aWtpLXJvb3RcIiwgaWQ6IFwicm9vdFwiLCBjaGlsZHJlbjogcGFuZXN9O1xufVxuXG5mdW5jdGlvbiBoaWRlQmFubmVyKGV2ZW50LCBlbGVtKSB7XG4gIGxvY2FsU3RvcmFnZVtcImhpZGVCYW5uZXJcIl0gPSB0cnVlO1xuICBkaXNwYXRjaChcIlwiKS5jb21taXQoKTtcbn1cblxuLy8gQFRPRE86IEFkZCBzZWFyY2ggZnVuY3Rpb25hbGl0eSArIFBhbmUgQ2hyb21lXG5sZXQgcGFuZUNocm9tZTp7W2tpbmQ6bnVtYmVyXTogKHBhbmVJZDpzdHJpbmcsIGVudGl0eUlkOnN0cmluZykgPT4ge2M/OiBzdHJpbmcsIGhlYWRlcj86RWxlbWVudCwgZm9vdGVyPzpFbGVtZW50LCBjYXB0dXJlQ2xpY2tzPzpib29sZWFufX0gPSB7XG4gIFtQQU5FLkZVTExdOiAocGFuZUlkLCBlbnRpdHlJZCkgPT4gKHtcbiAgICBjOiBcImZ1bGxzY3JlZW5cIixcbiAgICBoZWFkZXI6IHt0OiBcImhlYWRlclwiLCBjOiBcImZsZXgtcm93XCIsIGNoaWxkcmVuOiBbXG4gICAgICAvLyB7YzogXCJsb2dvIGV2ZS1sb2dvXCIsIGRhdGE6IHtwYW5lSWR9LCBsaW5rOiBcIlwiLCBjbGljazogbmF2aWdhdGV9LFxuICAgICAgc2VhcmNoSW5wdXQocGFuZUlkLCBlbnRpdHlJZCksXG4gICAgICB7YzogXCJjb250cm9scyB2aXNpYmxlXCIsIGNoaWxkcmVuOiBbXG4gICAgICAgICB7YzogXCJpb24tZ2Vhci1hIHRvZ2dsZS1zZXR0aW5nc1wiLCBzdHlsZTogXCJmb250LXNpemU6IDEuMzVlbTtcIiwgcHJvbXB0OiBwYW5lU2V0dGluZ3MsIHBhbmVJZCwgY2xpY2s6IG9wZW5Qcm9tcHR9XG4gICAgICBdfVxuICAgIF19XG4gIH0pLFxuICBbUEFORS5QT1BPVVRdOiAocGFuZUlkLCBlbnRpdHlJZCkgPT4ge1xuICAgIC8vIGxldCBwYXJlbnQgPSBldmUuZmluZE9uZShcInVpIHBhbmUgcGFyZW50XCIsIHtwYW5lOiBwYW5lSWR9KVtcInBhcmVudFwiXTtcbiAgICByZXR1cm4ge1xuICAgICAgYzogXCJ3aW5kb3dcIixcbiAgICAgIGNhcHR1cmVDbGlja3M6IHRydWUsXG4gICAgICBoZWFkZXI6IHt0OiBcImhlYWRlclwiLCBjOiBcIlwiLCBjaGlsZHJlbjogW1xuICAgICAgICAvLyB7dDogXCJidXR0b25cIiwgYzogXCJpb24tYW5kcm9pZC1zZWFyY2hcIiwgY2xpY2s6IG5hdmlnYXRlUGFyZW50LCBsaW5rOiBlbnRpdHlJZCwgcGFuZUlkLCB0ZXh0OlwiXCJ9LFxuICAgICAgICAvLyB7dDogXCJidXR0b25cIiwgYzogXCJpb24taW9zLWNsb3NlLWVtcHR5XCIsIGNsaWNrOiBuYXZpZ2F0ZVBhcmVudCwgbGluazogZW50aXR5SWQsIHBhbmVJZCwgdGV4dDpcIlwifSxcbiAgICAgICAgLy8ge3Q6IFwiYnV0dG9uXCIsIGM6IFwiaW9uLWlvcy11cGxvYWQtb3V0bGluZVwiLCBjbGljazogbmF2aWdhdGVQYXJlbnQsIGxpbms6IGVudGl0eUlkLCBwYW5lSWQsIHRleHQ6XCJcIn0sXG4gICAgICBdfSxcbiAgICB9O1xuICB9LFxuICBbUEFORS5XSU5ET1ddOiAocGFuZUlkLCBlbnRpdHlJZCkgPT4gKHtcbiAgICBjOiBcIndpbmRvd1wiLFxuICAgIGhlYWRlcjoge3Q6IFwiaGVhZGVyXCIsIGM6IFwiZmxleC1yb3dcIiwgY2hpbGRyZW46IFtcbiAgICAgIHtjOiBcImZsZXgtZ3JvdyB0aXRsZVwiLCB0ZXh0OiBlbnRpdHlJZH0sXG4gICAgICB7YzogXCJmbGV4LXJvdyBjb250cm9sc1wiLCBjaGlsZHJlbjogW1xuICAgICAgICB7YzogXCJpb24tYW5kcm9pZC1zZWFyY2hcIn0sXG4gICAgICAgIHtjOiBcImlvbi1taW51cy1yb3VuZFwifSxcbiAgICAgICAge2M6IFwiaW9uLWNsb3NlLXJvdW5kXCJ9XG4gICAgICBdfVxuICAgIF19XG4gIH0pXG59O1xuXG5mdW5jdGlvbiBvcGVuUHJvbXB0KGV2ZW50LCBlbGVtKSB7XG4gIGRpc3BhdGNoKFwidG9nZ2xlIHByb21wdFwiLCB7cHJvbXB0OiBlbGVtLnByb21wdCwgcGFuZUlkOiBlbGVtLnBhbmVJZCwgb3BlbjogdHJ1ZX0pLmNvbW1pdCgpO1xufVxuZnVuY3Rpb24gY2xvc2VQcm9tcHQoZXZlbnQsIGVsZW0pIHtcbiAgaWYoZXZlbnQudGFyZ2V0ID09PSBldmVudC5jdXJyZW50VGFyZ2V0KSB7XG4gICAgZGlzcGF0Y2goXCJ0b2dnbGUgcHJvbXB0XCIsIHtvcGVuOiBmYWxzZX0pLmNvbW1pdCgpO1xuICB9XG59XG5cbmZ1bmN0aW9uIG5hdmlnYXRlUGFyZW50KGV2ZW50LCBlbGVtKSB7XG4gIGxldCByb290ID0gZXZlLmZpbmRPbmUoXCJ1aSBwYW5lXCIsIHtraW5kOiBQQU5FLkZVTEx9KVtcInBhbmVcIl07XG4gIGRpc3BhdGNoKFwicmVtb3ZlIHBvcHVwXCIsIHtwYW5lSWQ6IGVsZW0ucGFuZUlkfSlcbiAgLmRpc3BhdGNoKFwic2V0IHBhbmVcIiwge3BhbmVJZDogcm9vdCwgY29udGFpbnM6IGVsZW0ubGlua30pXG4gIC5jb21taXQoKTtcbn1cblxuZnVuY3Rpb24gcmVtb3ZlUG9wdXAoZXZlbnQsIGVsZW0pIHtcbiAgaWYoIWV2ZW50LmRlZmF1bHRQcmV2ZW50ZWQpIHtcbiAgICBsZXQgY2hhaW4gPSBkaXNwYXRjaChcInJlbW92ZSBwb3B1cFwiLCB7fSkuZGlzcGF0Y2goXCJjbGVhckFjdGl2ZUNlbGxzXCIsIHt9KTtcbiAgICBmb3IobGV0IGVudGl0eSBpbiB1aVN0YXRlLndpZGdldC5hdHRyaWJ1dGVzKSB7XG4gICAgICBjaGFpbi5kaXNwYXRjaChcImNsZWFyQWN0aXZlQXR0cmlidXRlXCIsIHtlbnRpdHl9KTtcbiAgICB9XG4gICAgY2hhaW4uY29tbWl0KCk7XG4gIH1cbn1cblxuZnVuY3Rpb24gbG9hZEZyb21GaWxlKGV2ZW50OkV2ZW50LCBlbGVtKSB7XG4gIGxldCB0YXJnZXQgPSA8SFRNTElucHV0RWxlbWVudD5ldmVudC50YXJnZXQ7XG4gIGlmKCF0YXJnZXQuZmlsZXMubGVuZ3RoKSByZXR1cm47XG4gIGlmKHRhcmdldC5maWxlcy5sZW5ndGggPiAxKSB0aHJvdyBuZXcgRXJyb3IoXCJDYW5ub3QgbG9hZCBtdWx0aXBsZSBmaWxlcyBhdCBvbmNlXCIpO1xuICBsZXQgZmlsZSA9IHRhcmdldC5maWxlc1swXTtcbiAgbGV0IHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7XG4gIHJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbihldmVudDphbnkpIHtcbiAgICBsZXQgc2VyaWFsaXplZCA9IGV2ZW50LnRhcmdldC5yZXN1bHQ7XG4gICAgZXZlLmRlbGV0ZURCKCk7XG4gICAgZXZlLmxvYWQoc2VyaWFsaXplZCk7XG4gICAgZGlzcGF0Y2goXCJ0b2dnbGUgcHJvbXB0XCIsIHtwcm9tcHQ6IGxvYWRlZFByb21wdCwgb3BlbjogdHJ1ZX0pLmNvbW1pdCgpO1xuICB9O1xuICByZWFkZXIucmVhZEFzVGV4dChmaWxlKTtcbn1cblxuZnVuY3Rpb24gZGVsZXRlRGF0YWJhc2VQcm9tcHQoKTpFbGVtZW50IHtcbiAgcmV0dXJuIHtjOiBcIm1vZGFsLXByb21wdCBkZWxldGUtcHJvbXB0XCIsIGNoaWxkcmVuOiBbXG4gICAge3Q6IFwiaGVhZGVyXCIsIGM6IFwiZmxleC1yb3dcIiwgY2hpbGRyZW46IFtcbiAgICAgIHt0OiBcImgyXCIsIHRleHQ6IFwiREVMRVRFIERBVEFCQVNFXCJ9LFxuICAgICAge2M6IFwiZmxleC1ncm93XCJ9LFxuICAgICAge2M6IFwiY29udHJvbHNcIiwgY2hpbGRyZW46IFt7YzogXCJpb24tY2xvc2Utcm91bmRcIiwgY2xpY2s6IGNsb3NlUHJvbXB0fV19XG4gICAgXX0sXG4gICAge2M6IFwiaW5mb1wiLCB0ZXh0OiBcIlRoaXMgd2lsbCByZW1vdmUgYWxsIGluZm9ybWF0aW9uIGN1cnJlbnRseSBzdG9yZWQgaW4gRXZlIGZvciB5b3UgYW5kIGNhbm5vdCBiZSB1bmRvbmUuXCJ9LFxuICAgIHtjOiBcImZsZXgtcm93XCIsIGNoaWxkcmVuOiBbXG4gICAgICB7dDogXCJidXR0b25cIiwgYzogXCJkZWxldGUtYnRuXCIsIHRleHQ6IFwiREVMRVRFIEVWRVJZVEhJTkcgRk9SRVZFUlwiLCBjbGljazogbnVrZURhdGFiYXNlfSxcbiAgICAgIHtjOiBcImZsZXgtZ3Jvd1wifSxcbiAgICAgIHt0OiBcImJ1dHRvblwiLCB0ZXh0OiBcIkNhbmNlbFwiLCBjbGljazogY2xvc2VQcm9tcHR9LFxuICAgIF19XG4gIF19O1xufVxuXG5mdW5jdGlvbiBudWtlRGF0YWJhc2UoKSB7XG4gIGxvY2FsU3RvcmFnZVtcImxvY2FsLWV2ZVwiXSA9IFwiXCI7XG4gIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gYCR7d2luZG93LmxvY2F0aW9uLm9yaWdpbn0vYDtcbn1cblxuXG5mdW5jdGlvbiBzYXZlUHJvbXB0KCk6RWxlbWVudCB7XG4gIGxldCBzZXJpYWxpemVkID0gbG9jYWxTdG9yYWdlW2V2ZUxvY2FsU3RvcmFnZUtleV07XG4gIGxldCBibG9iID0gbmV3IEJsb2IoW3NlcmlhbGl6ZWRdLCB7dHlwZTogXCJhcHBsaWNhdGlvbi9qc29uXCJ9KTtcbiAgbGV0IHVybCA9IFVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYik7XG4gIHJldHVybiB7YzogXCJtb2RhbC1wcm9tcHQgc2F2ZS1wcm9tcHRcIiwgY2hpbGRyZW46IFtcbiAgICB7dDogXCJoZWFkZXJcIiwgYzogXCJmbGV4LXJvd1wiLCBjaGlsZHJlbjogW1xuICAgICAge3Q6IFwiaDJcIiwgdGV4dDogXCJTYXZlIERCXCJ9LFxuICAgICAge2M6IFwiZmxleC1ncm93XCJ9LFxuICAgICAge2M6IFwiY29udHJvbHNcIiwgY2hpbGRyZW46IFt7YzogXCJpb24tY2xvc2Utcm91bmRcIiwgY2xpY2s6IGNsb3NlUHJvbXB0fV19XG4gICAgXX0sXG4gICAge3Q6IFwiYVwiLCBocmVmOiB1cmwsIGRvd25sb2FkOiBcInNhdmUuZXZlZGJcIiwgdGV4dDogXCJzYXZlIHRvIGZpbGVcIn1cbiAgXX07XG59XG5cbmZ1bmN0aW9uIGxvYWRQcm9tcHQoKTpFbGVtZW50IHtcbiAgbGV0IHNlcmlhbGl6ZWQgPSBsb2NhbFN0b3JhZ2VbZXZlTG9jYWxTdG9yYWdlS2V5XTtcbiAgcmV0dXJuIHtjOiBcIm1vZGFsLXByb21wdCBsb2FkLXByb21wdFwiLCBjaGlsZHJlbjogW1xuICAgIHt0OiBcImhlYWRlclwiLCBjOiBcImZsZXgtcm93XCIsIGNoaWxkcmVuOiBbXG4gICAgICB7dDogXCJoMlwiLCB0ZXh0OiBcIkxvYWQgREJcIn0sXG4gICAgICB7YzogXCJmbGV4LWdyb3dcIn0sXG4gICAgICB7YzogXCJjb250cm9sc1wiLCBjaGlsZHJlbjogW3tjOiBcImlvbi1jbG9zZS1yb3VuZFwiLCBjbGljazogY2xvc2VQcm9tcHR9XX1cbiAgICBdfSxcbiAgICB7dDogXCJwXCIsIGNoaWxkcmVuOiBbXG4gICAgICB7dDogXCJzcGFuXCIsIHRleHQ6IFwiV0FSTklORzogVGhpcyB3aWxsIG92ZXJ3cml0ZSB5b3VyIGN1cnJlbnQgZGF0YWJhc2UuIFRoaXMgaXMgaXJyZXZlcnNpYmxlLiBZb3Ugc2hvdWxkIGNvbnNpZGVyIFwifSxcbiAgICAgIHt0OiBcImFcIiwgdGV4dDogXCJzYXZpbmcgeW91ciBEQlwiLCBwcm9tcHQ6IHNhdmVQcm9tcHQsIGNsaWNrOiBvcGVuUHJvbXB0fSxcbiAgICAgIHt0OiBcInNwYW5cIiwgdGV4dDogXCIgZmlyc3QuXCJ9XG4gICAgXX0sXG4gICAge3Q6IFwiaW5wdXRcIiwgdHlwZTogXCJmaWxlXCIsIHRleHQ6IFwibG9hZCBmcm9tIGZpbGVcIiwgY2hhbmdlOiBsb2FkRnJvbUZpbGV9XG4gIF19O1xufVxuXG5mdW5jdGlvbiBsb2FkZWRQcm9tcHQoKTpFbGVtZW50IHtcbiAgcmV0dXJuIHtjOiBcIm1vZGFsLXByb21wdCBsb2FkLXByb21wdFwiLCBjaGlsZHJlbjogW1xuICAgIHt0OiBcImhlYWRlclwiLCBjOiBcImZsZXgtcm93XCIsIGNoaWxkcmVuOiBbXG4gICAgICB7dDogXCJoMlwiLCB0ZXh0OiBcIkxvYWQgREJcIn0sXG4gICAgICB7YzogXCJmbGV4LWdyb3dcIn0sXG4gICAgICB7YzogXCJjb250cm9sc1wiLCBjaGlsZHJlbjogW3tjOiBcImlvbi1jbG9zZS1yb3VuZFwiLCBjbGljazogY2xvc2VQcm9tcHR9XX1cbiAgICBdfSxcbiAgICB7dGV4dDogXCJTdWNjZXNzZnVsbHkgbG9hZGVkIERCIGZyb20gZmlsZVwifVxuICBdfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHBhbmUocGFuZUlkOnN0cmluZyk6RWxlbWVudCB7XG4gIC8vIEBGSVhNRTogQWRkIGtpbmQgdG8gdWkgcGFuZXNcbiAgbGV0IHtjb250YWluczpyYXdDb250YWlucyA9IHVuZGVmaW5lZCwga2luZCA9IFBBTkUuRlVMTCwgcmVwID0gdW5kZWZpbmVkLCBwYXJhbXM6cmF3UGFyYW1zID0gdW5kZWZpbmVkfSA9IGV2ZS5maW5kT25lKFwidWkgcGFuZVwiLCB7cGFuZTogcGFuZUlkfSkgfHwge307XG4gIGxldCB7cmVzdWx0cywgcGFyYW1zOnBhcnNlZFBhcmFtcywgY29udGVudDpjb250YWluc30gPSBxdWVyeVVJSW5mbyhyYXdDb250YWlucyB8fCBcImhvbWVcIik7XG4gIGxldCBwYXJhbXMgPSBtZXJnZU9iamVjdChwYXJzZVBhcmFtcyhyYXdQYXJhbXMpLCBwYXJzZWRQYXJhbXMpO1xuICBwYXJhbXMucGFuZUlkID0gcGFuZUlkO1xuICBsZXQgbWFrZUNocm9tZSA9IHBhbmVDaHJvbWVba2luZF07XG4gIGlmKCFtYWtlQ2hyb21lKSB0aHJvdyBuZXcgRXJyb3IoYFVua25vd24gcGFuZSBraW5kOiAnJHtraW5kfScgKCR7UEFORVtraW5kXX0pYCk7XG4gIGxldCB7YzprbGFzcywgaGVhZGVyLCBmb290ZXIsIGNhcHR1cmVDbGlja3N9ID0gbWFrZUNocm9tZShwYW5lSWQsIGNvbnRhaW5zKTtcbiAgbGV0IGVudGl0eUlkID0gYXNFbnRpdHkoY29udGFpbnMpO1xuXG4gIGxldCBjb250ZW50O1xuICBsZXQgY29udGVudFR5cGUgPSBcImludmFsaWRcIjtcbiAgaWYoY29udGFpbnMubGVuZ3RoID09PSAwIHx8IGVudGl0eUlkKSBjb250ZW50VHlwZSA9IFwiZW50aXR5XCI7XG4gIGVsc2UgaWYoZXZlLmZpbmRPbmUoXCJxdWVyeSB0byBpZFwiLCB7cXVlcnk6IGNvbnRhaW5zLnRyaW0oKS50b0xvd2VyQ2FzZSgpfSkpIGNvbnRlbnRUeXBlID0gXCJzZWFyY2hcIjtcblxuICBpZihwYXJhbXMucmVwIHx8IHJlcCkge1xuICAgIHBhcmFtc1tcInNlYXJjaFwiXSA9IGNvbnRhaW5zO1xuICAgIGNvbnRlbnQgPSByZXByZXNlbnQoY29udGFpbnMsIHBhcmFtcy5yZXAgfHwgcmVwLCByZXN1bHRzLCBwYXJhbXMsIChwYXJhbXMudW53cmFwcGVkID8gdW5kZWZpbmVkIDogKGVsZW0sIGl4PykgPT4gdWl0ay5jYXJkKHtpZDogYCR7cGFuZUlkfXwke2NvbnRhaW5zfXwke2l4ID09PSB1bmRlZmluZWQgPyBcIlwiIDogaXh9YCwgY2hpbGRyZW46IFtlbGVtXX0pKSk7XG4gICAgY29udGVudC50ID0gXCJjb250ZW50XCI7XG4gICAgY29udGVudC5jID0gYCR7Y29udGVudC5jIHx8IFwiXCJ9ICR7cGFyYW1zLnVud3JhcHBlZCA/IFwidW53cmFwcGVkXCIgOiBcIlwifWA7XG4gIH1cblxuICB2YXIgZGlzYW1iaWd1YXRpb246RWxlbWVudDtcbiAgaWYoY29udGVudFR5cGUgPT09IFwiaW52YWxpZFwiKSB7XG4gICAgZGlzYW1iaWd1YXRpb24gPSB7YzogXCJmbGV4LXJvdyBzcGFjZWQtcm93IGRpc2FtYmlndWF0aW9uXCIsIGNoaWxkcmVuOiBbXG4gICAgICB7dDogXCJzcGFuXCIsIHRleHQ6IGBJIGNvdWxkbid0IGZpbmQgYW55dGhpbmc7IHNob3VsZCBJYH0sXG4gICAgICB7dDogXCJhXCIsIGM6IFwibGluayBidG4gYWRkLWJ0blwiLCB0ZXh0OiBgYWRkICR7Y29udGFpbnN9YCwgbmFtZTogY29udGFpbnMsIHBhbmVJZCwgY2xpY2s6IGNyZWF0ZVBhZ2UgfSxcbiAgICAgIHt0OiBcInNwYW5cIiwgdGV4dDogXCI/XCJ9LFxuICAgIF19O1xuICAgIGNvbnRlbnQgPSB1bmRlZmluZWQ7XG4gIH0gZWxzZSBpZihjb250ZW50VHlwZSA9PT0gXCJzZWFyY2hcIikge1xuICAgIC8vIEBUT0RPOiBUaGlzIG5lZWRzIHRvIG1vdmUgaW50byBFdmUncyBub3RpZmljYXRpb24gLyBjaGF0IGJhclxuICAgIGRpc2FtYmlndWF0aW9uID0ge2lkOiBcInNlYXJjaC1kaXNhbWJpZ3VhdGlvblwiLCBjOiBcImZsZXgtcm93IHNwYWNlZC1yb3cgZGlzYW1iaWd1YXRpb25cIiwgY2hpbGRyZW46IFtcbiAgICAgIHt0ZXh0OiBcIk9yIHNob3VsZCBJXCJ9LFxuICAgICAge3Q6IFwiYVwiLCBjOiBcImxpbmsgYnRuIGFkZC1idG5cIiwgdGV4dDogYGFkZCBhIGNhcmRgLCBuYW1lOiBjb250YWlucywgcGFuZUlkLCBjbGljazogY3JlYXRlUGFnZX0sXG4gICAgICB7dGV4dDogYGZvciAke2NvbnRhaW5zfT9gfVxuICAgIF19O1xuICB9XG5cbiAgbGV0IHNjcm9sbGVyID0gY29udGVudDtcblxuICBpZihraW5kID09PSBQQU5FLkZVTEwpIHtcbiAgICBsZXQgcGFuZXMgPSBldmUuZmluZChcInVpIHBhbmVcIikuZmlsdGVyKChwYW5lKSA9PiBwYW5lLmtpbmQgIT09IFBBTkUuRlVMTCk7XG4gICAgbGV0IGNoaWxkcmVuID0gW2NvbnRlbnRdLmNvbmNhdChwYW5lcy5tYXAoKHApID0+IHBhbmUocC5wYW5lKSkpO1xuICAgIHNjcm9sbGVyID0ge2M6IFwic2Nyb2xsZXJcIiwgY2hpbGRyZW59O1xuICB9XG5cbiAgbGV0IGN1clBhbmU6RWxlbWVudCA9IHtjOiBgd2lraS1wYW5lICR7a2xhc3MgfHwgXCJcIn1gLCBwYW5lSWQsIGNoaWxkcmVuOiBbaGVhZGVyLCBkaXNhbWJpZ3VhdGlvbiwgc2Nyb2xsZXIsIGZvb3Rlcl19O1xuICBsZXQgcG9zID0gZXZlLmZpbmRPbmUoXCJ1aSBwYW5lIHBvc2l0aW9uXCIsIHtwYW5lOiBwYW5lSWR9KTtcbiAgaWYocG9zKSB7XG4gICAgLy8gY3VyUGFuZS5zdHlsZSA9IGBsZWZ0OiAke2lzTmFOKHBvcy54KSA/IHBvcy54IDogcG9zLnggKyBcInB4XCJ9OyB0b3A6ICR7aXNOYU4ocG9zLnkpID8gcG9zLnkgOiAocG9zLnkgKyAyMCkgKyBcInB4XCJ9O2A7XG4gIH1cbiAgaWYoY2FwdHVyZUNsaWNrcykge1xuICAgIGN1clBhbmUuY2xpY2sgPSBwcmV2ZW50RGVmYXVsdDtcbiAgfVxuXG4gIGlmKHVpU3RhdGUucHJvbXB0Lm9wZW4gJiYgdWlTdGF0ZS5wcm9tcHQucGFuZUlkID09PSBwYW5lSWQpIHtcbiAgICBjdXJQYW5lLmNoaWxkcmVuLnB1c2goXG4gICAgICB7YzogXCJzaGFkZVwiLCBwYW5lSWQsIGNsaWNrOiBjbG9zZVByb21wdH0sXG4gICAgICB1aVN0YXRlLnByb21wdC5wcm9tcHQocGFuZUlkKVxuICAgICk7XG4gIH1cbiAgcmV0dXJuIGN1clBhbmU7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBzZWFyY2goc2VhcmNoOnN0cmluZywgcGFuZUlkOnN0cmluZyk6RWxlbWVudCB7XG4gIGxldCBbcmF3Q29udGVudCwgcmF3UGFyYW1zXSA9IHNlYXJjaC5zcGxpdChcInxcIik7XG4gIGxldCBwYXJzZWRQYXJhbXMgPSBnZXRDZWxsUGFyYW1zKHJhd0NvbnRlbnQsIHJhd1BhcmFtcyk7XG4gIGxldCB7cmVzdWx0cywgcGFyYW1zLCBjb250ZW50fSA9IHF1ZXJ5VUlJbmZvKHNlYXJjaCk7XG4gIHBhcmFtc1tcInBhbmVJZFwiXSA9IHBhbmVJZDtcbiAgbWVyZ2VPYmplY3QocGFyYW1zLCBwYXJzZWRQYXJhbXMpO1xuICBsZXQgcmVwID0gcmVwcmVzZW50KGNvbnRlbnQsIHBhcmFtc1tcInJlcFwiXSwgcmVzdWx0cywgcGFyYW1zKTtcbiAgcmV0dXJuIHt0OiBcImNvbnRlbnRcIiwgYzogXCJ3aWtpLXNlYXJjaFwiLCBjaGlsZHJlbjogW1xuICAgIHJlcFxuICBdfTtcbn1cblxuZnVuY3Rpb24gY3JlYXRlUGFnZShldnQ6RXZlbnQsIGVsZW06RWxlbWVudCkge1xuICBsZXQgbmFtZSA9IGVsZW1bXCJuYW1lXCJdO1xuICBsZXQgZW50aXR5ID0gdXVpZCgpO1xuICBsZXQgcGFnZSA9IHV1aWQoKTtcbiAgZGlzcGF0Y2goXCJjcmVhdGUgcGFnZVwiLCB7cGFnZSwgY29udGVudDogYGB9KVxuICAuZGlzcGF0Y2goXCJjcmVhdGUgZW50aXR5XCIsIHtlbnRpdHksIHBhZ2UsIG5hbWV9KVxuICAuZGlzcGF0Y2goXCJzZXQgcGFuZVwiLCB7cGFuZUlkOiBlbGVtW1wicGFuZUlkXCJdLCBjb250YWluczogZW50aXR5LCByZXA6IFwiZW50aXR5XCIsIHBhcmFtczogXCJcIn0pLmNvbW1pdCgpO1xufVxuXG5mdW5jdGlvbiBkZWxldGVFbnRpdHkoZXZlbnQsIGVsZW0pIHtcbiAgbGV0IG5hbWUgPSB1aXRrLnJlc29sdmVOYW1lKGVsZW0uZW50aXR5KTtcbiAgZGlzcGF0Y2goXCJyZW1vdmUgZW50aXR5XCIsIHtlbnRpdHk6IGVsZW0uZW50aXR5fSkuY29tbWl0KCk7XG4gIGRpc3BhdGNoKFwic2V0IHBhbmVcIiwge3BhbmVJZDogZWxlbS5wYW5lSWQsIGNvbnRhaW5zOiBuYW1lfSkuY29tbWl0KCk7XG59XG5cbmZ1bmN0aW9uIHBhbmVTZXR0aW5ncyhwYW5lSWQ6c3RyaW5nKSB7XG4gIGxldCBwYW5lID0gZXZlLmZpbmRPbmUoXCJ1aSBwYW5lXCIsIHtwYW5lOiBwYW5lSWR9KTtcbiAgbGV0IHtlbnRpdHkgPSB1bmRlZmluZWR9ID0gZXZlLmZpbmRPbmUoXCJlbnRpdHlcIiwge2VudGl0eTogdWl0ay5yZXNvbHZlSWQocGFuZS5jb250YWlucyl9KSB8fCB7fTtcbiAgbGV0IGlzU3lzdGVtID0gISEoZW50aXR5ICYmIGV2ZS5maW5kT25lKFwiZW50aXR5IGVhdnNcIiwge2VudGl0eSwgYXR0cmlidXRlOiBcImlzIGFcIiwgdmFsdWU6IGJ1aWx0aW5JZChcInN5c3RlbVwiKX0pKTtcbiAgcmV0dXJuIHt0OiBcInVsXCIsIGM6IFwic2V0dGluZ3NcIiwgY2hpbGRyZW46IFtcbiAgICB7dDogXCJsaVwiLCBjOiBcInNhdmUtYnRuXCIsIHRleHQ6IFwic2F2ZVwiLCBwcm9tcHQ6IHNhdmVQcm9tcHQsIGNsaWNrOiBvcGVuUHJvbXB0fSxcbiAgICB7dDogXCJsaVwiLCBjOiBcImxvYWQtYnRuXCIsIHRleHQ6IFwibG9hZFwiLCBwcm9tcHQ6IGxvYWRQcm9tcHQsIGNsaWNrOiBvcGVuUHJvbXB0fSxcbiAgICBlbnRpdHkgJiYgIWlzU3lzdGVtID8ge3Q6IFwibGlcIiwgYzogXCJkZWxldGUtYnRuXCIsIHRleHQ6IFwiZGVsZXRlIGNhcmRcIiwgZW50aXR5LCBwYW5lSWQsIGNsaWNrOiBkZWxldGVFbnRpdHl9IDogdW5kZWZpbmVkLFxuICAgIHt0OiBcImxpXCIsIGM6IFwiZGVsZXRlLWJ0blwiLCB0ZXh0OiBcIkRFTEVURSBEQVRBQkFTRVwiLCBwcm9tcHQ6IGRlbGV0ZURhdGFiYXNlUHJvbXB0LCBjbGljazogb3BlblByb21wdH0sXG4gIF19O1xufVxuXG5mdW5jdGlvbiBzaXplQ29sdW1ucyhub2RlOkhUTUxFbGVtZW50LCBlbGVtOkVsZW1lbnQpIHtcbiAgLy8gQEZJWE1FOiBIb3JyaWJsZSBoYWNrIHRvIGdldCBhcm91bmQgcmFuZG9tbHkgYWRkZWQgXCJ1bmRlZmluZWRcIiB0ZXh0IG5vZGUgdGhhdCdzIGNvbWluZyBmcm9tIGluIG1pY3JvcmVhY3QuXG4gIGxldCBjdXIgPSBub2RlO1xuICB3aGlsZShjdXIucGFyZW50RWxlbWVudCkgY3VyID0gY3VyLnBhcmVudEVsZW1lbnQ7XG4gIGlmKGN1ci50YWdOYW1lICE9PSBcIkhUTUxcIikgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChjdXIpO1xuXG4gIGxldCBjaGlsZDpOb2RlLCBpeCA9IDA7XG4gIGxldCB3aWR0aHMgPSB7fTtcbiAgbGV0IGNvbHVtbnMgPSA8SFRNTEVsZW1lbnRbXT48YW55Pm5vZGUucXVlcnlTZWxlY3RvckFsbChcIi5jb2x1bW5cIik7XG4gIGZvcihsZXQgY29sdW1uIG9mIGNvbHVtbnMpIHtcbiAgICBjb2x1bW4uc3R5bGUud2lkdGggPSBcImF1dG9cIjtcbiAgICB3aWR0aHNbY29sdW1uW1widmFsdWVcIl1dID0gd2lkdGhzW2NvbHVtbltcInZhbHVlXCJdXSB8fCAwO1xuICAgIGlmKGNvbHVtbi5vZmZzZXRXaWR0aCA+IHdpZHRoc1tjb2x1bW5bXCJ2YWx1ZVwiXV0pIHdpZHRoc1tjb2x1bW5bXCJ2YWx1ZVwiXV0gPSBjb2x1bW4ub2Zmc2V0V2lkdGg7XG4gIH1cbiAgZm9yKGxldCBjb2x1bW4gb2YgY29sdW1ucykgY29sdW1uLnN0eWxlLndpZHRoID0gd2lkdGhzW2NvbHVtbltcInZhbHVlXCJdXSArIDE7XG5cbiAgaWYoY3VyLnRhZ05hbWUgIT09IFwiSFRNTFwiKSBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGN1cik7XG59XG5cbi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4vLyBXaWtpIGVkaXRvciBmdW5jdGlvbnNcbi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5mdW5jdGlvbiBwYXJzZVBhcmFtcyhyYXdQYXJhbXM6c3RyaW5nKSB7XG4gIGxldCBwYXJhbXMgPSB7fTtcbiAgaWYoIXJhd1BhcmFtcykgcmV0dXJuIHBhcmFtcztcbiAgZm9yKGxldCBrdiBvZiByYXdQYXJhbXMuc3BsaXQoXCI7XCIpKSB7XG4gICAgbGV0IFtrZXksIHZhbHVlXSA9IGt2LnNwbGl0KFwiPVwiKTtcbiAgICBpZigha2V5IHx8ICFrZXkudHJpbSgpKSBjb250aW51ZTtcbiAgICB2YWx1ZSA9IHZhbHVlLnRyaW0oKTtcbiAgICBpZighdmFsdWUpIHRocm93IG5ldyBFcnJvcihcIk11c3Qgc3BlY2lmeSB2YWx1ZSBmb3Iga2V5ICdcIiArIGtleSArIFwiJ1wiKTtcbiAgICBcbiAgICBpZih2YWx1ZVswXSA9PT0gXCJ7XCIgJiYgdmFsdWVbdmFsdWUubGVuZ3RoIC0gMV0gPT09IFwifVwiIHx8IHZhbHVlWzBdID09PSBcIltcIiAmJiB2YWx1ZVt2YWx1ZS5sZW5ndGggLSAxXSA9PT0gXCJdXCIpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGxldCByZXN1bHQgPSBKU09OLnBhcnNlKHZhbHVlKTtcbiAgICAgICAgdmFsdWUgPSByZXN1bHQ7XG4gICAgICB9IGNhdGNoKGVycikgeyB9XG4gICAgfVxuICAgIHBhcmFtc1trZXkudHJpbSgpXSA9IGNvZXJjZUlucHV0KHZhbHVlKTtcbiAgfVxuICByZXR1cm4gcGFyYW1zO1xufVxuZnVuY3Rpb24gc3RyaW5naWZ5UGFyYW1zKHBhcmFtczp7fSk6c3RyaW5nIHtcbiAgbGV0IHJhd1BhcmFtcyA9IFwiXCI7XG4gIGlmKCFwYXJhbXMpIHJldHVybiByYXdQYXJhbXM7XG4gIGZvcihsZXQga2V5IGluIHBhcmFtcykge1xuICAgIGlmKHBhcmFtc1trZXldID09PSB1bmRlZmluZWQgfHwgcGFyYW1zW2tleV0gPT09IG51bGwpIGNvbnRpbnVlO1xuICAgIHJhd1BhcmFtcyArPSBgJHtyYXdQYXJhbXMubGVuZ3RoID8gXCI7IFwiIDogXCJcIn0ke2tleX0gPSAke3R5cGVvZiBwYXJhbXNba2V5XSA9PT0gXCJvYmplY3RcIiA/IEpTT04uc3RyaW5naWZ5KHBhcmFtc1trZXldKSA6IHBhcmFtc1trZXldfWA7XG4gIH1cbiAgcmV0dXJuIHJhd1BhcmFtcztcbn1cblxuZnVuY3Rpb24gY2VsbFVJKHBhbmVJZCwgcXVlcnksIGNlbGwpOkVsZW1lbnQge1xuICBsZXQge3BhcmFtcywgcmVzdWx0cywgY29udGVudH0gPSBxdWVyeVVJSW5mbyhxdWVyeSk7XG4gIHBhcmFtc1tcInBhbmVJZFwiXSA9IHBhcmFtc1tcInBhbmVJZFwiXSB8fCBwYW5lSWQ7XG4gIHBhcmFtc1tcImNlbGxcIl0gPSBjZWxsO1xuICBwYXJhbXNbXCJjaGlsZFJlcFwiXSA9IHBhcmFtc1tcInJlcFwiXTtcbiAgcGFyYW1zW1wicmVwXCJdID0gXCJlbWJlZGRlZENlbGxcIjtcbiAgcmV0dXJuIHtjOiBgY2VsbGAsIGNoaWxkcmVuOiBbcmVwcmVzZW50KGNvbnRlbnQsIHBhcmFtc1tcInJlcFwiXSwgcmVzdWx0cywgcGFyYW1zKV19O1xufVxuXG4vLyBDcmVkaXQgdG8gaHR0cHM6Ly9tYXRoaWFzYnluZW5zLmJlL2RlbW8vdXJsLXJlZ2V4IGFuZCBAZ3J1YmVyXG5sZXQgdXJsUmVnZXggPSAvXFxiKChbXFx3LV0rOlxcL1xcLz98d3d3Wy5dKVteXFxzKCk8Pl0rKD86XFwoW1xcd1xcZF0rXFwpfChbXltcXC4sXFwtXFwvIyEkJScgXCJeKjs6e19gfigpXFwtXFxzXXxcXC8pKSkvaTtcblxuZnVuY3Rpb24gcXVlcnlVSUluZm8ocXVlcnkpIHtcbiAgbGV0IFtjb250ZW50LCByYXdQYXJhbXNdID0gcXVlcnkuc3BsaXQoXCJ8XCIpO1xuICBsZXQgZW1iZWRUeXBlO1xuICAvLyBsZXQgcGFyYW1zID0gZ2V0Q2VsbFBhcmFtcyhjb250ZW50LCByYXdQYXJhbXMpO1xuICBsZXQgcGFyYW1zID0gcGFyc2VQYXJhbXMocmF3UGFyYW1zKTtcbiAgbGV0IHJlc3VsdHM7XG4gIGxldCBlbnRpdHlJZCA9IGFzRW50aXR5KGNvbnRlbnQpO1xuICBpZihlbnRpdHlJZCkge1xuICAgIHJlc3VsdHMgPSB7dW5wcm9qZWN0ZWQ6IFt7ZW50aXR5OiBlbnRpdHlJZH1dLCByZXN1bHRzOiBbe2VudGl0eTogZW50aXR5SWR9XX07XG5cbiAgfSBlbHNlIGlmKHVybFJlZ2V4LmV4ZWMoY29udGVudCkpIHtcbiAgICByZXN1bHRzID0ge3VucHJvamVjdGVkOiBbe3VybDogY29udGVudH1dLCByZXN1bHRzOiBbe3VybDogY29udGVudH1dfTtcblxuICB9IGVsc2Uge1xuICAgIGxldCBjbGVhbmVkID0gY29udGVudCAmJiBjb250ZW50LnRyaW0oKS50b0xvd2VyQ2FzZSgpO1xuICAgIGxldCBxdWVyeUlkID0gZXZlLmZpbmRPbmUoXCJxdWVyeSB0byBpZFwiLCB7cXVlcnk6IGNsZWFuZWR9KTtcbiAgICBpZihxdWVyeUlkKSB7XG4gICAgICBsZXQgcXVlcnlSZXN1bHRzID0gZXZlLmZpbmQocXVlcnlJZC5pZCk7XG4gICAgICBsZXQgcXVlcnlVbnByb2plY3RlZCA9IGV2ZS50YWJsZShxdWVyeUlkLmlkKS51bnByb2plY3RlZDtcbiAgICAgIGlmKCFxdWVyeVJlc3VsdHMubGVuZ3RoKSB7XG4gICAgICAgIHBhcmFtc1tcInJlcFwiXSA9IFwiZXJyb3JcIjtcbiAgICAgICAgcGFyYW1zW1wibWVzc2FnZVwiXSA9IFwiTm8gcmVzdWx0c1wiO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmVzdWx0cyA9IHt1bnByb2plY3RlZDogcXVlcnlVbnByb2plY3RlZCwgcmVzdWx0czogcXVlcnlSZXN1bHRzfTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgcGFyYW1zW1wicmVwXCJdID0gXCJlcnJvclwiO1xuICAgICAgcGFyYW1zW1wibWVzc2FnZVwiXSA9IFwiaW52YWxpZCBzZWFyY2hcIjtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHtyZXN1bHRzLCBwYXJhbXMsIGNvbnRlbnR9O1xufVxuXG5mdW5jdGlvbiBnZXRDZWxsUGFyYW1zKGNvbnRlbnQsIHJhd1BhcmFtcykge1xuICBjb250ZW50ID0gY29udGVudC50cmltKCk7XG4gIGxldCBwYXJhbXMgPSBwYXJzZVBhcmFtcyhyYXdQYXJhbXMpO1xuICBsZXQgZW50aXR5SWQgPSBhc0VudGl0eShjb250ZW50KTtcbiAgaWYoZW50aXR5SWQpIHtcbiAgICBwYXJhbXNbXCJyZXBcIl0gPSBwYXJhbXNbXCJyZXBcIl0gfHwgXCJsaW5rXCI7XG4gIH0gZWxzZSBpZih1cmxSZWdleC5leGVjKGNvbnRlbnQpKSB7XG4gICAgcGFyYW1zW1wicmVwXCJdID0gcGFyYW1zW1wicmVwXCJdIHx8IFwiZXh0ZXJuYWxMaW5rXCI7XG4gIH0gZWxzZSB7XG4gICAgaWYocGFyYW1zW1wicmVwXCJdKSByZXR1cm4gcGFyYW1zO1xuXG4gICAgbGV0IHBhcnNlZCA9IHNhZmVOTFBhcnNlKGNvbnRlbnQpO1xuICAgIGxldCBjdXJyZW50UGFyc2UgPSBwYXJzZWRbMF07XG4gICAgaWYoY3VycmVudFBhcnNlLmludGVudCA9PT0gSW50ZW50cy5OT1JFU1VMVCkge1xuICAgICAgcGFyYW1zW1wicmVwXCJdID0gXCJlcnJvclwiO1xuICAgICAgcmV0dXJuIHBhcmFtcztcbiAgICB9XG4gICAgbGV0IGNvbnRleHQgPSBjdXJyZW50UGFyc2UuY29udGV4dDtcbiAgICBsZXQgaGFzQ29sbGVjdGlvbnMgPSBjb250ZXh0LmNvbGxlY3Rpb25zLmxlbmd0aDtcbiAgICBsZXQgZmllbGQ7XG4gICAgbGV0IHJlcDtcbiAgICBsZXQgYWdncmVnYXRlcyA9IFtdO1xuICAgIC8vIGNvbnNvbGUubG9nKGN1cnJlbnRQYXJzZS5xdWVyeS50b1N0cmluZygpKVxuICAgIGZvcihsZXQgZnhuIG9mIGNvbnRleHQuZnhucykge1xuICAgICAgaWYoZnhuLmZ4bi50eXBlID09PSBGdW5jdGlvblR5cGVzLkFHR1JFR0FURSkge1xuICAgICAgICBhZ2dyZWdhdGVzLnB1c2goZnhuKTtcbiAgICAgIH1cbiAgICB9XG4gICAgbGV0IHRvdGFsRm91bmQgPSAwO1xuICAgIGZvcihsZXQgaXRlbSBvZiBbXCJhdHRyaWJ1dGVzXCIsIFwiZW50aXRpZXNcIiwgXCJjb2xsZWN0aW9uc1wiLCBcImZ4bnNcIiwgXCJtYXliZUF0dHJpYnV0ZXNcIiwgXCJtYXliZUVudGl0aWVzXCIsIFwibWF5YmVDb2xsZWN0aW9uc1wiLCBcIm1heWJlRnVuY3Rpb25zXCJdKSB7XG4gICAgICB0b3RhbEZvdW5kICs9IGNvbnRleHRbaXRlbV0ubGVuZ3RoO1xuICAgIH1cbiAgICBjb25zb2xlLmxvZyhjb250ZXh0KTtcbiAgICBpZihhZ2dyZWdhdGVzLmxlbmd0aCA9PT0gMSAmJiBjb250ZXh0W1wiZ3JvdXBpbmdzXCJdLmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmVwID0gXCJyZXN1bHRcIjtcbiAgICAgIGZpZWxkID0gYWdncmVnYXRlc1swXS5meG4ucHJvamVjdGVkQXM7XG4gICAgfSBlbHNlIGlmKCFoYXNDb2xsZWN0aW9ucyAmJiBjb250ZXh0LmZ4bnMubGVuZ3RoID09PSAxICYmIGNvbnRleHQuZnhuc1swXS5meG4udHlwZSAhPT0gRnVuY3Rpb25UeXBlcy5CT09MRUFOKSB7XG4gICAgICByZXAgPSBcInJlc3VsdFwiO1xuICAgICAgZmllbGQgPSBjb250ZXh0LmZ4bnNbMF0uZnhuLnByb2plY3RlZEFzO1xuICAgIH0gZWxzZSBpZighaGFzQ29sbGVjdGlvbnMgJiYgY29udGV4dC5hdHRyaWJ1dGVzLmxlbmd0aCA9PT0gMSkge1xuICAgICAgcmVwID0gXCJyZXN1bHRcIjtcbiAgICAgIGZpZWxkID0gY29udGV4dC5hdHRyaWJ1dGVzWzBdLmF0dHJpYnV0ZS5wcm9qZWN0ZWRBcztcbiAgICB9IGVsc2UgaWYoY29udGV4dC5lbnRpdGllcy5sZW5ndGggKyBjb250ZXh0LmZ4bnMubGVuZ3RoID09PSB0b3RhbEZvdW5kKSB7XG4gICAgICAvLyBpZiB0aGVyZSBhcmUgb25seSBlbnRpdGllcyBhbmQgYm9vbGVhbiBmdW5jdGlvbnMgdGhlbiB3ZSB3YW50IHRvIHNob3cgdGhpcyBhcyBjYXJkc1xuICAgICAgcGFyYW1zW1wicmVwXCJdID0gXCJlbnRpdHlcIjtcbiAgICB9IGVsc2UgaWYoY3VycmVudFBhcnNlLnF1ZXJ5ICYmIGN1cnJlbnRQYXJzZS5xdWVyeS5wcm9qZWN0cy5sZW5ndGgpIHtcbiAgICAgIHN0YXRpY09yTWFwcGVkVGFibGUoY29udGVudCwgcGFyYW1zKTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gRXJyb3Igc3RhdGUsIHVua25vd24gZW50aXR5XG4gICAgICBwYXJhbXNbXCJyZXBcIl0gPSBcImVycm9yXCI7XG4gICAgfVxuICAgIGlmKHJlcCkge1xuICAgICAgcGFyYW1zW1wicmVwXCJdID0gcmVwO1xuICAgICAgcGFyYW1zW1wiZmllbGRcIl0gPSBmaWVsZDtcbiAgICB9XG4gIH1cbiAgY29uc29sZS5sb2coXCJQQVJBTVNcIiwgcGFyYW1zKTtcbiAgcmV0dXJuIHBhcmFtcztcbn1cblxudmFyIHBhbmVFZGl0b3JzID0ge307XG5leHBvcnQgZnVuY3Rpb24gd2lraUVkaXRvcihub2RlLCBlbGVtKSB7XG4gIGNyZWF0ZUVkaXRvcihub2RlLCBlbGVtKTtcbiAgbGV0IHtwYW5lSWQsIGVudGl0eUlkfSA9IGVsZW0ubWV0YTtcbiAgcGFuZUVkaXRvcnNbYCR7cGFuZUlkfXwke2VudGl0eUlkfWBdID0gbm9kZS5lZGl0b3I7XG59XG5cbmZ1bmN0aW9uIHJlcGFyZW50Q2VsbChub2RlLCBlbGVtKSB7XG4gIGlmKG5vZGUucGFyZW50Tm9kZS5pZCAhPT0gZWxlbS5jb250YWluZXJJZCkge1xuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGVsZW0uY29udGFpbmVySWQpLmFwcGVuZENoaWxkKG5vZGUpO1xuICB9XG4gIG5vZGUucGFyZW50Tm9kZVtcIm1hcmtcIl0uY2hhbmdlZCgpO1xufVxuXG5mdW5jdGlvbiBmb2N1c0NlbGxFZGl0b3Iobm9kZSwgZWxlbSkge1xuICBhdXRvRm9jdXMobm9kZSwgZWxlbSk7XG4gIGlmKCFub2RlLmRpZEZvY3VzKSB7XG4gICAgbm9kZS5kaWRGb2N1cyA9IHRydWU7XG4gICAgc2V0RW5kT2ZDb250ZW50RWRpdGFibGUobm9kZSk7XG4gIH1cbn1cblxuLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuZnVuY3Rpb24gY2VsbEVkaXRvcihlbnRpdHlJZCwgcGFuZUlkLCBjZWxsKTpFbGVtZW50IHtcbiAgbGV0IHRleHQgPSBhY3RpdmVDZWxsc1tjZWxsLmlkXS5xdWVyeTtcbiAgbGV0IHtvcHRpb25zLCBzZWxlY3RlZH0gPSBhdXRvY29tcGxldGVyT3B0aW9ucyhlbnRpdHlJZCwgcGFuZUlkLCBjZWxsKTtcbiAgbGV0IGF1dG9Gb2N1cyA9IHRydWU7XG4gIGlmKHRleHQubWF0Y2goL1xcJFxcJC4qXFwkXFwkLykpIHtcbiAgICB0ZXh0ID0gXCJcIjtcbiAgfVxuXG4gIGxldCB7bmFtZSA9IHVuZGVmaW5lZH0gPSBldmUuZmluZE9uZShcImRpc3BsYXkgbmFtZVwiLCB7aWQ6IHRleHR9KSB8fCB7fTtcbiAgaWYobmFtZSkge1xuICAgIHRleHQgPSBuYW1lO1xuICB9XG4gIHJldHVybiB7Y2hpbGRyZW46IFtcbiAgICB7YzogXCJlbWJlZGRlZC1jZWxsXCIsIGNoaWxkcmVuOiBbXG4gICAgICB7YzogXCJhZG9ybm1lbnRcIiwgdGV4dDogXCI9XCJ9LFxuICAgICAge3Q6IFwic3BhblwiLCBjOlwiXCIsIGNvbnRlbnRFZGl0YWJsZTogdHJ1ZSwgdGV4dCwgY2xpY2s6IHByZXZlbnREZWZhdWx0LCBpbnB1dDogdXBkYXRlQWN0aXZlQ2VsbCwga2V5ZG93bjogZW1iZWRkZWRDZWxsS2V5cywgY2VsbCwgc2VsZWN0ZWQsIHBhbmVJZCwgcG9zdFJlbmRlcjogYXV0b0ZvY3VzID8gZm9jdXNDZWxsRWRpdG9yIDogdW5kZWZpbmVkfSxcbiAgICBdfSxcbiAgICBhdXRvY29tcGxldGVyKG9wdGlvbnMsIHBhbmVJZCwgY2VsbClcbiAgXX07XG59XG5cbmZ1bmN0aW9uIGF1dG9jb21wbGV0ZXIob3B0aW9ucywgcGFuZUlkLCBjZWxsKTogRWxlbWVudCB7XG4gIGxldCBjaGlsZHJlbiA9IFtdO1xuICBmb3IobGV0IG9wdGlvbiBvZiBvcHRpb25zKSB7XG4gICAgbGV0IGl0ZW0gPSB7YzogXCJvcHRpb25cIiwgY2hpbGRyZW46IG9wdGlvbi5jaGlsZHJlbiwgdGV4dDogb3B0aW9uLnRleHQsIHNlbGVjdGVkOiBvcHRpb24sIGNlbGwsIHBhbmVJZCwgY2xpY2s6IGV4ZWN1dGVBdXRvY29tcGxldGVyT3B0aW9uLCBrZXlkb3duOiBvcHRpb25LZXlzfTtcbiAgICBpZihvcHRpb24uc2VsZWN0ZWQpIHtcbiAgICAgIGl0ZW0uYyArPSBcIiBzZWxlY3RlZFwiO1xuICAgIH1cbiAgICBjaGlsZHJlbi5wdXNoKGl0ZW0pO1xuICB9XG4gIHJldHVybiB7YzogXCJhdXRvY29tcGxldGVyXCIsIGtleTogcGVyZm9ybWFuY2Uubm93KCkudG9TdHJpbmcoKSwgY2VsbCwgY29udGFpbmVySWQ6IGAke3BhbmVJZH18JHtjZWxsLmlkfXxjb250YWluZXJgLCBjaGlsZHJlbiwgcG9zdFJlbmRlcjogcG9zaXRpb25BdXRvY29tcGxldGVyfTtcbn1cblxuZnVuY3Rpb24gb3B0aW9uS2V5cyhldmVudCwgZWxlbSkge1xuICBpZihldmVudC5rZXlDb2RlID09PSBLRVlTLkVOVEVSKSB7XG4gICAgZXhlY3V0ZUF1dG9jb21wbGV0ZXJPcHRpb24oZXZlbnQuY3VycmVudFRhcmdldCwgZWxlbSk7XG4gIH1cbn1cblxuZnVuY3Rpb24gZXhlY3V0ZUF1dG9jb21wbGV0ZXJPcHRpb24oZXZlbnQsIGVsZW0pIHtcbiAgaWYoZXZlbnQuZGVmYXVsdFByZXZlbnRlZCkgcmV0dXJuO1xuICBsZXQge3BhbmVJZCwgY2VsbH0gPSBlbGVtO1xuICBsZXQgZWRpdG9yID0gcGFuZUVkaXRvcnNbY2VsbC5lZGl0b3JJZF07XG4gIGxldCBjbSA9IGVkaXRvci5jbUluc3RhbmNlO1xuICBsZXQgbWFyayA9IGVkaXRvci5tYXJrc1tjZWxsLmlkXTtcbiAgbGV0IGRvRW1iZWQgPSBtYWtlRG9FbWJlZEZ1bmN0aW9uKGNtLCBtYXJrLCBjZWxsLCBwYW5lSWQpO1xuICBpZihlbGVtLnNlbGVjdGVkICYmIGVsZW0uc2VsZWN0ZWQuYWN0aW9uKSB7XG4gICAgaWYodHlwZW9mIGVsZW0uc2VsZWN0ZWQuYWN0aW9uID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgIGVsZW0uc2VsZWN0ZWQuYWN0aW9uKGVsZW0sIGNlbGwucXVlcnksIGRvRW1iZWQpO1xuICAgIH1cbiAgfVxufVxuXG5mdW5jdGlvbiBhdXRvY29tcGxldGVyT3B0aW9ucyhlbnRpdHlJZCwgcGFuZUlkLCBjZWxsKSB7XG4gIGxldCBbdGV4dCwgcmF3UGFyYW1zXSA9IGNlbGwucXVlcnkudHJpbSgpLnNwbGl0KFwifFwiKTtcbiAgaWYodGV4dC5tYXRjaCgvXFwkXFwkLipcXCRcXCQvKSkge1xuICAgIHJldHVybiB7b3B0aW9uczogW10sIHNlbGVjdGVkOiB7fX07XG4gIH1cbiAgbGV0IHBhcmFtcyA9IHt9O1xuICB0cnkge1xuICAgIHBhcmFtcyA9IGdldENlbGxQYXJhbXModGV4dCwgcmF3UGFyYW1zKTtcbiAgfSBjYXRjaChlKSB7XG4gICAgLy8gQFRPRE86IGV2ZW50dWFsbHkgcGVvcGxlIHNob3VsZG4ndCBiZSB0eXBpbmcgcGFyYW1zIGluIGhlcmUgc28gd2Ugc2hvdWxkIHByb2JhYmx5IGJlIGRvaW5nXG4gICAgLy8gc29tZXRoaW5nIGVsc2UuIEJ1dCBmb3Igbm93LCBpZiB5b3UncmUgZG9pbmcgdGhpcywgeW91J3JlIHNwZWNpYWwuXG4gIH1cbiAgbGV0IGNvbnRlbnRFbnRpdHlJZCA9IGFzRW50aXR5KHRleHQpO1xuICBpZihjb250ZW50RW50aXR5SWQpIHtcbiAgICB0ZXh0ID0gdWl0ay5yZXNvbHZlTmFtZShjb250ZW50RW50aXR5SWQpO1xuICB9XG5cbiAgbGV0IGlzRW50aXR5ID0gZXZlLmZpbmRPbmUoXCJkaXNwbGF5IG5hbWVcIiwge2lkOiBjb250ZW50RW50aXR5SWR9KTtcbiAgbGV0IHBhcnNlZCA9IFtdO1xuICBpZih0ZXh0ICE9PSBcIlwiKSB7XG4gICAgdHJ5IHtcbiAgICAgIHBhcnNlZCA9IHNhZmVOTFBhcnNlKHRleHQpOyAvLyBAVE9ETzogdGhpcyBzaG91bGQgY29tZSBmcm9tIHRoZSBOTFAgcGFyc2VyIG9uY2UgaXQncyBob29rZWQgdXAuXG4gICAgfSBjYXRjaChlKSB7XG5cbiAgICB9XG4gIH1cbiAgLy8gdGhlIGF1dG9jb21wbGV0ZSBjYW4gaGF2ZSBtdWx0aXBsZSBzdGF0ZXNcbiAgbGV0IHN0YXRlID0gY2VsbC5zdGF0ZSB8fCBcInF1ZXJ5XCI7XG4gIC8vIGV2ZXJ5IG9wdGlvbiBoYXMgYSBzY29yZSBmb3IgaG93IHBlcnRpbmVudCBpdCBpc1xuICAvLyB0aGluZ3Mgd2l0aCBhIHNjb3JlIG9mIDAgd2lsbCBiZSBmaWx0ZXJlZCwgZXZlcnl0aGluZyBlbHNlXG4gIC8vIHdpbGwgYmUgc29ydGVkIGRlc2NlbmRpbmcuXG4gIGxldCBvcHRpb25zOntzY29yZTogbnVtYmVyLCBhY3Rpb246IGFueSwgdGV4dD86IHN0cmluZywgY2hpbGRyZW4/OiBFbGVtZW50W119W107XG4gIGlmKHN0YXRlID09PSBcInF1ZXJ5XCIpIHtcbiAgICBvcHRpb25zID0gcXVlcnlBdXRvY29tcGxldGVPcHRpb25zKGlzRW50aXR5LCBwYXJzZWQsIHRleHQsIHBhcmFtcywgZW50aXR5SWQpO1xuICB9IGVsc2UgaWYoc3RhdGUgPT09IFwicmVwcmVzZW50XCIpIHtcbiAgICBvcHRpb25zID0gcmVwcmVzZW50QXV0b2NvbXBsZXRlT3B0aW9ucyhpc0VudGl0eSwgcGFyc2VkLCB0ZXh0LCBwYXJhbXMsIGVudGl0eUlkKTtcbiAgfSBlbHNlIGlmKHN0YXRlID09PSBcImNyZWF0ZVwiKSB7XG4gICAgb3B0aW9ucyA9IGNyZWF0ZUF1dG9jb21wbGV0ZU9wdGlvbnMoaXNFbnRpdHksIHBhcnNlZCwgdGV4dCwgcGFyYW1zLCBlbnRpdHlJZCk7XG4gIH0gZWxzZSBpZihzdGF0ZSA9PT0gXCJkZWZpbmVcIikge1xuICAgIG9wdGlvbnMgPSBkZWZpbmVBdXRvY29tcGxldGVPcHRpb25zKGlzRW50aXR5LCBwYXJzZWQsIHRleHQsIHBhcmFtcywgZW50aXR5SWQpO1xuICB9IGVsc2UgaWYoc3RhdGUgPT09IFwibW9kaWZ5XCIpIHtcbiAgICBvcHRpb25zID0gbW9kaWZ5QXV0b2NvbXBsZXRlT3B0aW9ucyhpc0VudGl0eSwgcGFyc2VkLCB0ZXh0LCBwYXJhbXMsIGVudGl0eUlkKTtcbiAgfSBlbHNlIGlmKHN0YXRlID09PSBcInByb3BlcnR5XCIpIHtcbiAgICBvcHRpb25zID0gcHJvcGVydHlBdXRvY29tcGxldGVPcHRpb25zKGlzRW50aXR5LCBwYXJzZWQsIHRleHQsIHBhcmFtcywgZW50aXR5SWQpO1xuICB9IGVsc2UgaWYoc3RhdGUgPT09IFwidXJsXCIpIHtcbiAgICBvcHRpb25zID0gdXJsQXV0b2NvbXBsZXRlT3B0aW9ucyhpc0VudGl0eSwgcGFyc2VkLCB0ZXh0LCBwYXJhbXMsIGVudGl0eUlkKTtcbiAgfVxuICBvcHRpb25zID0gb3B0aW9ucy5zb3J0KChhLCBiKSA9PiBiLnNjb3JlIC0gYS5zY29yZSk7XG4gIGxldCBzZWxlY3RlZDtcbiAgaWYob3B0aW9ucy5sZW5ndGgpIHtcbiAgICBsZXQgc2VsZWN0ZWRJeCA9IGNlbGwuc2VsZWN0ZWQgJSBvcHRpb25zLmxlbmd0aDtcbiAgICBpZihzZWxlY3RlZEl4IDwgMCkgc2VsZWN0ZWRJeCA9IG9wdGlvbnMubGVuZ3RoICsgc2VsZWN0ZWRJeDtcbiAgICBzZWxlY3RlZCA9IG9wdGlvbnNbc2VsZWN0ZWRJeF07XG4gICAgc2VsZWN0ZWQuc2VsZWN0ZWQgPSB0cnVlO1xuICB9XG4gIGZvcihsZXQgb3B0aW9uIG9mIG9wdGlvbnMpIHtcbiAgICBvcHRpb25bXCJjZWxsXCJdID0gY2VsbDtcbiAgICBvcHRpb25bXCJwYW5lSWRcIl0gPSBwYW5lSWQ7XG4gIH1cbiAgcmV0dXJuIHtvcHRpb25zLCBzZWxlY3RlZH07XG59XG5cbmZ1bmN0aW9uIHBvc2l0aW9uQXV0b2NvbXBsZXRlcihub2RlLCBlbGVtKSB7XG4gIGxldCBjb250YWluZXJJZCA9IGVsZW0uY29udGFpbmVySWQ7XG4gIGxldCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChjb250YWluZXJJZCk7XG4gIGxldCB7Ym90dG9tLCBsZWZ0fSA9IGNvbnRhaW5lci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChub2RlKTtcbiAgbm9kZS5zdHlsZS50b3AgPSBib3R0b207XG4gIG5vZGUuc3R5bGUubGVmdCA9IGxlZnQ7XG59XG5cbmZ1bmN0aW9uIHF1ZXJ5QXV0b2NvbXBsZXRlT3B0aW9ucyhpc0VudGl0eSwgcGFyc2VkLCB0ZXh0LCBwYXJhbXMsIGVudGl0eUlkKSB7XG4gIGxldCBwYWdlTmFtZSA9IHVpdGsucmVzb2x2ZU5hbWUoZW50aXR5SWQpO1xuICBsZXQgb3B0aW9uczp7c2NvcmU6IG51bWJlciwgYWN0aW9uOiBhbnksIHRleHQ6IHN0cmluZywgW2F0dHI6c3RyaW5nXTogYW55fVtdID0gW107XG4gIGxldCBoYXNWYWxpZFBhcnNlID0gcGFyc2VkLnNvbWUoKHBhcnNlKSA9PiBwYXJzZS5pbnRlbnQgPT09IEludGVudHMuUVVFUlkpO1xuICBwYXJzZWQuc29ydCgoYSwgYikgPT4gYi5zY29yZSAtIGEuc2NvcmUpO1xuICBsZXQgdG9wT3B0aW9uID0gcGFyc2VkWzBdO1xuICBsZXQgam9pbmVyID0gXCJhXCI7XG4gIGlmKHRleHQgJiYgdGV4dFswXS5tYXRjaCgvW2FlaW91XS9pKSkge1xuICAgIGpvaW5lciA9IFwiYW5cIjtcbiAgfVxuXG4gIGxldCBpc0F0dHJpYnV0ZSA9IGZhbHNlO1xuICBpZih0b3BPcHRpb24pIHtcbiAgICBsZXQgdG90YWxGb3VuZCA9IDA7XG4gICAgbGV0IHtjb250ZXh0fSA9IHRvcE9wdGlvbjtcbiAgICBmb3IobGV0IGl0ZW0gaW4gY29udGV4dCkge1xuICAgICAgdG90YWxGb3VuZCArPSBjb250ZXh0W2l0ZW1dLmxlbmd0aDtcbiAgICB9XG4gICAgbGV0IGlzRW50QXR0ciA9IHRvdGFsRm91bmQgPT09IDIgJiYgKGNvbnRleHQuZW50aXRpZXMubGVuZ3RoID09PSAxIHx8IGNvbnRleHQuY29sbGVjdGlvbnMubGVuZ3RoID09PSAxKTtcbiAgICBpZihpc0VudEF0dHIgJiYgY29udGV4dC5tYXliZUF0dHJpYnV0ZXMubGVuZ3RoID09PSAxKSB7XG4gICAgICBvcHRpb25zLnB1c2goe3Njb3JlOiA0LCAgYWN0aW9uOiBzZXRDZWxsU3RhdGUsIHN0YXRlOiBcImRlZmluZVwiLCB0ZXh0OiBgYWRkICR7dGV4dH1gfSk7XG4gICAgICBpc0F0dHJpYnV0ZSA9IHRydWU7XG4gICAgfSBlbHNlIGlmKGlzRW50QXR0ciAmJiBjb250ZXh0LmF0dHJpYnV0ZXMubGVuZ3RoID09PSAxKSB7XG4gICAgICBvcHRpb25zLnB1c2goe3Njb3JlOiAyLjUsICBhY3Rpb246IHNldENlbGxTdGF0ZSwgc3RhdGU6IFwibW9kaWZ5XCIsIHRleHQ6IGBtb2RpZnkgJHt0ZXh0fWB9KTtcbiAgICB9XG4gIH1cbiAgLy8gY3JlYXRlXG4gIGlmKCFpc0VudGl0eSAmJiB0ZXh0ICE9PSBcIlwiICYmIHRleHQgIT0gXCI9XCIpIHtcbiAgICBvcHRpb25zLnB1c2goe3Njb3JlOiAxLCAgYWN0aW9uOiBzZXRDZWxsU3RhdGUsIHN0YXRlOiBcImNyZWF0ZVwiLCB0ZXh0OiBgQ3JlYXRlICR7am9pbmVyfSBcIiR7dGV4dH1cIiBwYWdlYH0pO1xuICB9XG4gIC8vIGRpc2FtYmlndWF0aW9uc1xuICBpZihwYXJzZWQubGVuZ3RoID4gMSkge1xuICAgIG9wdGlvbnMucHVzaCh7c2NvcmU6IDMsIGFjdGlvbjogXCJkaXNhbWJpZ3VhdGUgc3R1ZmZcIiwgdGV4dDogXCJESVNBTUJJR1VBVEUhXCJ9KTtcbiAgfVxuICBpZighaXNFbnRpdHkgJiYgaGFzVmFsaWRQYXJzZSAmJiBwYXJhbXNbXCJyZXBcIl0pIHtcbiAgICBvcHRpb25zLnB1c2goe3Njb3JlOiA0LCBhY3Rpb246IGVtYmVkQXMsIHJlcDogcGFyYW1zW1wicmVwXCJdLCBwYXJhbXMsIHRleHQ6IGBlbWJlZCBhcyBhICR7cGFyYW1zW1wicmVwXCJdfWB9KTtcbiAgfVxuICAvLyByZXBlc2VudGF0aW9uXG4gIC8vIHdlIGNhbiBvbmx5IHJlcGVzZW50IHRoaW5ncyBpZiB3ZSd2ZSBmb3VuZCB0aGVtXG4gIGlmKGlzRW50aXR5IHx8IGhhc1ZhbGlkUGFyc2UpIHtcbiAgICAvLyBAVE9ETzogaG93IGRvIHdlIGZpZ3VyZSBvdXQgd2hhdCByZXByZXNlbnRhdGlvbnMgYWN0dWFsbHkgbWFrZSBzZW5zZSB0byBzaG93P1xuICAgIG9wdGlvbnMucHVzaCh7c2NvcmU6IDIsIGFjdGlvbjogc2V0Q2VsbFN0YXRlLCBzdGF0ZTogXCJyZXByZXNlbnRcIiwgdGV4dDogYGVtYmVkIGFzIC4uLmB9KTtcbiAgfVxuICAvLyBzZXQgYXR0cmlidXRlXG4gIGlmKHRleHQgJiYgZXZlLmZpbmRPbmUoXCJpbmRleCBuYW1lXCIsIHtpZDogZW50aXR5SWR9KS5uYW1lICE9PSB0ZXh0LnRvTG93ZXJDYXNlKCkpIHtcbiAgICBpZighaXNBdHRyaWJ1dGUpIHtcbiAgICAgIG9wdGlvbnMucHVzaCh7c2NvcmU6IDIuNSwgYWN0aW9uOiBzZXRDZWxsU3RhdGUsIHN0YXRlOiBcInByb3BlcnR5XCIsIHRleHQ6IGBhZGQgYXMgYSBwcm9wZXJ0eSBvZiAke3BhZ2VOYW1lfWB9KVxuICAgIH1cbiAgICBpZihpc0VudGl0eSkgIHtcbiAgICAgIGxldCBpc0FTY29yZSA9IDIuNTtcbiAgICAgIGlmKGV2ZS5maW5kT25lKFwiY29sbGVjdGlvblwiLCB7Y29sbGVjdGlvbjogaXNFbnRpdHkuaWR9KSkge1xuICAgICAgICBpc0FTY29yZSA9IDM7XG4gICAgICB9XG4gICAgICBvcHRpb25zLnB1c2goe3Njb3JlOiAyLjUsIGFjdGlvbjogYWRkQXR0cmlidXRlQW5kRW1iZWQsIHJlcGxhY2U6IFwiaXMgYVwiLCBlbnRpdHlJZCwgdmFsdWU6IGlzRW50aXR5LmlkLCBhdHRyaWJ1dGU6IFwicmVsYXRlZCB0b1wiLCB0ZXh0OiBgJHtwYWdlTmFtZX0gaXMgcmVsYXRlZCB0byAke3RleHR9YH0pO1xuICAgICAgb3B0aW9ucy5wdXNoKHtzY29yZTogaXNBU2NvcmUsIGFjdGlvbjogYWRkQXR0cmlidXRlQW5kRW1iZWQsIHJlcGxhY2U6IFwicmVsYXRlZCB0b1wiLCBlbnRpdHlJZCwgdmFsdWU6IGlzRW50aXR5LmlkLCBhdHRyaWJ1dGU6IFwiaXMgYVwiLCB0ZXh0OiBgJHtwYWdlTmFtZX0gaXMgJHtqb2luZXJ9ICR7dGV4dH1gfSk7XG4gICAgfVxuICB9XG5cbiAgLy8gdXJsIGVtYmVkZGluZ1xuICBpZih1cmxSZWdleC5leGVjKHRleHQpKSB7XG4gICAgb3B0aW9ucy5wdXNoKHtzY29yZTogMywgYWN0aW9uOiAgc2V0Q2VsbFN0YXRlLCBzdGF0ZTogXCJ1cmxcIiwgdGV4dDogXCJlbWJlZCB1cmwgYXMuLi5cIn0pO1xuICB9XG4gIHJldHVybiBvcHRpb25zO1xufVxuXG5mdW5jdGlvbiBhZGRBdHRyaWJ1dGVBbmRFbWJlZChlbGVtLCBzdHJWYWx1ZSwgZG9FbWJlZCkge1xuICBsZXQge2VudGl0eUlkLCB2YWx1ZSwgYXR0cmlidXRlLCByZXBsYWNlfSA9IGVsZW0uc2VsZWN0ZWQ7XG4gIGxldCBjaGFpbiA9IGRpc3BhdGNoKFwiYWRkIHNvdXJjZWQgZWF2XCIsIHtlbnRpdHk6IGVudGl0eUlkLCBhdHRyaWJ1dGUsIHZhbHVlLCBzb3VyY2U6IHV1aWQoKX0pO1xuICBpZihyZXBsYWNlKSB7XG4gICAgY2hhaW4uZGlzcGF0Y2goXCJyZW1vdmUgZW50aXR5IGF0dHJpYnV0ZVwiLCB7ZW50aXR5OiBlbnRpdHlJZCwgYXR0cmlidXRlOiByZXBsYWNlLCB2YWx1ZX0pO1xuICB9XG4gIGNoYWluLmNvbW1pdCgpO1xuICBkb0VtYmVkKGAke3ZhbHVlfXxyZXA9bGluaztgKTtcbn1cblxuZnVuY3Rpb24gc2V0Q2VsbFN0YXRlKGVsZW0sIHZhbHVlLCBkb0VtYmVkKSB7XG4gIGRpc3BhdGNoKFwic2V0Q2VsbFN0YXRlXCIsIHtpZDogZWxlbS5jZWxsLmlkLCBzdGF0ZTogZWxlbS5zZWxlY3RlZC5zdGF0ZX0pLmNvbW1pdCgpO1xufVxuXG5mdW5jdGlvbiBjcmVhdGVBdXRvY29tcGxldGVPcHRpb25zKGlzRW50aXR5LCBwYXJzZWQsIHRleHQsIHBhcmFtcywgZW50aXR5SWQpIHtcbiAgbGV0IG9wdGlvbnM6e3Njb3JlOiBudW1iZXIsIGFjdGlvbjogYW55LCB0ZXh0OiBzdHJpbmcsIFthdHRyOnN0cmluZ106IGFueX1bXSA9IFtdO1xuICBsZXQgcGFnZU5hbWUgPSB1aXRrLnJlc29sdmVOYW1lKGVudGl0eUlkKTtcbiAgbGV0IGlzQ29sbGVjdGlvbiA9IGlzRW50aXR5ID8gZXZlLmZpbmRPbmUoXCJjb2xsZWN0aW9uXCIsIHtjb2xsZWN0aW9uOiBpc0VudGl0eS5pZH0pIDogZmFsc2U7XG4gIGxldCBqb2luZXIgPSBcImFcIjtcbiAgaWYodGV4dCAmJiB0ZXh0WzBdLm1hdGNoKC9bYWVpb3VdL2kpKSB7XG4gICAgam9pbmVyID0gXCJhblwiO1xuICB9XG4gIGxldCBpc0FTY29yZSA9IDIuNTtcbiAgaWYoaXNDb2xsZWN0aW9uKSB7XG4gICAgaXNBU2NvcmUgPSAzO1xuICB9XG4gIG9wdGlvbnMucHVzaCh7c2NvcmU6IDIuNSwgYWN0aW9uOiBjcmVhdGVBbmRFbWJlZCwgcmVwbGFjZTogXCJpcyBhXCIsIGVudGl0eUlkLCBhdHRyaWJ1dGU6IFwicmVsYXRlZCB0b1wiLCB0ZXh0OiBgJHtwYWdlTmFtZX0gaXMgcmVsYXRlZCB0byAke3RleHR9YH0pO1xuICBvcHRpb25zLnB1c2goe3Njb3JlOiBpc0FTY29yZSwgYWN0aW9uOiBjcmVhdGVBbmRFbWJlZCwgcmVwbGFjZTogXCJyZWxhdGVkIHRvXCIsIGVudGl0eUlkLCBhdHRyaWJ1dGU6IFwiaXMgYVwiLCB0ZXh0OiBgJHtwYWdlTmFtZX0gaXMgJHtqb2luZXJ9ICR7dGV4dH1gfSk7XG4gIHJldHVybiBvcHRpb25zO1xufVxuXG5mdW5jdGlvbiBjcmVhdGVBbmRFbWJlZChlbGVtLCB2YWx1ZSwgZG9FbWJlZCkge1xuICAvL2NyZWF0ZSB0aGUgcGFnZSBhbmQgZW1iZWQgYSBsaW5rIHRvIGl0XG4gIGxldCBlbnRpdHkgPSB1dWlkKCk7XG4gIGxldCBwYWdlID0gdXVpZCgpO1xuICBsZXQge2VudGl0eUlkLCBhdHRyaWJ1dGUsIHJlcGxhY2V9ID0gZWxlbS5zZWxlY3RlZDtcbiAgbGV0IGNoYWluID0gZGlzcGF0Y2goXCJjcmVhdGUgcGFnZVwiLCB7cGFnZSwgY29udGVudDogYGB9KVxuICAuZGlzcGF0Y2goXCJjcmVhdGUgZW50aXR5XCIsIHtlbnRpdHksIHBhZ2UsIG5hbWU6IHZhbHVlfSlcbiAgLmRpc3BhdGNoKFwiYWRkIHNvdXJjZWQgZWF2XCIsIHtlbnRpdHk6IGVudGl0eUlkLCBhdHRyaWJ1dGUsIHZhbHVlOiBlbnRpdHksIHNvdXJjZTogdXVpZCgpfSk7XG4gIGlmKHJlcGxhY2UpIHtcbiAgICBjaGFpbi5kaXNwYXRjaChcInJlbW92ZSBlbnRpdHkgYXR0cmlidXRlXCIsIHtlbnRpdHk6IGVudGl0eUlkLCBhdHRyaWJ1dGU6IHJlcGxhY2UsIHZhbHVlOiBlbnRpdHl9KTtcbiAgfVxuICBjaGFpbi5jb21taXQoKTtcbiAgZG9FbWJlZChgJHt2YWx1ZX18cmVwPWxpbms7YCk7XG59XG5cbmZ1bmN0aW9uIHJlcHJlc2VudEF1dG9jb21wbGV0ZU9wdGlvbnMoaXNFbnRpdHksIHBhcnNlZCwgdGV4dCwgcGFyYW1zLCBlbnRpdHlJZCkge1xuICBsZXQgb3B0aW9uczp7c2NvcmU6IG51bWJlciwgYWN0aW9uOiBhbnksIHRleHQ6IHN0cmluZywgW2F0dHI6c3RyaW5nXTogYW55fVtdID0gW107XG4gIGxldCBpc0NvbGxlY3Rpb24gPSBpc0VudGl0eSA/IGV2ZS5maW5kT25lKFwiY29sbGVjdGlvblwiLCB7Y29sbGVjdGlvbjogaXNFbnRpdHkuaWR9KSA6IGZhbHNlO1xuICBvcHRpb25zLnB1c2goe3Njb3JlOjEsIHRleHQ6IFwiYSB0YWJsZVwiLCBhY3Rpb246IGVtYmVkQXMsIHJlcDogXCJ0YWJsZVwiLCBwYXJhbXN9KTtcbiAgLy8gb3B0aW9ucy5wdXNoKHtzY29yZToxLCB0ZXh0OiBcImVtYmVkIGFzIGEgdmFsdWVcIiwgYWN0aW9uOiBlbWJlZEFzLCByZXA6IFwidmFsdWVcIn0pO1xuICBpZihpc0VudGl0eSkge1xuICAgIG9wdGlvbnMucHVzaCh7c2NvcmU6MSwgdGV4dDogXCJhIGxpbmtcIiwgYWN0aW9uOiBlbWJlZEFzLCByZXA6IFwibGlua1wiLCBwYXJhbXN9KTtcbiAgfVxuICBpZihpc0NvbGxlY3Rpb24pIHtcbiAgICBvcHRpb25zLnB1c2goe3Njb3JlOjEsIHRleHQ6IFwiYSBsaXN0XCIsIGFjdGlvbjogZW1iZWRBcywgcmVwOiBcImluZGV4XCIsIHBhcmFtc30pO1xuICAgIG9wdGlvbnMucHVzaCh7c2NvcmU6MSwgdGV4dDogXCJhIGRpcmVjdG9yeVwiLCBhY3Rpb246IGVtYmVkQXMsIHJlcDogXCJkaXJlY3RvcnlcIiwgcGFyYW1zfSk7XG4gIH1cbiAgaWYoaXNFbnRpdHkpIHtcbiAgICBvcHRpb25zLnB1c2goe3Njb3JlOjEsIHRleHQ6IFwiYSBsaXN0IG9mIHJlbGF0ZWQgcGFnZXNcIiwgYWN0aW9uOiBlbWJlZEFzLCByZXA6IFwicmVsYXRlZFwiLCBwYXJhbXN9KTtcbiAgICAvLyBvcHRpb25zLnB1c2goe3Njb3JlOjEsIHRleHQ6IFwiYSBwcm9wZXJ0aWVzIHRhYmxlXCIsIGFjdGlvbjogZW1iZWRBcywgcmVwOiBcImF0dHJpYnV0ZXNcIiwgcGFyYW1zfSk7XG4gIH1cbiAgcmV0dXJuIG9wdGlvbnM7XG59XG5cbmZ1bmN0aW9uIHVybEF1dG9jb21wbGV0ZU9wdGlvbnMoaXNFbnRpdHksIHBhcnNlZCwgdXJsOnN0cmluZywgcGFyYW1zLCBlbnRpdHlJZDpzdHJpbmcpIHtcbiAgLy8gQE5PVEU6IHVybCBtdXN0IGJlIG5vcm1hbGl6ZWQgYmVmb3JlIHJlYWNoaW5nIGhlcmUuXG4gIC8vIEBGSVhNRTogTmVlZCB0byBnZXQgYSB1cmwgcHJvcGVydHkgb250byB0aGUgcGFyYW1zLiBTaG91bGQgdGhhdCBiZSBkb25lIGhlcmU/XG4gIGxldCBleHQgPSB1cmwuc2xpY2UodXJsLmxhc3RJbmRleE9mKFwiLlwiKSArIDEpLnRyaW0oKS50b0xvd2VyQ2FzZSgpO1xuICBsZXQgZG9tYWluID0gdXJsLnNsaWNlKHVybC5pbmRleE9mKFwiLy9cIikgKyAyKS5zcGxpdChcIi9cIilbMF07XG4gIGxldCBpc0ltYWdlID0gW1wicG5nXCIsIFwianBnXCIsIFwianBlZ1wiLCBcImJtcFwiLCBcInRpZmZcIl0uaW5kZXhPZihleHQpICE9PSAtMTtcbiAgbGV0IGlzVmlkZW8gPSAoW1wibXA0XCIsIFwib2d2XCIsIFwid2VibVwiLCBcIm1vdlwiLCBcImF2aVwiLCBcImZsdlwiXS5pbmRleE9mKGV4dCkgIT09IC0xKSB8fCAoW1wid3d3LnlvdXR1YmUuY29tXCIsIFwieW91dHUuYmVcIl0uaW5kZXhPZihkb21haW4pICE9PSAtMSk7XG4gIGxldCBvcHRpb25zOntzY29yZTogbnVtYmVyLCBhY3Rpb246IGFueSwgdGV4dDogc3RyaW5nLCBbYXR0cjpzdHJpbmddOiBhbnl9W10gPSBbXG4gICAge3Njb3JlOiAyLCB0ZXh0OiBcImEgbGlua1wiLCBhY3Rpb246IGVtYmVkQXMsIHJlcDogXCJleHRlcm5hbExpbmtcIiwgcGFyYW1zfSxcbiAgICB7c2NvcmU6IGlzSW1hZ2UgPyAzIDogMSwgdGV4dDogXCJhbiBpbWFnZVwiLCBhY3Rpb246IGVtYmVkQXMsIHJlcDogXCJleHRlcm5hbEltYWdlXCIsIHBhcmFtc30sXG4gICAge3Njb3JlOiBpc1ZpZGVvID8gMyA6IDEsIHRleHQ6IFwiYSB2aWRlb1wiLCBhY3Rpb246IGVtYmVkQXMsIHJlcDogXCJleHRlcm5hbFZpZGVvXCIsIHBhcmFtc30sXG4gIF07XG4gIHJldHVybiBvcHRpb25zO1xufVxuXG5mdW5jdGlvbiBlbWJlZEFzKGVsZW0sIHZhbHVlLCBkb0VtYmVkKSB7XG4gIGxldCBbdGV4dF0gPSB2YWx1ZS5zcGxpdChcInxcIik7XG4gIGxldCBwYXJhbXMgPSBlbGVtLnNlbGVjdGVkLnBhcmFtcztcbiAgbGV0IHJhd1BhcmFtcyA9IGByZXA9JHtlbGVtLnNlbGVjdGVkLnJlcH1gO1xuICBmb3IobGV0IHBhcmFtIGluIHBhcmFtcykge1xuICAgIGlmKHBhcmFtICE9PSBcInJlcFwiKSB7XG4gICAgICByYXdQYXJhbXMgKz0gYDsgJHtwYXJhbX09JHtwYXJhbXNbcGFyYW1dfWA7XG4gICAgfVxuICB9XG4gIGRvRW1iZWQoYCR7dGV4dH18JHtyYXdQYXJhbXN9YCk7XG59XG5cbmZ1bmN0aW9uIHByb3BlcnR5QXV0b2NvbXBsZXRlT3B0aW9ucyhpc0VudGl0eSwgcGFyc2VkLCB0ZXh0LCBwYXJhbXMsIGVudGl0eUlkKSB7XG4gIGxldCBvcHRpb25zOntzY29yZTogbnVtYmVyLCBhY3Rpb246IGFueSwgdGV4dD86IHN0cmluZywgW2F0dHI6c3RyaW5nXTogYW55fVtdID0gW107XG4gIGxldCB0b3BQYXJzZSA9IHBhcnNlZFswXTtcbiAgbGV0IGFzUXVlcnkgPSB0b3BQYXJzZSAmJiB0b3BQYXJzZS5pbnRlbnQgPT09IEludGVudHMuUVVFUlk7XG4gIGxldCBvcHRpb246YW55ID0ge3Njb3JlOiAxLCBhY3Rpb246IGRlZmluZVByb3BlcnR5QW5kRW1iZWQsIGVudGl0eUlkLCBhc1F1ZXJ5fTtcbiAgb3B0aW9uLmNoaWxkcmVuID0gW1xuICAgIHtjOiBcImF0dHJpYnV0ZS1uYW1lXCIsIHRleHQ6IFwicHJvcGVydHlcIn0sXG4gICAge2M6IFwiaW5saW5lLWNlbGxcIiwgY29udGVudEVkaXRhYmxlOiB0cnVlLCBzZWxlY3RlZDpvcHRpb24sIGtleWRvd246IGRlZmluZUtleXMsIHBvc3RSZW5kZXI6IGF1dG9Gb2N1c31cbiAgXVxuICBvcHRpb25zLnB1c2gob3B0aW9uKTtcbiAgcmV0dXJuIG9wdGlvbnM7XG59XG5cbmZ1bmN0aW9uIGRlZmluZVByb3BlcnR5QW5kRW1iZWQoZWxlbSwgdmFsdWUsIGRvRW1iZWQpIHtcbiAgbGV0IHtzZWxlY3RlZH0gPSBlbGVtO1xuICBsZXQge2VudGl0eUlkLCBhc1F1ZXJ5LCBkZWZpbmVWYWx1ZX0gPSBzZWxlY3RlZDtcbiAgaWYoYXNRdWVyeSkge1xuICAgIHZhbHVlID0gYD0gJHt2YWx1ZX1gO1xuICB9XG4gIGxldCBzdWNjZXNzID0gaGFuZGxlQXR0cmlidXRlRGVmaW5pdGlvbihlbnRpdHlJZCwgZGVmaW5lVmFsdWUsIHZhbHVlKTtcbiAgbGV0IGVudGl0eU5hbWUgPSB1aXRrLnJlc29sdmVOYW1lKGVudGl0eUlkKTtcbiAgZG9FbWJlZChgJHtlbnRpdHlOYW1lfSdzICR7ZGVmaW5lVmFsdWV9fHJlcD1DU1Y7ZmllbGQ9JHtkZWZpbmVWYWx1ZX1gKTtcbn1cblxuZnVuY3Rpb24gZGVmaW5lQXV0b2NvbXBsZXRlT3B0aW9ucyhpc0VudGl0eSwgcGFyc2VkLCB0ZXh0LCBwYXJhbXMsIGVudGl0eUlkKSB7XG4gIGxldCBvcHRpb25zOntzY29yZTogbnVtYmVyLCBhY3Rpb246IGFueSwgdGV4dD86IHN0cmluZywgW2F0dHI6c3RyaW5nXTogYW55fVtdID0gW107XG4gIGxldCB0b3BQYXJzZSA9IHBhcnNlZFswXTtcbiAgbGV0IGNvbnRleHQgPSB0b3BQYXJzZS5jb250ZXh0O1xuICBsZXQgYXR0cmlidXRlO1xuICBpZihjb250ZXh0Lm1heWJlQXR0cmlidXRlc1swXSkge1xuICAgIGF0dHJpYnV0ZSA9IGNvbnRleHQubWF5YmVBdHRyaWJ1dGVzWzBdLm5hbWU7XG4gIH0gZWxzZSB7XG4gICAgYXR0cmlidXRlID0gY29udGV4dC5hdHRyaWJ1dGVzWzBdLmRpc3BsYXlOYW1lO1xuICB9XG4gIGxldCBzdWJqZWN0ID0gY29udGV4dC5lbnRpdGllc1swXSB8fCBjb250ZXh0LmNvbGxlY3Rpb25zWzBdO1xuICBsZXQgZW50aXR5ID0gc3ViamVjdC5pZDtcbiAgbGV0IG9wdGlvbjphbnkgPSB7c2NvcmU6IDEsIGFjdGlvbjogZGVmaW5lQW5kRW1iZWQsIGF0dHJpYnV0ZSwgZW50aXR5fTtcbiAgb3B0aW9uLmNoaWxkcmVuID0gW1xuICAgIHtjOiBcImF0dHJpYnV0ZS1uYW1lXCIsIHRleHQ6IGF0dHJpYnV0ZX0sXG4gICAge2M6IFwiaW5saW5lLWNlbGxcIiwgY29udGVudEVkaXRhYmxlOiB0cnVlLCBzZWxlY3RlZDpvcHRpb24sIGtleWRvd246IGRlZmluZUtleXMsIHBvc3RSZW5kZXI6IGF1dG9Gb2N1c31cbiAgXVxuICBvcHRpb25zLnB1c2gob3B0aW9uKTtcbiAgcmV0dXJuIG9wdGlvbnM7XG59XG5cbmZ1bmN0aW9uIGZvY3VzU2VsZWN0ZWQobm9kZSwgZWxlbSkge1xuICBpZihlbGVtLnNlbGVjdGVkLnNlbGVjdGVkICYmIG5vZGUgIT09IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQpe1xuICAgIG5vZGUuZm9jdXMoKTtcbiAgICBzZXRFbmRPZkNvbnRlbnRFZGl0YWJsZShub2RlKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBzZWxlY3RPcHRpb25JeChldmVudCwgZWxlbSkge1xuICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICBkaXNwYXRjaChcIm1vdmVDZWxsQXV0b2NvbXBsZXRlXCIsIHtjZWxsOiBlbGVtLnNlbGVjdGVkLmNlbGwsIHZhbHVlOiBlbGVtLm9wdGlvbkl4fSkuY29tbWl0KCk7XG59XG5cbmZ1bmN0aW9uIG1vZGlmeUF1dG9jb21wbGV0ZU9wdGlvbnMoaXNFbnRpdHksIHBhcnNlZCwgdGV4dCwgcGFyYW1zLCBlbnRpdHlJZCkge1xuICBsZXQgb3B0aW9uczp7c2NvcmU6IG51bWJlciwgYWN0aW9uOiBhbnksIHRleHQ/OiBzdHJpbmcsIFthdHRyOnN0cmluZ106IGFueX1bXSA9IFtdO1xuICBsZXQgdG9wUGFyc2UgPSBwYXJzZWRbMF07XG4gIGxldCBjb250ZXh0ID0gdG9wUGFyc2UuY29udGV4dDtcbiAgbGV0IGF0dHJpYnV0ZSA9IGNvbnRleHQuYXR0cmlidXRlc1swXS5kaXNwbGF5TmFtZTtcbiAgbGV0IHN1YmplY3QgPSBjb250ZXh0LmVudGl0aWVzWzBdIHx8IGNvbnRleHQuY29sbGVjdGlvbnNbMF07XG4gIGxldCBlbnRpdHkgPSBzdWJqZWN0LmlkO1xuICBsZXQgZWF2cyA9IGV2ZS5maW5kKFwiZW50aXR5IGVhdnNcIiwge2VudGl0eSwgYXR0cmlidXRlfSk7XG4gIGxldCBpeCA9IDA7XG4gIGxldCBzb3VyY2VzU2VlbiA9IHt9O1xuICBmb3IobGV0IGVhdiBvZiBlYXZzKSB7XG4gICAgbGV0IG9wdGlvbjphbnkgPSB7c2NvcmU6IDEsIGFjdGlvbjogbW9kaWZ5QW5kRW1iZWQsIGVhdiwgcGFyYW1zfTtcbiAgICBsZXQgZ2VuZXJhdGVkID0gZXZlLmZpbmRPbmUoXCJnZW5lcmF0ZWQgZWF2XCIsIHtlbnRpdHk6IGVhdi5lbnRpdHksIGF0dHJpYnV0ZTogZWF2LmF0dHJpYnV0ZSwgdmFsdWU6IGVhdi52YWx1ZX0pO1xuICAgIGxldCB0ZXh0ID0gZWF2LnZhbHVlO1xuICAgIGxldCBzb3VyY2VWaWV3O1xuICAgIGxldCBkaXNwbGF5ID0gZXZlLmZpbmRPbmUoXCJkaXNwbGF5IG5hbWVcIiwge2lkOiB0ZXh0fSk7XG4gICAgaWYoZ2VuZXJhdGVkKSB7XG4gICAgICBzb3VyY2VWaWV3ID0gZ2VuZXJhdGVkLnNvdXJjZTtcbiAgICAgIGlmKHNvdXJjZXNTZWVuW3NvdXJjZVZpZXddKSBjb250aW51ZTtcbiAgICAgIHNvdXJjZXNTZWVuW3NvdXJjZVZpZXddID0gdHJ1ZTtcbiAgICAgIHRleHQgPSBgPSAke2V2ZS5maW5kT25lKFwicXVlcnkgdG8gaWRcIiwge2lkOiBzb3VyY2VWaWV3fSkucXVlcnl9YDtcbiAgICAgIG9wdGlvbi5zb3VyY2VWaWV3ID0gc291cmNlVmlldztcbiAgICAgIG9wdGlvbi5xdWVyeSA9IHRleHQ7XG4gICAgfSBlbHNlIGlmKGRpc3BsYXkpIHtcbiAgICAgIHRleHQgPSBgPSAke2Rpc3BsYXkubmFtZX1gO1xuICAgIH1cbiAgICBvcHRpb24uY2hpbGRyZW4gPSBbXG4gICAgICB7YzogXCJhdHRyaWJ1dGUtbmFtZVwiLCB0ZXh0OiBhdHRyaWJ1dGV9LFxuICAgICAge2M6IFwiaW5saW5lLWNlbGxcIiwgY29udGVudEVkaXRhYmxlOiB0cnVlLCB0ZXh0LCBvcHRpb25JeDogaXgsIGNsaWNrOnNlbGVjdE9wdGlvbkl4LCBzZWxlY3RlZDpvcHRpb24sIGtleWRvd246IGRlZmluZUtleXMsIHBvc3RSZW5kZXI6IGZvY3VzU2VsZWN0ZWR9XG4gICAgXVxuICAgIG9wdGlvbnMucHVzaChvcHRpb24pO1xuICAgIGl4Kys7XG4gIH1cbiAgbGV0IG9wdGlvbjphbnkgPSB7c2NvcmU6IDEsIGFjdGlvbjogZGVmaW5lQW5kRW1iZWQsIGF0dHJpYnV0ZSwgZW50aXR5fTtcbiAgb3B0aW9uLmNoaWxkcmVuID0gW1xuICAgIHtjOiBcImF0dHJpYnV0ZS1uYW1lXCIsIHRleHQ6IGF0dHJpYnV0ZX0sXG4gICAge2M6IFwiaW5saW5lLWNlbGxcIiwgY29udGVudEVkaXRhYmxlOiB0cnVlLCBzZWxlY3RlZDpvcHRpb24sIGtleWRvd246IGRlZmluZUtleXMsIHBvc3RSZW5kZXI6IGZvY3VzU2VsZWN0ZWR9XG4gIF1cbiAgb3B0aW9ucy5wdXNoKG9wdGlvbik7XG4gIHJldHVybiBvcHRpb25zO1xufVxuXG5mdW5jdGlvbiBtb2RpZnlBbmRFbWJlZChlbGVtLCB0ZXh0LCBkb0VtYmVkKSB7XG4gIGxldCB7ZWF2LCBkZWZpbmVWYWx1ZSwgcGFyYW1zLCBzb3VyY2VWaWV3LCBxdWVyeX0gPSBlbGVtLnNlbGVjdGVkO1xuICBsZXQgc3VjY2VzcyA9IHN1Ym1pdEF0dHJpYnV0ZSh7Y3VycmVudFRhcmdldDoge3ZhbHVlOiBkZWZpbmVWYWx1ZX19LCB7ZWF2LCBzb3VyY2VWaWV3LCBxdWVyeX0pO1xuICBpZighc3VjY2Vzcykge1xuICAgIGNvbnNvbGUubG9nKFwiSSBkb24ndCBrbm93IHdoYXQgdG8gZG9cIik7XG4gIH1cbiAgLy8gaWYgeW91IGRpZG4ndCByZW1vdmUgYWxsIHRoZSBhdHRyaWJ1dGVzLCBqdXN0IHJlLWVtYmVkIHdoYXQgd2FzIHRoZXJlXG4gIGlmKGV2ZS5maW5kT25lKFwiZW50aXR5IGVhdnNcIiwge2VudGl0eTogZWF2LmVudGl0eSwgYXR0cmlidXRlOiBlYXYuYXR0cmlidXRlfSkpIHtcbiAgICBkb0VtYmVkKGAke3RleHR9fCR7c3RyaW5naWZ5UGFyYW1zKHBhcmFtcyl9YCk7XG4gIH0gZWxzZSB7XG4gICAgLy8gb3RoZXJ3aXNlIHRoZXJlJ3Mgbm8gcG9pbnQgaW4gZW1iZWRkaW5nIGFuIGVycm9yIGNlbGxcbiAgICBkb0VtYmVkKFwiXCIpO1xuICB9XG59XG5cbmZ1bmN0aW9uIGludGVycHJldEF0dHJpYnV0ZVZhbHVlKHZhbHVlKToge2lzVmFsdWU6IGJvb2xlYW4sIHBhcnNlPzphbnksIHZhbHVlPzphbnl9IHtcbiAgbGV0IGNsZWFuZWQgPSB2YWx1ZS50cmltKCk7XG4gIGxldCBpc051bWJlciA9IHBhcnNlRmxvYXQodmFsdWUpO1xuICBpZighaXNOdW1iZXIpIHtcbiAgICAvL3BhcnNlIGl0XG4gICAgY2xlYW5lZCA9IGNsZWFuZWQudHJpbSgpO1xuICAgIGxldCBlbnRpdHlJZCA9IGFzRW50aXR5KGNsZWFuZWQpO1xuICAgIGlmKGVudGl0eUlkKSB7XG4gICAgICByZXR1cm4ge2lzVmFsdWU6IHRydWUsIHZhbHVlOiBlbnRpdHlJZH07XG4gICAgfVxuICAgIGxldCBwYXJzZWQgPSBzYWZlTkxQYXJzZShjbGVhbmVkKTtcbiAgICByZXR1cm4ge2lzVmFsdWU6IGZhbHNlLCBwYXJzZTogcGFyc2VkLCB2YWx1ZTogY2xlYW5lZH07XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIHtpc1ZhbHVlOiB0cnVlLCB2YWx1ZTogY29lcmNlSW5wdXQoY2xlYW5lZCl9O1xuICB9XG59XG5cbmZ1bmN0aW9uIGhhbmRsZUF0dHJpYnV0ZURlZmluaXRpb24oZW50aXR5LCBhdHRyaWJ1dGUsIHNlYXJjaCwgY2hhaW4/KSB7XG4gIGlmKCFjaGFpbikge1xuICAgIGNoYWluID0gZGlzcGF0Y2goKTtcbiAgfVxuICBsZXQge2lzVmFsdWUsIHZhbHVlLCBwYXJzZX0gPSBpbnRlcnByZXRBdHRyaWJ1dGVWYWx1ZShzZWFyY2gpO1xuICBjb25zb2xlLmxvZyhcIkhBTkRMSU5HXCIsIGlzVmFsdWUsIHZhbHVlLCBwYXJzZSk7XG4gIGlmKGlzVmFsdWUpIHtcbiAgICBjaGFpbi5kaXNwYXRjaChcImFkZCBzb3VyY2VkIGVhdlwiLCB7ZW50aXR5LCBhdHRyaWJ1dGUsIHZhbHVlfSkuY29tbWl0KCk7XG4gIH0gZWxzZSB7XG4gICAgbGV0IHF1ZXJ5VGV4dCA9IHZhbHVlLnRyaW0oKTtcbiAgICAvLyBhZGQgdGhlIHF1ZXJ5XG4gICAgZGlzcGF0Y2goXCJpbnNlcnQgcXVlcnlcIiwge3F1ZXJ5OiBxdWVyeVRleHR9KS5jb21taXQoKTtcbiAgICAvLyBjcmVhdGUgYW5vdGhlciBxdWVyeSB0aGF0IHByb2plY3RzIGVhdnNcbiAgICBsZXQgY2xlYW5lZCA9IHF1ZXJ5VGV4dCAmJiBxdWVyeVRleHQudHJpbSgpLnRvTG93ZXJDYXNlKCk7XG4gICAgbGV0IHF1ZXJ5VG9JZCA9IGV2ZS5maW5kT25lKFwicXVlcnkgdG8gaWRcIiwge3F1ZXJ5OiBjbGVhbmVkfSk7XG4gICAgaWYoIXF1ZXJ5VG9JZCkgcmV0dXJuIGZhbHNlO1xuICAgIGxldCBpZCA9IHF1ZXJ5VG9JZC5pZDtcbiAgICBsZXQgcGFyYW1zID0gZ2V0Q2VsbFBhcmFtcyhxdWVyeVRleHQsIFwiXCIpO1xuICAgIGlmKCFwYXJhbXNbXCJmaWVsZFwiXSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0gZWxzZSB7XG4gICAgICAvL2J1aWxkIGEgcXVlcnlcbiAgICAgIGxldCBlYXZQcm9qZWN0ID0gYChxdWVyeSA6JCR2aWV3IFwiJHtlbnRpdHl9fCR7YXR0cmlidXRlfXwke2lkfVwiIChzZWxlY3QgXCIke2lkfVwiIDoke3BhcmFtc1tcImZpZWxkXCJdLnJlcGxhY2UoXCIgXCIsIFwiLVwiKX0gdmFsdWUpXG4gICAgICAocHJvamVjdCEgXCJnZW5lcmF0ZWQgZWF2XCIgOmVudGl0eSBcIiR7ZW50aXR5fVwiIDphdHRyaWJ1dGUgXCIke2F0dHJpYnV0ZX1cIiA6dmFsdWUgdmFsdWUgOnNvdXJjZSBcIiR7aWR9XCIpKWA7XG4gICAgICBjaGFpbi5kaXNwYXRjaChcImluc2VydCBpbXBsaWNhdGlvblwiLCB7cXVlcnk6IGVhdlByb2plY3R9KS5jb21taXQoKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHRydWU7XG59XG5cbmZ1bmN0aW9uIGRlZmluZUFuZEVtYmVkKGVsZW0sIHRleHQsIGRvRW1iZWQpIHtcbiAgbGV0IHtzZWxlY3RlZH0gPSBlbGVtO1xuICBsZXQge2VudGl0eSwgYXR0cmlidXRlLCBkZWZpbmVWYWx1ZX0gPSBzZWxlY3RlZDtcbiAgbGV0IHN1Y2Nlc3MgPSBoYW5kbGVBdHRyaWJ1dGVEZWZpbml0aW9uKGVudGl0eSwgYXR0cmlidXRlLCBkZWZpbmVWYWx1ZSk7XG4gIGlmKHN1Y2Nlc3MpIHtcbiAgICBkb0VtYmVkKGAke3RleHR9fHJlcD1DU1Y7ZmllbGQ9JHthdHRyaWJ1dGV9YCk7XG4gIH0gZWxzZSB7XG4gICAgY29uc29sZS5lcnJvcihcIkNvdWxkbid0IGZpZ3VyZSBvdXQgc3ViamVjdCBvZjogXCIgKyBkZWZpbmVWYWx1ZSk7XG4gICAgZG9FbWJlZChgJHt0ZXh0fXxyZXA9ZXJyb3I7bWVzc2FnZT1JIGNvdWxkbid0IGZpZ3VyZSBvdXQgdGhlIHN1YmplY3Qgb2YgdGhhdCBzZWFyY2g7YClcbiAgfVxufVxuXG5mdW5jdGlvbiBkZWZpbmVLZXlzKGV2ZW50LCBlbGVtKSB7XG4gIGxldCBjZWxsID0gZWxlbS5zZWxlY3RlZC5jZWxsO1xuICBpZihldmVudC5rZXlDb2RlID09PSBLRVlTLkVOVEVSKSB7XG4gICAgZWxlbS5zZWxlY3RlZC5kZWZpbmVWYWx1ZSA9IGV2ZW50LmN1cnJlbnRUYXJnZXQudGV4dENvbnRlbnQ7XG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgfSBlbHNlIGlmKGV2ZW50LmtleUNvZGUgPT09IEtFWVMuVVApIHtcbiAgICBkaXNwYXRjaChcIm1vdmVDZWxsQXV0b2NvbXBsZXRlXCIsIHtjZWxsLCBkaXJlY3Rpb246IC0xfSkuY29tbWl0KCk7XG4gIH0gZWxzZSBpZihldmVudC5rZXlDb2RlID09PSBLRVlTLkRPV04pIHtcbiAgICBkaXNwYXRjaChcIm1vdmVDZWxsQXV0b2NvbXBsZXRlXCIsIHtjZWxsLCBkaXJlY3Rpb246IDF9KS5jb21taXQoKTtcbiAgfSBlbHNlIGlmKGV2ZW50LmtleUNvZGUgPT09IEtFWVMuRVNDKSB7XG4gICAgZGlzcGF0Y2goXCJjbGVhckFjdGl2ZUNlbGxzXCIpLmNvbW1pdCgpO1xuICAgIGlmKGVsZW0uc2VsZWN0ZWQucGFuZUlkKSB7XG4gICAgICBwYW5lRWRpdG9yc1tjZWxsLmVkaXRvcklkXS5jbUluc3RhbmNlLmZvY3VzKCk7XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIG1heWJlQWN0aXZhdGVDZWxsKGNtLCBwYW5lSWQpIHtcbiAgaWYoIWNtLnNvbWV0aGluZ1NlbGVjdGVkKCkpIHtcbiAgICBsZXQgcG9zID0gY20uZ2V0Q3Vyc29yKFwiZnJvbVwiKTtcbiAgICBsZXQgbWFya3MgPSBjbS5maW5kTWFya3NBdChwb3MpO1xuICAgIGxldCBjZWxsO1xuICAgIGZvcihsZXQgbWFyayBvZiBtYXJrcykge1xuICAgICAgbGV0IHt0b30gPSBtYXJrLmZpbmQoKTtcbiAgICAgIGlmKG1hcmsuY2VsbCAmJiB0by5jaCA9PT0gcG9zLmNoKSB7XG4gICAgICAgIGNlbGwgPSBtYXJrLmNlbGw7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cbiAgICBpZihjZWxsKSB7XG4gICAgICBsZXQgcXVlcnkgPSBjZWxsLnF1ZXJ5LnNwbGl0KFwifFwiKVswXTtcbiAgICAgIGRpc3BhdGNoKFwiYWRkQWN0aXZlQ2VsbFwiLCB7aWQ6IGNlbGwuaWQsIGNlbGwsIHF1ZXJ5fSkuY29tbWl0KCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICB9XG4gIHJldHVybiBDb2RlTWlycm9yLlBhc3M7XG59XG5cbmZ1bmN0aW9uIG1heWJlTmF2aWdhdGUoY20sIHBhbmVJZCkge1xuICBpZighY20uc29tZXRoaW5nU2VsZWN0ZWQoKSkge1xuICAgIGxldCBwb3MgPSBjbS5nZXRDdXJzb3IoXCJmcm9tXCIpO1xuICAgIGxldCBtYXJrcyA9IGNtLmZpbmRNYXJrc0F0KHBvcyk7XG4gICAgbGV0IHRvQ2xpY2s7XG4gICAgZm9yKGxldCBtYXJrIG9mIG1hcmtzKSB7XG4gICAgICBpZihtYXJrLmNlbGwpIHtcbiAgICAgICAgdG9DbGljayA9IG1hcms7XG4gICAgICB9XG4gICAgfVxuICAgIGlmKHRvQ2xpY2spIHtcbiAgICAgIC8vIEBIQUNLOiB0aGVyZSByZWFsbHkgc2hvdWxkIGJlIGEgYmV0dGVyIHdheSBmb3IgbWUgdG8gZmluZCBvdXRcbiAgICAgIC8vIGlmIHRoZXJlJ3MgYSBsaW5rIGluIHRoaXMgY2VsbCBhbmQgaWYgaXQgaXMgd2hhdCB0aGF0IGxpbmsgaXNcbiAgICAgIC8vIHRvLlxuICAgICAgbGV0IGxpbmsgPSB0b0NsaWNrLndpZGdldE5vZGUucXVlcnlTZWxlY3RvcihcIi5saW5rXCIpO1xuICAgICAgaWYobGluaykge1xuICAgICAgICBsZXQgZWxlbSA9IHJlbmRlcmVyLnRyZWVbbGluay5faWRdO1xuICAgICAgICBsZXQgY29vcmRzID0gY20uY3Vyc29yQ29vcmRzKHRydWUsIFwicGFnZVwiKTtcbiAgICAgICAgbmF2aWdhdGUoe2NsaWVudFg6IGNvb3Jkcy5sZWZ0LCBjbGllbnRZOiBjb29yZHMudG9wLCBwcmV2ZW50RGVmYXVsdDogKCk9Pnt9fSwgZWxlbSk7XG4gICAgICB9XG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCB2YXIgYWN0aXZlQ2VsbHMgPSB7fTtcblxuYXBwSGFuZGxlKFwiY2xlYXJBY3RpdmVDZWxsc1wiLCAoY2hhbmdlcywgaW5mbykgPT4ge1xuICBmb3IobGV0IGNlbGwgaW4gYWN0aXZlQ2VsbHMpIHtcbiAgICBjaGFuZ2VzLmRpc3BhdGNoKFwicmVtb3ZlQWN0aXZlQ2VsbFwiLCBhY3RpdmVDZWxsc1tjZWxsXSk7XG4gIH1cbn0pO1xuXG5hcHBIYW5kbGUoXCJhZGRBY3RpdmVDZWxsXCIsIChjaGFuZ2VzLCBpbmZvKSA9PiB7XG4gIGNoYW5nZXMuZGlzcGF0Y2goXCJjbGVhckFjdGl2ZUNlbGxzXCIsIHt9KTtcbiAgbGV0IHtpZH0gPSBpbmZvO1xuICBpbmZvLnNlbGVjdGVkID0gMDtcbiAgaW5mby5lZGl0b3JJZCA9IGluZm8uY2VsbC5lZGl0b3JJZDtcbiAgYWN0aXZlQ2VsbHNbaWRdID0gaW5mbztcbn0pO1xuXG5hcHBIYW5kbGUoXCJyZW1vdmVBY3RpdmVDZWxsXCIsIChjaGFuZ2VzLCBpbmZvKSA9PiB7XG4gIGxldCB7aWR9ID0gaW5mbztcbiAgZGVsZXRlIGFjdGl2ZUNlbGxzW2lkXTtcbn0pO1xuXG5hcHBIYW5kbGUoXCJzZXRDZWxsU3RhdGVcIiwgKGNoYW5nZXMsIGluZm8pID0+IHtcbiAgbGV0IGFjdGl2ZSA9IGFjdGl2ZUNlbGxzW2luZm8uaWRdO1xuICBhY3RpdmUuc2VsZWN0ZWQgPSAwO1xuICBhY3RpdmUuc3RhdGUgPSBpbmZvLnN0YXRlO1xufSk7XG5cbmFwcEhhbmRsZShcInVwZGF0ZUFjdGl2ZUNlbGxcIiwgKGNoYW5nZXMsIGluZm8pID0+IHtcbiAgbGV0IGFjdGl2ZSA9IGFjdGl2ZUNlbGxzW2luZm8uaWRdO1xuICBhY3RpdmUucXVlcnkgPSBpbmZvLnF1ZXJ5O1xuICBhY3RpdmUuc2VsZWN0ZWQgPSAwO1xuICBhY3RpdmUuc3RhdGUgPSBcInF1ZXJ5XCI7XG59KTtcblxuYXBwSGFuZGxlKFwibW92ZUNlbGxBdXRvY29tcGxldGVcIiwgKGNoYW5nZXMsIGluZm8pID0+IHtcbiAgbGV0IGFjdGl2ZSA9IGFjdGl2ZUNlbGxzW2luZm8uY2VsbC5pZF07XG4gIGxldCB7ZGlyZWN0aW9uLCB2YWx1ZX0gPSBpbmZvO1xuICBpZih2YWx1ZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgYWN0aXZlLnNlbGVjdGVkICs9IGRpcmVjdGlvbjtcbiAgfSBlbHNlIHtcbiAgICBhY3RpdmUuc2VsZWN0ZWQgPSB2YWx1ZTtcbiAgfVxufSk7XG5cbmZ1bmN0aW9uIHVwZGF0ZUFjdGl2ZUNlbGwoZXZlbnQsIGVsZW0pIHtcbiAgbGV0IHtjZWxsfSA9IGVsZW07XG4gIGRpc3BhdGNoKFwidXBkYXRlQWN0aXZlQ2VsbFwiLCB7aWQ6IGNlbGwuaWQsIGNlbGwsIHF1ZXJ5OiBldmVudC5jdXJyZW50VGFyZ2V0LnRleHRDb250ZW50fSkuY29tbWl0KCk7XG59XG5cbmZ1bmN0aW9uIGFjdGl2YXRlQ2VsbChldmVudCwgZWxlbSkge1xuICBsZXQge2NlbGx9ID0gZWxlbTtcbiAgbGV0IHF1ZXJ5ID0gY2VsbC5xdWVyeS5zcGxpdChcInxcIilbMF07XG4gIGRpc3BhdGNoKFwiYWRkQWN0aXZlQ2VsbFwiLCB7aWQ6IGNlbGwuaWQsIGNlbGwsIHF1ZXJ5fSkuY29tbWl0KCk7XG4gIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZUVtYmVkUG9wb3V0KGNtLCBlZGl0b3JJZCkge1xuICBjbS5vcGVyYXRpb24oKCkgPT4ge1xuICAgIGxldCBmcm9tID0gY20uZ2V0Q3Vyc29yKFwiZnJvbVwiKTtcbiAgICBsZXQgaWQgPSB1dWlkKCk7XG4gICAgY20ucmVwbGFjZVJhbmdlKFwiPVwiLCBmcm9tLCBjbS5nZXRDdXJzb3IoXCJ0b1wiKSk7XG4gICAgbGV0IHRvID0gY20uZ2V0Q3Vyc29yKFwiZnJvbVwiKTtcbiAgICBsZXQgZnJvbUl4ID0gY20uaW5kZXhGcm9tUG9zKGZyb20pO1xuICAgIGxldCB0b0l4ID0gY20uaW5kZXhGcm9tUG9zKHRvKTtcbiAgICBsZXQgY2VsbCA9IHtpZCwgc3RhcnQ6IGZyb21JeCwgbGVuZ3RoOiB0b0l4IC0gZnJvbUl4LCBwbGFjZWhvbGRlcjogdHJ1ZSwgcXVlcnk6IFwiXCIsIGVkaXRvcklkfTtcbiAgICBkaXNwYXRjaChcImFkZEFjdGl2ZUNlbGxcIiwge2lkLCBxdWVyeTogXCJcIiwgY2VsbCwgcGxhY2Vob2xkZXI6IHRydWV9KTtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIG1ha2VEb0VtYmVkRnVuY3Rpb24oY20sIG1hcmssIGNlbGwsIHBhbmVJZCkge1xuICByZXR1cm4gKHZhbHVlKSA9PiB7XG4gICAgbGV0IHtmcm9tLCB0b30gPSBtYXJrLmZpbmQoKTtcbiAgICBpZih2YWx1ZVswXSA9PT0gXCI9XCIpIHtcbiAgICAgIHZhbHVlID0gdmFsdWUuc3Vic3RyaW5nKDEpO1xuICAgIH1cbiAgICB2YWx1ZSA9IHZhbHVlLnRyaW0oKTtcbiAgICBsZXQgW3RleHQsIHJhd1BhcmFtc10gPSB2YWx1ZS5zcGxpdChcInxcIik7XG4gICAgdGV4dCA9IHRleHQudHJpbSgpO1xuICAgIC8vIEBUT0RPOiB0aGlzIGRvZXNuJ3QgdGFrZSBkaXNhbWJpZ3VhdGlvbnMgaW50byBhY2NvdW50XG4gICAgbGV0IGVudGl0eUlkID0gYXNFbnRpdHkodGV4dCk7XG4gICAgaWYoZW50aXR5SWQpIHtcbiAgICAgIHRleHQgPSBlbnRpdHlJZDtcbiAgICB9XG4gICAgbGV0IHJlcGxhY2VtZW50ID0gYHske3RleHR9fCR7cmF3UGFyYW1zIHx8IFwiXCJ9fWA7XG4gICAgaWYodGV4dCA9PT0gXCJcIikge1xuICAgICAgcmVwbGFjZW1lbnQgPSBcIlwiO1xuICAgIH1cbiAgICBpZihjbS5nZXRSYW5nZShmcm9tLCB0bykgIT09IHJlcGxhY2VtZW50KSB7XG4gICAgICBjbS5yZXBsYWNlUmFuZ2UocmVwbGFjZW1lbnQsIGZyb20sIHRvKTtcbiAgICB9XG4gICAgcGFuZUVkaXRvcnNbY2VsbC5lZGl0b3JJZF0uY21JbnN0YW5jZS5mb2N1cygpO1xuICAgIGxldCBjaGFpbiA9IGRpc3BhdGNoKFwicmVtb3ZlQWN0aXZlQ2VsbFwiLCBjZWxsKTtcbiAgICBpZihyZXBsYWNlbWVudCkge1xuICAgICAgY2hhaW4uZGlzcGF0Y2goXCJpbnNlcnQgcXVlcnlcIiwge3F1ZXJ5OiB0ZXh0fSk7XG4gICAgfVxuICAgIGNoYWluLmNvbW1pdCgpO1xuICB9XG59XG5cbmZ1bmN0aW9uIGVtYmVkZGVkQ2VsbEtleXMoZXZlbnQsIGVsZW0pIHtcbiAgbGV0IHtwYW5lSWQsIGNlbGx9ID0gZWxlbTtcbiAgbGV0IHRhcmdldCA9IGV2ZW50LmN1cnJlbnRUYXJnZXQ7XG4gIGxldCB2YWx1ZSA9IHRhcmdldC50ZXh0Q29udGVudDtcbiAgbGV0IGVkaXRvciA9IHBhbmVFZGl0b3JzW2NlbGwuZWRpdG9ySWRdO1xuICBsZXQgY20gPSBlZGl0b3IuY21JbnN0YW5jZTtcbiAgbGV0IG1hcmsgPSBlZGl0b3IubWFya3NbY2VsbC5pZF07XG4gIGlmKGV2ZW50LmtleUNvZGUgPT09IEtFWVMuQkFDS1NQQUNFICYmIHZhbHVlID09PSBcIlwiKSB7XG4gICAgbGV0IHtmcm9tLCB0b30gPSBtYXJrLmZpbmQoKTtcbiAgICBjbS5yZXBsYWNlUmFuZ2UoXCJcIiwgZnJvbSwgdG8pO1xuICAgIHBhbmVFZGl0b3JzW2NlbGwuZWRpdG9ySWRdLmNtSW5zdGFuY2UuZm9jdXMoKTtcbiAgICBkaXNwYXRjaChcInJlbW92ZUFjdGl2ZUNlbGxcIiwgY2VsbCkuY29tbWl0KCk7XG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgfSBlbHNlIGlmKGV2ZW50LmtleUNvZGUgPT09IEtFWVMuRVNDIHx8IChldmVudC5rZXlDb2RlID09PSBLRVlTLkVOVEVSICYmIHZhbHVlLnRyaW0oKSA9PT0gXCJcIikpIHtcbiAgICBsZXQge2Zyb20sIHRvfSA9IG1hcmsuZmluZCgpO1xuICAgIGlmKGNlbGwucGxhY2Vob2xkZXIpIHtcbiAgICAgIGNtLnJlcGxhY2VSYW5nZShcIj0gXCIsIGZyb20sIHRvKTtcbiAgICB9XG4gICAgcGFuZUVkaXRvcnNbY2VsbC5lZGl0b3JJZF0uY21JbnN0YW5jZS5mb2N1cygpO1xuICAgIGRpc3BhdGNoKFwicmVtb3ZlQWN0aXZlQ2VsbFwiLCBjZWxsKS5jb21taXQoKTtcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICB9IGVsc2UgaWYoZXZlbnQua2V5Q29kZSA9PT0gS0VZUy5FTlRFUikge1xuICAgIGxldCBkb0VtYmVkID0gbWFrZURvRW1iZWRGdW5jdGlvbihjbSwgbWFyaywgY2VsbCwgcGFuZUlkKTtcbiAgICBpZihlbGVtLnNlbGVjdGVkICYmIGVsZW0uc2VsZWN0ZWQuYWN0aW9uKSB7XG4gICAgICBpZih0eXBlb2YgZWxlbS5zZWxlY3RlZC5hY3Rpb24gPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICBlbGVtLnNlbGVjdGVkLmFjdGlvbihlbGVtLCB2YWx1ZSwgZG9FbWJlZCk7XG4gICAgICB9XG4gICAgfVxuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gIH0gZWxzZSBpZihldmVudC5rZXlDb2RlID09PSBLRVlTLlVQKSB7XG4gICAgZGlzcGF0Y2goXCJtb3ZlQ2VsbEF1dG9jb21wbGV0ZVwiLCB7Y2VsbCwgZGlyZWN0aW9uOi0xfSkuY29tbWl0KCk7XG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgfSBlbHNlIGlmKGV2ZW50LmtleUNvZGUgPT09IEtFWVMuRE9XTikge1xuICAgIGRpc3BhdGNoKFwibW92ZUNlbGxBdXRvY29tcGxldGVcIiwge2NlbGwsIGRpcmVjdGlvbjoxfSkuY29tbWl0KCk7XG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgfVxuICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbn1cblxuZnVuY3Rpb24gdXBkYXRlUGFnZShtZXRhLCBjb250ZW50KSB7XG4gIGRpc3BhdGNoKFwidXBkYXRlIHBhZ2VcIiwge3BhZ2U6IG1ldGEucGFnZSwgY29udGVudH0pLmNvbW1pdCgpO1xufVxuXG4vLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuLy8gRWRpdG9yIHByZXBcbi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbmZ1bmN0aW9uIHByZXBhcmVDYXJkRWRpdG9yKGVudGl0eUlkLCBwYW5lSWQpIHtcbiAgdmFyIHtjb250ZW50ID0gdW5kZWZpbmVkfSA9IGV2ZS5maW5kT25lKFwiZW50aXR5XCIsIHtlbnRpdHk6IGVudGl0eUlkfSkgfHwge307XG4gIHZhciBwYWdlID0gZXZlLmZpbmRPbmUoXCJlbnRpdHkgcGFnZVwiLCB7ZW50aXR5OiBlbnRpdHlJZH0pW1wicGFnZVwiXTtcbiAgdmFyIG5hbWUgPSB1aXRrLnJlc29sdmVOYW1lKGVudGl0eUlkKTtcbiAgdmFyIGNlbGxzID0gZ2V0Q2VsbHMoY29udGVudCwgYCR7cGFuZUlkfXwke2VudGl0eUlkfWApO1xuICB2YXIgY2VsbEl0ZW1zID0gY2VsbHMubWFwKChjZWxsLCBpeCkgPT4ge1xuICAgIHZhciB1aTtcbiAgICB2YXIgYWN0aXZlID0gYWN0aXZlQ2VsbHNbY2VsbC5pZF07XG4gICAgaWYoYWN0aXZlKSB7XG4gICAgICB1aSA9IGNlbGxFZGl0b3IoZW50aXR5SWQsIHBhbmVJZCwgYWN0aXZlIHx8IGNlbGwpO1xuICAgIH0gZWxzZSB7XG4gICAgICB1aSA9IGNlbGxVSShwYW5lSWQsIGNlbGwucXVlcnksIGNlbGwpO1xuICAgIH1cbiAgICB1aS5pZCA9IGAke3BhbmVJZH18JHtjZWxsLmlkfWA7XG4gICAgdWkucG9zdFJlbmRlciA9IHJlcGFyZW50Q2VsbDtcbiAgICB1aVtcImNvbnRhaW5lcklkXCJdID0gYCR7cGFuZUlkfXwke2NlbGwuaWR9fGNvbnRhaW5lcmA7XG4gICAgdWlbXCJjZWxsXCJdID0gY2VsbDtcbiAgICByZXR1cm4gdWk7XG4gIH0pO1xuICBsZXQgZWRpdG9ySWQgPSBgJHtwYW5lSWR9fCR7ZW50aXR5SWR9YDtcbiAgdmFyIGtleXMgPSB7XG4gICAgXCJCYWNrc3BhY2VcIjogKGNtKSA9PiBtYXliZUFjdGl2YXRlQ2VsbChjbSwgZWRpdG9ySWQpLFxuICAgIFwiQ21kLUVudGVyXCI6IChjbSkgPT4gbWF5YmVOYXZpZ2F0ZShjbSwgZWRpdG9ySWQpLFxuICAgIFwiPVwiOiAoY20pID0+IGNyZWF0ZUVtYmVkUG9wb3V0KGNtLCBlZGl0b3JJZClcbiAgfTtcbiAgcmV0dXJuIHtwb3N0UmVuZGVyOiB3aWtpRWRpdG9yLCBvblVwZGF0ZTogdXBkYXRlUGFnZSwgb3B0aW9uczoge2tleXM6IGtleXN9LCBjZWxscywgY2VsbEl0ZW1zfTtcbn1cblxuLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbi8vIFBhZ2UgcGFyc2luZ1xuLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuZnVuY3Rpb24gZ2V0Q2VsbHMoY29udGVudDogc3RyaW5nLCBlZGl0b3JJZCkge1xuICBsZXQgY2VsbHMgPSBbXTtcbiAgbGV0IGl4ID0gMDtcbiAgbGV0IGlkcyA9IHt9O1xuICBmb3IobGV0IHBhcnQgb2YgY29udGVudC5zcGxpdCgvKHtbXl0qP30pL2dtKSkge1xuICAgIGlmKHBhcnRbMF0gPT09IFwie1wiKSB7XG4gICAgICBsZXQgaWQgPSBwYXJ0O1xuICAgICAgaWYoIWlkc1twYXJ0XSkge1xuICAgICAgICBpZHNbcGFydF0gPSAyO1xuICAgICAgfSBlbHNlIGlmKGlkc1twYXJ0XSA+PSAyKSB7XG4gICAgICAgIGlkICs9IGlkc1twYXJ0XTtcbiAgICAgICAgaWRzW3BhcnRdKys7XG4gICAgICB9XG4gICAgICBsZXQgcGxhY2Vob2xkZXIgPSBmYWxzZTtcbiAgICAgIGlmKHBhcnQubWF0Y2goL1xce1xcJFxcJC4qXFwkXFwkXFx9LykpIHtcbiAgICAgICAgcGxhY2Vob2xkZXIgPSB0cnVlO1xuICAgICAgfVxuICAgICAgY2VsbHMucHVzaCh7c3RhcnQ6IGl4LCBsZW5ndGg6IHBhcnQubGVuZ3RoLCB2YWx1ZTogcGFydCwgcXVlcnk6IHBhcnQuc3Vic3RyaW5nKDEsIHBhcnQubGVuZ3RoIC0gMSksIGlkLCBwbGFjZWhvbGRlciwgZWRpdG9ySWR9KTtcbiAgICB9XG4gICAgaXggKz0gcGFydC5sZW5ndGg7XG4gIH1cbiAgZm9yKGxldCBhY3RpdmUgaW4gYWN0aXZlQ2VsbHMpIHtcbiAgICBsZXQgY2VsbCA9IGFjdGl2ZUNlbGxzW2FjdGl2ZV0uY2VsbDtcbiAgICBpZihjZWxsLnBsYWNlaG9sZGVyICYmIGNlbGwuZWRpdG9ySWQgPT09IGVkaXRvcklkKSB7XG4gICAgICBjZWxscy5wdXNoKGNlbGwpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gY2VsbHM7XG59XG5cbi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4vLyBBdHRyaWJ1dGVzXG4vLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG5hcHBIYW5kbGUoXCJhZGQgZW50aXR5IGF0dHJpYnV0ZVwiLCAoY2hhbmdlczpEaWZmLCB7ZW50aXR5LCBhdHRyaWJ1dGUsIHZhbHVlfSkgPT4ge1xuICBsZXQgc3VjY2VzcyA9IGhhbmRsZUF0dHJpYnV0ZURlZmluaXRpb24oZW50aXR5LCBhdHRyaWJ1dGUudHJpbSgpLCB2YWx1ZSwgY2hhbmdlcyk7XG59KTtcblxuYXBwSGFuZGxlKFwidG9nZ2xlIGFkZCB0aWxlXCIsIChjaGFuZ2VzOkRpZmYsIHtrZXksIGVudGl0eUlkfSkgPT4ge1xuICBsZXQgc3RhdGUgPSB1aVN0YXRlLndpZGdldC5jYXJkW2tleV0gfHwge3Nob3dBZGQ6IGZhbHNlfTtcbiAgc3RhdGUuc2hvd0FkZCA9ICFzdGF0ZS5zaG93QWRkO1xuICBzdGF0ZS5lbnRpdHlJZCA9IGVudGl0eUlkO1xuICBzdGF0ZS5rZXkgPSBrZXk7XG4gIHN0YXRlLmFjdGl2ZVRpbGUgPSB1bmRlZmluZWQ7XG4gIC8vIGluIGNhc2UgeW91IGNsb3NlZCBpdCB3aXRoIGFuIGFkZGVyIHNlbGVjdGVkXG4gIGlmKHN0YXRlLnNob3dBZGQpIHtcbiAgICBzdGF0ZS5hZGRlciA9IHVuZGVmaW5lZDtcbiAgfVxuICB1aVN0YXRlLndpZGdldC5jYXJkW2tleV0gPSBzdGF0ZTtcbn0pO1xuXG5hcHBIYW5kbGUoXCJzZXQgdGlsZSBhZGRlclwiLCAoY2hhbmdlczpEaWZmLCB7a2V5LCBhZGRlcn0pID0+IHtcbiAgbGV0IHN0YXRlID0gdWlTdGF0ZS53aWRnZXQuY2FyZFtrZXldIHx8IHtzaG93QWRkOiB0cnVlLCBrZXl9O1xuICBzdGF0ZS5hZGRlciA9IGFkZGVyO1xuICB1aVN0YXRlLndpZGdldC5jYXJkW2tleV0gPSBzdGF0ZTtcbn0pO1xuXG5hcHBIYW5kbGUoXCJzZXQgdGlsZSBhZGRlciBhdHRyaWJ1dGVcIiwgKGNoYW5nZXM6RGlmZiwge2tleSwgYXR0cmlidXRlLCB2YWx1ZSwgaXNBY3RpdmVUaWxlQXR0cmlidXRlfSkgPT4ge1xuICBsZXQgc3RhdGUgPSB1aVN0YXRlLndpZGdldC5jYXJkW2tleV0gfHwge3Nob3dBZGQ6IHRydWUsIGtleX07XG4gIGlmKCFpc0FjdGl2ZVRpbGVBdHRyaWJ1dGUpIHtcbiAgICBzdGF0ZVthdHRyaWJ1dGVdID0gdmFsdWUudHJpbSgpO1xuICB9IGVsc2Uge1xuICAgIHN0YXRlLmFjdGl2ZVRpbGVbYXR0cmlidXRlXSA9IHZhbHVlLnRyaW0oKTtcbiAgfVxuICB1aVN0YXRlLndpZGdldC5jYXJkW2tleV0gPSBzdGF0ZTtcbn0pO1xuXG5hcHBIYW5kbGUoXCJzdWJtaXQgdGlsZSBhZGRlclwiLCAoY2hhbmdlczpEaWZmLCB7a2V5LCBub2RlfSkgPT4ge1xuICBsZXQgc3RhdGUgPSB1aVN0YXRlLndpZGdldC5jYXJkW2tleV0gfHwge3Nob3dBZGQ6IHRydWUsIGtleX07XG4gIGlmKHN0YXRlLmFkZGVyICYmIHN0YXRlLmFkZGVyLnN1Ym1pdCkge1xuICAgIHN0YXRlLmFkZGVyLnN1Ym1pdChzdGF0ZS5hZGRlciwgc3RhdGUsIG5vZGUpO1xuICB9XG4gIHVpU3RhdGUud2lkZ2V0LmNhcmRba2V5XSA9IHN0YXRlO1xufSk7XG5cbmFwcEhhbmRsZShcImFjdGl2YXRlIHRpbGVcIiwgKGNoYW5nZXM6RGlmZiwge3RpbGVJZCwgY2FyZElkfSkgPT4ge1xuICBsZXQgc3RhdGUgPSB1aVN0YXRlLndpZGdldC5jYXJkW2NhcmRJZF0gfHwge3Nob3dBZGQ6IGZhbHNlLCBrZXk6IGNhcmRJZH07XG4gIGlmKHRpbGVJZCAmJiAoIXN0YXRlLmFjdGl2ZVRpbGUgfHwgc3RhdGUuYWN0aXZlVGlsZS5pZCAhPT0gdGlsZUlkKSkge1xuICAgIHN0YXRlLmFjdGl2ZVRpbGUgPSB7aWQ6IHRpbGVJZH07XG4gIH0gZWxzZSBpZighdGlsZUlkKSB7XG4gICAgc3RhdGUuYWN0aXZlVGlsZSA9IHVuZGVmaW5lZDtcbiAgfVxuICB1aVN0YXRlLndpZGdldC5jYXJkW2NhcmRJZF0gPSBzdGF0ZTtcbn0pO1xuXG5mdW5jdGlvbiBhY3RpdmF0ZVRpbGUoZXZlbnQsIGVsZW0pIHtcbiAgaWYoZXZlbnQuZGVmYXVsdFByZXZlbnRlZCkgcmV0dXJuO1xuICBkaXNwYXRjaChcImFjdGl2YXRlIHRpbGVcIiwge3RpbGVJZDogZWxlbS50aWxlSWQsIGNhcmRJZDogZWxlbS5jYXJkSWR9KS5jb21taXQoKTtcbn1cblxuZnVuY3Rpb24gc3VibWl0QWN0aXZlVGlsZShldmVudCwgZWxlbSkge1xuICBpZihlbGVtLnNvdXJjZSkge1xuICAgIC8vIHJlcGxhY2VcbiAgICAgIGRpc3BhdGNoKFwicmVwbGFjZSBzb3VyY2VkIHRpbGVcIiwge2tleTogZWxlbS5jYXJkSWQsIHNvdXJjZTplbGVtLnNvdXJjZSwgYXR0cmlidXRlOiBlbGVtLmF0dHJpYnV0ZSwgZW50aXR5SWQ6IGVsZW0uZW50aXR5SWR9KS5jb21taXQoKTtcbiAgfSBlbHNlIHtcbiAgICAvLyBoYW5kbGUgYSBsaXN0IHN1Ym1pdFxuICAgIGRpc3BhdGNoKFwic3VibWl0IGxpc3QgdGlsZVwiLCB7Y2FyZElkOiBlbGVtLmNhcmRJZCwgYXR0cmlidXRlOiBlbGVtLmF0dHJpYnV0ZSwgZW50aXR5SWQ6IGVsZW0uZW50aXR5SWQsIHJldmVyc2VFbnRpdHlBbmRWYWx1ZTogZWxlbS5yZXZlcnNlRW50aXR5QW5kVmFsdWV9KS5jb21taXQoKTtcbiAgfVxuICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xufVxuXG5mdW5jdGlvbiByZW1vdmVBY3RpdmVUaWxlKGV2ZW50LCBlbGVtKSB7XG4gIGlmKGVsZW0uc291cmNlKSB7XG4gICAgZGlzcGF0Y2goXCJyZW1vdmUgc291cmNlZCBlYXZcIiwge3NvdXJjZTogZWxlbS5zb3VyY2V9KS5jb21taXQoKTtcbiAgfSBlbHNlIHtcbiAgICBjb25zb2xlLmVycm9yKFwiVHJpZWQgdG8gcmVtb3ZlIGEgdGlsZSB3aXRob3V0IGEgc291cmNlLiBXaGF0IGRvIHdlIGRvP1wiKTtcbiAgfVxuICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xufVxuXG5mdW5jdGlvbiB0aWxlKGVsZW0pIHtcbiAgbGV0IHtjYXJkSWQsIHRpbGVJZCwgYWN0aXZlLCBhdHRyaWJ1dGUsIGVudGl0eUlkLCBzb3VyY2UsIHJldmVyc2VFbnRpdHlBbmRWYWx1ZX0gPSBlbGVtO1xuICBsZXQga2xhc3MgPSAoZWxlbS5jIHx8IFwiXCIpICsgXCIgdGlsZVwiO1xuICBpZihhY3RpdmUpIHtcbiAgICBrbGFzcyArPSBcIiBhY3RpdmVcIjtcbiAgfVxuICBlbGVtLmMgPSBrbGFzcztcbiAgLy8gZWxlbS5jbGljayA9IGFjdGl2YXRlVGlsZTtcbiAgZWxlbS5jaGlsZHJlbiA9IFtcbiAgICB7YzogXCJ0aWxlLWNvbnRlbnQtd3JhcHBlclwiLCBjaGlsZHJlbjogZWxlbS5jaGlsZHJlbn0sXG4gICAge2M6IFwiZWRpdCBpb24tZWRpdFwiLCBjbGljazogYWN0aXZhdGVUaWxlLCBjYXJkSWQsIHRpbGVJZCwgZW50aXR5SWQsIHNvdXJjZX0sXG4gICAge2M6IFwiY29udHJvbHNcIiwgY2hpbGRyZW46IFtcbiAgICAgICFlbGVtLnJlbW92ZU9ubHkgPyB7YzogXCJpb24tY2hlY2ttYXJrIHN1Ym1pdFwiLCBjbGljazogc3VibWl0QWN0aXZlVGlsZSwgY2FyZElkLCBhdHRyaWJ1dGUsIGVudGl0eUlkLCBzb3VyY2UsIHJldmVyc2VFbnRpdHlBbmRWYWx1ZX0gOiB1bmRlZmluZWQsXG4gICAgICAhZWxlbS5zdWJtaXRPbmx5ID8ge2M6IFwiaW9uLWJhY2tzcGFjZSBjYW5jZWxcIiwgY2xpY2s6IHJlbW92ZUFjdGl2ZVRpbGUsIGNhcmRJZCwgYXR0cmlidXRlLCBlbnRpdHlJZCwgc291cmNlfSA6IHVuZGVmaW5lZCxcbiAgICBdfVxuICBdO1xuICByZXR1cm4gZWxlbTtcbn1cblxuZnVuY3Rpb24gaXNUaWxlQWN0aXZlKGNhcmRJZCwgdGlsZUlkKSB7XG4gIGxldCBzdGF0ZSA9IHVpU3RhdGUud2lkZ2V0LmNhcmRbY2FyZElkXTtcbiAgcmV0dXJuIHN0YXRlICYmIHN0YXRlLmFjdGl2ZVRpbGUgJiYgc3RhdGUuYWN0aXZlVGlsZS5pZCA9PT0gdGlsZUlkO1xufVxuXG5hcHBIYW5kbGUoXCJ0b2dnbGUgYWN0aXZlIHRpbGUgaXRlbVwiLCAoY2hhbmdlcywge2NhcmRJZCwgYXR0cmlidXRlLCBpZH0pID0+IHtcbiAgbGV0IHN0YXRlID0gdWlTdGF0ZS53aWRnZXQuY2FyZFtjYXJkSWRdIHx8IHtzaG93QWRkOiB0cnVlLCBrZXk6IGNhcmRJZCwgYWN0aXZlVGlsZToge319O1xuICBpZighc3RhdGUuYWN0aXZlVGlsZVthdHRyaWJ1dGVdKSB7XG4gICAgc3RhdGUuYWN0aXZlVGlsZVthdHRyaWJ1dGVdID0ge307XG4gIH1cbiAgbGV0IGN1ciA9IHN0YXRlLmFjdGl2ZVRpbGVbYXR0cmlidXRlXVtpZF07XG4gIGlmKGN1cikge1xuICAgIGRlbGV0ZSBzdGF0ZS5hY3RpdmVUaWxlW2F0dHJpYnV0ZV1baWRdO1xuICB9IGVsc2Uge1xuICAgIHN0YXRlLmFjdGl2ZVRpbGVbYXR0cmlidXRlXVtpZF0gPSB0cnVlO1xuICB9XG4gIHVpU3RhdGUud2lkZ2V0LmNhcmRbY2FyZElkXSA9IHN0YXRlO1xufSk7XG5cbmFwcEhhbmRsZShcInN1Ym1pdCBsaXN0IHRpbGVcIiwgKGNoYW5nZXMsIHtjYXJkSWQsIGF0dHJpYnV0ZSwgZW50aXR5SWQsIHJldmVyc2VFbnRpdHlBbmRWYWx1ZX0pID0+IHtcbiAgbGV0IHN0YXRlID0gdWlTdGF0ZS53aWRnZXQuY2FyZFtjYXJkSWRdIHx8IHthY3RpdmVUaWxlOiB7fX07XG4gIGxldCB7aXRlbXNUb1JlbW92ZSwgaXRlbXNUb0FkZH0gPSBzdGF0ZS5hY3RpdmVUaWxlO1xuICBpZihpdGVtc1RvUmVtb3ZlKSB7XG4gICAgZm9yKGxldCBzb3VyY2UgaW4gaXRlbXNUb1JlbW92ZSkge1xuICAgICAgY2hhbmdlcy5yZW1vdmUoXCJzb3VyY2VkIGVhdlwiLCB7c291cmNlfSk7XG4gICAgfVxuICB9XG4gIGlmKGl0ZW1zVG9BZGQpIHtcbiAgICBmb3IobGV0IHZhbHVlIG9mIGl0ZW1zVG9BZGQpIHtcbiAgICAgIGlmKHZhbHVlID09PSBcIlwiIHx8IHZhbHVlID09PSB1bmRlZmluZWQpIGNvbnRpbnVlO1xuICAgICAgaWYoIXJldmVyc2VFbnRpdHlBbmRWYWx1ZSkge1xuICAgICAgICBjaGFuZ2VzLmRpc3BhdGNoKFwiYWRkIHNvdXJjZWQgZWF2XCIsIHtlbnRpdHk6IGVudGl0eUlkLCBhdHRyaWJ1dGUsIHZhbHVlOiB2YWx1ZS50cmltKCksIGZvcmNlRW50aXR5OiB0cnVlfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBsZXQgY2xlYW5lZCA9IHZhbHVlLnRyaW0oKTtcbiAgICAgICAgbGV0IGVudGl0eVZhbHVlID0gYXNFbnRpdHkoY2xlYW5lZCk7XG4gICAgICAgIGlmKCFlbnRpdHlWYWx1ZSkge1xuICAgICAgICAgIC8vY3JlYXRlIGFuIGVudGl0eSB3aXRoIHRoYXQgbmFtZVxuICAgICAgICAgIGVudGl0eVZhbHVlID0gdXVpZCgpO1xuICAgICAgICAgIGxldCBwYWdlSWQgPSB1dWlkKCk7XG4gICAgICAgICAgY2hhbmdlcy5kaXNwYXRjaChcImNyZWF0ZSBwYWdlXCIsIHtwYWdlOiBwYWdlSWQsICBjb250ZW50OiBcIlwifSlcbiAgICAgICAgICAgICAgICAgLmRpc3BhdGNoKFwiY3JlYXRlIGVudGl0eVwiLCB7ZW50aXR5OiBlbnRpdHlWYWx1ZSwgbmFtZTogY2xlYW5lZCwgcGFnZTogcGFnZUlkfSk7XG4gICAgICAgIH1cbiAgICAgICAgY2hhbmdlcy5kaXNwYXRjaChcImFkZCBzb3VyY2VkIGVhdlwiLCB7ZW50aXR5OiBlbnRpdHlWYWx1ZSwgYXR0cmlidXRlLCB2YWx1ZTogZW50aXR5SWR9KTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgY2hhbmdlcy5kaXNwYXRjaChcImFjdGl2YXRlIHRpbGVcIiwge2NhcmRJZH0pO1xufSk7XG5cbmZ1bmN0aW9uIHRvZ2dsZUxpc3RUaWxlSXRlbShldmVudCwgZWxlbSkge1xuICBkaXNwYXRjaChcInRvZ2dsZSBhY3RpdmUgdGlsZSBpdGVtXCIsIHtjYXJkSWQ6IGVsZW0uY2FyZElkLCBhdHRyaWJ1dGU6IGVsZW0uc3RvcmVBdHRyaWJ1dGUsIGlkOiBlbGVtLnN0b3JlSWR9KS5jb21taXQoKTtcbiAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbn1cblxuYXBwSGFuZGxlKFwiYWRkIGFjdGl2ZSB0aWxlIGl0ZW1cIiwgKGNoYW5nZXMsIHtjYXJkSWQsIGF0dHJpYnV0ZSwgaWQsIHZhbHVlLCB0aWxlSWR9KSA9PiB7XG4gIGxldCBzdGF0ZSA9IHVpU3RhdGUud2lkZ2V0LmNhcmRbY2FyZElkXSB8fCB7c2hvd0FkZDogdHJ1ZSwga2V5OiBjYXJkSWQsIGFjdGl2ZVRpbGU6IHtpZDogdGlsZUlkfX07XG4gIGlmKCFzdGF0ZS5hY3RpdmVUaWxlKSB7XG4gICAgc3RhdGUuYWN0aXZlVGlsZSA9IHtpZDogdGlsZUlkfTtcbiAgfVxuICBpZighc3RhdGUuYWN0aXZlVGlsZVthdHRyaWJ1dGVdKSB7XG4gICAgc3RhdGUuYWN0aXZlVGlsZVthdHRyaWJ1dGVdID0gW107XG4gIH1cbiAgbGV0IGN1ciA9IHN0YXRlLmFjdGl2ZVRpbGVbYXR0cmlidXRlXVtpZF07XG4gIHN0YXRlLmFjdGl2ZVRpbGVbYXR0cmlidXRlXVtpZF0gPSB2YWx1ZTtcbiAgdWlTdGF0ZS53aWRnZXQuY2FyZFtjYXJkSWRdID0gc3RhdGU7XG59KTtcblxuZnVuY3Rpb24gYXV0b3NpemVBbmRTdG9yZUxpc3RUaWxlSXRlbShldmVudCwgZWxlbSkge1xuICBsZXQgbm9kZSA9IGV2ZW50LmN1cnJlbnRUYXJnZXQ7XG4gIGRpc3BhdGNoKFwiYWRkIGFjdGl2ZSB0aWxlIGl0ZW1cIiwge2NhcmRJZDogZWxlbS5jYXJkSWQsIGF0dHJpYnV0ZTogZWxlbS5zdG9yZUF0dHJpYnV0ZSwgdGlsZUlkOiBlbGVtLnRpbGVJZCwgaWQ6IGVsZW0uc3RvcmVJZCwgdmFsdWU6IG5vZGUudmFsdWV9KS5jb21taXQoKTtcbiAgdWl0ay5hdXRvc2l6ZUlucHV0KG5vZGUsIGVsZW0pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gbGlzdFRpbGUoZWxlbSkge1xuICBsZXQge3ZhbHVlcywgZGF0YSwgdGlsZUlkLCBhdHRyaWJ1dGUsIGNhcmRJZCwgZW50aXR5SWQsIGZvcmNlQWN0aXZlLCByZXZlcnNlRW50aXR5QW5kVmFsdWUsIG5vUHJvcGVydHksIHJlcD1cInZhbHVlXCIsIGM6a2xhc3M9XCJcIn0gPSBlbGVtO1xuICB0aWxlSWQgPSB0aWxlSWQgfHwgYXR0cmlidXRlO1xuICBsZXQgc3RhdGUgPSB1aVN0YXRlLndpZGdldC5jYXJkW2NhcmRJZF0gfHwge307XG4gIGxldCBhY3RpdmUgPSBmb3JjZUFjdGl2ZSB8fCBpc1RpbGVBY3RpdmUoY2FyZElkLCB0aWxlSWQpO1xuICBsZXQgbGlzdENoaWxkcmVuID0gW107XG4gIGxldCBtYXggPSAwO1xuICBmb3IobGV0IHZhbHVlIG9mIHZhbHVlcykge1xuICAgIGxldCBjdXJyZW50ID0gcmV2ZXJzZUVudGl0eUFuZFZhbHVlID8gdmFsdWUuZWF2LmVudGl0eSA6IHZhbHVlLmVhdi52YWx1ZTtcbiAgICBpZih1aXRrLnJlc29sdmVOYW1lKGN1cnJlbnQpID09PSBcImVudGl0eVwiICYmIGF0dHJpYnV0ZSA9PT0gXCJpcyBhXCIpIGNvbnRpbnVlO1xuICAgIGxldCBzb3VyY2UgPSB2YWx1ZS5zb3VyY2U7XG4gICAgbGV0IHZhbHVlRWxlbTphbnkgPSB7YzogXCJ2YWx1ZVwiLCBkYXRhLCB2YWx1ZTogY3VycmVudCwgYXV0b2xpbms6ICFhY3RpdmV9O1xuICAgIGlmKHJlcCA9PT0gXCJleHRlcm5hbEltYWdlXCIpIHtcbiAgICAgIHZhbHVlRWxlbS51cmwgPSBjdXJyZW50O1xuICAgICAgdmFsdWVFbGVtLnRleHQgPSB1bmRlZmluZWQ7XG4gICAgfVxuICAgIGxldCB1aTpFbGVtZW50ID0ge2M6IFwidmFsdWUtd3JhcHBlclwiLCBkYXRhLCBjaGlsZHJlbjogW3VpdGtbcmVwXSh2YWx1ZUVsZW0pXX07XG4gICAgaWYoYWN0aXZlKSB7XG4gICAgICB1aVtcImNhcmRJZFwiXSA9IGNhcmRJZDtcbiAgICAgIHVpW1wic3RvcmVBdHRyaWJ1dGVcIl0gPSBcIml0ZW1zVG9SZW1vdmVcIjtcbiAgICAgIHVpW1wic3RvcmVJZFwiXSA9IHNvdXJjZTtcbiAgICAgIHVpLmNsaWNrID0gdG9nZ2xlTGlzdFRpbGVJdGVtO1xuICAgICAgaWYoc3RhdGUuYWN0aXZlVGlsZS5pdGVtc1RvUmVtb3ZlICYmIHN0YXRlLmFjdGl2ZVRpbGUuaXRlbXNUb1JlbW92ZVtzb3VyY2VdKSB7XG4gICAgICAgIHVpLmMgPSBgJHt1aS5jIHx8IFwiXCJ9IG1hcmtlZC10by1yZW1vdmVgO1xuICAgICAgfVxuICAgIH1cbiAgICBsaXN0Q2hpbGRyZW4ucHVzaCh1aSk7XG4gIH1cbiAgaWYoYWN0aXZlKSB7XG4gICAgbGV0IGFkZGVkID0gKHN0YXRlLmFjdGl2ZVRpbGUgPyBzdGF0ZS5hY3RpdmVUaWxlLml0ZW1zVG9BZGQgOiBmYWxzZSkgfHwgW107XG4gICAgbGV0IGl4ID0gMDtcbiAgICBmb3IobGV0IGFkZCBvZiBhZGRlZCkge1xuICAgICAgbGlzdENoaWxkcmVuLnB1c2goe2M6IFwidmFsdWVcIiwgY2hpbGRyZW46IFtcbiAgICAgICAge3Q6IFwiaW5wdXRcIiwgcGxhY2Vob2xkZXI6IFwiYWRkXCIsIHZhbHVlOiBhZGQsIGF0dHJpYnV0ZSwgZW50aXR5SWQsIHN0b3JlQXR0cmlidXRlOiBcIml0ZW1zVG9BZGRcIiwgc3RvcmVJZDogaXgsIGNhcmRJZCwgaW5wdXQ6IGF1dG9zaXplQW5kU3RvcmVMaXN0VGlsZUl0ZW0sIHBvc3RSZW5kZXI6IHVpdGsuYXV0b3NpemVBbmRGb2N1cywga2V5ZG93bjogaGFuZGxlVGlsZUtleXMsIHJldmVyc2VFbnRpdHlBbmRWYWx1ZX1cbiAgICAgIF19KTtcbiAgICAgIGl4Kys7XG4gICAgfVxuICAgIGxpc3RDaGlsZHJlbi5wdXNoKHtjOiBcInZhbHVlXCIsIGNoaWxkcmVuOiBbXG4gICAgICB7dDogXCJpbnB1dFwiLCBwbGFjZWhvbGRlcjogXCJhZGRcIiwgdmFsdWU6IFwiXCIsIGF0dHJpYnV0ZSwgZW50aXR5SWQsIHN0b3JlQXR0cmlidXRlOiBcIml0ZW1zVG9BZGRcIiwgc3RvcmVJZDogaXgsIGNhcmRJZCwgaW5wdXQ6IGF1dG9zaXplQW5kU3RvcmVMaXN0VGlsZUl0ZW0sIHBvc3RSZW5kZXI6IGl4ID09PSAwID8gdWl0ay5hdXRvc2l6ZUFuZEZvY3VzIDogdWl0ay5hdXRvc2l6ZUlucHV0LCBrZXlkb3duOiBoYW5kbGVUaWxlS2V5cywgcmV2ZXJzZUVudGl0eUFuZFZhbHVlfVxuICAgIF19KTtcbiAgfVxuICBsZXQgdGlsZUNoaWxkcmVuID0gW107XG4gIGxldCBpc0lzQSA9IGF0dHJpYnV0ZSA9PT0gXCJpcyBhXCI7XG4gIGlmKCFub1Byb3BlcnR5KSB7XG4gICAgdGlsZUNoaWxkcmVuLnB1c2goe2M6IFwicHJvcGVydHlcIiwgdGV4dDogaXNJc0EgPyBcInRhZ3NcIiA6IGF0dHJpYnV0ZX0pO1xuICB9XG4gIHRpbGVDaGlsZHJlbi5wdXNoKHtjOiBcImxpc3RcIiwgY2hpbGRyZW46IGxpc3RDaGlsZHJlbn0pO1xuICBsZXQgc2l6ZSA9IGlzSXNBID8gXCJpcyBhXCIgOiBcImZ1bGxcIjtcbiAgcmV0dXJuIHRpbGUoe2M6IGAke2tsYXNzfSAke3NpemV9YCwgc2l6ZSwgY2FyZElkLCBkYXRhLCB0aWxlSWQsIGFjdGl2ZSwgYXR0cmlidXRlLCBlbnRpdHlJZCwgcmV2ZXJzZUVudGl0eUFuZFZhbHVlLCBzdWJtaXRPbmx5OiB0cnVlLCBjaGlsZHJlbjogdGlsZUNoaWxkcmVufSk7XG59XG5cbmZ1bmN0aW9uIGF1dG9zaXplVGV4dGFyZWEobm9kZSwgZWxlbSkge1xuICBub2RlLnN0eWxlLmhlaWdodCA9IFwiMXB4XCI7XG4gIG5vZGUuc3R5bGUuaGVpZ2h0ID0gMSArIG5vZGUuc2Nyb2xsSGVpZ2h0ICsgXCJweFwiO1xufVxuXG5mdW5jdGlvbiBhdXRvc2l6ZUFuZEZvY3VzVGV4dEFyZWEobm9kZSwgZWxlbSkge1xuICBhdXRvRm9jdXMobm9kZSwgZWxlbSk7XG4gIGF1dG9zaXplVGV4dGFyZWEobm9kZSwgZWxlbSk7XG59XG5cbmZ1bmN0aW9uIHN0b3JlQWN0aXZlVGlsZVZhbHVlKGVsZW0sIHZhbHVlKSB7XG4gIGRpc3BhdGNoKFwic2V0IHRpbGUgYWRkZXIgYXR0cmlidXRlXCIsIHtrZXk6IGVsZW0uY2FyZElkLCBhdHRyaWJ1dGU6IGVsZW0uc3RvcmVBdHRyaWJ1dGUsIHZhbHVlLCBpc0FjdGl2ZVRpbGVBdHRyaWJ1dGU6IHRydWV9KS5jb21taXQoKTtcbn1cblxuYXBwSGFuZGxlKFwicmVwbGFjZSBzb3VyY2VkIHRpbGVcIiwgKGNoYW5nZXMsIHtrZXksIGF0dHJpYnV0ZSwgZW50aXR5SWQsIHNvdXJjZX0pID0+IHtcbiAgbGV0IHN0YXRlID0gdWlTdGF0ZS53aWRnZXQuY2FyZFtrZXldIHx8IHthY3RpdmVUaWxlOiB7fX07XG4gIGxldCB7cmVwbGFjZVZhbHVlfSA9IHN0YXRlLmFjdGl2ZVRpbGU7XG4gIGxldCBzb3VyY2VkID0gZXZlLmZpbmRPbmUoXCJzb3VyY2VkIGVhdlwiLCB7c291cmNlfSk7XG4gIGlmKCFzb3VyY2VkKSB7XG4gICAgY29uc29sZS5lcnJvcihcIlRyaWVkIHRvIG1vZGlmeSBhIHNvdXJjZWQgZWF2IHRoYXQgZG9lc24ndCBleGlzdD9cIilcbiAgICByZXR1cm47XG4gIH1cbiAgaWYocmVwbGFjZVZhbHVlICE9PSB1bmRlZmluZWQgJiYgc291cmNlZC52YWx1ZSAhPT0gcmVwbGFjZVZhbHVlLnRyaW0oKSkge1xuICAgIGNoYW5nZXMucmVtb3ZlKFwic291cmNlZCBlYXZcIiwge3NvdXJjZX0pO1xuICAgIGlmKGF0dHJpYnV0ZSA9PT0gXCJkZXNjcmlwdGlvblwiKSB7XG4gICAgICByZXBsYWNlVmFsdWUgPSBgXCIke3JlcGxhY2VWYWx1ZS5yZXBsYWNlKC9cXFwiL2csICdcXFxcXCInKX1cImA7XG4gICAgfVxuICAgIGNoYW5nZXMuZGlzcGF0Y2goXCJhZGQgc291cmNlZCBlYXZcIiwge2VudGl0eTogZW50aXR5SWQsIGF0dHJpYnV0ZSwgdmFsdWU6IHJlcGxhY2VWYWx1ZSwgZm9yY2VFbnRpdHk6IHRydWV9KTtcbiAgfVxuICBjaGFuZ2VzLmRpc3BhdGNoKFwiYWN0aXZhdGUgdGlsZVwiLCB7Y2FyZElkOiBrZXl9KTtcbn0pO1xuXG5mdW5jdGlvbiBoYW5kbGVUaWxlS2V5cyhldmVudCwgZWxlbSkge1xuICBpZihldmVudC5rZXlDb2RlID09PSBLRVlTLkVOVEVSKSB7XG4gICAgaWYoZWxlbS5zb3VyY2UpIHtcbiAgICAgIGRpc3BhdGNoKFwicmVwbGFjZSBzb3VyY2VkIHRpbGVcIiwge2tleTogZWxlbS5jYXJkSWQsIHNvdXJjZTogZWxlbS5zb3VyY2UsIGF0dHJpYnV0ZTogZWxlbS5hdHRyaWJ1dGUsIGVudGl0eUlkOiBlbGVtLmVudGl0eUlkfSkuY29tbWl0KCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGRpc3BhdGNoKFwic3VibWl0IGxpc3QgdGlsZVwiLCB7Y2FyZElkOiBlbGVtLmNhcmRJZCwgYXR0cmlidXRlOiBlbGVtLmF0dHJpYnV0ZSwgZW50aXR5SWQ6IGVsZW0uZW50aXR5SWQsIHJldmVyc2VFbnRpdHlBbmRWYWx1ZTogZWxlbS5yZXZlcnNlRW50aXR5QW5kVmFsdWV9KS5jb21taXQoKTtcbiAgICB9XG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgfSBlbHNlIGlmKGV2ZW50LmtleUNvZGUgPT09IEtFWVMuRVNDKSB7XG4gICAgZGlzcGF0Y2goXCJhY3RpdmF0ZSB0aWxlXCIsIHtjYXJkSWQ6IGVsZW0uY2FyZElkfSkuY29tbWl0KCk7XG4gIH1cbn1cblxuZnVuY3Rpb24gYXV0b3NpemVBbmRTdG9yZVRleHRhcmVhKGV2ZW50LCBlbGVtKSB7XG4gIGxldCBub2RlID0gZXZlbnQuY3VycmVudFRhcmdldDtcbiAgc3RvcmVBY3RpdmVUaWxlVmFsdWUoZWxlbSwgbm9kZS52YWx1ZSk7XG4gIGF1dG9zaXplVGV4dGFyZWEobm9kZSwgZWxlbSk7XG59XG5cbmZ1bmN0aW9uIHRleHRUaWxlKGVsZW0pIHtcbiAgbGV0IHt2YWx1ZSwgZGF0YSwgYXR0cmlidXRlLCBjYXJkSWQsIGVudGl0eUlkfSA9IGVsZW07XG4gIGxldCB0aWxlSWQgPSB2YWx1ZS5zb3VyY2U7XG4gIGxldCBzb3VyY2UgPSB2YWx1ZS5zb3VyY2U7XG4gIGxldCBzdGF0ZSA9IHVpU3RhdGUud2lkZ2V0LmNhcmRbY2FyZElkXSB8fCB7fTtcbiAgbGV0IGFjdGl2ZSA9IGlzVGlsZUFjdGl2ZShjYXJkSWQsIHRpbGVJZCk7XG4gIGxldCB0aWxlQ2hpbGRyZW4gPSBbXTtcbiAgaWYoYXR0cmlidXRlICE9PSBcImRlc2NyaXB0aW9uXCIpIHtcbiAgICB0aWxlQ2hpbGRyZW4ucHVzaCh7YzogXCJwcm9wZXJ0eVwiLCB0ZXh0OiBhdHRyaWJ1dGV9KTtcbiAgfVxuICBpZighYWN0aXZlKSB7XG4gICAgdGlsZUNoaWxkcmVuLnB1c2goe2M6IFwidmFsdWUgdGV4dFwiLCB0ZXh0OiB2YWx1ZS5lYXYudmFsdWV9KTtcbiAgfSBlbHNlIHtcbiAgICB0aWxlQ2hpbGRyZW4ucHVzaCh7dDogXCJ0ZXh0YXJlYVwiLCBjOiBcInZhbHVlIHRleHRcIiwgc291cmNlLCBhdHRyaWJ1dGUsIHN0b3JlQXR0cmlidXRlOiBcInJlcGxhY2VWYWx1ZVwiLCBjYXJkSWQsIGVudGl0eUlkLFxuICAgICAgICAgICAgICAgICAgICAgIGtleWRvd246IGhhbmRsZVRpbGVLZXlzLCBpbnB1dDogYXV0b3NpemVBbmRTdG9yZVRleHRhcmVhLCBwb3N0UmVuZGVyOiBhdXRvc2l6ZUFuZEZvY3VzVGV4dEFyZWEsIHZhbHVlOiB2YWx1ZS5lYXYudmFsdWV9KTtcbiAgfVxuICByZXR1cm4gdGlsZSh7YzogXCJmdWxsXCIsIHRpbGVJZCwgY2FyZElkLCBlbnRpdHlJZCwgYXR0cmlidXRlLCBzb3VyY2UsIGFjdGl2ZSwgY2hpbGRyZW46IHRpbGVDaGlsZHJlbn0pO1xufVxuXG5mdW5jdGlvbiBhdXRvc2l6ZUFuZFN0b3JlSW5wdXQoZXZlbnQsIGVsZW0pIHtcbiAgbGV0IG5vZGUgPSBldmVudC5jdXJyZW50VGFyZ2V0O1xuICBzdG9yZUFjdGl2ZVRpbGVWYWx1ZShlbGVtLCBub2RlLnZhbHVlKTtcbiAgdWl0ay5hdXRvc2l6ZUlucHV0KG5vZGUsIGVsZW0pO1xufVxuXG5mdW5jdGlvbiB2YWx1ZVRpbGUoZWxlbSkge1xuICBsZXQge3ZhbHVlLCBkYXRhLCBhdHRyaWJ1dGUsIGNhcmRJZCwgZW50aXR5SWR9ID0gZWxlbTtcbiAgbGV0IHRpbGVJZCA9IGF0dHJpYnV0ZTtcbiAgbGV0IHNvdXJjZSA9IHZhbHVlLnNvdXJjZTtcbiAgbGV0IHN0YXRlID0gdWlTdGF0ZS53aWRnZXQuY2FyZFtjYXJkSWRdIHx8IHt9O1xuICBsZXQgYWN0aXZlID0gaXNUaWxlQWN0aXZlKGNhcmRJZCwgdGlsZUlkKTtcbiAgbGV0IHRpbGVDaGlsZHJlbiA9IFtdO1xuICB0aWxlQ2hpbGRyZW4ucHVzaCh7YzogXCJwcm9wZXJ0eVwiLCB0ZXh0OiBhdHRyaWJ1dGV9KTtcbiAgbGV0IHVpO1xuICBsZXQgY29udGVudCA9IHVpdGsucmVzb2x2ZU5hbWUodmFsdWUuZWF2LnZhbHVlKTtcbiAgaWYoIWNvbnRlbnQpIGNvbnRlbnQgPSB2YWx1ZS5lYXYudmFsdWU7XG4gIGlmKCFhY3RpdmUpIHtcbiAgICB1aSA9IHVpdGsudmFsdWUoe2M6IFwidmFsdWVcIiwgZGF0YSwgdmFsdWU6IHZhbHVlLmVhdi52YWx1ZX0pO1xuICB9IGVsc2Uge1xuICAgIHVpID0ge3Q6IFwiaW5wdXRcIiwgYzogXCJ2YWx1ZVwiLCBzb3VyY2UsIGF0dHJpYnV0ZSwgc3RvcmVBdHRyaWJ1dGU6IFwicmVwbGFjZVZhbHVlXCIsIGNhcmRJZCwgZW50aXR5SWQsIHZhbHVlOiBjb250ZW50LCBwb3N0UmVuZGVyOiB1aXRrLmF1dG9zaXplQW5kRm9jdXMsXG4gICAgaW5wdXQ6IGF1dG9zaXplQW5kU3RvcmVJbnB1dCwga2V5ZG93bjogaGFuZGxlVGlsZUtleXN9O1xuICB9XG4gIGxldCBtYXggPSBNYXRoLm1heChjb250ZW50LnRvU3RyaW5nKCkubGVuZ3RoLCAwKTtcbiAgdGlsZUNoaWxkcmVuLnB1c2goe2M6IFwidmFsdWVcIiwgY2hpbGRyZW46IFt1aV19KTtcbiAgbGV0IHNpemU7XG4gIGlmKG1heCA8PSA4KSB7XG4gICAgc2l6ZSA9IFwic21hbGxcIjtcbiAgfSBlbHNlIGlmKG1heCA8PSAxNikge1xuICAgIHNpemUgPSBcIm1lZGl1bVwiO1xuICB9IGVsc2Uge1xuICAgIHNpemUgPSBcImZ1bGxcIjtcbiAgfVxuICBsZXQga2xhc3MgPSBzaXplO1xuICBpZighdmFsdWUuaXNNYW51YWwpIHtcbiAgICBrbGFzcyArPSBcIiBjb21wdXRlZFwiO1xuICB9XG4gIHJldHVybiB0aWxlKHtjOiBrbGFzcywgc2l6ZSwgY2FyZElkLCBkYXRhLCB0aWxlSWQsIGFjdGl2ZSwgYXR0cmlidXRlLCBzb3VyY2UsIGVudGl0eUlkLCBjaGlsZHJlbjogdGlsZUNoaWxkcmVufSk7XG59XG5cbmZ1bmN0aW9uIGltYWdlVGlsZShlbGVtKSB7XG4gIGxldCB7dmFsdWVzLCBkYXRhLCBhdHRyaWJ1dGUsIGNhcmRJZCwgZW50aXR5SWR9ID0gZWxlbTtcbiAgbGV0IHVpO1xuICBpZih2YWx1ZXMubGVuZ3RoID4gMSkge1xuICAgIGVsZW0ucmVwID0gXCJleHRlcm5hbEltYWdlXCI7XG4gICAgZWxlbS5ub1Byb3BlcnR5ID0gdHJ1ZTtcbiAgICBlbGVtLmMgPSBcImltYWdlIFwiO1xuICAgIHVpID0gbGlzdFRpbGUoZWxlbSk7XG4gIH0gZWxzZSB7XG4gICAgbGV0IHZhbHVlID0gdmFsdWVzWzBdO1xuICAgIGxldCBzb3VyY2UgPSB2YWx1ZS5zb3VyY2U7XG4gICAgbGV0IHNpemUgPSBcImZ1bGxcIjtcbiAgICBsZXQga2xhc3MgPSBcImltYWdlIGZ1bGxcIjtcbiAgICBsZXQgdGlsZUlkID0gYXR0cmlidXRlO1xuICAgIGxldCB0aWxlQ2hpbGRyZW4gPSBbe3Q6IFwiaW1nXCIsIGM6IFwiaW1hZ2VcIiwgc3JjOiBgJHt2YWx1ZS5lYXYudmFsdWV9YH1dO1xuICAgIGxldCBhY3RpdmUgPSBpc1RpbGVBY3RpdmUoY2FyZElkLCB0aWxlSWQpO1xuICAgIHVpID0gdGlsZSh7Yzoga2xhc3MsIHNpemUsIGNhcmRJZCwgZGF0YSwgdGlsZUlkLCBhY3RpdmUsIGF0dHJpYnV0ZSwgc291cmNlLCBlbnRpdHlJZCwgY2hpbGRyZW46IHRpbGVDaGlsZHJlbn0pO1xuICB9XG4gIHJldHVybiB1aTtcbn1cblxuZnVuY3Rpb24gZG9jdW1lbnRUaWxlKGVsZW0pIHtcbiAgbGV0IHt2YWx1ZSwgZGF0YSwgYXR0cmlidXRlLCBjYXJkSWQsIGVudGl0eUlkfSA9IGVsZW07XG4gIGxldCB0aWxlQ2hpbGRyZW4gPSBbXTtcbiAgbGV0IHRpbGVJZCA9IGF0dHJpYnV0ZTtcbiAgbGV0IHNvdXJjZSA9IHZhbHVlLnNvdXJjZTtcbiAgbGV0IHN0YXRlID0gdWlTdGF0ZS53aWRnZXQuY2FyZFtjYXJkSWRdIHx8IHt9O1xuICBsZXQgYWN0aXZlID0gaXNUaWxlQWN0aXZlKGNhcmRJZCwgdGlsZUlkKTtcbiAgbGV0IHNpemUgPSBcImZ1bGxcIjtcbiAgbGV0IGtsYXNzID0gXCJkb2N1bWVudCBmdWxsXCI7XG4gIHJldHVybiB0aWxlKHtjOiBrbGFzcywgc2l6ZSwgY2FyZElkLCBkYXRhLCB0aWxlSWQsIGFjdGl2ZSwgYXR0cmlidXRlLCBzb3VyY2UsIGVudGl0eUlkLCBjaGlsZHJlbjogdGlsZUNoaWxkcmVufSk7XG59XG5cbmZ1bmN0aW9uIHJvdyhlbGVtKSB7XG4gIGVsZW0uYyA9IGAke2VsZW0uYyB8fCBcIlwifSByb3cgZmxleC1yb3dgO1xuICByZXR1cm4gZWxlbTtcbn1cblxuZnVuY3Rpb24gZ2V0RUFWSW5mbyhlYXYpIHtcbiAgbGV0IHtlbnRpdHksIGF0dHJpYnV0ZSwgdmFsdWV9ID0gZWF2O1xuICBsZXQgZm91bmQgPSBldmUuZmluZE9uZShcImdlbmVyYXRlZCBlYXZcIiwge2VudGl0eSwgYXR0cmlidXRlLCB2YWx1ZX0pO1xuICBsZXQgc291cmNlSWQgPSBldmUuZmluZE9uZShcInNvdXJjZWQgZWF2XCIsIHtlbnRpdHksIGF0dHJpYnV0ZSwgdmFsdWV9KTtcbiAgbGV0IGl0ZW06YW55ID0ge2VhdiwgaXNNYW51YWw6ICFmb3VuZH07XG4gIGlmKGZvdW5kKSB7XG4gICAgaXRlbS5zb3VyY2VWaWV3ID0gZm91bmQuc291cmNlO1xuICAgIGl0ZW0uc291cmNlID0gZm91bmQuc291cmNlO1xuICB9IGVsc2UgaWYoc291cmNlSWQpIHtcbiAgICBpdGVtLnNvdXJjZSA9IHNvdXJjZUlkLnNvdXJjZTtcbiAgfVxuICByZXR1cm4gaXRlbTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGVudGl0eVRpbGVzVUkoZW50aXR5SWQsIHBhbmVJZCwgY2FyZElkKSB7XG4gIHZhciBlYXZzID0gZXZlLmZpbmQoXCJlbnRpdHkgZWF2c1wiLCB7ZW50aXR5OiBlbnRpdHlJZH0pO1xuICB2YXIgaXRlbXMgPSB7fTtcbiAgdmFyIGF0dHJzID0gW107XG4gIGZvcihsZXQgZWF2IG9mIGVhdnMpIHtcbiAgICBsZXQge2F0dHJpYnV0ZX0gPSBlYXY7XG4gICAgbGV0IGluZm8gPSBnZXRFQVZJbmZvKGVhdik7XG4gICAgaWYoIWl0ZW1zW2F0dHJpYnV0ZV0pIHtcbiAgICAgIGl0ZW1zW2F0dHJpYnV0ZV0gPSBbXTtcbiAgICAgIGF0dHJzLnB1c2goYXR0cmlidXRlKTtcbiAgICB9XG4gICAgaXRlbXNbYXR0cmlidXRlXS5wdXNoKGluZm8pO1xuICB9XG4gIGxldCB0aWxlcyA9IHtcInNtYWxsXCI6IFtdLCBcIm1lZGl1bVwiOiBbXSwgXCJmdWxsXCI6IFtdLCBcImlzIGFcIjogW119O1xuICBsZXQgcm93cyA9IFtdO1xuICBsZXQgZGF0YSA9IHtwYW5lSWQsIGVudGl0eUlkfTtcbiAgaWYoaXRlbXNbXCJpbWFnZVwiXSkge1xuICAgIGxldCB2YWx1ZXMgPSBpdGVtc1tcImltYWdlXCJdO1xuICAgIGxldCB0aWxlID0gaW1hZ2VUaWxlKHt2YWx1ZXMsIGRhdGEsIGNhcmRJZCwgZW50aXR5SWQsIGF0dHJpYnV0ZTogXCJpbWFnZVwifSk7XG4gICAgcm93cy5wdXNoKHJvdyh7Y2hpbGRyZW46IFt0aWxlXX0pKTtcbiAgICBkZWxldGUgaXRlbXNbXCJpbWFnZVwiXTtcbiAgfVxuXG4gIGlmKGl0ZW1zW1wiZGVzY3JpcHRpb25cIl0pIHtcbiAgICBsZXQgdmFsdWVzID0gaXRlbXNbXCJkZXNjcmlwdGlvblwiXTtcbiAgICBmb3IobGV0IHZhbHVlIG9mIHZhbHVlcykge1xuICAgICAgbGV0IHRpbGUgPSB0ZXh0VGlsZSh7dmFsdWUsIGRhdGEsIGNhcmRJZCwgZW50aXR5SWQsIGF0dHJpYnV0ZTogXCJkZXNjcmlwdGlvblwifSk7XG4gICAgICByb3dzLnB1c2gocm93KHtjaGlsZHJlbjogW3RpbGVdfSkpO1xuICAgIH1cbiAgICBkZWxldGUgaXRlbXNbXCJkZXNjcmlwdGlvblwiXTtcbiAgfVxuICBpZihldmUuZmluZE9uZShcImNvbGxlY3Rpb25cIiwge2NvbGxlY3Rpb246IGVudGl0eUlkfSkgfHwgZXZlLmZpbmRPbmUoXCJlbnRpdHkgZWF2c1wiLCB7ZW50aXR5OiBlbnRpdHlJZCwgYXR0cmlidXRlOiBcImlzIGFcIiwgdmFsdWU6IGFzRW50aXR5KFwiY29sbGVjdGlvblwiKX0pKSB7XG4gICAgbGV0IGxpc3RDaGlsZHJlbiA9IFtdO1xuICAgIGxldCBlbnRpdGllcyA9IGV2ZS5maW5kKFwiZW50aXR5IGVhdnNcIiwge2F0dHJpYnV0ZTogXCJpcyBhXCIsIHZhbHVlOiBlbnRpdHlJZH0pO1xuICAgIGxldCB2YWx1ZXMgPSBlbnRpdGllcy5tYXAoZ2V0RUFWSW5mbyk7XG4gICAgbGV0IHRpbGUgPSBsaXN0VGlsZSh7dmFsdWVzLCBkYXRhLCBjYXJkSWQsIGVudGl0eUlkLCBhdHRyaWJ1dGU6IFwiaXMgYVwiLCByZXZlcnNlRW50aXR5QW5kVmFsdWU6IHRydWUsIHRpbGVJZDogXCJfY29sbGVjdGlvbkl0ZW1zXCIsIG5vUHJvcGVydHk6IHRydWV9KTtcbiAgICByb3dzLnB1c2gocm93KHtjaGlsZHJlbjogW3RpbGVdfSkpO1xuICB9XG4gIGxldCB0aWxlc1RvUGxhY2UgPSAwO1xuICBmb3IobGV0IGF0dHJpYnV0ZSBvZiBhdHRycykge1xuICAgIGxldCB2YWx1ZXMgPSBpdGVtc1thdHRyaWJ1dGVdO1xuICAgIGlmKCF2YWx1ZXMpIGNvbnRpbnVlO1xuICAgIGxldCBuZXdUaWxlO1xuICAgIGlmKHZhbHVlcy5sZW5ndGggPiAxIHx8IGF0dHJpYnV0ZSA9PT0gXCJpcyBhXCIpIHtcbiAgICAgIG5ld1RpbGUgPSBsaXN0VGlsZSh7dmFsdWVzLCBkYXRhLCBhdHRyaWJ1dGUsIGNhcmRJZCwgZW50aXR5SWR9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgbmV3VGlsZSA9IHZhbHVlVGlsZSh7dmFsdWU6IHZhbHVlc1swXSwgZGF0YSwgYXR0cmlidXRlLCBjYXJkSWQsIGVudGl0eUlkfSk7XG4gICAgfVxuICAgIGxldCBzaXplID0gbmV3VGlsZS5zaXplO1xuICAgIHRpbGVzW3NpemVdLnB1c2gobmV3VGlsZSk7XG4gICAgaWYoc2l6ZSAhPT0gXCJpcyBhXCIpIHRpbGVzVG9QbGFjZSsrO1xuICB9XG5cbiAgbGV0IG9wdGlvbkl4ID0gMDtcbiAgd2hpbGUodGlsZXNUb1BsYWNlID4gMCkge1xuICAgIGxldCByb3dDaGlsZHJlbiA9IFtdO1xuICAgIGxldCBpdGVyID0gMDtcbiAgICB3aGlsZShpdGVyIDwgNSAmJiAhcm93Q2hpbGRyZW4ubGVuZ3RoKSB7XG4gICAgICBpZihvcHRpb25JeCA9PT0gMCAmJiB0aWxlc1tcImZ1bGxcIl0ubGVuZ3RoKSB7XG4gICAgICAgIHJvd0NoaWxkcmVuLnB1c2godGlsZXNbXCJmdWxsXCJdLnBvcCgpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBpZihvcHRpb25JeCA9PT0gMSAmJiB0aWxlc1tcIm1lZGl1bVwiXS5sZW5ndGggPiAxKSB7XG4gICAgICAgIHJvd0NoaWxkcmVuLnB1c2godGlsZXNbXCJtZWRpdW1cIl0ucG9wKCkpO1xuICAgICAgICByb3dDaGlsZHJlbi5wdXNoKHRpbGVzW1wibWVkaXVtXCJdLnBvcCgpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBpZihvcHRpb25JeCA9PT0gMiAmJiB0aWxlc1tcIm1lZGl1bVwiXS5sZW5ndGggJiYgdGlsZXNbXCJzbWFsbFwiXS5sZW5ndGggPj0gMSkge1xuICAgICAgICByb3dDaGlsZHJlbi5wdXNoKHRpbGVzW1wibWVkaXVtXCJdLnBvcCgpKTtcbiAgICAgICAgcm93Q2hpbGRyZW4ucHVzaCh0aWxlc1tcInNtYWxsXCJdLnBvcCgpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBpZihvcHRpb25JeCA9PT0gMyAmJiB0aWxlc1tcInNtYWxsXCJdLmxlbmd0aCA+PSAzKSB7XG4gICAgICAgIHJvd0NoaWxkcmVuLnB1c2godGlsZXNbXCJzbWFsbFwiXS5wb3AoKSk7XG4gICAgICAgIHJvd0NoaWxkcmVuLnB1c2godGlsZXNbXCJzbWFsbFwiXS5wb3AoKSk7XG4gICAgICAgIHJvd0NoaWxkcmVuLnB1c2godGlsZXNbXCJzbWFsbFwiXS5wb3AoKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgaWYob3B0aW9uSXggPT09IDQgJiYgdGlsZXNbXCJtZWRpdW1cIl0ubGVuZ3RoKSB7XG4gICAgICAgIHJvd0NoaWxkcmVuLnB1c2godGlsZXNbXCJtZWRpdW1cIl0ucG9wKCkpO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGlmKG9wdGlvbkl4ID4gNCkgb3B0aW9uSXggPSAwO1xuICAgICAgZWxzZSBvcHRpb25JeCsrO1xuICAgICAgaXRlcisrO1xuICAgIH1cbiAgICAvLyBhbnkgc21hbGxzIGxlZnRvdmVyXG4gICAgaWYoIXJvd0NoaWxkcmVuLmxlbmd0aCkge1xuICAgICAgd2hpbGUodGlsZXNbXCJzbWFsbFwiXS5sZW5ndGgpIHtcbiAgICAgICAgcm93Q2hpbGRyZW4ucHVzaCh0aWxlc1tcInNtYWxsXCJdLnBvcCgpKTtcbiAgICAgIH1cbiAgICB9XG4gICAgdGlsZXNUb1BsYWNlIC09IHJvd0NoaWxkcmVuLmxlbmd0aDtcbiAgICByb3dzLnB1c2goe2M6IFwiZmxleC1yb3cgcm93XCIsIGNoaWxkcmVuOiByb3dDaGlsZHJlbn0pO1xuICB9XG5cbiAgaWYodGlsZXNbXCJpcyBhXCJdKSB7XG4gICAgcm93cy5wdXNoKHtjOiBcImZsZXgtcm93IHJvd1wiLCBjaGlsZHJlbjogW3RpbGVzW1wiaXMgYVwiXVswXV19KTtcbiAgfVxuXG4gIGxldCBzdGF0ZSA9IHVpU3RhdGUud2lkZ2V0LmF0dHJpYnV0ZXNbZW50aXR5SWRdIHx8IHt9O1xuXG4gIHJldHVybiB7YzogXCJ0aWxlLXNjcm9sbFwiLCBjaGlsZHJlbjogW3tjOiBcInRpbGVzXCIsIGNoaWxkcmVuOiByb3dzfV19O1xufVxuXG5mdW5jdGlvbiBhdHRyaWJ1dGVzVUlBdXRvY29tcGxldGVPcHRpb25zKGlzRW50aXR5LCBwYXJzZWQsIHRleHQsIHBhcmFtcywgZW50aXR5SWQpIHtcbiAgbGV0IG9wdGlvbnM6e3Njb3JlOiBudW1iZXIsIGFjdGlvbjogYW55LCB0ZXh0OiBzdHJpbmcsIFthdHRyOnN0cmluZ106IGFueX1bXSA9IFtdO1xuICAvL3RoZXJlIGFyZSB0d28gcG9zc2libGUgdGhpbmdzIGVpdGhlciB3ZSdyZSBjcmVhdGluZyBhIHBhZ2VcbiAgLy8gb3Igd2UgbmVlZCB0byBwaWNrIHdoYXQgZmllbGQgb2YgdGhlIHJlc3VsdCB3ZSB3YW50XG4gIHJldHVybiBvcHRpb25zO1xufVxuXG5hcHBIYW5kbGUoXCJzZXRBY3RpdmVBdHRyaWJ1dGVcIiwgKGNoYW5nZXM6IERpZmYsIHtlYXYsIHNvdXJjZVZpZXd9KSA9PiB7XG4gIGlmKCF1aVN0YXRlLndpZGdldC5hdHRyaWJ1dGVzW2Vhdi5lbnRpdHldKSB7XG4gICAgdWlTdGF0ZS53aWRnZXQuYXR0cmlidXRlc1tlYXYuZW50aXR5XSA9IHt9O1xuICB9XG4gIGxldCBjdXIgPSB1aVN0YXRlLndpZGdldC5hdHRyaWJ1dGVzW2Vhdi5lbnRpdHldO1xuICBjdXIuYWN0aXZlID0gZWF2O1xuICBjdXIuc291cmNlVmlldyA9IHNvdXJjZVZpZXc7XG59KTtcblxuYXBwSGFuZGxlKFwiY2xlYXJBY3RpdmVBdHRyaWJ1dGVcIiwgKGNoYW5nZXM6IERpZmYsIHtlbnRpdHl9KSA9PiB7XG4gIGxldCBjdXIgPSB1aVN0YXRlLndpZGdldC5hdHRyaWJ1dGVzW2VudGl0eV07XG4gIGlmKGN1cikge1xuICAgIGN1ci5hY3RpdmUgPSBmYWxzZTtcbiAgICBjdXIuc291cmNlVmlldyA9IGZhbHNlO1xuICB9XG59KVxuXG5mdW5jdGlvbiByZW1vdmVTdWJJdGVtKGV2ZW50LCBlbGVtKSB7XG4gIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gIHN1Ym1pdEF0dHJpYnV0ZShldmVudCwgZWxlbSk7XG59XG5cbmZ1bmN0aW9uIHNldEFjdGl2ZUF0dHJpYnV0ZShldmVudCwgZWxlbSkge1xuICBpZighZXZlbnQuZGVmYXVsdFByZXZlbnRlZCkge1xuICAgIGRpc3BhdGNoKFwic2V0QWN0aXZlQXR0cmlidXRlXCIsIHtlYXY6IGVsZW0uZWF2LCBzb3VyY2VWaWV3OiBlbGVtLnNvdXJjZVZpZXd9KS5jb21taXQoKTtcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICB9XG59XG5cbmZ1bmN0aW9uIGhhbmRsZUF0dHJpYnV0ZXNLZXkoZXZlbnQsIGVsZW0pIHtcbiAgaWYoZXZlbnQua2V5Q29kZSA9PT0gS0VZUy5FTlRFUiAmJiBlbGVtLnN1Ym1pdCkge1xuICAgIGVsZW0uc3VibWl0KGV2ZW50LCBlbGVtKTtcbiAgfSBlbHNlIGlmKGV2ZW50LmtleUNvZGUgPT09IEtFWVMuRVNDKSB7XG4gICAgZGlzcGF0Y2goXCJzZXRBY3RpdmVBdHRyaWJ1dGVcIiwge2Vhdjoge2VudGl0eTogZWxlbS5lYXYuZW50aXR5fSwgc291cmNlVmlldzogZmFsc2V9KS5jb21taXQoKTtcbiAgfVxufVxuXG5hcHBIYW5kbGUoXCJzZXRBdHRyaWJ1dGVBZGRlclwiLCAoY2hhbmdlczpEaWZmLCB7ZW50aXR5SWQsIGZpZWxkLCB2YWx1ZX0pID0+IHtcbiAgbGV0IGN1ciA9IHVpU3RhdGUud2lkZ2V0LmF0dHJpYnV0ZXNbZW50aXR5SWRdO1xuICBpZighdWlTdGF0ZS53aWRnZXQuYXR0cmlidXRlc1tlbnRpdHlJZF0pIHtcbiAgICBjdXIgPSB1aVN0YXRlLndpZGdldC5hdHRyaWJ1dGVzW2VudGl0eUlkXSA9IHt9O1xuICB9XG4gIGN1cltmaWVsZF0gPSB2YWx1ZTtcbn0pO1xuXG5mdW5jdGlvbiBzZXRBZGRlcihldmVudCwgZWxlbSkge1xuICBsZXQgdmFsdWUgPSBldmVudC5jdXJyZW50VGFyZ2V0LnZhbHVlO1xuICBkaXNwYXRjaChcInNldEF0dHJpYnV0ZUFkZGVyXCIsIHtlbnRpdHlJZDogZWxlbS5lbnRpdHlJZCwgZmllbGQ6IGVsZW0uZmllbGQsIHZhbHVlfSkuY29tbWl0KCk7XG59XG5cbmZ1bmN0aW9uIHN1Ym1pdEFkZGVyKGV2ZW50LCBlbGVtKSB7XG4gIGxldCB7ZW50aXR5SWR9ID0gZWxlbTtcbiAgbGV0IHN0YXRlID0gdWlTdGF0ZS53aWRnZXQuYXR0cmlidXRlc1tlbnRpdHlJZF07XG4gIGlmKCFzdGF0ZSkgcmV0dXJuO1xuICBsZXQge2FkZGVyQXR0cmlidXRlLCBhZGRlclZhbHVlfSA9IHN0YXRlO1xuICBsZXQgc3VjY2VzcyA9IGZhbHNlO1xuICBpZihhZGRlckF0dHJpYnV0ZSAmJiBhZGRlclZhbHVlKSB7XG4gICAgbGV0IGNoYWluID0gZGlzcGF0Y2goXCJzZXRBdHRyaWJ1dGVBZGRlclwiLCB7ZW50aXR5SWQsIGZpZWxkOiBcImFkZGVyQXR0cmlidXRlXCIsIHZhbHVlOiBcIlwifSlcbiAgICAuZGlzcGF0Y2goXCJzZXRBdHRyaWJ1dGVBZGRlclwiLCB7ZW50aXR5SWQsIGZpZWxkOiBcImFkZGVyVmFsdWVcIiwgdmFsdWU6IFwiXCJ9KTtcbiAgICBzdWNjZXNzID0gaGFuZGxlQXR0cmlidXRlRGVmaW5pdGlvbihlbnRpdHlJZCwgYWRkZXJBdHRyaWJ1dGUsIGFkZGVyVmFsdWUsIGNoYWluKTtcbiAgfVxuICAvL21ha2Ugc3VyZSB0aGUgZm9jdXMgZW5kcyB1cCBiYWNrIGluIHRoZSBwcm9wZXJ0eSBpbnB1dFxuICBldmVudC5jdXJyZW50VGFyZ2V0LnBhcmVudE5vZGUuZmlyc3RDaGlsZC5mb2N1cygpO1xuICByZXR1cm4gc3VjY2Vzcztcbn1cblxuYXBwSGFuZGxlKFwicmVtb3ZlIGF0dHJpYnV0ZSBnZW5lcmF0aW5nIHF1ZXJ5XCIsIChjaGFuZ2VzOkRpZmYsIHtlYXYsIHZpZXd9KSA9PiB7XG4gIGxldCBxdWVyeUlkID0gYCR7ZWF2LmVudGl0eX18JHtlYXYuYXR0cmlidXRlfXwke3ZpZXd9YDtcbiAgZXZlLnJlbW92ZVZpZXcocXVlcnlJZClcbiAgY2hhbmdlcy5tZXJnZShRdWVyeS5yZW1vdmUocXVlcnlJZCwgZXZlKSk7XG4gIC8vZmluZCBhbGwgdGhlIHVuaW9ucyB0aGlzIHdhcyB1c2VkIHdpdGhcbiAgZm9yKGxldCBzb3VyY2Ugb2YgZXZlLmZpbmQoXCJhY3Rpb24gc291cmNlXCIsIHtcInNvdXJjZSB2aWV3XCI6IHF1ZXJ5SWR9KSkge1xuICAgIGxldCBhY3Rpb24gPSBzb3VyY2UuYWN0aW9uO1xuICAgIGNoYW5nZXMucmVtb3ZlKFwiYWN0aW9uXCIsIHthY3Rpb259KTtcbiAgICBjaGFuZ2VzLnJlbW92ZShcImFjdGlvbiBtYXBwaW5nXCIsIHthY3Rpb259KTtcbiAgICBjaGFuZ2VzLnJlbW92ZShcImFjdGlvbiBtYXBwaW5nIGNvbnN0YW50XCIsIHthY3Rpb259KTtcbiAgfVxuICBjaGFuZ2VzLnJlbW92ZShcImFjdGlvbiBzb3VyY2VcIiwge3NvdXJjZTogcXVlcnlJZH0pO1xufSk7XG5cbmZ1bmN0aW9uIHN1Ym1pdEF0dHJpYnV0ZShldmVudCwgZWxlbSkge1xuICBsZXQge2Vhdiwgc291cmNlVmlldywgcXVlcnl9ID0gZWxlbTtcbiAgbGV0IGNoYWluID0gZGlzcGF0Y2goXCJjbGVhckFjdGl2ZUF0dHJpYnV0ZVwiLCB7ZW50aXR5OiBlYXYuZW50aXR5fSk7XG4gIGxldCB2YWx1ZSA9ICBldmVudC5jdXJyZW50VGFyZ2V0LnZhbHVlO1xuICBpZihxdWVyeSAhPT0gdW5kZWZpbmVkICYmIHZhbHVlID09PSBxdWVyeSkge1xuICAgIHJldHVybiBjaGFpbi5jb21taXQoKTtcbiAgfVxuICBpZihlbGVtLnNvdXJjZVZpZXcgIT09IHVuZGVmaW5lZCkge1xuICAgIC8vcmVtb3ZlIHRoZSBwcmV2aW91cyBzb3VyY2VcbiAgICBjaGFpbi5kaXNwYXRjaChcInJlbW92ZSBhdHRyaWJ1dGUgZ2VuZXJhdGluZyBxdWVyeVwiLCB7ZWF2LCB2aWV3OiBzb3VyY2VWaWV3fSk7XG4gIH0gZWxzZSB7XG4gICAgLy9yZW1vdmUgdGhlIHByZXZpb3VzIGVhdlxuICAgIGxldCBmYWN0ID0gY29weShlYXYpO1xuICAgIGZhY3QuX19pZCA9IHVuZGVmaW5lZDtcbiAgICBjaGFpbi5kaXNwYXRjaChcInJlbW92ZSBlbnRpdHkgYXR0cmlidXRlXCIsIGZhY3QpO1xuICB9XG4gIGlmKHZhbHVlICE9PSB1bmRlZmluZWQgJiYgdmFsdWUgIT09IFwiXCIpIHtcbiAgICByZXR1cm4gaGFuZGxlQXR0cmlidXRlRGVmaW5pdGlvbihlYXYuZW50aXR5LCBlYXYuYXR0cmlidXRlLCB2YWx1ZSwgY2hhaW4pO1xuICB9IGVsc2Uge1xuICAgIGNoYWluLmNvbW1pdCgpO1xuICB9XG59XG5cbi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4vLyBXaWtpIFdpZGdldHNcbi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5leHBvcnQgZnVuY3Rpb24gc2VhcmNoSW5wdXQocGFuZUlkOnN0cmluZywgdmFsdWU6c3RyaW5nKTpFbGVtZW50IHtcbiAgbGV0IHN0YXRlOmFueSA9IHVpU3RhdGUud2lkZ2V0LnNlYXJjaFtwYW5lSWRdIHx8IHtmb2N1c2VkOiBmYWxzZSwgcGxhbjogZmFsc2V9O1xuICBsZXQgbmFtZSA9IHN0YXRlLnZhbHVlO1xuICBpZighc3RhdGUudmFsdWUpIHN0YXRlLnZhbHVlID0gbmFtZTtcbiAgbGV0IGRpc3BsYXkgPSBldmUuZmluZE9uZShcImRpc3BsYXkgbmFtZVwiLCB7aWQ6IG5hbWV9KTtcbiAgaWYoZGlzcGxheSkgbmFtZSA9IGRpc3BsYXkubmFtZTtcbiAgcmV0dXJuIHtcbiAgICBjOiBcImZsZXgtZ3JvdyB3aWtpLXNlYXJjaC13cmFwcGVyXCIsXG4gICAgY2hpbGRyZW46IFtcbiAgICAgIHtjOiBcImNvbnRyb2xzXCIsIGNoaWxkcmVuOiBbXG4gICAgICAgIC8vIHtjOiBgaW9uLWlvcy1hcnJvdy0ke3N0YXRlLnBsYW4gPyAndXAnIDogJ2Rvd24nfSBwbGFuYCwgY2xpY2s6IHRvZ2dsZVNlYXJjaFBsYW4sIHBhbmVJZH0sXG4gICAgICAgIC8vIHdoaWxlIHRlY2huaWNhbGx5IGEgYnV0dG9uLCB3ZSBkb24ndCBuZWVkIHRvIGRvIGFueXRoaW5nIGFzIGNsaWNraW5nIGl0IHdpbGwgYmx1ciB0aGUgZWRpdG9yXG4gICAgICAgIC8vIHdoaWNoIHdpbGwgZXhlY3V0ZSB0aGUgc2VhcmNoXG4gICAgICAgIHtjOiBcImlvbi1hbmRyb2lkLXNlYXJjaCB2aXNpYmxlXCIsIHBhbmVJZCwgY2xpY2s6IGZvY3VzT3JTZXRTZWFyY2h9XG4gICAgICBdfSxcbiAgICAgIGNvZGVNaXJyb3JFbGVtZW50KHtcbiAgICAgICAgYzogYGZsZXgtZ3JvdyB3aWtpLXNlYXJjaC1pbnB1dCAke3N0YXRlLmZvY3VzZWQgPyBcInNlbGVjdGVkXCI6IFwiXCJ9YCxcbiAgICAgICAgcGFuZUlkLFxuICAgICAgICBhdXRvRm9jdXM6IHRydWUsXG4gICAgICAgIHZhbHVlOiBuYW1lLFxuICAgICAgICBmb2N1czogZm9jdXNTZWFyY2gsXG4gICAgICAgIC8vIGJsdXI6IHNldFNlYXJjaCxcbiAgICAgICAgY3Vyc29yUG9zaXRpb246IFwiZW5kXCIsXG4gICAgICAgIGNoYW5nZTogdXBkYXRlU2VhcmNoLFxuICAgICAgICBzaG9ydGN1dHM6IHtcIkVudGVyXCI6IHNldFNlYXJjaH1cbiAgICAgIH0pLFxuICAgIF1cbiAgfTtcbn07XG5cbmZ1bmN0aW9uIGZvY3VzU2VhcmNoKGV2ZW50LCBlbGVtKSB7XG4gIGRpc3BhdGNoKFwidWkgZm9jdXMgc2VhcmNoXCIsIGVsZW0pLmNvbW1pdCgpO1xufVxuZnVuY3Rpb24gc2V0U2VhcmNoKGV2ZW50LCBlbGVtKSB7XG4gIGxldCBzdGF0ZTphbnkgPSB1aVN0YXRlLndpZGdldC5zZWFyY2hbZWxlbS5wYW5lSWRdIHx8IHt2YWx1ZTogXCJcIn07XG4gIGxldCB2YWx1ZSA9IGV2ZW50LnZhbHVlICE9PSB1bmRlZmluZWQgPyBldmVudC52YWx1ZSA6IHN0YXRlLnZhbHVlO1xuICBsZXQgcGFuZSA9IGV2ZS5maW5kT25lKFwidWkgcGFuZVwiLCB7cGFuZTogZWxlbS5wYW5lSWR9KTtcbiAgaWYoIXBhbmUgfHwgcGFuZS5jb250YWlucyAhPT0gZXZlbnQudmFsdWUpIHtcbiAgICBsZXQge2NoYWluLCBpc1NldFNlYXJjaH0gPSBkaXNwYXRjaFNlYXJjaFNldEF0dHJpYnV0ZXModmFsdWUpO1xuICAgIGlmKGlzU2V0U2VhcmNoKSB7XG4gICAgICBjaGFpbi5kaXNwYXRjaChcInVpIHVwZGF0ZSBzZWFyY2hcIiwge3BhbmVJZDogZWxlbS5wYW5lSWQsIHZhbHVlOiBwYW5lLmNvbnRhaW5zfSk7XG4gICAgICBjaGFpbi5jb21taXQoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY2hhaW4uZGlzcGF0Y2goXCJpbnNlcnQgcXVlcnlcIiwge3F1ZXJ5OiB2YWx1ZX0pXG4gICAgICAuZGlzcGF0Y2goXCJzZXQgcGFuZVwiLCB7cGFuZUlkOiBlbGVtLnBhbmVJZCwgY29udGFpbnM6IHZhbHVlfSlcbiAgICAgIC5jb21taXQoKTtcbiAgICB9XG4gIH1cbn1cblxuZnVuY3Rpb24gZm9jdXNPclNldFNlYXJjaChldmVudCwgZWxlbSkge1xuICBsZXQgdGFyZ2V0ID0gPEhUTUxFbGVtZW50PmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIud2lraS1zZWFyY2gtaW5wdXRcIik7XG4gIGxldCBjbTpDb2RlTWlycm9yLkVkaXRvciA9IHRhcmdldFtcImNtXCJdO1xuICBsZXQgc3RhdGU6YW55ID0gdWlTdGF0ZS53aWRnZXQuc2VhcmNoW2VsZW0ucGFuZUlkXSB8fCB7dmFsdWU6IFwiXCJ9O1xuICBsZXQgcmF3VmFsID0gY20uZ2V0RG9jKCkuZ2V0VmFsdWUoKTtcbiAgbGV0IHZhbHVlID0gcmF3VmFsICE9PSB1bmRlZmluZWQgPyByYXdWYWwgOiBzdGF0ZS52YWx1ZTtcbiAgbGV0IHBhbmUgPSBldmUuZmluZE9uZShcInVpIHBhbmVcIiwge3BhbmU6IGVsZW0ucGFuZUlkfSk7XG5cbiAgaWYoIXBhbmUgfHwgcGFuZS5jb250YWlucyAhPT0gKGFzRW50aXR5KHZhbHVlKSB8fCB2YWx1ZSkpIHtcbiAgICBsZXQge2NoYWluLCBpc1NldFNlYXJjaH0gPSBkaXNwYXRjaFNlYXJjaFNldEF0dHJpYnV0ZXModmFsdWUpO1xuICAgIGNoYWluLmRpc3BhdGNoKFwiaW5zZXJ0IHF1ZXJ5XCIsIHtxdWVyeTogdmFsdWV9KVxuICAgICAgLmRpc3BhdGNoKFwic2V0IHBhbmVcIiwge3BhbmVJZDogZWxlbS5wYW5lSWQsIGNvbnRhaW5zOiB2YWx1ZX0pXG4gICAgICAuY29tbWl0KCk7XG4gIH0gZWxzZSB7XG4gICAgY20uZm9jdXMoKTtcbiAgfVxufVxuXG5mdW5jdGlvbiB1cGRhdGVTZWFyY2goZXZlbnQsIGVsZW0pIHtcbiAgZGlzcGF0Y2goXCJ1aSB1cGRhdGUgc2VhcmNoXCIsIHtwYW5lSWQ6IGVsZW0ucGFuZUlkLCB2YWx1ZTogZXZlbnQudmFsdWV9KS5jb21taXQoKTtcbn1cbmZ1bmN0aW9uIHRvZ2dsZVNlYXJjaFBsYW4oZXZlbnQsIGVsZW0pIHtcbiAgZGlzcGF0Y2goXCJ1aSB0b2dnbGUgc2VhcmNoIHBsYW5cIiwgZWxlbSkuY29tbWl0KCk7XG59XG5cbi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4vLyBVSVRLXG4vLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuaW50ZXJmYWNlIENNTm9kZSBleHRlbmRzIEhUTUxFbGVtZW50IHsgY206IGFueSB9XG5pbnRlcmZhY2UgQ01FbGVtZW50IGV4dGVuZHMgRWxlbWVudCB7XG4gIGF1dG9Gb2N1cz86IGJvb2xlYW5cbiAgbGluZU51bWJlcnM/OiBib29sZWFuLFxuICBsaW5lV3JhcHBpbmc/OiBib29sZWFuLFxuICBtb2RlPzogc3RyaW5nLFxuICBzaG9ydGN1dHM/OiB7W3Nob3J0Y3V0OnN0cmluZ106IEhhbmRsZXI8YW55Pn1cbn07XG5pbnRlcmZhY2UgQ01FdmVudCBleHRlbmRzIEV2ZW50IHtcbiAgZWRpdG9yOiBDb2RlTWlycm9yLkVkaXRvclxuICB2YWx1ZTogc3RyaW5nXG59XG5leHBvcnQgZnVuY3Rpb24gY29kZU1pcnJvckVsZW1lbnQoZWxlbTpDTUVsZW1lbnQpOkNNRWxlbWVudCB7XG4gIGVsZW0ucG9zdFJlbmRlciA9IGNvZGVNaXJyb3JQb3N0UmVuZGVyKGVsZW0ucG9zdFJlbmRlcik7XG4gIGVsZW1bXCJjbUNoYW5nZVwiXSA9IGVsZW0uY2hhbmdlO1xuICBlbGVtW1wiY21CbHVyXCJdID0gZWxlbS5ibHVyO1xuICBlbGVtW1wiY21Gb2N1c1wiXSA9IGVsZW0uZm9jdXM7XG4gIGVsZW0uY2hhbmdlID0gdW5kZWZpbmVkO1xuICBlbGVtLmJsdXIgPSB1bmRlZmluZWQ7XG4gIGVsZW0uZm9jdXMgPSB1bmRlZmluZWQ7XG4gIHJldHVybiBlbGVtO1xufVxuXG5sZXQgX2NvZGVNaXJyb3JQb3N0UmVuZGVyTWVtbyA9IHt9O1xuZnVuY3Rpb24gaGFuZGxlQ01FdmVudChoYW5kbGVyOkhhbmRsZXI8RXZlbnQ+LCBlbGVtOkNNRWxlbWVudCk6KGNtOkNvZGVNaXJyb3IuRWRpdG9yKSA9PiB2b2lkIHtcbiAgcmV0dXJuIChjbTpDb2RlTWlycm9yLkVkaXRvcikgPT4ge1xuICAgIGxldCBldnQgPSA8Q01FdmVudD48YW55PihuZXcgQ3VzdG9tRXZlbnQoXCJDTUV2ZW50XCIpKTtcbiAgICBldnQuZWRpdG9yID0gY207XG4gICAgZXZ0LnZhbHVlID0gY20uZ2V0RG9jKCkuZ2V0VmFsdWUoKTtcbiAgICBoYW5kbGVyKGV2dCwgZWxlbSk7XG4gIH1cbn1cbmZ1bmN0aW9uIGNvZGVNaXJyb3JQb3N0UmVuZGVyKHBvc3RSZW5kZXI/OlJlbmRlckhhbmRsZXIpOlJlbmRlckhhbmRsZXIge1xuICBsZXQga2V5ID0gcG9zdFJlbmRlciA/IHBvc3RSZW5kZXIudG9TdHJpbmcoKSA6IFwiXCI7XG4gIGlmKF9jb2RlTWlycm9yUG9zdFJlbmRlck1lbW9ba2V5XSkgcmV0dXJuIF9jb2RlTWlycm9yUG9zdFJlbmRlck1lbW9ba2V5XTtcbiAgcmV0dXJuIF9jb2RlTWlycm9yUG9zdFJlbmRlck1lbW9ba2V5XSA9IChub2RlOkNNTm9kZSwgZWxlbTpDTUVsZW1lbnQpID0+IHtcbiAgICBsZXQgY20gPSBub2RlLmNtO1xuICAgIGlmKCFjbSkge1xuICAgICAgbGV0IGV4dHJhS2V5cyA9IHt9O1xuICAgICAgaWYoZWxlbS5zaG9ydGN1dHMpIHtcbiAgICAgICAgZm9yKGxldCBzaG9ydGN1dCBpbiBlbGVtLnNob3J0Y3V0cylcbiAgICAgICAgICBleHRyYUtleXNbc2hvcnRjdXRdID0gaGFuZGxlQ01FdmVudChlbGVtLnNob3J0Y3V0c1tzaG9ydGN1dF0sIGVsZW0pO1xuICAgICAgfVxuICAgICAgY20gPSBub2RlLmNtID0gQ29kZU1pcnJvcihub2RlLCB7XG4gICAgICAgIGxpbmVXcmFwcGluZzogZWxlbS5saW5lV3JhcHBpbmcgIT09IGZhbHNlID8gdHJ1ZSA6IGZhbHNlLFxuICAgICAgICBsaW5lTnVtYmVyczogZWxlbS5saW5lTnVtYmVycyxcbiAgICAgICAgbW9kZTogZWxlbS5tb2RlIHx8IFwidGV4dFwiLFxuICAgICAgICBleHRyYUtleXNcbiAgICAgIH0pO1xuICAgICAgaWYoZWxlbVtcImNtQ2hhbmdlXCJdKSBjbS5vbihcImNoYW5nZVwiLCBoYW5kbGVDTUV2ZW50KGVsZW1bXCJjbUNoYW5nZVwiXSwgZWxlbSkpO1xuICAgICAgaWYoZWxlbVtcImNtQmx1clwiXSkgY20ub24oXCJibHVyXCIsIGhhbmRsZUNNRXZlbnQoZWxlbVtcImNtQmx1clwiXSwgZWxlbSkpO1xuICAgICAgaWYoZWxlbVtcImNtRm9jdXNcIl0pIGNtLm9uKFwiZm9jdXNcIiwgaGFuZGxlQ01FdmVudChlbGVtW1wiY21Gb2N1c1wiXSwgZWxlbSkpO1xuICAgICAgaWYoZWxlbS5hdXRvRm9jdXMpIGNtLmZvY3VzKCk7XG4gICAgfVxuXG4gICAgaWYoY20uZ2V0RG9jKCkuZ2V0VmFsdWUoKSAhPT0gZWxlbS52YWx1ZSkge1xuICAgICAgY20uc2V0VmFsdWUoZWxlbS52YWx1ZSB8fCBcIlwiKTtcbiAgICAgIGlmKGVsZW1bXCJjdXJzb3JQb3NpdGlvblwiXSA9PT0gXCJlbmRcIikge1xuICAgICAgICBjbS5zZXRDdXJzb3IoMTAwMDAwKTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYocG9zdFJlbmRlcikgcG9zdFJlbmRlcihub2RlLCBlbGVtKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBnZXRFbnRpdGllc0Zyb21SZXN1bHRzKHJlc3VsdHM6e1tmaWVsZDpzdHJpbmddOiBhbnl9W10sIHtmaWVsZHMgPSBbXCJlbnRpdHlcIl19ID0ge30pOnN0cmluZ1tdIHtcbiAgbGV0IGVudGl0aWVzID0gW107XG4gIGlmKCFyZXN1bHRzLmxlbmd0aCkgcmV0dXJuIGVudGl0aWVzO1xuXG4gIGZvcihsZXQgZmllbGQgb2YgZmllbGRzKSB7XG4gICAgaWYocmVzdWx0c1swXVtmaWVsZF0gPT09IHVuZGVmaW5lZCkgZmllbGQgPSBidWlsdGluSWQoZmllbGQpO1xuICAgIGZvcihsZXQgZmFjdCBvZiByZXN1bHRzKSBlbnRpdGllcy5wdXNoKGZhY3RbZmllbGRdKTtcbiAgfVxuICByZXR1cm4gZW50aXRpZXM7XG59XG5mdW5jdGlvbiBnZXRVUkxzRnJvbVJlc3VsdHMocmVzdWx0czp7W2ZpZWxkOnN0cmluZ106IGFueX1bXSwge2ZpZWxkcyA9IFtcInVybFwiXX0gPSB7fSk6c3RyaW5nW10ge1xuICBsZXQgdXJscyA9IFtdO1xuICBpZighcmVzdWx0cy5sZW5ndGgpIHJldHVybiB1cmxzO1xuXG4gIGZvcihsZXQgZmllbGQgb2YgZmllbGRzKSB7XG4gICAgaWYocmVzdWx0c1swXVtmaWVsZF0gPT09IHVuZGVmaW5lZCkgZmllbGQgPSBidWlsdGluSWQoZmllbGQpO1xuICAgIGZvcihsZXQgZmFjdCBvZiByZXN1bHRzKSB7XG4gICAgICBpZih1cmxSZWdleC5leGVjKGZhY3RbZmllbGRdKSkgdXJscy5wdXNoKGZhY3RbZmllbGRdKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHVybHM7XG59XG5cbmZ1bmN0aW9uIHByZXBhcmVFbnRpdHkocmVzdWx0czp7fVtdLCBwYXJhbXM6e2ZpZWxkPzpzdHJpbmd9KSB7XG4gIGxldCBlbGVtID0ge307XG4gIGxldCBlbnRpdGllcyA9IGdldEVudGl0aWVzRnJvbVJlc3VsdHMocmVzdWx0cywge2ZpZWxkczogcGFyYW1zLmZpZWxkID8gW3BhcmFtcy5maWVsZF0gOiB1bmRlZmluZWR9KTtcbiAgbGV0IGVsZW1zID0gW107XG4gIGZvcihsZXQgZW50aXR5IG9mIGVudGl0aWVzKSB7XG4gICAgbGV0IGVsZW0gPSBjb3B5KHBhcmFtcyk7XG4gICAgZWxlbS5lbnRpdHkgPSBlbnRpdHk7XG4gICAgZWxlbXMucHVzaChlbGVtKTtcbiAgfVxuICBpZihlbGVtcy5sZW5ndGggPT09IDEpIHJldHVybiBlbGVtc1swXTtcbiAgZWxzZSByZXR1cm4gZWxlbXM7XG59XG5mdW5jdGlvbiBwcmVwYXJlVVJMKHJlc3VsdHM6e31bXSwgcGFyYW1zOntmaWVsZD86c3RyaW5nfSkge1xuICBsZXQgZWxlbSA9IHt9O1xuICBsZXQgdXJscyA9IGdldFVSTHNGcm9tUmVzdWx0cyhyZXN1bHRzLCB7ZmllbGRzOiBwYXJhbXMuZmllbGQgPyBbcGFyYW1zLmZpZWxkXSA6IHVuZGVmaW5lZH0pO1xuICBsZXQgZWxlbXMgPSBbXTtcbiAgZm9yKGxldCB1cmwgb2YgdXJscykge1xuICAgIGxldCBlbGVtID0gY29weShwYXJhbXMpO1xuICAgIGVsZW0udXJsID0gdXJsO1xuICAgIGVsZW1zLnB1c2goZWxlbSk7XG4gIH1cbiAgaWYoZWxlbXMubGVuZ3RoID09PSAxKSByZXR1cm4gZWxlbXNbMF07XG4gIGVsc2UgcmV0dXJuIGVsZW1zO1xufVxuXG5sZXQgX3ByZXBhcmU6e1tyZXA6c3RyaW5nXTogKHJlc3VsdHM6e31bXSwgcGFyYW1zOntwYW5lSWQ/OnN0cmluZywgW3A6c3RyaW5nXTogYW55fSkgPT4gYW55fSA9IHtcbiAgbmFtZTogcHJlcGFyZUVudGl0eSxcbiAgbGluazogcHJlcGFyZUVudGl0eSxcbiAgYXR0cmlidXRlczogcHJlcGFyZUVudGl0eSxcbiAgcmVsYXRlZDogcHJlcGFyZUVudGl0eSxcbiAgaW5kZXg6IHByZXBhcmVFbnRpdHksXG4gIHZpZXc6IHByZXBhcmVFbnRpdHksXG4gIHJlc3VsdHM6IHByZXBhcmVFbnRpdHksXG5cbiAgdmFsdWUocmVzdWx0cywgcGFyYW1zOntmaWVsZDpzdHJpbmcsIGRhdGE/Ont9fSkge1xuICAgIGlmKCFwYXJhbXMuZmllbGQpIHRocm93IG5ldyBFcnJvcihcIlZhbHVlIHJlcHJlc2VudGF0aW9uIHJlcXVpcmVzIGEgJ2ZpZWxkJyBwYXJhbSBpbmRpY2F0aW5nIHdoaWNoIGZpZWxkIHRvIHJlcHJlc2VudFwiKTtcbiAgICBsZXQgZmllbGQgPSBwYXJhbXMuZmllbGQ7XG4gICAgaWYoIXJlc3VsdHMubGVuZ3RoKSByZXR1cm4gW107XG5cbiAgICAvLyBJZiBmaWVsZCBpc24ndCBpbiByZXN1bHRzLCB0cnkgdG8gcmVzb2x2ZSBpdCBhcyBhIGZpZWxkIG5hbWUsIG90aGVyd2lzZSBlcnJvciBvdXRcbiAgICBpZihyZXN1bHRzWzBdW2ZpZWxkXSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICBsZXQgbmV1ZUZpZWxkID0gYXNFbnRpdHkoZmllbGQpO1xuICAgICAgaWYoIW5ldWVGaWVsZCkgdGhyb3cgbmV3IEVycm9yKGBVbmFibGUgdG8gdW5pcXVlbHkgcmVzb2x2ZSBmaWVsZCBuYW1lICR7ZmllbGR9IGluIHJlc3VsdCBmaWVsZHMgJHtPYmplY3Qua2V5cyhyZXN1bHRzWzBdKX1gKTtcbiAgICAgIGVsc2UgZmllbGQgPSBuZXVlRmllbGQ7XG4gICAgfVxuXG4gICAgbGV0IGVsZW1zID0gW107XG4gICAgZm9yKGxldCByb3cgb2YgcmVzdWx0cykgZWxlbXMucHVzaCh7dGV4dDogcm93W2ZpZWxkXSwgZGF0YTogcGFyYW1zLmRhdGF9KTtcbiAgICByZXR1cm4gZWxlbXM7XG4gIH0sXG4gIENTVihyZXN1bHRzLCBwYXJhbXM6e2ZpZWxkOnN0cmluZywgZGF0YT86e319KSB7XG4gICAgaWYoIXBhcmFtcy5maWVsZCkgdGhyb3cgbmV3IEVycm9yKFwiVmFsdWUgcmVwcmVzZW50YXRpb24gcmVxdWlyZXMgYSAnZmllbGQnIHBhcmFtIGluZGljYXRpbmcgd2hpY2ggZmllbGQgdG8gcmVwcmVzZW50XCIpO1xuICAgIGxldCBmaWVsZCA9IHBhcmFtcy5maWVsZDtcbiAgICBpZighcmVzdWx0cy5sZW5ndGgpIHJldHVybiBbXTtcblxuICAgIC8vIElmIGZpZWxkIGlzbid0IGluIHJlc3VsdHMsIHRyeSB0byByZXNvbHZlIGl0IGFzIGEgZmllbGQgbmFtZSwgb3RoZXJ3aXNlIGVycm9yIG91dFxuICAgIGlmKHJlc3VsdHNbMF1bZmllbGRdID09PSB1bmRlZmluZWQpIHtcbiAgICAgIGxldCBuZXVlRmllbGQgPSBhc0VudGl0eShmaWVsZCk7XG4gICAgICBpZighbmV1ZUZpZWxkKSB0aHJvdyBuZXcgRXJyb3IoYFVuYWJsZSB0byB1bmlxdWVseSByZXNvbHZlIGZpZWxkIG5hbWUgJHtmaWVsZH0gaW4gcmVzdWx0IGZpZWxkcyAke09iamVjdC5rZXlzKHJlc3VsdHNbMF0pfWApO1xuICAgICAgZWxzZSBmaWVsZCA9IG5ldWVGaWVsZDtcbiAgICB9XG5cbiAgICBsZXQgdmFsdWVzID0gW107XG4gICAgZm9yKGxldCByb3cgb2YgcmVzdWx0cykge1xuICAgICAgdmFsdWVzLnB1c2gocm93W2ZpZWxkXSk7XG4gICAgfVxuICAgIHJldHVybiB7dmFsdWVzLCBkYXRhOiBwYXJhbXMuZGF0YX07XG4gIH0sXG4gIHJlc3VsdChyZXN1bHRzLCBwYXJhbXMpIHtcbiAgICBsZXQgZWxlbSA9IF9wcmVwYXJlW1wiQ1NWXCJdKHJlc3VsdHMsIHBhcmFtcyk7XG4gICAgZWxlbS5zZWFyY2ggPSBwYXJhbXNbXCJzZWFyY2hcIl07XG4gICAgcmV0dXJuIGVsZW07XG4gIH0sXG4gIGVudGl0eShyZXN1bHRzLCBwYXJhbXMpIHtcbiAgICBsZXQgZW50aXRpZXMgPSBbXTtcbiAgICBsZXQgZmlyc3RSZXN1bHQgPSByZXN1bHRzWzBdO1xuICAgIGxldCBmaWVsZHMgPSBPYmplY3Qua2V5cyhmaXJzdFJlc3VsdCkuZmlsdGVyKChmaWVsZCkgPT4ge1xuICAgICAgcmV0dXJuICEhYXNFbnRpdHkoZmlyc3RSZXN1bHRbZmllbGRdKTtcbiAgICB9KTtcbiAgICBmb3IobGV0IHJlc3VsdCBvZiByZXN1bHRzKSB7XG4gICAgICBmb3IobGV0IGZpZWxkIG9mIGZpZWxkcykge1xuICAgICAgICB2YXIgZW50aXR5SWQgPSByZXN1bHRbZmllbGRdO1xuICAgICAgICB2YXIgcGFuZUlkID0gcGFyYW1zW1wicGFuZUlkXCJdO1xuICAgICAgICB2YXIgZWRpdG9yID0gcHJlcGFyZUNhcmRFZGl0b3IoZW50aXR5SWQsIHBhbmVJZCk7XG4gICAgICAgIGVudGl0aWVzLnB1c2goe2VudGl0eTogcmVzdWx0W2ZpZWxkXSwgZGF0YTogcGFyYW1zLCBlZGl0b3J9KTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGVudGl0aWVzO1xuICB9LFxuICBlcnJvcihyZXN1bHRzLCBwYXJhbXMpIHtcbiAgICByZXR1cm4ge3RleHQ6IHBhcmFtc1tcIm1lc3NhZ2VcIl19O1xuICB9LFxuICBtYXBwZWRUYWJsZShyZXN1bHRzLCBwYXJhbXM6e3BhbmVJZD86IHN0cmluZywgZGF0YT86IHtwYW5lSWQ/OiBzdHJpbmd9LCBzZWFyY2g6IHN0cmluZywgZW50aXR5PzpzdHJpbmcsIHN1YmplY3Q6IHN0cmluZywgZ3JvdXBzPzpzdHJpbmdbXSwgZmllbGRNYXB9KSB7XG4gICAgbGV0IHBhbmVJZCA9IHBhcmFtcy5wYW5lSWQgfHwgcGFyYW1zLmRhdGEgJiYgcGFyYW1zLmRhdGEucGFuZUlkO1xuICAgIGxldCBrZXkgPSBgJHtwYW5lSWR9fCR7cGFyYW1zLnNlYXJjaH1gO1xuICAgIGxldCBzdGF0ZSA9ICB1aVN0YXRlLndpZGdldC50YWJsZVtrZXldO1xuICAgIGlmKCFzdGF0ZSkge1xuICAgICAgc3RhdGUgPSB1aVN0YXRlLndpZGdldC50YWJsZVtrZXldID0ge3NvcnRGaWVsZDogdW5kZWZpbmVkLCBzb3J0RGlyZWN0aW9uOiAxLCBhZGRlcnM6IFt7fV0sIGNoYW5nZXM6IFtdfTtcbiAgICB9XG4gICAgcGFyYW1zW1wic29ydGFibGVcIl0gPSB0cnVlO1xuICAgIHBhcmFtc1tcInJvd3NcIl0gPSByZXN1bHRzO1xuICAgIHBhcmFtc1tcInN0YXRlXCJdID0gc3RhdGU7XG4gICAgcmV0dXJuIHBhcmFtcztcbiAgfSxcbiAgdGFibGUocmVzdWx0cywgcGFyYW1zOntwYW5lSWQ/OiBzdHJpbmcsIGRhdGE/OiB7cGFuZUlkPzogc3RyaW5nfSwgc2VhcmNoOiBzdHJpbmd9KSB7XG4gICAgbGV0IHBhbmVJZCA9IHBhcmFtcy5wYW5lSWQgfHwgcGFyYW1zLmRhdGEgJiYgcGFyYW1zLmRhdGEucGFuZUlkO1xuICAgIGxldCBrZXkgPSBgJHtwYW5lSWR9fCR7cGFyYW1zLnNlYXJjaH1gO1xuICAgIGxldCBzdGF0ZSA9ICB1aVN0YXRlLndpZGdldC50YWJsZVtrZXldO1xuICAgIGlmKCFzdGF0ZSkge1xuICAgICAgc3RhdGUgPSB1aVN0YXRlLndpZGdldC50YWJsZVtrZXldID0ge3NvcnRGaWVsZDogdW5kZWZpbmVkLCBzb3J0RGlyZWN0aW9uOiAxfTtcbiAgICB9XG4gICAgcGFyYW1zW1wicm93c1wiXSA9IHJlc3VsdHM7XG4gICAgcGFyYW1zW1wic3RhdGVcIl0gPSBzdGF0ZTtcbiAgICByZXR1cm4gcGFyYW1zO1xuICAgIC8vcmV0dXJuIHtyb3dzOiByZXN1bHRzLCBmaWVsZHMsIHN0YXRlLCBncm91cHM6IGdyb3VwaW5ncywgc29ydGFibGU6IHRydWUsIGRhdGE6IHBhcmFtcy5kYXRhfTtcbiAgfSxcbiAgZGlyZWN0b3J5KHJlc3VsdHMsIHBhcmFtczp7ZGF0YT86e30sIGZpZWxkPzpzdHJpbmd9KSB7XG4gICAgLy9sZXQgZW50aXRpZXMgPSBnZXRFbnRpdGllc0Zyb21SZXN1bHRzKHJlc3VsdHMsIHtmaWVsZHM6IHBhcmFtcy5maWVsZCA/IFtwYXJhbXMuZmllbGRdIDogdW5kZWZpbmVkfSk7XG4gICAgbGV0IGVudGl0aWVzID0gW2J1aWx0aW5JZChcImVudGl0eVwiKV07XG4gICAgaWYoZW50aXRpZXMubGVuZ3RoID09PSAxKSB7XG4gICAgICBsZXQgY29sbGVjdGlvbiA9IGVudGl0aWVzWzBdO1xuICAgICAgZW50aXRpZXMubGVuZ3RoID0gMDtcbiAgICAgIGZvciAobGV0IGZhY3Qgb2YgZXZlLmZpbmQoXCJpcyBhIGF0dHJpYnV0ZXNcIiwge2NvbGxlY3Rpb259KSkgZW50aXRpZXMucHVzaChmYWN0LmVudGl0eSk7XG4gICAgfVxuICAgIHJldHVybiB7ZW50aXRpZXMsIGRhdGE6IHBhcmFtcy5kYXRhfTtcbiAgfSxcbiAgZXh0ZXJuYWxMaW5rOiBwcmVwYXJlVVJMLFxuICBleHRlcm5hbEltYWdlOiBwcmVwYXJlVVJMLFxuICBleHRlcm5hbFZpZGVvOiBwcmVwYXJlVVJMLFxuICBcbiAgZW1iZWRkZWRDZWxsKHJlc3VsdHMsIHBhcmFtcykge1xuICAgIGxldCByZXAgPSBwYXJhbXNbXCJjaGlsZFJlcFwiXTtcbiAgICBsZXQgY2hpbGRJbmZvO1xuICAgIGlmKF9wcmVwYXJlW3JlcF0pIHtcbiAgICAgIHBhcmFtc1tcImRhdGFcIl0gPSBwYXJhbXNbXCJkYXRhXCJdIHx8IHBhcmFtcztcbiAgICAgIGNoaWxkSW5mbyA9IF9wcmVwYXJlW3JlcF0ocmVzdWx0cywgcGFyYW1zKTtcbiAgICAgIGNoaWxkSW5mby5kYXRhID0gY2hpbGRJbmZvLmRhdGEgfHwgcGFyYW1zO1xuICAgIH0gZWxzZSB7XG4gICAgICBjaGlsZEluZm8gPSB7ZGF0YTogcGFyYW1zfTtcbiAgICB9XG4gICAgcmV0dXJuIHtjaGlsZEluZm8sIHJlcCwgY2xpY2s6IGFjdGl2YXRlQ2VsbCwgY2VsbDogcGFyYW1zW1wiY2VsbFwiXX07XG4gIH0sXG59O1xuXG5mdW5jdGlvbiByZXByZXNlbnQoc2VhcmNoOiBzdHJpbmcsIHJlcDpzdHJpbmcsIHJlc3VsdHMsIHBhcmFtczp7fSwgd3JhcEVhY2g/OihlbGVtOkVsZW1lbnQsIGl4PzpudW1iZXIpID0+IEVsZW1lbnQpOkVsZW1lbnQge1xuICBpZihyZXAgaW4gX3ByZXBhcmUpIHtcbiAgICBsZXQgZW1iZWRQYXJhbVNldHMgPSBfcHJlcGFyZVtyZXBdKHJlc3VsdHMgJiYgcmVzdWx0cy5yZXN1bHRzLCA8YW55PnBhcmFtcyk7XG4gICAgbGV0IGlzQXJyYXkgPSBlbWJlZFBhcmFtU2V0cyAmJiBlbWJlZFBhcmFtU2V0cy5jb25zdHJ1Y3RvciA9PT0gQXJyYXk7XG4gICAgdHJ5IHtcbiAgICAgIGlmKCFlbWJlZFBhcmFtU2V0cyB8fCBpc0FycmF5ICYmIGVtYmVkUGFyYW1TZXRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm4gdWl0ay5lcnJvcih7dGV4dDogYCR7c2VhcmNofSBhcyAke3JlcH1gfSlcbiAgICAgIH0gZWxzZSBpZihlbWJlZFBhcmFtU2V0cy5jb25zdHJ1Y3RvciA9PT0gQXJyYXkpIHtcbiAgICAgICAgbGV0IHdyYXBwZXIgPSB7YzogXCJmbGV4LWNvbHVtblwiLCBjaGlsZHJlbjogW119O1xuICAgICAgICBsZXQgaXggPSAwO1xuICAgICAgICBmb3IobGV0IGVtYmVkUGFyYW1zIG9mIGVtYmVkUGFyYW1TZXRzKSB7XG4gICAgICAgICAgZW1iZWRQYXJhbXNbXCJkYXRhXCJdID0gZW1iZWRQYXJhbXNbXCJkYXRhXCJdIHx8IHBhcmFtcztcbiAgICAgICAgICBpZih3cmFwRWFjaCkgd3JhcHBlci5jaGlsZHJlbi5wdXNoKHdyYXBFYWNoKHVpdGtbcmVwXShlbWJlZFBhcmFtcyksIGl4KyspKTtcbiAgICAgICAgICBlbHNlIHdyYXBwZXIuY2hpbGRyZW4ucHVzaCh1aXRrW3JlcF0oZW1iZWRQYXJhbXMpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gd3JhcHBlcjtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGxldCBlbWJlZFBhcmFtcyA9IGVtYmVkUGFyYW1TZXRzO1xuICAgICAgICBlbWJlZFBhcmFtc1tcImRhdGFcIl0gPSBlbWJlZFBhcmFtc1tcImRhdGFcIl0gfHwgcGFyYW1zO1xuICAgICAgICBpZih3cmFwRWFjaCkgcmV0dXJuIHtjOiBcImZsZXgtY29sdW1uXCIsIGNoaWxkcmVuOiBbd3JhcEVhY2godWl0a1tyZXBdKGVtYmVkUGFyYW1zKSldfTtcbiAgICAgICAgZWxzZSByZXR1cm4ge2M6IFwiZmxleC1jb2x1bW5cIiwgY2hpbGRyZW46IFt1aXRrW3JlcF0oZW1iZWRQYXJhbXMpXX07XG4gICAgICB9XG4gICAgfSBjYXRjaChlcnIpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJSRVBSRVNFTlRBVElPTiBFUlJPUlwiKTtcbiAgICAgIGNvbnNvbGUuZXJyb3Ioe3NlYXJjaCwgcmVwLCByZXN1bHRzLCBwYXJhbXN9KTtcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgICAgIHJldHVybiB1aXRrLmVycm9yKHt0ZXh0OiBgRmFpbGVkIHRvIGVtYmVkIGFzICR7cGFyYW1zW1wiY2hpbGRSZXBcIl0gfHwgcmVwfWB9KVxuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBjb25zb2xlLmVycm9yKFwiUkVQUkVTRU5UQVRJT04gRVJST1JcIik7XG4gICAgY29uc29sZS5lcnJvcih7c2VhcmNoLCByZXAsIHJlc3VsdHMsIHBhcmFtc30pO1xuICAgIHJldHVybiB1aXRrLmVycm9yKHt0ZXh0OiBgVW5rbm93biByZXByZXNlbnRhdGlvbiAke3BhcmFtc1tcImNoaWxkUmVwXCJdIHx8IHJlcH1gfSk7XG4gIH1cbn1cblxudmFyIGhpc3RvcnlTdGF0ZSA9IHdpbmRvdy5oaXN0b3J5LnN0YXRlO1xudmFyIGhpc3RvcnlVUkwgPSBnZXRMb2NhdGlvbigpO1xud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJwb3BzdGF0ZVwiLCBmdW5jdGlvbihldnQpIHtcbiAgbGV0IHBvcG91dCA9IGV2ZS5maW5kT25lKFwidWkgcGFuZVwiLCB7a2luZDogUEFORS5QT1BPVVR9KTtcbiAgaWYocG9wb3V0ICYmIHBvcG91dEhpc3RvcnkubGVuZ3RoKSB7XG4gICAgd2luZG93Lmhpc3RvcnkucHVzaFN0YXRlKGhpc3RvcnlTdGF0ZSwgbnVsbCwgaGlzdG9yeVVSTCk7XG4gICAgbGV0IHtyZXAsIGNvbnRhaW5zLCBwYXJhbXMsIHgsIHl9ID0gcG9wb3V0SGlzdG9yeS5wb3AoKTtcbiAgICBkaXNwYXRjaChcInNldCBwb3BvdXRcIiwge3BhcmVudElkOiBcInAxXCIsIHJlcCwgY29udGFpbnMsIHBhcmFtcywgeCwgeSwgcG9wU3RhdGU6IHRydWV9KS5jb21taXQoKTsgLy8gQFRPRE86IG1ha2UgXCJwMVwiIGEgY29uc3RhbnRcbiAgICByZXR1cm47XG4gIH0gZWxzZSBpZihldnQuc3RhdGUgJiYgZXZ0LnN0YXRlLnJvb3QpIHtcbiAgICB3aW5kb3cuaGlzdG9yeS5iYWNrKCk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgaGlzdG9yeVN0YXRlID0gZXZ0LnN0YXRlO1xuICBoaXN0b3J5VVJMID0gZ2V0TG9jYXRpb24oKTtcblxuICBsZXQge3BhbmVJZCA9IHVuZGVmaW5lZCwgY29udGFpbnMgPSB1bmRlZmluZWR9ID0gZXZ0LnN0YXRlIHx8IHt9O1xuICBpZihwYW5lSWQgPT09IHVuZGVmaW5lZCB8fCBjb250YWlucyA9PT0gdW5kZWZpbmVkKSByZXR1cm47XG4gIGRpc3BhdGNoKFwic2V0IHBhbmVcIiwge3BhbmVJZCwgY29udGFpbnMsIHBvcFN0YXRlOiB0cnVlfSkuY29tbWl0KCk7XG59KTtcblxuLy8gUHJldmVudCBiYWNrc3BhY2UgZnJvbSBnb2luZyBiYWNrXG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgKGV2ZW50KSA9PiB7XG4gIHZhciBjdXJyZW50ID0gPEhUTUxFbGVtZW50PmV2ZW50LnRhcmdldDtcbiAgaWYoZXZlbnQua2V5Q29kZSA9PT0gS0VZUy5CQUNLU1BBQ0UgJiYgY3VycmVudC5ub2RlTmFtZSAhPT0gXCJJTlBVVFwiICYmIGN1cnJlbnQubm9kZU5hbWUgIT09IFwiVEVYVEFSRUFcIiAmJiBjdXJyZW50LmNvbnRlbnRFZGl0YWJsZSAhPT0gXCJ0cnVlXCIpIHtcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICB9XG59KVxuXG4vLyBATk9URTogVW5jb21tZW50IHRoaXMgdG8gZW5hYmxlIHRoZSBuZXcgVUksIG9yIHR5cGUgYHdpbmRvd1tcIk5FVUVfVUlcIl0gPSB0cnVlOyBhcHAucmVuZGVyKClgIGludG8gdGhlIGNvbnNvbGUgdG8gZW5hYmxlIGl0IHRyYW5zaWVudGx5Llxud2luZG93W1wiTkVVRV9VSVwiXSA9IHRydWU7XG4iLCJpbXBvcnQge3VucGFkLCByZXBlYXQsIERFQlVHLCB1dWlkfSBmcm9tIFwiLi91dGlsc1wiO1xuaW1wb3J0IHtFbGVtZW50LCBIYW5kbGVyfSBmcm9tIFwiLi9taWNyb1JlYWN0XCI7XG5pbXBvcnQge0luZGV4ZXIsIFF1ZXJ5fSBmcm9tIFwiLi9ydW50aW1lXCI7XG5cbmZ1bmN0aW9uIHJlc29sdmUodGFibGUsIGZhY3QpIHtcbiAgbGV0IG5ldWUgPSB7fTtcbiAgZm9yKGxldCBmaWVsZCBpbiBmYWN0KVxuICAgIG5ldWVbYCR7dGFibGV9OiAke2ZpZWxkfWBdID0gZmFjdFtmaWVsZF07XG4gIHJldHVybiBuZXVlO1xufVxuZnVuY3Rpb24gaHVtYW5pemUodGFibGUsIGZhY3QpIHtcbiAgbGV0IG5ldWUgPSB7fTtcbiAgZm9yKGxldCBmaWVsZCBpbiBmYWN0KVxuICAgIG5ldWVbZmllbGQuc2xpY2UodGFibGUubGVuZ3RoICsgMildID0gZmFjdFtmaWVsZF07XG4gIHJldHVybiBuZXVlO1xufVxuXG5mdW5jdGlvbiByZXNvbHZlZEFkZChjaGFuZ2VzZXQsIHRhYmxlLCBmYWN0KSB7XG4gIHJldHVybiBjaGFuZ2VzZXQuYWRkKHRhYmxlLCByZXNvbHZlKHRhYmxlLCBmYWN0KSk7XG59XG5mdW5jdGlvbiByZXNvbHZlZFJlbW92ZShjaGFuZ2VzZXQsIHRhYmxlLCBmYWN0KSB7XG4gIHJldHVybiBjaGFuZ2VzZXQucmVtb3ZlKHRhYmxlLCByZXNvbHZlKHRhYmxlLCBmYWN0KSk7XG59XG5mdW5jdGlvbiBodW1hbml6ZWRGaW5kKGl4ZXI6SW5kZXhlciwgdGFibGUsIHF1ZXJ5KSB7XG4gIGxldCByZXN1bHRzID0gW107XG4gIGZvcihsZXQgZmFjdCBvZiBpeGVyLmZpbmQodGFibGUsIHJlc29sdmUodGFibGUsIHF1ZXJ5KSkpIHJlc3VsdHMucHVzaChodW1hbml6ZSh0YWJsZSwgZmFjdCkpO1xuICBsZXQgZGlhZyA9IHt9O1xuICBmb3IobGV0IHRhYmxlIGluIGl4ZXIudGFibGVzKSBkaWFnW3RhYmxlXSA9IGl4ZXIudGFibGVzW3RhYmxlXS50YWJsZS5sZW5ndGg7XG4gIHJldHVybiByZXN1bHRzO1xufVxuXG5leHBvcnQgY2xhc3MgVUkge1xuICBwcm90ZWN0ZWQgX2JpbmRpbmc6UXVlcnk7XG4gIHByb3RlY3RlZCBfZW1iZWRkZWQ6e307XG4gIHByb3RlY3RlZCBfY2hpbGRyZW46VUlbXSA9IFtdO1xuICBwcm90ZWN0ZWQgX2F0dHJpYnV0ZXM6e30gPSB7fTtcbiAgcHJvdGVjdGVkIF9ldmVudHM6e30gPSB7fTtcblxuICBwcm90ZWN0ZWQgX3BhcmVudDpVSTtcblxuICBzdGF0aWMgcmVtb3ZlKHRlbXBsYXRlOnN0cmluZywgaXhlcjpJbmRleGVyKSB7XG4gICAgbGV0IGNoYW5nZXNldCA9IGl4ZXIuZGlmZigpO1xuICAgIHJlc29sdmVkUmVtb3ZlKGNoYW5nZXNldCwgXCJ1aSB0ZW1wbGF0ZVwiLCB7dGVtcGxhdGV9KTtcbiAgICByZXNvbHZlZFJlbW92ZShjaGFuZ2VzZXQsIFwidWkgdGVtcGxhdGUgYmluZGluZ1wiLCB7dGVtcGxhdGV9KTtcbiAgICBsZXQgYmluZGluZ3MgPSBodW1hbml6ZWRGaW5kKGl4ZXIsIFwidWkgdGVtcGxhdGUgYmluZGluZ1wiLCB7dGVtcGxhdGV9KTtcbiAgICBmb3IobGV0IGJpbmRpbmcgb2YgYmluZGluZ3MpIGNoYW5nZXNldC5tZXJnZShRdWVyeS5yZW1vdmUoYmluZGluZy5iaW5kaW5nLCBpeGVyKSk7XG4gICAgcmVzb2x2ZWRSZW1vdmUoY2hhbmdlc2V0LCBcInVpIGVtYmVkXCIsIHt0ZW1wbGF0ZX0pO1xuICAgIGxldCBlbWJlZHMgPSBodW1hbml6ZWRGaW5kKGl4ZXIsIFwidWkgZW1iZWRcIiwge3RlbXBsYXRlfSk7XG4gICAgZm9yKGxldCBlbWJlZCBvZiBlbWJlZHMpIHtcbiAgICAgIHJlc29sdmVkUmVtb3ZlKGNoYW5nZXNldCwgXCJ1aSBlbWJlZCBzY29wZVwiLCB7dGVtcGxhdGUsIGVtYmVkOiBlbWJlZC5lbWJlZH0pO1xuICAgICAgcmVzb2x2ZWRSZW1vdmUoY2hhbmdlc2V0LCBcInVpIGVtYmVkIHNjb3BlIGJpbmRpbmdcIiwge3RlbXBsYXRlLCBlbWJlZDogZW1iZWQuZW1iZWR9KTtcbiAgICB9XG4gICAgcmVzb2x2ZWRSZW1vdmUoY2hhbmdlc2V0LCBcInVpIGF0dHJpYnV0ZVwiLCB7dGVtcGxhdGV9KTtcbiAgICByZXNvbHZlZFJlbW92ZShjaGFuZ2VzZXQsIFwidWkgYXR0cmlidXRlIGJpbmRpbmdcIiwge3RlbXBsYXRlfSk7XG4gICAgcmVzb2x2ZWRSZW1vdmUoY2hhbmdlc2V0LCBcInVpIGV2ZW50XCIsIHt0ZW1wbGF0ZX0pO1xuICAgIGxldCBldmVudHMgPSBodW1hbml6ZWRGaW5kKGl4ZXIsIFwidWkgZXZlbnRcIiwge3RlbXBsYXRlfSk7XG4gICAgZm9yKGxldCBldmVudCBvZiBldmVudHMpIHtcbiAgICAgIHJlc29sdmVkUmVtb3ZlKGNoYW5nZXNldCwgXCJ1aSBldmVudCBzdGF0ZVwiLCB7dGVtcGxhdGUsIGV2ZW50OiBldmVudC5ldmVudH0pO1xuICAgICAgcmVzb2x2ZWRSZW1vdmUoY2hhbmdlc2V0LCBcInVpIGV2ZW50IHN0YXRlIGJpbmRpbmdcIiwge3RlbXBsYXRlLCBldmVudDogZXZlbnQuZXZlbnR9KTtcbiAgICB9XG5cbiAgICBmb3IobGV0IGNoaWxkIG9mIGh1bWFuaXplZEZpbmQoaXhlciwgXCJ1aSB0ZW1wbGF0ZVwiLCB7cGFyZW50OiB0ZW1wbGF0ZX0pKSBjaGFuZ2VzZXQubWVyZ2UoVUkucmVtb3ZlKGNoaWxkLnRlbXBsYXRlLCBpeGVyKSk7XG4gICAgcmV0dXJuIGNoYW5nZXNldDtcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKHB1YmxpYyBpZCkge1xuXG4gIH1cbiAgY29weSgpIHtcbiAgICBsZXQgbmV1ZSA9IG5ldyBVSSh0aGlzLmlkKTtcbiAgICBuZXVlLl9iaW5kaW5nID0gdGhpcy5fYmluZGluZztcbiAgICBuZXVlLl9lbWJlZGRlZCA9IHRoaXMuX2VtYmVkZGVkO1xuICAgIG5ldWUuX2NoaWxkcmVuID0gdGhpcy5fY2hpbGRyZW47XG4gICAgbmV1ZS5fYXR0cmlidXRlcyA9IHRoaXMuX2F0dHJpYnV0ZXM7XG4gICAgbmV1ZS5fZXZlbnRzID0gdGhpcy5fZXZlbnRzO1xuICAgIG5ldWUuX3BhcmVudCA9IHRoaXMuX3BhcmVudDtcbiAgICByZXR1cm4gbmV1ZTtcbiAgfVxuICBjaGFuZ2VzZXQoaXhlcjpJbmRleGVyKSB7XG4gICAgbGV0IGNoYW5nZXNldCA9IGl4ZXIuZGlmZigpO1xuXG4gICAgbGV0IHBhcmVudCA9IHRoaXMuX2F0dHJpYnV0ZXNbXCJwYXJlbnRcIl0gfHwgKHRoaXMuX3BhcmVudCAmJiB0aGlzLl9wYXJlbnQuaWQpIHx8IFwiXCI7XG4gICAgbGV0IGl4ID0gdGhpcy5fYXR0cmlidXRlc1tcIml4XCJdO1xuICAgIGlmKGl4ID09PSB1bmRlZmluZWQpIGl4ID0gKHRoaXMuX3BhcmVudCAmJiB0aGlzLl9wYXJlbnQuX2NoaWxkcmVuLmluZGV4T2YodGhpcykpO1xuICAgIGlmKGl4ID09PSAtMSB8fCBpeCA9PT0gdW5kZWZpbmVkKSBpeCA9IFwiXCI7XG4gICAgaWYodGhpcy5fZW1iZWRkZWQpIHBhcmVudCA9IFwiXCI7XG5cbiAgICByZXNvbHZlZEFkZChjaGFuZ2VzZXQsIFwidWkgdGVtcGxhdGVcIiwge3RlbXBsYXRlOiB0aGlzLmlkLCBwYXJlbnQsIGl4fSk7XG4gICAgaWYodGhpcy5fYmluZGluZykge1xuICAgICAgaWYoIXRoaXMuX2JpbmRpbmcubmFtZSB8fCB0aGlzLl9iaW5kaW5nLm5hbWUgPT09IFwidW5rbm93blwiKSB0aGlzLl9iaW5kaW5nLm5hbWUgPSBgYm91bmQgdmlldyAke3RoaXMuaWR9YDtcbiAgICAgIGNoYW5nZXNldC5tZXJnZSh0aGlzLl9iaW5kaW5nLmNoYW5nZXNldChpeGVyKSk7XG4gICAgICByZXNvbHZlZEFkZChjaGFuZ2VzZXQsIFwidWkgdGVtcGxhdGUgYmluZGluZ1wiLCB7dGVtcGxhdGU6IHRoaXMuaWQsIGJpbmRpbmc6IHRoaXMuX2JpbmRpbmcubmFtZX0pO1xuICAgIH1cbiAgICBpZih0aGlzLl9lbWJlZGRlZCkge1xuICAgICAgbGV0IGVtYmVkID0gdXVpZCgpO1xuICAgICAgcmVzb2x2ZWRBZGQoY2hhbmdlc2V0LCBcInVpIGVtYmVkXCIsIHtlbWJlZCwgdGVtcGxhdGU6IHRoaXMuaWQsIHBhcmVudDogKHRoaXMuX3BhcmVudCB8fCA8YW55Pnt9KS5pZCwgaXh9KTtcbiAgICAgIGZvcihsZXQga2V5IGluIHRoaXMuX2VtYmVkZGVkKSB7XG4gICAgICAgIGxldCB2YWx1ZSA9IHRoaXMuX2F0dHJpYnV0ZXNba2V5XTtcbiAgICAgICAgaWYodmFsdWUgaW5zdGFuY2VvZiBBcnJheSkgcmVzb2x2ZWRBZGQoY2hhbmdlc2V0LCBcInVpIGVtYmVkIHNjb3BlIGJpbmRpbmdcIiwge2VtYmVkLCBrZXksIHNvdXJjZTogdmFsdWVbMF0sIGFsaWFzOiB2YWx1ZVsxXX0pO1xuICAgICAgICBlbHNlIHJlc29sdmVkQWRkKGNoYW5nZXNldCwgXCJ1aSBlbWJlZCBzY29wZVwiLCB7ZW1iZWQsIGtleSwgdmFsdWV9KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBmb3IobGV0IHByb3BlcnR5IGluIHRoaXMuX2F0dHJpYnV0ZXMpIHtcbiAgICAgIGxldCB2YWx1ZSA9IHRoaXMuX2F0dHJpYnV0ZXNbcHJvcGVydHldO1xuICAgICAgaWYodmFsdWUgaW5zdGFuY2VvZiBBcnJheSkgcmVzb2x2ZWRBZGQoY2hhbmdlc2V0LCBcInVpIGF0dHJpYnV0ZSBiaW5kaW5nXCIsIHt0ZW1wbGF0ZTogdGhpcy5pZCwgcHJvcGVydHksIHNvdXJjZTogdmFsdWVbMF0sIGFsaWFzOiB2YWx1ZVsxXX0pO1xuICAgICAgZWxzZSByZXNvbHZlZEFkZChjaGFuZ2VzZXQsIFwidWkgYXR0cmlidXRlXCIsIHt0ZW1wbGF0ZTogdGhpcy5pZCwgcHJvcGVydHksIHZhbHVlfSk7XG4gICAgfVxuXG4gICAgZm9yKGxldCBldmVudCBpbiB0aGlzLl9ldmVudHMpIHtcbiAgICAgIHJlc29sdmVkQWRkKGNoYW5nZXNldCwgXCJ1aSBldmVudFwiLCB7dGVtcGxhdGU6IHRoaXMuaWQsIGV2ZW50fSk7XG4gICAgICBsZXQgc3RhdGUgPSB0aGlzLl9ldmVudHNbZXZlbnRdO1xuICAgICAgZm9yKGxldCBrZXkgaW4gc3RhdGUpIHtcbiAgICAgICAgbGV0IHZhbHVlID0gc3RhdGVba2V5XTtcbiAgICAgICAgaWYodmFsdWUgaW5zdGFuY2VvZiBBcnJheSlcbiAgICAgICAgICByZXNvbHZlZEFkZChjaGFuZ2VzZXQsIFwidWkgZXZlbnQgc3RhdGUgYmluZGluZ1wiLCB7dGVtcGxhdGU6IHRoaXMuaWQsIGV2ZW50LCBrZXksIHNvdXJjZTogdmFsdWVbMF0sIGFsaWFzOiB2YWx1ZVsxXX0pO1xuICAgICAgICBlbHNlIHJlc29sdmVkQWRkKGNoYW5nZXNldCwgXCJ1aSBldmVudCBzdGF0ZVwiLCB7dGVtcGxhdGU6IHRoaXMuaWQsIGV2ZW50LCBrZXksIHZhbHVlfSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgZm9yKGxldCBjaGlsZCBvZiB0aGlzLl9jaGlsZHJlbikgY2hhbmdlc2V0Lm1lcmdlKGNoaWxkLmNoYW5nZXNldChpeGVyKSk7XG5cbiAgICByZXR1cm4gY2hhbmdlc2V0O1xuICB9XG4gIGxvYWQodGVtcGxhdGU6c3RyaW5nLCBpeGVyOkluZGV4ZXIsIHBhcmVudD86VUkpIHtcbiAgICBsZXQgZmFjdCA9IGh1bWFuaXplZEZpbmQoaXhlciwgXCJ1aSB0ZW1wbGF0ZVwiLCB7dGVtcGxhdGV9KVswXTtcbiAgICBpZighZmFjdCkgcmV0dXJuIHRoaXM7XG4gICAgaWYocGFyZW50IHx8IGZhY3QucGFyZW50KSB0aGlzLl9wYXJlbnQgPSBwYXJlbnQgfHwgbmV3IFVJKHRoaXMuX3BhcmVudCk7XG4gICAgbGV0IGJpbmRpbmcgPSBodW1hbml6ZWRGaW5kKGl4ZXIsIFwidWkgdGVtcGxhdGUgYmluZGluZ1wiLCB7dGVtcGxhdGV9KVswXTtcbiAgICBpZihiaW5kaW5nKSB0aGlzLmJpbmQoKG5ldyBRdWVyeShpeGVyLCBiaW5kaW5nLmJpbmRpbmcpKSk7XG4gICAgbGV0IGVtYmVkID0gaHVtYW5pemVkRmluZChpeGVyLCBcInVpIGVtYmVkXCIsIHt0ZW1wbGF0ZSwgcGFyZW50OiB0aGlzLl9wYXJlbnQgPyB0aGlzLl9wYXJlbnQuaWQgOiBcIlwifSlbMF07XG4gICAgaWYoZW1iZWQpIHtcbiAgICAgIGxldCBzY29wZSA9IHt9O1xuICAgICAgZm9yKGxldCBhdHRyIG9mIGh1bWFuaXplZEZpbmQoaXhlciwgXCJ1aSBlbWJlZCBzY29wZVwiLCB7ZW1iZWQ6IGVtYmVkLmVtYmVkfSkpIHNjb3BlW2F0dHIua2V5XSA9IGF0dHIudmFsdWU7XG4gICAgICBmb3IobGV0IGF0dHIgb2YgaHVtYW5pemVkRmluZChpeGVyLCBcInVpIGVtYmVkIHNjb3BlIGJpbmRpbmdcIiwge2VtYmVkOiBlbWJlZC5lbWJlZH0pKSBzY29wZVthdHRyLmtleV0gPSBbYXR0ci5zb3VyY2UsIGF0dHIuYWxpYXNdO1xuICAgICAgdGhpcy5lbWJlZChzY29wZSk7XG4gICAgfVxuXG4gICAgZm9yKGxldCBhdHRyIG9mIGh1bWFuaXplZEZpbmQoaXhlciwgXCJ1aSBhdHRyaWJ1dGVcIiwge3RlbXBsYXRlfSkpIHRoaXMuYXR0cmlidXRlKGF0dHIucHJvcGVydHksIGF0dHIudmFsdWUpO1xuICAgIGZvcihsZXQgYXR0ciBvZiBodW1hbml6ZWRGaW5kKGl4ZXIsIFwidWkgYXR0cmlidXRlIGJpbmRpbmdcIiwge3RlbXBsYXRlfSkpIHRoaXMuYXR0cmlidXRlKGF0dHIucHJvcGVydHksIFthdHRyLnNvdXJjZSwgYXR0ci5hbGlhc10pO1xuXG4gICAgZm9yKGxldCBldmVudCBvZiBodW1hbml6ZWRGaW5kKGl4ZXIsIFwidWkgZXZlbnRcIiwge3RlbXBsYXRlfSkpIHtcbiAgICAgIGxldCBzdGF0ZSA9IHt9O1xuICAgICAgZm9yKGxldCBhdHRyIG9mIGh1bWFuaXplZEZpbmQoaXhlciwgXCJ1aSBldmVudCBzdGF0ZVwiLCB7dGVtcGxhdGUsIGV2ZW50OiBldmVudC5ldmVudH0pKSBzdGF0ZVtldmVudC5rZXldID0gZXZlbnQudmFsdWU7XG4gICAgICBmb3IobGV0IGF0dHIgb2YgaHVtYW5pemVkRmluZChpeGVyLCBcInVpIGV2ZW50IHN0YXRlIGJpbmRpbmdcIiwge3RlbXBsYXRlLCBldmVudDogZXZlbnQuZXZlbnR9KSkgc3RhdGVbZXZlbnQua2V5XSA9IFtldmVudC5zb3VyY2UsIGV2ZW50LmFsaWFzXVxuICAgICAgdGhpcy5ldmVudChldmVudC5ldmVudCwgc3RhdGUpO1xuICAgIH1cblxuICAgIGZvcihsZXQgY2hpbGQgb2YgaHVtYW5pemVkRmluZChpeGVyLCBcInVpIHRlbXBsYXRlXCIsIHtwYXJlbnQ6IHRlbXBsYXRlfSkpXG4gICAgICB0aGlzLmNoaWxkKChuZXcgVUkoY2hpbGQudGVtcGxhdGUpKS5sb2FkKGNoaWxkLnRlbXBsYXRlLCBpeGVyLCB0aGlzKSk7XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIGNoaWxkcmVuKG5ldWU/OlVJW10sIGFwcGVuZCA9IGZhbHNlKSB7XG4gICAgaWYoIW5ldWUpIHJldHVybiB0aGlzLl9jaGlsZHJlbjtcbiAgICBpZighYXBwZW5kKSB0aGlzLl9jaGlsZHJlbi5sZW5ndGggPSAwO1xuICAgIGZvcihsZXQgY2hpbGQgb2YgbmV1ZSkge1xuICAgICAgbGV0IGNvcGllZCA9IGNoaWxkLmNvcHkoKTtcbiAgICAgIGNvcGllZC5fcGFyZW50ID0gdGhpcztcbiAgICAgIHRoaXMuX2NoaWxkcmVuLnB1c2goY29waWVkKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuX2NoaWxkcmVuO1xuICB9XG4gIGNoaWxkKGNoaWxkOlVJLCBpeD86IG51bWJlciwgZW1iZWQ/Ont9KSB7XG4gICAgY2hpbGQgPSBjaGlsZC5jb3B5KCk7XG4gICAgY2hpbGQuX3BhcmVudCA9IHRoaXM7XG4gICAgaWYoZW1iZWQpIGNoaWxkLmVtYmVkKGVtYmVkKTtcbiAgICBpZighaXgpIHRoaXMuX2NoaWxkcmVuLnB1c2goY2hpbGQpO1xuICAgIGVsc2UgdGhpcy5fY2hpbGRyZW4uc3BsaWNlKGl4LCAwLCBjaGlsZCk7XG4gICAgcmV0dXJuIGNoaWxkO1xuICB9XG4gIHJlbW92ZUNoaWxkKGl4OiBudW1iZXIpIHtcbiAgICByZXR1cm4gdGhpcy5fY2hpbGRyZW4uc3BsaWNlKGl4LCAxKTtcbiAgfVxuXG4gIGF0dHJpYnV0ZXMocHJvcGVydGllcz86IHt9LCBtZXJnZSA9IGZhbHNlKSB7XG4gICAgaWYoIXByb3BlcnRpZXMpIHJldHVybiB0aGlzLl9hdHRyaWJ1dGVzO1xuICAgIGlmKCFtZXJnZSkge1xuICAgICAgZm9yKGxldCBwcm9wIGluIHRoaXMuX2F0dHJpYnV0ZXMpIGRlbGV0ZSB0aGlzLl9hdHRyaWJ1dGVzW3Byb3BdO1xuICAgIH1cbiAgICBmb3IobGV0IHByb3AgaW4gcHJvcGVydGllcykgdGhpcy5fYXR0cmlidXRlc1twcm9wXSA9IHByb3BlcnRpZXNbcHJvcF07XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cbiAgYXR0cmlidXRlKHByb3BlcnR5OiBzdHJpbmcsIHZhbHVlPzogYW55KSB7XG4gICAgaWYodmFsdWUgPT09IHVuZGVmaW5lZCkgcmV0dXJuIHRoaXMuX2F0dHJpYnV0ZXNbcHJvcGVydHldO1xuICAgIHRoaXMuX2F0dHJpYnV0ZXNbcHJvcGVydHldID0gdmFsdWU7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cbiAgcmVtb3ZlQXR0cmlidXRlKHByb3BlcnR5OiBzdHJpbmcpIHtcbiAgICBkZWxldGUgdGhpcy5fYXR0cmlidXRlc1twcm9wZXJ0eV07XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBldmVudHMoZXZlbnRzPzoge30sIG1lcmdlID0gZmFsc2UpIHtcbiAgICBpZighZXZlbnRzKSByZXR1cm4gdGhpcy5fZXZlbnRzO1xuICAgIGlmKCFtZXJnZSkge1xuICAgICAgZm9yKGxldCBldmVudCBpbiB0aGlzLl9ldmVudHMpIGRlbGV0ZSB0aGlzLl9ldmVudHNbZXZlbnRdO1xuICAgIH1cbiAgICBmb3IobGV0IGV2ZW50IGluIGV2ZW50cykgdGhpcy5fZXZlbnRzW2V2ZW50XSA9IGV2ZW50c1tldmVudF07XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cbiAgZXZlbnQoZXZlbnQ6IHN0cmluZywgc3RhdGU/OiBhbnkpIHtcbiAgICBpZihzdGF0ZSA9PT0gdW5kZWZpbmVkKSByZXR1cm4gdGhpcy5fZXZlbnRzW2V2ZW50XTtcbiAgICB0aGlzLl9hdHRyaWJ1dGVzW2V2ZW50XSA9IHN0YXRlO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG4gIHJlbW92ZUV2ZW50KGV2ZW50OiBzdHJpbmcpIHtcbiAgICBkZWxldGUgdGhpcy5fZXZlbnRzW2V2ZW50XTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIGVtYmVkKHNjb3BlOnt9fGJvb2xlYW4gPSB7fSkge1xuICAgIGlmKCFzY29wZSkge1xuICAgICAgdGhpcy5fZW1iZWRkZWQgPSB1bmRlZmluZWQ7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgaWYoc2NvcGUgPT09IHRydWUpIHNjb3BlID0ge307XG4gICAgdGhpcy5fZW1iZWRkZWQgPSBzY29wZTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIGJpbmQoYmluZGluZzpRdWVyeSkge1xuICAgIHRoaXMuX2JpbmRpbmcgPSBiaW5kaW5nO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG59XG5cbmludGVyZmFjZSBVaVdhcm5pbmcge1xuICBcInVpIHdhcm5pbmc6IHRlbXBsYXRlXCI6IHN0cmluZ1xuICBcInVpIHdhcm5pbmc6IHdhcm5pbmdcIjogc3RyaW5nXG59XG5cbi8vIEBUT0RPOiBGaW5pc2ggcmVmZXJlbmNlIGltcGwuXG4vLyBAVE9ETzogVGhlbiBidWlsZCBiaXQtZ2VuZXJhdGluZyB2ZXJzaW9uXG5leHBvcnQgY2xhc3MgVUlSZW5kZXJlciB7XG4gIHB1YmxpYyBjb21waWxlZCA9IDA7XG4gIHByb3RlY3RlZCBfdGFnQ29tcGlsZXJzOntbdGFnOiBzdHJpbmddOiAoZWxlbTpFbGVtZW50KSA9PiB2b2lkfSA9IHt9O1xuICBwcm90ZWN0ZWQgX2hhbmRsZXJzOkhhbmRsZXI8RXZlbnQ+W10gPSBbXTtcblxuICBjb25zdHJ1Y3RvcihwdWJsaWMgaXhlcjpJbmRleGVyKSB7fVxuXG4gIGNvbXBpbGUocm9vdHM6KHN0cmluZ3xFbGVtZW50KVtdKTpFbGVtZW50W10ge1xuICAgIGlmKERFQlVHLlJFTkRFUkVSKSBjb25zb2xlLmdyb3VwKFwidWkgY29tcGlsZVwiKTtcbiAgICBsZXQgY29tcGlsZWRFbGVtczpFbGVtZW50W10gPSBbXTtcbiAgICBmb3IobGV0IHJvb3Qgb2Ygcm9vdHMpIHtcbiAgICAgIC8vIEBUT0RPOiByZXBhcmVudCBkeW5hbWljIHJvb3RzIGlmIG5lZWRlZC5cbiAgICAgIGlmKHR5cGVvZiByb290ID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgIGxldCBlbGVtcyA9IHRoaXMuX2NvbXBpbGVXcmFwcGVyKHJvb3QsIGNvbXBpbGVkRWxlbXMubGVuZ3RoKTtcbiAgICAgICAgY29tcGlsZWRFbGVtcy5wdXNoLmFwcGx5KGNvbXBpbGVkRWxlbXMsIGVsZW1zKTtcbiAgICAgICAgbGV0IGJhc2UgPSB0aGlzLml4ZXIuZmluZE9uZShcInVpIHRlbXBsYXRlXCIsIHtcInVpIHRlbXBsYXRlOiB0ZW1wbGF0ZVwiOiByb290fSk7XG4gICAgICAgIGlmKCFiYXNlKSBjb250aW51ZTtcbiAgICAgICAgbGV0IHBhcmVudCA9IGJhc2VbXCJ1aSB0ZW1wbGF0ZTogcGFyZW50XCJdO1xuICAgICAgICBpZihwYXJlbnQpIHtcbiAgICAgICAgICBmb3IobGV0IGVsZW0gb2YgZWxlbXMpIGVsZW0ucGFyZW50ID0gcGFyZW50O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgaWYoIXJvb3QuaXgpIHJvb3QuaXggPSBjb21waWxlZEVsZW1zLmxlbmd0aDtcbiAgICAgICAgY29tcGlsZWRFbGVtcy5wdXNoKHJvb3QpO1xuICAgICAgfVxuICAgIH1cbiAgICBpZihERUJVRy5SRU5ERVJFUikgY29uc29sZS5ncm91cEVuZCgpO1xuICAgIHJldHVybiBjb21waWxlZEVsZW1zO1xuICB9XG5cbiAgcHJvdGVjdGVkIF9jb21waWxlV3JhcHBlcih0ZW1wbGF0ZTpzdHJpbmcsIGJhc2VJeDogbnVtYmVyLCBjb25zdHJhaW50czp7fSA9IHt9LCBiaW5kaW5nU3RhY2s6YW55W10gPSBbXSwgZGVwdGg6bnVtYmVyID0gMCk6RWxlbWVudFtdIHtcbiAgICBsZXQgZWxlbXMgPSBbXTtcbiAgICBsZXQgYmluZGluZyA9IHRoaXMuaXhlci5maW5kT25lKFwidWkgdGVtcGxhdGUgYmluZGluZ1wiLCB7XCJ1aSB0ZW1wbGF0ZSBiaW5kaW5nOiB0ZW1wbGF0ZVwiOiB0ZW1wbGF0ZX0pO1xuICAgIGlmKCFiaW5kaW5nKSB7XG4gICAgICBsZXQgZWxlbSA9IHRoaXMuX2NvbXBpbGVFbGVtZW50KHRlbXBsYXRlLCBiaW5kaW5nU3RhY2ssIGRlcHRoKTtcbiAgICAgIGlmKGVsZW0pIGVsZW1zWzBdID0gZWxlbTtcbiAgICB9IGVsc2Uge1xuICAgICAgbGV0IGJvdW5kUXVlcnkgPSBiaW5kaW5nW1widWkgdGVtcGxhdGUgYmluZGluZzogYmluZGluZ1wiXTtcbiAgICAgIGxldCBmYWN0cyA9IHRoaXMuZ2V0Qm91bmRGYWN0cyhib3VuZFF1ZXJ5LCBjb25zdHJhaW50cyk7XG4gICAgICBsZXQgaXggPSAwO1xuICAgICAgZm9yKGxldCBmYWN0IG9mIGZhY3RzKSB7XG4gICAgICAgIGJpbmRpbmdTdGFjay5wdXNoKGZhY3QpO1xuICAgICAgICBsZXQgZWxlbSA9IHRoaXMuX2NvbXBpbGVFbGVtZW50KHRlbXBsYXRlLCBiaW5kaW5nU3RhY2ssIGRlcHRoKTtcbiAgICAgICAgYmluZGluZ1N0YWNrLnBvcCgpO1xuICAgICAgICBpZihlbGVtKSBlbGVtcy5wdXNoKGVsZW0pO1xuICAgICAgfVxuICAgIH1cbiAgICBlbGVtcy5zb3J0KChhLCBiKSA9PiBhLml4IC0gYi5peCk7XG4gICAgbGV0IHByZXZJeCA9IHVuZGVmaW5lZDtcbiAgICBmb3IobGV0IGVsZW0gb2YgZWxlbXMpIHtcbiAgICAgIGVsZW0uaXggPSBlbGVtLml4ID8gZWxlbS5peCArIGJhc2VJeCA6IGJhc2VJeDtcbiAgICAgIGlmKGVsZW0uaXggPT09IHByZXZJeCkgZWxlbS5peCsrO1xuICAgICAgcHJldkl4ID0gZWxlbS5peDtcbiAgICB9XG4gICAgcmV0dXJuIGVsZW1zO1xuICB9XG5cbiAgcHJvdGVjdGVkIF9jb21waWxlRWxlbWVudCh0ZW1wbGF0ZTpzdHJpbmcsIGJpbmRpbmdTdGFjazphbnlbXSwgZGVwdGg6bnVtYmVyKTpFbGVtZW50IHtcbiAgICBpZihERUJVRy5SRU5ERVJFUikgY29uc29sZS5sb2cocmVwZWF0KFwiICBcIiwgZGVwdGgpICsgXCIqIGNvbXBpbGVcIiwgdGVtcGxhdGUpO1xuICAgIGxldCBlbGVtZW50VG9DaGlsZHJlbiA9IHRoaXMuaXhlci5pbmRleChcInVpIHRlbXBsYXRlXCIsIFtcInVpIHRlbXBsYXRlOiBwYXJlbnRcIl0pO1xuICAgIGxldCBlbGVtZW50VG9FbWJlZHMgPSB0aGlzLml4ZXIuaW5kZXgoXCJ1aSBlbWJlZFwiLCBbXCJ1aSBlbWJlZDogcGFyZW50XCJdKTtcbiAgICBsZXQgZW1iZWRUb1Njb3BlID0gdGhpcy5peGVyLmluZGV4KFwidWkgZW1iZWQgc2NvcGVcIiwgW1widWkgZW1iZWQgc2NvcGU6IGVtYmVkXCJdKTtcbiAgICBsZXQgZW1iZWRUb1Njb3BlQmluZGluZyA9IHRoaXMuaXhlci5pbmRleChcInVpIGVtYmVkIHNjb3BlIGJpbmRpbmdcIiwgW1widWkgZW1iZWQgc2NvcGUgYmluZGluZzogZW1iZWRcIl0pO1xuICAgIGxldCBlbGVtZW50VG9BdHRycyA9IHRoaXMuaXhlci5pbmRleChcInVpIGF0dHJpYnV0ZVwiLCBbXCJ1aSBhdHRyaWJ1dGU6IHRlbXBsYXRlXCJdKTtcbiAgICBsZXQgZWxlbWVudFRvQXR0ckJpbmRpbmdzID0gdGhpcy5peGVyLmluZGV4KFwidWkgYXR0cmlidXRlIGJpbmRpbmdcIiwgW1widWkgYXR0cmlidXRlIGJpbmRpbmc6IHRlbXBsYXRlXCJdKTtcbiAgICBsZXQgZWxlbWVudFRvRXZlbnRzID0gdGhpcy5peGVyLmluZGV4KFwidWkgZXZlbnRcIiwgW1widWkgZXZlbnQ6IHRlbXBsYXRlXCJdKTtcbiAgICB0aGlzLmNvbXBpbGVkKys7XG4gICAgbGV0IGJhc2UgPSB0aGlzLml4ZXIuZmluZE9uZShcInVpIHRlbXBsYXRlXCIsIHtcInVpIHRlbXBsYXRlOiB0ZW1wbGF0ZVwiOiB0ZW1wbGF0ZX0pO1xuICAgIGlmKCFiYXNlKSB7XG4gICAgICBjb25zb2xlLndhcm4oYHVpIHRlbXBsYXRlICR7dGVtcGxhdGV9IGRvZXMgbm90IGV4aXN0LiBJZ25vcmluZy5gKTtcbiAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgbGV0IGF0dHJzID0gZWxlbWVudFRvQXR0cnNbdGVtcGxhdGVdO1xuICAgIGxldCBib3VuZEF0dHJzID0gZWxlbWVudFRvQXR0ckJpbmRpbmdzW3RlbXBsYXRlXTtcbiAgICBsZXQgZXZlbnRzID0gZWxlbWVudFRvRXZlbnRzW3RlbXBsYXRlXTtcblxuICAgIC8vIEhhbmRsZSBtZXRhIHByb3BlcnRpZXNcbiAgICBsZXQgZWxlbTpFbGVtZW50ID0ge190ZW1wbGF0ZTogdGVtcGxhdGUsIGl4OiBiYXNlW1widWkgdGVtcGxhdGU6IGl4XCJdfTtcblxuICAgIC8vIEhhbmRsZSBzdGF0aWMgcHJvcGVydGllc1xuICAgIGlmKGF0dHJzKSB7XG4gICAgICBmb3IobGV0IHtcInVpIGF0dHJpYnV0ZTogcHJvcGVydHlcIjogcHJvcCwgXCJ1aSBhdHRyaWJ1dGU6IHZhbHVlXCI6IHZhbH0gb2YgYXR0cnMpIGVsZW1bcHJvcF0gPSB2YWw7XG4gICAgfVxuXG4gICAgLy8gSGFuZGxlIGJvdW5kIHByb3BlcnRpZXNcbiAgICBpZihib3VuZEF0dHJzKSB7XG4gICAgICAvLyBARklYTUU6IFdoYXQgZG8gd2l0aCBzb3VyY2U/XG4gICAgICBmb3IobGV0IHtcInVpIGF0dHJpYnV0ZSBiaW5kaW5nOiBwcm9wZXJ0eVwiOiBwcm9wLCBcInVpIGF0dHJpYnV0ZSBiaW5kaW5nOiBzb3VyY2VcIjogc291cmNlLCBcInVpIGF0dHJpYnV0ZSBiaW5kaW5nOiBhbGlhc1wiOiBhbGlhc30gb2YgYm91bmRBdHRycylcbiAgICAgICAgZWxlbVtwcm9wXSA9IHRoaXMuZ2V0Qm91bmRWYWx1ZShzb3VyY2UsIGFsaWFzLCBiaW5kaW5nU3RhY2spO1xuICAgIH1cblxuICAgIC8vIEF0dGFjaCBldmVudCBoYW5kbGVyc1xuICAgIGlmKGV2ZW50cykge1xuICAgICAgZm9yKGxldCB7XCJ1aSBldmVudDogZXZlbnRcIjogZXZlbnR9IG9mIGV2ZW50cykgZWxlbVtldmVudF0gPSB0aGlzLmdlbmVyYXRlRXZlbnRIYW5kbGVyKGVsZW0sIGV2ZW50LCBiaW5kaW5nU3RhY2spO1xuICAgIH1cblxuICAgIC8vIENvbXBpbGUgY2hpbGRyZW5cbiAgICBsZXQgY2hpbGRyZW4gPSBlbGVtZW50VG9DaGlsZHJlblt0ZW1wbGF0ZV0gfHwgW107XG4gICAgbGV0IGVtYmVkcyA9IGVsZW1lbnRUb0VtYmVkc1t0ZW1wbGF0ZV0gfHwgW107XG4gICAgaWYoY2hpbGRyZW4ubGVuZ3RoIHx8IGVtYmVkcy5sZW5ndGgpIHtcbiAgICAgIGVsZW0uY2hpbGRyZW4gPSBbXTtcbiAgICAgIGxldCBjaGlsZEl4ID0gMCwgZW1iZWRJeCA9IDA7XG4gICAgICB3aGlsZShjaGlsZEl4IDwgY2hpbGRyZW4ubGVuZ3RoIHx8IGVtYmVkSXggPCBlbWJlZHMubGVuZ3RoKSB7XG4gICAgICAgIGxldCBjaGlsZCA9IGNoaWxkcmVuW2NoaWxkSXhdO1xuICAgICAgICBsZXQgZW1iZWQgPSBlbWJlZHNbZW1iZWRJeF07XG4gICAgICAgIGxldCBhZGQsIGNvbnN0cmFpbnRzID0ge30sIGNoaWxkQmluZGluZ1N0YWNrID0gYmluZGluZ1N0YWNrO1xuICAgICAgICBpZighZW1iZWQgfHwgY2hpbGQgJiYgY2hpbGQuaXggPD0gZW1iZWQuaXgpIHtcbiAgICAgICAgICBhZGQgPSBjaGlsZHJlbltjaGlsZEl4KytdW1widWkgdGVtcGxhdGU6IHRlbXBsYXRlXCJdO1xuICAgICAgICAgIC8vIFJlc29sdmUgYm91bmQgYWxpYXNlcyBpbnRvIGNvbnN0cmFpbnRzXG4gICAgICAgICAgY29uc3RyYWludHMgPSB0aGlzLmdldEJvdW5kU2NvcGUoYmluZGluZ1N0YWNrKTtcblxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGFkZCA9IGVtYmVkc1tlbWJlZEl4KytdW1widWkgZW1iZWQ6IHRlbXBsYXRlXCJdO1xuICAgICAgICAgIGZvcihsZXQgc2NvcGUgb2YgZW1iZWRUb1Njb3BlW2VtYmVkW1widWkgZW1iZWQ6IGVtYmVkXCJdXSB8fCBbXSlcbiAgICAgICAgICAgIGNvbnN0cmFpbnRzW3Njb3BlW1widWkgZW1iZWQgc2NvcGU6IGtleVwiXV0gPSBzY29wZVtcInVpIGVtYmVkIHNjb3BlOiB2YWx1ZVwiXTtcblxuICAgICAgICAgIGZvcihsZXQgc2NvcGUgb2YgZW1iZWRUb1Njb3BlQmluZGluZ1tlbWJlZFtcInVpIGVtYmVkOiBlbWJlZFwiXV0gfHwgW10pIHtcbiAgICAgICAgICAgIC8vIEBGSVhNRTogV2hhdCBkbyBhYm91dCBzb3VyY2U/XG4gICAgICAgICAgICBsZXQge1widWkgZW1iZWQgc2NvcGUgYmluZGluZzoga2V5XCI6IGtleSwgXCJ1aSBlbWJlZCBzY29wZSBiaW5kaW5nOiBzb3VyY2VcIjogc291cmNlLCBcInVpIGVtYmVkIHNjb3BlIGJpbmRpbmc6IGFsaWFzXCI6IGFsaWFzfSA9IHNjb3BlO1xuICAgICAgICAgICAgY29uc3RyYWludHNba2V5XSA9IHRoaXMuZ2V0Qm91bmRWYWx1ZShzb3VyY2UsIGFsaWFzLCBiaW5kaW5nU3RhY2spO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjaGlsZEJpbmRpbmdTdGFjayA9IFtjb25zdHJhaW50c107XG4gICAgICAgIH1cbiAgICAgICAgZWxlbS5jaGlsZHJlbi5wdXNoLmFwcGx5KGVsZW0uY2hpbGRyZW4sIHRoaXMuX2NvbXBpbGVXcmFwcGVyKGFkZCwgZWxlbS5jaGlsZHJlbi5sZW5ndGgsIGNvbnN0cmFpbnRzLCBjaGlsZEJpbmRpbmdTdGFjaywgZGVwdGggKyAxKSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYodGhpcy5fdGFnQ29tcGlsZXJzW2VsZW0udF0pIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIHRoaXMuX3RhZ0NvbXBpbGVyc1tlbGVtLnRdKGVsZW0pO1xuICAgICAgfSBjYXRjaChlcnIpIHtcbiAgICAgICAgY29uc29sZS53YXJuKGBGYWlsZWQgdG8gY29tcGlsZSB0ZW1wbGF0ZTogJyR7dGVtcGxhdGV9JyBkdWUgdG8gJyR7ZXJyfScgZm9yIGVsZW1lbnQgJyR7SlNPTi5zdHJpbmdpZnkoZWxlbSl9J2ApO1xuICAgICAgICBlbGVtLnQgPSBcInVpLWVycm9yXCI7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGVsZW07XG4gIH1cblxuICBwcm90ZWN0ZWQgZ2V0Qm91bmRGYWN0cyhxdWVyeSwgY29uc3RyYWludHMpOnN0cmluZ1tdIHtcbiAgICByZXR1cm4gdGhpcy5peGVyLmZpbmQocXVlcnksIGNvbnN0cmFpbnRzKTtcbiAgfVxuICBwcm90ZWN0ZWQgZ2V0Qm91bmRTY29wZShiaW5kaW5nU3RhY2s6YW55W10pOnt9IHtcbiAgICBsZXQgc2NvcGUgPSB7fTtcbiAgICBmb3IobGV0IGZhY3Qgb2YgYmluZGluZ1N0YWNrKSB7XG4gICAgICBmb3IobGV0IGFsaWFzIGluIGZhY3QpIHNjb3BlW2FsaWFzXSA9IGZhY3RbYWxpYXNdO1xuICAgIH1cbiAgICByZXR1cm4gc2NvcGU7XG4gIH1cblxuICAvL0BGSVhNRTogV2hhdCBkbyBhYm91dCBzb3VyY2U/XG4gIHByb3RlY3RlZCBnZXRCb3VuZFZhbHVlKHNvdXJjZTpzdHJpbmcsIGFsaWFzOnN0cmluZywgYmluZGluZ1N0YWNrOmFueVtdKTphbnkgeyAvLyBARklYTUU6IEZpbmRzIGRvbid0IGNyZWF0ZSBhIHNvdXJjZSBmaWVsZCBvbiB0aGUgcmVzdWx0LlxuICAgIGZvcihsZXQgaXggPSBiaW5kaW5nU3RhY2subGVuZ3RoIC0gMTsgaXggPj0gMDsgaXgtLSkge1xuICAgICAgbGV0IGZhY3QgPSBiaW5kaW5nU3RhY2tbaXhdO1xuICAgICAgaWYoc291cmNlIGluIGZhY3QgJiYgZmFjdFthbGlhc10pIHJldHVybiBmYWN0W2FsaWFzXTtcbiAgICB9XG4gIH1cbiAgcHJvdGVjdGVkIGdlbmVyYXRlRXZlbnRIYW5kbGVyKGVsZW06RWxlbWVudCwgZXZlbnQ6c3RyaW5nLCBiaW5kaW5nU3RhY2s6YW55W10pOkhhbmRsZXI8RXZlbnQ+IHtcbiAgICBsZXQgdGVtcGxhdGUgPSBlbGVtW1wiX3RlbXBsYXRlXCJdO1xuICAgIGxldCBtZW1vS2V5ID0gYCR7dGVtcGxhdGV9Ojoke2V2ZW50fWA7XG4gICAgbGV0IGF0dHJLZXkgPSBgJHtldmVudH06OnN0YXRlYDtcbiAgICBlbGVtW2F0dHJLZXldID0gdGhpcy5nZXRFdmVudFN0YXRlKHRlbXBsYXRlLCBldmVudCwgYmluZGluZ1N0YWNrKTtcbiAgICBpZih0aGlzLl9oYW5kbGVyc1ttZW1vS2V5XSkgcmV0dXJuIHRoaXMuX2hhbmRsZXJzW21lbW9LZXldO1xuXG4gICAgbGV0IHNlbGYgPSB0aGlzO1xuICAgIGlmKGV2ZW50ID09PSBcImNoYW5nZVwiIHx8IGV2ZW50ID09PSBcImlucHV0XCIpIHtcbiAgICAgIHRoaXMuX2hhbmRsZXJzW21lbW9LZXldID0gKGV2dDpFdmVudCwgZWxlbTpFbGVtZW50KSA9PiB7XG4gICAgICAgIGxldCBwcm9wczphbnkgPSB7fTtcbiAgICAgICAgaWYoZWxlbS50ID09PSBcInNlbGVjdFwiIHx8IGVsZW0udCA9PT0gXCJpbnB1dFwiIHx8IGVsZW0udCA9PT0gXCJ0ZXh0YXJlYVwiKSBwcm9wcy52YWx1ZSA9ICg8SFRNTFNlbGVjdEVsZW1lbnR8SFRNTElucHV0RWxlbWVudD5ldnQudGFyZ2V0KS52YWx1ZTtcbiAgICAgICAgaWYoZWxlbS50eXBlID09PSBcImNoZWNrYm94XCIpIHByb3BzLnZhbHVlID0gKDxIVE1MSW5wdXRFbGVtZW50PmV2dC50YXJnZXQpLmNoZWNrZWQ7XG4gICAgICAgIHNlbGYuaGFuZGxlRXZlbnQodGVtcGxhdGUsIGV2ZW50LCBldnQsIGVsZW0sIHByb3BzKTtcbiAgICAgIH07XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX2hhbmRsZXJzW21lbW9LZXldID0gKGV2dDpFdmVudCwgZWxlbTpFbGVtZW50KSA9PiB7XG4gICAgICAgIHNlbGYuaGFuZGxlRXZlbnQodGVtcGxhdGUsIGV2ZW50LCBldnQsIGVsZW0sIHt9KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5faGFuZGxlcnNbbWVtb0tleV07XG4gIH1cbiAgcHJvdGVjdGVkIGhhbmRsZUV2ZW50KHRlbXBsYXRlOnN0cmluZywgZXZlbnROYW1lOnN0cmluZywgZXZlbnQ6RXZlbnQsIGVsZW06RWxlbWVudCwgZXZlbnRQcm9wczp7fSkge1xuICAgIGxldCBhdHRyS2V5ID0gYCR7ZXZlbnROYW1lfTo6c3RhdGVgO1xuICAgIGxldCBzdGF0ZSA9IGVsZW1bYXR0cktleV07XG4gICAgbGV0IGNvbnRlbnQgPSB1bnBhZCg2KSBgXG4gICAgICAjICR7ZXZlbnROYW1lfSAoe2lzIGE6IGV2ZW50fSlcbiAgICAgICMjIE1ldGFcbiAgICAgIGV2ZW50IHRhcmdldDoge2V2ZW50IHRhcmdldDogJHtlbGVtLmlkfX1cbiAgICAgIGV2ZW50IHRlbXBsYXRlOiB7ZXZlbnQgdGVtcGxhdGU6ICR7dGVtcGxhdGV9fVxuICAgICAgZXZlbnQgdHlwZToge2V2ZW50IHR5cGU6ICR7ZXZlbnROYW1lfX1cblxuICAgICAgIyMgU3RhdGVcbiAgICBgO1xuICAgIGlmKHN0YXRlW1wiKmV2ZW50KlwiXSkge1xuICAgICAgZm9yKGxldCBwcm9wIGluIHN0YXRlW1wiKmV2ZW50KlwiXSlcbiAgICAgICAgY29udGVudCArPSBgJHtwcm9wfTogeyR7cHJvcH06ICR7ZXZlbnRQcm9wc1tzdGF0ZVtcIipldmVudCpcIl1bcHJvcF1dfX1cXG5gO1xuICAgIH1cbiAgICBmb3IobGV0IHByb3AgaW4gc3RhdGUpIHtcbiAgICAgIGlmKHByb3AgPT09IFwiKmV2ZW50KlwiKSBjb250aW51ZTtcbiAgICAgIGNvbnRlbnQgKz0gYCR7cHJvcH06IHske3Byb3B9OiAke3N0YXRlW3Byb3BdfX1cXG5gXG4gICAgfVxuXG4gICAgbGV0IGNoYW5nZXNldCA9IHRoaXMuaXhlci5kaWZmKCk7XG4gICAgbGV0IHJhdyA9IHV1aWQoKTtcbiAgICBsZXQgZW50aXR5ID0gYCR7ZXZlbnROYW1lfSBldmVudCAke3Jhdy5zbGljZSgtMTIpfWA7XG4gICAgY2hhbmdlc2V0LmFkZChcImJ1aWx0aW4gZW50aXR5XCIsIHtlbnRpdHksIGNvbnRlbnR9KTtcbiAgICB0aGlzLml4ZXIuYXBwbHlEaWZmKGNoYW5nZXNldCk7XG4gICAgY29uc29sZS5sb2coZW50aXR5KTtcbiAgfVxuXG4gIHByb3RlY3RlZCBnZXRFdmVudFN0YXRlKHRlbXBsYXRlOnN0cmluZywgZXZlbnQ6c3RyaW5nLCBiaW5kaW5nU3RhY2s6YW55W10pOnt9IHtcbiAgICBsZXQgc3RhdGUgPSB7fTtcbiAgICBsZXQgc3RhdGljQXR0cnMgPSB0aGlzLml4ZXIuZmluZChcInVpIGV2ZW50IHN0YXRlXCIsIHtcInVpIGV2ZW50IHN0YXRlOiB0ZW1wbGF0ZVwiOiB0ZW1wbGF0ZSwgXCJ1aSBldmVudCBzdGF0ZTogZXZlbnRcIjogZXZlbnR9KTtcbiAgICBmb3IobGV0IHtcInVpIGV2ZW50IHN0YXRlOiBrZXlcIjoga2V5LCBcInVpIGV2ZW50IHN0YXRlOiB2YWx1ZVwiOiB2YWx9IG9mIHN0YXRpY0F0dHJzKSBzdGF0ZVtrZXldID0gdmFsO1xuXG4gICAgbGV0IGJvdW5kQXR0cnMgPSB0aGlzLml4ZXIuZmluZChcInVpIGV2ZW50IHN0YXRlIGJpbmRpbmdcIiwge1widWkgZXZlbnQgc3RhdGUgYmluZGluZzogdGVtcGxhdGVcIjogdGVtcGxhdGUsIFwidWkgZXZlbnQgc3RhdGUgYmluZGluZzogZXZlbnRcIjogZXZlbnR9KTtcbiAgICBmb3IobGV0IHtcInVpIGV2ZW50IHN0YXRlIGJpbmRpbmc6IGtleVwiOiBrZXksIFwidWkgZXZlbnQgc3RhdGUgYmluZGluZzogc291cmNlXCI6IHNvdXJjZSwgXCJ1aSBldmVudCBzdGF0ZSBiaW5kaW5nOiBhbGlhc1wiOiBhbGlhc30gb2YgYm91bmRBdHRycykge1xuICAgICAgaWYoc291cmNlID09PSBcIipldmVudCpcIikge1xuICAgICAgICBzdGF0ZVtcIipldmVudCpcIl0gPSBzdGF0ZVtcIipldmVudCpcIl0gfHwge307XG4gICAgICAgIHN0YXRlW1wiKmV2ZW50KlwiXVtrZXldID0gYWxpYXM7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzdGF0ZVtrZXldID0gdGhpcy5nZXRCb3VuZFZhbHVlKHNvdXJjZSwgYWxpYXMsIGJpbmRpbmdTdGFjayk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHN0YXRlO1xuICB9XG59XG5cbmRlY2xhcmUgdmFyIGV4cG9ydHM7XG5pZih0aGlzLndpbmRvdykgd2luZG93W1widWlSZW5kZXJlclwiXSA9IGV4cG9ydHM7IiwiZGVjbGFyZSB2YXIgcGx1cmFsaXplOyAvLyBAVE9ETzogaW1wb3J0IG1lLlxuaW1wb3J0IHtidWlsdGluSWQsIGNvcHksIGNvZXJjZUlucHV0LCBzb3J0QnlMb29rdXAsIHNvcnRCeUZpZWxkLCBLRVlTLCBhdXRvRm9jdXMsIHV1aWR9IGZyb20gXCIuL3V0aWxzXCI7XG5pbXBvcnQge0VsZW1lbnQsIEhhbmRsZXJ9IGZyb20gXCIuL21pY3JvUmVhY3RcIjtcbmltcG9ydCB7ZGlzcGF0Y2gsIGV2ZX0gZnJvbSBcIi4vYXBwXCI7XG5pbXBvcnQge1BBTkUsIHVpU3RhdGUgYXMgX3N0YXRlLCBhc0VudGl0eSwgZW50aXR5VGlsZXNVSSwgYWN0aXZlQ2VsbHMsIHdpa2lFZGl0b3IsIGxpc3RUaWxlfSBmcm9tIFwiLi91aVwiO1xuaW1wb3J0IHttYXNvbnJ5IGFzIG1hc29ucnlSYXcsIE1hc29ucnlMYXlvdXR9IGZyb20gXCIuL21hc29ucnlcIjtcblxuLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbi8vIFV0aWxpdGllc1xuLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbmV4cG9ydCBmdW5jdGlvbiByZXNvbHZlTmFtZShtYXliZUlkOnN0cmluZyk6c3RyaW5nIHtcbiAgbGV0IGRpc3BsYXkgPSBldmUuZmluZE9uZShcImRpc3BsYXkgbmFtZVwiLCB7aWQ6IG1heWJlSWR9KTtcbiAgcmV0dXJuIGRpc3BsYXkgPyBkaXNwbGF5Lm5hbWUgOiBtYXliZUlkO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHJlc29sdmVJZChtYXliZU5hbWU6c3RyaW5nKTpzdHJpbmcge1xuICBsZXQgZGlzcGxheSA9IGV2ZS5maW5kT25lKFwiZGlzcGxheSBuYW1lXCIsIHtuYW1lOiBtYXliZU5hbWV9KTtcbiAgcmV0dXJuIGRpc3BsYXkgPyBkaXNwbGF5LmlkIDogbWF5YmVOYW1lO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHJlc29sdmVWYWx1ZShtYXliZVZhbHVlOnN0cmluZyk6c3RyaW5nIHtcbiAgbWF5YmVWYWx1ZSA9IGNvZXJjZUlucHV0KG1heWJlVmFsdWUpO1xuICBpZih0eXBlb2YgbWF5YmVWYWx1ZSAhPT0gXCJzdHJpbmdcIikgcmV0dXJuIG1heWJlVmFsdWU7XG4gIGxldCB2YWwgPSBtYXliZVZhbHVlLnRyaW0oKTtcbiAgbGV0IGVudGl0eSA9IGFzRW50aXR5KG1heWJlVmFsdWUpO1xuICBpZihlbnRpdHkpIHJldHVybiBlbnRpdHk7XG4gIC8vaWYodmFsWzBdID09PSBcIlxcXCJcIiAmJiB2YWxbdmFsLmxlbmd0aCAtIDFdID09PSBcIlxcXCJcIikgcmV0dXJuIHZhbC5zbGljZSgxLCAtMSk7XG4gIHJldHVybiB2YWw7XG59XG5leHBvcnQgZnVuY3Rpb24gaXNFbnRpdHkobWF5YmVJZDpzdHJpbmcpOmJvb2xlYW4ge1xuICByZXR1cm4gISFldmUuZmluZE9uZShcImVudGl0eVwiLCB7ZW50aXR5OiBtYXliZUlkfSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXROb2RlQ29udGVudChub2RlOkhUTUxFbGVtZW50KSB7XG4gIGlmKG5vZGUubm9kZU5hbWUgPT09IFwiSU5QVVRcIikgcmV0dXJuICg8SFRNTElucHV0RWxlbWVudD5ub2RlKS52YWx1ZTtcbiAgZWxzZSByZXR1cm4gbm9kZS50ZXh0Q29udGVudDtcbn1cblxuZnVuY3Rpb24gc29ydEJ5RmllbGRWYWx1ZShmaWVsZDpzdHJpbmcsIGRpcmVjdGlvbiA9IDEpOihhLCBiKSA9PiBudW1iZXIge1xuICB2YXIgZndkID0gZGlyZWN0aW9uO1xuICB2YXIgYmFjayA9IC0xICogZGlyZWN0aW9uO1xuICByZXR1cm4gKHJvd0EsIHJvd0IpID0+IHtcbiAgICBsZXQgYSA9IHJlc29sdmVOYW1lKHJlc29sdmVWYWx1ZShyb3dBW2ZpZWxkXSkpLCBiID0gcmVzb2x2ZU5hbWUocmVzb2x2ZVZhbHVlKHJvd0JbZmllbGRdKSk7XG4gICAgcmV0dXJuIChhID09PSBiKSA/IDAgOlxuICAgICAgKGEgPT09IHVuZGVmaW5lZCkgPyBmd2QgOlxuICAgICAgKGIgPT09IHVuZGVmaW5lZCkgPyBiYWNrIDpcbiAgICAgIChhID4gYikgPyBmd2QgOiBiYWNrO1xuICB9O1xufVxuXG5sZXQgd29yZFNwbGl0dGVyID0gL1xccysvZ2k7XG5jb25zdCBzdGF0V2VpZ2h0cyA9IHtsaW5rczogMTAwLCBwYWdlczogMjAwLCB3b3JkczogMX07XG5mdW5jdGlvbiBjbGFzc2lmeUVudGl0aWVzKHJhd0VudGl0aWVzOnN0cmluZ1tdKSB7XG4gIGxldCBlbnRpdGllcyA9IHJhd0VudGl0aWVzLnNsaWNlKCk7XG4gIGxldCBjb2xsZWN0aW9uczpzdHJpbmdbXSA9IFtdO1xuICBsZXQgc3lzdGVtczpzdHJpbmdbXSA9IFtdO1xuXG4gIC8vIE1lYXN1cmUgcmVsYXRlZG5lc3MgKyBsZW5ndGggb2YgZW50aXRpZXNcbiAgLy8gQFRPRE86IG10aW1lcyBvZiBlbnRpdGllc1xuICBsZXQgcmVsYXRlZENvdW50czp7W2VudGl0eTpzdHJpbmddOiBudW1iZXJ9ID0ge307XG4gIGxldCB3b3JkQ291bnRzOntbZW50aXR5OnN0cmluZ106IG51bWJlcn0gPSB7fTtcbiAgbGV0IGNoaWxkQ291bnRzOntbY29sbGVjdGlvbjpzdHJpbmddOiBudW1iZXJ9ID0ge307XG4gIGxldCBzY29yZXM6e1tlbnRpdHk6c3RyaW5nXTogbnVtYmVyfSA9e307XG4gIGZvcihsZXQgZW50aXR5IG9mIGVudGl0aWVzKSB7XG4gICAgbGV0IHtjb250ZW50ID0gXCJcIn0gPSBldmUuZmluZE9uZShcImVudGl0eVwiLCB7ZW50aXR5fSkgfHwge307XG4gICAgcmVsYXRlZENvdW50c1tlbnRpdHldID0gZXZlLmZpbmQoXCJkaXJlY3Rpb25sZXNzIGxpbmtzXCIsIHtlbnRpdHl9KS5sZW5ndGg7XG4gICAgd29yZENvdW50c1tlbnRpdHldID0gY29udGVudC50cmltKCkucmVwbGFjZSh3b3JkU3BsaXR0ZXIsIFwiIFwiKS5zcGxpdChcIiBcIikubGVuZ3RoO1xuICAgIGxldCB7Y291bnQ6Y2hpbGRDb3VudCA9IDB9ID0gZXZlLmZpbmRPbmUoXCJjb2xsZWN0aW9uXCIsIHtjb2xsZWN0aW9uOiBlbnRpdHl9KSB8fCB7fTtcbiAgICBjaGlsZENvdW50c1tlbnRpdHldID0gY2hpbGRDb3VudDtcbiAgICBzY29yZXNbZW50aXR5XSA9XG4gICAgICByZWxhdGVkQ291bnRzW2VudGl0eV0gKiBzdGF0V2VpZ2h0cy5saW5rcyArXG4gICAgICB3b3JkQ291bnRzW2VudGl0eV0gKiBzdGF0V2VpZ2h0cy53b3JkcyArXG4gICAgICBjaGlsZENvdW50c1tlbnRpdHldICogc3RhdFdlaWdodHMucGFnZXM7XG4gIH1cbiAgXG4gIC8vIFNlcGFyYXRlIHN5c3RlbSBlbnRpdGllc1xuICBsZXQgaXggPSAwO1xuICB3aGlsZShpeCA8IGVudGl0aWVzLmxlbmd0aCkge1xuICAgIGlmKGV2ZS5maW5kT25lKFwiaXMgYSBhdHRyaWJ1dGVzXCIsIHtjb2xsZWN0aW9uOiBidWlsdGluSWQoXCJzeXN0ZW1cIiksIGVudGl0eTogZW50aXRpZXNbaXhdfSkpIHtcbiAgICAgIHN5c3RlbXMucHVzaChlbnRpdGllcy5zcGxpY2UoaXgsIDEpWzBdKTtcbiAgICB9IGVsc2UgaXgrKztcbiAgfVxuICBcbiAgLy8gU2VwYXJhdGUgdXNlciBjb2xsZWN0aW9ucyBmcm9tIG90aGVyIGVudGl0aWVzXG4gIGl4ID0gMDtcbiAgd2hpbGUoaXggPCBlbnRpdGllcy5sZW5ndGgpIHtcbiAgICBpZihjaGlsZENvdW50c1tlbnRpdGllc1tpeF1dKSB7XG4gICAgICBjb2xsZWN0aW9ucy5wdXNoKGVudGl0aWVzLnNwbGljZShpeCwgMSlbMF0pO1xuICAgIH0gZWxzZSBpeCsrO1xuICB9XG5cbiAgcmV0dXJuIHtzeXN0ZW1zLCBjb2xsZWN0aW9ucywgZW50aXRpZXMsIHNjb3JlcywgcmVsYXRlZENvdW50cywgd29yZENvdW50cywgY2hpbGRDb3VudHN9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0RmllbGRzKHtleGFtcGxlLCB3aGl0ZWxpc3QsIGJsYWNrbGlzdH06e2V4YW1wbGU/OnN0cmluZ1tdLCB3aGl0ZWxpc3Q/OnN0cmluZ1tdLCBibGFja2xpc3Q/OnN0cmluZ1tdfSk6c3RyaW5nW10ge1xuICAvLyBEZXRlcm1pbmUgZGlzcGxheSBmaWVsZHMgYmFzZWQgb24gd2hpdGVsaXN0LCBibGFja2xpc3QsIGFuZCB0aGUgZmlyc3Qgcm93XG4gIGxldCBmaWVsZHM7XG4gIGlmKHdoaXRlbGlzdCkge1xuICAgIGZpZWxkcyA9IHdoaXRlbGlzdC5zbGljZSgpO1xuICB9IGVsc2Uge1xuICAgIGZpZWxkcyA9IE9iamVjdC5rZXlzKGV4YW1wbGUpO1xuICAgIGlmKGJsYWNrbGlzdCkge1xuICAgICAgZm9yKGxldCBmaWVsZCBvZiBibGFja2xpc3QpIHtcbiAgICAgICAgbGV0IGZpZWxkSXggPSBmaWVsZHMuaW5kZXhPZihmaWVsZCk7XG4gICAgICAgIGlmKGZpZWxkSXggIT09IC0xKSB7XG4gICAgICAgICAgZmllbGRzLnNwbGljZShmaWVsZEl4LCAxKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuICByZXR1cm4gZmllbGRzO1xufVxuXG5cbi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4vLyBIYW5kbGVyc1xuLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbmV4cG9ydCBmdW5jdGlvbiBwcmV2ZW50RGVmYXVsdChldmVudCkge1xuICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xufVxuZnVuY3Rpb24gcHJldmVudERlZmF1bHRVbmxlc3NGb2N1c2VkKGV2ZW50KSB7XG4gIGlmKGV2ZW50LnRhcmdldCAhPT0gZG9jdW1lbnQuYWN0aXZlRWxlbWVudCkgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbn1cblxuZnVuY3Rpb24gY2xvc2VQb3B1cChldmVudCwgZWxlbSwgY2hhaW4/KSB7XG4gIGxldCBjb21taXQgPSBmYWxzZTtcbiAgaWYoIWNoYWluKSB7XG4gICAgY2hhaW4gPSBkaXNwYXRjaChcInJlcmVuZGVyXCIpO1xuICAgIGNvbW1pdCA9IHRydWU7XG4gIH1cbiAgbGV0IHBhbmVJZCA9IGVsZW0ucGFuZUlkIHx8IGVsZW0uZGF0YSAmJiBlbGVtLmRhdGEucGFuZUlkO1xuICBmb3IobGV0IHtwYW5lOmNoaWxkfSBvZiBldmUuZmluZChcInVpIHBhbmUgcGFyZW50XCIsIHtwYXJlbnQ6IHBhbmVJZH0pKSB7XG4gICAgbGV0IHBvcG91dCA9IGV2ZS5maW5kT25lKFwidWkgcGFuZVwiLCB7cGFuZTogY2hpbGQsIGtpbmQ6IFBBTkUuUE9QT1VUfSk7XG4gICAgaWYoIXBvcG91dCkgY29udGludWU7XG4gICAgY2hhaW4uZGlzcGF0Y2goXCJyZW1vdmUgcG9wdXBcIiwge3BhbmVJZDogcG9wb3V0LnBhbmV9KTtcbiAgfVxuICBpZihjb21taXQpIGNoYWluLmNvbW1pdCgpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gbmF2aWdhdGUoZXZlbnQsIGVsZW0pIHtcbiAgbGV0IHtwYW5lSWR9ID0gZWxlbS5kYXRhO1xuICBpZihlbGVtLnBlZWspIGRpc3BhdGNoKFwic2V0IHBvcG91dFwiLCB7cGFyZW50SWQ6IHBhbmVJZCwgY29udGFpbnM6IGVsZW0ubGluaywgeDogZXZlbnQuY2xpZW50WCwgeTogZXZlbnQuY2xpZW50WX0pLmNvbW1pdCgpO1xuICBlbHNlIGRpc3BhdGNoKFwic2V0IHBhbmVcIiwge3BhbmVJZCwgY29udGFpbnM6IGVsZW0ubGlua30pLmNvbW1pdCgpO1xuICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbn1cblxuZnVuY3Rpb24gYmx1ck9uRW50ZXIoZXZlbnQsIGVsZW0pIHtcbiAgaWYoZXZlbnQua2V5Q29kZSA9PT0gS0VZUy5FTlRFUikge1xuICAgIGV2ZW50LnRhcmdldC5ibHVyKCk7XG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgfVxufVxuXG5pbnRlcmZhY2UgVGFibGVSb3dFbGVtIGV4dGVuZHMgRWxlbWVudCB7IHRhYmxlOiBzdHJpbmcsIHJvdzogYW55LCByb3dzPzogYW55W10gfVxuLy9pbnRlcmZhY2UgVGFibGVDZWxsRWxlbSBleHRlbmRzIEVsZW1lbnQgeyByb3c6IFRhYmxlUm93RWxlbSwgZmllbGQ6IHN0cmluZywgcm93cz86IGFueVtdfVxuLy9pbnRlcmZhY2UgVGFibGVGaWVsZEVsZW0gZXh0ZW5kcyBFbGVtZW50IHsgdGFibGU6IHN0cmluZywgZmllbGQ6IHN0cmluZywgZGlyZWN0aW9uPzogbnVtYmVyIH1cblxuZnVuY3Rpb24gdXBkYXRlRW50aXR5VmFsdWUoZXZlbnQ6Q3VzdG9tRXZlbnQsIGVsZW06VGFibGVDZWxsRWxlbSkge1xuICBsZXQgdmFsdWUgPSBjb2VyY2VJbnB1dChldmVudC5kZXRhaWwpO1xuICBsZXQge3RhYmxlOnRhYmxlRWxlbSwgcm93LCBmaWVsZH0gPSBlbGVtO1xuICBsZXQgZW50aXR5ID0gdGFibGVFbGVtW1wiZW50aXR5XCJdO1xuICB0aHJvdyBuZXcgRXJyb3IoXCJAVE9ETzogRklYTUVcIik7XG4gIC8vIGxldCByb3dzID0gZWxlbS5yb3dzIHx8IFtyb3ddO1xuICAvLyBsZXQgY2hhaW4gPSBkaXNwYXRjaCgpO1xuICAvLyBmb3IobGV0IHJvdyBvZiByb3dzKSB7XG4gIC8vICAgaWYoZmllbGQgPT09IFwidmFsdWVcIiAmJiByb3cudmFsdWUgIT09IHZhbHVlICYmIHJvdy5hdHRyaWJ1dGUgIT09IHVuZGVmaW5lZCkge1xuICAvLyAgICAgY2hhaW4uZGlzcGF0Y2goXCJ1cGRhdGUgZW50aXR5IGF0dHJpYnV0ZVwiLCB7ZW50aXR5LCBhdHRyaWJ1dGU6IHJvdy5hdHRyaWJ1dGUsIHByZXY6IHJvdy52YWx1ZSwgdmFsdWV9KTtcbiAgLy8gICB9IGVsc2UgaWYoZmllbGQgPT09IFwiYXR0cmlidXRlXCIgJiYgcm93LmF0dHJpYnV0ZSAhPT0gdmFsdWUgJiYgcm93LnZhbHVlICE9PSB1bmRlZmluZWQpIHtcbiAgLy8gICAgIGNoYWluLmRpc3BhdGNoKFwicmVuYW1lIGVudGl0eSBhdHRyaWJ1dGVcIiwge2VudGl0eSwgcHJldjogcm93LmF0dHJpYnV0ZSwgYXR0cmlidXRlOiB2YWx1ZSwgdmFsdWU6IHJvdy52YWx1ZX0pO1xuICAvLyAgIH1cbiAgLy8gfVxuICAvLyBjaGFpbi5jb21taXQoKTtcbn1cbmZ1bmN0aW9uIHVwZGF0ZUVudGl0eUF0dHJpYnV0ZXMoZXZlbnQ6Q3VzdG9tRXZlbnQsIGVsZW06e3JvdzogVGFibGVSb3dFbGVtfSkge1xuICBsZXQge3RhYmxlOnRhYmxlRWxlbSwgcm93fSA9IGVsZW0ucm93O1xuICBsZXQgZW50aXR5ID0gdGFibGVFbGVtW1wiZW50aXR5XCJdO1xuICBpZihldmVudC5kZXRhaWwgPT09IFwiYWRkXCIpIHtcbiAgICBsZXQgc3RhdGUgPSBlbGVtW1wic3RhdGVcIl1bXCJhZGRlclwiXTtcbiAgICB2YXIgdmFsaWQgPSBlbGVtW1wiZmllbGRzXCJdLmV2ZXJ5KChmaWVsZCkgPT4ge1xuICAgICAgcmV0dXJuIHN0YXRlW2ZpZWxkXSAhPT0gdW5kZWZpbmVkO1xuICAgIH0pO1xuICAgIGlmKHZhbGlkKSB7XG4gICAgICBkaXNwYXRjaChcImFkZCBzb3VyY2VkIGVhdlwiLCB7ZW50aXR5LCBhdHRyaWJ1dGU6IHN0YXRlLmF0dHJpYnV0ZSwgdmFsdWU6IHJlc29sdmVWYWx1ZShzdGF0ZS52YWx1ZSl9KS5jb21taXQoKTtcbiAgICAgIGVsZW1bXCJzdGF0ZVwiXVtcImFkZGVyXCJdID0ge307XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIGRpc3BhdGNoKFwicmVtb3ZlIGVudGl0eSBhdHRyaWJ1dGVcIiwge2VudGl0eSwgYXR0cmlidXRlOiByb3cuYXR0cmlidXRlLCB2YWx1ZTogcm93LnZhbHVlfSkuY29tbWl0KCk7XG4gIH1cbn1cbmZ1bmN0aW9uIHNvcnRUYWJsZShldmVudCwgZWxlbTpUYWJsZUZpZWxkRWxlbSkge1xuICBsZXQge3RhYmxlLCBmaWVsZCA9IHVuZGVmaW5lZCwgZGlyZWN0aW9uID0gdW5kZWZpbmVkfSA9IGVsZW07XG4gIGlmKGZpZWxkID09PSB1bmRlZmluZWQgJiYgZGlyZWN0aW9uID09PSB1bmRlZmluZWQpIHtcbiAgICBmaWVsZCA9IGV2ZW50LnRhcmdldC52YWx1ZTtcbiAgICBkaXJlY3Rpb24gPSAtMTtcbiAgfVxuICBkaXNwYXRjaChcInNvcnQgdGFibGVcIiwge3N0YXRlOiB0YWJsZS5zdGF0ZSwgZmllbGQsIGRpcmVjdGlvbn0pLmNvbW1pdCgpO1xufVxuXG4vLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuLy8gRW1iZWRkZWQgY2VsbCByZXByZXNlbnRhdGlvbiB3cmFwcGVyXG4vLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxudmFyIHVpdGsgPSB0aGlzO1xuZXhwb3J0IGZ1bmN0aW9uIGVtYmVkZGVkQ2VsbChlbGVtKTpFbGVtZW50IHtcbiAgbGV0IGNoaWxkcmVuID0gW107XG4gIGxldCB7Y2hpbGRJbmZvLCByZXB9ID0gZWxlbTtcbiAgaWYoY2hpbGRJbmZvLmNvbnN0cnVjdG9yID09PSBBcnJheSkge1xuICAgIGZvcihsZXQgY2hpbGQgb2YgY2hpbGRJbmZvKSB7XG4gICAgICBjaGlsZFtcImRhdGFcIl0gPSBjaGlsZFtcImRhdGFcIl0gfHwgY2hpbGRJbmZvLnBhcmFtcztcbiAgICAgIGNoaWxkcmVuLnB1c2godWl0a1tyZXBdKGNoaWxkKSk7XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIGNoaWxkcmVuLnB1c2godWl0a1tyZXBdKGNoaWxkSW5mbykpO1xuICB9XG4gIGNoaWxkcmVuLnB1c2goe2M6IFwiZWRpdC1idXR0b24tY29udGFpbmVyXCIsIGNoaWxkcmVuOiBbXG4gICAge2M6IFwiZWRpdC1idXR0b24gaW9uLWVkaXRcIiwgY2xpY2s6IGVsZW0uY2xpY2ssIGNlbGw6IGVsZW0uY2VsbH1cbiAgXX0pO1xuICByZXR1cm4ge2M6IFwibm9uLWVkaXRpbmctZW1iZWRkZWQtY2VsbFwiLCBjaGlsZHJlbiwgY2VsbDogZWxlbS5jZWxsfTtcbn1cblxuLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbi8vIFJlcHJlc2VudGF0aW9ucyBmb3IgY2FyZHNcbi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbi8vIEBGSVhNRTogaWYgdGhlcmUgaXNuJ3QgYW4gSUQgaGVyZSwgbWljcm9SZWFjdCBkb2VzIHRoZSB3cm9uZyB0aGluZywgaW52ZXN0aWdhdGVcbi8vIGFmdGVyIHRoZSByZWxlYXNlXG5leHBvcnQgZnVuY3Rpb24gY2FyZChlbGVtOkVsZW1lbnQpIHtcbiAgZWxlbS5jID0gYGNhcmQgJHtlbGVtLmMgfHwgXCJcIn1gO1xuICByZXR1cm4gZWxlbTtcbn1cblxuZnVuY3Rpb24gdG9nZ2xlQWRkVGlsZShldmVudCwgZWxlbSkge1xuICBkaXNwYXRjaChcInRvZ2dsZSBhZGQgdGlsZVwiLCB7a2V5OiBlbGVtLmtleSwgZW50aXR5SWQ6IGVsZW0uZW50aXR5SWR9KS5jb21taXQoKTtcbn1cblxuZnVuY3Rpb24gc2V0VGlsZUFkZGVyKGV2ZW50LCBlbGVtKSB7XG4gIGRpc3BhdGNoKFwic2V0IHRpbGUgYWRkZXJcIiwge2tleTogZWxlbS5rZXksIGFkZGVyOiBlbGVtLmFkZGVyfSkuY29tbWl0KCk7XG59XG5cbmZ1bmN0aW9uIGNsb3NlQ2FyZChldmVudCwgZWxlbSkge1xuICBkaXNwYXRjaChcImNsb3NlIGNhcmRcIiwge3BhbmVJZDogZWxlbS5wYW5lSWR9KS5jb21taXQoKTtcbn1cblxuZnVuY3Rpb24gbmF2aWdhdGVSb290KGV2ZW50LCBlbGVtKSB7XG4gIGxldCByb290ID0gZXZlLmZpbmRPbmUoXCJ1aSBwYW5lXCIsIHtraW5kOiBQQU5FLkZVTEx9KVtcInBhbmVcIl07XG4gIGRpc3BhdGNoKFwic2V0IHBhbmVcIiwge3BhbmVJZDogcm9vdCwgY29udGFpbnM6IGVsZW0uZW50aXR5SWR9KS5jb21taXQoKTtcbn1cblxuaW50ZXJmYWNlIEVudGl0eUVkaXRvckVsZW0gZXh0ZW5kcyBFbnRpdHlFbGVtIHsgZWRpdG9yOiBDb2RlTWlycm9yLkVkaXRvciB9XG5leHBvcnQgZnVuY3Rpb24gZW50aXR5KGVsZW06RW50aXR5RWRpdG9yRWxlbSkge1xuICBsZXQgZW50aXR5SWQgPSBlbGVtLmVudGl0eTtcbiAgbGV0IHBhbmVJZCA9IGVsZW0uZGF0YS5wYW5lSWQ7XG4gIGxldCBrZXkgPSBlbGVtLmtleSB8fCBgJHtlbnRpdHlJZH18JHtwYW5lSWR9YDtcbiAgbGV0IHN0YXRlID0gX3N0YXRlLndpZGdldC5jYXJkW2tleV0gfHwge307XG4gIGxldCBuYW1lID0gZXZlLmZpbmRPbmUoXCJkaXNwbGF5IG5hbWVcIiwge2lkOiBhc0VudGl0eShlbnRpdHlJZCl9KS5uYW1lO1xuICBsZXQgYXR0cnMgPSBlbnRpdHlUaWxlc1VJKGVudGl0eUlkLCBwYW5lSWQsIGtleSk7XG4gIGF0dHJzLmMgKz0gXCIgcGFnZS1hdHRyaWJ1dGVzXCI7XG4gIC8vIGxldCBlZGl0b3IgPSBwYWdlRWRpdG9yKGVudGl0eUlkLCBwYW5lSWQsIGVsZW0uZWRpdG9yKTtcbiAgbGV0IGFkZGVyID0gdGlsZUFkZGVyKHtlbnRpdHlJZCwga2V5fSk7XG4gIHJldHVybiB7YzogYGVudGl0eSAke3N0YXRlLnNob3dBZGQgPyBcImFkZGluZ1wiIDogXCJcIn1gLCBjaGlsZHJlbjogW1xuICAgIHtjOiBcImhlYWRlclwiLCBjaGlsZHJlbjogW1xuICAgICAge3RleHQ6IG5hbWV9LFxuICAgICAge2M6IFwiZmxleC1ncm93IHNwYWNlclwifSxcbiAgICAgIHtjOiBgY29udHJvbCBpb24taW9zLXVwbG9hZC1vdXRsaW5lYCwgY2xpY2s6IG5hdmlnYXRlUm9vdCwgZW50aXR5SWR9LFxuICAgICAge2M6IGBjb250cm9sICR7c3RhdGUuc2hvd0FkZCA/IFwiaW9uLWFuZHJvaWQtcmVtb3ZlXCIgOiBcImlvbi1hbmRyb2lkLWFkZFwifSBhZGQtdGlsZWAsIGNsaWNrOiB0b2dnbGVBZGRUaWxlLCBrZXksIGVudGl0eUlkfSxcbiAgICAgIHtjOiBcImNvbnRyb2wgaW9uLWFuZHJvaWQtY2xvc2VcIiwgY2xpY2s6IGNsb3NlQ2FyZCwgcGFuZUlkfSxcbiAgICBdfSxcbiAgICBhZGRlcixcbiAgICBhdHRycyxcbiAgICAvLyBlZGl0b3IsXG4gIF19O1xufVxuXG52YXIgbWVhc3VyZVNwYW4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3BhblwiKTtcbm1lYXN1cmVTcGFuLmNsYXNzTmFtZSA9IFwibWVhc3VyZS1zcGFuXCI7XG5kb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKG1lYXN1cmVTcGFuKTtcblxuZXhwb3J0IGZ1bmN0aW9uIGF1dG9zaXplSW5wdXQobm9kZSwgZWxlbSkge1xuICBsZXQgbWluV2lkdGggPSA1MDtcbiAgbWVhc3VyZVNwYW4uc3R5bGUuZm9udFNpemUgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShub2RlLCBudWxsKVtcImZvbnQtc2l6ZVwiXTtcbiAgbWVhc3VyZVNwYW4udGV4dENvbnRlbnQgPSBub2RlLnZhbHVlO1xuICBsZXQgbWVhc3VyZWRXaWR0aCA9IG1lYXN1cmVTcGFuLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLndpZHRoO1xuICBub2RlLnN0eWxlLndpZHRoID0gTWF0aC5jZWlsKE1hdGgubWF4KG1pbldpZHRoLCBtZWFzdXJlZFdpZHRoKSkgKyA1ICsgXCJweFwiO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gYXV0b3NpemVBbmRGb2N1cyhub2RlLCBlbGVtKSB7XG4gIGF1dG9zaXplSW5wdXQobm9kZSwgZWxlbSk7XG4gIGF1dG9Gb2N1cyhub2RlLCBlbGVtKTtcbn1cblxuZnVuY3Rpb24gdHJhY2tQcm9wZXJ0eUFkZGVySW5wdXQoZXZlbnQsIGVsZW0pIHtcbiAgbGV0IHZhbHVlID0gZXZlbnQuY3VycmVudFRhcmdldC52YWx1ZTtcbiAgZGlzcGF0Y2goXCJzZXQgdGlsZSBhZGRlciBhdHRyaWJ1dGVcIiwge2tleTogZWxlbS5rZXksIGF0dHJpYnV0ZTogZWxlbS5hdHRyaWJ1dGUsIHZhbHVlfSkuY29tbWl0KCk7XG4gIGlmKGV2ZW50LmN1cnJlbnRUYXJnZXQubm9kZU5hbWUgPT09IFwiSU5QVVRcIikge1xuICAgIGF1dG9zaXplSW5wdXQoZXZlbnQuY3VycmVudFRhcmdldCwgZWxlbSk7XG4gIH1cbn1cblxuZnVuY3Rpb24gYWRkZXJLZXlzKGV2ZW50LCBlbGVtKSB7XG4gIGlmKGV2ZW50LmtleUNvZGUgPT09IEtFWVMuRU5URVIpIHtcbiAgICBkaXNwYXRjaChcInN1Ym1pdCB0aWxlIGFkZGVyXCIsIHtrZXk6IGVsZW0ua2V5LCBub2RlOiBldmVudC5jdXJyZW50VGFyZ2V0fSkuY29tbWl0KCk7XG4gIH0gZWxzZSBpZihldmVudC5rZXlDb2RlID09PSBLRVlTLkVTQykge1xuICAgIGRpc3BhdGNoKFwidG9nZ2xlIGFkZCB0aWxlXCIsIHtrZXk6IGVsZW0ua2V5fSkuY29tbWl0KCk7XG4gIH1cbn1cblxuZnVuY3Rpb24gc3VibWl0QWRkZXIoZXZlbnQsIGVsZW0pIHtcbiAgLy8gQEhBQ0s6IHllYWguLi5cbiAgZGlzcGF0Y2goXCJzdWJtaXQgdGlsZSBhZGRlclwiLCB7a2V5OiBlbGVtLmtleSwgbm9kZTogZXZlbnQuY3VycmVudFRhcmdldC5wYXJlbnROb2RlLnBhcmVudE5vZGUuZmlyc3RDaGlsZC5maXJzdENoaWxkfSkuY29tbWl0KCk7XG59XG5cbmZ1bmN0aW9uIHN1Ym1pdFByb3BlcnR5KGFkZGVyLCBzdGF0ZSwgbm9kZSkge1xuICBpZihzdGF0ZS5wcm9wZXJ0eVByb3BlcnR5ID09PSB1bmRlZmluZWQgfHwgc3RhdGUucHJvcGVydHlWYWx1ZSA9PT0gdW5kZWZpbmVkKSByZXR1cm47XG4gIGRpc3BhdGNoKFwiYWRkIHNvdXJjZWQgZWF2XCIsIHtlbnRpdHk6IHN0YXRlLmVudGl0eUlkLCBhdHRyaWJ1dGU6IHN0YXRlLnByb3BlcnR5UHJvcGVydHksIHZhbHVlOiBzdGF0ZS5wcm9wZXJ0eVZhbHVlLCBmb3JjZUVudGl0eTogdHJ1ZX0pLmNvbW1pdCgpO1xuICBzdGF0ZS5wcm9wZXJ0eVZhbHVlID0gdW5kZWZpbmVkO1xuICBzdGF0ZS5wcm9wZXJ0eVByb3BlcnR5ID0gdW5kZWZpbmVkO1xuICAvL21ha2Ugc3VyZSB0aGUgZm9jdXMgaXMgaW4gdGhlIHZhbHVlXG4gIG5vZGUucGFyZW50Tm9kZS5maXJzdENoaWxkLmZvY3VzKCk7XG59XG5cbmZ1bmN0aW9uIHByb3BlcnR5QWRkZXJVSShlbGVtKSB7XG4gIGxldCB7ZW50aXR5SWQsIGtleX0gPSBlbGVtO1xuICBsZXQgc3RhdGUgPSBfc3RhdGUud2lkZ2V0LmNhcmRba2V5XSB8fCB7fTtcbiAgcmV0dXJuIHtjOiBcInByb3BlcnR5LWFkZGVyXCIsIGNoaWxkcmVuOiBbXG4gICAge2NoaWxkcmVuOiBbXG4gICAgICB7YzogXCJ0aWxlIHNtYWxsXCIsIGNoaWxkcmVuOiBbXG4gICAgICAgIHtjOiBcInRpbGUtY29udGVudC13cmFwcGVyXCIsIGNoaWxkcmVuOiBbXG4gICAgICAgICAge3Q6IFwiaW5wdXRcIiwgYzogXCJwcm9wZXJ0eVwiLCBwbGFjZWhvbGRlcjogXCJwcm9wZXJ0eVwiLCB2YWx1ZTogc3RhdGUucHJvcGVydHlQcm9wZXJ0eSB8fCBcIlwiLCBhdHRyaWJ1dGU6IFwicHJvcGVydHlQcm9wZXJ0eVwiLCBpbnB1dDogdHJhY2tQcm9wZXJ0eUFkZGVySW5wdXQsIHBvc3RSZW5kZXI6IGF1dG9zaXplQW5kRm9jdXMsIGtleWRvd246IGFkZGVyS2V5cywgZW50aXR5SWQsIGtleX0sXG4gICAgICAgICAge3Q6IFwiaW5wdXRcIiwgYzogXCJ2YWx1ZVwiLCBwbGFjZWhvbGRlcjogXCJ2YWx1ZVwiLCB2YWx1ZTogc3RhdGUucHJvcGVydHlWYWx1ZSB8fCBcIlwiLCBhdHRyaWJ1dGU6IFwicHJvcGVydHlWYWx1ZVwiLCBpbnB1dDogdHJhY2tQcm9wZXJ0eUFkZGVySW5wdXQsIHBvc3RSZW5kZXI6IGF1dG9zaXplSW5wdXQsIGtleWRvd246IGFkZGVyS2V5cywgZW50aXR5SWQsIGtleX0sXG4gICAgICAgIF19LFxuICAgICAgICB7YzogXCJjb250cm9scyBmbGV4LXJvd1wiLCBjaGlsZHJlbjogW1xuICAgICAgICAgIHtjOiBcImlvbi1jaGVja21hcmsgc3VibWl0XCIsIGNsaWNrOiBzdWJtaXRBZGRlciwga2V5fSxcbiAgICAgICAgICB7YzogXCJpb24tY2xvc2UgY2FuY2VsXCIsIGNsaWNrOiBzZXRUaWxlQWRkZXIsIGtleX0sXG4gICAgICAgIF19XG4gICAgICBdfVxuICAgIF19XG4gIF19O1xufVxuXG5mdW5jdGlvbiBkZXNjcmlwdGlvbkFkZGVyVUkoZWxlbSkge1xuICBsZXQge2VudGl0eUlkLCBrZXl9ID0gZWxlbTtcbiAgbGV0IHN0YXRlID0gX3N0YXRlLndpZGdldC5jYXJkW2tleV0gfHwge307XG4gIHJldHVybiB7YzogXCJwcm9wZXJ0eS1hZGRlciBkZXNjcmlwdGlvbi1hZGRlclwiLCBjaGlsZHJlbjogW1xuICAgIHtjaGlsZHJlbjogW1xuICAgICAge2M6IFwidGlsZSBmdWxsXCIsIGNoaWxkcmVuOiBbXG4gICAgICAgIHtjOiBcInRpbGUtY29udGVudC13cmFwcGVyXCIsIGNoaWxkcmVuOiBbXG4gICAgICAgICAge3Q6IFwidGV4dGFyZWFcIiwgYzogXCJ2YWx1ZVwiLCBwbGFjZWhvbGRlcjogXCJkZXNjcmlwdGlvblwiLCB2YWx1ZTogc3RhdGUuZGVzY3JpcHRpb25WYWx1ZSwgYXR0cmlidXRlOiBcImRlc2NyaXB0aW9uVmFsdWVcIiwgaW5wdXQ6IHRyYWNrUHJvcGVydHlBZGRlcklucHV0LCBwb3N0UmVuZGVyOiBhdXRvRm9jdXMsIGtleWRvd246IGFkZGVyS2V5cywgZW50aXR5SWQsIGtleX0sXG4gICAgICAgIF19LFxuICAgICAgICB7YzogXCJjb250cm9scyBmbGV4LXJvd1wiLCBjaGlsZHJlbjogW1xuICAgICAgICAgIHtjOiBcImlvbi1jaGVja21hcmsgc3VibWl0XCIsIGNsaWNrOiBzdWJtaXRBZGRlciwga2V5fSxcbiAgICAgICAgICB7YzogXCJpb24tY2xvc2UgY2FuY2VsXCIsIGNsaWNrOiBzZXRUaWxlQWRkZXIsIGtleX0sXG4gICAgICAgIF19XG4gICAgICBdfSxcbiAgICBdfVxuICBdfTtcbn1cblxuZnVuY3Rpb24gc3VibWl0RGVzY3JpcHRpb24oYWRkZXIsIHN0YXRlLCBub2RlKSB7XG4gIGxldCBjaGFpbiA9IGRpc3BhdGNoKFwiYWRkIHNvdXJjZWQgZWF2XCIsIHtlbnRpdHk6IHN0YXRlLmVudGl0eUlkLCBhdHRyaWJ1dGU6IFwiZGVzY3JpcHRpb25cIiwgdmFsdWU6IHN0YXRlLmRlc2NyaXB0aW9uVmFsdWV9KTtcbiAgc3RhdGUuZGVzY3JpcHRpb25WYWx1ZSA9IFwiXCI7XG4gIGNoYWluLmRpc3BhdGNoKFwidG9nZ2xlIGFkZCB0aWxlXCIsIHtrZXk6IHN0YXRlLmtleX0pLmNvbW1pdCgpO1xufVxuXG5mdW5jdGlvbiBhdXRvc2l6ZUFuZFN0b3JlTGlzdFRpbGVJdGVtKGV2ZW50LCBlbGVtKSB7XG4gIGxldCBub2RlID0gZXZlbnQuY3VycmVudFRhcmdldDtcbiAgZGlzcGF0Y2goXCJhZGQgYWN0aXZlIHRpbGUgaXRlbVwiLCB7Y2FyZElkOiBlbGVtLmNhcmRJZCwgYXR0cmlidXRlOiBlbGVtLnN0b3JlQXR0cmlidXRlLCB0aWxlSWQ6IGVsZW0udGlsZUlkLCBpZDogZWxlbS5zdG9yZUlkLCB2YWx1ZTogbm9kZS52YWx1ZX0pLmNvbW1pdCgpO1xuICBhdXRvc2l6ZUlucHV0KG5vZGUsIGVsZW0pO1xufVxuXG5mdW5jdGlvbiBjb2xsZWN0aW9uVGlsZUFkZGVyKGVsZW0pIHtcbiAgbGV0IHt2YWx1ZXMsIGRhdGEsIHRpbGVJZCwgYXR0cmlidXRlLCBjYXJkSWQsIGVudGl0eUlkLCBmb3JjZUFjdGl2ZSwgcmV2ZXJzZUVudGl0eUFuZFZhbHVlLCBub1Byb3BlcnR5LCByZXA9XCJ2YWx1ZVwiLCBjOmtsYXNzPVwiXCJ9ID0gZWxlbTtcbiAgdGlsZUlkID0gdGlsZUlkIHx8IGF0dHJpYnV0ZTtcbiAgbGV0IHN0YXRlID0gX3N0YXRlLndpZGdldC5jYXJkW2NhcmRJZF0gfHwge307XG4gIGxldCBsaXN0Q2hpbGRyZW4gPSBbXTtcbiAgbGV0IGFkZGVkID0gKHN0YXRlLmFjdGl2ZVRpbGUgPyBzdGF0ZS5hY3RpdmVUaWxlLml0ZW1zVG9BZGQgOiBmYWxzZSkgfHwgW107XG4gIGxldCBpeCA9IDA7XG4gIGZvcihsZXQgYWRkIG9mIGFkZGVkKSB7XG4gICAgbGlzdENoaWxkcmVuLnB1c2goe2M6IFwidmFsdWVcIiwgY2hpbGRyZW46IFtcbiAgICAgIHt0OiBcImlucHV0XCIsIHBsYWNlaG9sZGVyOiBcImFkZFwiLCB2YWx1ZTogYWRkLCBhdHRyaWJ1dGUsIGVudGl0eUlkLCBzdG9yZUF0dHJpYnV0ZTogXCJpdGVtc1RvQWRkXCIsIHN0b3JlSWQ6IGl4LCBjYXJkSWQsIGlucHV0OiBhdXRvc2l6ZUFuZFN0b3JlTGlzdFRpbGVJdGVtLCBwb3N0UmVuZGVyOiBhdXRvc2l6ZUFuZEZvY3VzLCBrZXlkb3duOiBhZGRlcktleXMsIGtleTogY2FyZElkfVxuICAgIF19KTtcbiAgICBpeCsrO1xuICB9XG4gIGxpc3RDaGlsZHJlbi5wdXNoKHtjOiBcInZhbHVlXCIsIGNoaWxkcmVuOiBbXG4gICAge3Q6IFwiaW5wdXRcIiwgcGxhY2Vob2xkZXI6IFwiYWRkIGl0ZW1cIiwgdmFsdWU6IFwiXCIsIGF0dHJpYnV0ZSwgZW50aXR5SWQsIHN0b3JlQXR0cmlidXRlOiBcIml0ZW1zVG9BZGRcIiwgc3RvcmVJZDogaXgsIGNhcmRJZCwgaW5wdXQ6IGF1dG9zaXplQW5kU3RvcmVMaXN0VGlsZUl0ZW0sIHBvc3RSZW5kZXI6IGl4ID09PSAwID8gYXV0b3NpemVBbmRGb2N1cyA6IGF1dG9zaXplSW5wdXQsIGtleWRvd246IGFkZGVyS2V5cywga2V5OiBjYXJkSWR9XG4gIF19KTtcbiAgbGV0IHNpemUgPSBcImZ1bGxcIjtcbiAgbGV0IHRpbGVDaGlsZHJlbiA9IFtdO1xuICB0aWxlQ2hpbGRyZW4ucHVzaCh7dDogXCJpbnB1dFwiLCBjOiBcInByb3BlcnR5XCIsIHBsYWNlaG9sZGVyOiBgY29sbGVjdGlvbiBuYW1lYCwgYXR0cmlidXRlOiBcImNvbGxlY3Rpb25Qcm9wZXJ0eVwiLCB2YWx1ZTogc3RhdGUuY29sbGVjdGlvblByb3BlcnR5LCBpbnB1dDogdHJhY2tQcm9wZXJ0eUFkZGVySW5wdXQsIGtleTogY2FyZElkfSk7XG4gIHRpbGVDaGlsZHJlbi5wdXNoKHtjOiBcImxpc3RcIiwgY2hpbGRyZW46IGxpc3RDaGlsZHJlbn0pO1xuICByZXR1cm4ge2M6IFwicHJvcGVydHktYWRkZXIgY29sbGVjdGlvbi1hZGRlclwiLCBjaGlsZHJlbjogW1xuICAgIHtjaGlsZHJlbjogW1xuICAgICAge2M6IFwidGlsZSBmdWxsXCIsIGNoaWxkcmVuOiBbXG4gICAgICAgIHtjOiBcInRpbGUtY29udGVudC13cmFwcGVyXCIsIGNoaWxkcmVuOiB0aWxlQ2hpbGRyZW59LFxuICAgICAgICB7YzogXCJjb250cm9scyBmbGV4LXJvd1wiLCBjaGlsZHJlbjogW1xuICAgICAgICAgIHtjOiBcImlvbi1jaGVja21hcmsgc3VibWl0XCIsIGNsaWNrOiBzdWJtaXRBZGRlciwga2V5OiBjYXJkSWR9LFxuICAgICAgICAgIHtjOiBcImlvbi1jbG9zZSBjYW5jZWxcIiwgY2xpY2s6IHNldFRpbGVBZGRlciwga2V5OiBjYXJkSWR9LFxuICAgICAgICBdfVxuICAgICAgXX0sXG4gICAgXX1cbiAgXX07XG59XG5cbmZ1bmN0aW9uIGNvbGxlY3Rpb25BZGRlclVJKGVsZW0pIHtcbiAgbGV0IHtlbnRpdHlJZCwga2V5fSA9IGVsZW07XG4gIGxldCBzdGF0ZSA9IF9zdGF0ZS53aWRnZXQuY2FyZFtrZXldIHx8IHt9O1xuICBsZXQgdGlsZSA9IGNvbGxlY3Rpb25UaWxlQWRkZXIoe3ZhbHVlczogW10sIGNhcmRJZDoga2V5LCBlbnRpdHlJZCwgZm9yY2VBY3RpdmU6IHRydWUsIHRpbGVJZDogXCJjb2xsZWN0aW9uQWRkZXJcIiwgZGF0YToge30sIG5vUHJvcGVydHk6IHRydWUsIH0pO1xuICByZXR1cm4gdGlsZTtcbn1cblxuZnVuY3Rpb24gc3VibWl0Q29sbGVjdGlvbihhZGRlciwgc3RhdGUsIG5vZGUpIHtcbiAgbGV0IGNoYWluO1xuICAvLyBkZXRlcm1pbmUgd2hldGhlciB0aGlzIGlzIG1ha2luZyB0aGUgY3VycmVudCBlbnRpdHkgYSBjb2xsZWN0aW9uLCBvciBpZiB0aGlzIGlzIGp1c3QgYSBub3JtYWwgY29sbGVjdGlvbi5cbiAgaWYoIXN0YXRlLmNvbGxlY3Rpb25Qcm9wZXJ0eSB8fCBwbHVyYWxpemUoc3RhdGUuY29sbGVjdGlvblByb3BlcnR5LnRyaW0oKSwgMSkudG9Mb3dlckNhc2UoKSA9PT0gcmVzb2x2ZU5hbWUoc3RhdGUuZW50aXR5SWQpLnRvTG93ZXJDYXNlKCkpIHtcbiAgICAvLyB0aGlzIGlzIHR1cm5pbmcgdGhlIGN1cnJlbnQgZW50aXR5IGludG8gYSBjb2xsZWN0aW9uXG4gICAgY2hhaW4gPSBkaXNwYXRjaChcInN1Ym1pdCBsaXN0IHRpbGVcIiwge2NhcmRJZDogc3RhdGUua2V5LCBhdHRyaWJ1dGU6IFwiaXMgYVwiLCBlbnRpdHlJZDogc3RhdGUuZW50aXR5SWQsIHJldmVyc2VFbnRpdHlBbmRWYWx1ZTogdHJ1ZX0pO1xuICB9IGVsc2Uge1xuICAgIGNoYWluID0gZGlzcGF0Y2goXCJzdWJtaXQgbGlzdCB0aWxlXCIsIHtjYXJkSWQ6IHN0YXRlLmtleSwgYXR0cmlidXRlOiBzdGF0ZS5jb2xsZWN0aW9uUHJvcGVydHksIGVudGl0eUlkOiBzdGF0ZS5lbnRpdHlJZCwgcmV2ZXJzZUVudGl0eUFuZFZhbHVlOiBmYWxzZX0pO1xuICB9XG4gIHN0YXRlLmNvbGxlY3Rpb25Qcm9wZXJ0eSA9IHVuZGVmaW5lZDtcbiAgY2hhaW4uZGlzcGF0Y2goXCJ0b2dnbGUgYWRkIHRpbGVcIiwge2tleTogc3RhdGUua2V5fSkuY29tbWl0KCk7XG4gIGNvbnNvbGUubG9nKEpTT04uc3RyaW5naWZ5KHN0YXRlKSk7XG59XG5cbmZ1bmN0aW9uIGltYWdlQWRkZXJVSShlbGVtKSB7XG4gIGxldCB7ZW50aXR5SWQsIGtleX0gPSBlbGVtO1xuICBsZXQgc3RhdGUgPSBfc3RhdGUud2lkZ2V0LmNhcmRba2V5XSB8fCB7fTtcbiAgcmV0dXJuIHtjOiBcInByb3BlcnR5LWFkZGVyIGltYWdlLWFkZGVyXCIsIGNoaWxkcmVuOiBbXG4gICAge2NoaWxkcmVuOiBbXG4gICAgICB7YzogXCJ0aWxlIHNtYWxsXCIsIGNoaWxkcmVuOiBbXG4gICAgICAgIHtjOiBcInRpbGUtY29udGVudC13cmFwcGVyXCIsIGNoaWxkcmVuOiBbXG4gICAgICAgICAge3Q6IFwiaW5wdXRcIiwgYzogXCJ2YWx1ZVwiLCBwbGFjZWhvbGRlcjogXCJpbWFnZSB1cmxcIiwgdmFsdWU6IHN0YXRlLmltYWdlVmFsdWUsIGF0dHJpYnV0ZTogXCJpbWFnZVZhbHVlXCIsIGlucHV0OiB0cmFja1Byb3BlcnR5QWRkZXJJbnB1dCwgcG9zdFJlbmRlcjogYXV0b3NpemVBbmRGb2N1cywga2V5ZG93bjogYWRkZXJLZXlzLCBlbnRpdHlJZCwga2V5fSxcbiAgICAgICAgXX0sXG4gICAgICAgIHtjOiBcImNvbnRyb2xzIGZsZXgtcm93XCIsIGNoaWxkcmVuOiBbXG4gICAgICAgICAge2M6IFwiaW9uLWNoZWNrbWFyayBzdWJtaXRcIiwgY2xpY2s6IHN1Ym1pdEFkZGVyLCBrZXl9LFxuICAgICAgICAgIHtjOiBcImlvbi1jbG9zZSBjYW5jZWxcIiwgY2xpY2s6IHNldFRpbGVBZGRlciwga2V5fSxcbiAgICAgICAgXX1cbiAgICAgIF19XG4gICAgXX1cbiAgXX07XG59XG5cbmZ1bmN0aW9uIHN1Ym1pdEltYWdlKGFkZGVyLCBzdGF0ZSwgbm9kZSkge1xuICBsZXQgY2hhaW4gPSBkaXNwYXRjaChcImFkZCBzb3VyY2VkIGVhdlwiLCB7ZW50aXR5OiBzdGF0ZS5lbnRpdHlJZCwgYXR0cmlidXRlOiBcImltYWdlXCIsIHZhbHVlOiBgXCIke3N0YXRlLmltYWdlVmFsdWV9XCJgfSk7XG4gIHN0YXRlLmltYWdlVmFsdWUgPSB1bmRlZmluZWQ7XG4gIGNoYWluLmRpc3BhdGNoKFwidG9nZ2xlIGFkZCB0aWxlXCIsIHtrZXk6IHN0YXRlLmtleX0pLmNvbW1pdCgpO1xufVxuXG5cbmZ1bmN0aW9uIGNvbWluZ1Nvb25BZGRlclVJKGVsZW0pIHtcbiAgbGV0IHtlbnRpdHlJZCwga2V5fSA9IGVsZW07XG4gIGxldCBzdGF0ZSA9IF9zdGF0ZS53aWRnZXQuY2FyZFtrZXldIHx8IHt9O1xuICByZXR1cm4ge2M6IFwicHJvcGVydHktYWRkZXJcIiwgY2hpbGRyZW46IFtcbiAgICB7Y2hpbGRyZW46IFtcbiAgICAgIHtjOiBcInRpbGUgc21hbGxcIiwgY2hpbGRyZW46IFtcbiAgICAgICAge2M6IFwidGlsZS1jb250ZW50LXdyYXBwZXJcIiwgY2hpbGRyZW46IFtcbiAgICAgICAgICB7dGV4dDogXCJUaGlzIHRpbGUgdHlwZSBpcyBjb21pbmcgc29vbi5cIn1cbiAgICAgICAgXX0sXG4gICAgICAgIHtjOiBcImNvbnRyb2xzIGZsZXgtcm93XCIsIGNoaWxkcmVuOiBbXG4gICAgICAgICAge2M6IFwiaW9uLWNsb3NlIGNhbmNlbFwiLCBjbGljazogc2V0VGlsZUFkZGVyLCBrZXl9LFxuICAgICAgICBdfVxuICAgICAgXX1cbiAgICBdfVxuICBdfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHRpbGVBZGRlcihlbGVtKSB7XG4gIGxldCB7ZW50aXR5SWQsIGtleX0gPSBlbGVtO1xuICBsZXQgc3RhdGUgPSBfc3RhdGUud2lkZ2V0LmNhcmRba2V5XSB8fCB7fTtcbiAgbGV0IHJvd3MgPSBbXTtcbiAgbGV0IGtsYXNzID0gXCJcIjtcbiAgaWYoIXN0YXRlLmFkZGVyKSB7XG4gICAgbGV0IGFkZGVycyA9IFtcbiAgICAgIHtuYW1lOiBcIlByb3BlcnR5XCIsIGljb246IFwiaW9uLWNvbXBvc2VcIiwgdWk6IHByb3BlcnR5QWRkZXJVSSwgc3VibWl0OiBzdWJtaXRQcm9wZXJ0eX0sXG4gICAgICB7bmFtZTogXCJEZXNjcmlwdGlvblwiLCBpY29uOiBcImlvbi1kcmFnXCIsIHVpOiBkZXNjcmlwdGlvbkFkZGVyVUksIHN1Ym1pdDogc3VibWl0RGVzY3JpcHRpb259LFxuICAgICAge25hbWU6IFwiQ29sbGVjdGlvblwiLCBrbGFzczogXCJjb2xsZWN0aW9uXCIsIGljb246IFwiaW9uLWlvcy1saXN0LW91dGxpbmVcIiwgdWk6IGNvbGxlY3Rpb25BZGRlclVJLCBzdWJtaXQ6IHN1Ym1pdENvbGxlY3Rpb259LFxuICAgICAge25hbWU6IFwiSW1hZ2VcIiwgaWNvbjogXCJpb24taW1hZ2VcIiwgdWk6IGltYWdlQWRkZXJVSSwgc3VibWl0OiBzdWJtaXRJbWFnZX0sXG4gICAgICB7bmFtZTogXCJEb2N1bWVudFwiLCBpY29uOiBcImlvbi1kb2N1bWVudFwiLCB1aTogY29taW5nU29vbkFkZGVyVUl9LFxuICAgICAge25hbWU6IFwiQ29tcHV0ZWRcIiwgaWNvbjogXCJpb24tY2FsY3VsYXRvclwiLCB1aTogY29taW5nU29vbkFkZGVyVUl9LFxuICAgIF07XG4gICAgbGV0IGNvdW50ID0gMDtcbiAgICBsZXQgY3VyUm93ID0ge2M6IFwicm93IGZsZXgtcm93XCIsIGNoaWxkcmVuOiBbXX07XG4gICAgZm9yKGxldCBhZGRlciBvZiBhZGRlcnMpIHtcbiAgICAgIGN1clJvdy5jaGlsZHJlbi5wdXNoKHtjOiBcInRpbGUgc21hbGxcIiwgYWRkZXIsIGtleSwgY2xpY2s6IHNldFRpbGVBZGRlciwgY2hpbGRyZW46IFtcbiAgICAgICAge2M6IFwidGlsZS1jb250ZW50LXdyYXBwZXJcIiwgY2hpbGRyZW46IFtcbiAgICAgICAgICB7YzogXCJwcm9wZXJ0eVwiLCB0ZXh0OiBhZGRlci5uYW1lfSxcbiAgICAgICAgICB7YzogYHZhbHVlICR7YWRkZXIuaWNvbn1gfSxcbiAgICAgICAgXX1cbiAgICAgIF19KTtcbiAgICAgIGNvdW50Kys7XG4gICAgICBpZihjdXJSb3cuY2hpbGRyZW4ubGVuZ3RoID09PSAzIHx8IGNvdW50ID09PSBhZGRlcnMubGVuZ3RoKSB7XG4gICAgICAgIHJvd3MucHVzaChjdXJSb3cpO1xuICAgICAgICBjdXJSb3cgPSB7YzogXCJyb3cgZmxleC1yb3dcIiwgY2hpbGRyZW46IFtdfTtcbiAgICAgIH1cbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgbGV0IGFkZGVyRWxlbSA9IHtlbnRpdHlJZCwga2V5fTtcbiAgICBpZihzdGF0ZS5hZGRlci51aSkge1xuICAgICAgcm93cy5wdXNoKHN0YXRlLmFkZGVyLnVpKGFkZGVyRWxlbSkpO1xuICAgIH1cbiAgICBrbGFzcyA9IHN0YXRlLmFkZGVyLmtsYXNzIHx8IFwiXCI7XG4gIH1cbiAgcmV0dXJuIHtjOiBgdGlsZS1hZGRlciAke2tsYXNzfWAsIGNoaWxkcmVuOiByb3dzfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHBhZ2VFZGl0b3IoZW50aXR5SWQ6c3RyaW5nLCBwYW5lSWQ6c3RyaW5nLCBlbGVtKTpFbGVtZW50IHtcbiAgbGV0IHtjb250ZW50ID0gdW5kZWZpbmVkfSA9IGV2ZS5maW5kT25lKFwiZW50aXR5XCIsIHtlbnRpdHk6IGVudGl0eUlkfSkgfHwge307XG4gIGxldCBwYWdlID0gZXZlLmZpbmRPbmUoXCJlbnRpdHkgcGFnZVwiLCB7ZW50aXR5OiBlbnRpdHlJZH0pW1wicGFnZVwiXTtcbiAgbGV0IG5hbWUgPSByZXNvbHZlTmFtZShlbnRpdHlJZCk7XG4gIGVsZW0uYyA9IGB3aWtpLWVkaXRvciAke2VsZW0uYyB8fCBcIlwifWA7XG4gIGVsZW0ubWV0YSA9IHtlbnRpdHlJZDogZW50aXR5SWQsIHBhZ2UsIHBhbmVJZH07XG4gIGVsZW0ub3B0aW9ucy5ub0ZvY3VzID0gdHJ1ZTtcbiAgZWxlbS52YWx1ZSA9IGNvbnRlbnQ7XG4gIGVsZW0uY2hpbGRyZW4gPSBlbGVtLmNlbGxJdGVtcztcbiAgcmV0dXJuIGVsZW07XG59XG5cbi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4vLyBSZXByZXNlbnRhdGlvbnMgZm9yIEVycm9yc1xuLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuZXhwb3J0IGZ1bmN0aW9uIGVycm9yKGVsZW0pOkVsZW1lbnQge1xuICBlbGVtLmMgPSBgZXJyb3ItcmVwICR7ZWxlbS5jIHx8IFwiXCJ9YDtcbiAgcmV0dXJuIGVsZW07XG59XG5cbi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4vLyBSZXByZXNlbnRhdGlvbnMgZm9yIEVudGl0aWVzXG4vLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuaW50ZXJmYWNlIEVudGl0eUVsZW0gZXh0ZW5kcyBFbGVtZW50IHsgZW50aXR5OiBzdHJpbmcsIGRhdGE/OiBhbnkgfVxuXG5leHBvcnQgZnVuY3Rpb24gbmFtZShlbGVtOkVudGl0eUVsZW0pOkVsZW1lbnQge1xuICBsZXQge2VudGl0eX0gPSBlbGVtO1xuICBsZXQge25hbWUgPSBlbnRpdHl9ID0gZXZlLmZpbmRPbmUoXCJkaXNwbGF5IG5hbWVcIiwge2lkOiBlbnRpdHl9KSB8fCB7fTtcbiAgZWxlbS50ZXh0ID0gbmFtZTtcbiAgZWxlbS5jID0gYGVudGl0eSAke2VsZW0uYyB8fCBcIlwifWA7XG4gIHJldHVybiBlbGVtO1xufVxuXG5pbnRlcmZhY2UgTGlua0VsZW0gZXh0ZW5kcyBFbnRpdHlFbGVtIHsgbmFtZUFzQ2hpbGQ/OmJvb2xlYW4gfVxuZXhwb3J0IGZ1bmN0aW9uIGxpbmsoZWxlbTpMaW5rRWxlbSk6RWxlbWVudCB7XG4gIGxldCB7ZW50aXR5fSA9IGVsZW07XG4gIGxldCBuYW1lID0gcmVzb2x2ZU5hbWUoZW50aXR5KTtcbiAgZWxlbS5jID0gYCR7ZWxlbS5jIHx8IFwiXCJ9IGVudGl0eSBsaW5rIGlubGluZWA7XG4gIGlmKCFlbGVtW1wibmFtZUFzQ2hpbGRcIl0pIHtcbiAgICBlbGVtLnRleHQgPSBlbGVtLnRleHQgfHwgbmFtZTtcbiAgfSBlbHNlIHtcbiAgICBlbGVtLmNoaWxkcmVuID0gW3t0ZXh0OiBlbGVtLnRleHQgfHwgbmFtZX1dO1xuICB9XG4gIGVsZW1bXCJsaW5rXCJdID0gZWxlbVtcImxpbmtcIl0gfHwgZW50aXR5O1xuICBlbGVtLmNsaWNrID0gZWxlbS5jbGljayB8fCBuYXZpZ2F0ZTtcbiAgZWxlbVtcInBlZWtcIl0gPSBlbGVtW1wicGVla1wiXSAhPT0gdW5kZWZpbmVkID8gZWxlbVtcInBlZWtcIl0gOiB0cnVlO1xuICByZXR1cm4gZWxlbTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGF0dHJpYnV0ZXMoZWxlbTpFbnRpdHlFbGVtKTpFbGVtZW50IHtcbiAgbGV0IHtlbnRpdHl9ID0gZWxlbTtcbiAgbGV0IGF0dHJpYnV0ZXMgPSBbXTtcbiAgZm9yKGxldCBlYXYgb2YgZXZlLmZpbmQoXCJlbnRpdHkgZWF2c1wiLCB7ZW50aXR5fSkpIGF0dHJpYnV0ZXMucHVzaCh7YXR0cmlidXRlOiBlYXYuYXR0cmlidXRlLCB2YWx1ZTogZWF2LnZhbHVlfSk7XG4gIGF0dHJpYnV0ZXMuc29ydCgoYSwgYikgPT4ge1xuICAgICAgaWYoYS5hdHRyaWJ1dGUgPT09IGIuYXR0cmlidXRlKSByZXR1cm4gMDtcbiAgICAgIGVsc2UgaWYoYS5hdHRyaWJ1dGUgPCBiLmF0dHJpYnV0ZSkgcmV0dXJuIC0xO1xuICAgICAgcmV0dXJuIDE7XG4gIH0pXG4gIGVsZW1bXCJncm91cHNcIl0gPSBbXCJhdHRyaWJ1dGVcIl07XG4gIGVsZW1bXCJyb3dzXCJdID0gYXR0cmlidXRlcztcbiAgZWxlbVtcImVkaXRDZWxsXCJdID0gdXBkYXRlRW50aXR5VmFsdWU7XG4gIGVsZW1bXCJlZGl0Um93XCJdID0gdXBkYXRlRW50aXR5QXR0cmlidXRlcztcbiAgZWxlbVtcIm5vSGVhZGVyXCJdID0gdHJ1ZTtcbiAgcmV0dXJuIHRhYmxlKDxhbnk+ZWxlbSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiByZWxhdGVkKGVsZW06RW50aXR5RWxlbSk6RWxlbWVudCB7XG4gIGxldCB7ZW50aXR5LCBkYXRhID0gdW5kZWZpbmVkfSA9IGVsZW07XG4gIGxldCBuYW1lID0gcmVzb2x2ZU5hbWUoZW50aXR5KTtcbiAgbGV0IHJlbGF0aW9ucyA9IFtdO1xuICBmb3IobGV0IGxpbmsgb2YgZXZlLmZpbmQoXCJkaXJlY3Rpb25sZXNzIGxpbmtzXCIsIHtlbnRpdHl9KSkgcmVsYXRpb25zLnB1c2gobGluay5saW5rKTtcbiAgZWxlbS5jID0gZWxlbS5jICE9PSB1bmRlZmluZWQgPyBlbGVtLmMgOiBcImZsZXgtcm93IGZsZXgtd3JhcCBjc3ZcIjtcbiAgaWYocmVsYXRpb25zLmxlbmd0aCkge1xuICAgIGVsZW0uY2hpbGRyZW4gPSBbe3Q6IFwiaDJcIiwgdGV4dDogYCR7bmFtZX0gaXMgcmVsYXRlZCB0byAke3JlbGF0aW9ucy5sZW5ndGh9ICR7cGx1cmFsaXplKFwiZW50aXRpZXNcIiwgcmVsYXRpb25zLmxlbmd0aCl9OmB9XTtcbiAgICBmb3IobGV0IHJlbCBvZiByZWxhdGlvbnMpIGVsZW0uY2hpbGRyZW4ucHVzaChsaW5rKHtlbnRpdHk6IHJlbCwgZGF0YX0pKTtcblxuICB9IGVsc2UgZWxlbS50ZXh0ID0gYCR7bmFtZX0gaXMgbm90IHJlbGF0ZWQgdG8gYW55IG90aGVyIGVudGl0aWVzLmA7XG4gIHJldHVybiBlbGVtO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaW5kZXgoZWxlbTpFbnRpdHlFbGVtKTpFbGVtZW50IHtcbiAgbGV0IHtlbnRpdHl9ID0gZWxlbTtcbiAgbGV0IG5hbWUgPSByZXNvbHZlTmFtZShlbnRpdHkpO1xuICBsZXQgZmFjdHMgPSBldmUuZmluZChcImlzIGEgYXR0cmlidXRlc1wiLCB7Y29sbGVjdGlvbjogZW50aXR5fSk7XG4gIGxldCBsaXN0ID0ge3Q6IFwidWxcIiwgY2hpbGRyZW46IFtdfTtcbiAgZm9yKGxldCBmYWN0IG9mIGZhY3RzKSBsaXN0LmNoaWxkcmVuLnB1c2gobGluayh7dDogXCJsaVwiLCBlbnRpdHk6IGZhY3QuZW50aXR5LCBkYXRhOiBlbGVtLmRhdGF9KSk7XG4gIFxuICBlbGVtLmNoaWxkcmVuID0gW1xuICAgIHt0OiBcImgyXCIsIHRleHQ6IGBUaGVyZSAke3BsdXJhbGl6ZShcImFyZVwiLCBmYWN0cy5sZW5ndGgpfSAke2ZhY3RzLmxlbmd0aH0gJHtwbHVyYWxpemUobmFtZSwgZmFjdHMubGVuZ3RoKX06YH0sXG4gICAgbGlzdFxuICBdO1xuICByZXR1cm4gZWxlbTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHZpZXcoZWxlbTpFbnRpdHlFbGVtKTpFbGVtZW50IHtcbiAgbGV0IHtlbnRpdHl9ID0gZWxlbTtcbiAgbGV0IG5hbWUgPSByZXNvbHZlTmFtZShlbnRpdHkpO1xuICAvLyBAVE9ETzogQ2hlY2sgaWYgZ2l2ZW4gZW50aXR5IGlzIGEgdmlldywgb3IgcmVuZGVyIGFuIGVycm9yXG4gIFxuICBsZXQgcm93cyA9IGV2ZS5maW5kKGVudGl0eSk7XG4gIGVsZW1bXCJyb3dzXCJdID0gcm93cztcbiAgcmV0dXJuIHRhYmxlKDxhbnk+ZWxlbSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiByZXN1bHRzKGVsZW06RW50aXR5RWxlbSk6RWxlbWVudCB7XG4gIGxldCB7ZW50aXR5LCBkYXRhID0gdW5kZWZpbmVkfSA9IGVsZW07XG4gIGVsZW0uY2hpbGRyZW4gPSBbbmFtZSh7ZW50aXR5LCBkYXRhfSldO1xuICBmb3IobGV0IGVhdiBvZiBldmUuZmluZChcImVudGl0eSBlYXZzXCIsIHtlbnRpdHksIGF0dHJpYnV0ZTogXCJhcnRpZmFjdFwifSkpIHtcbiAgICBlbGVtLmNoaWxkcmVuLnB1c2goXG4gICAgICBuYW1lKHt0OiBcImgzXCIsIGVudGl0eTogZWF2LnZhbHVlLCBkYXRhfSksXG4gICAgICB2aWV3KHtlbnRpdHk6IGVhdi52YWx1ZSwgZGF0YX0pXG4gICAgKTtcbiAgfVxuICByZXR1cm4gZWxlbTtcbn1cblxuLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbi8vIFJlcHJlc2VudGF0aW9ucyBmb3IgdmFsdWVzXG4vLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuZnVuY3Rpb24gdG9nZ2xlRWRpdFZhbHVlKGV2ZW50LCBlbGVtKSB7XG4gICBpZighZWxlbS5zdGF0ZSkge1xuICAgIGNvbnNvbGUud2FybihcIkNhbm5vdCBlZGl0IHZhbHVlIHdpdGhvdXQgc3RhdGVcIik7XG4gICAgcmV0dXJuO1xuICB9XG4gIGVsZW0uc3RhdGUuZWRpdGluZyA9IGVsZW0ub3BlbiAhPT0gdW5kZWZpbmVkID8gZWxlbS5vcGVuIDogIWVsZW0uc3RhdGUuZWRpdGluZztcblxuICBsZXQgY2hhaW4gPSBkaXNwYXRjaChcInJlcmVuZGVyXCIpO1xuICBpZihlbGVtLnN0YXRlLmVkaXRpbmcpIHtcbiAgICBjbG9zZVBvcHVwKGV2ZW50LCBlbGVtLCBjaGFpbik7XG4gIH1cbiAgY2hhaW4uY29tbWl0KCk7XG59XG5cbmZ1bmN0aW9uIG9wZW5FZGl0VmFsdWUoZXZlbnQsIGVsZW0pIHtcbiAgZWxlbS5vcGVuID0gdHJ1ZTtcbiAgdG9nZ2xlRWRpdFZhbHVlKGV2ZW50LCBlbGVtKTtcbiAgZGVsZXRlIGVsZW0ub3Blbjtcbn1cbmZ1bmN0aW9uIGNsb3NlRWRpdFZhbHVlKGV2ZW50LCBlbGVtKSB7XG4gIGVsZW0ub3BlbiA9IGZhbHNlO1xuICB0b2dnbGVFZGl0VmFsdWUoZXZlbnQsIGVsZW0pO1xuICBkZWxldGUgZWxlbS5vcGVuO1xufVxuXG5pbnRlcmZhY2UgVmFsdWVFbGVtIGV4dGVuZHMgRWxlbWVudCB7IHZhbHVlOiBhbnksIGF1dG9saW5rPzogYm9vbGVhbiB9XG5leHBvcnQgZnVuY3Rpb24gdmFsdWUoZWxlbTpWYWx1ZUVsZW0pOkVsZW1lbnQge1xuICBsZXQge3ZhbHVlLCBhdXRvbGluayA9IHRydWUsIGRhdGF9ID0gZWxlbTtcbiAgZWxlbVtcIm9yaWdpbmFsXCJdID0gdmFsdWU7XG4gIGxldCBlbnRpdHkgPSBhc0VudGl0eSh2YWx1ZSk7XG4gIGVsZW0udGV4dCA9IHZhbHVlO1xuICBpZihlbnRpdHkpIHtcbiAgICBlbGVtW1wiZW50aXR5XCJdID0gZW50aXR5O1xuICAgIGxldCBuYW1lID0gcmVzb2x2ZU5hbWUoZW50aXR5KTtcbiAgICBlbGVtLnRleHQgPSBuYW1lO1xuICAgIGlmKGF1dG9saW5rKSB7XG4gICAgICBsaW5rKDxhbnk+ZWxlbSk7XG4gICAgfVxuICB9XG4gIFxuICByZXR1cm4gZWxlbTtcbn1cblxuaW50ZXJmYWNlIFZhbHVlRWRpdG9yRWxlbSBleHRlbmRzIFZhbHVlRWxlbSB7IG9yaWdpbmFsPzogc3RyaW5nLCBkaXNhYmxlZD86Ym9vbGVhbiwgc3RhdGU/OntlZGl0aW5nPzogYm9vbGVhbn0gfVxuZXhwb3J0IGZ1bmN0aW9uIHZhbHVlRWRpdG9yKGVsZW06VmFsdWVFZGl0b3JFbGVtKSB7XG4gIGVsZW0uYyA9IGBmbGV4LXJvdyBjZWxsICR7ZWxlbS5jIHx8IFwiXCJ9YDtcbiAgbGV0IHtzdGF0ZSwgZGlzYWJsZWQgPSBmYWxzZSwgZGF0YX0gPSBlbGVtO1xuICBpZihlbGVtLm9yaWdpbmFsID09PSB1bmRlZmluZWQpIGVsZW0ub3JpZ2luYWwgPSBlbGVtLnZhbHVlO1xuICBsZXQgY29udGVudCA9IHZhbHVlKHt2YWx1ZTogZWxlbS52YWx1ZSwgYXV0b2xpbms6IGVsZW0uYXV0b2xpbmssIGRhdGF9KTtcbiAgbGV0IGlucHV0O1xuICBcbiAgaWYoIWRpc2FibGVkKSB7XG4gICAgbGV0IF9mb2N1cyA9IGVsZW0uZm9jdXM7XG4gICAgbGV0IGZvY3VzID0gKGV2ZW50LCBpbnB1dEVsZW0pID0+IHtcbiAgICAgIGlmKF9mb2N1cykgX2ZvY3VzKGV2ZW50LCBlbGVtKTtcbiAgICAgIG9wZW5FZGl0VmFsdWUoZXZlbnQsIGVsZW0pO1xuICAgIH07XG4gICAgbGV0IF9ibHVyID0gZWxlbS5ibHVyO1xuICAgIGxldCBibHVyID0gKGV2ZW50LCBpbnB1dEVsZW0pID0+IHtcbiAgICAgIGlmKF9ibHVyKSBfYmx1cihldmVudCwgZWxlbSk7XG4gICAgICBjbG9zZUVkaXRWYWx1ZShldmVudCwgZWxlbSk7XG4gICAgfTtcbiAgICBcbiAgICBpbnB1dCA9IHt0OiBcImlucHV0XCIsIGZvY3VzLCBibHVyLCB2YWx1ZTogXCJcIiwgc3RyaWN0VGV4dDogdHJ1ZSwgcGxhY2Vob2xkZXI6IFwiXCJ9O1xuICAgIGlmKCFlbGVtLnZhbHVlIHx8IHN0YXRlLmVkaXRpbmcpIHtcbiAgICAgIGlucHV0LnBsYWNlaG9sZGVyID0gXCI8ZW1wdHk+XCI7XG4gICAgfVxuICBcbiAgICBpZihzdGF0ZS5lZGl0aW5nKSB7XG4gICAgICBbXCJpbnB1dFwiLCBcImNoYW5nZVwiLCBcImtleXVwXCIsIFwia2V5ZG93blwiXS5tYXAoKGhhbmRsZXIpID0+IHtcbiAgICAgICAgaWYoIWVsZW1baGFuZGxlcl0pIHJldHVybjtcbiAgICAgICAgbGV0IF9oYW5kbGUgPSBlbGVtW2hhbmRsZXJdO1xuICAgICAgICBpbnB1dFtoYW5kbGVyXSA9IChldmVudCwgaW5wdXRFbGVtKSA9PiB7XG4gICAgICAgICAgX2hhbmRsZShldmVudCwgZWxlbSk7XG4gICAgICAgIH1cbiAgICAgICAgZGVsZXRlIGVsZW1baGFuZGxlcl07XG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgXG4gICAgICBpbnB1dC52YWx1ZSA9IGNvbnRlbnQudGV4dDtcbiAgICAgIGNvbnRlbnQgPSB1bmRlZmluZWQ7XG4gICAgfVxuICB9XG4gIFxuICBlbGVtLmNoaWxkcmVuID0gW3tjOiBcImNlbGwtY29udGVudFwiLCBjaGlsZHJlbjogW2NvbnRlbnRdfSwge2M6IFwiZmxleC1ncm93IGNlbGwtaW5wdXRcIiwgY2hpbGRyZW46IFtpbnB1dF19XTtcbiAgcmV0dXJuIGVsZW07XG59XG5cbmludGVyZmFjZSBDU1ZFbGVtIGV4dGVuZHMgRWxlbWVudCB7IHZhbHVlczogYW55W10sIGF1dG9saW5rPzogYm9vbGVhbiB9XG5leHBvcnQgZnVuY3Rpb24gQ1NWKGVsZW06Q1NWRWxlbSk6RWxlbWVudCB7XG4gIGxldCB7dmFsdWVzLCBhdXRvbGluayA9IHVuZGVmaW5lZCwgZGF0YX0gPSBlbGVtO1xuICByZXR1cm4ge2M6IFwiZmxleC1yb3cgY3N2XCIsIGNoaWxkcmVuOiB2YWx1ZXMubWFwKCh2YWwpID0+IHZhbHVlKHt0OiBcInNwYW5cIiwgYXV0b2xpbmssIHZhbHVlOiB2YWwsIGRhdGF9KSl9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcmVzdWx0KGVsZW06Q1NWRWxlbSkge1xuICBlbGVtLmMgPSBcInJlc3VsdFwiO1xuICBlbGVtLmNoaWxkcmVuID0gW1xuICAgIGVsZW1bXCJzZWFyY2hcIl0gPyB7YzogXCJoZWFkZXJcIiwgY2hpbGRyZW46IFt7dGV4dDogZWxlbVtcInNlYXJjaFwiXX1dfSA6IHVuZGVmaW5lZCxcbiAgICBDU1YoY29weShlbGVtKSlcbiAgXTtcbiAgcmV0dXJuIGVsZW07XG59XG5cbmludGVyZmFjZSBDZWxsRWRpdCB7IGZpZWxkOiBzdHJpbmcsIHByZXY6IGFueSwgcm93Ont9LCB2YWx1ZTogYW55IH1cbmludGVyZmFjZSBDZWxsU3RhdGUgeyBbZmllbGQ6c3RyaW5nXToge2VkaXRpbmc/OiBib29sZWFufSB9XG5pbnRlcmZhY2UgVGFibGVTdGF0ZSB7IHNvcnRGaWVsZD86c3RyaW5nLCBzb3J0RGlyZWN0aW9uPzpudW1iZXIsIGFkZGVycz86e31bXSwgY2hhbmdlcz86IENlbGxFZGl0W10sIGNlbGxTdGF0ZXM/OkNlbGxTdGF0ZVtdLCBhZGRlckNlbGxTdGF0ZXM/OkNlbGxTdGF0ZVtdIH1cbmludGVyZmFjZSBUYWJsZUZpZWxkRWxlbSBleHRlbmRzIEVsZW1lbnQge2ZpZWxkOnN0cmluZywgaGVhZGVyOlRhYmxlSGVhZGVyRWxlbSwgc3RhdGU6VGFibGVTdGF0ZSwgc29ydGFibGU/OmJvb2xlYW59XG5pbnRlcmZhY2UgVGFibGVDZWxsRWxlbSBleHRlbmRzIEVsZW1lbnQgeyB0YWJsZTpNYXBwZWRUYWJsZUVsZW0sIGZpZWxkOnN0cmluZywgcm93Ont9LCB0ZXh0OnN0cmluZywgZWRpdGFibGU/OmJvb2xlYW4gfVxuaW50ZXJmYWNlIFRhYmxlSGVhZGVyRWxlbSBleHRlbmRzIEVsZW1lbnQgeyBzdGF0ZTpUYWJsZVN0YXRlLCBmaWVsZHM6c3RyaW5nW10sIGdyb3Vwcz86c3RyaW5nW10sIHNvcnRhYmxlPzpib29sZWFuLCBhZGRGaWVsZD86IEhhbmRsZXI8RXZlbnQ+LCByZW1vdmVGaWVsZD86IEhhbmRsZXI8RXZlbnQ+IH1cbmludGVyZmFjZSBUYWJsZUJvZHlFbGVtIGV4dGVuZHMgRWxlbWVudCB7IHN0YXRlOlRhYmxlU3RhdGUsIHJvd3M6e31bXSwgb3ZlcnJpZGVzPzogQ2VsbEVkaXRbXSwgZmllbGRzOnN0cmluZ1tdLCBkaXNhYmxlZD86c3RyaW5nW10sIGdyb3Vwcz86c3RyaW5nW10sIHNvcnRhYmxlPzpib29sZWFuLCBkYXRhPzp7fSwgZWRpdENlbGw/OkhhbmRsZXI8RXZlbnQ+LCBlZGl0R3JvdXA/OkhhbmRsZXI8RXZlbnQ+LCByZW1vdmVSb3c/OkhhbmRsZXI8RXZlbnQ+IH1cbmludGVyZmFjZSBUYWJsZUFkZGVyRWxlbSBleHRlbmRzIEVsZW1lbnQge3Jvdzp7fSwgZmllbGRzOiBzdHJpbmdbXSwgZGlzYWJsZWQ/OiBzdHJpbmdbXSwgY29uZmlybT86Ym9vbGVhbiwgZWRpdENlbGw/OkhhbmRsZXI8RXZlbnQ+LCBzdWJtaXQ/OkhhbmRsZXI8RXZlbnQ+IH1cbmV4cG9ydCBmdW5jdGlvbiB0YWJsZUJvZHkoZWxlbTpUYWJsZUJvZHlFbGVtKTpFbGVtZW50IHtcbiAgbGV0IHtzdGF0ZSwgcm93cywgb3ZlcnJpZGVzID0gW10sIGZpZWxkcywgZGF0YSwgZ3JvdXBzID0gW119ID0gZWxlbTtcbiAgZmllbGRzID0gZmllbGRzLnNsaWNlKCk7XG4gIGlmKCFyb3dzLmxlbmd0aCkge1xuICAgIGVsZW0udGV4dCA9IFwiPEVtcHR5IFRhYmxlPlwiO1xuICAgIHJldHVybiBlbGVtO1xuICB9XG5cbiAgbGV0IGRpc2FibGVkID0ge307XG4gIGZvcihsZXQgZmllbGQgb2YgZWxlbS5kaXNhYmxlZCB8fCBbXSkge1xuICAgIGRpc2FibGVkW2ZpZWxkXSA9IHRydWU7XG4gIH1cblxuICAvLyBTdHJpcCBncm91cGVkIGZpZWxkcyBvdXQgb2YgZGlzcGxheSBmaWVsZHMgLS0gdGhlIGZvcm1lciBpbXBsaWVzIHRoZSBsYXR0ZXIgYW5kIG11c3QgYmUgaGFuZGxlZCBmaXJzdFxuICBmb3IobGV0IGZpZWxkIG9mIGdyb3Vwcykge1xuICAgIGxldCBmaWVsZEl4ID0gZmllbGRzLmluZGV4T2YoZmllbGQpO1xuICAgIGlmKGZpZWxkSXggIT09IC0xKSB7XG4gICAgICBmaWVsZHMuc3BsaWNlKGZpZWxkSXgsIDEpO1xuICAgIH1cbiAgfVxuXG4gIC8vIE1hbmFnZSBpbnRlcmFjdGl2aXR5XG4gIGxldCB7c29ydGFibGUgPSBmYWxzZSwgZWRpdENlbGwsIGVkaXRHcm91cCwgcmVtb3ZlUm93fSA9IGVsZW07XG4gIGlmKGVkaXRDZWxsKSB7XG4gICAgaWYoIXN0YXRlLmNlbGxTdGF0ZXMpIHN0YXRlLmNlbGxTdGF0ZXMgPSBbXTtcbiAgICBcbiAgICBsZXQgX2VkaXRDZWxsID0gZWRpdENlbGw7XG4gICAgZWRpdENlbGwgPSAoZXZlbnQ6RXZlbnQsIGVsZW0pID0+IHtcbiAgICAgIGxldCB2YWwgPSByZXNvbHZlVmFsdWUoZ2V0Tm9kZUNvbnRlbnQoPEhUTUxFbGVtZW50PmV2ZW50LnRhcmdldCkpO1xuICAgICAgaWYodmFsID09PSBlbGVtW1wib3JpZ2luYWxcIl0pIHJldHVybjtcbiAgICAgIF9lZGl0Q2VsbChuZXcgQ3VzdG9tRXZlbnQoXCJlZGl0Y2VsbFwiLCB7ZGV0YWlsOiB2YWx9KSwgZWxlbSk7XG4gICAgfVxuICAgIGxldCBfZWRpdEdyb3VwID0gZWRpdEdyb3VwO1xuICAgIGVkaXRHcm91cCA9IChldmVudDpFdmVudCwgZWxlbSkgPT4ge1xuICAgICAgbGV0IHZhbCA9IHJlc29sdmVWYWx1ZShnZXROb2RlQ29udGVudCg8SFRNTEVsZW1lbnQ+ZXZlbnQudGFyZ2V0KSk7XG4gICAgICBpZih2YWwgPT09IGVsZW1bXCJvcmlnaW5hbFwiXSkgcmV0dXJuO1xuICAgICAgaWYoX2VkaXRHcm91cCkgX2VkaXRHcm91cChuZXcgQ3VzdG9tRXZlbnQoXCJlZGl0Z3JvdXBcIiwge2RldGFpbDogdmFsfSksIGVsZW0pO1xuICAgICAgZWxzZSB7XG4gICAgICAgIGZvcihsZXQgcm93IG9mIGVsZW0ucm93cykge1xuICAgICAgICAgIF9lZGl0Q2VsbChuZXcgQ3VzdG9tRXZlbnQoXCJlZGl0Y2VsbFwiLCB7ZGV0YWlsOiB2YWx9KSwgZWxlbSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9O1xuICB9XG5cbiAgLy8gU29ydCByb3dzXG4gIGlmKHN0YXRlLnNvcnRGaWVsZCAmJiBzdGF0ZS5zb3J0RGlyZWN0aW9uKSB7XG4gICAgcm93cy5zb3J0KHNvcnRCeUZpZWxkVmFsdWUoc3RhdGUuc29ydEZpZWxkLCBzdGF0ZS5zb3J0RGlyZWN0aW9uKSk7XG4gIH1cbiAgZm9yKHZhciBmaWVsZCBvZiBncm91cHMpIHtcbiAgICByb3dzLnNvcnQoc29ydEJ5RmllbGRWYWx1ZShmaWVsZCwgZmllbGQgPT09IHN0YXRlLnNvcnRGaWVsZCA/IHN0YXRlLnNvcnREaXJlY3Rpb24gOiAxKSk7XG4gIH1cblxuICBlbGVtLmNoaWxkcmVuID0gW107XG4gIGxldCBib2R5ID0gZWxlbTtcbiAgbGV0IG9wZW5Sb3dzID0ge307XG4gIGxldCBvcGVuVmFscyA9IHt9O1xuICBsZXQgcm93SXggPSAwO1xuICBmb3IobGV0IHJvdyBvZiByb3dzKSB7XG4gICAgbGV0IG92ZXJyaWRlID0ge307XG4gICAgZm9yKGxldCBjaGFuZ2Ugb2Ygb3ZlcnJpZGVzKSB7XG4gICAgICBpZihjaGFuZ2Uucm93ID09PSByb3cpIHtcbiAgICAgICAgb3ZlcnJpZGVbY2hhbmdlLmZpZWxkXSA9IGNoYW5nZS52YWx1ZTtcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgaWYoZWRpdENlbGwgJiYgIXN0YXRlLmNlbGxTdGF0ZXNbcm93SXhdKSB7XG4gICAgICBzdGF0ZS5jZWxsU3RhdGVzW3Jvd0l4XSA9IHt9O1xuICAgIH1cbiAgICBcbiAgICBsZXQgZ3JvdXA7XG4gICAgZm9yKGxldCBmaWVsZCBvZiBncm91cHMpIHtcbiAgICAgIGxldCB2YWwgPSAoZmllbGQgaW4gb3ZlcnJpZGUgPyBvdmVycmlkZVtmaWVsZF0gOiByb3dbZmllbGRdKSB8fCBcIlwiO1xuICAgICAgaWYoZWRpdENlbGwgJiYgIXN0YXRlLmNlbGxTdGF0ZXNbcm93SXhdW2ZpZWxkXSkge1xuICAgICAgICBzdGF0ZS5jZWxsU3RhdGVzW3Jvd0l4XVtmaWVsZF0gPSB7fTtcbiAgICAgIH1cbiAgICAgIGxldCBjZWxsU3RhdGUgPSBlZGl0Q2VsbCAmJiBzdGF0ZS5jZWxsU3RhdGVzW3Jvd0l4XVtmaWVsZF07XG4gICAgICBcbiAgICAgIGlmKG9wZW5WYWxzW2ZpZWxkXSA9PT0gdmFsKSB7IC8vIFRoZSByb3cgaXMgc3RpbGwgY29udGFpbmVkIHdpdGhpbiB0aGlzIGdyb3VwXG4gICAgICAgIGdyb3VwID0gb3BlblJvd3NbZmllbGRdO1xuICAgICAgICBncm91cC5jaGlsZHJlblswXS5yb3dzLnB1c2gocm93KTtcbiAgICAgIH0gZWxzZSB7IC8vIFRoZSByb3cgYmVnaW5zIGEgbmV3IGdyb3VwIGF0IGN1cnJlbnQgbGV2ZWwgaW4gdGhlIGhpZXJhcmNoeVxuICAgICAgICBvcGVuVmFsc1tmaWVsZF0gPSB2YWw7XG4gICAgICAgIGxldCBjdXIgPSBvcGVuUm93c1tmaWVsZF0gPSB7XG4gICAgICAgICAgYzogXCJ0YWJsZS1yb3cgZ3JvdXBlZFwiLFxuICAgICAgICAgIGNoaWxkcmVuOiBbXG4gICAgICAgICAgICB2YWx1ZUVkaXRvcih7XG4gICAgICAgICAgICAgIGM6IFwiY29sdW1uIGNlbGxcIixcbiAgICAgICAgICAgICAgdmFsdWU6IHZhbCxcbiAgICAgICAgICAgICAgc3RhdGU6IGNlbGxTdGF0ZSxcbiAgICAgICAgICAgICAgZGF0YSxcbiAgICAgICAgICAgICAgdGFibGU6IGVsZW0sXG4gICAgICAgICAgICAgIGZpZWxkLFxuICAgICAgICAgICAgICByb3dzOiBbcm93XSxcbiAgICAgICAgICAgICAgZGlzYWJsZWQ6ICFlZGl0R3JvdXAgfHwgZGlzYWJsZWRbZmllbGRdLFxuICAgICAgICAgICAgICBrZXlkb3duOiBibHVyT25FbnRlcixcbiAgICAgICAgICAgICAgYmx1cjogZWRpdEdyb3VwXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIHtjOiBcImZsZXgtY29sdW1uIGZsZXgtZ3JvdyBncm91cFwiLCBjaGlsZHJlbjogW119XG4gICAgICAgICAgXVxuICAgICAgICB9O1xuICAgICAgICBpZihncm91cCkge1xuICAgICAgICAgIGdyb3VwLmNoaWxkcmVuWzFdLmNoaWxkcmVuLnB1c2goY3VyKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBib2R5LmNoaWxkcmVuLnB1c2goY3VyKTtcbiAgICAgICAgfVxuICAgICAgICBncm91cCA9IGN1cjtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBsZXQgcm93SXRlbSA9IHtjOiBcInRhYmxlLXJvd1wiLCBjaGlsZHJlbjogW119O1xuICAgIGZvcihsZXQgZmllbGQgb2YgZmllbGRzKSB7XG4gICAgICBsZXQgdmFsID0gKGZpZWxkIGluIG92ZXJyaWRlID8gb3ZlcnJpZGVbZmllbGRdIDogcm93W2ZpZWxkXSkgfHwgXCJcIjtcbiAgICAgIGlmKGVkaXRDZWxsICYmICFzdGF0ZS5jZWxsU3RhdGVzW3Jvd0l4XVtmaWVsZF0pIHtcbiAgICAgICAgc3RhdGUuY2VsbFN0YXRlc1tyb3dJeF1bZmllbGRdID0ge307XG4gICAgICB9XG4gICAgICBsZXQgY2VsbFN0YXRlID0gZWRpdENlbGwgJiYgc3RhdGUuY2VsbFN0YXRlc1tyb3dJeF1bZmllbGRdO1xuXG4gICAgICByb3dJdGVtLmNoaWxkcmVuLnB1c2godmFsdWVFZGl0b3Ioe1xuICAgICAgICBjOiBcImNvbHVtbiBjZWxsXCIsXG4gICAgICAgIHZhbHVlOiB2YWwsXG4gICAgICAgIHN0YXRlOiBjZWxsU3RhdGUsXG4gICAgICAgIGRhdGEsXG4gICAgICAgIHRhYmxlOiBlbGVtLFxuICAgICAgICBmaWVsZCxcbiAgICAgICAgcm93LFxuICAgICAgICBkaXNhYmxlZDogIWVkaXRDZWxsIHx8IGRpc2FibGVkW2ZpZWxkXSxcbiAgICAgICAga2V5ZG93bjogYmx1ck9uRW50ZXIsXG4gICAgICAgIGJsdXI6IGVkaXRDZWxsXG4gICAgICB9KSk7XG4gICAgfVxuXG4gICAgcm93SXRlbS5jaGlsZHJlbi5wdXNoKHtjOiBcImNvbnRyb2xzXCIsIGNoaWxkcmVuOiBbXG4gICAgICByZW1vdmVSb3cgPyB7YzogXCJpb24taWNvbi1hbmRyb2lkLWNsb3NlXCIsIHJvdzogcm93SXRlbSwgY2xpY2s6IHJlbW92ZVJvd30gOiB1bmRlZmluZWRcbiAgICBdfSk7XG5cbiAgICBpZihncm91cCkge1xuICAgICAgZ3JvdXAuY2hpbGRyZW5bMV0uY2hpbGRyZW4ucHVzaChyb3dJdGVtKTtcbiAgICB9IGVsc2Uge1xuICAgICAgYm9keS5jaGlsZHJlbi5wdXNoKHJvd0l0ZW0pO1xuICAgIH1cbiAgICByb3dJeCsrO1xuICB9XG5cbiAgZWxlbS5jID0gYHRhYmxlLWJvZHkgJHtlbGVtLmMgfHwgXCJcIn1gO1xuICByZXR1cm4ge2M6IFwidGFibGUtYm9keS1zY3JvbGxlclwiLCBjaGlsZHJlbjogW2VsZW1dfTtcbn1cblxuZnVuY3Rpb24gdGFibGVIZWFkZXIoZWxlbTpUYWJsZUhlYWRlckVsZW0pOkVsZW1lbnQge1xuICBsZXQge3N0YXRlLCBmaWVsZHMsIGdyb3VwcyA9IFtdLCBzb3J0YWJsZSA9IGZhbHNlLCBkYXRhfSA9IGVsZW07XG4gIGZpZWxkcyA9IGZpZWxkcy5zbGljZSgpO1xuICAvLyBTdHJpcCBncm91cGVkIGZpZWxkcyBvdXQgb2YgZGlzcGxheSBmaWVsZHMgLS0gdGhlIGZvcm1lciBpbXBsaWVzIHRoZSBsYXR0ZXIgYW5kIG11c3QgYmUgaGFuZGxlZCBmaXJzdFxuICBmb3IobGV0IGZpZWxkIG9mIGdyb3Vwcykge1xuICAgIGxldCBmaWVsZEl4ID0gZmllbGRzLmluZGV4T2YoZmllbGQpO1xuICAgIGlmKGZpZWxkSXggIT09IC0xKSB7XG4gICAgICBmaWVsZHMuc3BsaWNlKGZpZWxkSXgsIDEpO1xuICAgIH1cbiAgfVxuXG4gIGxldCB7YWRkRmllbGQsIHJlbW92ZUZpZWxkfSA9IGVsZW07XG5cbiAgLy8gQnVpbGQgaGVhZGVyXG4gIGVsZW0udCA9IFwiaGVhZGVyXCI7XG4gIGVsZW0uYyA9IGB0YWJsZS1oZWFkZXIgJHtlbGVtLmMgfHwgXCJcIn1gO1xuICBlbGVtLmNoaWxkcmVuID0gW107XG4gIGZvcihsZXQgZmllbGQgb2YgZ3JvdXBzLmNvbmNhdChmaWVsZHMpKSB7XG4gICAgbGV0IGlzQWN0aXZlID0gZmllbGQgPT09IHN0YXRlLnNvcnRGaWVsZDtcbiAgICBsZXQgZGlyZWN0aW9uID0gaXNBY3RpdmUgPyBzdGF0ZS5zb3J0RGlyZWN0aW9uIDogMDtcbiAgICBsZXQga2xhc3MgPSBgc29ydC10b2dnbGUgJHtpc0FjdGl2ZSAmJiBkaXJlY3Rpb24gPCAwID8gXCJpb24tYXJyb3ctdXAtYlwiIDogXCJpb24tYXJyb3ctZG93bi1iXCJ9ICR7aXNBY3RpdmUgPyBcImFjdGl2ZVwiIDogXCJcIn1gO1xuICAgIGVsZW0uY2hpbGRyZW4ucHVzaCh7YzogXCJjb2x1bW4gZmllbGRcIiwgY2hpbGRyZW46IFtcbiAgICAgIHZhbHVlKHtjOiBcInRleHRcIiwgdmFsdWU6IGZpZWxkLCBkYXRhLCBhdXRvbGluazogZmFsc2V9KSxcbiAgICAgIHtjOiBcImZsZXgtZ3Jvd1wifSxcbiAgICAgIHtjOiBcImNvbnRyb2xzXCIsIGNoaWxkcmVuOiBbXG4gICAgICAgIHNvcnRhYmxlID8ge2M6IGtsYXNzLCB0YWJsZTogZWxlbSwgZmllbGQsIGRpcmVjdGlvbjogLWRpcmVjdGlvbiB8fCAxLCBjbGljazogc29ydFRhYmxlfSA6IHVuZGVmaW5lZCxcbiAgICAgICAgcmVtb3ZlRmllbGQgPyB7YzogXCJpb24tY2xvc2Utcm91bmRcIiwgdGFibGU6IGVsZW0sIGZpZWxkLCBjbGljazogcmVtb3ZlRmllbGR9IDogdW5kZWZpbmVkXG4gICAgICBdfVxuICAgIF19KTtcbiAgfTtcbiAgZWxlbS5jaGlsZHJlbi5wdXNoKHtjOiBcImNvbnRyb2xzXCIsIGNoaWxkcmVuOiBbXG4gICAgYWRkRmllbGQgPyB7YzogXCJpb24tcGx1cy1yb3VuZCBhZGQtZmllbGQtYnRuXCIsIHRhYmxlOiBlbGVtLCBjbGljazogYWRkRmllbGR9IDogdW5kZWZpbmVkXG4gIF19KTtcbiAgcmV0dXJuIGVsZW07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB0YWJsZUFkZGVyUm93KGVsZW06VGFibGVBZGRlckVsZW0pOkVsZW1lbnQge1xuICBsZXQge3JvdywgY2VsbFN0YXRlcywgZmllbGRzLCBjb25maXJtID0gdHJ1ZSwgZWRpdENlbGwsIHN1Ym1pdCwgZGF0YX0gPSBlbGVtO1xuICBlbGVtLmMgPSBgdGFibGUtcm93IHRhYmxlLWFkZGVyICR7ZWxlbS5jIHx8IFwiXCJ9YDtcbiAgZWxlbS5jaGlsZHJlbiA9IFtdO1xuICBsZXQgZGlzYWJsZWQgPSB7fTtcbiAgZm9yKGxldCBmaWVsZCBvZiBlbGVtLmRpc2FibGVkIHx8IFtdKSB7XG4gICAgZGlzYWJsZWRbZmllbGRdID0gdHJ1ZTtcbiAgfVxuXG4gIC8vIEJ5IGRlZmF1bHQsIGFjY2VwdCBhbGwgY2hhbmdlc1xuICBpZighZWRpdENlbGwpIHtcbiAgICBlZGl0Q2VsbCA9IChldmVudCwgY2VsbEVsZW06VGFibGVDZWxsRWxlbSkgPT4ge1xuICAgICAgcm93W2NlbGxFbGVtLmZpZWxkXSA9IHJlc29sdmVWYWx1ZShnZXROb2RlQ29udGVudCg8SFRNTEVsZW1lbnQ+ZXZlbnQudGFyZ2V0KSk7XG4gICAgfTtcbiAgfVxuXG4gIC8vIFdyYXAgc3VibWlzc2lvbiB0byBwb2ludCBhdCB0aGUgYWRkZXIgZWxlbWVudCBpbnN0ZWFkIG9mIHRoZSBhZGQgYnV0dG9uXG4gIGlmKHN1Ym1pdCkge1xuICAgIGxldCBfc3VibWl0ID0gc3VibWl0O1xuICAgIHN1Ym1pdCA9IChldmVudCwgXykgPT4gX3N1Ym1pdChldmVudCwgZWxlbSk7XG4gIH1cblxuICAvLyBJZiB3ZSBzaG91bGQgYWRkIHdpdGhvdXQgY29uZmlybWF0aW9uLCBzdWJtaXQgd2hlbmV2ZXIgdGhlIHJvdyBpcyBjb21wbGV0ZWx5IGZpbGxlZCBpblxuICBpZighY29uZmlybSAmJiBzdWJtaXQpIHtcbiAgICBsZXQgX2VkaXRDZWxsID0gZWRpdENlbGw7XG4gICAgZWRpdENlbGwgPSAoZXZlbnQsIGNlbGxFbGVtOlRhYmxlQ2VsbEVsZW0pID0+IHtcbiAgICAgIGxldCB2YWxpZCA9ICFfZWRpdENlbGwoZXZlbnQsIGNlbGxFbGVtKTtcbiAgICAgIGZvcihsZXQgZmllbGQgb2YgZmllbGRzKSB7XG4gICAgICAgIGlmKHJvd1tmaWVsZF0gPT09IHVuZGVmaW5lZCkgdmFsaWQgPSBmYWxzZTtcbiAgICAgIH1cbiAgICAgIGlmKHZhbGlkKSBzdWJtaXQoZXZlbnQsIGVsZW0pO1xuICAgIH1cbiAgfVxuXG4gIGZvcihsZXQgZmllbGQgb2YgZmllbGRzKSB7XG4gICAgaWYoIWNlbGxTdGF0ZXNbZmllbGRdKSB7XG4gICAgICBjZWxsU3RhdGVzW2ZpZWxkXSA9IHt9O1xuICAgIH1cbiAgICBlbGVtLmNoaWxkcmVuLnB1c2godmFsdWVFZGl0b3Ioe1xuICAgICAgYzogYGNvbHVtbiBjZWxsICR7ZGlzYWJsZWRbZmllbGRdID8gXCJkaXNhYmxlZFwiIDogXCJcIn1gLFxuICAgICAgZGlzYWJsZWQ6IGRpc2FibGVkW2ZpZWxkXSxcbiAgICAgIHZhbHVlOiByb3dbZmllbGRdIHx8IFwiXCIsXG4gICAgICBzdGF0ZTogY2VsbFN0YXRlc1tmaWVsZF0sXG4gICAgICBkYXRhLFxuICAgICAgdGFibGU6IGVsZW0sXG4gICAgICBmaWVsZCxcbiAgICAgIHJvdyxcbiAgICAgIGtleWRvd246IGJsdXJPbkVudGVyLFxuICAgICAgYmx1cjogZWRpdENlbGxcbiAgICB9KSk7XG4gIH1cblxuICBpZihjb25maXJtKSB7XG4gICAgZWxlbS5jaGlsZHJlbi5wdXNoKHtjOiBcImNvbnRyb2xzXCIsIGNoaWxkcmVuOiBbe2M6IFwiY29uZmlybS1yb3cgaW9uLWNoZWNrbWFyay1yb3VuZFwiLCB0YWJsZTogZWxlbSwgcm93LCBjbGljazogc3VibWl0fV19KTtcbiAgfVxuXG4gIHJldHVybiBlbGVtO1xufVxuXG5mdW5jdGlvbiBjcmVhdGVGYWN0KGNoYWluLCByb3c6e30sIHtzdWJqZWN0LCBlbnRpdHksIGZpZWxkTWFwLCBjb2xsZWN0aW9uc306e3N1YmplY3Q6c3RyaW5nLCBlbnRpdHk/OnN0cmluZywgZmllbGRNYXA6e1tmaWVsZDpzdHJpbmddOiBzdHJpbmd9LCBjb2xsZWN0aW9ucz86IHN0cmluZ1tdfSkge1xuICBsZXQgbmFtZSA9IHJvd1tzdWJqZWN0XTtcbiAgaWYoIWVudGl0eSkge1xuICAgIGVudGl0eSA9IGFzRW50aXR5KG5hbWUpO1xuICB9XG4gIFxuICBpZighZW50aXR5KSB7XG4gICAgZW50aXR5ID0gdXVpZCgpO1xuICAgIGxldCBwYWdlSWQgPSB1dWlkKCk7XG4gICAgY29uc29sZS5sb2coXCIgLSBjcmVhdGluZyBlbnRpdHlcIiwgZW50aXR5KTtcbiAgICBjaGFpbi5kaXNwYXRjaChcImNyZWF0ZSBwYWdlXCIsIHtwYWdlOiBwYWdlSWQsICBjb250ZW50OiBcIlwifSlcbiAgICAgIC5kaXNwYXRjaChcImNyZWF0ZSBlbnRpdHlcIiwge2VudGl0eSwgbmFtZSwgcGFnZTogcGFnZUlkfSk7XG4gIH1cbiAgICAgIFxuICBmb3IobGV0IGZpZWxkIGluIGZpZWxkTWFwKSB7XG4gICAgbGV0IHZhbHVlID0gcmVzb2x2ZVZhbHVlKHJvd1tmaWVsZF0pO1xuICAgIGNvbnNvbGUubG9nKFwiIC0gYWRkaW5nIGF0dHJcIiwgZmllbGRNYXBbZmllbGRdLCBcIj1cIiwgdmFsdWUsIFwiZm9yXCIsIGVudGl0eSk7XG4gICAgXG4gICAgaWYodmFsdWVbMF0gPT09IFwiXFxcIlwiICYmIHZhbHVlW3ZhbHVlLmxlbmd0aCAtIDFdID09PSBcIlxcXCJcIikge1xuICAgICAgdmFsdWUgPSB2YWx1ZS5zbGljZSgxLCAtMSk7XG4gICAgfSBlbHNlIGlmKHR5cGVvZiB2YWx1ZSA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgaWYoIWlzRW50aXR5KHZhbHVlKSkge1xuICAgICAgICBsZXQgcGFnZUlkID0gdXVpZCgpO1xuICAgICAgICBsZXQgZW50aXR5ID0gdXVpZCgpO1xuICAgICAgICBsZXQgbmFtZSA9IHZhbHVlO1xuICAgICAgICB2YWx1ZSA9IGVudGl0eTtcbiAgICAgICAgY29uc29sZS5sb2coXCIgICAtIGNyZWF0aW5nIGVudGl0eVwiLCBlbnRpdHkpO1xuICAgICAgICBjaGFpbi5kaXNwYXRjaChcImNyZWF0ZSBwYWdlXCIsIHtwYWdlOiBwYWdlSWQsICBjb250ZW50OiBcIlwifSlcbiAgICAgICAgICAuZGlzcGF0Y2goXCJjcmVhdGUgZW50aXR5XCIsIHtlbnRpdHksIG5hbWUsIHBhZ2U6IHBhZ2VJZH0pO1xuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICBjaGFpbi5kaXNwYXRjaChcImFkZCBzb3VyY2VkIGVhdlwiLCB7ZW50aXR5LCBhdHRyaWJ1dGU6IGZpZWxkTWFwW2ZpZWxkXSwgdmFsdWV9KTtcbiAgfVxuXG4gIGlmKGNvbGxlY3Rpb25zKSB7XG4gICAgZm9yKGxldCBjb2xsIG9mIGNvbGxlY3Rpb25zKSB7XG4gICAgICBjb25zb2xlLmxvZyhcIiAtIGFkZGluZyBjb2xsXCIsIFwiaXMgYVwiLCBcIj1cIiwgY29sbCwgXCJmb3JcIiwgZW50aXR5KTtcbiAgICAgIGNoYWluLmRpc3BhdGNoKFwiYWRkIHNvdXJjZWQgZWF2XCIsIHtlbnRpdHksIGF0dHJpYnV0ZTogXCJpcyBhXCIsIHZhbHVlOiBjb2xsfSk7XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIHRhYmxlU3RhdGVWYWxpZCh0YWJsZUVsZW06TWFwcGVkVGFibGVFbGVtKSB7XG4gIGxldCB7c3RhdGUsIGZpZWxkcywgZ3JvdXBzID0gW119ID0gdGFibGVFbGVtO1xuICAvLyBBIG5ldyBhZGRlciBpcyBhZGRlZCBldmVyeSB0aW1lIHRoZSBwcmV2aW91cyBhZGRlciB3YXMgY2hhbmdlcywgc28gdGhlIGxhc3Qgb25lIGlzIGVtcHR5LlxuICBsZXQgYWRkZXJzID0gc3RhdGUuYWRkZXJzLnNsaWNlKDAsIC0xKTtcbiAgXG4gIC8vIEVuc3VyZSBhbGwgYmF0Y2hlZCBjaGFuZ2VzIGFyZSB2YWxpZCBiZWZvcmUgY29tbWl0dGluZyBhbnkgb2YgdGhlbS5cbiAgZm9yKGxldCBhZGRlciBvZiBhZGRlcnMpIHtcbiAgICBmb3IobGV0IGZpZWxkIG9mIGZpZWxkcy5jb25jYXQoZ3JvdXBzKSkge1xuICAgICAgaWYoYWRkZXJbZmllbGRdID09PSB1bmRlZmluZWQgfHwgYWRkZXJbZmllbGRdID09PSBcIlwiKSByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgZm9yKGxldCBjaGFuZ2Ugb2Ygc3RhdGUuY2hhbmdlcykge1xuICAgIGlmKGNoYW5nZS52YWx1ZSA9PT0gdW5kZWZpbmVkIHx8IGNoYW5nZS52YWx1ZSA9PT0gXCJcIikgcmV0dXJuIGZhbHNlO1xuICB9XG4gIFxuICByZXR1cm4gdHJ1ZTtcbn1cblxuZnVuY3Rpb24gbWFuYWdlQWRkZXJzKHN0YXRlLCByb3csIGZpZWxkKSB7XG4gIGlmKHJvd1tmaWVsZF0gIT09IHVuZGVmaW5lZCAmJiByb3dbZmllbGRdICE9PSBcIlwiKSB7XG4gICAgaWYocm93ID09PSBzdGF0ZS5hZGRlcnNbc3RhdGUuYWRkZXJzLmxlbmd0aCAtIDFdKSB7XG4gICAgICAvLyBXZSBhZGRlZCBhIHZhbHVlIHRvIHRoZSBibGFuayBhZGRlciBhbmQgbmVlZCB0byBwdXNoIGEgbmV3IGFkZGVyXG4gICAgICBzdGF0ZS5hZGRlcnMucHVzaCh7fSk7XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIGxldCBpeCA9IDA7XG4gICAgd2hpbGUoaXggPCBzdGF0ZS5hZGRlcnMubGVuZ3RoIC0gMSkge1xuICAgICAgbGV0IGFkZGVyID0gc3RhdGUuYWRkZXJzW2l4XTtcbiAgICAgIGxldCBnYyA9IHRydWU7XG4gICAgICBmb3IobGV0IGZpZWxkIGluIGFkZGVyKSB7XG4gICAgICAgIGlmKGFkZGVyW2ZpZWxkXSAhPT0gdW5kZWZpbmVkICYmIGFkZGVyW2ZpZWxkXSAhPT0gXCJcIikge1xuICAgICAgICAgIGdjID0gZmFsc2U7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmKGdjKSB7XG4gICAgICAgIHN0YXRlLmFkZGVycy5zcGxpY2UoaXgsIDEpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaXgrKztcbiAgICAgIH1cbiAgICB9XG4gIH1cbn1cblxuZnVuY3Rpb24gY2hhbmdlQXR0cmlidXRlQWRkZXIoZXZlbnQsIGVsZW0pIHtcbiAgbGV0IHt0YWJsZTp0YWJsZUVsZW0sIHJvdywgZmllbGR9ID0gZWxlbTtcbiAgbGV0IHtzdGF0ZX0gPSB0YWJsZUVsZW07XG4gIHJvd1tmaWVsZF0gPSByZXNvbHZlVmFsdWUoZ2V0Tm9kZUNvbnRlbnQoZXZlbnQudGFyZ2V0KSk7XG4gIG1hbmFnZUFkZGVycyhzdGF0ZSwgcm93LCBmaWVsZCk7XG4gIGRpc3BhdGNoKFwicmVyZW5kZXJcIikuY29tbWl0KCk7XG59XG5cbmZ1bmN0aW9uIGNoYW5nZUVudGl0eUFkZGVyKGV2ZW50LCBlbGVtKSB7XG4gIGxldCB7dGFibGU6dGFibGVFbGVtLCByb3csIGZpZWxkfSA9IGVsZW07XG4gIGxldCB7c3RhdGUsIHN1YmplY3QsIGZpZWxkTWFwfSA9IHRhYmxlRWxlbTtcbiAgcm93W2ZpZWxkXSA9IHJlc29sdmVWYWx1ZShnZXROb2RlQ29udGVudChldmVudC50YXJnZXQpKTtcbiAgaWYoZmllbGQgPT09IHN1YmplY3QpIHtcbiAgICAvLyBATk9URTogU2hvdWxkIHRoaXMgcmVhbGx5IGJlIGRvbmUgYnkgaW5zZXJ0aW5nIFwiPSBcIiB3aGVuIHRoZSBpbnB1dCBpcyBmb2N1c2VkP1xuICAgIGxldCBlbnRpdHlJZCA9IGFzRW50aXR5KHJlc29sdmVWYWx1ZShyb3dbc3ViamVjdF0pKTtcbiAgICBpZihlbnRpdHlJZCkge1xuICAgICAgZm9yKGxldCBmaWVsZCBpbiBmaWVsZE1hcCkge1xuICAgICAgICBsZXQge3ZhbHVlID0gdW5kZWZpbmVkfSA9IGV2ZS5maW5kT25lKFwiZW50aXR5IGVhdnNcIiwge2VudGl0eTogZW50aXR5SWQsIGF0dHJpYnV0ZTogZmllbGRNYXBbZmllbGRdfSkgfHwge307XG4gICAgICAgIGlmKCFyb3dbZmllbGRdICYmIHZhbHVlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICByb3dbZmllbGRdID0gdmFsdWU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgbWFuYWdlQWRkZXJzKHN0YXRlLCByb3csIGZpZWxkKTtcbiAgZGlzcGF0Y2goXCJyZXJlbmRlclwiKS5jb21taXQoKTtcbn1cblxuZnVuY3Rpb24gdXBkYXRlUm93QXR0cmlidXRlKGV2ZW50LCBlbGVtOlRhYmxlQ2VsbEVsZW0pIHtcbiAgbGV0IHtmaWVsZCwgcm93LCB0YWJsZTp0YWJsZUVsZW19ID0gZWxlbTtcbiAgbGV0IHtzdGF0ZSwgc3ViamVjdCwgZmllbGRNYXB9ID0gdGFibGVFbGVtO1xuICBsZXQgdmFsdWUgPSByZXNvbHZlVmFsdWUoZXZlbnQuZGV0YWlsKTtcbiAgbGV0IGNoYW5nZTtcbiAgZm9yKGxldCBjdXIgb2Ygc3RhdGUuY2hhbmdlcykge1xuICAgIGlmKGN1ci5maWVsZCA9PT0gZmllbGQgJiYgY3VyLnJvdyA9PT0gcm93KSB7XG4gICAgICBjaGFuZ2UgPSBjdXI7XG4gICAgICBicmVhaztcbiAgICB9XG4gIH1cbiAgaWYoIWNoYW5nZSkge1xuICAgIGNoYW5nZSA9IHtmaWVsZCwgcHJldjogcm93W2ZpZWxkXSwgcm93LCB2YWx1ZX07XG4gICAgc3RhdGUuY2hhbmdlcy5wdXNoKGNoYW5nZSk7XG4gIH0gZWxzZSB7XG4gICAgY2hhbmdlLnZhbHVlID0gdmFsdWU7XG4gIH1cbiAgZGlzcGF0Y2goXCJyZXJlbmRlclwiKS5jb21taXQoKTtcbn1cblxuZnVuY3Rpb24gY29tbWl0Q2hhbmdlcyhldmVudCwgZWxlbTp7dGFibGU6TWFwcGVkVGFibGVFbGVtfSkge1xuICAvLyBAVE9ETzogQmF0Y2ggY2hhbmdlcyB0byBleGlzdGluZyByb3dzIGluIGVkaXRDZWxsIGludG8gc3RhdGUuY2hhbmdlc1tdXG4gIC8vIEBUT0RPOiBTdWJtaXQgYWxsIGJhdGNoZWQgY2VsbCBjaGFuZ2VzXG4gIC8vIEBUT0RPOiBVcGRhdGUgcmVzb2x2ZVZhbHVlIHRvIHVzZSBuZXcgc3RyaW5nIHNlbWFudGljc1xuICBsZXQge3RhYmxlOnRhYmxlRWxlbX0gPSBlbGVtO1xuICBsZXQge3N1YmplY3QsIGZpZWxkTWFwLCBzdGF0ZX0gPSB0YWJsZUVsZW07XG4gIGxldCBjaGFpbjphbnkgPSBkaXNwYXRjaChcInJlcmVuZGVyXCIpO1xuXG4gIC8vIEEgbmV3IGFkZGVyIGlzIGFkZGVkIGV2ZXJ5IHRpbWUgdGhlIHByZXZpb3VzIGFkZGVyIHdhcyBjaGFuZ2VzLCBzbyB0aGUgbGFzdCBvbmUgaXMgZW1wdHkuXG4gIGxldCBhZGRlcnMgPSBzdGF0ZS5hZGRlcnMuc2xpY2UoMCwgLTEpO1xuICBcbiAgaWYodGFibGVTdGF0ZVZhbGlkKHRhYmxlRWxlbSkpIHtcbiAgICBmb3IobGV0IGFkZGVyIG9mIGFkZGVycykge1xuICAgICAgY3JlYXRlRmFjdChjaGFpbiwgYWRkZXIsIHRhYmxlRWxlbSk7XG4gICAgfVxuXG4gICAgZm9yKGxldCB7ZmllbGQsIHByZXYsIHJvdywgdmFsdWV9IG9mIHN0YXRlLmNoYW5nZXMpIHtcbiAgICAgIGxldCBlbnRpdHkgPSByb3dbc3ViamVjdF07XG4gICAgICBkaXNwYXRjaChcInVwZGF0ZSBlbnRpdHkgYXR0cmlidXRlXCIsIHtlbnRpdHksIGF0dHJpYnV0ZTogZmllbGRNYXBbZmllbGRdLCBwcmV2LCB2YWx1ZX0pLmNvbW1pdCgpO1xuICAgIH1cblxuICAgIHN0YXRlLmFkZGVycyA9IFt7fV07XG4gICAgc3RhdGUuY2hhbmdlcyA9IFtdO1xuICAgIGNoYWluLmNvbW1pdCgpO1xuICB9IGVsc2Uge1xuICAgIGNvbnNvbGUud2FybihcIk9uZSBvciBtb3JlIGNoYW5nZXMgaXMgaW52YWxpZCwgc28gYWxsIGNoYW5nZXMgaGF2ZSBub3QgYmVlbiBjb21taXR0ZWRcIik7XG4gIH1cbn1cblxuZnVuY3Rpb24gY29tbWl0Q2hhbmdlc09uRW50ZXIoZXZlbnQ6S2V5Ym9hcmRFdmVudCwgZWxlbTpNYXBwZWRUYWJsZUVsZW0pIHtcbiAgaWYoZXZlbnQua2V5Q29kZSA9PT0gS0VZUy5FTlRFUikge1xuICAgIGxldCB0YXJnZXQgPSA8SFRNTEVsZW1lbnQ+ZXZlbnQudGFyZ2V0O1xuICAgIGlmKHRhcmdldCAmJiB0YXJnZXQuYmx1cikge1xuICAgICAgdGFyZ2V0LmJsdXIoKTtcbiAgICB9XG4gICAgY29tbWl0Q2hhbmdlcyhldmVudCwge3RhYmxlOiBlbGVtfSk7XG4gIH1cbn1cblxuaW50ZXJmYWNlIFRhYmxlRWxlbSBleHRlbmRzIFRhYmxlQm9keUVsZW0geyBzZWFyY2g/OiBzdHJpbmcgfVxuZXhwb3J0IGZ1bmN0aW9uIHRhYmxlKGVsZW06VGFibGVFbGVtKTpFbGVtZW50IHtcbiAgbGV0IHtzdGF0ZSwgcm93cywgZmllbGRzLCBncm91cHMsIGRpc2FibGVkLCBzb3J0YWJsZSwgZWRpdENlbGwsIGRhdGF9ID0gZWxlbTtcbiAgZWxlbS5jID0gYHRhYmxlLXdyYXBwZXIgdGFibGUgJHtlbGVtLmMgfHwgXCJcIn1gO1xuICBlbGVtLmNoaWxkcmVuID0gW1xuICAgIGVsZW0uc2VhcmNoID8ge3Q6IFwiaDJcIiwgdGV4dDogZWxlbS5zZWFyY2h9IDogdW5kZWZpbmVkLFxuICAgIHRhYmxlSGVhZGVyKHtzdGF0ZSwgZmllbGRzLCBncm91cHMsIHNvcnRhYmxlLCBkYXRhfSksXG4gICAgdGFibGVCb2R5KHtyb3dzLCBzdGF0ZSwgZmllbGRzLCBncm91cHMsIGRpc2FibGVkLCBzb3J0YWJsZSwgZWRpdENlbGwsIGRhdGF9KVxuICBdO1xuXG4gIHJldHVybiBlbGVtO1xufVxuLy8gQFRPRE86IENob29zZSBNYXBwZWRUYWJsZSBvciBUYWJsZSB3aGVuIGJha2luZyBzZWFyY2ggcGFuZVxuaW50ZXJmYWNlIE1hcHBlZFRhYmxlRWxlbSBleHRlbmRzIFRhYmxlRWxlbSB7IGVudGl0eT86IHN0cmluZywgc3ViamVjdDogc3RyaW5nLCBmaWVsZE1hcDoge1tmaWVsZDpzdHJpbmddOiBzdHJpbmd9LCBjb2xsZWN0aW9ucz86c3RyaW5nW10gfVxuZXhwb3J0IGZ1bmN0aW9uIG1hcHBlZFRhYmxlKGVsZW06TWFwcGVkVGFibGVFbGVtKTpFbGVtZW50IHtcbiAgbGV0IHtzdGF0ZSwgZW50aXR5LCBzdWJqZWN0LCBmaWVsZE1hcCwgY29sbGVjdGlvbnMsIGRhdGF9ID0gZWxlbTtcbiAgLy8gSWYgd2UncmUgbWFwcGVkIHRvIGFuIGVudGl0eSBzZWFyY2ggd2UgY2FuIG9ubHkgYWRkIG5ldyBhdHRyaWJ1dGVzIHRvIHRoYXQgZW50aXR5XG4gIGZvcihsZXQgYWRkZXIgb2Ygc3RhdGUuYWRkZXJzKSB7XG4gICAgaWYoZW50aXR5ICYmIGFkZGVyW3N1YmplY3RdICE9PSBlbnRpdHkpIHtcbiAgICAgIGFkZGVyW3N1YmplY3RdID0gZW50aXR5O1xuICAgIH1cbiAgfVxuICBpZighc3RhdGUuYWRkZXJDZWxsU3RhdGVzKSB7XG4gICAgc3RhdGUuYWRkZXJDZWxsU3RhdGVzID0gW107XG4gIH1cbiAgaWYoc3RhdGUuYWRkZXJzLmxlbmd0aCAhPT0gc3RhdGUuYWRkZXJDZWxsU3RhdGVzLmxlbmd0aCkge1xuICAgIGlmKHN0YXRlLmFkZGVycy5sZW5ndGggPiBzdGF0ZS5hZGRlckNlbGxTdGF0ZXMubGVuZ3RoKSB7XG4gICAgICBmb3IobGV0IGl4ID0gMDsgaXggPSBzdGF0ZS5hZGRlcnMubGVuZ3RoIC0gc3RhdGUuYWRkZXJDZWxsU3RhdGVzLmxlbmd0aDsgaXgrKykge1xuICAgICAgICBzdGF0ZS5hZGRlckNlbGxTdGF0ZXMucHVzaCh7fSk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHN0YXRlLmFkZGVyQ2VsbFN0YXRlcy5zcGxpY2Uoc3RhdGUuYWRkZXJzLmxlbmd0aCwgc3RhdGUuYWRkZXJDZWxsU3RhdGVzLmxlbmd0aCk7XG4gICAgfVxuICB9XG5cbiAgbGV0IHtyb3dzLCBmaWVsZHMsIGdyb3VwcywgZGlzYWJsZWQgPSBbc3ViamVjdF0sIHNvcnRhYmxlID0gdHJ1ZX0gPSBlbGVtO1xuICBsZXQgYWRkZXJDaGFuZ2VkID0gZW50aXR5ID8gY2hhbmdlQXR0cmlidXRlQWRkZXIgOiBjaGFuZ2VFbnRpdHlBZGRlcjtcbiAgbGV0IGFkZGVyRGlzYWJsZWQgPSBlbnRpdHkgPyBbc3ViamVjdF0gOiB1bmRlZmluZWQ7XG4gIGxldCBzdGF0ZVZhbGlkID0gdGFibGVTdGF0ZVZhbGlkKGVsZW0pO1xuXG4gIGVsZW0uYyA9IGB0YWJsZS13cmFwcGVyIG1hcHBlZC10YWJsZSAke2VsZW0uYyB8fCBcIlwifWA7XG4gIGVsZW0ua2V5ZG93biA9IGNvbW1pdENoYW5nZXNPbkVudGVyO1xuICBlbGVtLmNoaWxkcmVuID0gW1xuICAgIGVsZW0uc2VhcmNoID8ge3Q6IFwiaDJcIiwgdGV4dDogZWxlbS5zZWFyY2h9IDogdW5kZWZpbmVkLFxuICAgIHRhYmxlSGVhZGVyKHtzdGF0ZSwgZmllbGRzLCBncm91cHMsIHNvcnRhYmxlLCBkYXRhfSksXG4gICAgdGFibGVCb2R5KHtyb3dzLCBvdmVycmlkZXM6IHN0YXRlLmNoYW5nZXMsIHN0YXRlLCBmaWVsZHMsIGdyb3VwcywgZGlzYWJsZWQsIHNvcnRhYmxlLCBzdWJqZWN0LCBmaWVsZE1hcCwgZWRpdENlbGw6IHVwZGF0ZVJvd0F0dHJpYnV0ZSwgZGF0YX0pLFxuICAgIHtjOiBcInRhYmxlLWFkZGVyc1wiLCBjaGlsZHJlbjogc3RhdGUuYWRkZXJzLm1hcCgocm93LCBpeCkgPT4gdGFibGVBZGRlclJvdyh7XG4gICAgICByb3csXG4gICAgICBzdGF0ZSxcbiAgICAgIGNlbGxTdGF0ZXM6IHN0YXRlLmFkZGVyQ2VsbFN0YXRlc1tpeF0sXG4gICAgICBmaWVsZHMsXG4gICAgICBkaXNhYmxlZDogYWRkZXJEaXNhYmxlZCxcbiAgICAgIGNvbmZpcm06IGZhbHNlLFxuICAgICAgc3ViamVjdCxcbiAgICAgIGZpZWxkTWFwLFxuICAgICAgY29sbGVjdGlvbnMsXG4gICAgICBkYXRhLFxuICAgICAgZWRpdENlbGw6IGFkZGVyQ2hhbmdlZFxuICAgIH0pKX0sXG4gICAge2M6IGBpb24tY2hlY2ttYXJrLXJvdW5kIGNvbW1pdC1idG4gJHtzdGF0ZVZhbGlkID8gXCJ2YWxpZFwiIDogXCJpbnZhbGlkXCJ9YCwgdGFibGU6IGVsZW0sIGNsaWNrOiBzdGF0ZVZhbGlkICYmIGNvbW1pdENoYW5nZXN9XG4gIF07XG4gIFxuICByZXR1cm4gZWxlbTtcbn1cblxuaW50ZXJmYWNlIFRhYmxlRmlsdGVyRWxlbSBleHRlbmRzIEVsZW1lbnQgeyBrZXk6IHN0cmluZywgc29ydEZpZWxkcz86IHN0cmluZ1tdLCBzZWFyY2g/OiAoc2VhcmNoOnN0cmluZykgPT4gc3RyaW5nW118RWxlbWVudFtdIH1cbmV4cG9ydCBmdW5jdGlvbiB0YWJsZUZpbHRlcihlbGVtOlRhYmxlRmlsdGVyRWxlbSkge1xuICBsZXQge2tleSwgc2VhcmNoID0gdW5kZWZpbmVkLCBzb3J0RmllbGRzID0gdW5kZWZpbmVkfSA9IGVsZW07XG4gIGVsZW0uY2hpbGRyZW4gPSBbXTtcbiAgaWYoc29ydEZpZWxkcykge1xuICAgIGxldCBzdGF0ZSA9IF9zdGF0ZS53aWRnZXQudGFibGVba2V5XSB8fCB7c29ydEZpZWxkOiB1bmRlZmluZWQsIHNvcnREaXJlY3Rpb246IHVuZGVmaW5lZH07XG4gICAgbGV0IHNvcnRPcHRzID0gW107XG4gICAgZm9yKGxldCBmaWVsZCBvZiBzb3J0RmllbGRzKSB7XG4gICAgICBzb3J0T3B0cy5wdXNoKHt0OiBcIm9wdGlvblwiLCB0ZXh0OiByZXNvbHZlTmFtZShmaWVsZCksIHZhbHVlOiBmaWVsZCwgc2VsZWN0ZWQ6IGZpZWxkID09PSBzdGF0ZS5zb3J0RmllbGR9KTtcbiAgICB9XG4gICAgZWxlbS5jaGlsZHJlbi5wdXNoKHtjOiBcImZsZXgtZ3Jvd1wifSk7XG4gICAgZWxlbS5jaGlsZHJlbi5wdXNoKHtjOiBcInNvcnRcIiwgY2hpbGRyZW46IFtcbiAgICAgIHt0ZXh0OiBcIlNvcnQgYnlcIn0sXG4gICAgICB7dDogXCJzZWxlY3RcIiwgYzogXCJzZWxlY3Qtc29ydC1maWVsZCBzZWxlY3RcIiwgdmFsdWU6IHN0YXRlLnNvcnRGaWVsZCwgY2hpbGRyZW46IHNvcnRPcHRzLCBrZXksIGNoYW5nZTogc29ydFRhYmxlfSxcbiAgICAgIHtjOiBgdG9nZ2xlLXNvcnQtZGlyICR7c3RhdGUuc29ydERpcmVjdGlvbiA9PT0gLTEgPyBcImlvbi1hcnJvdy11cC1iXCIgOiBcImlvbi1hcnJvdy1kb3duLWJcIn1gLCBrZXksIGRpcmVjdGlvbjogLXN0YXRlLnNvcnREaXJlY3Rpb24gfHwgMSwgY2xpY2s6IHNvcnRUYWJsZX0sXG4gICAgXX0pO1xuICB9XG4gIGVsZW0uYyA9IGB0YWJsZS1maWx0ZXIgJHtlbGVtLmMgfHwgXCJcIn1gO1xuICByZXR1cm4gZWxlbTtcbn1cblxuaW50ZXJmYWNlIFVSTEVsZW0gZXh0ZW5kcyBFbGVtZW50IHsgdXJsOiBzdHJpbmcgfVxuZXhwb3J0IGZ1bmN0aW9uIGV4dGVybmFsTGluayhlbGVtOlVSTEVsZW0pIHtcbiAgZWxlbS50ID0gXCJhXCI7XG4gIGVsZW0uYyA9IGBsaW5rICR7ZWxlbS5jIHx8IFwiXCJ9YDtcbiAgZWxlbS5ocmVmID0gZWxlbS51cmw7XG4gIGVsZW0udGV4dCA9IGVsZW0udGV4dCB8fCBlbGVtLnVybDtcbiAgcmV0dXJuIGVsZW07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBleHRlcm5hbEltYWdlKGVsZW06VVJMRWxlbSkge1xuICBlbGVtLnQgPSBcImltZ1wiO1xuICBlbGVtLmMgPSBgaW1nICR7ZWxlbS5jIHx8IFwiXCJ9YDtcbiAgZWxlbS5zcmMgPSBlbGVtLnVybDtcbiAgcmV0dXJuIGVsZW07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBleHRlcm5hbFZpZGVvKGVsZW06VVJMRWxlbSkge1xuICBsZXQgZXh0ID0gZWxlbS51cmwuc2xpY2UoZWxlbS51cmwubGFzdEluZGV4T2YoXCIuXCIpKS50cmltKCkudG9Mb3dlckNhc2UoKTtcbiAgbGV0IGRvbWFpbiA9IGVsZW0udXJsLnNsaWNlKGVsZW0udXJsLmluZGV4T2YoXCIvL1wiKSArIDIpLnNwbGl0KFwiL1wiKVswXTtcbiAgbGV0IGlzRmlsZSA9IFtcIm1wNFwiLCBcIm9ndlwiLCBcIndlYm1cIiwgXCJtb3ZcIiwgXCJhdmlcIiwgXCJmbHZcIl0uaW5kZXhPZihleHQpICE9PSAtMTtcbiAgaWYoaXNGaWxlKSB7XG4gICAgZWxlbS50ID0gXCJ2aWRlb1wiO1xuICB9IGVsc2Uge1xuICAgIGVsZW0udCA9IFwiaWZyYW1lXCI7XG4gIH1cbiAgZWxlbS5jID0gYHZpZGVvICR7ZWxlbS5jIHx8IFwiXCJ9YDtcbiAgZWxlbS5zcmMgPSBlbGVtLnVybDtcbiAgZWxlbS5hbGxvd2Z1bGxzY3JlZW4gPSB0cnVlO1xuICByZXR1cm4gZWxlbTtcbn1cblxuLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbi8vIENvbnRhaW5lcnNcbi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5pbnRlcmZhY2UgQ29sbGFwc2libGVFbGVtIGV4dGVuZHMgRWxlbWVudCB7IGtleTpzdHJpbmcsIGhlYWRlcj86RWxlbWVudCwgb3Blbj86Ym9vbGVhbiB9XG5leHBvcnQgZnVuY3Rpb24gY29sbGFwc2libGUoZWxlbTpDb2xsYXBzaWJsZUVsZW0pOkVsZW1lbnQge1xuICBpZihlbGVtLmtleSA9PT0gdW5kZWZpbmVkKSB0aHJvdyBuZXcgRXJyb3IoXCJNdXN0IHNwZWNpZnkgYSBrZXkgdG8gbWFpbnRhaW4gY29sbGFwc2libGUgc3RhdGVcIik7XG4gIGxldCBzdGF0ZSA9IF9zdGF0ZS53aWRnZXQuY29sbGFwc2libGVbZWxlbS5rZXldIHx8IHtvcGVuOiBlbGVtLm9wZW4gIT09IHVuZGVmaW5lZCA/IGVsZW0ub3BlbiA6IHRydWV9O1xuICBsZXQgY29udGVudCA9IHtjaGlsZHJlbjogZWxlbS5jaGlsZHJlbn07XG4gIGxldCBoZWFkZXIgPSB7dDogXCJoZWFkZXJcIiwgY2hpbGRyZW46IFt7YzogXCJjb2xsYXBzZS10b2dnbGUgXCIgKyAoc3RhdGUub3BlbiA/IFwiaW9uLWNoZXZyb24tdXBcIiA6IFwiaW9uLWNoZXZyb24tZG93blwiKSwgY29sbGFwc2libGU6IGVsZW0ua2V5LCBvcGVuOiBzdGF0ZS5vcGVuLCBjbGljazogdG9nZ2xlQ29sbGFwc2V9LCBlbGVtLmhlYWRlcl19O1xuXG4gIGVsZW0uYyA9IGBjb2xsYXBzaWJsZSAke2VsZW0uYyB8fCBcIlwifWA7XG4gIGVsZW0uY2hpbGRyZW4gPSBbaGVhZGVyLCBzdGF0ZS5vcGVuID8gY29udGVudCA6IHVuZGVmaW5lZF07XG4gIHJldHVybiBlbGVtO1xufVxuXG5mdW5jdGlvbiB0b2dnbGVDb2xsYXBzZShldnQsIGVsZW0pIHtcbiAgZGlzcGF0Y2goXCJ0b2dnbGUgY29sbGFwc2VcIiwge2NvbGxhcHNpYmxlOiBlbGVtLmNvbGxhcHNpYmxlLCBvcGVuOiAhZWxlbS5vcGVufSk7XG59XG5cbmxldCBkaXJlY3RvcnlUaWxlTGF5b3V0czpNYXNvbnJ5TGF5b3V0W10gPSBbXG4gIHtzaXplOiA0LCBjOiBcImJpZ1wiLCBmb3JtYXQoZWxlbSkge1xuICAgIC8vIGVsZW0uY2hpbGRyZW4udW5zaGlmdFxuICAgIGVsZW0uY2hpbGRyZW4ucHVzaChcbiAgICAgIC8vIHt0ZXh0OiBgKCR7ZWxlbVtcInN0YXRzXCJdW2VsZW1bXCJzdGF0c1wiXS5iZXN0XX0gJHtlbGVtW1wic3RhdHNcIl0uYmVzdH0pYH1cbiAgICApO1xuICAgIHJldHVybiBlbGVtO1xuICB9fSxcbiAge3NpemU6IDIsIGM6IFwiZGV0YWlsZWRcIiwgZm9ybWF0KGVsZW0pIHtcbiAgICBlbGVtLmNoaWxkcmVuLnB1c2goXG4gICAgICAvLyB7dGV4dDogYCgke2VsZW1bXCJzdGF0c1wiXVtlbGVtW1wic3RhdHNcIl0uYmVzdF19ICR7ZWxlbVtcInN0YXRzXCJdLmJlc3R9KWB9XG4gICAgKTtcbiAgICByZXR1cm4gZWxlbTtcbiAgfX0sXG4gIHtzaXplOiAxLCBjOiBcIm5vcm1hbFwiLCBncm91cGVkOiAyfVxuXTtcbmxldCBkaXJlY3RvcnlUaWxlU3R5bGVzID0gW1widGlsZS1zdHlsZS0xXCIsIFwidGlsZS1zdHlsZS0yXCIsIFwidGlsZS1zdHlsZS0zXCIsIFwidGlsZS1zdHlsZS00XCIsIFwidGlsZS1zdHlsZS01XCIsIFwidGlsZS1zdHlsZS02XCIsIFwidGlsZS1zdHlsZS03XCJdO1xuXG4vLyBAVE9ETzogQ2xlYW4gdXAgZGlyZWN0b3J5IGVsZW1cbmludGVyZmFjZSBEaXJlY3RvcnlFbGVtIGV4dGVuZHMgRWxlbWVudCB7IGVudGl0aWVzOnN0cmluZ1tdLCBkYXRhPzphbnkgfVxuZXhwb3J0IGZ1bmN0aW9uIGRpcmVjdG9yeShlbGVtOkRpcmVjdG9yeUVsZW0pOkVsZW1lbnQge1xuICBsZXQga2V5ID0gXCJkaXJlY3Rvcnl8aG9tZVwiOyAvLyBAVE9ETzogRklYTUVcbiAgXG4gIGNvbnN0IE1BWF9FTlRJVElFU19CRUZPUkVfT1ZFUkZMT1cgPSAxNDtcbiAgbGV0IHtlbnRpdGllczpyYXdFbnRpdGllcywgZGF0YSA9IHVuZGVmaW5lZH0gPSBlbGVtO1xuICBsZXQge3N5c3RlbXMsIGNvbGxlY3Rpb25zLCBlbnRpdGllcywgc2NvcmVzLCByZWxhdGVkQ291bnRzLCB3b3JkQ291bnRzLCBjaGlsZENvdW50c30gPSBjbGFzc2lmeUVudGl0aWVzKHJhd0VudGl0aWVzKTtcbiAgbGV0IHNvcnRCeVNjb3JlcyA9IHNvcnRCeUxvb2t1cChzY29yZXMpO1xuICBlbnRpdGllcy5zb3J0KHNvcnRCeVNjb3Jlcyk7XG4gIGNvbGxlY3Rpb25zLnNvcnQoc29ydEJ5U2NvcmVzKTtcbiAgc3lzdGVtcy5zb3J0KHNvcnRCeVNjb3Jlcyk7XG5cbiAgbGV0IGNvbGxlY3Rpb25UYWJsZVN0YXRlID0gX3N0YXRlLndpZGdldC50YWJsZVtgJHtrZXl9fGNvbGxlY3Rpb25zIHRhYmxlYF0gfHwge3NvcnRGaWVsZDogXCJzY29yZVwiLCBzb3J0RGlyZWN0aW9uOiAtMSwgYWRkZXJzOiBbXX07XG4gIF9zdGF0ZS53aWRnZXQudGFibGVbYCR7a2V5fXxjb2xsZWN0aW9ucyB0YWJsZWBdID0gY29sbGVjdGlvblRhYmxlU3RhdGU7XG4gIGxldCBlbnRpdHlUYWJsZVN0YXRlID0gX3N0YXRlLndpZGdldC50YWJsZVtgJHtrZXl9fGVudGl0aWVzIHRhYmxlYF0gfHwge3NvcnRGaWVsZDogXCJzY29yZVwiLCBzb3J0RGlyZWN0aW9uOiAtMSwgYWRkZXJzOiBbXX07XG4gIF9zdGF0ZS53aWRnZXQudGFibGVbYCR7a2V5fXxlbnRpdGllcyB0YWJsZWBdID0gZW50aXR5VGFibGVTdGF0ZTtcbiAgXG4gIC8vIExpbmsgdG8gZW50aXR5XG4gIC8vIFBlZWsgd2l0aCBtb3N0IHNpZ25pZmljYW50IHN0YXRpc3RpYyAoZS5nLiAxMyByZWxhdGVkOyBvciAxNCBjaGlsZHJlbnBhZ2VzOyBvciA1MDAwIHdvcmRzKVxuICAvLyBTbGlkZXIgcGFuZSB3aWxsIGFsbCBzdGF0aXN0aWNzXG4gIC8vIENsaWNrIG9wZW5zIHBvcHVwIHByZXZpZXdcblxuICBmdW5jdGlvbiBnZXRTdGF0cyhlbnRpdHkpIHtcbiAgICBsZXQgc3RhdHMgPSB7bmFtZTogZW50aXR5LCBiZXN0OlwiXCIsIGxpbmtzOiByZWxhdGVkQ291bnRzW2VudGl0eV0sIHBhZ2VzOiBjaGlsZENvdW50c1tlbnRpdHldLCB3b3Jkczogd29yZENvdW50c1tlbnRpdHldfTtcbiAgICBsZXQgbWF4Q29udHJpYnV0aW9uID0gMDtcbiAgICBmb3IobGV0IHN0YXQgaW4gc3RhdHMpIHtcbiAgICAgIGlmKCFzdGF0V2VpZ2h0c1tzdGF0XSkgY29udGludWU7XG4gICAgICBsZXQgY29udHJpYnV0aW9uID0gc3RhdHNbc3RhdF0gKiBzdGF0V2VpZ2h0c1tzdGF0XTtcbiAgICAgIGlmKGNvbnRyaWJ1dGlvbiA+IG1heENvbnRyaWJ1dGlvbikge1xuICAgICAgICBtYXhDb250cmlidXRpb24gPSBjb250cmlidXRpb247XG4gICAgICAgIHN0YXRzLmJlc3QgPSBzdGF0O1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gc3RhdHM7XG4gIH1cbiAgXG4gIGZ1bmN0aW9uIGZvcm1hdFRpbGUoZW50aXR5KSB7XG4gICAgbGV0IHN0YXRzID0gZ2V0U3RhdHMoZW50aXR5KTtcbiAgICByZXR1cm4ge3NpemU6IHNjb3Jlc1tlbnRpdHldLCBzdGF0cywgY2hpbGRyZW46IFtcbiAgICAgIGxpbmsoe2VudGl0eSwgZGF0YSwgbmFtZUFzQ2hpbGQ6IHRydWV9KVxuICAgIF19O1xuICB9XG5cbiAgZnVuY3Rpb24gZm9ybWF0TGlzdChuYW1lOnN0cmluZywgZW50aXRpZXM6c3RyaW5nW10sIHN0YXRlKSB7XG4gICAgbGV0IHNvcnRPcHRzID0gW107XG4gICAgZm9yKGxldCBmaWVsZCBvZiBbXCJzY29yZVwiLCBcImxpbmtzXCIsIFwid29yZHNcIl0pIHtcbiAgICAgIHNvcnRPcHRzLnB1c2goe3Q6IFwib3B0aW9uXCIsIHRleHQ6IHJlc29sdmVOYW1lKGZpZWxkKSwgdmFsdWU6IGZpZWxkLCBzZWxlY3RlZDogZmllbGQgPT09IHN0YXRlLnNvcnRGaWVsZH0pO1xuICAgIH1cblxuICAgIHJldHVybiB7YzogXCJkaXJlY3RvcnktbGlzdCBmbGV4LWdyb3cgZmxleC1yb3dcIiwgY2hpbGRyZW46IFtcbiAgICAgIGNvbGxhcHNpYmxlKHtjOiBcImZsZXgtZ3Jvd1wiLCBrZXk6IGAke2tleX18JHtuYW1lfSBjb2xsYXBzaWJsZWAsIGhlYWRlcjoge3RleHQ6IGBTaG93IGFsbCAke25hbWV9YH0sIG9wZW46IGZhbHNlLCBjaGlsZHJlbjogW1xuICAgICAgICB7YzogXCJmbGV4LXJvd1wiLCBjaGlsZHJlbjogW1xuICAgICAgICAgIHtjOiBcInRhYmxlLXdyYXBwZXJcIiwgY2hpbGRyZW46IFtcbiAgICAgICAgICAgIHRhYmxlQm9keSh7cm93czogZW50aXRpZXMubWFwKGdldFN0YXRzKSwgZmllbGRzOiBbXCJuYW1lXCJdLmNvbmNhdChbc3RhdGUuc29ydEZpZWxkXSB8fCBbXSksIHNvcnRhYmxlOiBmYWxzZSwgc3RhdGUsIGRhdGF9KSxcbiAgICAgICAgICBdfSxcbiAgICAgICAgICB7dDogXCJzZWxlY3RcIiwgYzogXCJzZWxlY3Qtc29ydC1maWVsZCBzZWxlY3RcIiwgdmFsdWU6IHN0YXRlLnNvcnRGaWVsZCwgdGFibGU6IHtzdGF0ZX0sIGNoaWxkcmVuOiBzb3J0T3B0cywgY2hhbmdlOiBzb3J0VGFibGV9LFxuICAgICAgICBdfVxuICAgICAgXX0pXG4gICAgXX07XG4gIH1cblxuICBjb2xsZWN0aW9ucyA9IGNvbGxlY3Rpb25zLmZpbHRlcigoY29sbCkgPT4gYXNFbnRpdHkoXCJ0ZXN0IGRhdGFcIikgIT09IGNvbGwpO1xuICBsZXQgaGlnaGxpZ2h0cyA9IGNvbGxlY3Rpb25zLnNsaWNlKDAsIDQpLmNvbmNhdChlbnRpdGllcy5zbGljZSgwLCA0KSk7XG4gIHJldHVybiB7YzogXCJkaXJlY3RvcnkgZmxleC1jb2x1bW5cIiwgY2hpbGRyZW46IFtcbiAgICB7YzogXCJoZWFkZXJcIiwgY2hpbGRyZW46IFtcbiAgICAgIHt0ZXh0OiBcIkhvbWVcIn0sXG4gICAgXX0sXG4gICAge2M6IFwidGlsZS1zY3JvbGxcIiwgY2hpbGRyZW46IFtcbiAgICAgIHtjOiBcInRpbGVzXCIsIGNoaWxkcmVuOiBbXG4gICAgICAgIHtjOiBcInJvdyBmbGV4LXJvd1wiLCBjaGlsZHJlbjogW1xuICAgICAgICAgIHtjOiBcInRpbGUgZnVsbFwiLCBjaGlsZHJlbjogW1xuICAgICAgICAgICAge2M6IFwidGlsZS1jb250ZW50LXdyYXBwZXJcIiwgY2hpbGRyZW46IFtcbiAgICAgICAgICAgICAge2M6IFwidmFsdWUgdGV4dFwiLCBjaGlsZHJlbjogW1xuICAgICAgICAgICAgICAgIHt0ZXh0OiBcIldlbGNvbWUgdG8gRXZlISBIZXJlIGFyZSBzb21lIG9mIHRoZSBjYXJkcyBjdXJyZW50bHkgaW4gdGhlIHN5c3RlbTpcIn1cbiAgICAgICAgICAgICAgXX1cbiAgICAgICAgICAgIC8vIEBUT0RPOiBib2R5IGNvcHkuXG4gICAgICAgICAgICBdfVxuICAgICAgICAgIF19LFxuICAgICAgICBdfSxcbiAgICAgICAge2M6IFwicm93IGZsZXgtcm93XCIsIGNoaWxkcmVuOiBbXG4gICAgICAgICAgbWFzb25yeSh7YzogXCJkaXJlY3RvcnktaGlnaGxpZ2h0c1wiLCByb3dTaXplOiA2LCBsYXlvdXRzOiBkaXJlY3RvcnlUaWxlTGF5b3V0cywgc3R5bGVzOiBkaXJlY3RvcnlUaWxlU3R5bGVzLCBjaGlsZHJlbjogaGlnaGxpZ2h0cy5tYXAoZm9ybWF0VGlsZSl9KSxcbiAgICAgICAgXX1cbiAgICAgIF19XG4gICAgXX1cbiAgICAvLyB7YzogXCJkaXJlY3RvcnktbGlzdHMgZmxleC1yb3dcIiwgY2hpbGRyZW46IFtcbiAgICAvLyAgIGZvcm1hdExpc3QoXCJjb2xsZWN0aW9uc1wiLCBjb2xsZWN0aW9ucywgY29sbGVjdGlvblRhYmxlU3RhdGUpLFxuICAgIC8vICAgZm9ybWF0TGlzdChcImVudGl0aWVzXCIsIGVudGl0aWVzLCBlbnRpdHlUYWJsZVN0YXRlKVxuICAgIC8vIF19XG4gIF19O1xufVxuXG5leHBvcnQgdmFyIG1hc29ucnkgPSBtYXNvbnJ5UmF3O1xuXG4iLCJpbXBvcnQge3Y0IGFzIF91dWlkfSBmcm9tIFwiLi4vdmVuZG9yL3V1aWRcIjtcbmV4cG9ydCB2YXIgdXVpZCA9IF91dWlkO1xuXG5leHBvcnQgdmFyIEVOViA9IFwiYnJvd3NlclwiO1xudHJ5IHtcbiAgd2luZG93XG4gIHdpbmRvd1tcInV0aWxzXCJdID0gZXhwb3J0cztcbn0gY2F0Y2goZXJyKSB7XG4gIEVOViA9IFwibm9kZVwiO1xufVxuXG5leHBvcnQgdmFyIERFQlVHOmFueSA9IHtcblxufTtcblxuaWYoRU5WID09PSBcImJyb3dzZXJcIikgd2luZG93W1wiREVCVUdcIl0gPSBERUJVRztcblxuZXhwb3J0IGZ1bmN0aW9uIGJ1aWx0aW5JZChuYW1lOnN0cmluZyk6c3RyaW5nIHtcbiAgcmV0dXJuIGBBVVRPR0VORVJBVEVEICR7bmFtZX0gVEhJUyBTSE9VTEROJ1QgU0hPVyBVUCBBTllXSEVSRWA7XG59XG5cbnR5cGUgVGVtcGxhdGVTdHJpbmdUYWcgPSAoc3RyaW5nczpzdHJpbmdbXSwgLi4udmFsdWVzOmFueVtdKSA9PiBzdHJpbmdcbmludGVyZmFjZSB1bnBhZCB7XG4gIChpbmRlbnQ6bnVtYmVyKTogVGVtcGxhdGVTdHJpbmdUYWdcbiAgbWVtbzoge1tpbmRlbnQ6bnVtYmVyXTogVGVtcGxhdGVTdHJpbmdUYWd9XG59XG5leHBvcnQgdmFyIHVucGFkOnVucGFkID0gPGFueT5mdW5jdGlvbihpbmRlbnQpIHtcbiAgaWYodW5wYWQubWVtb1tpbmRlbnRdKSByZXR1cm4gdW5wYWQubWVtb1tpbmRlbnRdO1xuICByZXR1cm4gdW5wYWQubWVtb1tpbmRlbnRdID0gZnVuY3Rpb24oc3RyaW5ncywgLi4udmFsdWVzKSB7XG4gICAgaWYoIXN0cmluZ3MubGVuZ3RoKSByZXR1cm47XG4gICAgbGV0IHJlcyA9IFwiXCI7XG4gICAgbGV0IGl4ID0gMDtcbiAgICBmb3IobGV0IHN0ciBvZiBzdHJpbmdzKSByZXMgKz0gc3RyICsgKHZhbHVlcy5sZW5ndGggPiBpeCA/IHZhbHVlc1tpeCsrXSA6IFwiXCIpO1xuXG4gICAgaWYocmVzWzBdID09PSBcIlxcblwiKSByZXMgPSByZXMuc2xpY2UoMSk7XG4gICAgbGV0IGNoYXJJeCA9IDA7XG4gICAgd2hpbGUodHJ1ZSkge1xuICAgICAgcmVzID0gcmVzLnNsaWNlKDAsIGNoYXJJeCkgKyByZXMuc2xpY2UoY2hhckl4ICsgaW5kZW50KTtcbiAgICAgIGNoYXJJeCA9IHJlcy5pbmRleE9mKFwiXFxuXCIsIGNoYXJJeCkgKyAxO1xuICAgICAgaWYoIWNoYXJJeCkgYnJlYWs7XG4gICAgfVxuICByZXR1cm4gcmVzO1xuICB9XG59O1xudW5wYWQubWVtbyA9IHt9O1xuXG5leHBvcnQgZnVuY3Rpb24gcmVwZWF0KHN0cjpzdHJpbmcsIGxlbmd0aDpudW1iZXIpIHtcbiAgbGV0IGxlbiA9IGxlbmd0aCAvIHN0ci5sZW5ndGg7XG4gIGxldCByZXMgPSBcIlwiO1xuICBmb3IobGV0IGl4ID0gMDsgaXggPCBsZW47IGl4KyspICByZXMgKz0gc3RyO1xuICByZXR1cm4gKHJlcy5sZW5ndGggPiBsZW5ndGgpID8gcmVzLnNsaWNlKDAsIGxlbmd0aCkgOiByZXM7XG59XG5leHBvcnQgZnVuY3Rpb24gdW5kZXJsaW5lKHN0YXJ0SXgsIGxlbmd0aCkge1xuICByZXR1cm4gcmVwZWF0KFwiIFwiLCBzdGFydEl4KSArIFwiXlwiICsgcmVwZWF0KFwiflwiLCBsZW5ndGggLSAxKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNhcGl0YWxpemUod29yZDpzdHJpbmcpOnN0cmluZyB7XG4gIHJldHVybiB3b3JkWzBdLnRvVXBwZXJDYXNlKCkgKyB3b3JkLnNsaWNlKDEpXG59XG5cbmV4cG9ydCBmdW5jdGlvbiB0aXRsZWNhc2UobmFtZTpzdHJpbmcpOnN0cmluZyB7XG4gIHJldHVybiBuYW1lLnNwbGl0KFwiIFwiKS5tYXAoY2FwaXRhbGl6ZSkuam9pbihcIiBcIik7XG59XG5cbmxldCBfc2x1Z2lmeVJlcGxhY2VtZW50cyA9IHtcbiAgXCItXCI6IFwiZGFzaFwiLFxuICBcIl9cIjogXCJ1bmRlclwiLFxuICBcIiRcIjogXCJkb2xsYXJcIixcbiAgXCImXCI6IFwiYW5kXCIsXG4gIFwiK1wiOiBcInBsdXNcIixcbiAgXCIsXCI6IFwiY29tbWFcIixcbiAgXCIvXCI6IFwic2xhc2hcIixcbiAgXCI6XCI6IFwiY29sb25cIixcbiAgXCI7XCI6IFwic2VtaWNvbG9uXCIsXG4gIFwiPVwiOiBcImVxdWFsc1wiLFxuICBcIj9cIjogXCJxdWVzdGlvblwiLFxuICBcIkBcIjogXCJhdFwiLFxuICBcIjxcIjogXCJsdFwiLFxuICBcIj5cIjogXCJndFwiLFxuICBcIiNcIjogXCJoYXNoXCIsXG4gIFwiJVwiOiBcInBlcmNlbnRcIixcbiAgXCJ7XCI6IFwib3BlbmN1cmx5XCIsXG4gIFwifVwiOiBcImNsb3NlY3VybHlcIixcbiAgXCJ8XCI6IFwicGlwZVwiLFxuICBcIlxcXFxcIjogXCJ3aGFja1wiLFxuICBcIl5cIjogXCJjYXJldFwiLFxuICBcIn5cIjogXCJ0aWxkZVwiLFxuICBcIltcIjogXCJvcGVuYnJhY2tldFwiLFxuICBcIl1cIjogXCJjbG9zZWJyYWNrZXRcIixcbiAgXCJgXCI6IFwiZ3JhdmVcIlxufTtcbmxldCBfZGVzbHVnaWZ5UmVwbGFjZW1lbnRzID0ge307XG5mb3IobGV0IGNoYXIgaW4gX3NsdWdpZnlSZXBsYWNlbWVudHMpIHtcbiAgX2Rlc2x1Z2lmeVJlcGxhY2VtZW50c1tfc2x1Z2lmeVJlcGxhY2VtZW50c1tjaGFyXV0gPSBjaGFyO1xufVxuXG4vLyBTbHVnaWZ5IGVuY29kZXMgYSB1cmkgY29tcG9uZW50IGluIGEgZmFpcmx5IGh1bWFuIHJlYWRhYmxlIGZhc2hpb25cbmV4cG9ydCBmdW5jdGlvbiBzbHVnaWZ5KHRleHQ6c3RyaW5nKTpzdHJpbmcge1xuICBsZXQgdXJsID0gXCJcIjtcbiAgZm9yKGxldCBjaGFyIG9mIHRleHQpIHtcbiAgICBsZXQgcmVwbGFjZW1lbnQgPSBfc2x1Z2lmeVJlcGxhY2VtZW50c1tjaGFyXTtcbiAgICBpZihjaGFyID09PSBcIiBcIikge1xuICAgICAgdXJsICs9IFwiX1wiO1xuICAgICAgXG4gICAgfSBlbHNlIGlmKHJlcGxhY2VtZW50KSB7XG4gICAgICB1cmwgKz0gYC0nJHtyZXBsYWNlbWVudH0tYDtcbiAgICAgIFxuICAgIH0gZWxzZSB7XG4gICAgICB1cmwgKz0gY2hhcjtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGVuY29kZVVSSUNvbXBvbmVudCh1cmwpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZGVzbHVnaWZ5KHVybDpzdHJpbmcpOnN0cmluZyB7XG4gIGxldCB0ZXh0ID0gW107XG4gIGZvcihsZXQgd29yZCBvZiB1cmwuc3BsaXQoXCJfXCIpKSB7XG4gICAgaWYod29yZC5pbmRleE9mKFwiLVwiKSA9PT0gLTEpIHtcbiAgICAgIHRleHQucHVzaCh3b3JkKTtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cblxuICAgIGxldCByZXBsYWNlZCA9IFwiXCI7XG4gICAgbGV0IHRva2VucyA9IHdvcmQuc3BsaXQoXCItXCIpO1xuICAgIHJlcGxhY2VkICs9IHRva2Vucy5zaGlmdCgpO1xuICAgIGxldCB0YWlsID0gdG9rZW5zLnBvcCgpO1xuICAgIGZvcihsZXQgdG9rZW4gb2YgdG9rZW5zKSB7XG4gICAgICBsZXQgcmVwbGFjZW1lbnQgPSBfZGVzbHVnaWZ5UmVwbGFjZW1lbnRzW3Rva2VuLnNsaWNlKDEpXTtcbiAgICAgIGlmKHJlcGxhY2VtZW50ICYmIHRva2VuLmluZGV4T2YoXCInXCIpID09PSAwKSB7XG4gICAgICAgIHJlcGxhY2VkICs9IHJlcGxhY2VtZW50O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmVwbGFjZWQgKz0gdG9rZW47XG4gICAgICB9XG4gICAgfVxuICAgIHJlcGxhY2VkICs9IHRhaWw7XG4gICAgdGV4dC5wdXNoKHJlcGxhY2VkKTtcbiAgfVxuXG4gIHJldHVybiBkZWNvZGVVUklDb21wb25lbnQodGV4dC5qb2luKFwiIFwiKSk7XG59XG5cbmV4cG9ydCB2YXIgc3RyaW5nID0ge1xuICB1bnBhZCxcbiAgcmVwZWF0LFxuICB1bmRlcmxpbmUsXG4gIGNhcGl0YWxpemUsXG4gIHRpdGxlY2FzZSxcbiAgc2x1Z2lmeSxcbiAgZGVzbHVnaWZ5XG59O1xuXG5leHBvcnQgZnVuY3Rpb24gdGFpbChhcnIpIHtcbiAgcmV0dXJuIGFyclthcnIubGVuZ3RoIC0gMV07XG59XG5cbmV4cG9ydCB2YXIgYXJyYXkgPSB7XG4gIHRhaWxcbn07XG5cbmV4cG9ydCBmdW5jdGlvbiBjb2VyY2VJbnB1dChpbnB1dCkge1xuICAvLyBodHRwOi8vanNwZXJmLmNvbS9yZWdleC12cy1wbHVzLWNvZXJjaW9uXG4gIGlmKGlucHV0ID09PSBcIlwiKSByZXR1cm4gaW5wdXQ7XG4gIGVsc2UgaWYodHlwZW9mIGlucHV0ID09PSBcIm9iamVjdFwiKSByZXR1cm4gaW5wdXQ7XG4gIGVsc2UgaWYgKCFpc05hTigraW5wdXQpKSByZXR1cm4gK2lucHV0O1xuICBlbHNlIGlmIChpbnB1dCA9PT0gXCJ0cnVlXCIpIHJldHVybiB0cnVlO1xuICBlbHNlIGlmIChpbnB1dCA9PT0gXCJmYWxzZVwiKSByZXR1cm4gZmFsc2U7XG4gIHJldHVybiBpbnB1dDtcbn1cblxuLy8gU2hhbGxvdyBjb3B5IHRoZSBnaXZlbiBvYmplY3QuXG5leHBvcnQgZnVuY3Rpb24gY29weShvYmopIHtcbiAgaWYoIW9iaiB8fCB0eXBlb2Ygb2JqICE9PSBcIm9iamVjdFwiKSByZXR1cm4gb2JqO1xuICBpZihvYmogaW5zdGFuY2VvZiBBcnJheSkgcmV0dXJuIG9iai5zbGljZSgpO1xuICBsZXQgcmVzID0ge307XG4gIGZvcihsZXQga2V5IGluIG9iaikgcmVzW2tleV0gPSBvYmpba2V5XTtcbiAgcmV0dXJuIHJlcztcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIG1lcmdlT2JqZWN0KHJvb3QsIG9iaikge1xuICBmb3IobGV0IGtleSBpbiBvYmopIHtcbiAgICByb290W2tleV0gPSBvYmpba2V5XTtcbiAgfVxuICByZXR1cm4gcm9vdDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGF1dG9Gb2N1cyhub2RlLCBlbGVtKSB7XG4gIGlmKCFub2RlLmZvY3VzZWQpIHtcbiAgICBub2RlLmZvY3VzZWQgPSB0cnVlO1xuICAgIG5vZGUuZm9jdXMoKTtcbiAgfVxufVxuXG5leHBvcnQgdmFyIEtFWVMgPSB7XG4gIEVTQzogMjcsXG4gIEVOVEVSOiAxMyxcbiAgVVA6IDM4LFxuICBET1dOOiA0MCxcbiAgQkFDS1NQQUNFOiA4LFxuICBcIl1cIjogMjIxLFxufVxuXG4vLyBGUk9NOiBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzExMjUyOTIvaG93LXRvLW1vdmUtY3Vyc29yLXRvLWVuZC1vZi1jb250ZW50ZWRpdGFibGUtZW50aXR5LzM4NjY0NDIjMzg2NjQ0MlxuZXhwb3J0IGZ1bmN0aW9uIHNldEVuZE9mQ29udGVudEVkaXRhYmxlKGNvbnRlbnRFZGl0YWJsZUVsZW1lbnQpIHtcbiAgdmFyIHJhbmdlLHNlbGVjdGlvbjtcbiAgaWYoZG9jdW1lbnQuY3JlYXRlUmFuZ2UpLy9GaXJlZm94LCBDaHJvbWUsIE9wZXJhLCBTYWZhcmksIElFIDkrXG4gIHtcbiAgICByYW5nZSA9IGRvY3VtZW50LmNyZWF0ZVJhbmdlKCk7Ly9DcmVhdGUgYSByYW5nZSAoYSByYW5nZSBpcyBhIGxpa2UgdGhlIHNlbGVjdGlvbiBidXQgaW52aXNpYmxlKVxuICAgIHJhbmdlLnNlbGVjdE5vZGVDb250ZW50cyhjb250ZW50RWRpdGFibGVFbGVtZW50KTsvL1NlbGVjdCB0aGUgZW50aXJlIGNvbnRlbnRzIG9mIHRoZSBlbGVtZW50IHdpdGggdGhlIHJhbmdlXG4gICAgcmFuZ2UuY29sbGFwc2UoZmFsc2UpOy8vY29sbGFwc2UgdGhlIHJhbmdlIHRvIHRoZSBlbmQgcG9pbnQuIGZhbHNlIG1lYW5zIGNvbGxhcHNlIHRvIGVuZCByYXRoZXIgdGhhbiB0aGUgc3RhcnRcbiAgICBzZWxlY3Rpb24gPSB3aW5kb3cuZ2V0U2VsZWN0aW9uKCk7Ly9nZXQgdGhlIHNlbGVjdGlvbiBvYmplY3QgKGFsbG93cyB5b3UgdG8gY2hhbmdlIHNlbGVjdGlvbilcbiAgICBzZWxlY3Rpb24ucmVtb3ZlQWxsUmFuZ2VzKCk7Ly9yZW1vdmUgYW55IHNlbGVjdGlvbnMgYWxyZWFkeSBtYWRlXG4gICAgc2VsZWN0aW9uLmFkZFJhbmdlKHJhbmdlKTsvL21ha2UgdGhlIHJhbmdlIHlvdSBoYXZlIGp1c3QgY3JlYXRlZCB0aGUgdmlzaWJsZSBzZWxlY3Rpb25cbiAgfVxufVxuXG4vLyBMQ0cgY291cnRlc3kgb2YgPGh0dHBzOi8vZ2lzdC5naXRodWIuY29tL1Byb3RvbmsvNTM4OTM4ND5cbmV4cG9ydCBmdW5jdGlvbiBzcmFuZCh6KSB7XG4gIGxldCBtID0gTWF0aC5wb3coMiwgMjQpLCBhID0gMTY1OTgwMTMsIGMgPSAxMjgyMDE2MztcbiAgcmV0dXJuICgpID0+IHogPSAoYSAqIHogKyBjKSAlIG0gLyBtO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gc2h1ZmZsZShhcnI6YW55W10sIHJhbmQgPSBNYXRoLnJhbmRvbSkge1xuICBmb3IobGV0IGkgPSBhcnIubGVuZ3RoIC0gMTsgaSA+IDA7IGkgLT0gMSkge1xuICAgIGxldCBqID0gTWF0aC5mbG9vcihyYW5kKCkgKiAoaSArIDEpKTtcbiAgICBsZXQgdG1wID0gYXJyW2ldO1xuICAgIGFycltpXSA9IGFycltqXTtcbiAgICBhcnJbal0gPSB0bXA7XG4gIH1cbiAgcmV0dXJuIGFycjtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHNvcnRCeUZpZWxkKGZpZWxkLCBkaXJlY3Rpb24gPSAxKTooYSwgYikgPT4gbnVtYmVyIHtcbiAgbGV0IGJhY2sgPSAtMSAqIGRpcmVjdGlvbjtcbiAgbGV0IGZ3ZCA9IGRpcmVjdGlvbjtcbiAgcmV0dXJuIChhLCBiKSA9PlxuICAgIChhW2ZpZWxkXSA9PT0gYltmaWVsZF0pID8gMCA6XG4gICAgKGFbZmllbGRdID4gYltmaWVsZF0pID8gYmFjayA6XG4gICAgKGFbZmllbGRdIDwgYltmaWVsZF0pID8gZndkIDpcbiAgICAoYVtmaWVsZF0gPT09IHVuZGVmaW5lZCkgPyBmd2QgOiBiYWNrO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHNvcnRCeUxvb2t1cChsb29rdXA6e30sIGRpcmVjdGlvbiA9IDEpOihhLCBiKSA9PiBudW1iZXIge1xuICBsZXQgYmFjayA9IC0xICogZGlyZWN0aW9uO1xuICBsZXQgZndkID0gZGlyZWN0aW9uO1xuICByZXR1cm4gKGEsIGIpID0+XG4gICAgKGxvb2t1cFthXSA9PT0gbG9va3VwW2JdKSA/IDAgOlxuICAgIChsb29rdXBbYV0gPiBsb29rdXBbYl0pID8gYmFjayA6XG4gICAgKGxvb2t1cFthXSA8IGxvb2t1cFtiXSkgPyBmd2QgOlxuICAgIChsb29rdXBbYV0gPT09IHVuZGVmaW5lZCkgPyBmd2QgOiBiYWNrO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gbG9jYXRpb24oKSB7XG4gIHJldHVybiB3aW5kb3cubG9jYXRpb24uaGFzaC5zbGljZSgxKTtcbn1cbiIsIlwidXNlIHN0cmljdFwiXG5cbmltcG9ydCAqIGFzIGFwcCBmcm9tIFwiLi9hcHBcIjtcbmltcG9ydCAqIGFzIGJvb3RzdHJhcCBmcm9tIFwiLi9ib290c3RyYXBcIjtcbmltcG9ydCAqIGFzIHVpIGZyb20gXCIuL3VpXCI7XG5pbXBvcnQge2Rlc2x1Z2lmeSwgbG9jYXRpb24gYXMgZ2V0TG9jYXRpb259IGZyb20gXCIuL3V0aWxzXCI7XG5cblxuYXBwLnJlbmRlclJvb3RzW1wid2lraVwiXSA9IHVpLnJvb3Q7XG5cbi8vIEBIQUNLOiB3ZSBoYXZlIHRvIHVzZSBib290c3RyYXAgaW4gc29tZSB3YXkgdG8gZ2V0IGl0IHRvIGFjdHVhbGx5IGJlIGluY2x1ZGVkIGFuZFxuLy8gZXhlY3V0ZWRcbnZhciBpeGVyID0gYm9vdHN0cmFwLml4ZXI7XG5cbmZ1bmN0aW9uIGluaXRTZWFyY2hlcyhldmUpIHtcbiAgZm9yKGxldCBwYW5lIG9mIGV2ZS5maW5kKFwidWkgcGFuZVwiKSkge1xuICAgIGlmKGV2ZS5maW5kT25lKFwiZW50aXR5XCIsIHtlbnRpdHk6IHBhbmUuY29udGFpbnN9KSkgY29udGludWU7XG4gIH1cbn1cblxuYXBwLmluaXQoXCJ3aWtpXCIsIGZ1bmN0aW9uKCkge1xuICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5hZGQobG9jYWxTdG9yYWdlW1widGhlbWVcIl0gfHwgXCJsaWdodFwiKTtcbiAgYXBwLmFjdGl2ZVNlYXJjaGVzID0ge307XG4gIGluaXRTZWFyY2hlcyhhcHAuZXZlKTtcblxuICB3aW5kb3cuaGlzdG9yeS5yZXBsYWNlU3RhdGUoe3Jvb3Q6IHRydWV9LCBudWxsLCB3aW5kb3cubG9jYXRpb24uaGFzaCk7XG4gIGxldCBtYWluUGFuZSA9IGFwcC5ldmUuZmluZE9uZShcInVpIHBhbmVcIiwge3BhbmU6IFwicDFcIn0pO1xuICBsZXQgcGF0aCA9IGdldExvY2F0aW9uKCk7XG4gIGxldCBbXywga2luZCwgcmF3ID0gXCJcIl0gPSBwYXRoLnNwbGl0KFwiL1wiKTtcbiAgbGV0IGNvbnRlbnQgPSBkZXNsdWdpZnkocmF3KSB8fCBcImhvbWVcIjtcbiAgbGV0IGN1ciA9IGFwcC5kaXNwYXRjaChcInNldCBwYW5lXCIsIHtwYW5lSWQ6IG1haW5QYW5lLnBhbmUsIGNvbnRhaW5zOiBjb250ZW50fSk7XG4gIGlmKGNvbnRlbnQgJiYgIWFwcC5ldmUuZmluZE9uZShcInF1ZXJ5IHRvIGlkXCIsIHtxdWVyeTogY29udGVudH0pKSB7XG4gICAgY3VyLmRpc3BhdGNoKFwiaW5zZXJ0IHF1ZXJ5XCIsIHtxdWVyeTogY29udGVudH0pO1xuICB9XG4gIGN1ci5jb21taXQoKTtcbn0pO1xuXG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcImhhc2hjaGFuZ2VcIiwgZnVuY3Rpb24oKSB7XG4gIGxldCBtYWluUGFuZSA9IGFwcC5ldmUuZmluZE9uZShcInVpIHBhbmVcIiwge3BhbmU6IFwicDFcIn0pO1xuICBsZXQgcGF0aCA9IGdldExvY2F0aW9uKCk7XG4gIGxldCBbXywga2luZCwgcmF3ID0gXCJcIl0gPSBwYXRoLnNwbGl0KFwiL1wiKTtcbiAgbGV0IGNvbnRlbnQgPSBkZXNsdWdpZnkocmF3KSB8fCBcImhvbWVcIjtcbiAgY29udGVudCA9IHVpLmFzRW50aXR5KGNvbnRlbnQpIHx8IGNvbnRlbnQ7XG5cbiAgaWYobWFpblBhbmUuY29udGFpbnMgPT09IGNvbnRlbnQpIHJldHVybjtcbiAgXG4gIGxldCBjdXIgPSBhcHAuZGlzcGF0Y2goXCJzZXQgcGFuZVwiLCB7cGFuZUlkOiBtYWluUGFuZS5wYW5lLCBjb250YWluczogY29udGVudH0pO1xuICBpZihjb250ZW50ICYmICFhcHAuZXZlLmZpbmRPbmUoXCJxdWVyeSB0byBpZFwiLCB7cXVlcnk6IGNvbnRlbnR9KSkge1xuICAgIGN1ci5kaXNwYXRjaChcImluc2VydCBxdWVyeVwiLCB7cXVlcnk6IGNvbnRlbnR9KTtcbiAgfVxuICBjdXIuY29tbWl0KCk7XG59KTtcbiIsIiIsIi8vICAgICB1dWlkLmpzXG4vL1xuLy8gICAgIENvcHlyaWdodCAoYykgMjAxMC0yMDEyIFJvYmVydCBLaWVmZmVyXG4vLyAgICAgTUlUIExpY2Vuc2UgLSBodHRwOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvbWl0LWxpY2Vuc2UucGhwXG5cbihmdW5jdGlvbigpIHtcbiAgdmFyIF9nbG9iYWwgPSB0aGlzO1xuXG4gIC8vIFVuaXF1ZSBJRCBjcmVhdGlvbiByZXF1aXJlcyBhIGhpZ2ggcXVhbGl0eSByYW5kb20gIyBnZW5lcmF0b3IuICBXZSBmZWF0dXJlXG4gIC8vIGRldGVjdCB0byBkZXRlcm1pbmUgdGhlIGJlc3QgUk5HIHNvdXJjZSwgbm9ybWFsaXppbmcgdG8gYSBmdW5jdGlvbiB0aGF0XG4gIC8vIHJldHVybnMgMTI4LWJpdHMgb2YgcmFuZG9tbmVzcywgc2luY2UgdGhhdCdzIHdoYXQncyB1c3VhbGx5IHJlcXVpcmVkXG4gIHZhciBfcm5nO1xuXG4gIC8vIE5vZGUuanMgY3J5cHRvLWJhc2VkIFJORyAtIGh0dHA6Ly9ub2RlanMub3JnL2RvY3MvdjAuNi4yL2FwaS9jcnlwdG8uaHRtbFxuICAvL1xuICAvLyBNb2RlcmF0ZWx5IGZhc3QsIGhpZ2ggcXVhbGl0eVxuICBpZiAodHlwZW9mKF9nbG9iYWwucmVxdWlyZSkgPT0gJ2Z1bmN0aW9uJykge1xuICAgIHRyeSB7XG4gICAgICB2YXIgX3JiID0gX2dsb2JhbC5yZXF1aXJlKCdjcnlwdG8nKS5yYW5kb21CeXRlcztcbiAgICAgIF9ybmcgPSBfcmIgJiYgZnVuY3Rpb24oKSB7cmV0dXJuIF9yYigxNik7fTtcbiAgICB9IGNhdGNoKGUpIHt9XG4gIH1cblxuICBpZiAoIV9ybmcgJiYgX2dsb2JhbC5jcnlwdG8gJiYgY3J5cHRvLmdldFJhbmRvbVZhbHVlcykge1xuICAgIC8vIFdIQVRXRyBjcnlwdG8tYmFzZWQgUk5HIC0gaHR0cDovL3dpa2kud2hhdHdnLm9yZy93aWtpL0NyeXB0b1xuICAgIC8vXG4gICAgLy8gTW9kZXJhdGVseSBmYXN0LCBoaWdoIHF1YWxpdHlcbiAgICB2YXIgX3JuZHM4ID0gbmV3IFVpbnQ4QXJyYXkoMTYpO1xuICAgIF9ybmcgPSBmdW5jdGlvbiB3aGF0d2dSTkcoKSB7XG4gICAgICBjcnlwdG8uZ2V0UmFuZG9tVmFsdWVzKF9ybmRzOCk7XG4gICAgICByZXR1cm4gX3JuZHM4O1xuICAgIH07XG4gIH1cblxuICBpZiAoIV9ybmcpIHtcbiAgICAvLyBNYXRoLnJhbmRvbSgpLWJhc2VkIChSTkcpXG4gICAgLy9cbiAgICAvLyBJZiBhbGwgZWxzZSBmYWlscywgdXNlIE1hdGgucmFuZG9tKCkuICBJdCdzIGZhc3QsIGJ1dCBpcyBvZiB1bnNwZWNpZmllZFxuICAgIC8vIHF1YWxpdHkuXG4gICAgdmFyICBfcm5kcyA9IG5ldyBBcnJheSgxNik7XG4gICAgX3JuZyA9IGZ1bmN0aW9uKCkge1xuICAgICAgZm9yICh2YXIgaSA9IDAsIHI7IGkgPCAxNjsgaSsrKSB7XG4gICAgICAgIGlmICgoaSAmIDB4MDMpID09PSAwKSByID0gTWF0aC5yYW5kb20oKSAqIDB4MTAwMDAwMDAwO1xuICAgICAgICBfcm5kc1tpXSA9IHIgPj4+ICgoaSAmIDB4MDMpIDw8IDMpICYgMHhmZjtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIF9ybmRzO1xuICAgIH07XG4gIH1cblxuICAvLyBCdWZmZXIgY2xhc3MgdG8gdXNlXG4gIHZhciBCdWZmZXJDbGFzcyA9IHR5cGVvZihfZ2xvYmFsLkJ1ZmZlcikgPT0gJ2Z1bmN0aW9uJyA/IF9nbG9iYWwuQnVmZmVyIDogQXJyYXk7XG5cbiAgLy8gTWFwcyBmb3IgbnVtYmVyIDwtPiBoZXggc3RyaW5nIGNvbnZlcnNpb25cbiAgdmFyIF9ieXRlVG9IZXggPSBbXTtcbiAgdmFyIF9oZXhUb0J5dGUgPSB7fTtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCAyNTY7IGkrKykge1xuICAgIF9ieXRlVG9IZXhbaV0gPSAoaSArIDB4MTAwKS50b1N0cmluZygxNikuc3Vic3RyKDEpO1xuICAgIF9oZXhUb0J5dGVbX2J5dGVUb0hleFtpXV0gPSBpO1xuICB9XG5cbiAgLy8gKipgcGFyc2UoKWAgLSBQYXJzZSBhIFVVSUQgaW50byBpdCdzIGNvbXBvbmVudCBieXRlcyoqXG4gIGZ1bmN0aW9uIHBhcnNlKHMsIGJ1Ziwgb2Zmc2V0KSB7XG4gICAgdmFyIGkgPSAoYnVmICYmIG9mZnNldCkgfHwgMCwgaWkgPSAwO1xuXG4gICAgYnVmID0gYnVmIHx8IFtdO1xuICAgIHMudG9Mb3dlckNhc2UoKS5yZXBsYWNlKC9bMC05YS1mXXsyfS9nLCBmdW5jdGlvbihvY3QpIHtcbiAgICAgIGlmIChpaSA8IDE2KSB7IC8vIERvbid0IG92ZXJmbG93IVxuICAgICAgICBidWZbaSArIGlpKytdID0gX2hleFRvQnl0ZVtvY3RdO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gWmVybyBvdXQgcmVtYWluaW5nIGJ5dGVzIGlmIHN0cmluZyB3YXMgc2hvcnRcbiAgICB3aGlsZSAoaWkgPCAxNikge1xuICAgICAgYnVmW2kgKyBpaSsrXSA9IDA7XG4gICAgfVxuXG4gICAgcmV0dXJuIGJ1ZjtcbiAgfVxuXG4gIC8vICoqYHVucGFyc2UoKWAgLSBDb252ZXJ0IFVVSUQgYnl0ZSBhcnJheSAoYWxhIHBhcnNlKCkpIGludG8gYSBzdHJpbmcqKlxuICBmdW5jdGlvbiB1bnBhcnNlKGJ1Ziwgb2Zmc2V0KSB7XG4gICAgdmFyIGkgPSBvZmZzZXQgfHwgMCwgYnRoID0gX2J5dGVUb0hleDtcbiAgICByZXR1cm4gIGJ0aFtidWZbaSsrXV0gKyBidGhbYnVmW2krK11dICtcbiAgICAgICAgICAgIGJ0aFtidWZbaSsrXV0gKyBidGhbYnVmW2krK11dICsgJy0nICtcbiAgICAgICAgICAgIGJ0aFtidWZbaSsrXV0gKyBidGhbYnVmW2krK11dICsgJy0nICtcbiAgICAgICAgICAgIGJ0aFtidWZbaSsrXV0gKyBidGhbYnVmW2krK11dICsgJy0nICtcbiAgICAgICAgICAgIGJ0aFtidWZbaSsrXV0gKyBidGhbYnVmW2krK11dICsgJy0nICtcbiAgICAgICAgICAgIGJ0aFtidWZbaSsrXV0gKyBidGhbYnVmW2krK11dICtcbiAgICAgICAgICAgIGJ0aFtidWZbaSsrXV0gKyBidGhbYnVmW2krK11dICtcbiAgICAgICAgICAgIGJ0aFtidWZbaSsrXV0gKyBidGhbYnVmW2krK11dO1xuICB9XG5cbiAgLy8gKipgdjEoKWAgLSBHZW5lcmF0ZSB0aW1lLWJhc2VkIFVVSUQqKlxuICAvL1xuICAvLyBJbnNwaXJlZCBieSBodHRwczovL2dpdGh1Yi5jb20vTGlvc0svVVVJRC5qc1xuICAvLyBhbmQgaHR0cDovL2RvY3MucHl0aG9uLm9yZy9saWJyYXJ5L3V1aWQuaHRtbFxuXG4gIC8vIHJhbmRvbSAjJ3Mgd2UgbmVlZCB0byBpbml0IG5vZGUgYW5kIGNsb2Nrc2VxXG4gIHZhciBfc2VlZEJ5dGVzID0gX3JuZygpO1xuXG4gIC8vIFBlciA0LjUsIGNyZWF0ZSBhbmQgNDgtYml0IG5vZGUgaWQsICg0NyByYW5kb20gYml0cyArIG11bHRpY2FzdCBiaXQgPSAxKVxuICB2YXIgX25vZGVJZCA9IFtcbiAgICBfc2VlZEJ5dGVzWzBdIHwgMHgwMSxcbiAgICBfc2VlZEJ5dGVzWzFdLCBfc2VlZEJ5dGVzWzJdLCBfc2VlZEJ5dGVzWzNdLCBfc2VlZEJ5dGVzWzRdLCBfc2VlZEJ5dGVzWzVdXG4gIF07XG5cbiAgLy8gUGVyIDQuMi4yLCByYW5kb21pemUgKDE0IGJpdCkgY2xvY2tzZXFcbiAgdmFyIF9jbG9ja3NlcSA9IChfc2VlZEJ5dGVzWzZdIDw8IDggfCBfc2VlZEJ5dGVzWzddKSAmIDB4M2ZmZjtcblxuICAvLyBQcmV2aW91cyB1dWlkIGNyZWF0aW9uIHRpbWVcbiAgdmFyIF9sYXN0TVNlY3MgPSAwLCBfbGFzdE5TZWNzID0gMDtcblxuICAvLyBTZWUgaHR0cHM6Ly9naXRodWIuY29tL2Jyb29mYS9ub2RlLXV1aWQgZm9yIEFQSSBkZXRhaWxzXG4gIGZ1bmN0aW9uIHYxKG9wdGlvbnMsIGJ1Ziwgb2Zmc2V0KSB7XG4gICAgdmFyIGkgPSBidWYgJiYgb2Zmc2V0IHx8IDA7XG4gICAgdmFyIGIgPSBidWYgfHwgW107XG5cbiAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcblxuICAgIHZhciBjbG9ja3NlcSA9IG9wdGlvbnMuY2xvY2tzZXEgIT0gbnVsbCA/IG9wdGlvbnMuY2xvY2tzZXEgOiBfY2xvY2tzZXE7XG5cbiAgICAvLyBVVUlEIHRpbWVzdGFtcHMgYXJlIDEwMCBuYW5vLXNlY29uZCB1bml0cyBzaW5jZSB0aGUgR3JlZ29yaWFuIGVwb2NoLFxuICAgIC8vICgxNTgyLTEwLTE1IDAwOjAwKS4gIEpTTnVtYmVycyBhcmVuJ3QgcHJlY2lzZSBlbm91Z2ggZm9yIHRoaXMsIHNvXG4gICAgLy8gdGltZSBpcyBoYW5kbGVkIGludGVybmFsbHkgYXMgJ21zZWNzJyAoaW50ZWdlciBtaWxsaXNlY29uZHMpIGFuZCAnbnNlY3MnXG4gICAgLy8gKDEwMC1uYW5vc2Vjb25kcyBvZmZzZXQgZnJvbSBtc2Vjcykgc2luY2UgdW5peCBlcG9jaCwgMTk3MC0wMS0wMSAwMDowMC5cbiAgICB2YXIgbXNlY3MgPSBvcHRpb25zLm1zZWNzICE9IG51bGwgPyBvcHRpb25zLm1zZWNzIDogbmV3IERhdGUoKS5nZXRUaW1lKCk7XG5cbiAgICAvLyBQZXIgNC4yLjEuMiwgdXNlIGNvdW50IG9mIHV1aWQncyBnZW5lcmF0ZWQgZHVyaW5nIHRoZSBjdXJyZW50IGNsb2NrXG4gICAgLy8gY3ljbGUgdG8gc2ltdWxhdGUgaGlnaGVyIHJlc29sdXRpb24gY2xvY2tcbiAgICB2YXIgbnNlY3MgPSBvcHRpb25zLm5zZWNzICE9IG51bGwgPyBvcHRpb25zLm5zZWNzIDogX2xhc3ROU2VjcyArIDE7XG5cbiAgICAvLyBUaW1lIHNpbmNlIGxhc3QgdXVpZCBjcmVhdGlvbiAoaW4gbXNlY3MpXG4gICAgdmFyIGR0ID0gKG1zZWNzIC0gX2xhc3RNU2VjcykgKyAobnNlY3MgLSBfbGFzdE5TZWNzKS8xMDAwMDtcblxuICAgIC8vIFBlciA0LjIuMS4yLCBCdW1wIGNsb2Nrc2VxIG9uIGNsb2NrIHJlZ3Jlc3Npb25cbiAgICBpZiAoZHQgPCAwICYmIG9wdGlvbnMuY2xvY2tzZXEgPT0gbnVsbCkge1xuICAgICAgY2xvY2tzZXEgPSBjbG9ja3NlcSArIDEgJiAweDNmZmY7XG4gICAgfVxuXG4gICAgLy8gUmVzZXQgbnNlY3MgaWYgY2xvY2sgcmVncmVzc2VzIChuZXcgY2xvY2tzZXEpIG9yIHdlJ3ZlIG1vdmVkIG9udG8gYSBuZXdcbiAgICAvLyB0aW1lIGludGVydmFsXG4gICAgaWYgKChkdCA8IDAgfHwgbXNlY3MgPiBfbGFzdE1TZWNzKSAmJiBvcHRpb25zLm5zZWNzID09IG51bGwpIHtcbiAgICAgIG5zZWNzID0gMDtcbiAgICB9XG5cbiAgICAvLyBQZXIgNC4yLjEuMiBUaHJvdyBlcnJvciBpZiB0b28gbWFueSB1dWlkcyBhcmUgcmVxdWVzdGVkXG4gICAgaWYgKG5zZWNzID49IDEwMDAwKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ3V1aWQudjEoKTogQ2FuXFwndCBjcmVhdGUgbW9yZSB0aGFuIDEwTSB1dWlkcy9zZWMnKTtcbiAgICB9XG5cbiAgICBfbGFzdE1TZWNzID0gbXNlY3M7XG4gICAgX2xhc3ROU2VjcyA9IG5zZWNzO1xuICAgIF9jbG9ja3NlcSA9IGNsb2Nrc2VxO1xuXG4gICAgLy8gUGVyIDQuMS40IC0gQ29udmVydCBmcm9tIHVuaXggZXBvY2ggdG8gR3JlZ29yaWFuIGVwb2NoXG4gICAgbXNlY3MgKz0gMTIyMTkyOTI4MDAwMDA7XG5cbiAgICAvLyBgdGltZV9sb3dgXG4gICAgdmFyIHRsID0gKChtc2VjcyAmIDB4ZmZmZmZmZikgKiAxMDAwMCArIG5zZWNzKSAlIDB4MTAwMDAwMDAwO1xuICAgIGJbaSsrXSA9IHRsID4+PiAyNCAmIDB4ZmY7XG4gICAgYltpKytdID0gdGwgPj4+IDE2ICYgMHhmZjtcbiAgICBiW2krK10gPSB0bCA+Pj4gOCAmIDB4ZmY7XG4gICAgYltpKytdID0gdGwgJiAweGZmO1xuXG4gICAgLy8gYHRpbWVfbWlkYFxuICAgIHZhciB0bWggPSAobXNlY3MgLyAweDEwMDAwMDAwMCAqIDEwMDAwKSAmIDB4ZmZmZmZmZjtcbiAgICBiW2krK10gPSB0bWggPj4+IDggJiAweGZmO1xuICAgIGJbaSsrXSA9IHRtaCAmIDB4ZmY7XG5cbiAgICAvLyBgdGltZV9oaWdoX2FuZF92ZXJzaW9uYFxuICAgIGJbaSsrXSA9IHRtaCA+Pj4gMjQgJiAweGYgfCAweDEwOyAvLyBpbmNsdWRlIHZlcnNpb25cbiAgICBiW2krK10gPSB0bWggPj4+IDE2ICYgMHhmZjtcblxuICAgIC8vIGBjbG9ja19zZXFfaGlfYW5kX3Jlc2VydmVkYCAoUGVyIDQuMi4yIC0gaW5jbHVkZSB2YXJpYW50KVxuICAgIGJbaSsrXSA9IGNsb2Nrc2VxID4+PiA4IHwgMHg4MDtcblxuICAgIC8vIGBjbG9ja19zZXFfbG93YFxuICAgIGJbaSsrXSA9IGNsb2Nrc2VxICYgMHhmZjtcblxuICAgIC8vIGBub2RlYFxuICAgIHZhciBub2RlID0gb3B0aW9ucy5ub2RlIHx8IF9ub2RlSWQ7XG4gICAgZm9yICh2YXIgbiA9IDA7IG4gPCA2OyBuKyspIHtcbiAgICAgIGJbaSArIG5dID0gbm9kZVtuXTtcbiAgICB9XG5cbiAgICByZXR1cm4gYnVmID8gYnVmIDogdW5wYXJzZShiKTtcbiAgfVxuXG4gIC8vICoqYHY0KClgIC0gR2VuZXJhdGUgcmFuZG9tIFVVSUQqKlxuXG4gIC8vIFNlZSBodHRwczovL2dpdGh1Yi5jb20vYnJvb2ZhL25vZGUtdXVpZCBmb3IgQVBJIGRldGFpbHNcbiAgZnVuY3Rpb24gdjQob3B0aW9ucywgYnVmLCBvZmZzZXQpIHtcbiAgICAvLyBEZXByZWNhdGVkIC0gJ2Zvcm1hdCcgYXJndW1lbnQsIGFzIHN1cHBvcnRlZCBpbiB2MS4yXG4gICAgdmFyIGkgPSBidWYgJiYgb2Zmc2V0IHx8IDA7XG5cbiAgICBpZiAodHlwZW9mKG9wdGlvbnMpID09ICdzdHJpbmcnKSB7XG4gICAgICBidWYgPSBvcHRpb25zID09ICdiaW5hcnknID8gbmV3IEJ1ZmZlckNsYXNzKDE2KSA6IG51bGw7XG4gICAgICBvcHRpb25zID0gbnVsbDtcbiAgICB9XG4gICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG5cbiAgICB2YXIgcm5kcyA9IG9wdGlvbnMucmFuZG9tIHx8IChvcHRpb25zLnJuZyB8fCBfcm5nKSgpO1xuXG4gICAgLy8gUGVyIDQuNCwgc2V0IGJpdHMgZm9yIHZlcnNpb24gYW5kIGBjbG9ja19zZXFfaGlfYW5kX3Jlc2VydmVkYFxuICAgIHJuZHNbNl0gPSAocm5kc1s2XSAmIDB4MGYpIHwgMHg0MDtcbiAgICBybmRzWzhdID0gKHJuZHNbOF0gJiAweDNmKSB8IDB4ODA7XG5cbiAgICAvLyBDb3B5IGJ5dGVzIHRvIGJ1ZmZlciwgaWYgcHJvdmlkZWRcbiAgICBpZiAoYnVmKSB7XG4gICAgICBmb3IgKHZhciBpaSA9IDA7IGlpIDwgMTY7IGlpKyspIHtcbiAgICAgICAgYnVmW2kgKyBpaV0gPSBybmRzW2lpXTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gYnVmIHx8IHVucGFyc2Uocm5kcyk7XG4gIH1cblxuICAvLyBFeHBvcnQgcHVibGljIEFQSVxuICB2YXIgdXVpZCA9IHY0O1xuICB1dWlkLnYxID0gdjE7XG4gIHV1aWQudjQgPSB2NDtcbiAgdXVpZC5wYXJzZSA9IHBhcnNlO1xuICB1dWlkLnVucGFyc2UgPSB1bnBhcnNlO1xuICB1dWlkLkJ1ZmZlckNsYXNzID0gQnVmZmVyQ2xhc3M7XG5cbiAgaWYgKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkge1xuICAgIC8vIFB1Ymxpc2ggYXMgQU1EIG1vZHVsZVxuICAgIGRlZmluZShmdW5jdGlvbigpIHtyZXR1cm4gdXVpZDt9KTtcbiAgfSBlbHNlIGlmICh0eXBlb2YobW9kdWxlKSAhPSAndW5kZWZpbmVkJyAmJiBtb2R1bGUuZXhwb3J0cykge1xuICAgIC8vIFB1Ymxpc2ggYXMgbm9kZS5qcyBtb2R1bGVcbiAgICBtb2R1bGUuZXhwb3J0cyA9IHV1aWQ7XG4gIH0gZWxzZSB7XG4gICAgLy8gUHVibGlzaCBhcyBnbG9iYWwgKGluIGJyb3dzZXJzKVxuICAgIHZhciBfcHJldmlvdXNSb290ID0gX2dsb2JhbC51dWlkO1xuXG4gICAgLy8gKipgbm9Db25mbGljdCgpYCAtIChicm93c2VyIG9ubHkpIHRvIHJlc2V0IGdsb2JhbCAndXVpZCcgdmFyKipcbiAgICB1dWlkLm5vQ29uZmxpY3QgPSBmdW5jdGlvbigpIHtcbiAgICAgIF9nbG9iYWwudXVpZCA9IF9wcmV2aW91c1Jvb3Q7XG4gICAgICByZXR1cm4gdXVpZDtcbiAgICB9O1xuXG4gICAgX2dsb2JhbC51dWlkID0gdXVpZDtcbiAgfVxufSkuY2FsbCh0aGlzKTtcbiJdfQ==
